. Modifications
.
.--------------------------------------------------------------------------
. V11.04.01  02/05/2024 Thanh T         TSK 0941543
.            Added SVPM1390, SVPM1340, SVPM1410 and SVPM1420. 
.            Added PMXX8100, PMXX8200, PMXX8300 and PMXX8400 
. V11.03.04  30/10/2023  Thanh T        TSK 0932841
.            Added PMXX8100 to return Patient names with comma after surname
. V11.03.03  04/08/2023  Davin          TSK 0907196
.            Added PMPXI129/PMPXUDT1 to PMPXI138/PMPXUTM5
. V11.03.02  17/05/2023  Ebon Clements  TSK 0932616
.            Read WEBSECFD at start of procedure GETCURIP to set users
.            current hospital
. V11.03.01  14/03/2023  Bella Turco    TSK 0919538
.            Added checks to determine status of 'Current IP' hyperlink in
.            Patient Banner in GETCURIP
. V11.02.02  29/03/2022  Thanh T        TSK 0903453
.            Added PMXX6700 to PMXX7000 
. V11.02.02  29/03/2022  Thanh T        TSK 0903453
.            Added PMXX6300 to PMXX6600, SVPM1250 to SVPM1280 for
.            Identifying gender and pronoun
. V11.02.01  22/03/2022  Alina Bhari    TSK 0912792
.            Added 20 character(Alternative Visit Number) in PatientAID
.            if patient have alternative visit number.
.            - PMIC9000 , ALTVS000                    
.--------------------------------------------------------------------------
. V11.00.04  19/01/2021  Thanh T        TSK 0872840
.            Changed PMXX3910 to return the correct Yes/No/Space for
.            PMPXSN10 value 
. V11.00.03  14/12/2020  Thanh T        TSK 0868699
.            Added PMXX6200 (PMCDCNUM)
. V11.00.02  08/12/2020  Thanh T        TSK 0872840
.            Added PMXX6200 (PMCDCNUM)
. V11.00.01  04/03/2020 Jill Parkinson Task 0879163
.            Added PSEX output from Category G
.--------------------------------------------------------------------------
. V10.13.01  14/08/2018 Richa Phogat  TSK 0851999
.            Added PMPXI110 to PMPXI124, output for PMPXSN16 to PMPXSN30
. V10.12.01  11/07/2018 Ebon Clements TSK 0850366
.            Added PMPXUDF1 to PMPXUDF5 tags - PMXX4100
. V10.08.01  14/04/2016 J.Tan         CAR 0814716
.            Added PMPXI104 (PMPXUPRF) - Usual PRFA code
. V10.06.03  28/07/2015 Davin         CAR 314914
.            Added PMPXI103/PMPXSN10/PMXX3900 (PCEHR Flag)
. V10.06.02  11/06/2015 Jill Parkinson CAR 317894
.            Added output of current BMI calculation
. V10.06.01  23/03/2015 Ebon Clements CAR 282146
.            Added PMPXI102
. V10.04.01  12/03/2014  Patrick Adair  CAR 292935
.            Added Consent For Release of Info fields    
. V10.03.05  30/01/2014  Don Nguyen     CAR 295027
.            Added PMXX1500 - Output visit dates for Inpatient/Outpatient    
. V10.03.04  12/12/2013 Ebon Clements   CAR 293092
.            Pack PMPXI001, PMPXI002,PMPXI003 and PMPXI004 with spaces
. V10.03.03  12/12/2013 Ania P          CAR 275582
.            Added PMXX1400/PMXX1600
. V10.03.02  30/07/2013 Ebon Clements   CAR 283202
.            Pack cgi vars for PMPXPMCN and PMPXPMCR with spaces
. V10.03.01  19/06/2013 Peter Vela      CAR 283202
.            Added PMPXPMCN and PMPXPMCR
. V10.02.03  09/09/2011 Jill Parkinsson CAR 249079 
.            Added read of pmsvx1af in GETCURIP
. V10.02.02  25/07/2011 Ebon Clements CAR 240722   
.            Packed PMPXI084 and PMPXI088 with SP70
. V10.02.01  20/06/2011 Ebon Clements CAR 242416
.            Added PMPXHFCN and PMPXLUBH
. V9.12.01   21/08/2009 Ebon Clements CAR 202965
.            Added visit based CDM details to CHCDM000
. V9.11.02   21/04/2009 Jill Habasque CAR 145706
.            Added PMPXI089 to PMPXI091
. V9.11.01   19/11/2008 Ebon Clements CAR 183976
.            Added PMPXI084 to PMPXI088
. V9.09.02   10/04/2008  Jill Habasque     CAR 161251
.            Removed move of zero to PMPXEDOB if not Z70
. V9.09.01   04/01/2008  Peter McMullen    CAR 158011
.            Added code for default 'no' on PMPXINTR (for Cabrini)        
. V9.08.03   17/04/2007  Jill Habasque     CAR 126219
.            Added call to EMRCHK00 from CLAM0000
. V9.08.02   20/02/2007  Peter Vela        CAR 118225
.            Added PMPXPFSN PMPXPFGN
. V9.08.01   26/10/2006  Ebon Clements     CAR 123415
.            Added PMPXPFAX
. V9.07.02   12/09/2006  Jill Habasque     CAR 109852
.            Added PROC GETALIDS                                    
. V9.07.01   16/06/2006 Ramesh V.K.        CAR 101964
.            called PROC GETREL00 to get the relation description.
. V9.04.B01  16/12/2005 J.Tan         CAR 85191
.            Added fields for Iwi
. V9.04.01   05.05.2005 Davin         CAR 22680
.            Added hcp tag(84) & practice tag(85) - copied from patmsxtm
. V9.03.03   11.06.2004 Jill Habasque CAR 44641
.            Added tag for alternate ID
. V9.03.02   03.06.2004 Peter Vela CAR 49016
.            Added tag for PSEX code
. V9.03.01   18.06.2003 J.Tan  CAR 39832
.            Added Billing comments indicator
. 05.06.2003 Jill Habasque SRF 38102
.            Added Not Stated for Interpreter required                  
. 23.05.2003 Sylvek Litewka
.            Fixed procedure UPVPMI00 for variables PMPXUYN4, PMPXUYN5
.            and PMPXUYN6.
. 17.03.2003 V9.02.01 Ebon Clements SRF 37270
.            Added output of PMPXFLDR
. 07.12.2001 Jill Habasque
.            Added output of PMPXCONP
. 17.11.2001 Kuldeep Singh
.            Added flag for Interpreter  
. 05.10.2001 Jill Habasque
.            Added output of Yes or No for PMPXKCRP
. 05.09.2001 Jill Habasque
.            Added Patient Folder colour tag
. 16.08.2001 Jill Habasque
.            Fixed save for PMPXI001
.------------------------------------------------------------
. Add PMI Extension Field
.------------------------------------------------------------
PMIX0000  BRANCH    FLDITMNO,PMIX0100,PMIX0200,PMIX0300,PMIX0400,PMIX0500:
                             PMIX0600,PMIX0700,PMIX0800,PMIX0900,PMIX1000:
                             PMIX1100,PMIX1200,PMIX1300,PMIX1400,PMIX1500:
                             PMIX1600,PMIX1700,PMIX1800,PMIX1900,PMIX2000:
                             PMIX2100,PMIX2200,PMIX2300,PMIX2400,PMIX2500:
                             PMIX2600,PMIX2700,PMIX2800,PMIX2900,PMIX3000:
                             PMIX3100,PMIX3200,PMIX3300,PMIX3400,PMIX3500:
                             PMIX3600,PMIX3700,PMIX3800,PMIX3900,PMIX4000:
                             PMIX4100,PMIX4200,PMIX4300,PMIX4400,PMIX4500:
                             PMIX4600,PMIX4700,PMIX4800,PMIX4900,PMIX5000:
                             PMIX5100,PMIX5200,PMIX5300,PMIX5400,PMIX5500:
                             PMIX5600,PMIX5700,PMIX5800,PMIX5900,PMIX6000:
                             PMIX6100,PMIX6200,PMIX6300,PMIX6400,PMIX6500:
                             PMIX6600,PMIX6700,PMIX6800,PMIX6900,PMIX7000:
                             PMIX7100,PMIX7200,PMIX7300,PMIX7400,PMIX7500:
                             PMIX7600,PMIX7700,PMIX7800,PMIX7900,PMIX8000:
                             PMIX8100,PMIX8200,PMIX8300,PMIX8400,PMIX8500:
                             PMIX8600,PMIX8700,PMIX8800,PMIX8900,PMIX9000:
                             PMIX9100,PMIX9200,PMIX9300,PMIX9400,PMIX9500:
                             PMIX9600,PMIX9700,PMIX9800,PMIX9900
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      PMIX9999
.
PMIX0100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMIX0110,PMIX0120,PMIX0130
          WRITE     HTMLFILE;PMPXINTR;
          GOTO      PMIX9999
.
PMIX0110  MATCH     "0",PMPXINTR
          IF        @EQUAL           
            WRITE     HTMLFILE;"No";
          ENDIF
          MATCH     "1",PMPXINTR 
          IF        @EQUAL                                                     
            WRITE     HTMLFILE;"Yes";                                           
          ENDIF
          MATCH     SP1,PMPXINTR
          IF        @EQUAL
            WRITE     HTMLFILE;"Not Stated";
          ENDIF
          GOTO      PMIX9999
.
PMIX0120  MATCH     SP70,PMPXINTR
          IF        @EQUAL
            WRITE    HTMLFILE;"<option value=#" #" selected>Not Stated</option>";
          ELSE
            WRITE     HTMLFILE;"<option value=#" #">Not Stated</option>";
          ENDIF
.
          MATCH     "0",PMPXINTR
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"0#" selected>No</option>";
          ELSE
            WRITE     HTMLFILE;"<option value=#"0#">No</option>";
          ENDIF
.
          MATCH     "1",PMPXINTR
          IF        @EQUAL
            WRITE      HTMLFILE;"<option value=#"1#" selected>Yes</option>";
          ELSE
            WRITE      HTMLFILE;"<option value=#"1#">Yes</option>";
          ENDIF
.
          GOTO      PMIX9999
.
PMIX0130  MATCH     "1",PMPXINTR
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"0#">No</option>";
            WRITE     HTMLFILE;"<option value=#"1#" selected>Yes</option>";
          ELSE
            WRITE     HTMLFILE;"<option value=#"0#" selected>No</option>";
            WRITE     HTMLFILE;"<option value=#"1#">Yes</option>";
          ENDIF
.
          GOTO      PMIX9999
.
.
PMIX0200  MOVE      "LA",CATEGORY
          MOVE      PMPXLNG1,CODE
          CALL      CODITM00
          GOTO      PMIX9999
.
PMIX0300  MOVE      "LA",CATEGORY
          MOVE      PMPXLNG2,CODE
          CALL      CODITM00
          GOTO      PMIX9999
.
PMIX0400  MOVE      "LA",CATEGORY
          MOVE      PMPXLNG3,CODE
          CALL      CODITM00
          GOTO      PMIX9999
.
PMIX0500  MATCH     SP70,PMPXPEML
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXPEML;
          GOTO      PMIX9999
.
PMIX0600  WRITE     HTMLFILE;PMPXEDOB;
          GOTO      PMIX9999
.
PMIX0700  MATCH     SP70,PMPXCMOB
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXCMOB;
          GOTO      PMIX9999
.
PMIX0800  MATCH     SP70,PMPXCEML
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXCEML;
          GOTO      PMIX9999
.
PMIX0900  WRITE     HTMLFILE;PMPXCCRP;
          GOTO      PMIX9999
.
PMIX1000  MATCH     SP70,PMPXKMOB
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXKMOB;
          GOTO      PMIX9999
.
PMIX1100  MATCH     SP70,PMPXKEML
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXKEML;
          GOTO      PMIX9999
.
PMIX1200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMIX1210
          WRITE     HTMLFILE;PMPXKCRP;
          GOTO      PMIX9999
.
PMIX1210  MATCH     "1",PMPXKCRP
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      PMIX9999
.
PMIX1300  MATCH     SP70,PMPXRMOB
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXRMOB;
          GOTO      PMIX9999
.
PMIX1400  MATCH     SP70,PMPXREML
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXREML;
          GOTO      PMIX9999
.
PMIX1500  WRITE     HTMLFILE;PMPXRCRP;
          GOTO      PMIX9999
.
PMIX1600  UNPACK    PMPXMEDC,CCENT,CYEAR,CMON,CDAY
          MATCH     SP70,PMPXMEDC
          GOTO      PMIX9999 IF EQUAL
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PMIX9999
.
PMIX1700  MOVE      "DY",CATEGORY
          MOVE      PMPXDETY,CODE
          CALL      CODITM00
          GOTO      PMIX9999
.
PMIX1800  MATCH     SP70,PMPXPRIS
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXPRIS;
          GOTO      PMIX9999
.
PMIX1900  MATCH     SP70,PMPXCSER
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXCSER;
          GOTO      PMIX9999
.
PMIX2000  WRITE     HTMLFILE;PMPXPHEI;
          GOTO      PMIX9999
.
PMIX2100  WRITE     HTMLFILE;PMPXPWEI;
          GOTO      PMIX9999
.
PMIX2200  UNPACK    PMPXDREC,CCENT,CYEAR,CMON,CDAY
          MATCH     SP70,PMPXDREC
          GOTO      PMIX9999 IF EQUAL
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      PMIX9999
.
PMIX2300  MATCH     SP70,PMPXMSNA
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXMSNA;
          GOTO      PMIX9999
.
PMIX2400  MATCH     SP70,PMPXMGNA
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXMGNA;
          GOTO      PMIX9999
.
PMIX2500  MATCH     SP70,PMPXMTLE
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXMTLE;
          GOTO      PMIX9999
.
PMIX2600  MATCH     SP70,PMPXMAD1
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXMAD1;
          GOTO      PMIX9999
.
PMIX2700  MATCH     SP70,PMPXMAD2
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXMAD2;
          GOTO      PMIX9999
.
PMIX2800  MATCH     SP70,PMPXMAD3
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXMAD3;
          GOTO      PMIX9999
.
PMIX2900  MATCH     SP70,PMPXMAD4
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXMAD4;
          GOTO      PMIX9999
.
PMIX3000  MATCH     SP70,PMPXMPOS
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXMPOS;
          GOTO      PMIX9999
.
PMIX3100  MATCH     SP70,PMPXMPNO
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXMPNO;
          GOTO      PMIX9999
.
PMIX3200  MATCH     SP70,PMPXMBNO
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXMBNO;
          GOTO      PMIX9999
.
PMIX3300  MATCH     SP70,PMPXMMNO
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXMMNO;
          GOTO      PMIX9999
.
PMIX3400  MATCH     SP70,PMPXMEML
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXMEML;
          GOTO      PMIX9999
.
PMIX3500  MOVE      "C ",CATEGORY
          MOVE      PMPXMCNT,CODE
          CALL      CODITM00
          GOTO      PMIX9999
.
PMIX3600  MATCH     "1",PMPXMCRP
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF 
          GOTO      PMIX9999
.
PMIX3700  WRITE     HTMLFILE;PMPXMLAB;
          GOTO      PMIX9999
.
PMIX3800  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMIX3801
          MATCH     SP70,PMPXMREL
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXMREL;
          GOTO      PMIX9999
.
PMIX3801  PACK      D10,PMPXMREL,SP70
          PROC      GETREL00
          GOTO      PMIX9999
.
PMIX3900  MATCH     SP70,PMPXFSNA
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXFSNA;
          GOTO      PMIX9999
.
PMIX4000  MATCH     SP70,PMPXFGNA
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXFGNA;
          GOTO      PMIX9999
.
PMIX4100  MATCH     SP70,PMPXFTLE
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXFTLE;
          GOTO      PMIX9999
.
PMIX4200  MATCH     SP70,PMPXFAD1
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXFAD1;
          GOTO      PMIX9999
.
PMIX4300  MATCH     SP70,PMPXFAD2
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXFAD2;
          GOTO      PMIX9999
.
PMIX4400  MATCH     SP70,PMPXFAD3
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXFAD3;
          GOTO      PMIX9999
.
PMIX4500  MATCH     SP70,PMPXFAD4
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXFAD4;
          GOTO      PMIX9999
.
PMIX4600  MATCH     SP70,PMPXFPOS
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXFPOS;
          GOTO      PMIX9999
.
PMIX4700  MATCH     SP70,PMPXFPNO
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXFPNO;
          GOTO      PMIX9999
.
PMIX4800  MATCH     SP70,PMPXFBNO
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXFBNO;
          GOTO      PMIX9999
.
PMIX4900  MATCH     SP70,PMPXFMNO
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXFMNO;
          GOTO      PMIX9999
.
PMIX5000  MATCH     SP70,PMPXFEML
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXFEML;
          GOTO      PMIX9999
.
PMIX5100  MOVE      "C ",CATEGORY
          MOVE      PMPXFCNT,CODE
          CALL      CODITM00
          GOTO      PMIX9999
.
PMIX5200  MATCH     "1",PMPXFCRP
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      PMIX9999
.
PMIX5300  WRITE     HTMLFILE;PMPXFLAB;
          GOTO      PMIX9999
.
PMIX5400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMIX5401
          MATCH     SP70,PMPXFREL
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXFREL;
          GOTO      PMIX9999
.
PMIX5401  PACK      D10,PMPXFREL,SP70
          PROC      GETREL00
          GOTO      PMIX9999
.
PMIX5500  MATCH     SP70,PMPXTDIG
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXTDIG;
          GOTO      PMIX9999
.
PMIX5600  MATCH     SP70,PMPXWBID
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXWBID;
          GOTO      PMIX9999
.
PMIX5700  MOVE      "DX",CATEGORY
          MOVE      PMPXDVAC,CODE
          CALL      CODITM00
          GOTO      PMIX9999 
.
PMIX5800  UNPACK    PMPXPNSD,CCENT,CYEAR,CMON,CDAY
          MATCH     SP70,PMPXPNSD
          GOTO      PMIX9999 IF EQUAL
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      PMIX9999
.
PMIX5900  MATCH     SP70,PMPXRHC1
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXRHC1;
          GOTO      PMIX9999
.
PMIX6000  MATCH     SP70,PMPXRH1G
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXRH1G;
          GOTO      PMIX9999
.
PMIX6100  MATCH     SP70,PMPXR1GC
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXR1GC;
          GOTO      PMIX9999
.
PMIX6200  WRITE     HTMLFILE;PMPXUYN4;
          GOTO      PMIX9999
.
PMIX6300  WRITE     HTMLFILE;PMPXUYN5;
          GOTO      PMIX9999
.
PMIX6400  WRITE     HTMLFILE;PMPXUYN6;
          GOTO      PMIX9999
.
PMIX6500  MOVE      "VA",CATEGORY
          MOVE      PMPXABRG,CODE
          CALL      CODITM00
          GOTO      PMIX9999
.
PMIX6600  MOVE      "PV",CATEGORY
          MOVE      PMPXPRVI,CODE
          CALL      CODITM00
          GOTO      PMIX9999
.
PMIX6700  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMIX6710
          WRITE     HTMLFILE;PMPXCRIN;
          GOTO      PMIX9999
.
PMIX6710  MATCH     "0",PMPXCRIN
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
          ENDIF
          MATCH     "1",PMPXCRIN
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ENDIF
          GOTO      PMIX9999
.
PMIX6800  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMIX6810
          WRITE     HTMLFILE;PMPXHOML;
          GOTO      PMIX9999
.
PMIX6810  MATCH     "0",PMPXHOML
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
          ENDIF
          MATCH     "1",PMPXHOML
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ENDIF
          GOTO      PMIX9999
.
PMIX6900  WRITE     HTMLFILE;PMPXUDC1;
          GOTO      PMIX9999
.
PMIX7000  WRITE     HTMLFILE;PMPXUDC2;
          GOTO      PMIX9999
.
PMIX7100  WRITE     HTMLFILE;PMPXUDC3;
          GOTO      PMIX9999
.
PMIX7200  MOVE      "P7",CATEGORY
          MOVE      PMPXUSR7,CODE
          CALL      CODITM00
          GOTO      PMIX9999
.
PMIX7300  MOVE      "P8",CATEGORY
          MOVE      PMPXUSR8,CODE
          CALL      CODITM00
          GOTO      PMIX9999
.
PMIX7400  MOVE      "P9",CATEGORY
          MOVE      PMPXUSR9,CODE
          CALL      CODITM00
          GOTO      PMIX9999
.
PMIX7500  WRITE     HTMLFILE;PMPXMSNO;
          GOTO      PMIX9999
.
PMIX7600  MOVE      PMPXMSNA,PACSNAME     * formatted mothers name
          MOVE      PMPXMGNA,PACGNAME
          MOVE      PMPXMTLE,PACTITLE
          MOVE      ONE,PACFRMT
          CALL      PACNAME
          WRITE     HTMLFILE;PACFNAME;
          GOTO      PMIX9999
.
PMIX7700  MOVE      PMPXFSNA,PACSNAME     * formatted fathers name
          MOVE      PMPXFGNA,PACGNAME
          MOVE      PMPXFTLE,PACTITLE
          MOVE      ONE,PACFRMT
          CALL      PACNAME
          WRITE     HTMLFILE;PACFNAME;
          GOTO      PMIX9999
.
PMIX7800  CALL      PATFLD00
          WRITE     HTMLFILE;KEY3;    * Patient folder colour
          GOTO      PMIX9999
.
PMIX7900  MOVE      "FS",CATEGORY       * Folder Selection (Category FS)
          MOVE      PMPXFLDR,CODE
          CALL      CODITM00
          GOTO      PMIX9999
.
PMIX8000  WRITE     HTMLFILE;PMPXCONP;  * PRA Contact
          GOTO      PMIX9999
.
PMIX8100  PROC      CHCMN000          * Output Billing comments indicator
          GOTO      PMIX9999
.
PMIX8200  WRITE     HTMLFILE;PSEX;      * Patient Sex code              *I-49016
          GOTO      PMIX9999
.
PMIX8300  PROC      CHKALTID
          WRITE     HTMLFILE;EXIT;      * 0=No alternate ID 1=Alternate ID exist
          GOTO      PMIX9999
.
PMIX8400  PACK      GENPCODE,PMPXRHC1,SP70
          CALL      HCPDET00                * hcp details
          GOTO      PMIX9999
.
PMIX8500  MOVE      ZERO,F2
          MOVE      PMPXR1GC,F2
          PACK      KEY10,PMPXRH1G,SP70
          PACK      GPPCCODE,KEY10,F2
          CALL      HCGDET00                * hcp practice details
          GOTO      PMIX9999
.
PMIX8600  MOVE      "iw",CATEGORY       * Iwi request 
          MOVE      PMPXIWI1,CODE
          CALL      CODITM00
          GOTO      PMIX9999
.
PMIX8700  MOVE      "iw",CATEGORY       * Iwi request 
          MOVE      PMPXIWI2,CODE
          CALL      CODITM00
          GOTO      PMIX9999
.
PMIX8800  MOVE      "iw",CATEGORY       * Iwi request 
          MOVE      PMPXIWI3,CODE
          CALL      CODITM00
          GOTO      PMIX9999
.
PMIX8900  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          MATCH     SP70,PMPXIHOS
          GOTO      PMIX9999 IF EQUAL
          BRANCH    F1,PMIX8910
          WRITE     HTMLFILE;PMPXIHOS;
          GOTO      PMIX9999
.
PMIX8910  WRITE     HTMLFILE;WBSEHOSP;
          GOTO      PMIX9999
.
PMIX9000  PACK      KEY20,SP70
          PROC      GETALIDS
          WRITE     HTMLFILE;KEY20;
.
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,HUND28;*230,PTCNALTV
          MATCH     "1",PTCNALTV
          GOTO      PMIX9999 IF NOT EQUAL
.
          PACK      KEY20,SP70
          PROC      ALTVS000
          WRITE     HTMLFILE;KEY20;
.          WRITE     HTMLFILE;ADMISSNO;
.
          GOTO      PMIX9999
.
PMIX9100  PACK      KEY10,SP70
          PACK      KEY10,PMPXSIN6,PMPXSIN7,PMPXSIN8,PMPXSIN9,PMPXSN10:
                          PMPXSN11,PMPXSN12,PMPXSN13,PMPXSN14,PMPXSN15
          REP       " 0",KEY10
          WRITE     HTMLFILE;KEY10;
          GOTO      PMIX9999
.
PMIX9200  PROC      GETCURIP
          GOTO      PMIX9999
.
PMIX9300  MOVE      SIX,COPTION
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,HUND03;*215,PTCNHCLM
          MATCH     "1",PTCNHCLM
          GOTO      PMIX9999 IF NOT EQUAL
          CALL      CLAM0000          * Output Claim code
          MOVE      "CL",CATEGORY
          CALL      CODITM00
          GOTO      PMIX9999
.
PMIX9400  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,HUND03;*214,PTCNHHFT
          MATCH     "1",PTCNHHFT
          GOTO      PMIX9999 IF NOT EQUAL
          MATCH     SP70,ADMISSNO
          IF        @EQUAL
            MATCH     SP70,PFUNDH
            IF        !@EQUAL
              WRITE     HTMLFILE;PFUNDH,SLASH,PFNDTB;
            ENDIF
            GOTO      PMIX9999
          ENDIF
          PACK      KEY10,SP70
          MOVE      SEVEN,COPTION
          CALL      CLAM0000          * Output Health Fund/Table
          WRITE     HTMLFILE;KEY10;
          GOTO      PMIX9999
.
PMIX9500  PROC      CHCDM000          * CDM string
          GOTO      PMIX9999
.
PMIX9600  WRITE     HTMLFILE;PMPXPFAX;           * Fax number
          GOTO      PMIX9999
.
PMIX9700  WRITE     HTMLFILE;PMPXPFSN;
          GOTO      PMIX9999
.
PMIX9800  WRITE     HTMLFILE;PMPXPFGN;
          GOTO      PMIX9999
.
PMIX9900  UNPACK    DIM127,D1,KEY3,DIM127
          MOVE      KEY3,FLDITMNO
          CALL      PMXX0000                * additional pmspx2af fields
          GOTO      PMIX9999
.
PMIX9999  RETURN
.
.------------------------------------------------------------
. Add additional PMI Extension Field
.------------------------------------------------------------
PMXX0000  BRANCH    FLDITMNO,PMXX0100,PMXX0200,PMXX0300,PMXX0400,PMXX0500:
                             PMXX0600,PMXX0700,PMXX0800,PMXX0900,PMXX1000:
                             PMXX1100,PMXX1200,PMXX1300,PMXX1400,PMXX1500:
                             PMXX1600,PMXX1700,PMXX1800,PMXX1900,PMXX2000:
                             PMXX2100,PMXX2200,PMXX2300,PMXX2400,PMXX2500:
                             PMXX2600,PMXX2700,PMXX2800,PMXX2900,PMXX3000:
                             PMXX3100,PMXX3200,PMXX3300,PMXX3400,PMXX3500:
                             PMXX3600,PMXX3700,PMXX3800,PMXX3900,PMXX4000:
                             PMXX4100,PMXX4200,PMXX4300,PMXX4400,PMXX4500:
                             PMXX4600,PMXX4700,PMXX4800,PMXX4900,PMXX5000:
                             PMXX5100,PMXX5200,PMXX5300,PMXX5400,PMXX5500:
                             PMXX5600,PMXX5700,PMXX5800,PMXX5900,PMXX6000:
                             PMXX6100,PMXX6200,PMXX6300,PMXX6400,PMXX6500:
                             PMXX6600,PMXX6700,PMXX6800,PMXX6900,PMXX7000:
                             PMXX7100,PMXX7200,PMXX7300,PMXX7400,PMXX7500:
                             PMXX7600,PMXX7700,PMXX7800,PMXX7900,PMXX8000:
                             PMXX8100,PMXX8200,PMXX8300,PMXX8400,PMXX8500
.         
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      PMXX9999
.
PMXX0100  WRITE     HTMLFILE;PMPXFNAM;
          GOTO      PMXX9999
.
PMXX0200  WRITE     HTMLFILE;PMPXSNAM;
          GOTO      PMXX9999
.
PMXX0300  WRITE     HTMLFILE;PMPXHFGN;
          GOTO      PMXX9999
.
PMXX0400  WRITE     HTMLFILE;PMPXHFSN;
          GOTO      PMXX9999
.
PMXX0500  WRITE     HTMLFILE;PMPXFUPI;
          GOTO      PMXX9999
.
PMXX0600  PACK      GENPCODE,PMPXVGPC,SP70
          CALL      HCPDET00                * verified hcp details
          GOTO      PMXX9999
.
PMXX0700  MOVE      ZERO,F2
          MOVE      PMPXVGPG,F2
          PACK      KEY10,PMPXVGPP,SP70
          PACK      GPPCCODE,KEY10,F2
          CALL      HCGDET00                * verified hcp practice details
          GOTO      PMXX9999
.
PMXX0800  MATCH     SP70,PMPXVGPG
          GOTO      PMXX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXVGPG;
          GOTO      PMXX9999
.
PMXX0900  WRITE     HTMLFILE;PMPXSIN6;
          GOTO      PMXX9999
.
PMXX1000  WRITE     HTMLFILE;PMPXHFCN;
          GOTO      PMXX9999
.
PMXX1100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMXX1110           * 0=Desc 1=Code
.
          PACK      KEY3,PMPXLUBH,SP70
          CALL      RDPTHSP1
          BRANCH    OVRCD,PMXX9999
.
          WRITE     HTMLFILE;PTHSNAME;
          GOTO      PMXX9999
.
PMXX1110  WRITE     HTMLFILE;PMPXLUBH;
          GOTO      PMXX9999
.
PMXX1200  MOVE      "Pn",CATEGORY       * Preferred Method of Contanct (Cat Pn)
          MOVE      PMPXPMCN,CODE
          CALL      CODITM00
          GOTO      PMXX9999
.
PMXX1300  MOVE      "Pr",CATEGORY       * Preferred Method of Correspondence
          MOVE      PMPXPMCR,CODE       * (Cat Pr)
          CALL      CODITM00
          GOTO      PMXX9999
.
PMXX1400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
.
          PACK      KEY8,ADMISSNO,SP70  * %EMRWEB02.01.699.012 - HCP/Practice Fax
          CALL      RDPMVX11
          BRANCH    OVRCD,PMXX9999
.
          MATCH     "1",PMVXINGP
          GOTO      PMXX9999 IF NOT EQUAL
.
          PACK      KEY8,URNUMBER,SP70  * Read extension table to get HCP code
          CALL      RDPMPX21
          BRANCH    OVRCD,PMXX9999
.
          IF        F1=0
            PACK      KEY10,PMPXRHC1,SP70 * Read HCP table
            CALL      RDPMHCP1
            BRANCH    OVRCD,PMXX9999
.
            MOVE      PMHCTITL,FMTTITLE
            MOVE      PMHCGNAM,FMTGNAME
            MOVE      PMHCSNAM,FMTSNAME
            CALL      DOCNM000
            WRITE     HTMLFILE;DOCFNAME;
            GOTO      PMXX9999
          ENDIF
.
PMXX1401  MOVE      SP70,KEY20                    * Clear Fax Output
          MOVE      SP70,PMHCFAXN
          MOVE      SP70,PMHGPFAX
.
          PACK      KEY10,PMPXRHC1,SP70           * Get Doc Fax if it exists
          CALL      RDPMHCP1
          IF        OVRCD=0
            MATCH     "0",PMHCSTTS
            IF        @EQUAL
              MATCH     SP70,PMHCFAXN
              IF        !@EQUAL
                MOVE      PMHCFAXN,KEY20
              ENDIF
            ENDIF
          ENDIF
.
          PACK      KEY12,PMPXRH1G,PMPXR1GC,SP70  * Get Prac Fax if it exists
          CALL      RDPMHCG1
          IF        OVRCD=0
            MATCH     "0",PMHGSTTS
            IF        @EQUAL
              MATCH     SP70,PMHGPFAX
              IF        !@EQUAL
                MOVE      PMHGPFAX,KEY20
              ENDIF
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;KEY20;
.
          GOTO      PMXX9999
.
PMXX1500  PROC      VISDT000                  * Visit dates
          GOTO      PMXX9999
.
PMXX1600  MATCH     SP70,PMPXRHC1
          IF        @EQUAL
            PACK      KEY12,PMPXRH1G,PMPXR1GC,SP70
            GOTO      PMXX1602
          ENDIF
.
          PACK      KEY10,PMPXRHC1,SP70
          CALL      RDPMHCP1
          IF        OVRCD=0
            MATCH     "1",PMHCSTTS
            GOTO      PMXX9999 IF NOT EQUAL
          ENDIF
.
PMXX1601  PACK      KEY12,PMVXRH1G,PMVXRH1C   * No HCP fax: check practice
PMXX1602  CALL      RDPMHCG1
          IF        OVRCD=0
            MATCH     "1",PMHGSTTS
            GOTO      PMXX9999 IF NOT EQUAL
          ENDIF
.
          WRITE     HTMLFILE;"1";             * Inactive HCP & Practice
          GOTO      PMXX9999
.
PMXX1700  UNPACK    DIM127,D1,KEY1,DIM127     * Consent for Relase of Info HCP 1
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMXX1710
          WRITE     HTMLFILE;PMPXCRN1;
          GOTO      PMXX9999
.
PMXX1710  MATCH     "1",PMPXCRN1
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            MATCH     "0",PMPXCRN1 
            IF        @EQUAL
              WRITE     HTMLFILE;"No";
            ENDIF
          ENDIF
          GOTO      PMXX9999
.
PMXX1800  UNPACK    DIM127,D1,KEY1,DIM127     * Consent for Relase of Info HCP 2
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMXX1810
          WRITE     HTMLFILE;PMPXCRN2;
          GOTO      PMXX9999
.
PMXX1810  MATCH     "1",PMPXCRN2
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            MATCH     "0",PMPXCRN2
            IF        @EQUAL
              WRITE     HTMLFILE;"No";
            ENDIF
          ENDIF
          GOTO      PMXX9999
.
PMXX1900  UNPACK    DIM127,D1,KEY1,DIM127     * Consent for Relase of Info HCP 3
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMXX1910
          WRITE     HTMLFILE;PMPXCRN3;
          GOTO      PMXX9999
.
PMXX1910  MATCH     "1",PMPXCRN3
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      PMXX9999
.
PMXX2000  UNPACK    DIM127,D1,KEY1,DIM127     * Consent for Relase of Info HCP 4
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMXX2010
          WRITE     HTMLFILE;PMPXCRN4;
          GOTO      PMXX9999
.
PMXX2010  MATCH     "1",PMPXCRN4
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      PMXX9999
.
PMXX2100  UNPACK    DIM127,D1,KEY1,DIM127     * Consent for Relase of Info HCP 5
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMXX2110
          WRITE     HTMLFILE;PMPXCRN5;
          GOTO      PMXX9999
.
PMXX2110  MATCH     "1",PMPXCRN5  
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      PMXX9999
.
PMXX2200  PACK      GENPCODE,PTMAHCP1,SP70
          CALL      HCPDET00                * hcp details
          GOTO      PMIX9999
.
PMXX2300  MOVE      ZERO,F2
          MOVE      PTMAHCG1,F2
          PACK      KEY10,PTMAHCL1,SP70
          PACK      GPPCCODE,KEY10,F2
          CALL      HCGDET00                * hcp practice details
          GOTO      PMIX9999
.
PMXX2400  MATCH     SP70,PTMAHCG1
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PTMAHCG1;
          GOTO      PMIX9999
.
PMXX2500  PACK      GENPCODE,PTMAHCP2,SP70
          CALL      HCPDET00                * hcp details
          GOTO      PMIX9999
.
PMXX2600  MOVE      ZERO,F2
          MOVE      PTMAHCG2,F2
          PACK      KEY10,PTMAHCL2,SP70
          PACK      GPPCCODE,KEY10,F2
          CALL      HCGDET00                * hcp practice details
          GOTO      PMIX9999
.
PMXX2700  MATCH     SP70,PTMAHCG2
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PTMAHCG2;
          GOTO      PMIX9999
.
PMXX2800  PACK      GENPCODE,PTMAHCP3,SP70
          CALL      HCPDET00                * hcp details
          GOTO      PMIX9999
.
PMXX2900  MOVE      ZERO,F2
          MOVE      PTMAHCG3,F2
          PACK      KEY10,PTMAHCL3,SP70
          PACK      GPPCCODE,KEY10,F2
          CALL      HCGDET00                * hcp practice details
          GOTO      PMIX9999
.
PMXX3000  MATCH     SP70,PTMAHCG3
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PTMAHCG3;
          GOTO      PMIX9999
.
PMXX3100  PACK      GENPCODE,PTMAHCP4,SP70
          CALL      HCPDET00                * hcp details
          GOTO      PMIX9999
.
PMXX3200  MOVE      ZERO,F2
          MOVE      PTMAHCG4,F2
          PACK      KEY10,PTMAHCL4,SP70
          PACK      GPPCCODE,KEY10,F2
          CALL      HCGDET00                * hcp practice details
          GOTO      PMIX9999
.
PMXX3300  MATCH     SP70,PTMAHCG4
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PTMAHCG4;
          GOTO      PMIX9999
.
PMXX3400  PACK      GENPCODE,PTMAHCP5,SP70
          CALL      HCPDET00                * hcp details
          GOTO      PMIX9999
.
PMXX3500  MOVE      ZERO,F2
          MOVE      PTMAHCG5,F2
          PACK      KEY10,PTMAHCL5,SP70
          PACK      GPPCCODE,KEY10,F2
          CALL      HCGDET00                * hcp practice details
          GOTO      PMIX9999
.
PMXX3600  MATCH     SP70,PTMAHCG5
          GOTO      PMIX9999 IF EQUAL
          WRITE     HTMLFILE;PTMAHCG5;
          GOTO      PMIX9999
.
PMXX3700  UNPACK    DIM127,D1,KEY1,DIM127     * Opt out of SMS
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMXX3710
          WRITE     HTMLFILE;PMPXOSMS;
          GOTO      PMXX9999
.
PMXX3710  MATCH     "1",PMPXOSMS
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      PMXX9999
.
PMXX3800  PROC      CHKBMIIN
          WRITE     HTMLFILE;D5;
          GOTO      PMXX9999
.
PMXX3900  UNPACK    DIM127,D1,KEY1,DIM127     * PCEHR Consent
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMXX3910
          WRITE     HTMLFILE;PMPXSN10;
          GOTO      PMXX9999
.
PMXX3910  MATCH     "3",PMPXSN10
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            MATCH     "2",PMPXSN10
            IF        @EQUAL
              WRITE     HTMLFILE;"No";
            ENDIF 
          ENDIF
          GOTO      PMXX9999
.
PMXX4000  MOVE      "tc",CATEGORY       * Usual PRFA (Cat tc)
          MOVE      PMPXUPRF,CODE
          CALL      CODITM00
          GOTO      PMXX9999
.
PMXX4100  UNPACK    DIM127,D1,KEY1,DIM127     * PMPXAUF1
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMXX4110
.
          WRITE     HTMLFILE;PMPXAUF1;
          GOTO      PMXX9999
.
PMXX4110  MATCH     SP70,PMPXAUF1
          GOTO      PMXX9999 IF EQUAL
.
          MATCH     "1",PMPXAUF1
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      PMXX9999
.
PMXX4200  UNPACK    DIM127,D1,KEY1,DIM127     * PMPXAUF2
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMXX4210
.
          WRITE     HTMLFILE;PMPXAUF2;
          GOTO      PMXX9999
.
PMXX4210  MATCH     SP70,PMPXAUF2
          GOTO      PMXX9999 IF EQUAL
.
          MATCH     "1",PMPXAUF2
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      PMXX9999
.
PMXX4300  UNPACK    DIM127,D1,KEY1,DIM127     * PMPXAUF3
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMXX4310
.
          WRITE     HTMLFILE;PMPXAUF3;
          GOTO      PMXX9999
.
PMXX4310  MATCH     SP70,PMPXAUF3
          GOTO      PMXX9999 IF EQUAL
.
          MATCH     "1",PMPXAUF3
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      PMXX9999
.
PMXX4400  UNPACK    DIM127,D1,KEY1,DIM127     * PMPXAUF4
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMXX4410
.
          WRITE     HTMLFILE;PMPXAUF4;
          GOTO      PMXX9999
.
PMXX4410  MATCH     SP70,PMPXAUF4
          GOTO      PMXX9999 IF EQUAL
.
          MATCH     "1",PMPXAUF4
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      PMXX9999
.
PMXX4500  UNPACK    DIM127,D1,KEY1,DIM127     * PMPXAUF5
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMXX4510
.
          WRITE     HTMLFILE;PMPXAUF5;
          GOTO      PMXX9999
.
PMXX4510  MATCH     SP70,PMPXAUF5
          GOTO      PMXX9999 IF EQUAL
.
          MATCH     "1",PMPXAUF5
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      PMXX9999
.
PMXX4600  WRITE     HTMLFILE;PMPXSN16;
          GOTO      PMXX9999
.
PMXX4700  WRITE     HTMLFILE;PMPXSN17;
          GOTO      PMXX9999
.
PMXX4800  WRITE     HTMLFILE;PMPXSN18;
          GOTO      PMXX9999
.
PMXX4900  WRITE     HTMLFILE;PMPXSN19;
          GOTO      PMXX9999
.
PMXX5000  WRITE     HTMLFILE;PMPXSN20;
          GOTO      PMXX9999
.
PMXX5100  WRITE     HTMLFILE;PMPXSN21;
          GOTO      PMXX9999
.
PMXX5200  WRITE     HTMLFILE;PMPXSN22;
          GOTO      PMXX9999
.
PMXX5300  WRITE     HTMLFILE;PMPXSN23;
          GOTO      PMXX9999
.
PMXX5400  WRITE     HTMLFILE;PMPXSN24;
          GOTO      PMXX9999
.
PMXX5500  WRITE     HTMLFILE;PMPXSN25;
          GOTO      PMXX9999
.
PMXX5600  WRITE     HTMLFILE;PMPXSN26;
          GOTO      PMXX9999
.
PMXX5700  WRITE     HTMLFILE;PMPXSN27;
          GOTO      PMXX9999
.
PMXX5800  WRITE     HTMLFILE;PMPXSN28;
          GOTO      PMXX9999
.
PMXX5900  WRITE     HTMLFILE;PMPXSN29;
          GOTO      PMXX9999
.
PMXX6000  WRITE     HTMLFILE;PMPXSN30;
          GOTO      PMXX9999
.
PMXX6100  MOVE      "G ",CATEGORY       * Gender/Sex Category G
          PACK      CODE,PSEX,SP70
          CALL      CODITM00
          GOTO      PMXX9999
.
PMXX6200  PACK      KEY19,URNUMBER,SP70
          CALL      RSPMCCD1
PMXX6220  CALL      RKPMCCD1
          BRANCH    OVRCD,PMXX6280
.
          MATCH     URNUMBER,PMCDURNO
          GOTO      PMXX6280 IF NOT EQUAL
.
          MOVE      "ct",KEY2 
          PACK      KEY5,KEY2,PMCDCTYP,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,PMXX6280
.
          MATCH     "7",TCINDC1
          GOTO      PMXX6220 IF NOT EQUAL
.
          WRITE     HTMLFILE;PMCDCNUM; 
          GOTO      PMXX6290 
.
PMXX6280  WRITE     HTMLFILE;"";
.
PMXX6290  GOTO      PMXX9999
.
PMXX6300  MOVE      "Gi",CATEGORY       * Identifying Gender
          MOVE      PMPXUCC4,CODE
          CALL      CODITM00
          GOTO      PMXX9999
.
PMXX6400  MOVE      "Gp",CATEGORY       * Identifying Pronoun
          MOVE      PMPXUCC5,CODE
          CALL      CODITM00
          GOTO      PMXX9999
.
PMXX6500  STRIP     PMPXATF1
          WRITE     HTMLFILE;*+,PMPXATF1;  * Identifying Gender Free Text
          GOTO      PMXX9999
.
PMXX6600  STRIP     PMPXATF2
          WRITE     HTMLFILE;*+,PMPXATF2;  * Identifying Pronoun Free Text
          GOTO      PMXX9999
.
PMXX6700  MATCH     SP70,PSEX
          IF        @EQUAL
            WRITE    HTMLFILE;"";
          ELSE 
            MOVE      "G ",KEY2
            PACK      KEY5,KEY2,PSEX,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              WRITE    HTMLFILE;TCINDC11; 
            ELSE
              WRITE    HTMLFILE;"";
            ENDIF
          ENDIF 
          GOTO      PMXX9999
.
PMXX6800  MATCH     SP70,PSEX
          IF        @EQUAL
            WRITE    HTMLFILE;"";
          ELSE
            MOVE      "G ",KEY2
            PACK      KEY5,KEY2,PSEX,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              WRITE    HTMLFILE;TCINDC12;
            ELSE
              WRITE    HTMLFILE;"";
            ENDIF
          ENDIF
          GOTO      PMXX9999
.
PMXX6900  MATCH     SP70,PMPXUCC4
          IF        @EQUAL
            WRITE    HTMLFILE;"";
          ELSE
            MOVE      "Gi",KEY2
            PACK      KEY5,KEY2,PMPXUCC4,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              WRITE    HTMLFILE;TCINDC1;
            ELSE
              WRITE    HTMLFILE;"";
            ENDIF
          ENDIF
          GOTO      PMXX9999
.
PMXX7000  MATCH     SP70,PMPXUCC5
          IF        @EQUAL
            WRITE    HTMLFILE;"";
          ELSE
            MOVE      "Gp",KEY2
            PACK      KEY5,KEY2,PMPXUCC5,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              WRITE    HTMLFILE;TCINDC1;
            ELSE
              WRITE    HTMLFILE;"";
            ENDIF
          ENDIF
          GOTO      PMXX9999
.
PMXX7100  MATCH     PMPXUDT1,SP70
          GOTO      PMXX9999 IF EQUAL
          UNPACK    PMPXUDT1,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      PMXX9999
.
PMXX7200  MATCH     PMPXUTM1,SP70
          GOTO      PMXX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXUTM1;
          GOTO      PMXX9999
.
PMXX7300  MATCH     PMPXUDT2,SP70
          GOTO      PMXX9999 IF EQUAL
          UNPACK    PMPXUDT2,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      PMXX9999
.
PMXX7400  MATCH     PMPXUTM2,SP70
          GOTO      PMXX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXUTM2;
          GOTO      PMXX9999
.
PMXX7500  MATCH     PMPXUDT3,SP70
          GOTO      PMXX9999 IF EQUAL
          UNPACK    PMPXUDT3,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      PMXX9999
.
PMXX7600  MATCH     PMPXUTM3,SP70
          GOTO      PMXX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXUTM3;
          GOTO      PMXX9999
.
PMXX7700  MATCH     PMPXUDT4,SP70
          GOTO      PMXX9999 IF EQUAL
          UNPACK    PMPXUDT4,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      PMXX9999
.
PMXX7800  MATCH     PMPXUTM4,SP70
          GOTO      PMXX9999 IF EQUAL
          WRITE     HTMLFILE;PMPXUTM4;
          GOTO      PMXX9999
.
PMXX7900  MATCH     PMPXUDT5,SP70
          GOTO      PMXX9999 IF EQUAL
          UNPACK    PMPXUDT5,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      PMXX9999
.
PMXX8000  MATCH     PMPXUTM5,SP70
          IF        @EQUAL
            WRITE     HTMLFILE;"No details recorded";
          ELSE
            WRITE     HTMLFILE;PMPXUTM5;           * Time of Birth (hh:mm:ss)
          ENDIF
          GOTO      PMXX9999
.
PMXX8100  CALL      PATNAL00
          WRITE     HTMLFILE;PATFNAME;
          GOTO      PMXX9999
.
PMXX8200  MOVE      "EN",CATEGORY       
          MOVE      PMPXETH1,CODE                * Ethnicity 1
          CALL      CODITM00
          GOTO      PMXX9999
.
PMXX8300  MOVE      "EN",CATEGORY
          MOVE      PMPXETH2,CODE                * Ethnicity 2
          CALL      CODITM00
          GOTO      PMXX9999
.
PMXX8400  MOVE      "l1",CATEGORY
          MOVE      PMPXLAN1,CODE                * Main Language Spoken 1
          CALL      CODITM00
          GOTO      PMXX9999
.
PMXX8500  MOVE      "l1",CATEGORY
          MOVE      PMPXLAN2,CODE                * Main Language Spoken 2
          CALL      CODITM00
          GOTO      PMXX9999
.
PMXX9999  RETURN
.
.------------------------------------------------------------
. Determine Patient Folder String
.   Returns  - KEY3  - Bit Mask of Repat, Patient Type, Privacy
.   Requires - Valid Read on Master & Extension Files
.------------------------------------------------------------
PATFLD00  CLEAR     KEY3
          MATCH     SP70,PMPXFLDR
          IF        @EQUAL
            APPEND    ZERO,KEY3           * Not DVA Patient
            GOTO      PATFLD05
          ENDIF
.       
          PACK      KEY5,ANSF,ANSS,PMPXFLDR,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,PATFLD04
.
          APPEND    TCINDC1,KEY3
          GOTO      PATFLD05
.
PATFLD04  APPEND    ZERO,KEY3            * Invalid cat code 
.
PATFLD05  MATCH     SP70,PTYPE
          GOTO      PATFLD10 IF EQUAL
.
          MOVE      "T ",KEY2
          PACK      KEY5,KEY2,PTYPE,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,PATFLD10
          APPEND    TCINDC1,KEY3
          GOTO      PATFLD20
.
PATFLD10  APPEND    ZERO,KEY3
PATFLD20  MATCH     SP70,PMPXPRVI
          GOTO      PATFLD30 IF EQUAL
.
          PACK      KEY5,ANSP,ANSV,PMPXPRVI
          CALL      RDCODE1
          BRANCH    OVRCD,PATFLD30
          APPEND    TCINDC1,KEY3
          GOTO      PATFLD40
.
PATFLD30  APPEND    ZERO,KEY3
PATFLD40  RESET     KEY3
          REP       " 0",KEY3
          RETURN
.------------------------------------------------------------
.   Set Parameters for PMI Extension file
.------------------------------------------------------------
SVPMI000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SVPMI010,SVPMI020,SVPMI030,SVPMI040,SVPMI050:
                       SVPMI060,SVPMI070,SVPMI080,SVPMI090,SVPMI100:
                       SVPMI110,SVPMI120,SVPMI130,SVPMI140,SVPMI150:
                       SVPMI160,SVPMI170,SVPMI180,SVPMI190,SVPMI200:
                       SVPMI210,SVPMI220,SVPMI230,SVPMI240,SVPMI250:
                       SVPMI260,SVPMI270,SVPMI280,SVPMI290,SVPMI300:
                       SVPMI310,SVPMI320,SVPMI330,SVPMI340,SVPMI350:
                       SVPMI360,SVPMI370,SVPMI380,SVPMI390,SVPMI400:
                       SVPMI410,SVPMI420,SVPMI430,SVPMI440,SVPMI450:
                       SVPMI460,SVPMI470,SVPMI480,SVPMI490,SVPMI500:
                       SVPMI510,SVPMI520,SVPMI530,SVPMI540,SVPMI550:
                       SVPMI560,SVPMI570,SVPMI580,SVPMI590,SVPMI600:
                       SVPMI610,SVPMI620,SVPMI630,SVPMI640,SVPMI650:
                       SVPMI660,SVPMI670,SVPMI680,SVPMI690,SVPMI700:
                       SVPMI710,SVPMI720,SVPMI730,SVPMI740,SVPMI750:
                       SVPMI760,SVPMI770,SVPMI780,SVPMI790,SVPMI800:
                       SVPMI810,SVPMI820,SVPMI830,SVPMI840,SVPMI850:
                       SVPMI860,SVPMI870,SVPMI880,SVPMI890,SVPMI900:
                       SVPMI910,SVPMI920,SVPMI930,SVPMI940,SVPMI950:
                       SVPMI960,SVPMI970,SVPMI980,SVPMI990,SVPM1000:
                       SVPM1010,SVPM1020,SVPM1030,SVPM1040,SVPM1050:
                       SVPM1060,SVPM1070,SVPM1080,SVPM1090,SVPM1100:
                       SVPM1110,SVPM1120,SVPM1130,SVPM1140,SVPM1150:
                       SVPM1160,SVPM1170,SVPM1180,SVPM1190,SVPM1200:
                       SVPM1210,SVPM1220,SVPM1230,SVPM1240,SVPM1250:
                       SVPM1260,SVPM1270,SVPM1280,SVPM1290,SVPM1300:
                       SVPM1310,SVPM1320,SVPM1330,SVPM1340,SVPM1350:
                       SVPM1360,SVPM1370,SVPM1380,SVPM1390,SVPM1400:
                       SVPM1410,SVPM1420
.                      
          MOVE      ONE,EXIT
          GOTO      SVPMI999
.
SVPMI010  PACK      PMPXI001,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPMI020  PACK      PMPXI002,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPMI030  PACK      PMPXI003,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPMI040  PACK      PMPXI004,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPMI050  MOVE      QRYDATA,PMPXI005
          GOTO      SVPMI999
.
SVPMI060  MOVE      QRYDATA,PMPXI006
          GOTO      SVPMI999
.
SVPMI070  MOVE      QRYDATA,PMPXI007
          GOTO      SVPMI999
.
SVPMI080  MOVE      QRYDATA,PMPXI008
          GOTO      SVPMI999
.
SVPMI090  MOVE      QRYDATA,PMPXI009
          GOTO      SVPMI999
.
SVPMI100  MOVE      QRYDATA,PMPXI010
          GOTO      SVPMI999
.
SVPMI110  MOVE      QRYDATA,PMPXI011
          GOTO      SVPMI999
.
SVPMI120  MOVE      QRYDATA,PMPXI012
          GOTO      SVPMI999
.
SVPMI130  MOVE      QRYDATA,PMPXI013
          GOTO      SVPMI999
.
SVPMI140  MOVE      QRYDATA,PMPXI014
          GOTO      SVPMI999
.
SVPMI150  MOVE      QRYDATA,PMPXI015
          GOTO      SVPMI999
.
SVPMI160  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMPXI016,CCENT,CYEAR,CMON,CDAY
          GOTO      SVPMI999
.
SVPMI170  MOVE      QRYDATA,PMPXI017
          GOTO      SVPMI999
.
SVPMI180  MOVE      QRYDATA,PMPXI018
          GOTO      SVPMI999
.
SVPMI190  MOVE      QRYDATA,PMPXI019
          GOTO      SVPMI999
.
SVPMI200  MOVE      QRYDATA,PMPXI020
          GOTO      SVPMI999
.
SVPMI210  MOVE      QRYDATA,PMPXI021
          GOTO      SVPMI999
.
SVPMI220  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMPXI022,CCENT,CYEAR,CMON,CDAY
          GOTO      SVPMI999
.
SVPMI230  MOVE      QRYDATA,PMPXI023
          GOTO      SVPMI999
.
SVPMI240  MOVE      QRYDATA,PMPXI024
          GOTO      SVPMI999
.
SVPMI250  MOVE      QRYDATA,PMPXI025
          GOTO      SVPMI999
.
SVPMI260  MOVE      QRYDATA,PMPXI026
          GOTO      SVPMI999
.
SVPMI270  MOVE      QRYDATA,PMPXI027
          GOTO      SVPMI999
.
SVPMI280  MOVE      QRYDATA,PMPXI028
          GOTO      SVPMI999
.
SVPMI290  MOVE      QRYDATA,PMPXI029
          GOTO      SVPMI999
.
SVPMI300  MOVE      QRYDATA,PMPXI030
          GOTO      SVPMI999
.
SVPMI310  MOVE      QRYDATA,PMPXI031
          GOTO      SVPMI999
.
SVPMI320  MOVE      QRYDATA,PMPXI032
          GOTO      SVPMI999
.
SVPMI330  MOVE      QRYDATA,PMPXI033
          GOTO      SVPMI999
.
SVPMI340  MOVE      QRYDATA,PMPXI034
          GOTO      SVPMI999
.
SVPMI350  MOVE      QRYDATA,PMPXI035
          GOTO      SVPMI999
.
SVPMI360  MOVE      QRYDATA,PMPXI036
          GOTO      SVPMI999
.
SVPMI370  MOVE      QRYDATA,PMPXI037
          GOTO      SVPMI999
.
SVPMI380  MOVE      QRYDATA,PMPXI038
          GOTO      SVPMI999
.
SVPMI390  MOVE      QRYDATA,PMPXI039
          GOTO      SVPMI999
.
SVPMI400  MOVE      QRYDATA,PMPXI040
          GOTO      SVPMI999
.
SVPMI410  MOVE      QRYDATA,PMPXI041
          GOTO      SVPMI999
.
SVPMI420  MOVE      QRYDATA,PMPXI042
          GOTO      SVPMI999
.
SVPMI430  MOVE      QRYDATA,PMPXI043
          GOTO      SVPMI999
.
SVPMI440  MOVE      QRYDATA,PMPXI044
          GOTO      SVPMI999
.
SVPMI450  MOVE      QRYDATA,PMPXI045
          GOTO      SVPMI999
.
SVPMI460  MOVE      QRYDATA,PMPXI046
          GOTO      SVPMI999
.
SVPMI470  MOVE      QRYDATA,PMPXI047
          GOTO      SVPMI999
.
SVPMI480  MOVE      QRYDATA,PMPXI048
          GOTO      SVPMI999
.
SVPMI490  MOVE      QRYDATA,PMPXI049
          GOTO      SVPMI999
.
SVPMI500  MOVE      QRYDATA,PMPXI050
          GOTO      SVPMI999
.
SVPMI510  MOVE      QRYDATA,PMPXI051
          GOTO      SVPMI999
.
SVPMI520  MOVE      QRYDATA,PMPXI052
          GOTO      SVPMI999
.
SVPMI530  MOVE      QRYDATA,PMPXI053
          GOTO      SVPMI999
.
SVPMI540  MOVE      QRYDATA,PMPXI054
          GOTO      SVPMI999
.
SVPMI550  MOVE      QRYDATA,PMPXI055
          GOTO      SVPMI999
.
SVPMI560  MOVE      QRYDATA,PMPXI056
          GOTO      SVPMI999
.
SVPMI570  MOVE      QRYDATA,PMPXI057
          GOTO      SVPMI999
.
SVPMI580  MOVE      QRYDATA,PMPXI058
          GOTO      SVPMI999
.
SVPMI590  MOVE      QRYDATA,PMPXI059
          GOTO      SVPMI999
.
SVPMI600  MOVE      QRYDATA,PMPXI060
          GOTO      SVPMI999
.
SVPMI610  MOVE      QRYDATA,PMPXI061
          GOTO      SVPMI999
.
SVPMI620  MOVE      QRYDATA,PMPXI062
          GOTO      SVPMI999
.
SVPMI630  MOVE      QRYDATA,PMPXI063
          GOTO      SVPMI999
.
SVPMI640  MOVE      QRYDATA,PMPXI064
          GOTO      SVPMI999
.
SVPMI650  MOVE      QRYDATA,PMPXI065
          GOTO      SVPMI999
.
SVPMI660  MOVE      QRYDATA,PMPXI066
          GOTO      SVPMI999
.
SVPMI670  MOVE      QRYDATA,PMPXI067
          GOTO      SVPMI999
.
SVPMI680  MOVE      QRYDATA,PMPXI068
          GOTO      SVPMI999
.
SVPMI690  MOVE      QRYDATA,PMPXI069
          GOTO      SVPMI999
.
SVPMI700  MOVE      QRYDATA,PMPXI070
          GOTO      SVPMI999
.
SVPMI710  MOVE      QRYDATA,PMPXI071
          GOTO      SVPMI999
.
SVPMI720  MOVE      QRYDATA,PMPXI072
          GOTO      SVPMI999
.
SVPMI730  MOVE      QRYDATA,PMPXI073
          GOTO      SVPMI999
.
SVPMI740  MOVE      QRYDATA,PMPXI074
          GOTO      SVPMI999
.
SVPMI750  MOVE      QRYDATA,PMPXI075
          GOTO      SVPMI999
.
SVPMI760  MOVE      QRYDATA,PMPXI076
          GOTO      SVPMI999
.
SVPMI770  MOVE      QRYDATA,PMPXI077
          GOTO      SVPMI999
.
SVPMI780  MOVE      QRYDATA,PMPXI078
          GOTO      SVPMI999
.
SVPMI790  MOVE      QRYDATA,PMPXI079
          GOTO      SVPMI999
.
SVPMI800  MOVE      QRYDATA,PMPXI080
          GOTO      SVPMI999
.
SVPMI810  MOVE      QRYDATA,PMPXI081
          GOTO      SVPMI999
.
SVPMI820  MOVE      QRYDATA,PMPXI082
          GOTO      SVPMI999
.
SVPMI830  MOVE      QRYDATA,PMPXI083
          GOTO      SVPMI999
.
SVPMI840  PACK      PMPXI084,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPMI850  PACK      PMPXI085,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPMI860  MOVE      QRYDATA,PMPXI086
          GOTO      SVPMI999
.
SVPMI870  MOVE      QRYDATA,PMPXI087
          GOTO      SVPMI999
.
SVPMI880  MOVE      QRYDATA,PMPXI088
          GOTO      SVPMI999
.
SVPMI890  MOVE      QRYDATA,PMPXI089
          GOTO      SVPMI999
.
SVPMI900  MOVE      QRYDATA,PMPXI090
          GOTO      SVPMI999
.
SVPMI910  MOVE      QRYDATA,PMPXI091
          GOTO      SVPMI999
.
SVPMI920  MOVE      QRYDATA,PMPXI092
          GOTO      SVPMI999
.
SVPMI930  MOVE      QRYDATA,PMPXI093
          GOTO      SVPMI999
.
SVPMI940  MOVE      QRYDATA,PMPXI094
          GOTO      SVPMI999
.
SVPMI950  PACK      PMPXI095,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPMI960  PACK      PMPXI096,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPMI970  PACK      PMPXI097,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPMI980  PACK      PMPXI098,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPMI990  PACK      PMPXI099,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1000  PACK      PMPXI100,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1010  PACK      PMPXI101,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1020  PACK      PMPXI102,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1030  PACK      PMPXI103,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1040  PACK      PMPXI104,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1050  PACK      PMPXI105,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1060  PACK      PMPXI106,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1070  PACK      PMPXI107,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1080  PACK      PMPXI108,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1090  PACK      PMPXI109,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1100  PACK      PMPXI110,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1110  PACK      PMPXI111,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1120  PACK      PMPXI112,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1130  PACK      PMPXI113,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1140  PACK      PMPXI114,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1150  PACK      PMPXI115,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1160  PACK      PMPXI116,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1170  PACK      PMPXI117,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1180  PACK      PMPXI118,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1190  PACK      PMPXI119,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1200  PACK      PMPXI120,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1210  PACK      PMPXI121,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1220  PACK      PMPXI122,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1230  PACK      PMPXI123,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1240  PACK      PMPXI124,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1250  PACK      PMPXI125,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1260  PACK      PMPXI126,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1270  PACK      PMPXI127,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1280  PACK      PMPXI128,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1290  PACK      PMPXI129,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1300  PACK      PMPXI130,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1310  PACK      PMPXI131,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1320  PACK      PMPXI132,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1330  PACK      PMPXI133,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1340  PACK      PMPXI134,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1350  PACK      PMPXI135,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1360  PACK      PMPXI136,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1370  PACK      PMPXI137,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1380  PACK      PMPXI138,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1390  PACK      PMPXI139,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1400  PACK      PMPXI140,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1410  PACK      PMPXI141,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPM1420  PACK      PMPXI142,QRYDATA,SP70
          GOTO      SVPMI999
.
SVPMI999  RETURN
.
.------------------------------------------------------------
.   Clear Parameters for PMI Extension file
.------------------------------------------------------------
CVPMI000  MOVE      Z70,PMPXI001
          MOVE      Z70,PMPXI002
          MOVE      Z70,PMPXI003
          MOVE      Z70,PMPXI004 
          PACK      PMPXI005,Z70,Z70
          MOVE      Z70,PMPXI006
          MOVE      Z70,PMPXI007
          PACK      PMPXI008,Z70,Z70
          MOVE      Z70,PMPXI009
          MOVE      Z70,PMPXI010
          PACK      PMPXI011,Z70,Z70
          MOVE      Z70,PMPXI012
          MOVE      Z70,PMPXI013
          PACK      PMPXI014,Z70,Z70
          MOVE      Z70,PMPXI015
          MOVE      Z70,PMPXI016
          MOVE      Z70,PMPXI017
          MOVE      Z70,PMPXI018
          MOVE      Z70,PMPXI019
          MOVE      Z70,PMPXI020
          MOVE      Z70,PMPXI021
          MOVE      Z70,PMPXI022
          MOVE      Z70,PMPXI023
          MOVE      Z70,PMPXI024
          MOVE      Z70,PMPXI025
          MOVE      Z70,PMPXI026
          MOVE      Z70,PMPXI027
          MOVE      Z70,PMPXI028
          MOVE      Z70,PMPXI029
          MOVE      Z70,PMPXI030
          MOVE      Z70,PMPXI031
          MOVE      Z70,PMPXI032
          MOVE      Z70,PMPXI033
          PACK      PMPXI034,Z70,Z70
          MOVE      Z70,PMPXI035
          MOVE      Z70,PMPXI036
          MOVE      Z70,PMPXI037
          MOVE      Z70,PMPXI038
          MOVE      Z70,PMPXI039
          MOVE      Z70,PMPXI040
          MOVE      Z70,PMPXI041
          MOVE      Z70,PMPXI042
          MOVE      Z70,PMPXI043
          MOVE      Z70,PMPXI044
          MOVE      Z70,PMPXI045
          MOVE      Z70,PMPXI046
          MOVE      Z70,PMPXI047
          MOVE      Z70,PMPXI048
          MOVE      Z70,PMPXI049
          PACK      PMPXI050,Z70,Z70
          MOVE      Z70,PMPXI051
          MOVE      Z70,PMPXI052
          MOVE      Z70,PMPXI053
          MOVE      Z70,PMPXI054
          MOVE      Z70,PMPXI055
          MOVE      Z70,PMPXI056
          MOVE      Z70,PMPXI057
          MOVE      Z70,PMPXI058
          MOVE      Z70,PMPXI059
          MOVE      Z70,PMPXI060
          MOVE      Z70,PMPXI061
          MOVE      Z70,PMPXI062
          MOVE      Z70,PMPXI063
          MOVE      Z70,PMPXI064
          MOVE      Z70,PMPXI065
          MOVE      Z70,PMPXI066
          MOVE      Z70,PMPXI067
          MOVE      Z70,PMPXI068
          MOVE      Z70,PMPXI069
          MOVE      Z70,PMPXI070
          MOVE      Z70,PMPXI071
          MOVE      Z70,PMPXI072
          MOVE      Z70,PMPXI073
          MOVE      Z70,PMPXI074
          MOVE      Z70,PMPXI075
          MOVE      Z70,PMPXI076
          MOVE      Z70,PMPXI077
          MOVE      Z70,PMPXI078
          MOVE      Z70,PMPXI079
          MOVE      Z70,PMPXI080
          MOVE      Z70,PMPXI081
          MOVE      Z70,PMPXI082
          MOVE      Z70,PMPXI083
          MOVE      Z70,PMPXI084
          MOVE      Z70,PMPXI085
          MOVE      Z70,PMPXI086
          MOVE      Z70,PMPXI087
          MOVE      Z70,PMPXI088
          MOVE      Z70,PMPXI089
          MOVE      Z70,PMPXI090
          MOVE      Z70,PMPXI091
          MOVE      Z70,PMPXI092
          MOVE      Z70,PMPXI093
          MOVE      Z70,PMPXI094
          MOVE      Z70,PMPXI095
          MOVE      Z70,PMPXI096
          MOVE      Z70,PMPXI097
          MOVE      Z70,PMPXI098
          MOVE      Z70,PMPXI099
          MOVE      Z70,PMPXI100
          MOVE      Z70,PMPXI101
          MOVE      Z70,PMPXI102
          MOVE      Z70,PMPXI103
          MOVE      Z70,PMPXI104
          MOVE      Z70,PMPXI105
          MOVE      Z70,PMPXI106
          MOVE      Z70,PMPXI107
          MOVE      Z70,PMPXI108
          MOVE      Z70,PMPXI109
          MOVE      Z70,PMPXI110
          MOVE      Z70,PMPXI111
          MOVE      Z70,PMPXI112
          MOVE      Z70,PMPXI113
          MOVE      Z70,PMPXI114
          MOVE      Z70,PMPXI115
          MOVE      Z70,PMPXI116
          MOVE      Z70,PMPXI117
          MOVE      Z70,PMPXI118
          MOVE      Z70,PMPXI119
          MOVE      Z70,PMPXI120
          MOVE      Z70,PMPXI121
          MOVE      Z70,PMPXI122
          MOVE      Z70,PMPXI123
          MOVE      Z70,PMPXI124
          MOVE      Z70,PMPXI125
          MOVE      Z70,PMPXI126
          MOVE      Z70,PMPXI127
          MOVE      Z70,PMPXI128
          MOVE      Z70,PMPXI129
          MOVE      Z70,PMPXI130
          MOVE      Z70,PMPXI131
          MOVE      Z70,PMPXI132
          MOVE      Z70,PMPXI133
          MOVE      Z70,PMPXI134
          MOVE      Z70,PMPXI135
          MOVE      Z70,PMPXI136
          MOVE      Z70,PMPXI137
          MOVE      Z70,PMPXI138
          MOVE      Z70,PMPXI139
          MOVE      Z70,PMPXI140
          MOVE      Z70,PMPXI141
          MOVE      Z70,PMPXI142
.
          RETURN
.
.------------------------------------------------------------
.  Update PMI Extension file
.------------------------------------------------------------
UPVPMI00  MATCH     PMPXI001,Z70  
          IF        !@EQUAL
            MOVE       PMPXI001,PMPXINTR
          ENDIF
.
          MATCH     PMPXI002,Z70
          IF        !@EQUAL
            MOVE      PMPXI002,PMPXLNG1
          ENDIF
.
          MATCH     PMPXI003,Z70
          IF        !@EQUAL
            MOVE      PMPXI003,PMPXLNG2
          ENDIF
.
          MATCH     PMPXI004,Z70
          IF        !@EQUAL
            MOVE      PMPXI004,PMPXLNG3
          ENDIF
.
          MATCH     PMPXI005,Z70
          IF        !@EQUAL
            MOVE      PMPXI005,PMPXPEML
          ENDIF
.
          MATCH     PMPXI006,Z70   
          IF        !@EQUAL
            MOVE      PMPXI006,PMPXEDOB
          ENDIF
.
          MATCH     PMPXI007,Z70
          IF        !@EQUAL
            MOVE      PMPXI007,PMPXCMOB
          ENDIF
.
          MATCH     PMPXI008,Z70
          IF        !@EQUAL
            MOVE      PMPXI008,PMPXCEML
          ENDIF
.
          MATCH     PMPXI009,Z70
          IF        !@EQUAL
            MOVE      PMPXI009,PMPXCCRP
          ELSE
            MOVE      ZERO,PMPXCCRP
          ENDIF
.
          MATCH     PMPXI010,Z70
          IF        !@EQUAL
            MOVE      PMPXI010,PMPXKMOB
          ENDIF
.
          MATCH     PMPXI011,Z70
          IF        !@EQUAL
            MOVE      PMPXI011,PMPXKEML
          ENDIF
.
          MATCH     PMPXI012,Z70
          IF        !@EQUAL
            MOVE      PMPXI012,PMPXKCRP
          ELSE
            MOVE      ZERO,PMPXKCRP
          ENDIF
.
          MATCH     PMPXI013,Z70
          IF        !@EQUAL
            MOVE      PMPXI013,PMPXRMOB
          ENDIF
.
          MATCH     PMPXI014,Z70
          IF        !@EQUAL
            MOVE      PMPXI014,PMPXREML
          ENDIF
.
          MATCH     PMPXI015,Z70
          IF        !@EQUAL
            MOVE      PMPXI015,PMPXRCRP
          ELSE
            MOVE      ZERO,PMPXRCRP
          ENDIF
.
          MATCH     PMPXI016,Z70
          IF        !@EQUAL
            MOVE      PMPXI016,PMPXMEDC
          ENDIF
.
          MATCH     PMPXI017,Z70
          IF        !@EQUAL
            MOVE      PMPXI017,PMPXDETY
          ENDIF
.
          MATCH     PMPXI018,Z70
          IF        !@EQUAL
            MOVE      PMPXI018,PMPXPRIS
          ENDIF
.
          MATCH     PMPXI019,Z70
          IF        !@EQUAL
            MOVE      PMPXI019,PMPXCSER
          ENDIF
.
          MATCH     PMPXI020,Z70
          IF        !@EQUAL
            MOVE      PMPXI020,PMPXPHEI
          ENDIF
.
          MATCH     PMPXI021,Z70
          IF        !@EQUAL
            MOVE      PMPXI021,PMPXPWEI
          ENDIF
.
          MATCH     PMPXI022,Z70
          IF        !@EQUAL
            MOVE      PMPXI022,PMPXDREC
          ENDIF
.
          MATCH     PMPXI023,Z70
          IF        !@EQUAL
            MOVE      PMPXI023,PMPXMSNA
          ENDIF
.
          MATCH     PMPXI024,Z70
          IF        !@EQUAL
            MOVE      PMPXI024,PMPXMGNA
          ENDIF
.
          MATCH     PMPXI025,Z70
          IF        !@EQUAL
            MOVE      PMPXI025,PMPXMTLE
          ENDIF
.
          MATCH     PMPXI026,Z70
          IF        !@EQUAL
            MOVE      PMPXI026,PMPXMAD1
          ENDIF
.
          MATCH     PMPXI027,Z70
          IF        !@EQUAL
            MOVE      PMPXI027,PMPXMAD2
          ENDIF
.
          MATCH     PMPXI028,Z70
          IF        !@EQUAL
            MOVE      PMPXI028,PMPXMAD3
          ENDIF
.
          MATCH     PMPXI029,Z70
          IF        !@EQUAL
            MOVE      PMPXI029,PMPXMAD4
          ENDIF
.
          MATCH     PMPXI030,Z70
          IF        !@EQUAL
            MOVE      PMPXI030,PMPXMPOS
          ENDIF
.
          MATCH     PMPXI031,Z70
          IF        !@EQUAL
            MOVE      PMPXI031,PMPXMPNO
          ENDIF
.
          MATCH     PMPXI032,Z70
          IF        !@EQUAL
            MOVE      PMPXI032,PMPXMBNO
          ENDIF
.
          MATCH     PMPXI033,Z70
          IF        !@EQUAL
            MOVE      PMPXI033,PMPXMMNO
          ENDIF
.
          MATCH     PMPXI034,Z70
          IF        !@EQUAL
            MOVE      PMPXI034,PMPXMEML
          ENDIF
.
          MATCH     PMPXI035,Z70
          IF        !@EQUAL
            MOVE      PMPXI035,PMPXMCNT
          ENDIF
.
          MATCH     PMPXI036,Z70
          IF        !@EQUAL
            MOVE      PMPXI036,PMPXMCRP
          ELSE
            MOVE      ZERO,PMPXMCRP
          ENDIF
.
          MATCH     PMPXI037,Z70
          IF        !@EQUAL
            MOVE      PMPXI037,PMPXMLAB
          ELSE
            MOVE      ZERO,PMPXMLAB
          ENDIF
.
          MATCH     PMPXI038,Z70
          IF        !@EQUAL
            MOVE      PMPXI038,PMPXMREL
          ENDIF
.
          MATCH     PMPXI039,Z70
          IF        !@EQUAL
            MOVE      PMPXI039,PMPXFSNA
          ENDIF
.
          MATCH     PMPXI040,Z70
          IF        !@EQUAL
            MOVE      PMPXI040,PMPXFGNA
          ENDIF
.
          MATCH     PMPXI041,Z70
          IF        !@EQUAL
            MOVE      PMPXI041,PMPXFTLE
          ENDIF
.
          MATCH     PMPXI042,Z70
          IF        !@EQUAL
            MOVE      PMPXI042,PMPXFAD1
          ENDIF
.
          MATCH     PMPXI043,Z70
          IF        !@EQUAL
            MOVE      PMPXI043,PMPXFAD2
          ENDIF
.
          MATCH     PMPXI044,Z70
          IF        !@EQUAL
            MOVE      PMPXI044,PMPXFAD3
          ENDIF
.
          MATCH     PMPXI045,Z70
          IF        !@EQUAL
            MOVE      PMPXI045,PMPXFAD4
          ENDIF
.
          MATCH     PMPXI046,Z70
          IF        !@EQUAL
            MOVE      PMPXI046,PMPXFPOS
          ENDIF
.
          MATCH     PMPXI047,Z70
          IF        !@EQUAL
            MOVE      PMPXI047,PMPXFPNO
          ENDIF
.
          MATCH     PMPXI048,Z70
          IF        !@EQUAL
            MOVE      PMPXI048,PMPXFBNO
          ENDIF
.
          MATCH     PMPXI049,Z70
          IF        !@EQUAL
            MOVE      PMPXI049,PMPXFMNO
          ENDIF
.
          MATCH     PMPXI050,Z70
          IF        !@EQUAL
            MOVE      PMPXI050,PMPXFEML
          ENDIF
.
          MATCH     PMPXI051,Z70
          IF        !@EQUAL
            MOVE      PMPXI051,PMPXFCNT
          ENDIF
.
          MATCH     PMPXI052,Z70
          IF        !@EQUAL
            MOVE      PMPXI052,PMPXFCRP
          ELSE
            MOVE      ZERO,PMPXFCRP
          ENDIF
.
          MATCH     PMPXI053,Z70
          IF        !@EQUAL
            MOVE      PMPXI053,PMPXFLAB
          ELSE
            MOVE      ZERO,PMPXFLAB
          ENDIF
.
          MATCH     PMPXI054,Z70
          IF        !@EQUAL
            MOVE      PMPXI054,PMPXFREL
          ENDIF
.
          MATCH     PMPXI055,Z70
          IF        !@EQUAL
            MOVE      PMPXI055,PMPXTDIG
          ENDIF
.
          MATCH     PMPXI056,Z70
          IF        !@EQUAL
            MOVE      PMPXI056,PMPXWBID
          ENDIF
.
          MATCH     PMPXI057,Z70
          IF        !@EQUAL
            MOVE      PMPXI057,PMPXDVAC
          ENDIF
.
          MATCH     PMPXI058,Z70
          IF        !@EQUAL
            MOVE      PMPXI058,PMPXPNSD
          ENDIF
.
          MATCH     PMPXI059,Z70
          IF        !@EQUAL
            MOVE      PMPXI059,PMPXRHC1
          ENDIF
.
          MATCH     PMPXI060,Z70
          IF        !@EQUAL
            MOVE      PMPXI060,PMPXRH1G
          ENDIF
.
          MATCH     PMPXI061,Z70
          IF        !@EQUAL
            MOVE      PMPXI061,PMPXR1GC
          ENDIF
.
          MATCH     PMPXI062,Z70   
          IF        !@EQUAL
            MOVE      PMPXI062,PMPXUYN4
          ENDIF
.
          MATCH     PMPXI063,Z70  
          IF        !@EQUAL
            MOVE      PMPXI063,PMPXUYN5
          ENDIF
.
          MATCH     PMPXI064,Z70
          IF        !@EQUAL
            MOVE      PMPXI064,PMPXUYN6
          ENDIF
.
          MATCH     PMPXI065,Z70
          IF        !@EQUAL
            MOVE      PMPXI065,PMPXABRG
          ENDIF
.
          MATCH     PMPXI066,Z70
          IF        !@EQUAL
            MOVE      PMPXI066,PMPXPRVI
          ENDIF
.
          MATCH     PMPXI067,Z70
          IF        !@EQUAL
            MOVE      PMPXI067,PMPXCRIN
          ELSE
            MOVE      ZERO,PMPXCRIN
          ENDIF
.
          MATCH     PMPXI068,Z70
          IF        !@EQUAL
            MOVE      PMPXI068,PMPXHOML
          ELSE
            MOVE      ZERO,PMPXHOML
          ENDIF
.
          MATCH     PMPXI069,Z70
          IF        !@EQUAL
            MOVE      PMPXI069,PMPXUDC1
          ENDIF
.
          MATCH     PMPXI070,Z70
          IF        !@EQUAL
            MOVE      PMPXI070,PMPXUDC2
          ENDIF
.
          MATCH     PMPXI071,Z70
          IF        !@EQUAL
            MOVE      PMPXI071,PMPXUDC3
          ENDIF
.
          MATCH     PMPXI072,Z70
          IF        !@EQUAL
            MOVE      PMPXI072,PMPXUSR7
          ENDIF
.
          MATCH     PMPXI073,Z70
          IF        !@EQUAL
            MOVE      PMPXI073,PMPXUSR8
          ENDIF
.
          MATCH     PMPXI074,Z70
          IF        !@EQUAL
            MOVE      PMPXI074,PMPXUSR9
          ENDIF
.
          MATCH     PMPXI075,Z70
          IF        !@EQUAL
            MOVE      PMPXI075,PMPXMSNO
          ENDIF
.
          MATCH     PMPXI076,Z70
          IF        !@EQUAL
            MOVE      PMPXI076,PMPXCONP
          ENDIF
.
          MATCH     PMPXI077,Z70
          IF        !@EQUAL
            MOVE      PMPXI077,PMPXFLDR
          ENDIF
.
          MATCH     PMPXI078,Z70
          IF        !@EQUAL
            MOVE      PMPXI078,PMPXIWI1
          ENDIF
.
          MATCH     PMPXI079,Z70
          IF        !@EQUAL
            MOVE      PMPXI079,PMPXIWI2
          ENDIF
.
          MATCH     PMPXI080,Z70
          IF        !@EQUAL
            MOVE      PMPXI080,PMPXIWI3
          ENDIF
.
          MATCH     PMPXI081,Z70
          IF        !@EQUAL
            MOVE      PMPXI081,PMPXPFAX
          ENDIF
.
          MATCH     PMPXI082,Z70
          IF        !@EQUAL
            MOVE      PMPXI082,PMPXPFSN
          ENDIF
.
          MATCH     PMPXI083,Z70
          IF        !@EQUAL
            MOVE      PMPXI083,PMPXPFGN
          ENDIF
.
          MATCH     PMPXI084,Z70
          IF        !@EQUAL
            MOVE      PMPXI084,PMPXFNAM
          ENDIF
.
          MATCH     PMPXI085,Z70
          IF        !@EQUAL
            MOVE      PMPXI085,PMPXSNAM
          ENDIF
.
          MATCH     PMPXI086,Z70
          IF        !@EQUAL
            MOVE      PMPXI086,PMPXHFGN
          ENDIF
.
          MATCH     PMPXI087,Z70
          IF        !@EQUAL
            MOVE      PMPXI087,PMPXHFSN
          ENDIF
.
          MATCH     PMPXI088,Z70
          IF        !@EQUAL
            MOVE      PMPXI088,PMPXFUPI
          ENDIF
.
          MATCH     PMPXI089,Z70
          IF        !@EQUAL
            MOVE      PMPXI089,PMPXVGPC
          ENDIF
.
          MATCH     PMPXI090,Z70
          IF        !@EQUAL
            MOVE      PMPXI090,PMPXVGPP
          ENDIF
.
          MATCH     PMPXI091,Z70
          IF        !@EQUAL
            MOVE      PMPXI091,PMPXVGPG
          ENDIF
.
          MATCH     PMPXI092,Z70
          IF        !@EQUAL
            MOVE      PMPXI092,PMPXSIN6
          ENDIF
.
          MATCH     PMPXI093,Z70
          IF        !@EQUAL
            MOVE      PMPXI093,PMPXHFCN
          ENDIF
.
          MATCH     PMPXI094,Z70
          IF        !@EQUAL
            MOVE      PMPXI094,PMPXLUBH
          ENDIF
.
          MATCH     PMPXI095,Z70
          IF        !@EQUAL
            MOVE      PMPXI095,PMPXPMCN
          ENDIF
.
          MATCH     PMPXI096,Z70
          IF        !@EQUAL
            MOVE      PMPXI096,PMPXPMCR
          ENDIF
.
          MATCH     PMPXI097,Z70
          IF        !@EQUAL
            MOVE      PMPXI097,PMPXCRN1
          ENDIF
.
          MATCH     PMPXI098,Z70
          IF        !@EQUAL
            MOVE      PMPXI098,PMPXCRN2
          ENDIF
.
          MATCH     PMPXI099,Z70
          IF        !@EQUAL
            MOVE      PMPXI099,PMPXCRN3
          ENDIF
.
          MATCH     PMPXI100,Z70
          IF        !@EQUAL
            MOVE      PMPXI100,PMPXCRN4
          ENDIF
.
          MATCH     PMPXI101,Z70
          IF        !@EQUAL
            MOVE      PMPXI101,PMPXCRN5
          ENDIF
.
          MATCH     PMPXI102,Z70
          IF        !@EQUAL
            MOVE      PMPXI102,PMPXOSMS
          ENDIF
.
          MATCH     PMPXI103,Z70
          IF        !@EQUAL
            MOVE      PMPXI103,PMPXSN10
          ENDIF
.
          MATCH     PMPXI104,Z70
          IF        !@EQUAL
            MOVE      PMPXI104,PMPXUPRF
          ENDIF
.
          MATCH     PMPXI105,Z70
          IF        !@EQUAL
            MOVE      PMPXI105,PMPXAUF1
          ENDIF
.
          MATCH     PMPXI106,Z70
          IF        !@EQUAL
            MOVE      PMPXI106,PMPXAUF2
          ENDIF
.
          MATCH     PMPXI107,Z70
          IF        !@EQUAL
            MOVE      PMPXI107,PMPXAUF3
          ENDIF
.
          MATCH     PMPXI108,Z70
          IF        !@EQUAL
            MOVE      PMPXI108,PMPXAUF4
          ENDIF
.
          MATCH     PMPXI109,Z70
          IF        !@EQUAL
            MOVE      PMPXI109,PMPXAUF5
          ENDIF
.
          MATCH     PMPXI110,Z70
          IF        !@EQUAL
            MOVE      PMPXI110,PMPXSN16
          ENDIF
.
          MATCH     PMPXI111,Z70
          IF        !@EQUAL
            MOVE      PMPXI111,PMPXSN17
          ENDIF
.
          MATCH     PMPXI112,Z70
          IF        !@EQUAL
            MOVE      PMPXI112,PMPXSN18
          ENDIF
.
          MATCH     PMPXI113,Z70
          IF        !@EQUAL
            MOVE      PMPXI113,PMPXSN19
          ENDIF
.
          MATCH     PMPXI114,Z70
          IF        !@EQUAL
            MOVE      PMPXI114,PMPXSN20
          ENDIF
.
          MATCH     PMPXI115,Z70
          IF        !@EQUAL
            MOVE      PMPXI115,PMPXSN21
          ENDIF
.
          MATCH     PMPXI116,Z70
          IF        !@EQUAL
            MOVE      PMPXI116,PMPXSN22
          ENDIF
.
          MATCH     PMPXI117,Z70
          IF        !@EQUAL
            MOVE      PMPXI117,PMPXSN23
          ENDIF
.
          MATCH     PMPXI118,Z70
          IF        !@EQUAL
            MOVE      PMPXI118,PMPXSN24
          ENDIF
.
          MATCH     PMPXI119,Z70
          IF        !@EQUAL
            MOVE      PMPXI119,PMPXSN25
          ENDIF
.
          MATCH     PMPXI120,Z70
          IF        !@EQUAL
            MOVE      PMPXI120,PMPXSN26
          ENDIF
.
          MATCH     PMPXI121,Z70
          IF        !@EQUAL
            MOVE      PMPXI121,PMPXSN27
          ENDIF
.
          MATCH     PMPXI122,Z70
          IF        !@EQUAL
            MOVE      PMPXI122,PMPXSN28
          ENDIF
.
          MATCH     PMPXI123,Z70
          IF        !@EQUAL
            MOVE      PMPXI123,PMPXSN29
          ENDIF
.
          MATCH     PMPXI124,Z70
          IF        !@EQUAL
            MOVE      PMPXI124,PMPXSN30
          ENDIF
.
UPVPMI90  MATCH     PMPXI125,Z70                  * Identifying Gender
          IF        !@EQUAL
            MOVE      PMPXI125,PMPXUCC4
          ENDIF
.
          MATCH     PMPXI126,Z70                  * Ident Gender Free Text
          IF        !@EQUAL
            MOVE      PMPXI126,PMPXATF1
          ENDIF
.
          MATCH     PMPXI127,Z70                  * Identifying Pronoun
          IF        !@EQUAL
            MOVE      PMPXI127,PMPXUCC5
          ENDIF
.
          MATCH     PMPXI128,Z70                  * Ident Pronoun Free Text
          IF        !@EQUAL
            MOVE      PMPXI128,PMPXATF2
          ENDIF
.
          MATCH     PMPXI129,Z70
          IF        !@EQUAL
            MOVE      PMPXI129,PMPXUDT1        * User Defined Date 1 (ccyymmdd)
          ENDIF
.
          MATCH     PMPXI130,Z70
          IF        !@EQUAL
            MOVE      PMPXI130,PMPXUTM1        * User Defined Time 1 (hh:mm:ss)
          ENDIF
.
          MATCH     PMPXI131,Z70
          IF        !@EQUAL
            MOVE      PMPXI131,PMPXUDT2        * User Defined Date 2 (ccyymmdd)
          ENDIF
.
          MATCH     PMPXI132,Z70
          IF        !@EQUAL
            MOVE      PMPXI132,PMPXUTM2        * User Defined Time 2 (hh:mm:ss)
          ENDIF
.
          MATCH     PMPXI133,Z70
          IF        !@EQUAL
            MOVE      PMPXI133,PMPXUDT3        * User Defined Date 3 (ccyymmdd)
          ENDIF
.
          MATCH     PMPXI134,Z70
          IF        !@EQUAL
            MOVE      PMPXI134,PMPXUTM3        * User Defined Time 3 (hh:mm:ss)
          ENDIF
.
          MATCH     PMPXI135,Z70
          IF        !@EQUAL
            MOVE      PMPXI135,PMPXUDT4        * User Defined Date 4 (ccyymmdd)
          ENDIF
.
          MATCH     PMPXI136,Z70
          IF        !@EQUAL
            MOVE      PMPXI136,PMPXUTM4        * User Defined Time 4 (hh:mm:ss)
          ENDIF
.
          MATCH     PMPXI137,Z70
          IF        !@EQUAL
            MOVE      PMPXI137,PMPXUDT5        * User Defined Date 5 (ccyymmdd)
          ENDIF
.
          MATCH     PMPXI138,Z70
          IF        !@EQUAL
            MOVE      PMPXI138,PMPXUTM5        * Time of Birth (hh:mm:ss)
          ENDIF
.
          MATCH     PMPXI139,Z70
          IF        !@EQUAL
            MOVE      PMPXI139,PMPXETH1        * Ethnicity 1
          ENDIF
.
          MATCH     PMPXI140,Z70
          IF        !@EQUAL
            MOVE      PMPXI140,PMPXETH2        * Ethnicity 2
          ENDIF
.
          MATCH     PMPXI141,Z70
          IF        !@EQUAL
            MOVE      PMPXI141,PMPXLAN1        * Main Language Spoken at Home 1 
          ENDIF
.
          MATCH     PMPXI142,Z70
          IF        !@EQUAL
            MOVE      PMPXI142,PMPXLAN2        * Main Language Spoken at Home 2
          ENDIF
.
UPVPMI99  RETURN
.
.------------------------------------------------------------
. Format Patient Name <b>SURNAME</b>, Title Given Names
.------------------------------------------------------------
PATNAL00  CLEAR     DISPNAME
          REP       "#" ",PSNAME
          REP       "#" ",PTMASNAM
          REP       "#" ",PGNAME
          MOVE      SP70,PATFNAME
          REP       UPPLOW,PSNAME
          REP       UPPLOW,PTMASNAM
          APPEND    "<b>",DISPNAME
          MATCH     SP70,PTMASNAM
          IF        !@EQUAL
            STRIP     PTMASNAM
            APPEND    PTMASNAM,DISPNAME
          ELSE
            STRIP     PSNAME
            APPEND    PSNAME,DISPNAME
          ENDIF
          APPEND    ",",DISPNAME
          APPEND    " </b>",DISPNAME
          PACK      NAME35,PTITL,SP70
          CALL      NAMSTR00
          STRIP     PGNAME
          PACK      NAME35,PGNAME,SP70
          STRIP     NAME35
          CALL      NAMSTR00
          APPEND    SP70,DISPNAME
          RESET     DISPNAME
          MOVE      DISPNAME,PATFNAME
          STRIP     PATFNAME
.
          PACK      PTMASNAM,PTMASNAM,SP70       * Set name field back to
          PACK      PSNAME,PSNAME,SP70           * full length
          PACK      PGNAME,PGNAME,SP70
.
PATNAL99  RETURN
+
.------------------------------------------------------------
. Output Billing comments indicator
.------------------------------------------------------------
          DEFPROC   CHCMN000
.
          INC       VISCMTFD/INC
.
CHCMN010  OPEN      VISCMTA1,"viscmtaf"
          MOVE      ZERO,F1           * No Previous Address  
          MOVE      "003",KEY3
          PACK      KEY14,ADMISSNO,KEY3,SP70 
          CALL      RSVSCMT1
          CALL      RKVSCMT1
          BRANCH    OVRCD,CHCMN990
          MATCH     VSCTVIST,ADMISSNO
          GOTO      CHCMN990 IF NOT EQUAL
          MATCH     VSCTTYPE,KEY3
          GOTO      CHCMN990 IF NOT EQUAL
          MOVE      ONE,F1
CHCMN990  WRITE     HTMLFILE;F1;      * output Previous Address indicator
CHCMN999  CLOSE     VISCMTA1
          GOTO      CHCMNEND 
.
          INC       VISCMTIO/INC
          INC       IBAOVRIO/INC
.
CHCMNEND  ENDPROC
+
.
.*****************************************************************************
.*  GETCURIP
.*  Procedure to output "Current IP" or "On-Leave IP"
.*****************************************************************************
          DEFPROC   GETCURIP
.
          INC      PATMI1FD/INC
          INC      PMSVX1FD/INC
          INC      PATHSPFD/INC
          INC      WEBSECFD/INC
IPTEXT    DIM      40
CURRVIS   DIM      11
CURRHOS   DIM      3
THISVIS   DIM      11
THISHOS   DIM      3 
CURIPLK   DIM      1    
.
          OPEN     PATMI1A8,"patmi1af"
          OPEN     PMSVX1A1,"pmsvx1af"
          OPEN     PATHSPA1,"pathspaf"
          OPEN     WEBSECA1,"websecaf"
          OPEN     CONTROLF,"controlf"
          READ     CONTROLF,HUND25;*247,PTCNIPHY          
.
          IF        IBCNMHOS = 1
            PACK      KEY10,USERID,SP70
            CALL      RDWBSE1
            BRANCH    OVRCD,GETCUR99
          ENDIF
.
          PACK     IPTEXT,SP70
          STRIP    IPTEXT   
. 
          PACK     KEY8,ADMISSNO,SP70
          CALL     RDPMVX11
          IF       OVRCD=1
            MOVE     SP70,PMVXMHOS
          ENDIF
          IF       IBCNMHOS = 1
            MOVE      WBSEHOSP,CURRHOS
            MOVE      PMVXMHOS,THISHOS
          ELSE
            PACK      CURRHOS,SP70
            PACK      THISHOS,SP70
          ENDIF
          PACK     THISVIS,THISHOS,ADMISSNO
.
          PACK     KEY17,URNUMBER,TWO,SP70
          CALL     RSPTMI18
          CALL     RKPTMI18
          BRANCH   OVRCD,GETCUR99
.
          MATCH    URNUMBER,AURNO
          GOTO     GETCUR10 IF NOT EQUAL
.
.          MATCH    DAADMNO,ADMISSNO
          PACK     CURRVIS,CURRHOS,DAADMNO
          MATCH    CURRVIS,THISVIS
          GOTO     GETCUR99 IF EQUAL
.
          MATCH    "2",DASTAT
          GOTO     GETCUR10 IF NOT EQUAL
.
          APPEND   "Current IP",IPTEXT
          GOTO     GETCUR20
.
GETCUR10  PACK     KEY17,URNUMBER,FOUR,SP70
          CALL     RSPTMI18
          CALL     RKPTMI18
          BRANCH   OVRCD,GETCUR99
.
          MATCH    URNUMBER,AURNO
          GOTO     GETCUR99 IF NOT EQUAL
.
.          MATCH    DAADMNO,ADMISSNO
          PACK     CURRVIS,CURRHOS,DAADMNO
          MATCH    CURRVIS,THISVIS
          GOTO     GETCUR99 IF EQUAL
.
          MATCH    "4",DASTAT
          GOTO     GETCUR99 IF NOT EQUAL
.
          APPEND   "On-Leave IP",IPTEXT
          GOTO     GETCUR20
.
GETCUR20  COMPARE  ONE,IBCNMHOS
          GOTO     GETCUR80 IF NOT EQUAL
.
          PACK     KEY3,PMVXMHOS,SP70
          CALL     RDPTHSP1
          BRANCH   OVRCD,GETCUR80
.
          APPEND   " - ",IPTEXT
          APPEND   PTHSSNAM,IPTEXT 
.
          MATCH    "4",DASTAT
          GOTO     GETCUR90 IF EQUAL
.
          MATCH    WBSEHOSP,PTHSHOSP    * if current IP visit hosp & user log 
                                        * hosp is same
            IF       @EQUAL
              MOVE     "1",CURIPLK
            ELSE
              MOVE     "2",CURIPLK
            ENDIF
.
GETCUR80  RESET    IPTEXT   
          IF       IBCNMHOS = 0
            MOVE     "0",CURIPLK
          ENDIF
          WRITE    HTMLFILE;*+,DAADMNO,PTCNIPHY,CURIPLK,"(",IPTEXT,")";
          MOVE     SP70,CURIPLK
          GOTO     GETCUR99
.
GETCUR90  RESET    IPTEXT
          WRITE    HTMLFILE;*+,"(",IPTEXT,")";
          GOTO     GETCUR99
.
          INC      PATMI1IO/INC
          INC      PMSVX1IO/INC
          INC      PATHSPIO/INC
          INC      IBAOVRIO/INC
          INC      WEBSECIO/INC
.
GETCUR99  CLOSE    PATMI1A8
          CLOSE    PMSVX1A1
          CLOSE    PATHSPA1 
          CLOSE    WEBSECA1
.
          ENDPROC
.*****************************************************************************
.*  GETALTID
.*  Procedure to get an alternate ID
.*  Exit=0  No alternate ID
.*       1  Alternate ID's exist
.*****************************************************************************
          DEFPROC   GETALIDS
.
          INC       PMSAIDFD/INC
.
          MOVE      ZERO,EXIT
          PACK      KEY20,SP70
          OPEN      PMSAIDA1,"pmsaidaf"
.
          PACK      KEY31,PURNO,SP70
          CALL      RSPMAID1           * Read alternate id Table
GETALI10  CALL      RKPMAID1
          BRANCH    OVRCD,GETALI99
.
          MATCH     PURNO,PMAIURNO     * Check same UR
          GOTO      GETALI99 IF NOT EQUAL
.
          MATCH     "1",PMAIDISU
          GOTO      GETALI10 IF NOT EQUAL
.
          PACK      KEY20,PMAIALID,SP70
          MOVE      ONE,EXIT
          GOTO      GETALI99
.
          INC       PMSAIDIO/INC
          INC       IBAOVRIO/INC
.
GETALI99  CLOSE     PMSAIDA1
.
          ENDPROC
.*****************************************************************************
.*  ALTVS000
.*  Procedure to get an alternate Visit ID
.*  KEY20 - Alternative Visit Number 
.*****************************************************************************
          DEFPROC   ALTVS000
.
          INC       IBAALVFD/INC
.
          PACK      KEY20,SP70
          OPEN      IBAALVA1,"ibaalvaf"
.
          MATCH     "       0",ADMISSNO
          GOTO      ALTVS999 IF EQUAL
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDIBALV1
          BRANCH    OVRCD,ALTVS999
.
          PACK      KEY20,IBAVAVIS,SP70
          GOTO      ALTVS999
.
          INC       IBAALVIO/INC
          INC       IBAOVRIO/INC
.
ALTVS999  CLOSE     IBAALVA1
.
          ENDPROC
.*****************************************************************************
.------------------------------------------------------------
. Output Claim Code or Health Fund
.------------------------------------------------------------
CLAM0000  MOVE     SP70,CODE
          MATCH    SP70,ADMISSNO
          GOTO     CLAM9500 IF EQUAL
          MOVE     ADMISSNO,KEY8
          CALL     RDVISA1
          IF       OVRCD=1
            MOVE     ZERO,PVITYPE
            GOTO     CLAM2000
          ENDIF
.
          BRANCH   PVITYPE,CLAM1000,CLAM2000,CLAM3000
          COMPARE  NINE,PVITYPE
          GOTO     CLAM9500 IF NOT EQUAL
.
          MATCH    " 1",PVISYST
          GOTO     CLAM4000 IF EQUAL    * Events
          MATCH    " 2",PVISYST
          GOTO     CLAM5000 IF EQUAL    * Allied Health
          GOTO     CLAM9500
.
.         Emergency  
.
CLAM1000  PROC     EMRCHK00
          MOVE     ZERO,EXIT
          GOTO     CLAM9999
.
.         Outpatients
.
CLAM2000  PROC     OUTDET00
          MOVE     ZERO,EXIT
          GOTO     CLAM9999
.
.         Inpatients
.
CLAM3000  MOVE      PVIBILL,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD,CLAM9500
.
          MOVE      ACLAIM,CODE
          MATCH     SP70,AFUNDH
          IF        !@EQUAL
            PACK      KEY10,AFUNDH,SLASH,AFNDTB
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      CLAM9999
.
.         Event
.
CLAM4000  PROC      EVCL0000
          GOTO      CLAM9999
.
.         Allied Health
.
CLAM5000  PROC      ALCL0000
          GOTO      CLAM9999
.
CLAM9500  MOVE      ONE,EXIT
CLAM9999  RETURN
.
.------------------------------------------------------------
. Output CDM details for the U/R and Visit
.------------------------------------------------------------
          DEFPROC   CHCDM000
.
          INC       OUTBOAFD/INC
          INC       OUTPREFD/INC
          INC       OUTSITFD/INC
          INC       PATVISFD/INC
          INC       PMSCDMFD/INC
          INC       PMSCDNFD/INC
.
          OPEN      PATVISA1,"patvisaf"
          OPEN      PMSCDMA1,"pmscdmaf"
          OPEN      PMSCDNA1,"pmscdnaf"
.
          MOVE      SP70,KEY51
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMCDM1
          BRANCH    OVRCD,CHCDM500
          PACK      KEY51,PMDMSTAT,PMDMPW01,PMDMPW02,PMDMPW03,PMDMPW04,PMDMPW05:
                                   PMDMPW06,PMDMPW07,PMDMPW08,PMDMPW09,PMDMPW10
.
CHCDM500  WRITE     HTMLFILE;KEY51;      * output CDM details
.
          MOVE      SP70,KEY51
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDPMCDN1
          BRANCH    OVRCD,CHCDM600
          PACK      KEY51,PMDNSTAT,PMDNPW01,PMDNPW02,PMDNPW03,PMDNPW04,PMDNPW05:
                                   PMDNPW06,PMDNPW07,PMDNPW08,PMDNPW09,PMDNPW10
.
CHCDM600  WRITE     HTMLFILE;KEY51;      * output CDM visit based details
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDVISA1
          BRANCH    OVRCD,CHCDM700
.
          WRITE     HTMLFILE;PVIDATE,PTVITYPE;  * output CDM visit based details
          GOTO      CHCDM999
.
CHCDM700  CALL      CLPATVIS
.
          OPEN      OUTSITA1,"outsitaf"
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      OUTPREA1,"outpreaf"   * Pre Attendance File
          TRAPCLR   IO
          BRANCH    OVRCD,CHCDM800
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDPREA1               * Check for Pre-Attendance
          BRANCH    OVRCD,CHCDM800
.
          PACK      KEY6,OPRSITE,SP70
          CALL      RDSITA1
          BRANCH    OVRCD,CHCDM800
.
          PACK      KEY8,OSTFILE,FILBOKA6 * Determine Location from Masterfile
          TRAP      OVERCOND IF IO
          OPEN      OUTBOKA6,KEY8         * Master
          TRAPCLR   IO
          BRANCH    OVRCD,CHCDM800
.
          PACK      KEY36,ADMISSNO,SP70
          CALL      RDSBOKA6
          CALL      RDKBOKA6
          BRANCH    OVRCD,CHCDM800
.
          MATCH     ADMISSNO,DOBAOUTN
          GOTO      CHCDM800 IF NOT EQUAL
.
          MOVE      OBAOUTNO,PVIBILL
          MOVE      OBADATE,PVIDATE
          MOVE      "2",PVITYPE
          MOVE      " 2",PTVITYPE
.
CHCDM800  WRITE     HTMLFILE;PVIDATE,PTVITYPE;
          GOTO      CHCDM9999
.
CHCDM999  CLOSE     OUTSITA1
          CLOSE     OUTPREA1
          CLOSE     OUTBOKA6
          CLOSE     PATVISA1
          CLOSE     PMSCDMA1
          CLOSE     PMSCDNA1
          GOTO      CHCDMEND
.
          INC       CLPATVIS
          INC       OUTSITIO/INC
          INC       OUTPREIO/INC
          INC       OUTBOAIO/INC
          INC       PATVISIO/INC
          INC       PMSCDMIO/INC
          INC       PMSCDNIO/INC
          INC       IBAOVRIO/INC
.
CHCDMEND  ENDPROC
+
.------------------------------------------------------------
. Output visit dates for Inpatient/Outpatient 
.------------------------------------------------------------
          DEFPROC   VISDT000
.
          INC       OUTBOAFD/INC
          INC       OUTBB1FD/INC
          INC       OUTPREFD/INC
          INC       OUTSITFD/INC
          INC       PATDSCFD/INC
          INC       PATMI1FD/INC
          INC       PATVISFD/INC
.
DATESTRN  DIM       50
VISITDTE  DIM       10                      * Visit date (DD/MM/CCYY)
.
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,HUND20;*157,PTCNHDVD
          MATCH     "1",PTCNHDVD            * Display visit dates?
          GOTO      VISDTEND IF NOT EQUAL
.
          OPEN      OUTSITA1,"outsitaf"
          OPEN      PATDSCH1,"patdschf"
          OPEN      PATMI1A1,"patmi1af"
          OPEN      PATVISA1,"patvisaf"
.
          CLEAR     DATESTRN
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDVISA1
          BRANCH    OVRCD,VISDT200          * Outpatient booking
.
          MOVE      PVISITE,OPRSITE
          BRANCH    PVITYPE,VISDT999,VISDT210,VISDT300
          GOTO      VISDT999
.
.         Outpatient Visit
.
VISDT200  CALL      CLPATVIS
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      OUTPREA1,"outpreaf"   * Pre Attendance File
          TRAPCLR   IO
          BRANCH    OVRCD,VISDT999
          
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDPREA1               * Check for Pre-Attendance
          BRANCH    OVRCD,VISDT999
.
VISDT210  PACK      KEY6,OPRSITE,SP70
          CALL      RDSITA1
          BRANCH    OVRCD,VISDT999
.
          PACK      KEY8,OSTFILE,FILBOKA6 * Determine Location from Masterfile
          TRAP      OVERCOND IF IO
          OPEN      OUTBOKA6,KEY8         * Master
          TRAPCLR   IO
          BRANCH    OVRCD,VISDT999
.
          PACK      KEY36,ADMISSNO,SP70
          CALL      RDSBOKA6
          CALL      RDKBOKA6
          BRANCH    OVRCD,VISDT999
.
          MATCH     ADMISSNO,DOBAOUTN
          GOTO      VISDT999 IF NOT EQUAL
.
          MOVE      OBAOUTNO,PVIBILL
          MOVE      OBADATE,PVIDATE
          MOVE      "2",PVITYPE
          MOVE      " 2",PTVITYPE
.
          BRANCH    OBASTAT,VISDT221,VISDT222,VISDT223,VISDT224
          GOTO      VISDT999
.
VISDT221  CALL      GETD0000
          APPEND    "Booked ",DATESTRN
          APPEND    VISITDTE,DATESTRN
          APPEND    " at ",DATESTRN
          APPEND    OBATIME,DATESTRN
          RESET     DATESTRN
          GOTO      VISDT290
.
VISDT222
VISDT223  GOTO      VISDT999
.
VISDT224  CALL      GETD0000
          APPEND    "Attended ",DATESTRN
          APPEND    VISITDTE,DATESTRN
.
          PACK      KEY8,OSTFILE,FILBB1A1 * Determine Location from Masterfile
          TRAP      OVERCOND IF IO
          OPEN      OUTBB1A1,KEY8         * Master
          TRAPCLR   IO
          BRANCH    OVRCD,VISDT999
.
          MOVE      OBAOUTNO,KEY8
          CALL      RDBOKB1
          BRANCH    OVRCD,VISDT290

          APPEND    " at ",DATESTRN
          APPEND    OTBBCITM,DATESTRN
.
VISDT290  RESET     DATESTRN
          WRITE     HTMLFILE;DATESTRN;
          GOTO      VISDT999
.
.         Inpatient Visit
.
VISDT300  PACK      KEY8,ADMISSNO,SP70
          CALL      RDMISS1
          BRANCH    OVRCD,VISDT999
.
          CALL      GETD0000
.
          BRANCH    ASTAT,VISDT310,VISDT320,VISDT330,VISDT320
          GOTO      VISDT999
.
VISDT310  APPEND    "Pre-admission ",DATESTRN
          APPEND    VISITDTE,DATESTRN
          RESET     DATESTRN
          GOTO      VISDT900
.
VISDT320  APPEND    VISITDTE,DATESTRN
          APPEND    " - current",DATESTRN
          RESET     DATESTRN
          GOTO      VISDT900
.
VISDT330  APPEND    VISITDTE,DATESTRN
          APPEND    " - ",DATESTRN
.
          CALL      CLPATDSC
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDDSCH1
          IF        OVRCD=0
            MOVE      DDATE,PVIDATE
            CALL      GETD0000
            APPEND    VISITDTE,DATESTRN
          ENDIF
.
          RESET     DATESTRN
          GOTO      VISDT900
.
VISDT900  WRITE     HTMLFILE;DATESTRN;
          GOTO      VISDT999
.
VISDT999  CLOSE     OUTSITA1
          CLOSE     OUTPREA1
          CLOSE     OUTBOKA6
          CLOSE     PATDSCH1
          CLOSE     PATMI1A1
          CLOSE     PATVISA1
          GOTO      VISDTEND
.
GETD0000  CLEAR     VISITDTE
          UNPACK    PVIDATE,CCENT,CYEAR,CMON,CDAY
          APPEND    CDAY,VISITDTE
          APPEND    "/",VISITDTE
          APPEND    CMON,VISITDTE
          APPEND    "/",VISITDTE
          APPEND    CCENT,VISITDTE
          APPEND    CYEAR,VISITDTE
          RESET     VISITDTE
GETD9999  RETURN
.
.
          INC       CLPATVIS
          INC       CLPATDSC
          INC       OUTBB1IO/INC
          INC       OUTBOAIO/INC
          INC       OUTPREIO/INC
          INC       OUTSITIO/INC
          INC       PATDSCIO/INC
          INC       PATMI1IO/INC
          INC       PATVISIO/INC
          INC       IBAOVRIO/INC
.
VISDTEND  ENDPROC
+
.
.*****************************************************************************
.*  EVCL0000
.*  Get Claim code from Event file
.*****************************************************************************
          DEFPROC   EVCL0000
.
          INC       PMSEVTFD/INC
.
          MOVE      ZERO,EXIT
          IF        COPTION=7
            GOTO      EVCL9999
          ENDIF
.
          OPEN      PMSEVTA1,"pmsevtaf"
.
          MOVE      SP10,CODE
          MOVE      ADMISSNO,KEY8
          CALL      RDPMEVT1
          BRANCH    OVRCD,EVCL9500
.
          MATCH     ADMISSNO,PMEVVISN      * Same visit number ?
          GOTO      EVCL9500 IF NOT EQUAL  * No
.
          MATCH     SP3,PMEVCCOD
          GOTO      EVCL9500 IF EQUAL
          MOVE      PMEVCCOD,CODE          * Claim Code
          MOVE      ZERO,EXIT
          GOTO      EVCL9999
.
EVCL9500  MOVE      ONE,EXIT
          GOTO      EVCL9999
.
          INC       IBAOVRIO/INC
          INC       PMSEVTIO/INC
.
EVCL9999  CLOSE     PMSEVTA1
          ENDPROC
+
.*****************************************************************************
.*  ALCL0000
.*  Get claim code from Allied Health file
.*****************************************************************************
          DEFPROC   ALCL0000
.
          INC       ALLCONFD/INC
          INC       ALLREFFD/INC
.
          MOVE      ZERO,EXIT
          MOVE      ZERO,EXIT
          IF        COPTION=7
            GOTO      ALCL9999
          ENDIF
.
          OPEN      ALLREFA1,"allrefaf"
.
          MOVE      SP10,CODE
          PACK      KEY8,ADMISSNO
          CALL      RDALREF1
          BRANCH    OVRCD,ALCL9500
.
          MATCH     ADMISSNO,ALREVISN      * Same visit number ?
          GOTO      ALCL9500 IF NOT EQUAL  * No
.
          MATCH     SP3,ALRECOMP
          GOTO      ALCL9500 IF EQUAL
          MOVE      ALRECOMP,CODE          * Claim code
          MOVE      ZERO,EXIT
          GOTO      ALCL9999
.
ALCL9500  MOVE      ONE,EXIT
          GOTO      ALCL9999
.
          INC       IBAOVRIO/INC
          INC       ALLREFIO/INC
.
ALCL9999  CLOSE     ALLREFA1
          ENDPROC
.

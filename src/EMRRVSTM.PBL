. *-----------------------------------------------------------------------
. * Include Name  :   EMRRVSTM.PBL
. *
. * Function      :   CGI variables functions for EMRRVSFD - emrrvsaf.dat
. *-----------------------------------------------------------------------
.  Modifications Done :
.
.  V10.03.00  29/10/2012  Ebon Clements CAR 266929
.             Created include
. *-----------------------------------------------------------------------
.-------------------------------------------------------------------------
.   Clear Parameters for research program visits file
.-------------------------------------------------------------------------
CPEMRV00  MOVE      Z70,EMRVS001
          MOVE      Z70,EMRVS002
          MOVE      Z70,EMRVS003
          MOVE      Z70,EMRVS004
.
CPEMRV99  RETURN
.
.--------------------------------------------------------------------------
. Tags for research program visits file
.--------------------------------------------------------------------------
EMRV0000  BRANCH    FLDITMNO,EMRV0010,EMRV0020,EMRV0030,EMRV0040,EMRV0050:
                             EMRV0060,EMRV0070,EMRV0080,EMRV0090,EMRV0100
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      EMRV9999
.
EMRV0010  MOVE      "eu",CATEGORY
          MOVE      EMRVRESP,CODE
          CALL      CODITM00
          GOTO      EMRV9999
.
EMRV0020  MATCH     SP70,EMRVSDAT
          GOTO      EMRV9999 IF EQUAL
.
          UNPACK    EMRVSDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMRV9999
.
EMRV0030  WRITE     HTMLFILE;EMRVVISN;
          GOTO      EMRV9999
.
EMRV0040  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRV0041

          WRITE     HTMLFILE;EMRVPSTA;
          GOTO      EMRV9999
.
EMRV0041  WRITE     HTMLFILE;"<option value=#"0#">",EMRVPST0:
                             "</option>"
          WRITE     HTMLFILE;"<option value=#"1#">",EMRVPST1:
                             "</option>"
          WRITE     HTMLFILE;"<option value=#"2#">",EMRVPST2:
                             "</option>"
          GOTO      EMRV9999
.
EMRV0050  MATCH     SP70,EMRVCUID
          GOTO      EMRV9999 IF EQUAL
.
          PACK      KEY10,EMRVCUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      EMRVCUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      EMRV9999

EMRV0060  MATCH     EMRVCDAT,SP70
          GOTO      EMRV9999 IF EQUAL
.
          UNPACK    EMRVCDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMRV9999
.
EMRV0070  WRITE     HTMLFILE;EMRVCTIM;
          GOTO      EMRV9999
.
EMRV0080  MATCH     SP70,EMRVUUID
          GOTO      EMRV9999 IF EQUAL
.
          PACK      KEY10,EMRVUUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      EMRVUUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      EMRV9999

EMRV0090  MATCH     EMRVUDAT,SP70
          GOTO      EMRV9999 IF EQUAL
.
          UNPACK    EMRVUDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMRV9999
.
EMRV0100  WRITE     HTMLFILE;EMRVUTIM;
          GOTO      EMRV9999
.
EMRV9999  RETURN
.
.--------------------------------------------------------------------------
. Set parameters for research program visits file
.--------------------------------------------------------------------------
SPEMRV00  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPEMRV01,SPEMRV02,SPEMRV03,SPEMRV04
.
          MOVE      ONE,EXIT
          GOTO      SPEMRV99
.
SPEMRV01  PACK      EMRVS001,QRYDATA,SP70
          GOTO      SPEMRV99
.
SPEMRV02  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      EMRVS002,CCENT,CYEAR,CMON,CDAY,SP70
          GOTO      SPEMRV99
.
SPEMRV03  PACK      EMRVS003,QRYDATA,SP70
          GOTO      SPEMRV99
.
SPEMRV04  PACK      EMRVS004,QRYDATA,SP70
          GOTO      SPEMRV99
.
SPEMRV99  RETURN
.
.--------------------------------------------------------------------------
. Update cgi to file vars for research program visits file
.--------------------------------------------------------------------------
MVEMRV00  MATCH     EMRVS001,Z70
          IF        !@EQUAL
            MOVE      EMRVS001,EMRVRESP
          ENDIF
.
          MATCH     EMRVS002,Z70
          IF        !@EQUAL
            MOVE      EMRVS002,EMRVSDAT
          ENDIF
.
          MATCH     EMRVS003,Z70
          IF        !@EQUAL
            MOVE      EMRVS003,EMRVVISN
          ENDIF
.
          MATCH     EMRVS004,Z70
          IF        !@EQUAL
            MOVE      EMRVS004,EMRVPSTA
          ENDIF
.
MVEMRV99  RETURN
.
.--------------------------------------------------------------------------
. Clear file vars for research program visits file
.--------------------------------------------------------------------------
CLEMRV00  MOVE      SP70,EMRVRESP
          MOVE      SP70,EMRVSDAT
          MOVE      SP70,EMRVVISN
          MOVE      SP70,EMRVPSTA
          MOVE      SP70,EMRVCUID
          MOVE      SP70,EMRVCDAT
          MOVE      SP70,EMRVCTIM
          MOVE      SP70,EMRVUUID
          MOVE      SP70,EMRVUDAT
          MOVE      SP70,EMRVUTIM
          MOVE      SP70,EMRVSPAR
.
CLEMRV99  RETURN

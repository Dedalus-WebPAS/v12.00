.******************************************************************************
.* System         : Patient                                                   *
.*                                                                            *
.* Include Name   : PATSETLB.PBL                                              *
.*                                                                            *
.* Author         : Santa's Little Helper (Bart's dog)                        *
.*                                                                            *
.* Function       : To set up the variables for the Print labels include      *
.*                  (Includes the line up of labels too.)                     *
.*                                                                            *
.* Parameters     : CTYPLAB  FORM  2      from CONTROLF                       *
.*                  CSIZLAB  FORM  1      from CONTROLF                       *
.*                                                                            *
.* Includes req'd : PATMI1FD - Details of Admission                           *
.*                  PATMA1FD - Details of Patient                             *
.*                  PATDO1FD - Details of Patient's Doctor(s)                 *
.*                  PATCODE  - For determine marital status                   *
.*                  PATTRNFD - For determining Ward/Bed                       *
.*                  PATDLABS - Date variables for labels                      *
.*                                                                            *
.* Modifications  :                                                           *
.*       V12.00.01  28/05/2025 Bella Turco     TSK 0955096                    *
.*                  Alphanumeric changes                                      *
.*       V10.10.01  22/03/2017 Richa Phogat    TSK 0832066                    *
.*                  Changed DVA Card Number to be collected from              *
.*                  PMCDCNUM.PMSCCDFD instead of PREPAT.PMIMA1FD              * 
.*       V10.09.01  02/12/2016  Steve Armstrong  TSK 0817740                  *
.*                  Fixed printing of Practice name for STV labels where no   *
.*                  HCP is available                                          *
.******************************************************************************
.*       V10.08.02  15/11/2016  Steve Armstrong  TSK 0817740                  *
.*                  Further mods to GP labels logic for STV                   *
.*       V10.08.01  10/09/2015  Steve Armstrong  TSK 0817740                  *
.*                  Mods to create GP labels for STV for both PMI and I/P.    *
.******************************************************************************
.*       V10.06.04  10/09/2015  Steve Armstrong  CAR 315321                   *
.*                  Mods to remove Marital Status and Religion fields from    *
.*                  STV PMI labels.                                           *
.*       V10.06.03  01/09/2015  Steve Armstrong  CAR 321211                   *
.*                  Fixed setting of variables for I/P PMI labels for STV.    *
.*       V10.06.02  15/07/2015  Steve Armstrong  CAR 315999                   *
.*                  Mods to handle printing of Wrist Band labels (Screen "02")*
.*                  for STV Layout (25).                                      *
.*       V10.06.01  31/03/2015  Don Nguyen       CAR 303612                   *
.*                  Modified INDIG000 - Added WLINEZ19 for Aboriginality desc *
.******************************************************************************
.*       V10.05.01  17/07/2014  Steve Armstrong  CAR 294204                   *
.*                  Added formatting for label type 27 (SETLAB27) for         *
.*                  SJOG Geelong labels.                                      *
.******************************************************************************
.*       V10.03.02  03/10/2013  Steve Armstrong  CAR 288277                   *
.*                  Mods for alternate STV PMI Zebra label format - added     *
.*                  further test for "LABELPMI".                              *
.*       V10.03.01  15/08/2013  Steve Armstrong  CAR 288277                   *
.*                  Mods for alternate STV PMI Zebra label format             *
.******************************************************************************
.*        V9.09.01  16/11/2007  Peter Vela    CAR 110766                      *
.*                  Fixed overseas patient STV address labels                 *
.******************************************************************************
.*        V9.03.02  11/06/2004  Mike Laming   CAR 49016  July 2004 PRS/2      *
.*                  - Add Sex Description routine SEXDSC00 with Code "R" -    *
.*                  "Intersex" added                                          *
.*        V9.03.01  04/06/2003  Jill Habasque SRF 38102                       *
.*                  Added move of zero to F1 before pmxpintr                  *
.******************************************************************************
.*        V9.02.13  23/09/2002  Jill Habasque SRF 22043                       *
.*                  Changed STV Address labels to print Temp UR numbers       *
.*                  without the dash                                          *
.*        V9.02.12  08/07/2002  Bronko Sosic                                  *
.*                  Changed Labels at St V to print Temp UR numbers without   *
.*                  dash                                                      *
.*        V9.02.12  10/06/2002  Bronko Sosic                                  *
.*                  Changed Inpatient Labels for St .V                        *
.*        V9.02.11  26/05/2002  Bronko Sosic                                  *
.*                  Fixed Patient Address Label                               *
.*        V9.02.10  21/04/2002  Bronko Sosic                                  *
.*                  Mods for St V. go live                                    *
.*        V9.02.09  11/04/2002  Dean Cramer                                   *
.*                  Do CALCAGE in LAB25A                                      *
.*        V9.02.08  03/04/2002  Bronko Sosic                                  *
.*                  Added LAB25C to setup Address labels for St Vincent's     *
.*        V9.02.07  07/03/2002  Tonii                                         *
.*                  Added LAB25B to setup nutrition labels for St Vincent's   *
.*        V9.02.06  05/03/2002  Jill Habasque 3267                            *
.*                  RCH LABELS - Added check for PMPXFLAB & PMPXMLAB          *
.*        V9.02.05  30/01/2002  Tonii                                         *
.*                  RCH LABELS - new layout for PMI labels                    *
.*                  - new field for aboriginality                             *
.*                  - new field for language                                  *
.*                  - removed baptised status and business phone number       *
.*                  - mods to print XX-XXX-XX for DOB if pmpxedob = YES       *
.*        V9.02.03  26/10/2001  Tonii                                         *
.*                  Moved URNUMBER into WRCHURNO for printing instead of      *
.*                  AURNO for RCH Labels                                      *
.*        V9.02.02  05/09/2001  Tonii                                         *
.*                  Added new layout 26, for Royal Children's                 *
.*        V9.02.01  13/08/2001  Tonii                                         *
.*                  Added new layout 25, for St vincent's                     *
.******************************************************************************
.*        V5.08.01  23/08/2000  Tonii                                         *
.*                  - Mods to all validation of PSEX, made sure U-Unknown and *
.*                    I-Indeterminate are validated also                      *
.*                  - Changed to use KEY7 rather than KEY6 in SETLAB10, for   *
.*                    patient sex description                                 *
.******************************************************************************
.*        V5.07.01  13/07/1999  Greg Horvat                                   *
.*                  Replaced certain variables & with KEY variables           *
.*                  08/10/1998  Glenn Berry      5.07 changes                 *
.******************************************************************************
.*        V5.02.01  03/01/1995  Graeme Williams   SRF 134242              
.*                  Added layout 19 - Greenslopes
.*        V5.02.02  10/01/1995  Paul Howells      SRF 134197              
.*                  Changed Layout 18 - Port Macquarie
.*        V5.02.03  10/01/1995  Graeme Williams                           
.*                  Minor changes to layout 19 - Greenslopes
.*        V5.02.04  17/01/1995  Whirlpool                                 
.*                  Minor changes to layout 18 - port mac    
.*        V5.02.05  19/01/1995  Whirlpool                                 
.*                  added fund table to layout 18            
.*        V5.02.06  20/01/1995  Whirlpool                                 
.*                  Changed hawkes bay label to print GP from the master file 
.*        V5.02.07  23/01/1995  Whirlpool                                 
.*                  Change hawkes bay label back !!! make up your mind      
.*        V5.02.08  27/03/1995  Greg Horvat      SRF 135133
.*                  Changed to Port Mac. labels to print the admission health
.*                  fund code & table instead of the master health fund code
.*                  & table
.*        V5.02.09  28/04/1995  Greg Horvat      SRF 136165              
.*                  Added layout 20 - St. Lukes
.*        V5.02.10  04/05/1995  Gabrielle        SRF 135953              
.*                  Fixed Layout 19 - Greenslopes - Ensured DVA No was cleared
.*        V5.03.01  07/06/1995  Greg Horvat
.*                  Added layout 21 - Coast Health Care
.*        V5.03.02  08/06/1995  Greg Horvat      SRF136820
.*                  Changed Epworths labels layout to be the same as Epworths
.*                  labels layout in 6.03.
.*        V5.03.03  14/06/1995  Greg Horvat      SRF 136820
.*                  Added layout 21 - St. Vincents Bathurst
.*        V5.03.04  26/07/1995  Greg Horvat
.*                  Added layout 23 - Mersey
.*        V5.03.05  18/12/1995  Greg Horvat      Quote 8591
.*                  Changed Taranakis labels to print the number of medical
.*                  warnings for each patient
.*        V5.03.06  21/03/1996  Greg Horvat      SRF 614615
.*                  Changed WGH armband labels to print the name in surname,
.*                  title, given name sequence
.*        V5.04.01  15/07/1996  Steve Armstrong   SRF 641467              
.*                  Added layout 24 - Mercy Dunedin
.*        V5.04.02  13/08/1996  Steve Armstrong   SRF 641899
.*                  Removed religion description from Mercy Dundedin I/P label
.*
.******************************************************************************
.
PATSETLB  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,EIGHTY;*229,PTCNDATE
          BRANCH    CTYPLAB,SETLAB1,SETLAB2,SETLAB3,SETLAB2,SETLAB4:
                            SETLAB6,SETLAB7,SETLAB8,SETLAB9,SETLAB10:
                            SETLAB11,SETLAB12,SETLAB13,LAB0IN,SETLAB15:
                            SETLAB16,SETLAB17,SETLAB18,SETLAB2,SETLAB20:
                            SETLAB21,SETLAB22,SETLAB23,SETLAB24,SETLAB25:
                            SETLAB26,SETLAB27
.
.          Label Format 0:
.          Generate the data needed for the first patient label
.
LAB0IN    PACK      WGLINE1,SP30,SP10
          MOVE      PSNAME,WGLINE1
.
          CALL      FINDEND
          APPEND    SP2,WGLINE1
          APPEND    PTITL,WGLINE1
.
          CALL      FINDEND
          APPEND    SP1,WGLINE1
.
          CALL      GET1NAM
          APPEND    KEY25,WGLINE1
          RESET     WGLINE1,27
          APPEND    AURNO,WGLINE1
          RESET     WGLINE1
.
.          Set up second line of First label
.
          UNPACK    PBDATE,XCENT,XYEAR,XMON,XDAY
          CLEAR     WGLINE2
          APPEND    "DOB: ",WGLINE2
          APPEND    XDAY,WGLINE2
          APPEND    "/",WGLINE2
          APPEND    XMON,WGLINE2
          APPEND    "/",WGLINE2
          APPEND    XYEAR,WGLINE2
          APPEND    SP2,WGLINE2
          APPEND    "DOC: ",WGLINE2
          MOVE      ADOCTA,KEY6
          CALL      RDDOCT1
          BRANCH    OVRCD,EWGLINE2
.
          MOVE      DGNAME,ANS
          APPEND    ANS,WGLINE2
          APPEND    ".",WGLINE2
          APPEND    DSNAME,WGLINE2
EWGLINE2  RESET     WGLINE2
          MOVE      SP30,WGLINE3
          APPEND    SP10,WGLINE3
.
.          Set up the main label lines
.
          MOVE      CNAME,WLINE1            * Company name from common
          RESET     WLINE1,25
          APPEND    "  --UR--",WLINE1
          RESET     WLINE1
          PACK      WLINE2,PSNAME,SP1,PTITL,SP1,AURNO
.
          PACK      WLINE3,PGNAME,SP10
          PACK      WLINE4,PADD1,SP5,ATYPE
          PACK      WLINE5,PADD2,SP1,PPOST,SP3
.
          CLEAR     WLINE6
          APPEND    "DOB: ",WLINE6
          APPEND    XDAY,WLINE6
          APPEND    "/",WLINE6
          APPEND    XMON,WLINE6
          APPEND    "/",WLINE6
          APPEND    XYEAR,WLINE6
.
.
.* ****************************************** Start of Changes         *C-49016
          MOVE      PSEX,DSEXCHAR
          CALL      SEXDSC00                * get sex description (in IBACOMN)
.                                           *       returns DSEXDESC & DSEXNO
          REP       UPPLOW,DSEXDESC
          APPEND    SP2,WLINE6
          APPEND    DSEXDESC,WLINE6
.* ******************************************   End of Changes         *C-49016
.
WLCONT1   MOVE      "M ",TCODE
          PACK      KEY5,TCODE,PMSTAT
          CALL      RDCODE1
          BRANCH    OVRCD,WLCONT2
.
          APPEND    TDESC,WLINE6
WLCONT2   APPEND    SP30,WLINE6
          RESET     WLINE6
.
          CLEAR     WLINE7
          APPEND    "MEDI:",WLINE7
          MATCH     SP10,PMEDI
          GOTO      WLCONT3 IF EQUAL
.
          UNPACK    PMEDI,KEY4,KEY5,ANS
          APPEND    KEY4,WLINE7
          APPEND    "-",WLINE7
          APPEND    KEY5,WLINE7
          APPEND    "-",WLINE7
          APPEND    ANS,WLINE7
          GOTO      WLCONT4
.
WLCONT3   APPEND    SP12,WLINE7
.
WLCONT4   APPEND    "     ADM:",WLINE7
          APPEND    AADMNO,WLINE7
          RESET     WLINE7
.
          CLEAR     WLINE8
          APPEND    "PEN:",WLINE8
          APPEND    PPENNO,WLINE8
          APPEND    " DOC:",WLINE8
          MOVE      ADOCTA,KEY6
          CALL      RDDOCT1
          BRANCH    OVRCD,WLCONT5
.
          MOVE      DGNAME,ANS
          APPEND    ANS,WLINE8
          APPEND    ".",WLINE8
          APPEND    DSNAME,WLINE8
WLCONT5   APPEND    SP30,WLINE8
          RESET     WLINE8
          RETURN
+
.
.          Label Format 1
.
SETLAB1   MOVE      SP30,WGLINE1
          MOVE      PSNAME,WGLINE1
          CALL      FINDEND
          APPEND    SP2,WGLINE1
          CALL      GET1NAM
          APPEND    KEY25,WGLINE1
          RESET     WGLINE1
.
          MOVE      WGLINE1,WLINE1A
          RESET     WLINE1A,28
          APPEND    SP1,WLINE1A
          APPEND    PTITL,WLINE1A
          APPEND    SP4,WLINE1A
          RESET     WLINE1A
.
          PACK      WLINE2A,SP30,SP10
          UNPACK    PBDATE,XCENT,XYEAR,XMON,XDAY
          CLEAR     WLINE2A
          APPEND    "DOB: ",WLINE2A
          APPEND    XDAY,WLINE2A
          APPEND    "/",WLINE2A
          APPEND    XMON,WLINE2A
          APPEND    "/",WLINE2A
          APPEND    XYEAR,WLINE2A
.
.
.* ****************************************** Start of Changes         *C-49016
          MOVE      PSEX,DSEXCHAR
          CALL      SEXDSC00                * get sex description (in IBACOMN)
.                                           *       returns DSEXDESC & DSEXNO
          REP       UPPLOW,DSEXDESC
          APPEND    SP1,WLINE2A
          APPEND    DSEXDESC,WLINE2A
.* ******************************************   End of Changes         *C-49016
.
WLCONT1A  APPEND    SP3,WLINE2A
          APPEND    "UR:",WLINE2A
          APPEND    AURNO,WLINE2A
          APPEND    SP4,WLINE2A
          RESET     WLINE2A
.
          PACK      WLINE3A,SP30,SP30
          CLEAR     WLINE3A
          MOVE      ADOCTA,KEY6
          CALL      RDDOCT1
          BRANCH    OVRCD,WLCONT4A
.
          MOVE      DTITL,KEY4
          APPEND    KEY4,WLINE3A
          APPEND    SP1,WLINE3A
          MOVE      DGNAME,ANS
          APPEND    ANS,WLINE3A
          APPEND    ".",WLINE3A
          APPEND    DSNAME,WLINE3A
          APPEND    SP30,WLINE3A
          RESET     WLINE3A,23
          APPEND    "DOC:",WLINE3A
          APPEND    DCODE,WLINE3A
.
WLCONT4A  APPEND    SP30,WLINE3A
          APPEND    SP10,WLINE3A    * To pad out the line if no doctor known
          RESET     WLINE3A
          REP       " .",WLINE3A
          MOVE      "/",ANS
          MOVE      SP7,KEY7
          PACK      KEY30,AADMNO,SP30
          CALL      RDSTRAN2
WLLOOP2A  CALL      RDKTRAN2
          BRANCH    OVRCD,WLCONT5A
.
          MATCH     AADMNO,TADMN
          GOTO      WLCONT5A IF NOT EQUAL
.
          PACK      KEY7,TWARD,ANS,TBED
          GOTO      WLLOOP2A
.
WLCONT5A  PACK      WLINE4A,SP30,SP10
          CLEAR     WLINE4A
          APPEND    PADD1,WLINE4A
          RESET     WLINE4A,25
          APPEND    SP2,WLINE4A
          APPEND    ACLAIM,WLINE4A
          APPEND    SP1,WLINE4A
          APPEND    KEY7,WLINE4A
          APPEND    SP30,WLINE4A
          RESET     WLINE4A
.
          PACK      WLINE5A,SP30,SP10
          CLEAR     WLINE5A
          APPEND    PADD2,WLINE5A
          RESET     WLINE5A,25
          APPEND    SP2,WLINE5A
          APPEND    AFUNDH,WLINE5A
          APPEND    SP2,WLINE5A
          APPEND    PREG,WLINE5A
          RESET     WLINE5A
.
          PACK      WLINE6A,SP30,SP10
          CLEAR     WLINE6A
          APPEND    PSUBRB,WLINE6A
          RESET     WLINE6A,15
          APPEND    SP6,WLINE6A
          APPEND    PPOST,WLINE6A
          MOVE      THREE,DIM1
          CALL      GCCARD00                         * Get DVA card number
          MATCH     SP20,PMCDCNUM
          GOTO      WLCONT6A IF EQUAL
.
          APPEND    " R ",WLINE6A
          APPEND    PMCDCNUM,WLINE6A
          GOTO      WLCONT7A
.
WLCONT6A  MATCH     SP10,PPENNO
          GOTO      WLCONT7A IF EQUAL
.
          APPEND    " P ",WLINE6A
          APPEND    PPENNO,WLINE6A
WLCONT7A  APPEND    SP30,WLINE6A
          RESET     WLINE6A
.
          PACK      WLINE7A,SP30,SP10
          CLEAR     WLINE7A
          MOVE      DCODE,KEY6
          CALL      RDDOCT1
          BRANCH    OVRCD,WLLOOP0A
.
          APPEND    "PRES:",WLINE7A
.         MOVE      DNHSNO,KEY6
          APPEND    KEY6,WLINE7A
          APPEND    SP1,WLINE7A
          GOTO      WLLOOP1A
.
WLLOOP0A  MOVE      SP12,WLINE7A
WLLOOP1A  MOVE      ADOCTT,KEY6
          CALL      RDDOCT1
          BRANCH    OVRCD,WLCONT9A
.
          MOVE      DTITL,KEY4
          APPEND    KEY4,WLINE7A
          APPEND    SP1,WLINE7A
.
.          Get the first two initials of the doctor
.
          MOVE      DGNAME,KEY25
          MOVE      KEY25,ANS
          APPEND    ANS,WLINE7A
          APPEND    ".",WLINE7A
WLLOOP3A  BUMP      KEY25
          GOTO      WLCONT8A IF EOS
.
          CMATCH    SP1,KEY25
          GOTO      WLLPEN3A IF EQUAL
.
          CMATCH    ".",KEY25
          GOTO      WLLPEN3A IF EQUAL
.
          GOTO      WLLOOP3A
.
WLLPEN3A  BUMP      KEY25
          GOTO      WLCONT8A IF EOS
.
          CMATCH    SP1,KEY25
          GOTO      WLLPEN3A IF EQUAL
.
          CMATCH    ".",KEY25
          GOTO      WLLPEN3A IF EQUAL
.
          MOVE      KEY25,ANS
          APPEND    ANS,WLINE7A
          APPEND    ".",WLINE7A
WLCONT8A  APPEND    DSNAME,WLINE7A
WLCONT9A  APPEND    SP30,WLINE7A
          APPEND    SP10,WLINE7A
          RESET     WLINE7A
.
          UNPACK    ADATE,XCENT,XYEAR,XMON,XDAY
          PACK      WLINE8A,SP30,SP10
          CLEAR     WLINE8A
          APPEND    "ADM: ",WLINE8A
          APPEND    XDAY,WLINE8A
          APPEND    "/",WLINE8A
          APPEND    XMON,WLINE8A
          APPEND    "/",WLINE8A
          APPEND    XYEAR,WLINE8A
          APPEND    SP12,WLINE8A
          APPEND    "ADM: ",WLINE8A
          APPEND    AADMNO,WLINE8A
          RESET     WLINE8A
.
          RETURN
.
.          Label Format 2:
.          Generate the data needed for the first patient label
.
SETLAB2   PACK      WGLINE1,SP30,SP10
          MOVE      SP30,KEY15
          MOVE      PSNAME,KEY15
          CLEAR     WGLINE1
          APPEND    KEY15,WGLINE1
          APPEND    SP1,WGLINE1
          APPEND    PTITL,WGLINE1
          RESET     WGLINE1
.
          PACK      WGLINE2,SP30,SP10
          MOVE      PGNAME,KEY10
          CLEAR     WGLINE2
          APPEND    KEY10,WGLINE2
          APPEND    PURNO,WGLINE2
          APPEND    SP1,WGLINE2
          APPEND    PREG,WGLINE2
          RESET     WGLINE2
.
          PACK      WGLINE3,SP30,SP10
          CLEAR     WGLINE3
.
          MOVE      ADOCTA,KEY6
          CALL      RDDOCT1
          BRANCH    OVRCD,MERCY10
.
          MOVE      DGNAME,ANS
          APPEND    DTITL,WGLINE3
          CALL      FINEND
.
          APPEND    SP1,WGLINE3
          APPEND    ANS,WGLINE3
          APPEND    ".",WGLINE3
          APPEND    DSNAME,WGLINE3
.
MERCY10   PACK      WLINE1,SP30,SP10
          CLEAR     WLINE1
          APPEND    PSNAME,WLINE1
          CALL      FINEND1
          APPEND    SP1,WLINE1
          APPEND    PTITL,WLINE1
          CALL      FINEND1
          APPEND    SP1,WLINE1
          APPEND    PGNAME,WLINE1
          RESET     WLINE1
.
          CLEAR     WLINE2
          MOVE      PADD1,KEY25
          APPEND    KEY25,WLINE2
          APPEND    SP1,WLINE2
          IF        CTYPLAB = 4 | CTYPLAB = 19
            APPEND    AWARD,WLINE2
          ELSE
            APPEND    PREG,WLINE2
          ENDIF
.
MERCY10A  APPEND    SP1,WLINE2
          APPEND    PSEX,WLINE2
          RESET     WLINE2
.
          CLEAR     WLINE3
          APPEND    PADD2,WLINE3
          CALL      FINEND3
          MOVEFPTR  WLINE3,FORM2
          IF        FORM2 > 18
            RESET     WLINE3,18
          ENDIF
          APPEND    SP1,WLINE3
          APPEND    PPOST,WLINE3
.
          RESET     WLINE3,24
          UNPACK    PBDATE,XCENT,XYEAR,XMON,XDAY
          APPEND    XDAY,WLINE3
          APPEND    "/",WLINE3
          APPEND    XMON,WLINE3
          APPEND    "/",WLINE3
          APPEND    XYEAR,WLINE3
          RESET     WLINE3
.
          CLEAR     WLINE4
          MOVE      ADOCTA,KEY6
          CALL      RDDOCT1
          BRANCH    OVRCD,MERCY50
.
          APPEND    DTITL,WLINE4
          CALL      FINEND4
          APPEND    SP1,WLINE4
          MOVE      DGNAME,ANS
          APPEND    ANS,WLINE4
          APPEND    ".",WLINE4
          CALL      GIVNAM
          APPEND    DSNAME,WLINE4
          IF        CTYPLAB <> 19
            RESET     WLINE4,24
            APPEND    DTELES,WLINE4
          ENDIF
.
MERCY50   APPEND    SP30,WLINE4
          RESET     WLINE4
.
          PACK      WLINE5,SP30,SP10
          CLEAR     WLINE5
.
.         Check for Greenslopes label format.  They only differ on 5th line
.
          IF        CTYPLAB=19
            OPEN      PATNIDA1,"patnidaf"
            PACK      KEY10,CHOSINDX,AURNO
            CALL      RDPTNID1
            IF        OVRCD = 0
              SQUEEZE   PTNINMPI
              APPEND    PTNINMPI,WLINE5
            ELSE
              APPEND    SP20,WLINE5
            ENDIF
            CLOSE     PATNIDA1
            RESET     WLINE5,12
            APPEND    "UR:",WLINE5
            MOVE      AURNO,KEY8
            UNPACK    KEY8,ANS,KEY7
            APPEND    KEY7,WLINE5
            APPEND    SP8,WLINE5
.
            MATCH     ZEROVISN,AADMNO
            IF        !@EQUAL
              RESET     WLINE5,23
              APPEND    "AD:",WLINE5
              MOVE      AADMNO,KEY8
              UNPACK    KEY8,ANS,KEY7
              APPEND    KEY7,WLINE5
            ENDIF
            APPEND    SP30,WLINE5
            RESET     WLINE5
            RETURN
          ENDIF
.
.         Continue with other layouts
.
          MATCH     SP10,PPENNO
          GOTO      MERCY60 IF EQUAL
.
          APPEND    PPENNO,WLINE5
          GOTO      MERCY70
.
MERCY60   MOVE      THREE,DIM1
          CALL      GCCARD00                      * Get DVA card number
          MATCH     SP20,PMCDCNUM
          GOTO      MERCY63 IF EQUAL
.
          APPEND    PMCDCNUM,WLINE5
          GOTO      MERCY70
.
MERCY63   UNPACK    SP5,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5
          MOVE      "CL",TCODE
          PACK      KEY5,TCODE,ACLAIM
          CALL      RDCODE1
.
          MOVE      ZERO,FORM2
CLLP1     ADD       ONE,FORM2
          COMPARE   SIX,FORM2
          GOTO      MERCY68 IF NOT LESS
.
          LOAD      ANS,FORM2,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5
.
          CMATCH    "W",ANS
          GOTO      MERCY65 IF EQUAL
          CMATCH    "M",ANS
          GOTO      MERCY64 IF EQUAL
.
          GOTO      CLLP1
.
MERCY64   APPEND    "MAB",WLINE5
          GOTO      MERCY68
.
MERCY65   APPEND    "W/C",WLINE5
.
MERCY68   APPEND    SP12,WLINE5
.
MERCY70   RESET     WLINE5,10
          APPEND    "UR:",WLINE5
          APPEND    AURNO,WLINE5
          APPEND    SP8,WLINE5
.
          RESET     WLINE5,21
          APPEND    "ADM:",WLINE5
          APPEND    AADMNO,WLINE5
          APPEND    SP8,WLINE5
          RESET     WLINE5
          RETURN
.
.          Label Format 3:
.
SETLAB3   PACK      WLINE1,SP30,SP10
          MOVE      PSNAME,WLINE1
.
          RESET     WLINE1,20
          CALL      FINEND1
          APPEND    SP2,WLINE1
          APPEND    PTITL,WLINE1
.
          CALL      FINEND1
          APPEND    SP1,WLINE1
.
          CALL      GET1NAM
          APPEND    KEY25,WLINE1
          RESET     WLINE1,26
          APPEND    SP1,WLINE1
          APPEND    AURNO,WLINE1
          RESET     WLINE1
.
.          Check if there is an attending doctor, and if so, get the details
.
          MOVE      SP30,DSNAME
          MOVE      ADOCTA,KEY6
          CALL      RDDOCT1
.
          UNPACK    PBDATE,XCENT,XYEAR,XMON,XDAY
          PACK      WGLINE1,XDAY,SLASH,XMON,SLASH,XYEAR,SP1,DSNAME,SP30
.
          BRANCH    OVRCD,SLINE3
.
          CALL      FINDEND
.
          APPEND    SP1,WGLINE1
          APPEND    DTITL,WGLINE1
          CALL      FINDEND
          APPEND    SP1,WGLINE1
.
.          Get the first two initials of the doctor
.
          MOVE      DGNAME,KEY25
          MOVE      KEY25,ANS
          APPEND    ANS,WGLINE1
          APPEND    ".",WGLINE1
SLINE0    BUMP      KEY25
          GOTO      SLINE2 IF EOS
          CMATCH    SP1,KEY25
          GOTO      SLINE1 IF EQUAL
          CMATCH    ".",KEY25
          GOTO      SLINE1 IF EQUAL
          GOTO      SLINE0              * Continue scanning first name
.
SLINE1    BUMP      KEY25
          GOTO      SLINE2 IF EOS
          CMATCH    SP1,KEY25
          GOTO      SLINE1 IF EQUAL
          CMATCH    ".",KEY25
          GOTO      SLINE1 IF EQUAL
.
          MOVE      KEY25,ANS
          APPEND    ANS,WGLINE1
          APPEND    ".",WGLINE1
.
SLINE2    APPEND    SP30,WGLINE1
          RESET     WGLINE1
SLINE3    MOVE      WGLINE1,WLINE2
.
          PACK      WLINE3,PADD1,SP10
          RESET     WLINE3,27
.
.
.* ****************************************** Start of Changes         *C-49016
          MOVE      PSEX,DSEXCHAR
          CALL      SEXDSC00                * get sex description (in IBACOMN)
.                                           *       returns DSEXDESC & DSEXNO
          REP       UPPLOW,DSEXDESC
          APPEND    DSEXDESC,WLINE3
.* ******************************************   End of Changes         *C-49016
.
SLINE4    RESET     WLINE3
.
          CLEAR     WLINE4
          APPEND    PADD2,WLINE4
          RESET     WLINE4,22
          APPEND    SP1,WLINE4
          APPEND    "ADM:",WLINE4
          APPEND    AADMNO,WLINE4
          RESET     WLINE4
.
          PACK      WLINE5,PSUBRB,PPOST,SP1,PREG,PPENNO
.
          RETURN
.
.          Label Format 4:
.
SETLAB4   PACK      WLINE1,SP30,SP10
          CLEAR     WLINE1
          APPEND    PSNAME,WLINE1
          CALL      FINEND1
.
          APPEND    SP1,WLINE1
          APPEND    PTITL,WLINE1
.
          RESET     WLINE1,21
          APPEND    SP1,WLINE1
          APPEND    PSEX,WLINE1
          APPEND    " UR",WLINE1
          APPEND    PURNO,WLINE1
.
          MOVE      SP1,ANS
          LOAD      ANS,PCASE,CCNOTES
          APPEND    ANS,WLINE1
          RESET     WLINE1
.
.          Line Two
.
          MOVE      PGNAME,KEY15
          CLEAR     WLINE2
          APPEND    KEY15,WLINE2
          APPEND    SP1,WLINE2
.
          UNPACK    PBDATE,XCENT,XYEAR,XMON,XDAY
          RESET     WLINE2,16
          APPEND    XDAY,WLINE2
          APPEND    "/",WLINE2
          APPEND    XMON,WLINE2
          APPEND    "/",WLINE2
          APPEND    XCENT,WLINE2
          APPEND    XYEAR,WLINE2
.
          MOVE      SP20,TDESC
          MATCH     SP3,ACLAIM
          GOTO      NOCLM IF EQUAL
.
          PACK      KEY5,ANSC,ANSL,ACLAIM
          CALL      RDCODE1
.
NOCLM     RESET     WLINE2,27
          APPEND    TDESC,WLINE2
          RESET     WLINE2
.
.          Line Three
.
          CLEAR     WLINE3
          APPEND    PADD1,WLINE3
          CALL      FINEND3
.
          APPEND    SP1,WLINE3
          APPEND    PADD2,WLINE3
          CALL      FINEND3
.
          APPEND    SP1,WLINE3
          APPEND    PSUBRB,WLINE3
.
          RESET     WLINE3,28
          APPEND    SP1,WLINE3
          APPEND    PPOST,WLINE3
          RESET     WLINE3
.
.          Line Four
.
          CLEAR     WLINE4
          APPEND    ADOCTA,WLINE4
          CALL      FINEND4
.
          APPEND    SP1,WLINE4
          MOVE      ADOCTA,KEY6
          CALL      RDDOCT1
          APPEND    DSNAME,WLINE4
          CALL      FINEND4
          APPEND    ",",WLINE4
          MOVE      DGNAME,ANS
          APPEND    ANS,WLINE4
          APPEND    SP1,WLINE4
.
          RESET     WLINE4,22
          APPEND    AWARD,WLINE4
          APPEND    "/",WLINE4
          APPEND    ABED,WLINE4
.
          MOVE      SP2,KEY2
          MATCH     SP3,ATYPE
          GOTO      NOPTYP IF EQUAL
.
          PACK      KEY5,ANSA,SP1,ATYPE
          CALL      RDCODE1
          BRANCH    OVRCD,NOPTYP
.
          MOVE      HPDES,KEY2
          MOVE      TCINDC1,FORM1
          LOAD      KEY2,FORM1,HPDES,PPDES
.
NOPTYP    RESET     WLINE4,31
          APPEND    KEY2,WLINE4
          RESET     WLINE4
.
.          Line Five
.
          CLEAR     WLINE5
          APPEND    PMEDI,WLINE5
          APPEND    SP3,WLINE5
          APPEND    PREG,WLINE5
          APPEND    "     INPAT:",WLINE5
          APPEND    AADMNO,WLINE5
          RESET     WLINE5
          RETURN
.
.          Label Format 6:
.
SETLAB6   COMPARE   ONE,ASTAT
          CALL      ASKWARD IF EQUAL
.
.          Line 1
.
          PACK      WLINE1A,SP30,SP10
          CLEAR     WLINE1A
.
          APPEND    PSNAME,WLINE1A            * Patient's Surname
          RESET     WLINE1A,21
.
          OPEN      CONTROLF,"controlf"
.
          READ      CONTROLF,TEN3;*213,CHCSCOD
.
          MOVE      SP1,ANS
          MOVE      CHCSCOD,ANS
          APPEND    SP1,WLINE1A               * Hospital I.D.
          APPEND    ANS,WLINE1A
.
          APPEND    SP1,WLINE1A               * Ward
          APPEND    AWARD,WLINE1A
.
          MOVE      SP3,ACODE
          PACK      KEY5,ANSP,SP1,ACLSS
          CALL      RDCODE1
          MOVE      ACODE,ANS                 * First Char. of Admiss Class
          APPEND    SP1,WLINE1A
          APPEND    ANS,WLINE1A
.
          APPEND    SP1,WLINE1A
          APPEND    PURNO,WLINE1A
          RESET     WLINE1A
.
.          Line Two
.
          PACK      WLINE2A,SP30,SP10
          CLEAR     WLINE2A
.
          APPEND    PGNAME,WLINE2A            * Patients Given Name
          RESET     WLINE2A,17
.
          APPEND    SP1,WLINE2A               * Patients Title
          APPEND    PTITL,WLINE2A
.
          APPEND    SP1,WLINE2A               * Patients Sex
          APPEND    PSEX,WLINE2A
.
          APPEND    SP1,WLINE2A               * Patient's Age
          IF        PTCNDATE=1
            CALL      IBACLOCK
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE
            REP       UPPLOW,PSAGETYP
            APPEND    PSAGECON,WLINE2A
            APPEND    PSAGETYP,WLINE2A
          ELSE
            APPEND    PSAGE,WLINE2A
          ENDIF
.
          UNPACK    SP10,XYEAR,XMON,XDAY      * Patient's Birth Date
          UNPACK    PBDATE,XCENT,XYEAR,XMON,XDAY
          REP       " 0",XDAY
          REP       " 0",XMON
          REP       " 0",XYEAR
          APPEND    SP1,WLINE2A
          APPEND    XDAY,WLINE2A
          APPEND    SLASH,WLINE2A
          APPEND    XMON,WLINE2A
          APPEND    SLASH,WLINE2A
          APPEND    XYEAR,WLINE2A
          RESET     WLINE2A
.
.          Line Three
.
          PACK      WLINE3A,SP30,SP10
          CLEAR     WLINE3A
.
          APPEND    PADD1,WLINE3A             * Patient's Address
          CALL      FINEND3A
.
          APPEND    SP1,WLINE3A
          APPEND    PADD2,WLINE3A
          CALL      FINEND3A
.
          APPEND    SP1,WLINE3A
          APPEND    PSUBRB,WLINE3A
          CALL      FINEND3A
.
          UNPACK    PPOST,KEY2,ANS,ANS
          MATCH     "BD",KEY2
          GOTO      RESNZ3 IF EQUAL
.
          APPEND    SP1,WLINE3A
          APPEND    PPOST,WLINE3A
.
RESNZ3    RESET     WLINE3A
.
.          Line Four
.
          PACK      WLINE4A,SP30,SP10
          CLEAR     WLINE4A
.
          MOVE      ADOCTA,KEY6               * Attending Doctor
          CALL      RDDOCT1
          BRANCH    OVRCD,NODOCTOR
.
          MOVE      DGNAME,ANS
          APPEND    ANS,WLINE4A
          APPEND    DOT,WLINE4A
          APPEND    DSNAME,WLINE4A
          RESET     WLINE4A,15
          GOTO      GOTDOCTR
NODOCTOR  APPEND    SP20,WLINE4A
          RESET     WLINE4A,15
GOTDOCTR  APPEND    SP2,WLINE4A               * Admission Number
          APPEND    AADMNO,WLINE4A
.
          UNPACK    SP10,XYEAR,XMON,XDAY      * Admission Date
          UNPACK    ADATE,XCENT,XYEAR,XMON,XDAY
          REP       " 0",XDAY
          REP       " 0",XMON
          REP       " 0",XYEAR
          APPEND    SP1,WLINE4A
          APPEND    XDAY,WLINE4A
          APPEND    SLASH,WLINE4A
          APPEND    XMON,WLINE4A
          APPEND    SLASH,WLINE4A
          APPEND    XYEAR,WLINE4A
.
          APPEND    SP1,WLINE4A               * Admission Class
          APPEND    ACARE,WLINE4A
          RESET     WLINE4A
.
.          Line Five
.
          PACK      WLINE5A,SP30,SP10
          CLEAR     WLINE5A
.
          UNPACK    PPOST,KEY2,ANS,ANS
          MATCH     "BD",KEY2
          GOTO      NOBOARD IF NOT EQUAL
.
          UNPACK    PPOST,ANS,ANS,KEY2
          APPEND    KEY2,WLINE5A              * Reffering Board Number
          GOTO      GOTBOARD
NOBOARD   APPEND    SP2,WLINE5A               * Blank Referring Board
GOTBOARD  MOVE      SP4,THCSCOD
          PACK      KEY5,ANSC,ONE,AUSR1
          CALL      RDCODE1
          APPEND    SP1,WLINE5A               * Area
          APPEND    THCSCOD,WLINE5A
          RESET     WLINE5A,6
.
          APPEND    SP1,WLINE5A
          APPEND    PLOCDOC,WLINE5A
          APPEND    SP30,WLINE5A
          RESET     WLINE5A,26
.
          APPEND    SP1,WLINE5A               * Race
          APPEND    PUSR1,WLINE5A
.
          APPEND    SP1,WLINE5A               * Marital Status
          APPEND    PMSTAT,WLINE5A
.
          APPEND    SP1,WLINE5A               * Religion
          APPEND    PREG,WLINE5A
          RESET     WLINE5A
.
          RETURN
.
.*******************************************************************************
.*        Southland/New Zealand Format                                         *
.*******************************************************************************
.
. ------- Line 1 -------
.
SETLAB7   COMPARE   ONE,ASTAT
          CALL      ASKWARD IF EQUAL
.
          PACK      WLINE1,SP20,SP20        * Clear print line
          CLEAR     WLINE1                  * Reset form pointer to 0
          APPEND    SP1,WLINE1              * 1 space to start with
          APPEND    PSNAME,WLINE1           * Surname
          IF        CTYPEUR = 2
            RESET     WLINE1,16             * Reset to position 16
            APPEND    SP1,WLINE1            * Space in between
            APPEND    PTITL,WLINE1          * Title
            APPEND    SP1,WLINE1            * Space in between
            APPEND    "UR:",WLINE1          * Heading desc
            RESET     PURNO,3               * Set pointer to 1st char of U/R
            APPEND    PURNO,WLINE1          * U/R number
            RESET     PURNO,1               * Reset pointer back again on U/R
            RESET     WLINE1                * Reset form pointer to 1
          ELSE
            RESET     WLINE1,14             * Reset to position 14
            APPEND    SP1,WLINE1            * Space in between
            APPEND    PTITL,WLINE1          * Title
            APPEND    SP1,WLINE1            * Space in between
            APPEND    "UR:",WLINE1          * Heading desc
            APPEND    PURNO,WLINE1          * U/R number
            RESET     WLINE1                * Reset form pointer to 1
          ENDIF
.
. ------- Line 2 -------
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          PACK      WLINE2,SP20,SP20        * Clear print line
          CLEAR     WLINE2                  * Reset form pointer to 0
          APPEND    SP1,WLINE2              * 1 space to start with
          APPEND    PGNAME,WLINE2           * Given Name
          RESET     WLINE2,16               * Reset to position 16
          APPEND    SP1,WLINE2              * Space in between
          APPEND    PSEX,WLINE2             * Sex (1 char)
          APPEND    SP1,WLINE2              * Space in between
          APPEND    CDAY,WLINE2             * Birth day
          APPEND    SLASH,WLINE2            * Date separator
          APPEND    CMON,WLINE2             * Birth month
          APPEND    SLASH,WLINE2            * Date separator
          APPEND    CYEAR,WLINE2            * Birth year
          APPEND    SP1,WLINE2              * Space in between
          IF        PTCNDATE=1
            CALL      IBACLOCK
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE
            REP       UPPLOW,PSAGETYP
            PACK      KEY4,PSAGECON,PSAGETYP
            SQUEEZE   KEY4
            APPEND    KEY4,WLINE2
          ELSE
            APPEND    PSAGE,WLINE2          * Age
          ENDIF
          RESET     WLINE2                  * Reset form pointer to 1
.
. ------- Line 3 -------
.
          PACK      WLINE3,SP20,SP20        * Clear print line
          CLEAR     WLINE3                  * Reset form pointer to 0
          APPEND    SP1,WLINE3              * 1 space to start with
          APPEND    AWARD,WLINE3            * Ward
          APPEND    SP1,WLINE3              * Space in between
          APPEND    AADMNO,WLINE3           * Event number
          APPEND    SP1,WLINE3              * Space in between
          MATCH     SP6,ADOCTA              * Does attending doctor exist ?
          GOTO      SETLAB7C IF EQUAL        * No - no name
          PACK      KEY6,ADOCTA             * Attending Doctor's code
          CALL      RDDOCT1                  * Read doctor's file
          BRANCH    OVRCD,SETLAB7C           * No record - no name
          APPEND    DTITL,WLINE3            * Title first
          ENDSET    WLINE3                  * Set to end of used line
SETLAB7A  CMATCH    SP1,WLINE3              * Found end of title ?
          GOTO      SETLAB7B IF NOT EQUAL    * Yes - add rest of name
          BUMP      WLINE3,-1               * Move pointer back 1 char
          GOTO      SETLAB7A IF NOT EOS     * Test again for end of title
SETLAB7B  MOVE      DGNAME,ANS               * First initial
          APPEND    SP1,WLINE3              * Space in between
          APPEND    ANS,WLINE3              * Initial
          APPEND    DOT,WLINE3              * Dot
          APPEND    DSNAME,WLINE3           * Surname
          RESET     WLINE3,31               * Set to last char of label
          APPEND    SP1,WLINE3              * Final char is a space
SETLAB7C  RESET     WLINE3                  * Reset form pointer to 1
.
. ------- Line 4 -------
.
          PACK      WLINE4,SP20,SP20        * Clear print line
          CLEAR     WLINE4                  * Reset form pointer to 0
          APPEND    SP1,WLINE4              * 1 space to start with
          APPEND    PADD1,WLINE4            * 1st line of address
          ENDSET    WLINE4                  * Set pointer to end of line
SETLAB7D  CMATCH    SP1,WLINE4              * Is this a space ?
          GOTO      SETLAB7E IF NOT EQUAL    * No - found end of address
          BUMP      WLINE4,-1               * Move pointer back 1 char
          GOTO      SETLAB7D IF NOT EOS      * Test for end of address
SETLAB7E  APPEND    ",",WLINE4              * Comma between both parts of addr
          APPEND    SP1,WLINE4              * Space in between
          APPEND    PADD2,WLINE4            * 2nd line of address
          RESET     WLINE4,31               * Set to last char of label
          APPEND    SP1,WLINE4              * Final char is a space
          RESET     WLINE4                  * Reset form pointer to 1
.
. ------- Line 5 -------
.
          PACK      WLINE5,SP20,SP20        * Clear print line
          CLEAR     WLINE5                  * Reset form pointer to 0
          APPEND    SP1,WLINE5              * 1 space to start with
          APPEND    PSUBRB,WLINE5           * Suburb
          APPEND    SP3,WLINE5              * Spaces in between
          APPEND    "PH:",WLINE5            * Heading desc
          APPEND    PTELEP,WLINE5           * Private Telephone
          RESET     WLINE5,31               * Set to last char of label
          APPEND    SP1,WLINE5              * Final char is a space
          RESET     WLINE5                  * Reset form pointer to 1
.
SETLAB7Z  RETURN                             * Finished Southland Labels
.
.
.***********************************************************************
.*        Bundoora Extended Care Format                                *
.***********************************************************************
.
. ------- Line 1 -------
.
SETLAB8  
.  
          PACK      WFLINE1,SP20,SP20        * Clear print line 
          CLEAR     WFLINE1                  * Reset form pointer to 0 
          APPEND    SP1,WFLINE1              * 1 space to start with 
          APPEND    PSNAME,WFLINE1           * Surname
          RESET     WFLINE1,20               * Reset to position 20
          APPEND    SP1,WFLINE1              * Space in between
          APPEND    "BECC UR:",WFLINE1               
          APPEND    SP1,WFLINE1              * Space in between
          APPEND    PURNO,WFLINE1            * U/R number
          RESET     WFLINE1                  * Reset form pointer to 1
.
. ------- Line 2 -------
.
          PACK      WFLINE2,SP20,SP20        * Clear print line
          CLEAR     WFLINE2                  * Reset form pointer to 0
          RESET     WFLINE2
.
.-------  Line 3 ------
.
          PACK      WFLINE3,SP20,SP20        * Clear print line
          CLEAR     WFLINE3                  * Reset form pointer to 0
          APPEND    SP1,WFLINE3              * Space in between
          APPEND    PTITL,WFLINE3            * patient title
          APPEND    SP1,WFLINE3              * Space in between
          APPEND    PGNAME,WFLINE3           * patient given names
          RESET     WFLINE3
.        
.-----  Line 4 ---------
.
          PACK      WFLINE4,SP20,SP20        * Clear print line
          CLEAR     WFLINE4                  * Reset form pointer to 0
          APPEND    SP1,WFLINE4              * Space in between
          APPEND    PADD1,WFLINE4            * patient address line 1
          RESET     WFLINE4
.        
.-----  Line 5 ---------
.
          PACK      WFLINE5,SP20,SP20        * Clear print line
          CLEAR     WFLINE5                  * Reset form pointer to 0
          APPEND    SP1,WFLINE5              * Space in between
          APPEND    PADD2,WFLINE5            * patient address line 2
          RESET     WFLINE5
.        
.-----  Line 6 ---------
.
          PACK      WFLINE6,SP20,SP20        * Clear print line
          CLEAR     WFLINE6                  * Reset form pointer to 0
          APPEND    SP1,WFLINE6              * Space in between
          APPEND    PSUBRB,WFLINE6           * patient suburb
          RESET     WFLINE6,34
          APPEND    PPOST,WFLINE6            * patient postcode
          RESET     WFLINE6
.        
.-----  Line 7 ---------
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
.
          PACK      WFLINE7,SP20,SP20        * Clear print line
          CLEAR     WFLINE7                  * Reset form pointer to 0
          APPEND    SP1,WFLINE7              * Space in between
          APPEND    "TEL:",WFLINE7   
          APPEND    SP1,WFLINE7              * Space in between
          APPEND    PTELEP,WFLINE7           * patient home phone number
          RESET     WFLINE7,23
          APPEND    "DOB:",WFLINE7   
          APPEND    SP1,WFLINE7              * Space in between
          APPEND    CDAY,WFLINE7
          APPEND    SLASH,WFLINE7
          APPEND    CMON,WFLINE7
          APPEND    SLASH,WFLINE7
          APPEND    CCENT,WFLINE7
          APPEND    CYEAR,WFLINE7
          RESET     WFLINE7
.      
.----- Line 8  ------------
.
          PACK      WFLINE8,SP20,SP20        * Clear print line
          CLEAR     WFLINE8                  * Reset form pointer to 0
          APPEND    SP1,WFLINE8              * Space in between
          APPEND    "SEX:",WFLINE8
          APPEND    SP1,WFLINE8              * Space in between
.
.
.* ****************************************** Start of Changes         *C-49016
          MOVE      PSEX,DSEXCHAR
          CALL      SEXDSC00                * get sex description (in IBACOMN)
.                                           *       returns DSEXDESC & DSEXNO
          APPEND    DSEXDESC,WFLINE8
.* ******************************************   End of Changes         *C-49016
.
SETLAB89  RESET     WFLINE8
          RETURN
.
.
.*****************************************************************************
.*                Label for Anne Caudle                                      *
.*****************************************************************************
.
. ------- Line 1 -------
.
SETLAB9  
.  
          PACK      WFLINE1,SP20,SP20        * Clear print line 
          CLEAR     WFLINE1                  * Reset form pointer to 0 
          APPEND    SP20,WFLINE1             * Surname
          RESET     WFLINE1,20               * Reset to position 20
          APPEND    SP1,WFLINE1              * Space in between
          APPEND    "UR ",WFLINE1               
          APPEND    PURNO,WFLINE1            * U/R number
          RESET     WFLINE1                  * Reset form pointer to 1
.
. ------- Line 2A -------
.
          PACK      WLINE2A,SP20,SP20        * Clear print line
          CLEAR     WLINE2A                  * Reset form pointer to 0
          APPEND    SP20,WLINE2A
          APPEND    SP9,WLINE2A
.
          MOVE      SP20,TDESC
          PACK      ACLAIM,ACLAIM,SP3
          MATCH     SP3,ACLAIM
          GOTO      SETLAB9A IF EQUAL
.
          MOVE      "CL",TCODE
          PACK      KEY5,TCODE,ACLAIM
          CALL      RDCODE1
       
SETLAB9A  APPEND    TDESC,WLINE2A
          RESET     WLINE2A,32
          APPEND    SP10,WLINE2A
          RESET     WLINE2A
.
. ------- Line 2 -------
.
          PACK      WFLINE2,SP20,SP20        * Clear print line
          CLEAR     WFLINE2                  * Reset form pointer to 0
          APPEND    PSNAME,WFLINE2
          APPEND    SP9,WFLINE2
.
          MOVE      SP20,TDESC
          PACK      ACLAIM,ACLAIM,SP3
          MATCH     SP3,ACLAIM
          GOTO      SETLAB9B IF EQUAL
.
          MOVE      "CL",TCODE
          PACK      KEY5,TCODE,ACLAIM
          CALL      RDCODE1
       
SETLAB9B  APPEND    TDESC,WFLINE2
          RESET     WFLINE2,32
          APPEND    SP10,WFLINE2
          RESET     WFLINE2
.
.-------  Line 3 ------
.
          PACK      WFLINE3,SP20,SP20        * Clear print line
          CLEAR     WFLINE3                  * Reset form pointer to 0
          APPEND    PGNAME,WFLINE3           * patient given names
          RESET     WFLINE3
.        
.-----  Line 4 ---------
.
          PACK      WFLINE4,SP20,SP20        * Clear print line
          CLEAR     WFLINE4                  * Reset form pointer to 0
          APPEND    PADD1,WFLINE4            * patient address line 1
          RESET     WFLINE4
.        
.-----  Line 5 ---------
.
          PACK      WFLINE5,SP20,SP20        * Clear print line
          CLEAR     WFLINE5                  * Reset form pointer to 0
          APPEND    PADD2,WFLINE5            * patient address line 2
          RESET     WFLINE5,24
          APPEND    SP4,WFLINE5              * Space in between
          APPEND    PPOST,WFLINE5            * patient postcode
          RESET     WFLINE5
.        
.-----  Line 6 ---------
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
.
          PACK      WFLINE6,SP20,SP20        * Clear print line
          CLEAR     WFLINE6                  * Reset form pointer to 0
          APPEND    CDAY,WFLINE6
          APPEND    DOT,WFLINE6
          APPEND    CMON,WFLINE6
          APPEND    DOT,WFLINE6
          APPEND    CCENT,WFLINE6
          APPEND    CYEAR,WFLINE6
          APPEND    SP5,WFLINE6              * Space in between
          APPEND    PSEX,WFLINE6
          APPEND    SP3,WFLINE6
          APPEND    PMSTAT,WFLINE6
          RESET     WFLINE6
.        
.-----  Line 7 ---------
.
.
          PACK      WFLINE7,SP20,SP20        * Clear print line
          CLEAR     WFLINE7                  * Reset form pointer to 0
          APPEND    PMEDI,WFLINE7
          APPEND    SP5,WFLINE7
          APPEND    PPENNO,WFLINE7
          RESET     WFLINE7
.      
.----- Line 8  ------------
.
          UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY
          PACK      WFLINE8,SP20,SP20        * Clear print line
          CLEAR     WFLINE8                  * Reset form pointer to 0
          APPEND    CDAY,WFLINE8
          APPEND    DOT,WFLINE8
          APPEND    CMON,WFLINE8
          APPEND    DOT,WFLINE8
          APPEND    CYEAR,WFLINE8
          APPEND    SP3,WFLINE8
          APPEND    AWARD,WFLINE8
          APPEND    SP9,WFLINE8
.
.          Check if there is an attending doctor, and if so, get the details
.
          MOVE      SP30,DSNAME
          MOVE      ADOCTA,KEY6
          CALL      RDDOCT1
          APPEND    DSNAME,WFLINE8
          RESET     WFLINE8,36              * truncate doctors name to 13 chars
          APPEND    SP5,WFLINE8
          RESET     WFLINE8
.
.------ Set first line of the arm band label ------
.
          PACK      WFLINE9,SP30,SP10
          CLEAR     WFLINE9 
          APPEND    PSNAME,WFLINE9
          RESET     WFLINE9,13
          APPEND    SP1,WFLINE9
          APPEND    PTITL,WFLINE9
          APPEND    SP1,WFLINE9
          APPEND    PGNAME,WFLINE9
          RESET     WFLINE9,33
          APPEND    SP10,WFLINE9
          RESET     WFLINE9
.
.------ Set second line of the arm band label ------
.
          PACK      WFLINE10,SP30,SP10
          CLEAR     WFLINE10 
          APPEND    "ACC",WFLINE10
          APPEND    SP1,WFLINE10
          APPEND    "UR",WFLINE10
          APPEND    PURNO,WFLINE10
          APPEND    SP5,WFLINE10
          APPEND    AWARD,WFLINE10
          RESET     WFLINE10
          RETURN
.
.*********************************************************************
.         Label layout 10 - Hong Kong
.         each line will print 25 characters only
.*********************************************************************
SETLAB10  SETLPTR   WLINE1
          SETLPTR   WLINE2
          SETLPTR   WLINE3
          SETLPTR   WLINE4
          SETLPTR   WLINE5
          PACK      WLINE1,SP20,SP20
          PACK      WLINE2,SP20,SP20
          PACK      WLINE3,SP20,SP20
          PACK      WLINE4,SP20,SP20
          PACK      WLINE5,SP20,SP20
.
          PROC      STLBHK00                * set up WLINE1
.
          MOVE      PSNAME,PACSNAME
          MOVE      PGNAME,PACGNAME
          MOVE      SP4,PACTITLE
          MOVE      TWO,PACFRMT
          CALL      PACNAME                 * want Surname, Given names
.
.
.* ****************************************** Start of Changes         *C-49016
          MOVE      PSEX,DSEXCHAR
          CALL      SEXDSC00                * get sex description (in IBACOMN)
.                                           *       returns DSEXDESC & DSEXNO
          MOVE      DSEXDESC,KEY7
.* ******************************************   End of Changes         *C-49016
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
.
          MOVE      PACFNAME,WLINE2
.....     PACK      WLINE3,KEY7,SP6,CPCDATE,SP30                        D-49016
          PACK      WLINE3,DSEXDESC,SP5,CPCDATE,SP30                   *I-49016
          PACK      WLINE4,PURNO,SP30
.
          SETLPTR   WLINE1,25
          SETLPTR   WLINE2,25
          SETLPTR   WLINE3,25
          SETLPTR   WLINE4,25
          SETLPTR   WLINE5,25
          RETURN
+
.*********************************************************************
.         Label layout 11 - West Gippsland
.*********************************************************************
.
.------ set-up wrist band labels first ------
.
.------ WRIST BAND LINE 1 ------
.
SETLAB11  PACK      WGLINE1,SP20,SP20
          MOVE      PSNAME,PACSNAME
          MOVE      PGNAME,PACGNAME
          MOVE      PTITL,PACTITLE
          MOVE      TWO,PACFRMT
.
          CALL      PACNAME                 * pack the patient's name
.
          MOVE      PACFNAME,WGLINE1
.
.------ WRIST BAND LINE 2 ------
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          PACK      WGLINE2,SP20,SP20
          MOVE      "UR: ",WGLINE2
          ENDSET    WGLINE2
          APPEND    PURNO,WGLINE2
          APPEND    SP10,WGLINE2
          APPEND    CDAY,WGLINE2
          APPEND    SLASH,WGLINE2
          APPEND    CMON,WGLINE2
          APPEND    SLASH,WGLINE2
          APPEND    CYEAR,WGLINE2
          RESET     WGLINE2
.
.------ WRIST BAND LINE 3 ------
.
          PACK      WGLINE3,SP20,SP20
          MOVE      SP20,DSNAME
          MOVE      ADOCTA,KEY6
          CALL      RDDOCT1                 * read the doctor file
          MOVE      DSNAME,ADOCSURN
.
          MOVE      SP20,DSNAME
          MOVE      ADOCTR,KEY6
          CALL      RDDOCT1                 * read the doctor file
          MOVE      DSNAME,RDOCSURN
.
          STRIP     RDOCSURN
          IF        @EOS
            MOVE      SLASH,WGLINE3
            ENDSET    WGLINE3
            APPEND    ADOCSURN,WGLINE3
          ELSE
            MOVE      RDOCSURN,WGLINE3
            ENDSET    WGLINE3
            APPEND    SLASH,WGLINE3
            APPEND    ADOCSURN,WGLINE3
          ENDIF
          RESET     WGLINE3
.
.------ set-up patient labels ------
.
.------ PATIENT LABEL LINE 1 ------
.
          MOVE      PSNAME,BOLDSURN
          CLEAR     BOLDUR
          MOVE      ONE,FORM1
.
.------ set up the double spacing of the U/R Number ------
.
          REPEAT
            RESET      PURNO,FORM1
            LENSET     PURNO
            CMATCH     SP1,PURNO
            IF         !@EQUAL
              APPEND     SP1,BOLDUR
              APPEND     PURNO,BOLDUR
            ENDIF
            ADD        ONE,FORM1
          UNTIL     FORM1 = 9
.
          RESET     BOLDUR
          SETLPTR   PURNO
          RESET     PURNO
.
.------ PATIENT LABEL LINE 2 ------
.
          PACK      WLINE2A,SP20,SP20
          MOVE      PGNAME,WLINE2A
          ENDSET    WLINE2A
          APPEND    SP1,WLINE2A
          APPEND    RDOCSURN,WLINE2A
          RESET     WLINE2A
.
.------ PATIENT LABEL LINE 3 ------
.
          UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY
          MOVE      "Admitted ",ADMLINE
          ENDSET    ADMLINE
          APPEND    CDAY,ADMLINE
          APPEND    SLASH,ADMLINE
          APPEND    CMON,ADMLINE
          APPEND    SLASH,ADMLINE
          APPEND    CYEAR,ADMLINE
          RESET     ADMLINE
          MOVE      ADOCSURN,ADOC13
.
.------ PATIENT LABEL LINE 4 ------
.
          MOVE      PADD1,ADD121
          MOVE      SP20,TDESC
          PACK      KEY5,ANSR,SP1,PREG
          CALL      RDCODE1                 * read the patient codes file
          MOVE      TDESC,RELDESC
.
.------ PATIENT LABEL LINE 5 ------
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      PADD2,ADD212
          MOVE      ADD212,LN5DIM30
          ENDSET    LN5DIM30
          APPEND    SP1,LN5DIM30
          MOVE      PPOST,KEY4
          APPEND    KEY4,LN5DIM30
          APPEND    SP5,LN5DIM30
          APPEND    CDAY,LN5DIM30
          APPEND    SLASH,LN5DIM30
          APPEND    CMON,LN5DIM30
          APPEND    SLASH,LN5DIM30
          APPEND    CYEAR,LN5DIM30
          RESET     LN5DIM30
.
.------ PATIENT LABEL LINE 6 ------
.
          CLEAR     WLINE6A
          APPEND    "Adm.## IP ",WLINE6A
          APPEND    AADMNO,WLINE6A
          APPEND    SP1,WLINE6A
          APPEND    PUSR1,WLINE6A
          APPEND    SP1,WLINE6A
          APPEND    ACLAIM,WLINE6A
          APPEND    ":",WLINE6A
.
          MOVE      SP20,TDESC
          MOVE      "CL",TCODE
          PACK      KEY5,TCODE,ACLAIM
          CALL      RDCODE1
          APPEND    TDESC,WLINE6A
          RESET     WLINE6A
          RETURN
.
.------ PATIENT LABEL LINE 6 ------
.
.          CLEAR     WLINE6A
.          APPEND    "Acc.## IP ",WLINE6A
.          APPEND    AADMNO,WLINE6A
.          APPEND    SP1,WLINE6A
.          APPEND    PUSR1,WLINE6A
.          APPEND    SP1,WLINE6A
.          PACK      ACCMSTAT,SP10,SP2
.          PACK      KEY30,AADMNO,Z30
.          CALL      RDSTRAN2                * position on the transfer file
.          CALL      RDPTRAN2                * get the previous rec from 
.          BRANCH    OVRCD,SETLB11E            the transfer file
.
.          MATCH     AADMNO,TADMN            * compare admission numbers
.          GOTO      SETLB11E IF NOT EQUAL
.
.------ see if the patient is public or private ------
.
.          PACK      KEY5,CATA,TATYPE
.          CALL      RDCODE1                 * read the patient codes file
.          IF        OVRCD = 0
.            TYPE      TCINDC1
.            IF        @EQUAL
.              MOVE      TCINDC1,FORM1
.              IF        FORM1 = 1 
.                MOVE      "HOSP/AC",ACCMSTAT
.              ELSE
.                IF      FORM1 = 2
.                  MOVE      "PRI/SHD",ACCMSTAT
.                ENDIF
.              ENDIF
.            ENDIF
.          ENDIF
.
.------ continue to set up the end of this label ------
.
.SETLB11E  APPEND    ACCMSTAT,WLINE6A
.          APPEND    SP1,WLINE6A
.          APPEND    ACLAIM,WLINE6A
.          RESET     WLINE6A
.
.          RETURN
.
.*************************************************************************
.*        Label 12 for Monash Day Surgery
.*************************************************************************
.
.-------  Set up Line 1 -------------------------------------
.
SETLAB12  PACK      WLINE1A,SP20,SP20
          CLEAR     WLINE1A
          RESET     WLINE1A,25
          APPEND    " UR: ",WLINE1A
          APPEND    AURNO,WLINE1A
          LENSET    WLINE1A
          RESET     WLINE1A
.
.-------  Set up Line 2 -------------------------------------
.
          PACK      WLINE2A,SP20,SP20
          CLEAR     WLINE2A
          MOVE      PSNAME,PACSNAME
          MOVE      PGNAME,PACGNAME
          MOVE      PTITL,PACTITLE
          MOVE      TWO,PACFRMT
          CALL      PACNAME
.         
          APPEND    PACFNAME,WLINE2A
          RESET     WLINE2A
.
.         Line three
.
          PACK      WLINE3A,SP30,SP30
          CLEAR     WLINE3A
          APPEND    PADD1,WLINE3A
          RESET     WLINE3A
.
.         Line four
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          PACK      WLINE4A WITH SP20,SP20
          CLEAR     WLINE4A
          APPEND    PADD2,WLINE4A
          RESET     WLINE4A,19
          APPEND    SP1,WLINE4A
          APPEND    PPOST,WLINE4A
          RESET     WLINE4A,24
          APPEND    " DOB: ",WLINE4A
          APPEND    CDAY,WLINE4A
          APPEND    "-",WLINE4A
          APPEND    CMON,WLINE4A
          APPEND    "-",WLINE4A
          APPEND    CYEAR,WLINE4A
          LENSET    WLINE4A
          RESET     WLINE4A
.
.         Line five
.
          PACK      WLINE5A,SP20,SP20
          CLEAR     WLINE5A
          APPEND    "PH: ",WLINE5A
          APPEND    PTELEP,WLINE5A
          APPEND    " (H)  ",WLINE5A
          APPEND    PTELEB,WLINE5A
          APPEND    " (W)",WLINE5A
          RESET     WLINE5A
.
.         Line six
.
          UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY
          PACK      WLINE6A,SP20,SP20
          CLEAR     WLINE6A
          APPEND    "DATE OF ADMISSION:  ",WLINE6A
          APPEND    CDAY,WLINE6A
          APPEND    "-",WLINE6A
          APPEND    CMON,WLINE6A
          APPEND    "-",WLINE6A
          APPEND    CYEAR,WLINE6A
          RESET     WLINE6A
.
.         Line seven
.
          PACK      WLINE7A,SP20,SP20
          CLEAR     WLINE7A
          APPEND    "SURGEON:  ",WLINE7A
.
          MOVE      ADOCTA,KEY6
          CALL      RDDOCT1
          BRANCH    OVRCD,SETLB12A
.
          MOVE      DSNAME,PACSNAME
          MOVE      DGNAME,ANS
          MOVE      ANS,PACGNAME
          MOVE      DTITL,PACTITLE
          MOVE      ONE,PACFRMT
          CALL      PACNAME
          APPEND    PACFNAME,WLINE7A
.
SETLB12A  RESET     WLINE7A
          RETURN
+
.*************************************************************************
.*        Label 13 for Dudley
.*************************************************************************
.-------  Set up Line 1 -------------------------------------
.
SETLAB13  PACK      WLINE1A,SP20,SP20
          CLEAR     WLINE1A
          APPEND    PSNAME,WLINE1A
          RESET     WLINE1A,20
          APPEND    SP1,WLINE1A
          APPEND    PURNO,WLINE1A
          RESET     WLINE1A
.
.-------  Set up Line 2 -------------------------------------
.
          PACK      WLINE2A,SP20,SP20
.
.-------  Set up Line 3 -------------------------------------
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      PSEX,ANS
          PACK      WLINE3A,SP20,SP20
          CLEAR     WLINE3A
          APPEND    PGNAME,WLINE3A
          RESET     WLINE3A,18
          APPEND    SP1,WLINE3A
          APPEND    ANS,WLINE3A
          APPEND    SP1,WLINE3A
          APPEND    CPDATE,WLINE3A
          RESET     WLINE3A
.
.-------  Set up Line 4 -------------------------------------
.
          PACK      WLINE4A,SP20,SP20
.
.-------  Set up Line 5 -------------------------------------
.
          PACK      WLINE5A,SP20,SP20  
          CLEAR     WLINE5A
          APPEND    PADD1,WLINE5A
          RESET     WLINE5A,29
          APPEND    SP20,WLINE5A
          RESET     WLINE5A
.
.-------  Set up Line 6 -------------------------------------
.
          PACK      WLINE6A,SP20,SP20
          CLEAR     WLINE6A
          APPEND    PADD2,WLINE6A
          RESET     WLINE6A,29
          APPEND    SP20,WLINE6A
          RESET     WLINE6A
.
.-------  Set up Line 7 -------------------------------------
.
          PACK      WLINE7A,SP20,SP20
          CLEAR     WLINE7A
          APPEND    PSUBRB,WLINE7A
          RESET     WLINE7A,29
          APPEND    SP20,WLINE7A
          RESET     WLINE7A
.
.-------  Set up Line 8 -------------------------------------
.
          PACK      WLINE8A,SP20,SP20
          CLEAR     WLINE8A
          APPEND    PADD4,WLINE8A
          RESET     WLINE8A,20
          APPEND    SP1,WLINE8A
          APPEND    PPOST,WLINE8A
          RESET     WLINE8A
.
.-------  Set up Last label Line 1 -------------------------------------
.
          UNPACK    PGNAME,ANS
          PACK      WLINE1,SP20,SP20
          CLEAR     WLINE1
          APPEND    PSNAME,WLINE1
          RESET     WLINE1,12
          APPEND    SP1,WLINE1
          APPEND    ANS,WLINE1
          APPEND    SP1,WLINE1
.
          RESET     WLINE1,15
          APPEND    PSNAME,WLINE1
          RESET     WLINE1,27
          APPEND    SP1,WLINE1
          APPEND    ANS,WLINE1
          RESET     WLINE1
.
.-------  Set up Last label Line 2 -------------------------------------
.
          PACK      WLINE2,SP20,SP20
          CLEAR     WLINE2
          APPEND    PURNO,WLINE2
          RESET     WLINE2,8
          APPEND    SP1,WLINE2
          APPEND    PSEX,WLINE2
          APPEND    SP1,WLINE2
          IF        PTCNDATE=1
            CALL      IBACLOCK
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE
            REP       UPPLOW,PSAGETYP
            APPEND    PSAGECON,WLINE2
            APPEND    PSAGETYP,WLINE2
          ELSE
            APPEND    PSAGE,WLINE2
          ENDIF
.
          RESET     WLINE2,15
          APPEND    PURNO,WLINE2
          RESET     WLINE2,23
          APPEND    SP1,WLINE2
          APPEND    PSEX,WLINE2
          APPEND    SP1,WLINE2
          IF        PTCNDATE=1
            CALL      IBACLOCK
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE
            REP       UPPLOW,PSAGETYP
            APPEND    PSAGECON,WLINE2
            APPEND    PSAGETYP,WLINE2
          ELSE
            APPEND    PSAGE,WLINE2
          ENDIF
          RESET     WLINE2
.
          RETURN
+
.*************************************************************************
.*        Label 15 for Hawkes Bay
.*************************************************************************
SETLAB15  PACK      WLINE1,SP30,SP10         * Ensure Lines are clear
          PACK      WLINE2,SP30,SP10
          PACK      WLINE3,SP30,SP10
          PACK      WLINE4,SP30,SP10
          PACK      WLINE5,SP30,SP10
.
.         Line 1 - Surname, Title, UR Number
.
          MOVE      PSNAME,KEY19
          PACK      WLINE1,KEY19,SP1,PTITL,PURNO  
.
.         Line 2 - Given Name, Sex, Age, D.O.B.
.
          PACK      KEY15,PGNAME             * Given Name
          PACK      WLINE2,KEY15
.
          RESET     WLINE2,16                * Sex
          APPEND    PSEX,WLINE2
.
          RESET     WLINE2,19                * Age
          IF        PTCNDATE=1
            CALL      IBACLOCK
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE
            REP       UPPLOW,PSAGETYP
            APPEND    PSAGECON,WLINE2
            APPEND    PSAGETYP,WLINE2
          ELSE
            APPEND    PSAGE,WLINE2
            APPEND    ANSY,WLINE2
          ENDIF
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          RESET     WLINE2,24
          APPEND    KEY8,WLINE2
          RESET     WLINE2
.
.         Line 3
.
          PACK      WLINE3,SP30,SP10         * Address Line 1
          CLEAR     WLINE3
          APPEND    PADD1,WLINE3
.
          CALL      FINEND3
          MOVE      ",",KEY1
          APPEND    KEY1,WLINE3
          APPEND    SP1,WLINE3
          APPEND    PADD2,WLINE3             * Address Line 2
          RESET     WLINE3
.
.         Line 4
.
          PACK      KEY6,ADOCTA
          CALL      RDDOCT1
          IF        OVRCD = ZERO
            MOVE      DGNAME,ANS 
            MOVE      ANS,WLINE4 
            APPEND    SP1,WLINE4 
            PACK      KEY14,DSNAME
            APPEND    KEY14,WLINE4 
          ENDIF
          UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPDATE,KEY8
          RESET     WLINE4,18
          APPEND    KEY8,WLINE4
.
          RESET     WLINE4,28                      * Ward
          APPEND    AWARD,WLINE4
          RESET     WLINE4
.
.         Line 5
.
          MOVE      "GP:",WLINE5
          RESET     WLINE5,4
.
          PACK      ADOCTL,ADOCTL,SP30
          MATCH     ADOCTL,SP30
          IF        @EQUAL
            MOVE      PLOCDOC,KEY14
          ELSE
            MOVE      ADOCTL,KEY14
          ENDIF
.
          APPEND    KEY14,WLINE5
          RESET     WLINE5
          RETURN
+
.*************************************************************************
.*        Mt Alvernia Lable 
.*************************************************************************
SETLAB16  PACK      WLINE1A,SP30,SP10         * Ensure Lines are clear
          PACK      WLINE2A,SP30,SP10
          PACK      WLINE3A,SP30,SP10
          PACK      WLINE4A,SP30,SP10
          PACK      WLINE5A,SP30,SP10
.
.         Line 1
          PACK      KEY4,PTITL              * Title 
          PACK      WLINE1A,KEY4
.
          RESET     WLINE1A,5                * Surname 
          APPEND    PSNAME,WLINE1A
          RESET     WLINE1A
.
          RESET     WLINE1A,13
          APPEND    SP1,WLINE1A
          APPEND    PGNAME,WLINE1A           * Given Name
          RESET     WLINE1A
. 
          RESET     WLINE1A,26
          APPEND    SP1,WLINE1A
          APPEND    "(",WLINE1A
          APPEND    PSEX,WLINE1A             * Sex
          APPEND    ")",WLINE1A
          RESET     WLINE1A
.
          RESET     WLINE1A, 30              * Admission Number
          APPEND    AADMNO,WLINE1A
          RESET     WLINE1A
.
. ------- Line 2
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          REPLACE   " 0",AGEDATE
          CALL      CALCAGE                         * Age
.
          IF        PTCNDATE=1
            REP       UPPLOW,PSAGETYP
            PACK      KEY10,PSAGECON,PSAGETYP,SP10   
          ELSE
            MOVE      PSAGEYRS,KEY3
            MOVE      "+",KEY1
            SQUEEZE   KEY3
            MOVE      "YEARS",KEY5
            PACK      KEY10,KEY3,KEY1,SP1,KEY5,SP10   
          ENDIF
          PACK      WLINE2A,KEY10
.
          RESET     WLINE2A,11
          PACK      KEY6,AWARD,SP10
          CALL      RDWARD1
          APPEND    WBDESC,WLINE2A           * Ward Description
          RESET     WLINE2A
.
          RESET     WLINE2A,30
          APPEND    SP1,WLINE2A
          APPEND    AWARD,WLINE2A            * Ward Number
          RESET     WLINE2A
. 
          RESET     WLINE2A,34
          APPEND    SP1,WLINE2A
          APPEND    ABED,WLINE2A
          RESET     WLINE2A
.
. ------- Line 3
.
          RESET     WLINE3A
          MOVE      ADOCTA,KEY6
          CALL      RDDOCT1
          STRIP     DTITL
          STRIP     DGNAME
          STRIP     DSNAME
          PACK      WLINE3,DTITL,SP1,DSNAME,SP1,DGNAME
          PACK      WLINE3A,WLINE3          * Addmiting doctor description
.
          RESET     WLINE3A,29
          UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          APPEND    SP1,WLINE3A
          APPEND    CPDATE,WLINE3A           * Addmision date
          RESET     WLINE3A
.
. ------- Line 4
          RESET     WLINE4A
          PROC      MTAICNO
          SQUEEZE   WLINE4A
.
. ------- Line 5
          RESET     WLINE5A
          MOVE      ADOCTR,KEY6
          CALL      RDDOCT1
          MOVE      DTITL,PACTITLE
          MOVE      DSNAME,PACSNAME
          MOVE      DGNAME,PACGNAME
          MOVE      ONE,PACFRMT
          CALL      PACNAME
          MOVE      PACFNAME,WLINE5A
          RESET     WLINE5A
.
          RETURN
.
.*************************************************************************
.* Label 17 for Taranaki
.*************************************************************************
SETLAB17  
.----- Do Wrist Bands First
.
          PACK      WGLINE1,SP30,SP10         * Ensure Lines are clear
          PACK      WGLINE2,SP30,SP10
          PACK      WGLINE3,SP30,SP10
.
.------ WRIST BAND LINE 1 ------
.
          MOVE      PSNAME,KEY19
          PACK      WGLINE1,KEY19,SP1,PTITL,SP1,PURNO,SP20
.
.------ WRIST BAND LINE 2 ------
.
          PACK      WGLINE2,PGNAME,SP20
.
.------ WRIST BAND LINE 3 ------
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      "Date of Birth : ",KEY16
          PACK      WGLINE3,KEY16,CPDATE,SP20,SP20
.
.------ INPATIENT LABELS
.
          PACK      WFLINE1,SP30,SP10         * Ensure Lines are clear
          PACK      WFLINE2,SP30,SP10
          PACK      WFLINE3,SP30,SP10
          PACK      WFLINE4,SP30,SP10
          PACK      WFLINE5,SP30,SP10
.
.-------  Line 1 - Surname, Title, DOB, UR Number
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPDATE,KEY8
.
          MOVE      PSNAME,KEY15
          PACK      WFLINE1,KEY15,SP1,PTITL,SP1,KEY8,SP1,PURNO  
.
.-------  Line 2 - Given Name, Sex, Age
.
          PACK      KEY21,PGNAME             * Given Name
          IF        PTCNDATE=1
            CALL      IBACLOCK
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE
            REP       UPPLOW,PSAGETYP
            PACK      WFLINE2,KEY21,SP1,PSEX,SP3,PSAGECON,PSAGETYP
          ELSE
            PACK      WFLINE2,KEY21,SP1,PSEX,SP4,PSAGE
          ENDIF
.
.-------  Line 3
.
          PACK      WFLINE3,SP30,SP10         * Address Line 1
          CLEAR     WFLINE3
          MOVE      ZERO,FORM2
.
LAB17A    ADD       ONE,FORM2
          COMPARE   SIX,FORM2
          GOTO      LAB17B IF NOT LESS      * finished
.
          LOAD      KEY35,FORM2,PADD1,PADD2,PSUBRB,PADD4,PPOST
          PACK      KEY35,KEY35,SP20,SP20
          MATCH     SP30,KEY35
          GOTO      LAB17A IF EQUAL         * no details
.
          IF        FORM2 <> ONE
            APPEND    ", ",WFLINE3
          ENDIF
          APPEND    KEY35,WFLINE3
          RESET     WFLINE3
          SETLPTR   WFLINE3
          STRIP     WFLINE3
          ENDSET    WFLINE3
          GOTO      LAB17A
.
LAB17B    RESET     WFLINE3
.
.-------  Line 4
.
          PACK      KEY6,ADOCTA
          CALL      RDDOCT1
          IF        OVRCD = ZERO
            MOVE      DGNAME,ANS 
            PACK      KEY15,ANS,SP1,DSNAME
          ELSE
            PACK      KEY15,SP20
          ENDIF
.
          UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPDATE,KEY8
.
          OPEN      PATWR1A1,"patwr1af"                 * open file
          PACK      KEY6,AWARD,SP6           * Get PTWDHOSN
          CALL      RDWARD1
.
          MOVE      "/",KEY1
          PACK      WFLINE4,KEY15,SP1,AWARD,KEY1,ABED,SP1,KEY8,SP2,PTWDHOSN 
.
.-------  Line 5
.
          MOVE      "GP: ",KEY4
          OPEN      PMSHCPA1,"pmshcpaf"
          PACK      KEY10,PMVXRHC1,SP70       * GP
          CALL      RDPMHCP1
          IF        OVRCD=1
            MATCH     KEY10,SP10
            IF        @EQUAL
              MOVE      SP20,KEY13
            ELSE
              MOVE      "Invalid Code:",KEY13
            ENDIF
            PACK      KEY30,KEY13,KEY10,SP20,SP10
          ELSE
            STRIP   PMHCGNAM
            PACK    KEY30,PMHCGNAM,SP1,PMHCSNAM,SP20,SP10
          ENDIF
          MOVE      ZERO,FORM2
          OPEN      PATMWSA1,"patmwsaf"
          PACK      KEY14,PURNO,SP20
          CALL      RSPTMWS1                * Position on & read the medical
LAB17C    CALL      RKPTMWS1                  warnings file
          BRANCH    OVRCD,LAB17D
.
          MATCH     PURNO,PTMWURNO
          GOTO      LAB17D IF NOT EQUAL     * Different U/R number
.
          ADD       ONE,FORM2               * Patient warning
          GOTO      LAB17C
.
LAB17D    IF        FORM2=0
            PACK      WFLINE5,KEY4,KEY30
          ELSE
            MOVE      KEY30,KEY29
            MOVE      "MWS",KEY3
            PACK      WFLINE5,KEY4,KEY29,SP1,KEY3,COLON,FORM2
          ENDIF
          RETURN
+
.*************************************************************************
.* Label 18 for Port Macquarie Private
.*************************************************************************
SETLAB18  
.-------- Armband label ---------
.
          PACK      WFLINE1,SP20,SP20
          MOVE      PTITL,PACTITLE
          MOVE      PGNAME,PACGNAME
          MOVE      PSNAME,PACSNAME
          MOVE      TWO,PACFRMT
          CALL      PACNAME
          MOVE      PACFNAME,WFLINE1
....      RESET     WFLINE1,25
....      APPEND    PURNO,WFLINE1
          RESET     WFLINE1
.
          PACK      WFLINE2,SP20,SP20
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          CLEAR     WFLINE2
          APPEND    "DOB: ",WFLINE2
          APPEND    CPDATE,WFLINE2
          APPEND    "  DOC: ",WFLINE2
          MOVE      ADOCTA,KEY6
          CALL      RDDOCT1
          BRANCH    OVRCD,LAB18A
.
          MOVE      DGNAME,ANS
          APPEND    ANS,WFLINE2
          APPEND    ".",WFLINE2
          APPEND    DSNAME,WFLINE2
.
LAB18A    RESET     WFLINE2
.
          CLEAR     WFLINE3
          APPEND    "UR: ",WFLINE3
          APPEND    PURNO,WFLINE3
          APPEND    SP10,WFLINE3
          RESET     WFLINE3
.
.-------- Inpatient Label ----
.-------- Line 1 -------------
.
          MOVE      "PMBH   WARD: ",WLINE1
          RESET     WLINE1,13
          APPEND    AWARD,WLINE1
          RESET     WLINE1,21
          APPEND    " UR:",WLINE1
          APPEND    PURNO,WLINE1
          RESET     WLINE1
.
.-------- Line 2 -------------
.
          PACK      WLINE2,SP20,SP20        * clear line
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          REP       " 0",CPDATE             * formatted date of birth
          MOVE      PSNAME,WLINE2           * patients surname
          RESET     WLINE2,15
          APPEND    SP2,WLINE2
          APPEND    PSEX,WLINE2
          APPEND    "   DOB:",WLINE2
          APPEND    CPDATE,WLINE2           * add the date of birth
          RESET     WLINE2
.
.-------- Line 3 -------------
.
          PACK      WLINE3,SP20,SP20        * clear line
          MOVE      PGNAME,WLINE3           * given name
          RESET     WLINE3,15
          APPEND    SP2,WLINE3
          APPEND    PTITL,WLINE3
          RESET     WLINE3,20
          APPEND    " ADM:",WLINE3          * append Admission number field
          APPEND    AADMNO,WLINE3           * add admission number
          RESET     WLINE3
.
.-------- Line 4 -------------
.
          UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          REP       " 0",CPDATE             * formatted date of birth
          PACK      WLINE4,SP20,SP20        * clear line
          MOVE      PADD1,WLINE4            * address line 1
          RESET     WLINE4,15
          APPEND    SP10,WLINE4
          APPEND    CPDATE,WLINE4 
          RESET     WLINE4
.
.-------- Line 5 -------------
.
          PACK      WLINE5,SP20,SP20        * clear line
          MOVE      PADD2,WLINE5            * address line 2
          RESET     WLINE5,15
          APPEND    SP2,WLINE5
          APPEND    PPOST,WLINE5            * add the post code
          RESET     WLINE5
.
.-------- Line 6 ------------
.
          PACK      WLINE6,SP20,SP20        * clear line
          RESET     WLINE6,23
          APPEND    AFUNDH,WLINE6           * health fund
.
          RESET     WLINE6,27
          PACK      AFNDTB,AFNDTB,SP8
          MATCH     AFNDTB,SP8
          GOTO      SLABS10D IF EQUAL       * no table
.
          APPEND    "/",WLINE6
          APPEND    AFNDTB,WLINE6           * health fund table
.
SLABS10D  APPEND    SP20,WLINE6 
          RESET     WLINE6
.
.-------- Line 7 ------------
.
          PACK      WLINE7,SP20,SP20        * clear line
          MOVE      "VMO:",WLINE7          * add pen number field
          RESET     WLINE7,4
          MOVE      SP30,DGNAME
          MOVE      SP30,DSNAME 
          MOVE      ADOCTA,KEY6
          CALL      RDDOCT1
          APPEND    "DR ",WLINE7          * add doc field desc
          MOVE      DGNAME,ANS              * get initial
          APPEND    ANS,WLINE7              * add initial
          APPEND    SP1,WLINE7
          APPEND    DSNAME,WLINE7           * add surname
          RESET     WLINE7,23
          APPEND    " CLASS:",WLINE7
          APPEND    ACLAIM,WLINE7
          RESET     WLINE7
.
.-------- Line 8 -----------
.
          PACK      WLINE8,SP20,SP20        * clear line
          MOVE      "LMO:",WLINE8          * add pen number field
          RESET     WLINE8,4
          MOVE      SP30,DGNAME
          MOVE      SP30,DSNAME 
          MOVE      ADOCTR,KEY6
          CALL      RDDOCT1
          APPEND    "DR ",WLINE8          * add doc field desc
          MOVE      DGNAME,ANS              * get initial
          APPEND    ANS,WLINE8              * add initial
          APPEND    SP1,WLINE8
          APPEND    DSNAME,WLINE8           * add surname
          RESET     WLINE8,23
          APPEND    SP20,WLINE8
          RESET     WLINE8
.
          RETURN
+
.******************************************************************************
.*                                 SETLAB20                                   *
.*                          Label 20 for St. Lukes                            *
.******************************************************************************
SETLAB20
.
. ----- Line 1 -----
.
          PACK      WLINE1A,SP20,SP20
          MOVE      PSNAME,WLINE1A          * Patients surname
          RESET     WLINE1A,18
          APPEND    SP2,WLINE1A
          APPEND    "(",WLINE1A
          APPEND    PTITL,WLINE1A           * Patients title
          APPEND    ")",WLINE1A
          APPEND    SP4,WLINE1A
          APPEND    PURNO,WLINE1A           * Patients U/R number
          APPEND    SP2,WLINE1A
          RESET     WLINE1A
.
. ----- Line 2 -----
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE                 * Format DOB
          REP       " 0",CPDATE
          PACK      WLINE2A,SP20,SP20
          MOVE      PGNAME,WLINE2A          * Patients given name
          RESET     WLINE2A,18
          APPEND    SP6,WLINE2A
          APPEND    "DOB : ",WLINE2A
          APPEND    CPDATE,WLINE2A          * Patients date of birth
          APPEND    SP2,WLINE2A
          RESET     WLINE2A
.
. ----- Line 3 -----
.
          PACK      WLINE3A,SP20,SP20
          MOVE      PADD1,WLINE3A           * Patients 1st address line
          RESET     WLINE3A,30
          APPEND    SP10,WLINE3A
          APPEND    SP5,WLINE3A
          RESET     WLINE3A
.
. ----- Line 4 -----
.
          CALL      IBACLOCK
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                 * Calculate patients age
          IF        PTCNDATE=1
            REP       UPPLOW,PSAGETYP
            PACK      KEY4,PSAGECON,PSAGETYP
            SQUEEZE   KEY4
          ELSE
            PACK      KEY4,SP1,PSAGEYRS
          ENDIF
          PACK      WLINE4A,SP20,SP20
          MOVE      PSUBRB,WLINE4A          * Patients suburb
          RESET     WLINE4A,16
          APPEND    SP2,WLINE4A
          APPEND    PPOST,WLINE4A           * Patients postcode
          RESET     WLINE4A,22
          APPEND    SP6,WLINE4A
          APPEND    "Age : ",WLINE4A
          APPEND    KEY4,WLINE4A            * Patients age
          APPEND    SP2,WLINE4A
          RESET     WLINE4A
.
. ----- Line 5 -----
.
          UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY
          MOVE      "19",CCENT
          CALL      PACDATE                 * Format admission date
          REP       " 0",CPDATE
          PACK      WLINE5A,SP20,SP20
          MOVE      "Admitted   : ",WLINE5A
          ENDSET    WLINE5A
          APPEND    CPDATE,WLINE5A          * Patients admission date
          APPEND    SP3,WLINE5A
          APPEND    "Adm : ",WLINE5A
          APPEND    AADMNO,WLINE5A          * Patients admission number
          APPEND    SP2,WLINE5A
          RESET     WLINE5A
.
. ----- Line 6 -----
.
          PACK      KEY6,ADOCTA
          CALL      RDDOCT1                 * Read the doctors file
          IF        OVRCD=1
            MOVE      SP9,DTITL
            MOVE      SP30,DGNAME
            MOVE      SP20,DSNAME
          ENDIF
          MOVE      DGNAME,KEY1
          PACK      WLINE6A,SP20,SP20
          MOVE      "Consultant : ",WLINE6A
          ENDSET    WLINE6A
          APPEND    DTITL,WLINE6A           * Attending doctors title
          RESET     WLINE6A,17
          APPEND    ". ",WLINE6A
          APPEND    KEY1,WLINE6A            * Attending doctors initial
          APPEND    ". ",WLINE6A
          APPEND    DSNAME,WLINE6A          * Attending doctors surname
          RESET     WLINE6A,39
          APPEND    SP2,WLINE6A
          RESET     WLINE6A
.
. ----- Line 7 -----
.
          PACK      WLINE7A,SP20,SP20
          MOVE      "Acc : ",WLINE7A
          ENDSET    WLINE7A
          APPEND    ACLAIM,WLINE7A          * Patients claim code
          RESET     WLINE7A,21
          APPEND    "Pens : ",WLINE7A
          APPEND    PPENNO,WLINE7A          * Patients pensioner number
          APPEND    SP2,WLINE7A
          RESET     WLINE7A
.
. ----- Line 8 -----
.
          PACK      KEY5,ANSR,SP1,PREG
          CALL      RDCODE1                 * Read the codes file
          IF        OVRCD=1
            MOVE      SP20,TDESC
          ENDIF
          PACK      WLINE8A,SP20,SP20
          MOVE      "Religion   : ",WLINE8A
          ENDSET    WLINE8A
          APPEND    PREG,WLINE8A            * Patients religion code
          APPEND    SP2,WLINE8A
          APPEND    TDESC,WLINE8A           * Patients religion code desc
          APPEND    SP2,WLINE8A
          RESET     WLINE8A
          RETURN
+
.******************************************************************************
.*                                 SETLAB21                                   *
.*                      Label 21 For Coast Health Care                        *
.******************************************************************************
SETLAB21  
.
. ----- Do Wrist Bands First -----
.
          PACK      WGLINE1,SP30,SP10
          PACK      WGLINE2,SP30,SP10
          PACK      WGLINE3,SP30,SP10
.
. ----- Wrist Band Line 1 -----
.
          CLEAR     WGLINE1
          MOVE      PSNAME,WGLINE1          * Patients surname
          RESET     WGLINE1,19
          APPEND    SP1,WGLINE1
          APPEND    PTITL,WGLINE1           * Patients title
          APPEND    SP1,WGLINE1
          APPEND    PURNO,WGLINE1           * Patients UR
          APPEND    SP30,WGLINE1
          RESET     WGLINE1
.
. ----- Wrist Band Line 2 -----
.
          CLEAR     WGLINE2
          APPEND    PGNAME,WGLINE2          * Patients given name
          APPEND    SP30,WGLINE2
          RESET     WGLINE2
.
. ----- Wrist Band Line 3 -----
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE                 * Format DOB
          REP       " 0",CPDATE
          CLEAR     WGLINE3
          MOVE      "DOB: ",WGLINE3
          RESET     WGLINE3,5
          APPEND    CPDATE,WGLINE3          * Patients DOB
          APPEND    SP7,WGLINE3
          APPEND    "ADM: ",WGLINE3
          APPEND    AADMNO,WGLINE3          * Patients admission number
          APPEND    SP30,WGLINE3
          RESET     WGLINE3
.
. ----- Inpatient Labels -----
.
          PACK      WFLINE1,SP30,SP10
          PACK      WFLINE2,SP30,SP10
          PACK      WFLINE3,SP30,SP10
          PACK      WFLINE4,SP30,SP10
          PACK      WFLINE5,SP30,SP10
.
. ----- Line 1 -----
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE                 * Format DOB
          REP       " 0",CPDATE
          CLEAR     WFLINE1
          MOVE      PSNAME,WFLINE1          * Patients surname
          RESET     WFLINE1,17
          APPEND    SP1,WFLINE1
          APPEND    PTITL,WFLINE1           * Patients title
          APPEND    SP1,WFLINE1
          APPEND    CPDATE,WFLINE1          * Patients DOB
          APPEND    SP1,WFLINE1
          APPEND    PURNO,WFLINE1           * Patients UR
          APPEND    SP30,WFLINE1
          RESET     WFLINE1
.
. ----- Line 2 -----
.
          CLEAR     WFLINE2
          MOVE      PGNAME,WFLINE2          * Patients given name
          RESET     WFLINE2,21
          APPEND    SP1,WFLINE2
          APPEND    PSEX,WFLINE2            * Patients sex
          IF        PTCNDATE=1
            CALL      IBACLOCK              * Get current date
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE
            REP       UPPLOW,PSAGETYP
            APPEND    SP3,WFLINE2
            APPEND    PSAGECON,WFLINE2      * Patients age
            APPEND    PSAGETYP,WFLINE2      * Type of age (days, weeks, months)
          ELSE
            APPEND    SP4,WFLINE2
            APPEND    PSAGE,WFLINE2         * Patients age
          ENDIF
          APPEND    SP30,WFLINE2
          RESET     WFLINE2
.
. ----- Line 3 -----
.
          CLEAR     WFLINE3
          MOVE      ZERO,FORM2
.
LAB21A    ADD       ONE,FORM2
          COMPARE   SIX,FORM2
          GOTO      LAB21B IF NOT LESS      * Finished
.
          LOAD      KEY35,FORM2,PADD1,PADD2,PSUBRB,PADD4,PPOST
.                               Add 1 Add 2 Add 3  Add 4 Postcode
          PACK      KEY35,KEY35,SP20,SP20
          MATCH     SP30,KEY35
          GOTO      LAB21A IF EQUAL         * No details
.
          IF        FORM2<>1
            APPEND    ", ",WFLINE3
          ENDIF
          APPEND    KEY35,WFLINE3
          RESET     WFLINE3
          SETLPTR   WFLINE3
          STRIP     WFLINE3
          ENDSET    WFLINE3
          GOTO      LAB21A
.
LAB21B    RESET     WFLINE3
.
. ----- Line 4 -----
.
          UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE                 * Format admission date
          REP       " 0",CPDATE
          OPEN      PATWR1A1,"patwr1af"                * Open patwr1af file
          PACK      KEY6,AWARD,SP6          * Get PTWDHOSN
          CALL      RDWARD1                 * Read the ward/bed file
          CLEAR     WFLINE4
          PACK      KEY6,ADOCTA
          CALL      RDDOCT1
          IF        OVRCD<>1
            MOVE      DGNAME,ANS
            MOVE      ANS,WFLINE4           * Attending doctors initial
            APPEND    SP1,WFLINE4
            APPEND    DSNAME,WFLINE4        * Attending doctors surname
          ENDIF
          RESET     WFLINE4,15
          APPEND    SP1,WFLINE4
          APPEND    AWARD,WFLINE4           * Patients ward
          APPEND    "/",WFLINE4
          APPEND    ABED,WFLINE4            * Patients bed
          APPEND    SP1,WFLINE4
          APPEND    CPDATE,WFLINE4          * Admission date
          APPEND    SP2,WFLINE4
          APPEND    PTWDHOSN,WFLINE4        * Hospital/unit number
          APPEND    SP30,WFLINE4
          RESET    WFLINE4
.
. ----- Line 5 -----
.
          CLEAR     WFLINE5
          MOVE      "GP: ",WFLINE5
          RESET     WFLINE5,4
          OPEN      PMSHCPA1,"pmshcpaf"
          PACK      KEY10,PMVXRHC1,SP70
          CALL      RDPMHCP1
          IF        OVRCD=1
            MATCH     KEY10,SP10
            IF        !@EQUAL
              APPEND    "Invalid Code:",WFLINE5
            ENDIF
            RESET     WFLINE5,13
            APPEND    KEY8,WFLINE5
          ELSE
            MOVE      PMHCGNAM,ANS          * GPs initial
            APPEND    ANS,WFLINE5
            APPEND    SP1,WFLINE5
            APPEND    PMHCSNAM,WFLINE5      * GPs surname
          ENDIF
          RESET     WFLINE5,25
          APPEND    SP2,WFLINE5
          APPEND    "ADM: ",WFLINE5
          APPEND    AADMNO,WFLINE5          * Patients admission number
          APPEND    SP30,WFLINE5
          RESET     WFLINE5
          RETURN
+
.******************************************************************************
.*                                 SETLAB22                                   *
.*                    Label 22 for St. Vincents Bathurst                      *
.******************************************************************************
SETLAB22
.
. ----- Line 1 -----
.
          MOVE      PSNAME,PACSNAME
          MOVE      PGNAME,PACGNAME
          MOVE      PTITL,PACTITLE
          MOVE      TWO,PACFRMT
          CALL      PACNAME                 * Format patients name
          PACK      WLINE1A,SP20,SP20
          MOVE      PACFNAME,WLINE1A        * Patients name
          RESET     WLINE1A
.
. ----- Line 2 -----
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE                 * Format DOB
          PACK      WLINE2A,SP30,SP10
          MOVE      "DOB:",WLINE2A
          ENDSET    WLINE2A
          APPEND    SP1,WLINE2A
          APPEND    CPDATE,WLINE2A          * Patients DOB
.
.* ****************************************** Start of Changes         *C-49016
          MOVE      PSEX,DSEXCHAR
          CALL      SEXDSC00                * get sex description (in IBACOMN)
.                                           *       returns DSEXDESC & DSEXNO
          REP       UPPLOW,DSEXDESC
          APPEND    SP1,WLINE2A
          APPEND    DSEXDESC,WLINE2A
.* ******************************************   End of Changes         *C-49016
.
          APPEND    SP4,WLINE2A                               * was 5  *C-49016
          APPEND    "UR:  ",WLINE2A
          APPEND    AURNO,WLINE2A           * Patients U/R
          APPEND    SP30,WLINE2A
          RESET     WLINE2A
.
. ----- Line 3 -----
.
          PACK      WLINE3A,SP30,SP30
          MOVE      ADOCTA,KEY6
          CALL      RDDOCT1                 * Read the doctors file
          IF        OVRCD<>1
            MOVE      DSNAME,PACSNAME
            MOVE      DGNAME,ANS
            MOVE      ANS,PACGNAME
            MOVE      DTITL,PACTITLE
            MOVE      ONE,PACFRMT
            CALL      PACNAME               * Format attending doctors name
            MOVE      PACFNAME,WLINE3A      * Attending doctors name
            RESET     WLINE3A,25
            APPEND    "DOC: ",WLINE3A
            APPEND    DCODE,WLINE3A         * Attending doctors code
            APPEND    SP30,WLINE3A
          ENDIF
          RESET     WLINE3A
          REP       " .",WLINE3A
          RESET     WLINE3A
.
. ----- Line 4 -----
.
          PACK      WLINE4A,SP30,SP10
          MOVE      PADD1,WLINE4A           * Patients address line 1
          RESET     WLINE4A,25
          APPEND    SP2,WLINE4A
          APPEND    ACLAIM,WLINE4A          * Patients claim code
          PACK      KEY30,AADMNO,Z30
          CALL      RDSTRAN2                * Read the transfer file to get the
          CALL      RDPTRAN2                  most recent ward/bed
          IF        OVRCD<>1
            MATCH     AADMNO,TADMN
            IF        @EQUAL
              APPEND    SP1,WLINE4A
              APPEND    TWARD,WLINE4A       * Patients ward
              APPEND    SLASH,WLINE4A
              APPEND    TBED,WLINE4A        * Patients bed
            ENDIF
          ENDIF
          APPEND    SP30,WLINE4A
          RESET     WLINE4A
.
. ----- Line 5 -----
.
          PACK      WLINE5A,SP30,SP10
          MOVE      PADD2,WLINE5A           * Patients address line 2
          RESET     WLINE5A,25
          APPEND    SP2,WLINE5A
          APPEND    AFUNDH,WLINE5A          * Patients health fund
          APPEND    SP2,WLINE5A
          APPEND    PREG,WLINE5A            * Patients religion code
          APPEND    SP30,WLINE5A
          RESET     WLINE5A
.
. ----- Line 6 -----
.
          PACK      WLINE6A,SP30,SP10
          MOVE      PSUBRB,WLINE6A          * Patients suburb
          RESET     WLINE6A,20
          APPEND    SP1,WLINE6A
          APPEND    PPOST,WLINE6A           * Patients postcode
          MOVE      THREE,DIM1
          CALL      GCCARD00                      * Get DVA card number
          MATCH     SP20,PMCDCNUM
          IF        !@EQUAL
            APPEND    " R ",WLINE6A
            APPEND    PMCDCNUM,WLINE6A        * Patients repatriation number
          ELSE
            MATCH     SP10,PPENNO
            IF        !@EQUAL
              APPEND    " P ",WLINE6A
              APPEND    PPENNO,WLINE6A      * Patients pensioner number
            ENDIF
          ENDIF
          APPEND    SP30,WLINE6A
          RESET     WLINE6A
.
. ----- Line 7 -----
.
          PACK      WLINE7A,SP30,SP10
          MOVE      ADOCTA,KEY6
          CALL      RDDOCT1                 * Read the doctors file
          IF        OVRCD<>1
            MOVE      "PRES:",WLINE7A
            ENDSET    WLINE7A
            APPEND    SP1,WLINE7A
.           APPEND    DNHSNO,WLINE7A        * Attending doctors prescriber no.
            APPEND    SP30,WLINE7A
          ENDIF
          RESET     WLINE7A
.
. ----- Line 8 -----
.
          UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE                 * Format admission date
          PACK      WLINE8A,SP30,SP10
          MOVE      "ADM: ",WLINE8A
          ENDSET    WLINE8A
          APPEND    CPDATE,WLINE8A          * Patients admission date
          APPEND    SP12,WLINE8A
          APPEND    "ADM: ",WLINE8A
          APPEND    AADMNO,WLINE8A          * Patients admission number
          APPEND    SP30,WLINE8A
          RESET     WLINE8A
          RETURN
+
.******************************************************************************
.*                                 SETLAB23                                   *
.*                            Label 23 for Mersey                             *
.******************************************************************************
SETLAB23
.-------- Armband label ---------
.
          PACK      WFLINE1,SP20,SP20
          MOVE      PTITL,PACTITLE
          MOVE      PGNAME,PACGNAME
          MOVE      PSNAME,PACSNAME
          MOVE      TWO,PACFRMT
          CALL      PACNAME
          MOVE      PACFNAME,WFLINE1
....      RESET     WFLINE1,25
....      APPEND    PURNO,WFLINE1
          RESET     WFLINE1
.
          PACK      WFLINE2,SP20,SP20
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          CLEAR     WFLINE2
          APPEND    "DOB: ",WFLINE2
          APPEND    CPDATE,WFLINE2
          APPEND    "  DOC: ",WFLINE2
          MOVE      ADOCTA,KEY6
          CALL      RDDOCT1
          BRANCH    OVRCD,LAB23A
.
          MOVE      DGNAME,ANS
          APPEND    ANS,WFLINE2
          APPEND    ".",WFLINE2
          APPEND    DSNAME,WFLINE2
.
LAB23A    RESET     WFLINE2
.
          CLEAR     WFLINE3
          APPEND    "UR: ",WFLINE3
          APPEND    PURNO,WFLINE3
          APPEND    SP10,WFLINE3
          RESET     WFLINE3
.
.-------- Inpatient Label ----
.-------- Line 1 -------------
.
          MOVE      "MCH    WARD: ",WLINE1
          RESET     WLINE1,13
          APPEND    AWARD,WLINE1
          RESET     WLINE1,21
          APPEND    " UR:",WLINE1
          APPEND    PURNO,WLINE1
          RESET     WLINE1
.
.-------- Line 2 -------------
.
          PACK      WLINE2,SP20,SP20        * clear line
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          REP       " 0",CPDATE             * formatted date of birth
          MOVE      PSNAME,WLINE2           * patients surname
          RESET     WLINE2,15
          APPEND    SP2,WLINE2
          APPEND    PSEX,WLINE2
          APPEND    "   DOB:",WLINE2
          APPEND    CPDATE,WLINE2           * add the date of birth
          RESET     WLINE2
.
.-------- Line 3 -------------
.
          PACK      WLINE3,SP20,SP20        * clear line
          MOVE      PGNAME,WLINE3           * given name
          RESET     WLINE3,15
          APPEND    SP2,WLINE3
          APPEND    PTITL,WLINE3
          RESET     WLINE3,20
          APPEND    " ADM:",WLINE3          * append Admission number field
          APPEND    AADMNO,WLINE3           * add admission number
          RESET     WLINE3
.
.-------- Line 4 -------------
.
          UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          REP       " 0",CPDATE             * formatted date of birth
          PACK      WLINE4,SP20,SP20        * clear line
          MOVE      PADD1,WLINE4            * address line 1
          RESET     WLINE4,15
          APPEND    SP10,WLINE4
          APPEND    CPDATE,WLINE4 
          RESET     WLINE4
.
.-------- Line 5 -------------
.
          PACK      WLINE5,SP20,SP20        * clear line
          MOVE      PSUBRB,WLINE5           * suburb
          RESET     WLINE5,15
          APPEND    SP2,WLINE5
          APPEND    PPOST,WLINE5            * add the post code
          RESET     WLINE5
.
.-------- Line 6 ------------
.
          PACK      WLINE6,SP20,SP20        * clear line
          RESET     WLINE6,23
          APPEND    AFUNDH,WLINE6           * health fund
.
          RESET     WLINE6,27
          PACK      AFNDTB,AFNDTB,SP8
          MATCH     AFNDTB,SP8
          GOTO      LAB23B IF EQUAL         * no table
.
          APPEND    "/",WLINE6
          APPEND    AFNDTB,WLINE6           * health fund table
.
LAB23B    APPEND    SP20,WLINE6 
          RESET     WLINE6
.
.-------- Line 7 ------------
.
          PACK      WLINE7,SP20,SP20        * clear line
          MOVE      "VMO:",WLINE7          * add pen number field
          RESET     WLINE7,4
          MOVE      SP30,DGNAME
          MOVE      SP30,DSNAME 
          MOVE      ADOCTA,KEY6
          CALL      RDDOCT1
          APPEND    "DR ",WLINE7          * add doc field desc
          MOVE      DGNAME,ANS              * get initial
          APPEND    ANS,WLINE7              * add initial
          APPEND    SP1,WLINE7
          APPEND    DSNAME,WLINE7           * add surname
          RESET     WLINE7,23
          APPEND    " CLASS:",WLINE7
          APPEND    ACLAIM,WLINE7
          RESET     WLINE7
.
.-------- Line 8 -----------
.
          PACK      WLINE8,SP20,SP20        * clear line
          MOVE      "GP :",WLINE8          * add pen number field
          RESET     WLINE8,4
          APPEND    ARDRNAM,WLINE8
          APPEND    SP20,WLINE8
          RESET     WLINE8
.
          RETURN
+
.******************************************************************************
.*                                 SETLAB24                                   *
.*                            Label 24 for Mercy Dunedin                      *
.******************************************************************************
.
SETLAB24  STRIP     PSNAME                  * remove blanks from surname
          STRIP     PGNAME                  * remove blanks from given name
          PACK      WLINE1A,SP30,SP20
          MOVE      PSNAME,WLINE1A          * load surname
          ENDSET    WLINE1A
          APPEND    ", ",WLINE1A  
          ENDSET    WLINE1A
          APPEND    PGNAME,WLINE1A          * load given name
          RESET     PSNAME
          RESET     PGNAME
.
          OPEN      PATNIDA1,"patnidaf"
          PACK      KEY10,CHOSINDX,PURNO,SP10
          CALL      RDPTNID1
          IF        OVRCD = 0
            RESET     WLINE1A,31
            RESET     PTNINMPI,14
            SETLPTR   PTNINMPI,TWENTY
            APPEND    PTNINMPI,WLINE1A      * load NMPI number
            RESET     PTNINMPI
          ENDIF
          CLOSE     PATNIDA1
          RESET     WLINE1A
.
.-------- Line 2 -------------
.
          PACK      WLINE2A,SP30,SP20
          STRIP     PADD1
          STRIP     PADD2
          STRIP     PSUBRB
          STRIP     PADD4
          MOVE      PADD1,WLINE2A
          ENDSET    WLINE2A
          APPEND    SP1,WLINE2A
          ENDSET    WLINE2A
          APPEND    PADD2,WLINE2A
          ENDSET    WLINE2A
          APPEND    SP1,WLINE2A
          ENDSET    WLINE2A
          APPEND    PSUBRB,WLINE2A
          ENDSET    WLINE2A
          APPEND    SP1,WLINE2A
          ENDSET    WLINE2A
          APPEND    PADD4,WLINE2A
          RESET     WLINE2A
          RESET     PADD1
          RESET     PADD2
          RESET     PSUBRB
          RESET     PADD4
.
.-------- Line 3 -------------
.
          PACK      WLINE3A,SP30,SP20
          SETLPTR   PTELEP,TEN2
          MOVE      PTELEP,WLINE3A
          RESET     PTELEP
          RESET     WLINE3A,17
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          REP       " 0",CPDATE
          APPEND    CPDATE,WLINE3A
          RESET     WLINE3A,27
          APPEND    PSAGE,WLINE3A
          RESET     WLINE3A,34
          APPEND    PTITL,WLINE3A
          RESET     WLINE3A
.
.-------- Line 4 -------------
.
          PACK      WLINE4A,SP30,SP20
          MOVE      ADOCTA,KEY6
          CALL      RDDOCT1                 * Read the doctors file
          IF        OVRCD = 0
            STRIP     DTITL
            STRIP     DSNAME
            MOVE      DTITL,WLINE4A
            ENDSET    WLINE4A
            APPEND    SP1,WLINE4A
            ENDSET    WLINE4A
            CMOVE     DGNAME,ANS
            APPEND    ANS,WLINE4A
            ENDSET    WLINE4A
            APPEND    SP1,WLINE4A
            ENDSET    WLINE4A
            APPEND    DSNAME,WLINE4A
            RESET     DTITL
            RESET     DSNAME
          ENDIF
          RESET     WLINE4A
.
.-------- Line 5 -------------
.
          PACK      WLINE5A,SP30,SP20       * clear line
          MOVE      AADMNO,WLINE5A          * admission number
          RESET     WLINE5A,10
          UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE                 * format date
          REP       " 0",CPDATE
          APPEND    CPDATE,WLINE5A
          RESET     WLINE5A,20
          APPEND    PUSR1,WLINE5A           * PMI UDF 1 (Cat P1)
          RESET     WLINE5A,24
          APPEND    PUSR3,WLINE5A           * PMI UDF 3 (Cat P3)
          RESET     WLINE5A,28
          SETLPTR   PTMXCHNM,10
          APPEND    PTMXCHNM,WLINE5A
          RESET     PTMXCHNM
          RESET     WLINE5A
.
          RETURN
.
+
.******************************************************************************
.*                                 SETLAB25                                   *
.*                            Label 25 for St Vincent's Hospital              *
.******************************************************************************
.
SETLAB25  PACK      WLINEZ1,SP20,SP20
          PACK      WLINEZ2,SP20,SP20
          PACK      WLINEZ3,SP20,SP20
          PACK      WLINEZ4,SP20,SP20
          PACK      WLINEZ5,SP20,SP20
          PACK      WLINEZ6,SP20,SP20
          PACK      WLINEZ7,SP20,SP20
          PACK      WLINEZ8,SP20,SP20
          PACK      WLINEZ9,SP20,SP20
          PACK      WLINEZ10,SP20,SP20
          PACK      WLINEZ11,SP20,SP20
          PACK      WLINEZ12,SP20,SP20
          PACK      WLINEZ13,SP20,SP20
          PACK      WLINEZ14,SP20,SP20
          PACK      WLINEZ15,SP20,SP20,SP20
          PACK      WLINEZ17,SP20,SP20
          PACK      WLINEZ20,SP20,SP20
.
          BRANCH    ZEBRAFLG,LAB25A:             * I/P Label
                             LAB25B:             * Nutrition Label
                             LAB25C:             * Address Label
                             LAB25A              * PMI Label
          GOTO      LAB2599
.
.         I/P Label & Original PMI Label
.
LAB25A    MATCH     "LABELINP",IBLPLAPR          * I/P PMI label ?
          IF        @EQUAL
            MATCH     "01",IBLPLASC              * screen "01" (I/P Label) ?
            GOTO      LAB25A1 IF EQUAL           * yes
.
            MATCH     "02",IBLPLASC              * screen "02" (GP Label) ?
            GOTO      LAB25E IF EQUAL            * yes
          ENDIF
.
          MATCH     "LABELPMI",IBLPLAPR          * PMI label ?
          IF        @EQUAL
            MATCH     "01",IBLPLASC              * screen "01" ?
            GOTO      LAB25A1 IF EQUAL           * yes
.
            MATCH     "03",IBLPLASC              * no - screen "03" ? (817740)
            GOTO      LAB25E IF EQUAL            * yes - GP label format
.
            MATCH     "02",IBLPLASC              * no - screen "02" ? (315999)
            GOTO      LAB25D IF NOT EQUAL        * no - use alt PMI label format
          ENDIF
.
.         Set New Wrist Band variables
.
.         Load DOB
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      "DOB: ",WLINEZ15
          ENDSET    WLINEZ15
          APPEND    CPCDATE,WLINEZ15
          APPEND    "      UR: ",WLINEZ15
.
.         Load U/R for printing and barcode interpretation line
.
          UNPACK    PURNO,KEY1,DIM1,KEY6
          MATCH     "T",KEY1
          IF        @EQUAL
            APPEND    KEY1,WLINEZ15
            APPEND    KEY6,WLINEZ15
            PACK      WLINEZ2,SP1,KEY1,KEY6
          ELSE
            APPEND    PURNO,WLINEZ15
            MOVE      PURNO,WLINEZ2
          ENDIF
          RESET     WLINEZ15
.
.         Load Surname
.
          MOVE      PTMASNAM,WLINEZ20
          STRIP     WLINEZ20
.
.         Load Title and First Given Name
.
          UNPACK    PTITL,ANS,KEY3
          REP       UPPTOLOW,KEY3
          PACK      WLINEZ21,ANS,KEY3
          STRIP     WLINEZ21
          UNPACK    PMPXFNAM,ANS,KEY39
          REP       UPPTOLOW,KEY39
          ENDSET    WLINEZ21
          APPEND    SP1,WLINEZ21
          APPEND    ANS,WLINEZ21
          APPEND    KEY39,WLINEZ21
          RESET     WLINEZ21
          STRIP     WLINEZ21
.
.         Load U/R for barcode
.
          MOVE      PURNO,WLINEZ16
.
          GOTO      LAB2598
.
.         Set Standard PMI variables
.
LAB25A1   UNPACK    PURNO,KEY1,DIM1,KEY6
          MATCH     "T",KEY1
          IF        @EQUAL
            PACK      WLINEZ1,SP1,KEY1,KEY6
          ELSE
            MOVE      PURNO,WLINEZ1
          ENDIF
          RESET     WLINEZ1,8
.
          MOVE      PSNAME,WLINEZ2
          RESET     WLINEZ2,16
.
          MOVE      PGNAME,WLINEZ3
          RESET     WLINEZ3,20
.
          MOVE      PTITL,WLINEZ4
          RESET     WLINEZ4,4
.
          MOVE      PSEX,WLINEZ5
          RESET     WLINEZ5,1
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      "DoB:",WLINEZ6
          ENDSET    WLINEZ6
          APPEND    CPCDATE,WLINEZ6
          RESET     WLINEZ6,14
.
          MOVE      "yr",DIM2
          CALL      IBACLOCK
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          REP       " 0",AGEDATE
          CALL      CALCAGE
          PACK      WLINEZ7,PSAGEYRS,DIM2
          RESET     WLINEZ7,5
.
          MOVE      PADD1,WLINEZ8
          RESET     WLINEZ8,25
.
          MOVE      PADD2,WLINEZ17
          RESET     WLINEZ17,25
.
          STRIP     PSUBRB
          STRIP     PPOST
          PACK      WLINEZ9,PSUBRB,SP1,PPOST
          RESET     WLINEZ9,25
.
          CALL      IBACLOCK
          PACK      CURRDATE,CDD,SLASH,CMM,SLASH,CYY
          REP       " 0",CURRDATE
          MOVE      "(Printed ",WLINEZ11
          ENDSET    WLINEZ11
          APPEND    CURRDATE,WLINEZ11
          APPEND    ")",WLINEZ11
.
          MOVE      PTELEP,WLINEZ13
          RESET     WLINEZ13,12
.
          IF        ZEBRAFLG = 1
            PACK      WLINEZ14,ZIP,ATYPE,ACLAIM
            ENDSET    WLINEZ14
          ELSE
            PACK      WLINEZ14,ZPMI,SP20
            ENDSET    WLINEZ14
          ENDIF
.
          MOVE      PURNO,WLINEZ16
          RESET     WLINEZ16,8
          APPEND    ZFS,WLINEZ16
.
          GOTO      LAB2598
.
.         Nutrition Label
.
LAB25B    PACK      WLINEZ1,WWARD,SLASH,WBED
          RESET     WLINEZ1,8
.
          PACK      WLINEZ2,WBDESC
          RESET     WLINEZ2,20
.
          MOVE      PSNAME,WLINEZ3
          RESET     WLINEZ3,16
.
          MOVE      PGNAME,WLINEZ4
          RESET     WLINEZ4,20
.
          MOVE      AURNO,WLINEZ5
          RESET     WLINEZ5,8
.
          GOTO      LAB2598
.
.         Address Label
.
LAB25C    STRIP     PTITL
          STRIP     PGNAME
          MOVE      SP70,DIM1
          PACK      DIM1,PGNAME      
          STRIP     PSNAME
          PACK      WLINEZ1,PTITL,SP1,DIM1,DOT,SP1,PSNAME,SP70
          STRIP     WLINEZ1
          RESET     WLINEZ1
.
          MATCH     SP70,PTMXADD1
          GOTO      LAB25C5 IF EQUAL
          GOTO      LAB25C5 IF EOS
.
          MOVE      PTMXADD1,WLINEZ2
          RESET     WLINEZ2,25
.
          MOVE      PTMXADD2,WLINEZ3
          RESET     WLINEZ3,25
.
          MOVE      PTMXADD4,WLINE4
          RESET     WLINEZ4,25
.
          STRIP     PTMXADD3
          STRIP     PTMXPOST
          PACK      WLINEZ5,PTMXADD3,SP1,PTMXPOST
          RESET     WLINEZ5,25
.
          GOTO      LAB25C7
.
LAB25C5   MOVE      PADD1,WLINEZ2
          RESET     WLINEZ2,25
.
          MOVE      PADD2,WLINEZ3
          RESET     WLINEZ3,25
.
          MOVE      PADD4,WLINEZ4
          RESET     WLINEZ4,25
.
          STRIP     PSUBRB
          STRIP     PPOST
          PACK      WLINEZ5,PSUBRB,SP1,PPOST
          RESET     WLINEZ5,25
.
LAB25C7   UNPACK    PURNO,KEY1,DIM1,KEY6
          MATCH     "T",KEY1
          IF        @EQUAL
            PACK      WLINEZ6,SP1,KEY1,KEY6
          ELSE
            MOVE      PURNO,WLINEZ6
          ENDIF
          RESET     WLINEZ6,8
.
          GOTO      LAB2598
.
.         Alternate PMI Label
.
.         U/R
.
LAB25D    UNPACK    PURNO,KEY1,DIM1,KEY6
          MATCH     "T",KEY1
          IF        @EQUAL
            PACK      WLINEZ1,SP1,KEY1,KEY6
          ELSE
            MOVE      PURNO,WLINEZ1
          ENDIF
          SETLPTR   WLINEZ1,8
.
.         Surname
.
          MOVE      PSNAME,WLINEZ2
          SETLPTR   WLINEZ2,16
.
.         Given Name (Uppercase first letter of each name, rest in lowercase)
.
          CLEAR     WLINEZ3
          MOVE      PGNAME,ANS
LAB25D1   APPEND    ANS,WLINEZ3
          BUMP      PGNAME
          GOTO      LAB25D3 IF EOS
.
          MOVE      PGNAME,ANS
          MATCH     SP1,ANS
          GOTO      LAB25D2 IF EQUAL
.
          REP       "AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz",ANS
          GOTO      LAB25D1
.
LAB25D2   MOVE      PGNAME,ANS
          APPEND    ANS,WLINEZ3
          BUMP      PGNAME
          GOTO      LAB25D3 IF EOS
.
          MATCH     SP1,PGNAME
          GOTO      LAB25D2 IF EQUAL
          MOVE      PGNAME,ANS
          GOTO      LAB25D1
.
LAB25D3   RESET     PGNAME
          RESET     WLINEZ3
          SETLPTR   WLINEZ3,20
.
.         Date of Birth
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      "DOB: ",WLINEZ6
          ENDSET    WLINEZ6
          APPEND    CPCDATE,WLINEZ6
          RESET     WLINEZ6
          SETLPTR   WLINEZ6,15
.
.         U/R for barcode
.
          MOVE      PURNO,WLINEZ16
          ENDSET    WLINEZ16
          APPEND    ZFS,WLINEZ16
          RESET     WLINEZ16
          SETLPTR   WLINEZ16,11
.
          GOTO      LAB2598
.
.         GP Label (Added for TSK 0817740)
.
LAB25E    PACK      DIM60,SP20,SP20,SP20
          MOVE      ZERO,COUNTER
          MOVE      ZERO,ENDSTR
          MOVE      ZERO,TMPPTR
          MOVE      ZERO,PRTOPT1         * flag for print option
          MOVE      ZERO,PRTOPT2
.
          MOVE      ZERO,HCPDATFL                * initialise HCP data flag
.
          MATCH     "LABELPMI",IBLPLAPR          * PMI label ?
          GOTO      LAB25E2 IF EQUAL             * yes - ignore visit fields
.
.         Check to see if visit based HCP fields are populated and
.         read the corresponding record where populated.
.
          MOVE      ZERO,HCPDATFL                * initialise HCP data flag
.
          MATCH     SP10,PMVXRHC1                * visit HCP blank ?
          IF        !@EQUAL
            ADD       ONE,HCPDATFL               * no - update flag
            MOVE      PMVXRHC1,KEY10
            CALL      RDPMHCP1                   * visit HCP on file ?
            IF        OVRCD = 1
              MOVE      "Invalid HCP Code.",WLINEZ15
              GOTO      LAB25E90
            ENDIF
          ENDIF
.
          MATCH     SP10,PMVXRH1G                * visit practice blank ?
          IF        !@EQUAL
            ADD       TWO,HCPDATFL               * no - update flag
            PACK      KEY12,PMVXRH1G,SP1,ONE
            CALL      RDPMHCG1                   * visit practice on file ?
            IF        OVRCD = 1
              MOVE      "Invalid Practice Code.",WLINEZ15
              GOTO      LAB25E90
            ENDIF
          ENDIF
.
          COMPARE   ZERO,HCPDATFL                * visit based data available ?
          GOTO      LAB25E2 IF EQUAL             * no - use PMI data
.
.         Load the visit based details
.
          IF        HCPDATFL = 1
            MOVE      PMHCADR1,DIM60ZA           * load visit HCP address
            MOVE      PMHCADR2,DIM60ZB
            MOVE      PMHCADR3,DIM60ZC
            MOVE      PMHCPOST,DIMZ8
            MOVE      PMHCFAXN,DIMZ20
          ELSE
            MOVE      PMHGADD1,DIM60ZA           * load visit Practice address
            MOVE      PMHGADD2,DIM60ZB
            MOVE      PMHGADD3,DIM60ZC
            MOVE      PMHGPOST,DIMZ8
            MOVE      PMHGPFAX,DIMZ20
          ENDIF
          GOTO      LAB25E4
.
.         The visit based data is not available, so use the PMI
.         based data.
.
LAB25E2   MATCH     SP10,PMPXRHC1                * PMI HCP blank ?
          IF        !@EQUAL
            ADD       ONE,HCPDATFL               * no - update flag
            MOVE      PMPXRHC1,KEY10
            CALL      RDPMHCP1                   * PMI HCP on file ?
            IF        OVRCD = 1
              MOVE      "Invalid HCP Code.",WLINEZ15
              GOTO      LAB25E90
            ENDIF
          ENDIF
.
          MATCH     SP10,PMPXRH1G                * PMI practice blank ?
          IF        !@EQUAL
            ADD       TWO,HCPDATFL               * no - update flag
            PACK      KEY12,PMPXRH1G,SP1,ONE
            CALL      RDPMHCG1                   * PMI practice on file ?
            IF        OVRCD = 1
              MOVE      "Invalid Practice Code.",WLINEZ15
              GOTO      LAB25E90
            ENDIF
          ENDIF
.
          COMPARE   ZERO,HCPDATFL                * PMI based data available ?
          IF        @EQUAL
            MOVE      "No HCP Data.",WLINEZ15
            GOTO      LAB25E90
          ENDIF
.
          IF        HCPDATFL = 1
            MOVE      PMHCADR1,DIM60ZA           * load PMI HCP address
            MOVE      PMHCADR2,DIM60ZB
            MOVE      PMHCADR3,DIM60ZC
            MOVE      PMHCPOST,DIMZ8
            MOVE      PMHCFAXN,DIMZ20
          ELSE
            MOVE      PMHGADD1,DIM60ZA           * load PMI Practice address
            MOVE      PMHGADD2,DIM60ZB
            MOVE      PMHGADD3,DIM60ZC
            MOVE      PMHGPOST,DIMZ8
            MOVE      PMHGPFAX,DIMZ20
          ENDIF
.
LAB25E4   IF        HCPDATFL = 1 | HCPDATFL = 3
            CALL      GPINI000                   * Get GP Initials
            PACK      WLINEZ15,DIM1,SP1,KEY1,SP1,PMHCSNAM
          ELSE
            MOVE      PMHGPNAM,WLINEZ15
          ENDIF
.
          STRIP     DIM60ZA
          STRIP     DIM60ZB
          STRIP     DIM60ZC
          STRIP     DIMZ8
          STRIP     DIMZ20
          MOVE      DIM60ZA,DIM60
.
          MOVELPTR  DIM60,ENDSTR
          IF        ENDSTR<=25
            MOVE      DIM60,WLINEZ1
            GOTO      LAB25E7
          ENDIF
.
          MOVE      ONE,PRTOPT1          * two lines for address one
          RESET     DIM60,25             * Position on 25th char
          LENSET    DIM60
LAB25E6   BUMP      DIM60,-1             * search backwards for space
          MOVE      DIM60,ANS
          MATCH     SP1,ANS
          GOTO      LAB25E6 IF NOT EQUAL
.
          BUMP      DIM60,-1             * don't keep space on end
          MOVEFPTR  DIM60,TMPPTR         * save current postion of FP
          LENSET    DIM60                * set LL to current FP position
          RESET     DIM60,1              * move FP back to first char
          MOVE      DIM60,WLINEZ1
.
          RESET     DIM60,TMPPTR         * move FP back to previous position
          SETLPTR   DIM60,ENDSTR         * move LL back to end of string
.
          BUMP      DIM60,2
.
          MOVE      DIM60,WLINEZ2
.
LAB25E7   MOVE      ZERO,COUNTER
          MOVE      ZERO,ENDSTR
          MOVE      ZERO,TMPPTR
          PACK      DIM60,SP20,SP20,SP20
          MOVE      DIM60ZB,DIM60
          MOVELPTR  DIM60,ENDSTR
          IF        ENDSTR<=25
            MOVE      DIM60,WLINEZ3
            GOTO      LAB25E9
          ENDIF
.
          MOVE      ONE,PRTOPT2          * two lines for address 2
          RESET     DIM60,25
          LENSET    DIM60
LAB25E8   BUMP      DIM60,-1
          MATCH     SP1,DIM60
          GOTO      LAB25E8 IF NOT EQUAL
.
          BUMP      DIM60,-1             * don't keep space on end
          MOVEFPTR  DIM60,TMPPTR         * save current postion of FP
          LENSET    DIM60                * set LL to current FP position
          RESET     DIM60,1              * move FP back to first char
          MOVE      DIM60,WLINEZ3
.
          RESET     DIM60,TMPPTR         * move FP back to previous position
          SETLPTR   DIM60,ENDSTR         * move LL back to end of string
.
          BUMP      DIM60,2
.
          MOVE      DIM60,WLINEZ4
.
LAB25E9   PACK      WLINEZ5,DIM60ZC,SP1,DIMZ8
          MOVELPTR  DIMZ20,FORM2
          IF        FORM2 <> 0
            MOVE      "[Fax: ",WLINEZ20
            ENDSET    WLINEZ20
            APPEND    DIMZ20,WLINEZ20
            RESET     WLINEZ20
            STRIP     WLINEZ20
            ENDSET    WLINEZ20
            APPEND    "]",WLINEZ20
            RESET     WLINEZ20
          ENDIF
.
          GOTO      LAB2598
.
LAB25E90  MOVE      ONE,PRTOPT1
          MOVE      ONE,PRTOPT2
          MOVE      "U/R Number:",WLINEZ1
          MOVE      PURNO,WLINEZ2
          MATCH     "LABELINP",IBLPLAPR          * I/P PMI label ?
          IF        @EQUAL
            MOVE      "Visit Number:",WLINEZ3    * yes
            MOVE      PMVXVISN,WLINEZ4
          ENDIF
.
.         Load No. of Labels
.
LAB2598   UNPACK    NOLABEL,DIM1,ZCOPY
          REP       " 0",ZCOPY
.
LAB2599   RETURN
+
.******************************************************************************
.*                                 SETLAB26                                   *
.*                            Label 26 for Royal Children's                   *
.******************************************************************************
SETLAB26  PACK      WRCHURNO,SP20
          PACK      WRCHABOR,SP20
          PACK      WRCHFLAG,SP20
          PACK      WLINEZ2,SP20,SP20
          PACK      WLINEZ3,SP20,SP20
          PACK      WLINEZ4,SP20,SP20
          PACK      WLINEZ5,SP20,SP20
          PACK      WLINEZ6,SP20,SP20
          PACK      WLINEZ7,SP20,SP20
          PACK      WLINEZ8,SP20,SP20
          PACK      WLINEZ9,SP20,SP20
          PACK      WLINEZ10,SP20,SP20
          PACK      WLINEZ11,SP20,SP20
          PACK      WLINEZ12,SP20,SP20
          PACK      WLINEZ13,SP20,SP20
          PACK      WLINEZ14,SP20,SP20
          PACK      WLINEZ16,SP20,SP20
          PACK      WLINEZ17,SP20,SP20
          PACK      WLINEZ18,SP20,SP20
          PACK      WLINEZ19,SP20,SP20

          MOVE      SP70,WRCHURNO
          MOVE      SP70,WRCHABOR
          MOVE      SP70,WRCHFLAG

          MOVE      SP70,WLINEZ2
          MOVE      SP70,WLINEZ3
          MOVE      SP70,WLINEZ4
          MOVE      SP70,WLINEZ5
          MOVE      SP70,WLINEZ6
          MOVE      SP70,WLINEZ7
          MOVE      SP70,WLINEZ8
          MOVE      SP70,WLINEZ9
          MOVE      SP70,WLINEZ10
          MOVE      SP70,WLINEZ11
          MOVE      SP70,WLINEZ12
          MOVE      SP70,WLINEZ13
          MOVE      SP70,WLINEZ14
          MOVE      SP70,WLINEZ15
          MOVE      SP70,WLINEZ16
          MOVE      SP70,WLINEZ17
          MOVE      SP70,WLINEZ18
          MOVE      SP70,WLINEZ19
.
.---- UR number
.
          MOVE      URNUMBER,WRCHURNO
          RESET     WRCHURNO
          SQUEEZE   WRCHURNO
          STRIP     WRCHURNO
          MOVE      SP70,WRCHURNT
          PACK      WRCHURNT,WRCHURNO,ASTRIX
          MOVE      PMVXPIND,WRCHFLAG
          RESET     WRCHFLAG
.
.---- Surname
.
          MOVE      PSNAME,WLINEZ2
          RESET     WLINEZ2
.
.---- Given Name
.
          MOVE      PGNAME,WLINEZ3
          RESET     WLINEZ3
.
.---- Address
.
          MOVE      PADD1,WLINEZ4
          RESET     WLINEZ4
.
.---- Suburb and post code
.
          STRIP     PSUBRB
          STRIP     PPOST
          PACK      WLINEZ5,PSUBRB,SP1,PPOST,SP20
          RESET     WLINEZ5
.
.---- Home number
.
          MOVE      "Ph:",WLINEZ6
          ENDSET    WLINEZ6
          APPEND    SP1,WLINEZ6
          APPEND    PTELEP,WLINEZ6
          RESET     WLINEZ6
.
.----- Date of Birth
.
          MOVE      PMPXEDOB,FORM1
          IF        FORM1 = 1
            MOVE      "XX",CYEAR
            MOVE      "XXX",DIM3
            MOVE      "XX",CDAY
          ELSE
            UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
            MATCH     "01",CMON
            IF        @EQUAL
              MOVE      "JAN",DIM3
            ENDIF
.
            MATCH     "02",CMON
            IF        @EQUAL
              MOVE      "FEB",DIM3
            ENDIF
.
            MATCH     "03",CMON
            IF        @EQUAL
              MOVE      "MAR",DIM3
            ENDIF
.
            MATCH     "04",CMON
            IF        @EQUAL
              MOVE      "APR",DIM3
            ENDIF
.
            MATCH     "05",CMON
            IF        @EQUAL
              MOVE      "MAY",DIM3
            ENDIF
.
            MATCH     "06",CMON
            IF        @EQUAL
              MOVE      "JUN",DIM3
            ENDIF
.
            MATCH     "07",CMON
            IF        @EQUAL
              MOVE      "JUL",DIM3
            ENDIF
.
            MATCH     "08",CMON
            IF        @EQUAL
              MOVE      "AUG",DIM3
            ENDIF
.
            MATCH     "09",CMON
            IF        @EQUAL
              MOVE      "SEP",DIM3
            ENDIF
.
            MATCH     "10",CMON
            IF        @EQUAL
              MOVE      "OCT",DIM3
            ENDIF
.
            MATCH     "11",CMON
            IF        @EQUAL
              MOVE      "NOV",DIM3
            ENDIF
.
            MATCH     "11",CMON
            IF        @EQUAL
              MOVE      "NOV",DIM3
            ENDIF
.
            MATCH     "12",CMON
            IF        @EQUAL
              MOVE      "DEC",DIM3
            ENDIF
          ENDIF
.
          MOVE      "DOB:",DIM4
          PACK      WLINEZ8,DIM4,CDAY,DASH,DIM3,DASH,CYEAR,SP10
          RESET     WLINEZ8
.
.----- Religion
.
          PACK      WLINEZ9,SP20,SP20
          PACK      KEY5,ANSR,SP1,PREG,SP1
          CALL      RDCODE1
          IF        OVRCD = 1
            MOVE      PREG,WLINEZ9
          ELSE
            MOVE      TDESC,WLINEZ9
          ENDIF
.
.----- Medicare Number
.
          STRIP     PMEDI
          STRIP     PTMXMCCD
          MOVE      "MC No:",WLINEZ10
          ENDSET    WLINEZ10
          APPEND    PMEDI,WLINEZ10
          APPEND    SP1,WLINEZ10
          APPEND    PTMXMCCD,WLINEZ10
          RESET     WLINEZ10
.
. ------- Parent Names
.
          MATCH     "1",PMPXFLAB
          IF        @EQUAL
            MOVE      PMPXFSNA,WLINEZ11
            RESET     WLINEZ11
            MOVE      PMPXFGNA,WLINEZ12
            RESET     WLINEZ12
          ENDIF
.
          MATCH     "1",PMPXMLAB
          IF        @EQUAL
            MOVE      PMPXMSNA,WLINEZ13
            RESET     WLINEZ13
            MOVE      PMPXMGNA,WLINEZ14
            RESET     WLINEZ14
          ENDIF
.
. ------- Julian Date
.
          MOVE      JULDAY,DIM3A
          MOVE      JULYR,DIM2A
          REP       " 0",DIM3A   
          REP       " 0",DIM2A  
          PACK      WLINEZ16,LBRACK,DIM3A,DIM2A,RBRACK,SP20
.
          MOVE      PSEX,WLINEZ17
          RESET     WLINEZ17
.
.----- Interpreter Required? Language?
.
          MOVE      ZERO,FORM1
          MOVE      PMPXINTR,FORM1
          IF        FORM1 = 1
            PACK      KEY5,ANSL,ANSA,PMPXLNG1
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      TDESC,WLINEZ7 
            ENDIF
.
            PACK      KEY5,ANSL,ANSA,PMPXLNG2
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      TDESC,WLINEZ1 
            ENDIF
          ENDIF
.
.----- Aboriginal/Torres Strait Descent?
.
          CALL      INDIG000
.
          RETURN
+
.******************************************************************************
.*                                 SETLAB27                                   *
.*                            Label 27 for SJOG Geelong                       *
.******************************************************************************
.
SETLAB27  MOVE      THREE,SJOGFLAG               * set flag for I/P label
.
          CALL      SETSJOGL                     * in SJOGLABL.PBL
.
          RETURN
+
.*******************************************************************************
.*        Subroutine to get indigenious status                                 *
.*******************************************************************************
.
INDIG000  MOVE      SP70,WLINEZ18
          MATCH     SP70,PMVXABRG
          IF        !@EQUAL
            PACK      KEY5,ANSV,ANSA,PMVXABRG,SP70
            GOTO      INDIG100
          ENDIF
.
          MATCH     SP70,PMPXABRG
          GOTO      INDIG999 IF EQUAL
          PACK      KEY5,ANSV,ANSA,PMPXABRG,SP70
.
INDIG100  CALL      RDCODE1
          BRANCH    OVRCD,INDIG999
.
          MATCH     "1",TCINDC1
          IF        @EQUAL
            MOVE      "INDIG",WLINEZ18
          ENDIF
.
          MOVE      TDESC,WLINEZ19
.
INDIG999  RETURN
+
.*******************************************************************************
.*        Subroutine to keyin ward for pre-admissions                          *
.*******************************************************************************
ASKWARD   COMPARE   ONE,PTWRDLAB       * Print ward for pre-admissions ?
          GOTO      ASKW999 IF NOT EQUAL
.
          MATCH     SP3,AWARD
          GOTO      ASKW999 IF NOT EQUAL
.
ASKW100   DISPLAY   *P1:24,*EL,"Ward to Appear on Labels ",UNDLN3;
.
          KEYIN     *P26:24,*V2LON,AWARD;
.
          ENDSET    AWARD
          APPEND    SP3,AWARD
          RESET     AWARD
.
          DISPLAY   *P26:24,*EL,*V2LON,AWARD;
.
          MATCH     SP3,AWARD
          GOTO      ASKW999 IF EQUAL
.
          PACK      KEY6,AWARD,SP5
          CALL      RDWARD1
          COMPARE   ZERO,OVRCD
          GOTO      ASKW999 IF EQUAL
.
          DISPLAY   *P1:24,*EL,*B,"Invalid Ward - Hit <":
                    *V2LON,"ENTER",*HOFF,"> to Continue ";
          KEYIN     *EOFF,ANS;
          DISPLAY   *P1:24,*EL;
          GOTO      ASKW100 
.
ASKW999   RETURN
+
.*******************************************************************************
.*        Subroutine to set up a lineup print                                  *
.*******************************************************************************
.
SETLINUP  BRANCH    CTYPLAB,LINUP1,LINUP2,LINUP3,LINUP2,LINUP4:
                            LINUP6,LINUP7,LINUP8,LINUP0,LINUP10:
                            LINUP11,LINUP12,LINUP13,LINUP0,LINUP15:
                            LINUP16,LINUP17,LINUP18,LINUP2,LINUP20:
                            LINUP21,LINUP22,LINUP23,LINUP24,LINUP25
.
LINUP0    MOVE      "XXXXXXXXXXXXXXXXXXXXX XXXX 999999",WGLINE1
          MOVE      "DOB: XX/XX/XX  DOC: XXXXXXXXXXXXX",WGLINE2
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXX  --UR--",WLINE1
          MOVE      "XXXXXXXXXXXXXXXXXXXXX XXXX 999999",WLINE2
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXX        ",WLINE3
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXX     XXX",WLINE4
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXX9999    ",WLINE5
          MOVE      "DOB: XX/XX/XX  XXXXXX  XXXXXXXX  ",WLINE6
          MOVE      "MEDI:XXXX-XXXXX-X     ADM: 999999",WLINE7
          MOVE      "PEN:XXXXXXXXXX DOC: XXXXXXXXXXXXX",WLINE8
          RETURN
.
LINUP1    MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXX XXXX     ",WLINE1A
          MOVE      "DOB: 99/99/99 XXXXXX    UR:99999999   ",WLINE2A
          MOVE      "XXXX.X.X.XXXXXXXXXXXXX.DOC:XXXXXX.....",WLINE3A
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXX  XXX XXX/XXX",WLINE4A
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXX  XXXXXX  XXX",WLINE5A
          MOVE      "XXXXXXXXXXXXXXX      9999 X XXXXXXXXXX",WLINE6A
          MOVE      "PRES:999999 XXXX X.XXXXXXXXXXXXXXXXXXX",WLINE7A
          MOVE      "ADM: 99/99/99            ADM: 99999999",WLINE8A
          RETURN
.
LINUP2    MOVE      "XXXXXXXXXXXXXXX XXX ",WGLINE1
          MOVE      "XXXXXXXXXX 999999XXX",WGLINE2
          MOVE      "XXXXXXXXXXXXXXXXXXXX",WGLINE3
          MOVE      "XXXXXXXXXXXXXXXXXXXX XXX XXXXXXX ",WLINE1
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXX XXX X  ",WLINE2
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXX XXXX   ",WLINE3
          MOVE      "XXXXXXXXXXXXXXXXXXXX XXXXXXXXXXXX",WLINE4
          MOVE      "XXXXXXXXXX  UR: 999999 AD: 999999",WLINE5
          RETURN
.
LINUP3    MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXX 999999",WLINE1
          MOVE      "99/99/99 XXXXXXXXXXXXXXXXXXXXXXXX",WLINE2
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXX  XXXXXX",WLINE3
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXX  999999",WLINE4
          MOVE      "XXXXXXXXXXXXXXX9999 XXX9999999999",WLINE5
          RETURN
.
LINUP4    MOVE      "XXXXXXXXXXXXXXXXXXXXX X   999999X",WLINE1
          MOVE      "XXXXXXXXXXXXXXX 99/99/9999 XXXXXX",WLINE2
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXX 9999",WLINE3
          MOVE      "XXXXXXXXXXXXXXXXXXXXX XXX/XXX XX ",WLINE4
          MOVE      "9999999999   999999   XXX        ",WLINE5
          RETURN
.
LINUP6    MOVE      "XXXXXXXXXXXXXXXXXXXXX X XXX X 99999999",WLINE1A
          MOVE      "XXXXXXXXXXXXXXXXXX XXXX X XXX XX/XX/XX",WLINE2A
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",WLINE3A
          MOVE      "XXXXXXXXXXXXXXX  99999999 XX/XX/XX XXX",WLINE4A
          MOVE      "XX XXX XXXXXXXXXXXXXXXXXXX XXX XXX XXX",WLINE5A
          RETURN
.
.         Southland/New Zealand Format
.
LINUP7    MOVE      " XXXXXXXXXXXXXXX XXXX UR:XXXXXX  ",WLINE1
          MOVE      " XXXXXXXXXXXXXXX X 99/99/99 XXX  ",WLINE2
          MOVE      " XXX XXXXXXXX XXXXXXXXXXXXXXXXX  ",WLINE3
          MOVE      " XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX  ",WLINE4
          MOVE      " XXXXXXXXXXXXXXX   PH:XXXXXXXXX  ",WLINE5
          RETURN
.
.         Bundoora Extended Care Format
.
LINUP8    MOVE      " XXXXXXXXXXXXXXXXXXX BECC UR: XXXXXXXX",WFLINE1
          MOVE      "                                      ",WFLINE2
          MOVE      " XXXX XXXXXXXXXXXXXXXXXXXXXXXXX       ",WFLINE3
          MOVE      " XXXXXXXXXXXXXXXXXXXXXXXXX            ",WFLINE4
          MOVE      " XXXXXXXXXXXXXXXXXXXXXXXXX            ",WFLINE5
          MOVE      " XXXXXXXXXXXXXXX                  XXXX",WFLINE6
          MOVE      " TEL: XXXXXXXXXXXX     DOB: XX/XX/XXXX",WFLINE7
          MOVE      " SEX: XXXXXXXX                        ",WFLINE8
          RETURN
.
.         Hong Kong
.
LINUP10   MOVE      "XXXXXXXXXX XXXXXXXXXXXX  ",WLINE1
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXX ",WLINE2
          MOVE      "XXXXXX       XX/XX/XXXX  ",WLINE3
          MOVE      "XXXXXXXX                 ",WLINE4
          MOVE      "                         ",WLINE5
          RETURN
.
.         West Gippsland
.
LINUP11   MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",WGLINE1
          MOVE      "UR: ",WGLINE2
          APPEND    "XXXXXXXX          XX/XX/XX",WGLINE2
          RESET     WGLINE2
          MOVE      "XXXXXXXXXXXXXXXX/XXXXXXXXXXXXXXXX",WGLINE3 
          MOVE      "XXXXXXXXXXXXXXXXXX",BOLDSURN
          MOVE      " X X X X X X X X",BOLDUR
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXX XXXXXXXXXXXX",WLINE2A
          MOVE      "Admitted XX/XX/XX   ",ADMLINE
          MOVE      "XXXXXXXXXXXXX",ADOC13
          MOVE      "XXX",AWARD
          MOVE      "XXXXXXXXXXXXXXXXXXXXX",ADD121
          MOVE      "X",PSEX
          MOVE      "XXX",PMSTAT
          MOVE      "XXXXXXXXXX",RELDESC
          MOVE      "XXXXXXXXXXXXXXXXXXXXX XX/XX/XX",LN5DIM30
          MOVE      "999",PSAGE
          MOVE      "Acc.## IP XXXXXXXX XXX XXXXXXXXXXXX XXX",WLINE6A
          RETURN
.
.         Line-up for Monash Day Centre 
.
LINUP12   MOVE      "                            UR: 999999",WLINE1A
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",WLINE2A
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",WLINE3A
          MOVE      "XXXXXXXXXXXXXXXXXXX 9999 DOB: 99-99-99",WLINE4A
          MOVE      "PH: 999999999999 (H)  999999999999 (W)",WLINE5A
          MOVE      "DATE OF ADMISSION:  99-99-99          ",WLINE6A
          MOVE      "SURGEON:  XXXXXXXXXXXXXXXXXXXXXXXXXXXX",WLINE7A
          RETURN
.
.         Line-up for Dudley
.
LINUP13   MOVE      "XXXXXXXXXXXXXXXXXXXX 99999999 ",WLINE1A
          MOVE      "                              ",WLINE2A
          MOVE      "XXXXXXXXXXXXXXXXXX X 99/99/99 ",WLINE3A
          MOVE      "                              ",WLINE4A
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXX ",WLINE5A
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXX ",WLINE6A
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXX ",WLINE7A
          MOVE      "XXXXXXXXXXXXXXXXXXXX 99999999 ",WLINE8A
.
          MOVE      "XXXXXXXXXXXX X XXXXXXXXXXXX X ",WLINE1
          MOVE      "99999999 X 999 99999999 X 999 ",WLINE2
          RETURN
.
.         Line-up for Hawkes Bay
.
LINUP15   MOVE      "XXXXXXXXXXXXXXXXXXX XXXX XXXXXXX",WLINE1
          MOVE      "XXXXXXXXXXXXXXXX X 999Y 99/99/99",WLINE2
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",WLINE3
          MOVE      "XXXXXXXXXXXXXXXXX 99/99/99  XXXX",WLINE4
          MOVE      "GP: XXXXXXXXXXXXXXXXXXXXXXXXXXXX",WLINE5
          RETURN
.
.      Line up for Mt Alvernia
.
LINUP16   MOVE      "XXXX XXXXXXXX XXXXXXXXXX (X)99999999",WLINE1A
          MOVE      "999 YEARS XXXXXXXXXXXXXXXXXX XXX XXX",WLINE2A
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXX  99/99/99",WLINE3A
          MOVE      "XXXXXXXXXXXXXXXXXXXX                ",WLINE4A
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",WLINE5A
          RETURN
.
.         Line-up for Taranaki
.
LINUP17   MOVE      "XXXXXXXXXXXXXXX XXXX 99/99/99   XXXXXXXX",WFLINE1
          MOVE      "XXXXXXXXXXXXXXXXXXXXX X    99X          ",WFLINE2
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",WFLINE3
          MOVE      "XXXXXXXXXXXXXXX XXX/XXX 99/99/99    XXX ",WFLINE4
          MOVE      "GP: XXXXXXXXXXXXXXXXXXXXXXXXXXXXX MWS:XX",WFLINE5
.
.---------Wrist Bands
          MOVE      "XXXXXXXXXXXXXXXXXXXX XXXXX XXXXXXXX",WGLINE1 
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",WGLINE2
          MOVE      "Date of Birth : 99/99/99           ",WGLINE3
          RETURN
.
.         Line-up for Port Macquarie
.
LINUP18   MOVE      "PMBH   WARD: XXX      UR:99999999",WLINE1
          MOVE      "XXXXXXXXXXXXXXX  X   DOB:99/99/99",WLINE2
          MOVE      "XXXXXXXXXXXXXXX  XXX ADM:99999999",WLINE3
          MOVE      "XXXXXXXXXXXXXXX          99/99/99",WLINE4
          MOVE      "XXXXXXXXXXXXXXX  XXXX            ",WLINE5
          MOVE      "                       XXXX/XXXXX",WLINE6
          MOVE      "AMO:DR X XXXXXXXXXXXXXX CLASS:XXX",WLINE7
          MOVE      "LMO:DR X XXXXXXXXXXXXXX          ",WLINE8
          RETURN
.
. ----- Line-up for St.Lukes -----
.
LINUP20   MOVE      "XXXXXXXXXXXXXXXXXX  (XXXX)    XXXXXXXX",WLINE1A
          MOVE      "XXXXXXXXXXXXXXXXXX      DOB : 99/99/99",WLINE2A
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXX          ",WLINE3A
          MOVE      "XXXXXXXXXXXXXXXX  XXXX      Age : 999X",WLINE4A
          MOVE      "Admitted   : 99/99/99   Adm : XXXXXXXX",WLINE5A
          MOVE      "Consultant : XXXX. X. XXXXXXXXXXXXXXXX",WLINE6A
          MOVE      "Acc : XXX            Pens : XXXXXXXXXX",WLINE7A
          MOVE      "Religion   : XXX  XXXXXXXXXXXXXXXXXXXX",WLINE8A
          RETURN
.
. ----- Line-up for Coast Health Care -----
.
LINUP21   MOVE      "XXXXXXXXXXXXXXXXX XXXX 99/99/99 XXXXXXXX",WFLINE1
          MOVE      "XXXXXXXXXXXXXXXXXXXXX X   99X           ",WFLINE2
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",WFLINE3
          MOVE      "X XXXXXXXXXXXXX XXX/XXX 99/99/99  XXX   ",WFLINE4
          MOVE      "GP: X XXXXXXXXXXXXXXXXXXX  ADM: XXXXXXXX",WFLINE5
.
. ----- Wrist Bands -----
.
          MOVE      "XXXXXXXXXXXXXXXXXXX XXXX XXXXXXXX",WGLINE1 
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",WGLINE2
          MOVE      "DOB: 99/99/99       ADM: XXXXXXXX",WGLINE3
          RETURN
.
. ----- Line-up for St. Vincents Bathurst -----
.
LINUP22   MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",WLINE1A
          MOVE      "DOB: 99/99/99 XXXXXX     UR:  99999999",WLINE2A
          MOVE      "XX.X.XXXXXXXXXXXXXXXXXXX.DOC:.XXXXXX..",WLINE3A
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXX  XXX XXX/XXX",WLINE4A
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXX  XXXXXX  XXX",WLINE5A
          MOVE      "XXXXXXXXXXXXXXXXXXXX 9999 X XXXXXXXXXX",WLINE6A
          MOVE      "PRES: 999999                          ",WLINE7A
          MOVE      "ADM: 99/99/99            ADM: 99999999",WLINE8A
          RETURN
.
.         Line-up for Mersey
.
LINUP23   MOVE      "MCH    WARD: XXX      UR:99999999",WLINE1
          MOVE      "XXXXXXXXXXXXXXX  X   DOB:99/99/99",WLINE2
          MOVE      "XXXXXXXXXXXXXXX  XXX ADM:99999999",WLINE3
          MOVE      "XXXXXXXXXXXXXXX          99/99/99",WLINE4
          MOVE      "XXXXXXXXXXXXXXX  XXXX            ",WLINE5
          MOVE      "                       XXXX/XXXXX",WLINE6
          MOVE      "VMO:DR X XXXXXXXXXXXXXX CLASS:XXX",WLINE7
          MOVE      "GP :XXXXXXXXXXXXXXXXXXXXXX       ",WLINE8
          RETURN
.
.         Line-up for Mercy Dunedin
.
LINUP24   MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX XXXXXXX",WLINE1A
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",WLINE2A
          MOVE      "XXXXXXXXXXXX     99/99/99  999    XXXX",WLINE3A
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXX XXXXXXXXXXXX",WLINE4A
          MOVE      "XXXXXXXX  99/99/99  XXX XXX XXXXXXXXXX",WLINE5A
          RETURN
.
.         Line-up for St Vincent's
.
LINUP25   MOVE      "XXXXXXX",WLINEZ1
          MOVE      "XXXXXXXXXXXXXXXX",WLINEZ2
          MOVE      "XXXXXXXXXXXXXXXXXXXX",WLINEZ3
          MOVE      "XXXX",WLINEZ4
          MOVE      "XXXXXX",WLINEZ5
          MOVE      "DoB:99/99/9999",WLINEZ6
          MOVE      "999yr",WLINEZ7
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXX",WLINEZ8
          MOVE      "XXXXXXXXXXXXXXXXXXXX 9999",WLINEZ9
          MOVE      "XXXXXXXXXXX",WLINEZ10
          MOVE      "(Printed 99/99/99)",WLINEZ11
          MOVE      "(X)",WLINEZ12
          MOVE      "99999999999",WLINEZ13
          MOVE      "XXXXXXXX",WLINEZ14
          RETURN
.
.      Routine to find the second initial from the given name
.
GIVNAM    MOVE      SP30,KEY25
          MOVE      DGNAME,KEY25
          CALL      BUMP00
.
          MATCH     SP30,KEY25
          RETURN    IF EQUAL
.
          BUMP      KEY25,1
          MOVE      KEY25,ANS
          APPEND    ANS,WLINE4
          APPEND    ".",WLINE4
          RETURN
.
BUMP00    CMATCH    SP1,KEY25
          RETURN    IF EQUAL
          CMATCH    ".",KEY25
          RETURN    IF EQUAL
          BUMP      KEY25,1
          GOTO      BUMP01 IF EOS
          GOTO      BUMP00
.
BUMP01    MOVE      SP30,KEY25
          RETURN
.
.          Subroutine to find the end of the string in WGLINE1
.
FINDEND   RESET     WGLINE1,33
FINDLP1   CMATCH    SP1,WGLINE1
          RETURN    IF NOT EQUAL
          BUMP      WGLINE1,-1
          GOTO      FINDLP1 IF NOT EOS
.
          RESET     WGLINE1
          RETURN
.
.          Subroutine to find the end of the string in WGLINE3
.
FINEND    CMATCH    SP1,WGLINE3
          RETURN    IF NOT EQUAL
          BUMP      WGLINE3,-1
          GOTO      FINEND IF NOT EOS
.
          RESET     WGLINE3
          RETURN
.
.          Subroutine to find the end of the string in WLINE1
.
FINEND1   CMATCH    SP1,WLINE1
          RETURN    IF NOT EQUAL
          BUMP      WLINE1,-1
          GOTO      FINEND1 IF NOT EOS
.
          RESET     WLINE1
          RETURN
.
.          Subroutine to find the end of the string in WLINE3
.
FINEND3   CMATCH    SP1,WLINE3
          RETURN    IF NOT EQUAL
          BUMP      WLINE3,-1
          GOTO      FINEND3 IF NOT EOS
.
          RESET     WLINE3
          RETURN
.
.          Subroutine to find the end of the string in WLINE4
.
FINEND4   CMATCH    SP1,WLINE4
          RETURN    IF NOT EQUAL
          BUMP      WLINE4,-1
          GOTO      FINEND4 IF NOT EOS
.
          RESET     WLINE4
          RETURN
.
.          Subroutine to find the end of the string in WLINE3A
.
FINEND3A  CMATCH    SP1,WLINE3A
          RETURN    IF NOT EQUAL
          BUMP      WLINE3A,-1
          GOTO      FINEND3A IF NOT EOS
.
          RESET     WLINE3A
          RETURN
.
.          Subroutine to find the end of the string in WLINE4A
.
FINEND4A  CMATCH    SP1,WLINE4A
          RETURN    IF NOT EQUAL
          BUMP      WLINE4A,-1
          GOTO      FINEND4A IF NOT EOS
.
          RESET     WLINE4A
          RETURN
.
.          Subroutine to get the Patients first name, returned in KEY25
.
GET1NAM   MOVE      ZERO,SECINT
          MOVE      PGNAME,KEY25
LLOOP1    CMATCH    SP1,KEY25
          GOTO      LCONT1 IF EQUAL
LLOOP2    BUMP      KEY25
.
          BRANCH    CTYPLAB,LLOOP3,LLOOP3,LLOOP4,LLOOP3,LLOOP3
.
LLOOP3    GOTO      LLOOP1 IF NOT EOS
          GOTO      LCONT1
.
LLOOP4    COMPARE   ONE,SECINT
          GOTO      LCONT0 IF EQUAL
.
          MATCH     SP1,KEY25
          CALL      GETNAM9 IF EQUAL
          GOTO      LLOOP2
.
.          Check if we found the second given name
.
LCONT0    MATCH     SP1,KEY25
          GOTO      LCONT1 IF EQUAL
.
          APPEND    ".",KEY25
.
LCONT1    APPEND    SP30,KEY25
          RESET     KEY25
          RETURN
.
GETNAM9   MOVE      ONE,SECINT
          RETURN
.
.*********************************************************************
.         get the Hong Kong Id for a patient
.         Returns : WLINE1        the first label line
.*********************************************************************
          DEFPROC   STLBHK00
.
          INC       PATNIDFD/INC
KEY10     DIM       10
.
          MOVE      PTMXCHNM,KEY10          * truncate chinese name
          PACK      PNGNAME,SP20,SP20
          OPEN      PATNIDA1,"patnidaf"
          PACK      KEY10,CHOSINDX,PURNO
          MOVE      SP20,PTNINMPI           * clear the field
          CALL      RDPTNID1
          CLOSE     PATNIDA1
.
          PACK      PNGNAME,PTNINMPI,SP30
          SQUEEZE   PNGNAME
.
          PACK      WLINE1,KEY10,SP1,PNGNAME,SP30
          GOTO      STLBHK99
.
          INC       PATNIDIO/INC
          INC       IBAOVRIO/INC
.
STLBHK99  ENDPROC
+
.******************************************************************************
.* Get the I/C number for Mt Alvernia
.******************************************************************************
          DEFPROC   MTAICNO
.         
          INC       PATNIDFD/INC
.
MTAIC00
          OPEN      PATNIDA1,"patnidaf"
.
          PACK      KEY10,CHOSINDX,PURNO,SP20
.
          CALL      RDPTNID1
          CLOSE     PATNIDA1
.
          MOVE      PTNINMPI,WLINE4A 
          GOTO      MTAIC99
.
          INC       PATNIDIO/INC
          INC       IBAOVRIO/INC
.
MTAIC99   ENDPROC

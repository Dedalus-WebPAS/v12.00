. **********************************************************
. *              P R O G R A M  S U M M A R Y              *
. *              -------------  -------------              *
. *                                                        *
. * PROGRAM NAME:     IBABOK70                             *
. *                                                        *
. * FUNCTION:         BOOKING CANCELLATION REPORT          *
. *                                                        *
. * DATE WRITTEN:     10/02/88                             *
. *                                                        *
. * AUTHOR:           J CLARK                              *
. *                                                        *
. * MODIFICATIONS:                                         *
. **********************************************************
. * V9.03.00  13.08.2003  Sandra Barcham     42394         *
. *           Ported IBABOK70 to v9.03                     *
. **********************************************************
. * V5.08.B01 05/01/2000  Tonii Tang                       *
. *           Fixed period range,no longer displays        *
. *           error message when period range is 13        *
. **********************************************************
. * V5.07.04  06/12/1999  Jill Habasque                    *
. *           Zero filled date display                     *
. * V5.07.03  03/11/1999  Jill Habasque                    *
. *           Fixed date display                           *
. * V5.07.02  06/10/1999  Jill Habasque SRF 634273         *
. *           Fixed period range                           *
. *       V5.07.01 17/03/1999 Jim Stathopoulos             *
. *                Fixed period range problem              *
. **********************************************************
. *                       W2.01 16/06/88 M.HAYSE           *
. *                       CHECK FOR UNKNOWN CODES          *
. *                       V4.00 22/08/88 M.HAYSE           *
. *                       DEPOSIT ADDED                    *
. *                       V4.02 25/08/88 M.HAYSE           *
. *                       NEW FORMAT BREAKDOWN NOR,MAT,THE *
. *                       V4.03 M.HAYSE 29/09/88           *
. *    BOOKING  DELIVERIES=BSBOOK-BSUNDLV-BSCANCB          *
. *    ACTUAL   DELIVERIES=BSDELV                          *
. *                       V4.04 M.HAYSE 29/09/88           *
. *                             HEADING TO BOOK MNTH STAT  *
. *                       V5.00 21.02.89 S.Barcham         *
. *                             Fix Heading                *
. *                             SRF003419                  *
. *                       V5.01 10/06/89 M.Ohleiter        *
. *                             Fix date input             *
. *                             SRF 101032                 *
. *   **** NB ****        V5.00 15/06/89 M.Ohleiter        *
. *                             New program for SAM        *
. *                             SRF 005785                 *
. *                             Just cancellations         *
. *                             Using bokcanfd             *
. *                    V5.01.01 27/06/89 M.Ohleiter        *
. *                             Updated for new release    *
. *                    V5.01.02 26/09/89 M.Ohleiter        *
. *                             Was not printing data      *
. *                             correctly - fixed SRF102047*
. *                    V5.01.03 12/02/90 J.Tan  SRF 103902 *
. *                             Change to cancelation date *
. *                                                        *
. **********************************************************
.
          INC       STD001FD
.
          INC       BOKCANFD/INC
          INC       PATCODFD/INC
          INC       PATCOMM/INC
          INC       PATDRGFD/INC
.
.        EXTRA   VARIABLES
.
PBCTYPE   DIM       3
SECFLAG   FORM      1
SGYR      DIM       4
STCC      DIM       2
STDD      DIM       2
STMM      DIM       2
STYY      DIM       2
STCCYY    DIM       4
STDATE    DIM       6
.
DFRDATE   DIM       10
ENDCC     DIM       2
ENDMM     DIM       4
ENDYY     DIM       2
ENDDATE   DIM       6
.
IENDMM    FORM      4
ENDMM1    DIM       4
FYEAR     FORM      2
FROMDATE  DIM       8
TODATE    DIM       10
.
OPTDES    DIM       24
OPTDES1   INIT      "Booked                  "
OPTDES2   INIT      "No of Booked Admissions "
OPTDES3   INIT      "Deliveries              "
OPTDES4   INIT      "Un-Delivered            "
OPTDES5   INIT      "Booking Cancellations   "
OPTDES6   INIT      "Admission Cancellations "
OPTDES7   INIT      "No of Booked Discharges "
OPTDES8   INIT      "Deposits Paid           "
OPTDES9   INIT      "No of Babies Born       "
OPTDES10  INIT      "Booking Canc. Theatre   "
OPTDES11  INIT      "Booking Canc. Bookings  "
OPTDES12  INIT      "Booking Canc. Maternity "
.
OPT2      DIM       17
OPTD1     INIT      "Booked           "
OPTD2     INIT      "No of Booked Admn"
OPTD3     INIT      "Deliveries       "
OPTD4     INIT      "Un-Delivered     "
OPTD5     INIT      "Booking Cancell'n"
OPTD6     INIT      "Admissn Cancell'n"
OPTD7     INIT      "No of Booked Disc"
OPTD8     INIT      "Deposits Paid    "
OPTD9     INIT      "No of Babies Born"
.
JAN       INIT      "January  "
FEB       INIT      "February "
MAR       INIT      "March    "
APR       INIT      "April    "
MAY       INIT      "May      "
JUN       INIT      "June     "
JUL       INIT      "July     "
AUG       INIT      "August   "
SEP       INIT      "September"
OCT       INIT      "October  "
NOV       INIT      "November "
DEC       INIT      "December "
.
MONTH     DIM       9
LIMIT     FORM      2
.
FORM6     FORM      6
LFLAG     FORM      1
FIRSTFLG  FORM      1
.
JMON      FORM      2
NUMB      FORM      1
.
XCOUNT    FORM      2
SBCDATE   DIM       6
NUM       FORM      6
.
CODEBK    INIT      "BK"
CODEBC    INIT      "BC"
.
CODEXXX   DIM       3
CODENOR   INIT      "NOR"
CODEMAT   INIT      "MAT"
CODETHE   INIT      "THE"
COUNT     FORM      8
DIM10     DIM       10
.
.
F0A       FORM      6
F1A       FORM      6
F2A       FORM      6
F3A       FORM      6
F4A       FORM      6
F5A       FORM      6
F6A       FORM      6
F7A       FORM      6
F8A       FORM      6
F9A       FORM      6
F10A      FORM      6
F11A      FORM      6
F12A      FORM      6
F13A      FORM      6
FTOTAL    FORM      7
.
SCTYPE    DIM       3
SVTYPE    DIM       3        
SV2TYPE   INIT      "   "
SVVAR     INIT      "   "
SAMEFLG   FORM      1
SFLAG     FORM      1
SP12      INIT      "            "
.
T0        FORM      6
T1        FORM      6
T2        FORM      6
T3        FORM      6
T4        FORM      6
T5        FORM      6
T6        FORM      6
T7        FORM      6
T8        FORM      6
T9        FORM      6
T10       FORM      6
T11       FORM      6
T12       FORM      6
T13       FORM      6
TTOTAL    FORM      7
.
M0        DIM       2
M1        DIM       2
M2        DIM       2
M3        DIM       2
M4        DIM       2
M5        DIM       2
M6        DIM       2
M7        DIM       2
M8        DIM       2
M9        DIM       2
M10       DIM       2
M11       DIM       2
M12       DIM       2
M13       DIM       2
.
Y0        DIM       2
Y1        DIM       2
Y2        DIM       2
Y3        DIM       2
Y4        DIM       2
Y5        DIM       2
Y6        DIM       2
Y7        DIM       2
Y8        DIM       2
Y9        DIM       2
Y10       DIM       2
Y11       DIM       2
Y12       DIM       2
Y13       DIM       2
.
XMM       DIM       2
YMM       DIM       2
ABSMON    FORM      2
.
PRGID     INIT      "IBABOK70"
PRGNAM    INIT      "Booking Cancellation Report"
VERSION   INIT      "V12.00.00"
+
.         START OF PROGRAM
.
          CALL      DISPHEAD
.
          DISPLAY   *P64:24,"bokcanaf";
          OPEN      BOKCANA1,"bokcanaf"
.
          DISPLAY   *P64:24,"patcodes";
          OPEN      PATCODE1,"patcodes"
.
          DISPLAY   *P64:24,"patdrgaf";
          OPEN      PATDRGA2,"patdrgaf"
.
          DISPLAY   *P64:24,"patdrgaf";
          OPEN      PATDRGA1,"patdrgaf"
.
START     DISPLAY   *P1:24,*EL,*P1:4,*V2LON,ZERO,*HOFF," = Exit":
                    *P1:5,*V2LON,ONE,*HOFF," = Normal":
                    *P1:6,*V2LON,TWO,*HOFF," = Maternity":
                    *P1:7,*V2LON,THREE,*HOFF," = Theatre"
.
BEGIN     KEYIN     *P1:9,*EF,"Please Select : ",*V2LON,OPTION
.
          COMPARE   ZERO TO OPTION
          GOTO      ENDIT IF EQUAL
.
          LOAD      CODEXXX USING OPTION OF CODENOR,CODEMAT,CODETHE
          BRANCH    OPTION OF START1,START1,START1
.
          DISPLAY   *P35:9,*B,*V2LON,"** Invalid Selection **",*W2;
          GOTO      BEGIN
.
START1    DISPLAY   *P1:16,*EL,"From  Period  :":
                    *P1:18,*EL,"To    Period  :"
.
          MOVE      SP2,STMM
          MOVE      SP2,STYY
          MOVE      SP2,STCC
          MOVE      SP2,STDD
.
KIBA25    MOVE      STMM,CMON
          MOVE      STYY,CYEAR
          MOVE      STCC,CCENT
.
          MOVE      TEN7,CCOL
          MOVE      TEN6,CVERT
          MOVE      CCOL,CCOL3
          ADD       THREE,CCOL3
          MOVE      CCC,CCENT
          MOVE      SP2,CYEAR
          MOVE      SP2,CMON
          MOVE      SP2,CDAY
.
          MOVE      "40",ECOL
          MOVE      CVERT,EVERT
          DISPLAY   *P17:16,*EL
.
FIXMON    CALL      KEYPER
          BRANCH    OVRCD,START
          COMPARE   ZERO,CQUEST
          GOTO      FIXMONB IF EQUAL
          CALL      ERR4
          GOTO      START1
.
FIXMONB   PACK      KEY6,ICENT,IYEAR,IMON
          REP       " 0",KEY6
          CALL      RDDRGA1
          COMPARE   ZERO,OVRCD
          GOTO      FIXMONC IF EQUAL
          CALL      ERR4
          GOTO      START1
.
FIXMONC   MOVE      DRGFDTE,FROMDATE 
          MOVE      DRGTDTE,TODATE
          MOVE      DRGNUM,STMM
          PACK      SGYR,DRGYR 
          REP       " 0",SGYR
          MOVE      IYEAR,CYEAR
          REP       " 0",CYEAR    
          MOVE      CYEAR,FYEAR
          MOVE      ICENT,CCENT
.          COMPARE   TEN,FYEAR
.          CALL      ERR3 IF LESS
          GOTO      START1 IF LESS
.
          UNPACK    DRGFDTE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPCDATE,DIM10
          UNPACK    DRGTDTE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          DISPLAY   *P27:16,*V2LON,DRGMDSC,SP2,"(",DIM10," to ",CPCDATE,")"
.
          MOVE      SGYR,STCCYY
          MOVE      CYEAR,STYY
          MOVE      CCENT,STCC
.
          MOVE      STMM,JMON
.
          MOVE      SP2,ENDMM
          MOVE      SP2,ENDYY
          MOVE      SP2,ENDCC	
.
KIBA26    MOVE      ENDMM,CMON
          MOVE      ENDYY,CYEAR
          MOVE      ENDCC,CCENT
.
          MOVE      TEN7,CCOL2
          MOVE      CCOL2,CCOL
          MOVE      TEN8,CVERT
          MOVE      CCOL2,CCOL3
          ADD       THREE,CCOL3
.
          MOVE      "40",ECOL
          MOVE      CVERT,EVERT
          MOVE      CCC,CCENT
          MOVE      SP2,CYEAR
          MOVE      SP2,CMON
          MOVE      SP2,CDAY
.
FIXMON2   CALL      KEYPER
          BRANCH    OVRCD,KIBA25
          COMPARE   ZERO,CQUEST
          GOTO      FIXMOB2 IF EQUAL
          CALL      ERR4
          GOTO      KIBA26
.
FIXMOB2   PACK      KEY6,ICENT,IYEAR,IMON
          REP       " 0",KEY6
          CALL      RDDRGA1
          COMPARE   ZERO,OVRCD
          GOTO      FIXMOB3 IF EQUAL
          CALL      ERR4
          GOTO      KIBA26
.
FIXMOB3   
.         MOVE      IMON,DRGNUM
.         PACK      DRGYR,ICENT,IYEAR
.         REP       " 0",DRGYR
          MOVE      IYEAR,CYEAR
          REP       " 0",CYEAR    
          MOVE      CYEAR,FYEAR
          MOVE      ICENT,CCENT
          
FIXMON3   MOVE      DRGNUM,IMON
.          COMPARE   TEN,FYEAR
.          CALL      ERR3 IF LESS
          GOTO      FIXMON2 IF LESS
.
          UNPACK    DRGFDTE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPCDATE,DIM10
          UNPACK    DRGTDTE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          DISPLAY   *P27:18,*V2LON,DRGMDSC,SP2,"(",DIM10," to ",CPCDATE,")"
.
          MOVE      DRGNUM,CMON
          MOVE      CMON,ENDMM
          MOVE      CYEAR,ENDYY
          MOVE      CCENT,ENDCC
.
          PACK      STDATE WITH STCCYY,STMM
          REP       " 0",STDATE
          PACK      ENDDATE WITH DRGYR,DRGNUM
          REP       " 0",ENDDATE
.
          MATCH     STDATE,ENDDATE
          GOTO      ERR1 IF LESS
.
          UNPACK    STCCYY,STCC,STYY
          UNPACK    DRGYR,ENDCC,ENDYY
          MOVE      STYY,IYEAR                * for periods crossing over years
          MOVE      STMM,IMON
          MOVE      CMON,ABSMON
.
          MATCH     STYY,ENDYY
          GOTO      SUBT1 IF EQUAL
.
          ADD       TEN2,ABSMON
          ADD       ONE,IYEAR
.
SUBT1     SUB       IMON FROM ABSMON
          ADD       ONE,ABSMON
          MOVE      IYEAR,CYEAR
          REP       " 0",CYEAR    
.
          COMPARE   TEN4,ABSMON
          GOTO      ERR2 IF NOT LESS
.
          MATCH     CYEAR,ENDYY
          GOTO      CONFIRM IF EQUAL
.
          GOTO      ERR2
.
ERR1      DISPLAY   *P43:24,*B,*V2LON:
                    "** FROM Date Greater Than TO Date **",*W2,*P1:24,*EL;
          GOTO      START1
.
ERR2      DISPLAY   *P35:24,*B,*V2LON:
                    "** Must be less than 14 periods in range**",*W2,*P1:24,*EL;
          GOTO      START1
.
ERR3      DISPLAY   *P43:24,*B,*V2LON:
                    "** Invalid year entered **",*W2,*P1:24,*EL;
          RETURN
.
ERR4      DISPLAY   *P43:24,*B,*V2LON:
                    "** Period invalid **",*W2,*P1:24,*EL;
          RETURN
.
CONFIRM   KEYIN     *P1:24,*EL,"Ok to Continue (":
                    *V2LON,"Y",*HOFF,"/",*V2LON,"N",*HOFF:
                    ") ? ",*V2LON,ANS;
.
          CMATCH    ANSN,ANS
          GOTO      BEGIN IF EQUAL
.
          CMATCH    ANSY,ANS
          GOTO      OKCONT IF EQUAL
.
          BEEP
          GOTO      CONFIRM
.
OKCONT    DISPLAY   *P1:24,*EL,*P20:24,*V2LON:
                    "*** Generating ***",*W2;
.
          MOVE      ONE,LFLAG
.
          MOVE      ZERO,CPAGENO
          MOVE      "60",CLNO
.
.      LOAD UP HEADING STRUCTURE
.
          MOVE      ONE,XCOUNT
.
LOOPZ     COMPARE   TEN4,XCOUNT
          GOTO      ENDLZ IF EQUAL
.
          STORE     SP6 USING XCOUNT OF M1,M2,M3,M4,M5,M6,M7,M8,M9,M10,M11,M12:
                    M13
          STORE     SP6 USING XCOUNT OF Y1,Y2,Y3,Y4,Y5,Y6,Y7,Y8,Y9,Y10,Y11,Y12:
                    Y13
          ADD       ONE,XCOUNT
          GOTO      LOOPZ
.
ENDLZ     MOVE      STYY,IYEAR
          MOVE      STMM,XMM
          MOVE      ENDMM,IENDMM
          ADD       ONE,IENDMM
          MOVE      IENDMM,ENDMM1
.
          MOVE      ONE,XCOUNT
.
LOOPP     COMPARE   TEN4,XCOUNT
          GOTO      LSTRT IF EQUAL
.
          MOVE      IYEAR,YMM
          REP       " 0",YMM
          STORE     XMM USING XCOUNT OF M1,M2,M3,M4,M5,M6,M7,M8,M9,M10,M11,M12:
                    M13
          STORE     YMM USING XCOUNT OF Y1,Y2,Y3,Y4,Y5,Y6,Y7,Y8,Y9,Y10,Y11,Y12:
                    Y13
.
          ADD       ONE,XCOUNT
.
          CALL      PMTH
          GOTO      LOOPP
.
LSTRT     MOVE      ONE,COPTION
.
NEXTOPT   BRANCH    OPTION OF OPTNB,OPTNM,OPTNT
.
.       THEATRE REPORT
.
OPTNT     MOVE      OPTDES10,OPTDES
          MOVE      OPTD5,OPT2
          MOVE      TWO,LIMIT
          GOTO      OPTNE
.
.     BOOKING REPORT
OPTNB     MOVE      OPTDES11,OPTDES
          MOVE      OPTD5,OPT2
          MOVE      TWO,LIMIT
          GOTO      OPTNE
.
.     MATERNITY REPORT
.
OPTNM     MOVE      OPTDES12,OPTDES
          MOVE      OPTD5,OPT2
          MOVE      TWO,LIMIT
.
OPTNE     DISPLAY   *P1:24,*EL,"Printing Statistics for :",OPTDES:
                    *P60:24,"Type :";
.
          MOVE      SP3,SVTYPE
          MOVE      SP3,SCTYPE
          MOVE      ZERO,SAMEFLG
          MOVE      ZERO,SFLAG
          MOVE      ZERO,SECFLAG
          MOVE      ZERO,TTOTAL
          MOVE      ZERO,COUNT
          CALL      PRTRET
          MOVE      ZERO,FIRSTFLG
          MOVE      SP10,PBCTYPE
.
          MOVE      SP12,KEY12
          CALL      RDSCANA1
.
LOOP      CALL      RDKCANA1
          BRANCH    OVRCD OF NEWOPT
.
          MOVE      "Unknown ",TDESC
          PACK      KEY5 WITH CODEBK,BCTYPE
          CALL      RDCODE1
.
LOOP1     MATCH     CODEXXX,THCSCOD      *** PRINT EXTRA MAT OR THE
          GOTO      LOOP IF NOT EQUAL
.
          MATCH     STDATE,BCDATE
          GOTO      LOOP IF LESS
.
          MATCH     BCDATE,ENDDATE
          GOTO      LOOP IF LESS
.
          COMPARE   ZERO,SFLAG
          GOTO      LOOP1A IF NOT EQUAL
          CALL      PRNTRES
          GOTO      GLOOP
.
LOOP1A    COMPARE   ZERO,FIRSTFLG
          CALL      PRNTRES IF EQUAL
.
GLOOP     MATCH     SVTYPE,BCTYPE
          CALL      PRNTRES3 IF NOT EQUAL     * next booking type
.
LOOP2     MOVE      "Unknown               ",TDESC
          PACK      KEY5 WITH CODEBC,BCCANC
          CALL      RDCODE1
.
          ADD       ONE,COUNT            * found a valid record
          MATCH     BCCANC,SCTYPE 
          CALL      PRNTRES2 IF NOT EQUAL
.
DISPLOOP  DISPLAY   *P67:24,BCTYPE,SP3,BCDATE;
.
          UNPACK    BCDATE INTO XCENT,XYEAR,XMON
          MOVE      XMON,IMON
.
          MATCH     STYY,XYEAR
          GOTO      NEXTB IF EQUAL
          ADD       TEN3,IMON
.
NEXTB     ADD       ONE,IMON
          SUB       JMON FROM IMON
.
          MATCH     SV2TYPE,BCTYPE
          GOTO      NEXTB1 IF NOT EQUAL
          MATCH     BCDATE,SBCDATE
          GOTO      NEXTB1 IF NOT EQUAL
          ADD       BCCANCL,FORM6
          MOVE      ONE,SAMEFLG
          GOTO      LOADE
.
NEXTB1    MOVE      ZERO,FORM6
NEXTB2    BRANCH    OPTION OF LOADB,LOADM,LOADT
.
.       THEATRE
.
LOADT
.
.  BOOKING
.
LOADB     ADD       BCCANCL,FORM6
          GOTO      LOADE
.
.      MATERNITY
.
LOADM     COMPARE   THREE,COPTION
          GOTO      LOADM3 IF EQUAL
          ADD       BCCANCL,FORM6
          GOTO      LOADE
.
LOADM3    ADD       BCCANCL,FORM6
          GOTO      LOADE
.
LOADE     STORE     FORM6 USING IMON OF F1A,F2A,F3A,F4A,F5A,F6A,F7A,F8A:
                                        F9A,F10A,F11A,F12A,F13A
.
          COMPARE   ONE,SAMEFLG
          GOTO      LOADE1 IF NOT EQUAL
          ADD       BCCANCL,FTOTAL
          GOTO      LOADE2
LOADE1    ADD       FORM6 TO FTOTAL
LOADE2    MOVE      BCDATE,SBCDATE
          MOVE      BCTYPE,SV2TYPE
          MOVE      ZERO,SAMEFLG
          MATCH     BCCANC,SCTYPE
          CALL      PRNTRES2 IF NOT EQUAL
          GOTO      LOOP
.
NEWOPT    COMPARE   ZERO,COUNT
          GOTO      NEWOPT1 IF NOT EQUAL
.
          COMPARE   ZERO,TTOTAL
          GOTO      NEWOPTC IF EQUAL
.
          COMPARE   ZERO,COUNT
          GOTO      NEWOPTC IF EQUAL
.
NEWOPT1   CALL      PRNTRES2
.
          PRINT     *1,UNDLN20,UNDLN4;
.
          MOVE      ZERO,XCOUNT
NEXTTT0   ADD       ONE,XCOUNT
          PRINT     SP1,UNDLN6;
.
          COMPARE   ABSMON,XCOUNT
          GOTO      NEXTTT0 IF NOT EQUAL
.
          PRINT     SP1,UNDLN7
          ADD       ONE,CLNO
.
          MOVE      ZERO,XCOUNT
          PRINT     *1,"Total ",OPT2,SP2;
.
NEXTTT1   ADD       ONE,XCOUNT
          LOAD      T0 USING XCOUNT OF T1,T2,T3,T4,T5,T6,T7,T8,T9,T10,T11,T12:
                    T13
          PRINT     T0,SP1;
.
          COMPARE   ABSMON,XCOUNT
          GOTO      NEXTTT1 IF NOT EQUAL
.
          PRINT     TTOTAL
          ADD       ONE,CLNO
.
          PRINT     *1,UNDLN20,UNDLN4;
.
          MOVE      ZERO,XCOUNT
NEXTTT2   ADD       ONE,XCOUNT
          PRINT     SP1,UNDLN6;
.
          COMPARE   ABSMON,XCOUNT
          GOTO      NEXTTT2 IF NOT EQUAL
.
          PRINT     SP1,UNDLN7
          ADD       ONE,CLNO
.
          MOVE      ZERO,T1
          MOVE      ZERO,T2
          MOVE      ZERO,T3
          MOVE      ZERO,T4
          MOVE      ZERO,T5
          MOVE      ZERO,T6
          MOVE      ZERO,T7
          MOVE      ZERO,T8
          MOVE      ZERO,T9
          MOVE      ZERO,T10
          MOVE      ZERO,T11
          MOVE      ZERO,T12
          MOVE      ZERO,T13
          MOVE      ZERO,TTOTAL
.
          MOVE      ONE,LFLAG
.
          PRINT     *N
          ADD       TWO,CLNO
.
NEWOPTC   ADD       ONE,COPTION
.
          BRANCH    OPTION OF NOSKIP,SKIP,NOSKIP
.
.       FOR MATERNITY ONLY WHEN START PRE-ADMISS ... PUT ON NEW PAGE
.
SKIP      COMPARE   TWO,COPTION
          GOTO      NOSKIP IF NOT EQUAL
.
          MOVE      "60",CLNO
.
NOSKIP    COMPARE   COPTION,LIMIT
          GOTO      NEXTOPT IF NOT EQUAL
.
          COMPARE   ZERO,CPAGENO
          GOTO      NOREC IF EQUAL
.
          PRINT     *N,*N,"***  END OF REPORT  ***"
          DISPLAY   *P1:24,*EL,*P15:24,*V2LON:
                    "*** Generation Completed ***",*W2;
          GOTO      BEGIN
.
NOREC     DISPLAY   *P1:24,*EL,*P20:24,*V2LON,*B:
                    "*** No Bookings selected ***",*W2;
          GOTO      BEGIN
.
HEAD      ADD       ONE,CPAGENO
          CLOCK     TIME,CTIMEIS
.
          PRINT     *F,PRGID,*50,CNAME,*110,"DATE - ",CDATE:
                    *N,VERSION,*50,PRGNAM:
                    *110,"TIME - ",CTIMEIS,*N:
                    *110,"PAGE - ",SP5,CPAGENO,*N
.
          UNPACK    FROMDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPCDATE,DFRDATE
          UNPACK    TODATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      STMM TO IMON
          PRINT     *50,"From Period : ",STMM,SLASH,SGYR,SP10,DFRDATE," - ":
                    CPCDATE
.
          UNPACK    DRGFDTE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPCDATE,DFRDATE
          UNPACK    DRGTDTE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      ENDMM TO IMON
          PRINT     *50,"To   Period : ",DRGNUM,SLASH,DRGYR,SP10,DFRDATE," - ":
                    CPCDATE,*N,*N
.
          MOVE      SEVEN,CLNO
          RETURN
.
PRNTRES3  CALL      PRNTRES2
          PRINT     *N;
          MOVE      ONE,SECFLAG
          CALL      PRNTRES
          RETURN
.
PRNTRES   MOVE      ZERO,FORM6
          MOVE      ZERO,FIRSTFLG
          MOVE      "Unknown               ",TDESC
          PACK      KEY5 WITH CODEBK,BCTYPE
          CALL      RDCODE1
          MOVE      BCTYPE,SVTYPE
          MOVE      SVTYPE,SVVAR
          GOTO      CHKTOTAL
.
PRNTRES2  MOVE      "Unknown               ",TDESC
          MOVE      ZERO,FORM6
          MOVE      ONE,FIRSTFLG
          PACK      KEY5 WITH CODEBC,SCTYPE
          CALL      RDCODE1
          MOVE      SCTYPE,SVVAR
.
CHKTOTAL  COMPARE   ZERO,SFLAG
          GOTO      CHKTOTAL1 IF EQUAL
.
          COMPARE   ZERO,FTOTAL
          GOTO      PRTRET IF EQUAL
.
CHKTOTAL1 MOVE      ONE,SFLAG
          COMPARE   "55",CLNO
          CALL      LHEAD IF NOT LESS
.
NEWOPTL   COMPARE   LFLAG,ONE
          GOTO      PRNC IF NOT EQUAL
          COMPARE   ZERO,CPAGENO              *** NEW SUB HEADING
          CALL      LHEAD IF NOT EQUAL
.
PRNC      MOVE      ZERO,XCOUNT
          COMPARE   ONE,FIRSTFLG
          GOTO      PRNC1 IF EQUAL 
          PRINT     *1,SVVAR,SP1,TDESC
          MOVE      ONE,FIRSTFLG
          RETURN 
PRNC1     PRINT     *1,SVVAR,SP1,TDESC,SP1;
.
NEXTFT0   ADD       ONE,XCOUNT
          LOAD      F0A USING XCOUNT OF F1A,F2A,F3A,F4A,F5A,F6A,F7A,F8A:
                                        F9A,F10A,F11A,F12A,F13A
          PRINT     F0A,SP1;
.
          COMPARE   ABSMON,XCOUNT
          GOTO      NEXTFT0 IF NOT EQUAL
.
          PRINT     FTOTAL
          ADD       ONE,CLNO
.
          ADD       F1A,T1
          ADD       F2A,T2
          ADD       F3A,T3
          ADD       F4A,T4
          ADD       F5A,T5
          ADD       F6A,T6
          ADD       F7A,T7
          ADD       F8A,T8
          ADD       F9A,T9
          ADD       F10A,T10
          ADD       F11A,T11
          ADD       F12A,T12
          ADD       F13A,T13
          ADD       FTOTAL,TTOTAL
.
PRTRET    MOVE      BCCANC,SCTYPE
          MOVE      ZERO,F1A
          MOVE      ZERO,F2A
          MOVE      ZERO,F3A
          MOVE      ZERO,F4A
          MOVE      ZERO,F5A
          MOVE      ZERO,F6A
          MOVE      ZERO,F7A
          MOVE      ZERO,F8A
          MOVE      ZERO,F9A
          MOVE      ZERO,F10A
          MOVE      ZERO,F11A
          MOVE      ZERO,F12A
          MOVE      ZERO,FTOTAL
PRTRETA   COMPARE   ONE,SECFLAG
          GOTO      PRTRET1 IF NOT EQUAL
          MOVE      ZERO,SECFLAG
          GOTO      CHKTOTAL1
PRTRET1   RETURN
.
PMTH      MOVE      XMM,IMON
          ADD       ONE,IMON
          MOVE      IMON,XMM
.
          COMPARE   TEN4,IMON
          GOTO      PNXT1 IF NOT EQUAL
.
          ADD       ONE,IYEAR
          MOVE      ONE,IMON
          MOVE      IMON,XMM
.
PNXT1     RETURN
.
LHEAD     COMPARE   "55",CLNO
          CALL      HEAD IF NOT LESS
.
          COMPARE   ONE,LFLAG
          RETURN    IF NOT EQUAL
.
          MOVE      ZERO,XCOUNT
          PRINT     *1,OPTDES,SP2;
NEXTYT0   ADD       ONE,XCOUNT
          LOAD      Y0 USING XCOUNT OF Y1,Y2,Y3,Y4,Y5,Y6,Y7,Y8,Y9,Y10,Y11,Y12:
                    Y13
          LOAD      M0 USING XCOUNT OF M1,M2,M3,M4,M5,M6:
                    M7,M8,M9,M10,M11,M12,M13
          REP       " 0",M0
          REP       " 0",Y0
          PRINT     M0,SLASH,Y0,SP2;
.
          COMPARE   ABSMON,XCOUNT
          GOTO      NEXTYT0 IF NOT EQUAL
.
          PRINT     SP1,"Total"
          ADD       ONE,CLNO
.
          PRINT     *1,UNDLN20,UNDLN4;
.
          MOVE      ZERO,XCOUNT
NEXTHT0   ADD       ONE,XCOUNT
          PRINT     SP1,UNDLN6;
.
          COMPARE   ABSMON,XCOUNT
          GOTO      NEXTHT0 IF NOT EQUAL
.
          PRINT     SP1,UNDLN7
          ADD       ONE,CLNO
.
          MOVE      ZERO,LFLAG
          RETURN
.
          INCLUDE   STD001IO
.
          INC       BOKCANIO/INC
          INC       PATCODIO/INC
          INCLUDE   PATDRGIO/INC
          INCLUDE   PATCOMN3
.
ENDIT     CHAIN     PGM
          STOP
.

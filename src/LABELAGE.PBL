.*****************************************************************************
.* Include Name : LABELAGE.PBL
.*
.* Function     : Calculate and Format Patient's Age for Printing on ID Labels
.*
.* Author       : Paul Howells
.*
.* Returns      : XAGE  DIM 2      99D   (Age in Days)
.*                             OR  99W   (Age in Weeks)
.*                             OR  99M   (Age in Months)
.*                             OR  999   (Age in Years)
.*****************************************************************************
LABELAGE
.
.  ----- If PTCNDATE = 1 we need to convert patient age to one of
.  ----- day, week, month, or year.  Calcage will calcuate the age
.  ----- in the variable (PSAGECON) and what the age is recorded as in 
.  ----- (PSAGETYP)
.
          CALL      IBACLOCK
.
. --------- check if patient is dead ----------------------------
.
          IF        PCEASE=1
            MOVE      PDECDTE,AGEDATE            * Date of Death
          ELSE
            PACK      AGEDATE,CCC,CYY,CMM,CDD    * today's date
          ENDIF
          REP       " 0",AGEDATE
.
          CALL      CALCAGE
          MOVE      PSAGEYRS,PSAGE
          MOVE      PSAGE,XAGE
.
          COMPARE   ONE,PTCNDATE
          RETURN    IF NOT EQUAL
.
          REP       UPPLOW,PSAGETYP
          MATCH     "Y",PSAGETYP
          RETURN    IF EQUAL
.   
          UNPACK    PSAGECON,ANS,XWKAGE
          PACK      XAGE,XWKAGE,PSAGETYP
.
          RETURN

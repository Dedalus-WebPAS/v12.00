.******************************************************************************
.* System    :  PRIVATE PRACTICE                                              *
.* Program   :  IBAPRI21                                                      *
.* Desc      :  Re-Print Invoices                                             *
.******************************************************************************
.* Date      :  01/11/1991                                                    *
.* Author    :  DIG                                                           *
.* Comment   :  This program is a modified version of IBAPPP21.               *
.* Mods      :                                                                *
.*                                                                            *
.******************************************************************************
.* V12.00.02 27/08/2025  Alina Bhari      TSK 0954453                         *
.*           Recompiled for PRIINVHL - Added Patient Name                     *
.* V12.00.01 24/07/2025  J.Tan          TSK 0962500                           *
.*           Mod NBNK0000 to check for U/R number                             *
.* V11.05.01 04/02/2025  Peter Vela       TSK 0939466                         *
.*           Recompiled for PRIINVPR - Added Distance In kms                  *
.*           Eclipse WebServices DVAW                                         *
.* V11.04.01 09/07/2024  J.Tan            TSK 0934944                         *
.*           Mod to check Referral Provider no from a linked Practice         *
.* V11.03.02 08/11/2023  Nikitha B      TSK 0927699c                          *
.*           Read CAPPRVNO and PTCNHABN for Hospital Approval and ABN number. *
.* V11.03.01 04/10/2023  Nikitha B     TSK 0927699                            *
.*           Recomplied for PRIINVHL, PRIINVTL - Stationary variables         *
.* V11.01.03 24/08/2021   Davin           TSK 0897318                         *
.*           Recompiled for PRIINVTL - added field 51 (Adjustment Total)      *
.* V11.01.02 20/07/2021   J.Tan           TSK 0908902                         *
.*           Recompiled for PRIINVPR - printing Insurance for multi pages inv.*
.* V11.01.01 28/04/2021  Tracey Nguyen    TSK 0308555                         *
.*           Added PATIN1FD/IO for PRIINVPR - Added routine PRTAC000 to print *
.*           WorkCover and TAC details on the body of the invoice             *
.******************************************************************************
.* V11.00.06 11/11/2020  Peter Vela       TSK 0898361                         *
.*           Recompiled for PRIINVPR                                          *
.* V11.00.05 20/10/2020  Peter Vela       TSK 0898361                         *
.*           Recompiled for PRIINVPR                                          *
.* V11.00.04 24/04/2020  Peter Vela       TSK 0874025                         *
.*           Recompiled for PRIINVPR                                          *
.* V11.00.03 22/04/2020  Peter Vela       TSK 0874025                         *
.*           Recompiled for PRIECTFD                                          *
.* V11.00.02 17/04/2020 Peter Vela      TSK 0874025                           *
.*           Recompiled for PRIECTFD                                          *
.* V11.00.01 15/04/2020 Thanh T         TSK 0879163                           *
.*           Added SEXDSP00                                                   *
.******************************************************************************
.* V10.14.04 20/08/2019  Thanh T.      TSK 0879967                            *
.*           Recompiled for PRIINVPR changes                                  *
.* V10.14.03 23/04/2019  Peter Vela    TSK 0871522                            *
.*           Recompiled for PRIINVPR                                          *
.* V10.14.02 20/03/2019  J.Tan            TSK 0857392                         *
.*           Changed RCP Transaction count from DIM3 to DIM5                  *
.* V10.14.01 21/11/2018  Peter Vela    TSK 0866770                            *
.*           Recompiled for PRIINVPR                                          *
.******************************************************************************
.* V10.13.03 21/11/2018  Peter Vela    TSK 0866770                            *
.*           Recompiled for PRIINVPR                                          *
.* V10.13.02 02/11/2018  Peter Vela    TSK 0863035                            *
.*           Recompiled for PRIINVPR                                          *
.* V10.13.01 03/08/2018  Richa Phogat  TSK 0848506                            *
.*           Updated keylength for RDPRDO1 from KEY18 to KEY22                *
.*           Changed DIM23 to DIM27, KEY6 to KEY10 to pack with VSVDOCT       *
.*           07/08/2018  Tracey Nguyen TSK 0848506                            *
.*           Matched PRDTREFD with SP10 instead of SP6                        *
.* V10.12.02 15/05/2018  J.Tan         TSK 0856329                            *
.*           Recompiled for PRIINVPR - Lingard invoice with multple pages     *
.* V10.12.01 26/04/2018  Peter Vela    TSK 0852811                            *
.*           Recompiled for PRIINVTL                                          *
.* V10.11.03 06/09/2017  J.Tan         TSK 0821057                            *
.*           Recompiled for PRIINVHL - mod to variable 76 health fund         *
.* V10.11.02 28/07/2017  Peter Vela    TSK 0837619                            *
.*           Recompiled for PRIINVPR                                          *
.* V10.11.01 28/07/2017  Peter Vela    TSK 0837619                            *
.*           Recompiled for PRIINVPR                                          *
.* V10.10.01 10/05/2017  Tracey Nguyen TSK 0837929                            *
.*           Recompiled for PRIINVHL and PRIINVTL - Fixed I*C error message   *
.*           on PATMESG1                                                      *
.* V10.08.04 22/06/2016  Peter Vela    TSK 0294177                            *
.*           Recompiled for PRIINVPR                                          *
.* V10.08.03 07/09/2016  J.Tan         TSK 0822590                            *
.*           Recompiled for PRIVRDEB                                          *
.* V10.08.02 09/06/2016  Peter Vela    TSK 0820206                            *
.*           Recompiled for PRIINVHL                                          *
.* V10.08.01 07/04/2016  Peter Vela    CAR 0294177                            *
.*           Recompiled for PRIINVPR                                          *
.* V10.06.03 15/07/2015  J.Tan         CAR 319450                             *
.*           Recompiled for PRIINVPR - I*C on Invoice Header/Tail error msg   *
.* V10.06.02 15/05/2015  Davin         CAR 310155                             *
.*           Recompiled for PATGBCRN - added MOD10V05 for BPAY                *
.* V10.06.01 20/04/2015  J.Tan          CAR 315638                            *
.*           Fixed printing single invoice                                    *
.* V10.05.01 08/10/2014  J.Tan          CAR 302769                            *
.*           Added range of Claim code                                        *
.* V10.04.10 16/06/2014  Peter Vela    CAR 302147                             *
.*           Recompiled for PRIINVPR                                          *
.* V10.04.09 13/06/2014  Jill Parkinson CAR 301639                            *
.*           Moved calls to TFILENAM to INIT0000 for FNAME2 and FNAME3        *
.* V10.04.08 17/04/2014  Peter Vela    CAR 285260                             *
.*           Recompiled for PRIINVPR - Moved Cabrini invoice tail one line    *
.*           down in PRINV230                                                 *
.* V10.04.07 15/04/2014  J.Tan         CAR 261630                             *
.*           Recompiled for PRIINVPR - Removed port number from temp file name*
.* V10.04.06 15/04/2014 Peter Vela     CAR 285260                             *
.*           Recompiled for PRIINVPR                                          *
.* V10.04.05 14/04/2014 Peter Vela     CAR 285260                             *
.*           Recompiled for PRIINVPR                                          *
.* V10.04.04 11/04/2014 Peter Vela     CAR 285260                             *
.*           Recompiled for PRIINVPR                                          *
.* V10.04.03 31/03/2014 Peter Vela     CAR 285260                             *
.*           Recompiled for PRIINVPR - Check for PRCNPJCI                     *
.* V10.04.02 05/04/2014  J.Tan         CAR 298195                             *
.*           Replaced PRIINVVR with PRIWEBVR                                  *
.* V10.04.01 16/12/2013 J.Tan          CAR 294414                             *
.*           Recompiled for PRIINVPR - checking type of register              *
.* V10.03.05 09/12/2013  J.Tan         CAR 280726                             *
.*           Recompiled for PRIINVPR - flag for Inpatients from Other hospital*
.* V10.03.04 05/07/2013  J.Tan         CAR 288042                             *
.*           Recompiled for PRIINVPR - Fixed WEBFLAG                          *
.* V10.03.03 20/06/2013  Davin         CAR 287161                             *
.*           Recompiled for PATGBCRN - right justify ptcnhbpi                 *
.* V10.03.02 18/07/2012  Don Nguyen        CAR 264561                         *
.*           Recompiled for PATGBCRN                                          *
.* V10.03.01 17/11/2011 J.Tan              CAR 240262                         *
.*           Fixed to print unreleased cash                                   *
.* V10.02.01 04/04/2011 Jill Parkinson     CAR 239574                         *
.*           Removed open of ibaprntf                                         *
.* V10.01.01 03/02/2011 Jill Parkinson CAR 233088                             *
.*           Added pmsvx1af                                                   *
.* V10.00.06 15/09/2010 J.Tan              CAR 230162                         *
.*           Recompiled for PRIINVPR                                          *
.* V10.00.05 14/09/2010  Davin             CAR 229590                         *
.*           Recompiled for PRIINVTL                                          *
.* V10.00.04 26/08/2010  Davin            CAR 226963                          *
.*           Added referral date from prihreff (variable 46)                  *
.* V10.00.03 24/08/2010  Peter Vela CAR 221500                                *
.*           Recompiled for PRIINVTL                                          *
.* V10.00.02 22/06/2010 J.Tan         CAR 213683                              *
.*           Recompiled for PRIINVPR - printing SJOG multiple pages of invoice*
.* V10.00.01 23/04/2010 J.Tan         CAR 210750                              *
.*           Recompiled for PRIINVPR - printing SJOG item description         *
.* V9.12.04  09/12/2009  Mike Laming    CAR 210835                            *
.*           Recompiled for PRIINVPR                                          *
.* V9.12.03  01/10/2009  Peter Vela     CAR 203243                            *
.*           Recompiled for PRIINVHL                                          *
.* V9.12.02  03/09/2009  Peter Vela     CAR 194715                            *
.*           Recompiled for PRIINVHL PRIINVTL                                 *
.* V9.12.01  07/08/2009  Mike Laming    CAR 123419                            *
.*           Recompiled for PRIINVPR - re-write PATHL000, Add PRIHTRaf 4th Indx
.* V9.11.04  23/09/2009  Davin            CAR 178015                          *
.*           Recompiled for PRIINVTL - Added field 33 for BPAY CRN (Generated)*
.*           Added VARGBCRN and PATGBCRN - BPAY Reference Number              *
.* V9.11.03  08/01/2009  Steve Armstrong   CAR 185927                         *
.*           Recompiled for changes to PRIINVPR & PRIINVVR.                   *
.*           08/01/2009 J.Tan      CAR 178415                                 *
.*           Added Medical Practice to prifinsf                               *
.* V9.11.02  01/12/2008  Steve Armstrong   CAR 184702                         *
.*           Recompiled for changes to PRIINVHL & PRIINVTL.                   *
.*           Mods to load TMPPIND in PRNT0000 before printing the invoice     *
.*           header instead of after.  This will also fix another bug where   *
.*           the patient indicator (variable 45) was not being populated and  *
.*           was printing the claim code description.                         *
.* V9.11.01  20/10/2008  J.Tan         CAR 178415                             *
.*           Mods checking for Medical practice user access                   *
.******************************************************************************
.* V9.10.02  29/08/2008 J.Tan          CAR 176993                             *
.*           Recompiled for PRIINVPR - Cabrini invoice layout                 *
.* V9.10.01  02/05/2008 J.Tan          CAR 166477                             *
.*           Mods to initialise referral details                              *
.******************************************************************************
.* V9.09.01  14/05/2007  Peter Vela    CAR 136586                             *
.*           Added Option 7 - Re-print invoices selected by Med.Practice      *
.******************************************************************************
.* V9.08.02  14/05/2007  Peter Vela    CAR 136586                             *
.*           Recompiled for PRIINVPR - Added SJOG Referral Doctor details     *
.* V9.08.01  28/09/2006  Peter Vela    CAR 118366                             *.
.*           Recompiled for PRIINVHL - Added medicare suffix                  *
.******************************************************************************
.* V9.06.01  28/04/2006  Peter Vela    CAR 102393                             *
.*           Recompiled for PRIINVHL - Added PRFA variables PRIINVFD          *
.******************************************************************************
.* V9.05.02  27/03/2006  Peter Vela    CAR 95780                              *
.*           Recompiled for PRIINVHL - Added emg mobile contact numbers       *
.* V9.05.01  27/03/2006 Peter Vela CAR 61299                                  *
.*           Recompiled for PRIINVHL                                          *
.******************************************************************************
.* V9.04.05  03/08/05 J.Tan    CAR 62750                                      *
.*           Removed redefined amount variables                               *
.* V9.04.04  16/06/2005  J.Tan    CAR 56701                                   *
.*           Recompiled for PRIINVPR - HIC item invoice file                  *
.* V9.04.03  15/12/2004  J.Tan    CAR 55893                                   *
.*           Recompiled for PRIINVPR - Fixed West wimmera invoice layout      *
.* V9.04.02  03/11/2004  J.Tan    CAR 53063                                   *
.*           Recompiled for PRIINVPR - Fixed PRFA                             *
.* V9.04.01  30/08/2004  Sandra Barcham 52835                                 *
.*           Added RCPREGFD & RCPREGIO                                        *
.******************************************************************************
.* V9.03.07  29/06/2004  Lina Vo  CAR 50811                                   *
.*           Removed use of RCPTRNFD & IO.                                    *
.* V9.03.06  24/06/2004  J.Tan    CAR 50235                                   *
.*           Recompiled for PRIINVPR - non bank deposit                       *
.* V9.03.05  01/04/2004 J.Tan   CAR 44116                                     *
.*           Recompiled for PRIINVPR - mods for credit note                    *
.* V9.03.04  03/03/2004  Lina Vo     CAR 47113                                *
.*           Recompiled for PRIKYDEB & PRIINVPR.                              *
.* V9.03.03  03/03/2004  Lina Vo     CAR 47921                                *
.*           Removed use of PRIDBTFD & IO.                                    *
.* V9.03.02  29/01/2004  J.Tan                                                *
.*           Recompiled for PRIINVPR - removing pridep                        *
.* V9.03.01  29/10/2003 Sandra Barcham   43783                                *
.*           Recompiled for NZHISIIO and NZHISIUP                             *
.******************************************************************************
.*        V9.02.16  18/02/2003  Lina Vo      CAR 22709                        *
.*                  Remove open of outpreaf - not used                        *
.*                  13/02/2003  Dean Cramer  CAR 22238                        *
.*                  Recompiled for RCPTRNFD                                   *
.*        V9.02.15  20/11/2002  Dean Cramer                                   *
.*                  Recompiled for PRIINVPR - RCH PRAs for invoices           *
.*        V9.02.14  06/11/2002  J.Tan                                         *
.*                  Recompiled for PRIKYDEB - merge U/R                       *
.*        V9.02.13  25/10/2002  J.Tan                                         *
.*                  Recompiled for PRIINVPR - fixed displaying o/s amount     *
.*        V9.02.12  21/10/2002  J.Tan                                         *
.*                  Recompiled for PRIINVTL - outstanding amount              *
.*        V9.02.11  28/08/2002  J.Tan                                         *
.*                  Recompile for PRIINVPR - outstanding amount with GST      *
.*        V9.02.10  26/07/2002  Dean Cramer                                   *
.*                  Recompiled for PRIINVPR - open PMSPX2A1 and shift cash &  *
.*                  journal amounts ti right for RCH format.                  *
.*        V9.02.09  04/07/2002  Dean Cramer                                   *
.*                  Recompiled for PRIINVPR - Responsible Person mods         *
.*        V9.02.08  19/06/2002  J.Tan                                         *
.*                  Recompiled for PRIINVVR & PRIINVIT                        *
.*        V9.02.07  27/05/2002  J.Tan                                         *
.*                  Recompiled for PRIINVHL - Added patient indicator         *
.*        V9.02.06  08/03/2002  J.Tan                                         *
.*                  Recompiled for PRIINVHL - Added claim code                *
.*        V9.02.05  21/03/2002  J.Tan                                         *
.*                  Recompiled for PRIINVHL - Missing first item description  *
.*        V9.02.04  07/02/2002  J.Tan                                         *
.*                  Recompiled for PRIINVPR - Doctor Income percentage        *
.*        V9.02.03  10/01/2002  J.Tan                                         *
.*                  Recompiled for PRIINVIT - Changed key for tempfile        *
.*        V9.02.02  31/10/2001  Dean Cramer                                   *
.*                  Alter for web and end spool.                              *
.*        V9.02.01  02/10/2001  J.Tan                                         *
.*                  Mods to use PMSHCPFD instead of PATDO1FD                  *
.*        V9.00.B01 13/06/2001  Steve Armstrong       Call 10742              *
.*                  Recompiled for changes to PRIKYDEB                        *
.******************************************************************************
.*        V5.10.B01 26/03/2001  Glenn Saunders                                *
.*                  Remove access to PTCNSNDX and associated processing.      *
.*                  Remove all references to PATSUR file (old surname file).  *
.*        V5.08.10  15/09/2000  Davin  SRF 4964                               *
.*                  Recompiled for PRIINVHL - invoice indicator               *
.*        V5.08.09  31/08/2000  Jill Habasque                                 *
.*                  Added Referral period                                     *
.*        V5.08.08  16/08/2000  Caleb Sharman                                 *
.*                  Changed Health Fund variables to be 8 chars               *
.*        V5.08.07  15/08/2000  Davin  SRF 4106                               *
.*                  Recompiled for PRIINVPR - templated tail for multipage    *
.*        V5.08.06  02/08/2000  J.Tan                                         *
.*                  Recompiled for PRIINVPR - form feed                       *
.*        V5.08.05  03/07/2000  Steve Downing                                 *
.*                  Recompiled for PRIINVPR - interface to APS                *
.*        V5.08.04  21/06/2000  Davin                                         *
.*                  Recompiled for PRIINVPR - added invoice templating        *
.*                  29/06/2000  Steve Armstrong                               *
.*                  Recompiled for changes to PRICALFS (PATFIGFD)             *
.*        V5.08.03  17/05/2000  J.Tan                                         *
.*                  Recompiled for PRIINVPR - invoice on landscape            *
.*        V5.08.02  05/05/2000  J.Tan                                         *
.*                  Recompiled for PRIDOCT file                               *
.*        V5.08.B04 03/04/2000  J.Tan                                         *
.*                  Recompiled for PRIINVPR - GST mods                        *
.*        V5.08.B02 27/03/2000  J.Tan                                         *
.*                  Mods for GST                                              *
.*        V5.08.B01 25/02/2000  Greg Horvat                                   *
.*                  Removed OUTADJFD OUTADJIO PATMMRFD PATMMRIO & PRIPRADJ    *
.*        V6.06.07  24/11/1999  J.Tan                                         *
.*                  Recompiled for PRIINVPR - set PRDTSERV to one for cash    *
.*        V5.07.06  18/10/1999  Steve Armstrong                               *
.*                  Recompiled for tempfile index changes to PRIINVPR/PRIINVVR*
.*        V5.07.05  15/10/1999  D.Di Paola                                    *
.*                  Recompiled for PRISPTFD and PRIITMFD                      *
.*        V5.07.04  12/10/1999  J Habasque                                    *
.*                  Recompiled for PRIHRTFD & PRIBULFD                        *
.*        V5.07.03  02/07/1999  J.Tan                                         *
.*                  Recompiled for PRIINVPR for private practice receipt no.  *
.*        V5.07.02  22/06/1999  Jill Habasque                                 *
.*                  Recompiled for PRISTAIO                                   *
.*        V5.07.01  09/06/1999  Greg Horvat                                   *
.*                  Recompiled for PRIINVIO - Fixed problem with direct read  *
.*                  Jill Habasque - Recompiled for PRIINVS srf 632328         *
.*        V5.05.05  21/01/1998  Nick  SRF 623843                              *
.*                  Recompiled for PRIINVPR  -  AGAIN!!!!!                    *
.*        V5.05.04  11/12/1997  Nick  SRF 623274                              *
.*                  Recompiled for PRIINVPR  -  AGAIN!!!!!                    *
.*        V5.05.03  11/12/1997  Nick  SRF 623274                              *
.*                  Recompiled for PRIINVPR.PBL                               *
.*        V5.05.02  16/10/1997  Nick  Added Wimmera Invoice Layout            *
.*        V5.05.01  09/10/1997  Steve Armstrong    WWH Mods                   *
.*                  Removed ARS related code for G/L Interface                *
.******************************************************************************
.*        V5.04.01  14/06/1997  Steve Armstrong                               *
.*                  Fixed bugs in global recompile                            *
.******************************************************************************
.*        V6.00.01  16/03/1992  DIG                                           *
.*                  Added the new PRIBULFD file for bulk billing              *
.*        V6.00.02  24/07/1992  Whirlpool                                     *
.*                  Modified for changes to the tempfile  PRIINVVR            *
.*        V6.00.03  07/08/1992  Whirlpool                                     *
.*                  Recompiled  for changes to PRIINVVR                       *
.*        V6.00.04  11/08/1992  DIG               SRF 116515                  *
.*                  Recompiled for changes to PRIINVPR                        *
.*        V6.00.05  18/08/1992  DIG                                           *
.*                  Recompiled for changes to PRIINVPR                        *
.*        V6.00.06  14/09/1992  Steve Armstrong                               *
.*                  Fixed initialisation of TMPOPS prior to calling print     *
.*                  routine for referral doctor and details                   *
.*        V6.00.07  15/09/1992  Steve Armstrong                               *
.*                  Removed re-read of invoice file after call to LDDETAIL -  *
.*                  not required in new system                                *
.*        V6.00.08  18/09/92  J.Tan        SRF 116926                         *
.*                  Recompiled for IBAPRINT & PRIINVPR                        *
.*                  07/10/1992  Steve Armstrong                               *
.*                  Modified for alphanumeric debtor number                   *
.*                  09/11/1992  Steve Armstrong                               *
.*                  Recompiled for changes to PRIINVPR                        *
.*        V6.00.09  18/11/92  J.Tan        SRF 118749                         *
.*                  Recompiled for PRIINVPR                                   *
.*        V6.00.10  23/11/92  J.Tan                                           *
.*                  Recompiled for PRIINVPR (to print Debtor & Invoice Number)*
.*        V6.00.11  24/11/92  J.Tan        SRF 118951                         *
.*                  Recompiled for PRIINVPR                                   *
.*        V6.00.12  21/12/1992  Steve Armstrong                               *
.*                  Recompiled for PRIINVPR                                   *
.*        V6.00.13  18/01/1993  i chung           SRF 119877                  *
.*                  Recompiled for PRIINVPR (V6.00.11)                        *
.*        V6.00.14  18/01/93  DIG                                             *
.*                  Re-Compiled for change to PRIINVPR                        *
.*                  27/01/1993  Steve Armstrong  SRF 120122  Quote 7558       *
.*                  Recompiled for changes to PRIINVPR and PRIHTRFD           *
.*        V6.00.15  29/01/1993  Steve Armstrong   SRF 120122                  *
.*                  Recompiled for further changes to PRIINVPR                *
.*                  01/03/93  DIG                SRF 120122  Quote 7558       *
.*                  Re-Compiled for changes to Bulk Billing and addition of   *
.*                  Cash Deposits.                                            *
.*        V6.00.16  20/05/1993  Gabrielle        Quote 7583  SRF 119837       *
.*                  Recompiled for new invoice layout No.5 (Lingard)          *
.*        V6.00.17  31/05/1993  Gabrielle                                     *
.*                  SRF 122363 RHC Invoice layout : Fixed description so to   *
.*                             line-up with heading                           *
.*                  SRF 122817 RHC Invoice layout : checked the printing of   *
.*                             the referred doctors if the service doctor is  *
.*                             the same;;they are being printed on the one    *
.*                             invoice                                        * 
.*        V6.00.18  30/05/1993  Gabrielle        Quote 7583 SRF 119837        *
.*                  Recompiled for PRIINVPR; fixed invoice layout No.5 Lingard*
.*        V6.00.19  12/08/1993  Glenn Berry      SRF 122974                   *
.*                  Mods for changes to PRIHTRFD                              *
.*                  Changed to print referral details when Referring Doctor   *
.*                  or Referring Date change.                                 *
.*        V6.00.20  31/08/1993  Whirlpool        SRF 124801                   *
.*                  Changes to PRIINVPR for warburton                         *
.*        V6.00.21  07/10/93 J.Tan         SRF 125349                         *
.*                  Changed p.r.a. name to be 40 chars.                       *
.*        V6.00.22  22/10/1993  Steve Armstrong   SRF 125806                  *
.*                  Recompiled for PRIINVPR                                   *
.*        V6.00.23  16/11/1993  Greg Horvat       SRF 126300                  *
.*                  Recompiled for PRIINVPR                                   *
.*        V6.00.24  18/11/1993  Greg Horvat       SRF 124924                  *
.*                  Added invoice layouts in PRIINVPR.PBL                     *
.*        V6.00.25  10/01/1994  Greg Horvat       SRF 127157                  *
.*                  Recomplied for changes to PRIINVPR                        *
.*        V6.01.02  19/01/1994  Greg Horvat      SRF 127350                   *
.*                  Recompiled for changes to PRIINVPR & PRIVRDEB.INC         *
.*        V6.01.03  24/01/1994  Greg Horvat      SRF 127442                   *
.*                  Changed the displaying of DPROV - the provider number     *
.*        V6.01.04  21/02/1994  Greg Horvat      SRF 127814                   *
.*                  Fixed reprint of invoice to print invoice date instead of *
.*                  the current date (RCH only)                               *
.*        V6.01.05  01/03/1994  Greg Horvat      SRF 127509  Quote 7928       *
.*                  Changed RCH private practice invoice layout - 4           *
.*        V6.01.06  07/03/1994  Greg Horvat      SRF 119837  Quote 7583       *
.*                  Recompiled for changes to PRIINVPR - Lingard layout       *
.*        V6.01.07  07/03/1994  Greg Horvat      SRF 128274                   *
.*                  Recomplied for changes to PRIINVPR - writing to the bulk  *
.*                  billing file with the same key                            *
.*        V6.01.08  11/03/1994  Greg Horvat  SRF 127509  Quote 7928  (rebound)*
.*                  Recompiled for changes in PRIINVPR - RCH invoice layout   *
.*                  not correct                                               *
.*        V6.01.09  24/03/1994  Greg Horvat                                   *
.*                  Removed error message when there is no referring doctor   *
.*        V6.01.11  21/04/1994  Greg Horvat      SRF 128835                   *
.*                  Recompiled for PRIINVPR - RCH layout change               *
.*        V6.01.12  05/05/1994  Graeme Williams   SRF 129251                  *
.*                  Recompiled for PRIINVPR, version V6.00.31.                *
.*                  Problem with multiple tests that map to the same MBS code *
.*        V6.01.13  06/05/94 J.Tan     SRF 128897                             *
.*                  Recompiled for PRIINVPR - Initialise doctor provider no.  *
.*        V6.01.14  11/05/1994  Graeme Williams   SRF 129360                  *
.*                  Recompiled for PRIINVPR, version V6.00.34.                *
.*                  Change pathology billing to only print the multiple test  *
.*                  item, not the individual tests.                           *
.*        V6.01.15  15/06/1994  Ian Rutt  SRF 129518                          *
.*                  Recompile for PRIINVPR                                    *
.*        V6.01.16  15/07/1994  Ian Rutt  SRF 130823                          *
.*                  Recompile for PRIINVPR                                    *
.*        V6.01.17  25/07/1994  Greg Horvat      SRF 130947                   *
.*                  Recompiled for PRIINVPR - Fixed problem with multiple     *
.*                  blood gases services on the same day by harding codeing   *
.*                  the change in, a proper fix for more items will be        *
.*                  completed at a later date.                                *
.*        V6.01.18  26/07/1994  Greg Horvat      SRF 131045                   *
.*                  Recomplied for PRIINVPR - writing two records to file when*
.*                  inputting MBS items that are not pathology items          *
.*        V6.01.19  27/07/1994  Greg Horvat      SRF 131056                   *
.*                  Recomplied for PRIINVPR - changes to RCH layout           *
.*        V6.02.01  26/09/1994  Graeme Williams   SRF 132432                  *
.*                  Recompiled for PRIINVPR - AMA blood gas changes           *
.*        V6.02.02  08/09/1994  Gabrielle        SRF 132082                   *
.*                  Recompiled for PRIINVPR (V6.02.02) Removed a line from    *
.*                  the invoice layout, printing too many                     *
.*                  Fixed changes to S4BS exemption rules and Blood Gases     *
.*        V6.02.03  03/10/1994  Graeme Williams   SRF 128854                  *
.*                  Recompiled for PRIINVPR - RCH Invoice Layout changes      *
.*        V6.02.04  10/10/1994  Greg Horvat      SRF 127157  (Rebound)        *
.*                  Recompiled for PRIINVPR - Lingard invoice layout changes  *
.*        V6.02.05  11/10/1994  Greg Horvat      SRF 130982                   *
.*                  Recomplied for PRIINVPR - HRH invoice layout change       *
.*        V6.02.06  11/10/1994  Greg Horvat      SRF 132243                   *
.*                  Recomplied for PRIINVPR - changed to write cash deposits  *
.*                  to the prifinsf file when printing an invoice             *
.*        V5.02.01  14/02/1995  Greg Horvat      SRF 134920 134922 134932     *
.*                  Recompiled for IBAPRINT                                   *
.*        V5.02.02  10/03/1995  Graeme Williams                               *
.*                  Port release 6.03 enhancements to 5.02                    *
.*                  19/04/1995  Steve Armstrong                               *
.*                  Recompiled for changes to RCPTRNFD                        *
.*        V5.02.03  02/05/1995  Gabrielle       Mt Wilga                      *
.*                  Changed description of St Edmunds invoice layout to       *
.*                  Alpha, removed printing the heading description from      *
.*                  either controlf of pripracf file using prcnaddr param.    *
.*        V5.02.04  02/05/1995  Gabrielle   SRF 133213                        *
.*                  Removed "Hit <ENTER>..." message when displaying invoice  *
.*                  layouts that go over a screen                             *
.*        V5.03.01  26/06/1995  Paul Howells     SRF 610111                   *
.*                  Recompiled for PRIINVPR.                                  *
.*        V5.03.02  07/08/1995  Steve Armstrong                               *
.*                  Recompiled for PRIKYDEB                                   *
.*        V5.03.03  14/08/1995  Steve Armstrong                               *
.*                  Recompiled for PRIITMFD                                   *
.*        V5.03.04  06/10/1995  Steve Armstrong                               *
.*                  Recompiled for PRIINVPR                                   *
.*        V5.03.05  18/10/1995  Steve Armstrong                               *
.*                  Recompiled for PRIINVPR                                   *
.*        V5.03.06  28/10/1995  Steve Armstrong                               *
.*                  Recompiled for PRIINVPR                                   *
.*        V5.03.07  06/11/1995  Steve Armstrong                               *
.*                  Recompiled for PRIINVPR                                   *
.******************************************************************************
.
          INC       STD001FD
          INC       PRIWEBVR/INC
          INC       PRIVRDEB/INC
          INC       TFILEVAR/INC                 * Generate Temp File Name
          INC       WEBERRFD/INC                 * Web Server Error Logging
.
          INC       BOKRC1FD/INC
          INC       IBAPRNFD/INC
          INC       IBATMDFD/INC
          INC       IBATMHFD/INC
          INC       IBAGEDFD/INC
          INC       OUTPREFD/INC
.
          INC       PATCODFD/INC
          INC       PATCONFD/INC
          INC       PATIN1FD/INC
          INC       PMSHCPFD/INC
          INC       PMSHCLFD/INC
          INC       PMSPX2FD/INC
          INC       PATDRGFD/INC
          INC       PATGSRFD/INC
          INC       PATMA1FD/INC
          INC       PATMESFD/INC
          INC       PATMI1FD/INC
          INC       PMSVX1FD/INC
          INC       PATPERFD/INC
          INC       PATPR1FD/INC
          INC       PATRE1FD/INC
          INC       PATVISFD/INC
.
          INC       HICITIFD/INC                 * HIC items invoice file
          INC       PRIECTFD/INC
          INC       PRICNOFD/INC
          INC       PRIAUIFD/INC
          INC       PRIBULFD/INC
          INC       PRICONFD/INC
...          INC       PRIDBTFD/INC
          INC       PRIDOCFD/INC
          INC       PRIDTRFD/INC
          INC       PRIEXCFD/INC                 * exception charges file
          INC       PRIFIGFD/INC
          INC       PRIFINFD/INC
          INC       PRIGRPFD/INC
          INC       PRIHDBFD/INC
          INC       PRIHISFD/INC
          INC       PRIHOLFD/INC
          INC       PRIHREFD/INC
          INC       PRIHTRFD/INC
          INC       PRIINVFD/INC
          INC       PRIITMFD/INC
          INC       PRIMABFD/INC
          INC       PRIMGPFD/INC
          INC       PRIMULFD/INC
          INC       PRIPRAFD/INC
          INC       PRISPTFD/INC                 * spec. path. test file
          INC       PRISTAFD/INC
          INC       PRITESFD/INC
          INC       PRIVAFFD/INC
          INC       PRIWCOFD/INC
          INC       PRIALSFD/INC                 * Medical Prac.all user access
          INC       PRISECFD/INC                 * Medical Prac.security access
          INC       RCPBNKFD/INC
          INC       RCPBDTFD/INC
          INC       RCPREGFD/INC
          INC       RCPDTEFD/INC                 * receipt details file
          INC       COMDEPFD/INC                 * common deposit file
.
          INC       PATCOMM/INC                  * common file
          INC       PATALRFD/INC                 * Alerts & Medical Warnings
          INC       NZHISIFD/INC                 * NZHIS Variables
          INC       NHIMASFD/INC                 * NZHIS Variables
          INC       PATDHEAD/INC                 * PMI Header Details
          INC       PATCALAG/INC                 * PMI Age Calc
          INC       PMIVARS/INC                  * PMI Variables
          INC       SCRPSTFD/INC
          INC       VARGBCRN/INC 
.
          INC       PATHSPFD/INC           * Hospital Details for GBCRN000
.
          INC       WEBIMCFD/INC
          INC       WEBB2BFD/INC
.
COUNT     FORM      3
.**********************************************************************
.*                       GLOBAL VARIABLES                             *
.**********************************************************************
.
CODE      DIM       2
CALCDATE  DATE      8
CATEGORY  DIM       2
CURRROW   FORM      3
DIM3      DIM       3
DIM5      DIM       5
DIM8      DIM       8
DIM10     DIM       10
DIM25     DIM       25
DIM28     DIM       28
ECCLMARR  DIM       50
EINVOICE  FORM      8
ENDNAME   DIM       6
ENDPRAC   DIM       6
EDCLM     DIM       3
.
FRSTFLAG  FORM      1
FGSTFLAG  FORM      1
FLAGMESS  FORM      1
FORM3     FORM      3
FORM8     FORM      8
FROMDATE  DIM       8
FROMTO    DIM       4
FSTAMNT   FORM      12.2
FSTDATE   DIM       8
FSTWORK   FORM      12.2
FINISH    INIT      "Finish"
.
HEADER    DIM       42
HEALTHFD  DIM       6
IBCNABNN  DIM       11
IBCNUGST  FORM      1
IBCNUMCI  DIM       1
INVOICEN  FORM      8
.
KEYSTARR  DIM       50[99]  * Key Strokes Array
KEYSTCNT  FORM      2       * Key Strokes Counter
.
MESSCODE  DIM       3  
MINAMNT   FORM      12.2
MINDISP   DIM       15
MPGEFLAG  FORM      1
MPRAC     DIM       6
.
PATNAME   DIM       25
PATADD3   DIM       21
PRNTSTRT  FORM      3
PRANAME   DIM       45                 * name of P.R.A.
PRAADD1   DIM       35                 * address of P.R.A. - line 1
PRAADD2   DIM       35                 *                     line 2
PRAADD3   DIM       35                 *                     line 3
PRAADD4   DIM       35
PRAPOST   DIM       8                  * postcode of P.R.A.
PRAPPHON  DIM       20                 * home phone of P.R.A.
PRABPHON  DIM       20                 * business phone of P.R.A.
PRAMPHON  DIM       20                 * mobile phone of P.R.A.
PRARREL   DIM       10                 * relationship of P.R.A.
.
RACLINDC  DIM       1
.
SCHDDESC  DIM       50
SCHDCOPY  FORM      3       * No of Copies
SCHDPRIN  DIM       1       * Print Report 0=No 1
SCHDPRNT  DIM       6       * Printer No
OPTNFLAG  FORM      1
SETDFRPT  FORM      2
SETDFPRG  DIM       8
SELPRINT  DIM       6
SCHDTIME  DIM       8
SCHDDATE  DIM       8
SCHDPGID  DIM       8
PRHRE028  DIM       3
START     INIT      "Start"
STCLM     DIM       3
SVERT     FORM      2
SAVINV    FORM      8
SAVKEY8   DIM       8
SAVKEY12  DIM       12
SAVMESS   DIM       3
SINVOICE  FORM      8
STRTNAME  DIM       6
STRTPRAC  DIM       6
.
TEMPUNQ   FORM      8
TMPAMT    FORM      12.2
TODATE    DIM       8
VARIABLE  DIM       127
+
.**********************************************************************
.*                             CONSTANTS                              *
.**********************************************************************
HEAD1     INIT      "              Line-up Print            "
HEAD2     INIT      "              Single Debtor            "
HEAD3     INIT      "              Single Invoice           "
HEAD4     INIT      "            Range of Invoices          "
HEAD5     INIT      " Outstanding invs. for given date range"
HEAD6     INIT      " Outstanding invs. for given inv. range"
HEAD7     INIT      " Outstanding invs. for given prac. range"
.
SP45      INIT      "                                             "
.
X5        INIT      "XXXXX"
X10       INIT      "XXXXXXXXXX"
.
BJDAY     FORM      3
CJDAY     FORM      3
URDIM8    DIM       8
USERID    DIM       10
.
IBCNMHOS  FORM      1
.
CHKMPRAC  FORM      1
CREDTOT   FORM      8.2
CRDNFLAG  FORM      1
DIM27     DIM       27
EPRAC     DIM       6                  * medical practice
FORM7P2   FORM      7.2
FORM82    FORM      8.2
HTMLFILE  FIFO      ASCII, FIXED=250            *used in PATCATBI
SPRAC     DIM       6                  * medical practice
TEMP8P2   FORM      8.2
WEBFLAG   FORM      1
.
PRGID     INIT      "IBAPRI21"
PRGNAM    INIT      "Re-print Invoices"
VERSION   INIT      "V12.00.02"
+
.**********************************************************************
.*                           MAINLINE                                 *
.*                       Controlling Logic                            *
.**********************************************************************
ML0000    CALL      INIT0000                * open files & display header
.
ML1000    CALL      OPTN0000                * main option screen
          BRANCH    EXIT,ML9999
          CALL      USID0000                * Keyin user id
          BRANCH    OPTION,ML2000
.
          BRANCH    OPTION,ML2000,ML3000,ML4000,ML5000,ML6000,ML7000,ML8000
          GOTO      ML1000
.
.------ line-up this invoice ------
.
ML2000    CALL      LINE0000                * do a line-up print
          GOTO      ML1000
.
.------ print invoices for a single debtor ------
.
ML3000    CALL      DEBT0000                * print for a single debtor
          GOTO      ML1000
.
.------ print invoices for a single invoice number ------
.
ML4000    CALL      SINV0000                * print for a single invoice number
          GOTO      ML1000
.
.------ print invoices for a range of invoice numbers ------
.
ML5000    CALL      KCLM0000                * Keyin range of claim code
          CALL      MULT0000                * print for a range of invoice nos.
          GOTO      ML1000
.
.------ print outstanding invoices for a given date range ------
.
ML6000    CALL      KCLM0000                * Keyin range of claim code
          CALL      OUTD0000                * print outstanding invoices for a
          GOTO      ML1000                    given date range
.
.------ print outstanding invoices for a given invoice range ------
.
ML7000    CALL      KCLM0000                * Keyin range of claim code
          CALL      OUTI0000                * print outstanding invoices for a
          GOTO      ML1000                    given invoice range
.
.------ print outstanding invoices for a given practice range ------
.
ML8000    CALL      KCLM0000                * Keyin range of claim code
          CALL      PRAC0000                * print outstanding invoices for a
          GOTO      ML1000                    given practice range
.
ML9999    MATCH     "IBARSH",PGM
          IF        !@EQUAL
             CALL      CLSPRINT             * close the spool file
          ENDIF
          CHAIN     PGM
+
.**********************************************************************
.*                           INIT0000                                 *
.*               Open files and display header                        *
.**********************************************************************
INIT0000  CALL      DISPHEAD                * display screen header
.
          DISPLAY   *P56:24,"Opening ibacodef";
          OPEN      IBACODE1,"ibacodef"
.
          DISPLAY   *P64:24,"patcodes";
          OPEN      PATCODE1,"patcodes"
.
          DISPLAY   *P64:24,"pmshcpaf";
          OPEN      PMSHCPA1,"pmshcpaf"
.
          DISPLAY   *P64:24,"pmshclaf";
          OPEN      PMSHCLA1,"pmshclaf"
.
          DISPLAY   *P64:24,"patma1af";
          OPEN      PATMA1A1,"patma1af"
          OPEN      PATMX1A1,"patmx1af"
.
          DISPLAY   *P64:24,"patmesgf";
          OPEN      PATMESG1,"patmesgf"
.
          DISPLAY   *P64:24,"patmi1af";
          OPEN      PATMI1A1,"patmi1af"
          OPEN      PMSVX1A1,"pmsvx1af"
.
          DISPLAY   *P64:24,"patpramf";
          OPEN      PATPR1A1,"patpr1af"
          OPEN      PATPX1A1,"patpx1af"
.
          DISPLAY   *P64:24,"controlf";
          OPEN      CONTROLF,"controlf"
.
          OPEN      PATGSRN1,"patgsrnf"
          OPEN      PATGSRN2,"patgsrnf"          * open Patient Surname file
.
          DISPLAY   *P64:24,"pribulkf";
          OPEN      PRIBULK1,"pribulkf"
.
...          DISPLAY   *P64:24,"pridebtf";
...          OPEN      PRIDEBT1,"pridebtf"
...          OPEN      PRIDEBT2,"pridebtf"
.
          DISPLAY   *P64:24,"pridoctf";
          OPEN      PRIDOCT1,"pridoctf"
.
          DISPLAY   *P64:24,"pridtraf";
          OPEN      PRIDTRA3,"pridtraf"
          OPEN      PRIDTRA4,"pridtraf"
.
          DISPLAY   *P64:24,"prihdbtf";
          OPEN      PRIHDBT1,"prihdbtf"
          OPEN      PRIHDBT2,"prihdbtf"
.
          DISPLAY   *P64:24,"prihreff";
          OPEN      PRIHREF1,"prihreff"
.
          DISPLAY   *P64:24,"priholdf";
          OPEN      PRIHOLA1,"priholdf"
.
          DISPLAY   *P64:24,"priinvof";
          OPEN      PRIINVO1,"priinvof"
          OPEN      PRIINVO2,"priinvof"
          OPEN      PRIINVO3,"priinvof"
.
          DISPLAY   *P64:24,"primgpaf";
          OPEN      PRIMGPA1,"primgpaf"
.
          DISPLAY   *P64:24,"pripracf";
          OPEN      PRIPRAC1,"pripracf"
.
          OPEN      PRIALSA1,"prialsaf"
          OPEN      PRISECA1,"prisecaf"
.
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAME2
.
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAME3
.
          READ      CONTROLF,ZERO;*85,IBCNUGST
          READ      CONTROLF,TEN;*79,CAPPRVNO
          READ      CONTROLF,THIRTY3;*71,PRCNNAME,PRCNTELE,PRCNADDR,PRCNJOUR:
                                    *170,PRCNLAYT,*200,PRCNRDOC
          READ      CONTROLF,THIRTY4;*2,PRCNADD1,PRCNADD2,PRCNADD3,PRCNPOST:
                                     *199,PRCNAFEE,*206,PRCNPRIH,*212,PRCNPRIT:
                                     *231,PRCNPJCI
          READ      CONTROLF,NINTY8;*148,PTCNINVB
          READ      CONTROLF,HUND24;*111,PTCNUIMC
          READ      CONTROLF,HUND29;*61,PTCNWSIN,*73,PTCNIMCW
          READ      CONTROLF,HUND30;*1,PTCNHABN
.
          MOVE      ONE,WEBFLAG
          MATCH     "IBARSH",PGM
          GOTO      INIT1000 IF EQUAL 
.
          MOVE      SP8,SPLFILE
          CALL      SELPRINT                * select a printer for the invoices
          MOVE      ZERO,WEBFLAG
.
          CALL      OPNPRINT                * open the spool file
INIT1000  MOVE      ONE,COPINV
.
INIT9999  RETURN
+
.**********************************************************************
.*                           OPTN0000                                 *
.*                   Display the main option screen                   *
.**********************************************************************
OPTN0000  MOVE      FALSE,EXIT
          DISPLAY   *P1:3,*EF:
                    *P1:4,*V2LON,ZERO,*HOFF," = Exit":
                    *P1:5,*V2LON,ONE,*HOFF," = Line-up Print":
                    *P1:6,*V2LON,TWO,*HOFF," = Print Single Debtor":
                    *P1:7,*V2LON,THREE,*HOFF," = Print Single Invoice":
                    *P1:8,*V2LON,FOUR,*HOFF," = Print Range of Invoices":
                    *P1:9,*V2LON,FIVE,*HOFF:
                       " = Print Outstanding Invoices for given Date Range":
                    *P1:10,*V2LON,SIX,*HOFF:
                       " = Print Outstanding Invoices for given Invoice Range":
                    *P1:11,*V2LON,SEVEN,*HOFF:
                       " = Print Outstanding Invoices for given Practice Range":
                    *P1:13,"Select Option : ";
.
.------ keyin the option ------
.
OPTN1000  KEYIN     *P17:13,*EL,*DV,UNDLN1,*P17:13,*V2LON,OPTION;
.
          COMPARE   ZERO,OPTION             * see if exit was chosen
          GOTO      OPTN9000 IF EQUAL
.
          COMPARE   EIGHT,OPTION            * see if we have a valid option
          GOTO      OPTN8000 IF LESS
          BEEP                              * invalid option chosen
          GOTO      OPTN1000
.
.------ a valid option has been chosen ------
.
OPTN8000  LOAD      HEADER,OPTION,HEAD1,HEAD2,HEAD3,HEAD4,HEAD5,HEAD6,HEAD7
          DISPLAY   *P25:3,*EL,*V2LON,HEADER;
          GOTO      OPTN9999
.
.------ Exit option chosen ------
.
OPTN9000  MOVE      TRUE,EXIT
.
OPTN9999  RETURN
+
.****************************************************************************
.         Keyin user id
.****************************************************************************
USID0000  KEYIN     *P1:17,*EL,"User Id : ",USERID;
          PACK      USERID,USERID,SP70
          MATCH     SP70,USERID
          GOTO      USID0000 IF EQUAL
USID9999  RETURN
+
.******************************************************************************
.        Keyin range of claim code
.******************************************************************************
KCLM0000  MOVE     SP3,STCLM
          DISPLAY  *P1:19,*EL:
                   *P1:19,*EL,"Starting Claim Type  : "
.
          MOVE     "19",EVERT
          MOVE     TWENTY4,ECOL
          MOVE     ZERO,CKYIMAND
          MOVE     "CL",CODE
          CALL     PATCODKY
.
          MOVE     ACODE,STCLM
.
          MATCH    SP3,STCLM
          GOTO     KCLM1000 IF NOT EQUAL
.
          DISPLAY  *P24:19,*V2LON,START;
          GOTO     KCLM2000
.
KCLM1000  DISPLAY  *P24:19,*V2LON,STCLM
.
KCLM2000  MOVE     SP3,EDCLM
          DISPLAY  *P41:19,*EL,"Ending Claim Type    : "
.
          MOVE     "19",EVERT
          MOVE     SIXTY4,ECOL
          MOVE     "CL",CODE
          CALL     PATCODKY
.
          MOVE     ACODE,EDCLM
.
          MATCH    SP3,EDCLM
          GOTO     KCLM4000 IF NOT EQUAL
.
          MOVE     "zzz",EDCLM
          DISPLAY  *P64:19,*V2LON,FINISH;
          GOTO     KCLM5000
.
KCLM4000  DISPLAY  *P64:19,*V2LON,EDCLM
.
KCLM5000  MATCH    STCLM,EDCLM
          GOTO     KCLM9999 IF NOT LESS
.
          DISPLAY  *P1:24,*EL,*B,*V2LON:
                   "** Ending Claim < Starting Claim **",*W2
          GOTO     KCLM0000
.
KCLM9999 RETURN
+
.**********************************************************************
.*                               LINE0000                             *
.*                     Routine to do a line-up print                  *
.**********************************************************************
LINE0000  MATCH     "IBARSH",PGM
          GOTO      LINE1000 IF EQUAL
.
          DISPLAY   *P1:24,*EL,*HOFF,"Do you want a line-up print (",*V2LON:
                           ANSY,*HOFF,SLASH,*V2LON,ANSN,*HOFF,") ? ";
          KEYIN     *V2LON,ANS;
.
          REP       UPPLOW,ANS
          MATCH     ANSN,ANS                * no line-up print required
          GOTO      LINE9999 IF EQUAL
          MATCH     ANSY,ANS                * we do want a line-up print
          GOTO      LINE1000 IF EQUAL
          BEEP                              * invalid option
          GOTO      LINE0000
.
.------ we want a line-up print ------
.
LINE1000  CALL      SINVH000                * check for template header
          BRANCH    EXIT,LINE9999
          CALL      SINVT000                * check for template tail
          BRANCH    EXIT,LINE9999
.
          CALL      LINUP000                * print the invoice line-up
          CALL      CLSPRINT                * close the spool file
.
.------ see if a further line-up is required ------
.
LINE1100  DISPLAY   *P1:24,*EL,*HOFF,"Do you want another line-up print (":
                           *V2LON,ANSY,*HOFF,SLASH,*V2LON,ANSN,*HOFF,") ? ";
          KEYIN     *V2LON,ANS;
.
          REP       UPPLOW,ANS
          MATCH     ANSN,ANS                * no line-up print required
          GOTO      LINE9999 IF EQUAL
          MATCH     ANSY,ANS                * we do want a line-up print
          GOTO      LINE2000 IF EQUAL
          BEEP                              * invalid option
          GOTO      LINE1100
.
LINE2000  CALL      OPNPRINT                * open spool file
          MATCH     "IBARSH",PGM
          GOTO      LINE9999 IF EQUAL
.
          GOTO      LINE1000
.
LINE9999  RETURN
+
.**********************************************************************
.*                                DEBT0000                            *
.*          Routine to print an invoice for a single debtor           *
.**********************************************************************
DEBT0000  DISPLAY   *P1:4,*EF,"Debtor Number   : ";
.
          MOVE      FOUR,CVERT
          MOVE      TEN9,CCOL
.
          CALL      PRIKYDEB                * keyin the debtor/UR number
          BRANCH    OVRCD,DEBT9999
.
          DISPLAY   *P19:4,*EF,*V2LON,VDEBTOR:
                    *P1:6,*HOFF,"Patient Name    : ",*V2LON,VDEBNAME:
                    *P9:7,*HOFF,"Address : ",*V2LON,VDEBADD1:
                    *P19:8,VDEBADD2:
                    *P19:9,VDEBADD3,SP1,VDEBPOST;
.
.------ see if this is the correct debtor ------
.
DEBT1000
          DISPLAY   *P1:24,*EL,"Is this the correct Debtor (",*V2LON,ANSY:
                    *HOFF,SLASH,*V2LON,"N",*HOFF,") ? ";
          KEYIN     *V2LON,ANS;
.
          REP       UPPLOW,ANS
          MATCH     ANSN,ANS                * see if no entered
          GOTO      DEBT0000 IF EQUAL
          MATCH     ANSY,ANS                * see if yes entered
          GOTO      DEBT2000 IF EQUAL       
          BEEP
          GOTO      DEBT1000                * invalid option chosen
.
.------ we have the correct debtor ------
.
DEBT2000  PACK      KEY18 WITH VDEBTOR,VSCANPMI,SP8
          CALL      RSPRIN3                 * position on the invoice file
.
.------ read through the invoice file ------
.
DEBT2100  CALL      RKPRIN3
          BRANCH    OVRCD TO DEBT9000
.
          MATCH     PRINDEBT,VDEBTOR        * compare debtor numbers
          GOTO      DEBT9000 IF NOT EQUAL
.
          COMPARE   PRINSCAN,VSCANPMI       * compare scan flags
          GOTO      DEBT9000 IF NOT EQUAL
          DISPLAY   *P1:5,*EF;
.
.         check the medical practice user access
.
          PACK      KEY10,USERID,SP70
          CALL      RDPRALS1
          COMPARE   ZERO,OVRCD
          GOTO      DEBT2800 IF EQUAL       * User has access to all Med.Prac.
.
          PACK      KEY16,PRINPRAC,USERID,SP70
          CALL      RDPRSEC1
          BRANCH    OVRCD,DEBT2100          * no access
.
DEBT2800  CALL      SETV0000                * set up the V variables from the
.                                             invoice file
          CALL      DISP0000                * display the invoice details
.
.------ choose option ------
.
DEBT3000  MOVE      SP1,ANS
          DISPLAY   *P1:24,*EL,"(":
                    *V2LON,"E",*HOFF,")xit, (":
                    *V2LON,"P",*HOFF,")rint, (":
                    *V2LON,"N",*HOFF,")ext Invoice, (":
                    *V2LON,"S",*HOFF,")elect another Debtor : ";
          KEYIN     *V2LON,ANS;
.
          TYPE      ANS                     * see if we have a number
          GOTO      DEBT3100 IF EQUAL
.
          REP       UPPLOW,ANS
          REP       "E1P2N3S4",ANS
          TYPE      ANS                     * we should have a number now
          GOTO      DEBT3100 IF NOT EQUAL
.
          MOVE      ANS,FORM1
          BRANCH    FORM1,DEBT9999,DEBT3500,DEBT2100,DEBT0000
.
DEBT3100  BEEP                              * invalid option chosen
          GOTO      DEBT3000
.
.------ print the invoice ------
.
DEBT3500  CALL      SINVH000                     * check for template header
          BRANCH    EXIT,DEBT3000
          CALL      SINVT000                     * check for template tail
          BRANCH    EXIT,DEBT3000
.
          CALL      PRNT0000                * print the invoice
          GOTO      DEBT2100
.
.------ we have finished processing this debtor ------
.
DEBT9000  DISPLAY   *P1:24,*EL,*B,*V2LON,"No more records.    ";
          CALL      HITENTER
          GOTO      DEBT0000
.
DEBT9999  RETURN
+
.**********************************************************************
.*                                SINV0000                            *
.*                Routine to print a single invoice                   *
.**********************************************************************
SINV0000  MOVE      ZERO,SINVOICE
          DISPLAY   *P1:4,*EF,"Invoice Number  : ",UNDLN8;
          KEYIN     *P19:4,*V2LON,SINVOICE;
.
          COMPARE   ZERO,SINVOICE           * see if an invoice number was 
          GOTO      SINV9999 IF EQUAL         entered
.
          DISPLAY   *P19:4,*V2LON,SINVOICE:
                    *P50:24,*EL,*V2LON,*BLINKON,"** Scanning ** ";
          MOVE      SINVOICE,KEY8 
          CALL      RDPRIN1                 * read the invoice file 
          COMPARE   ZERO,OVRCD
          GOTO      SINV1000 IF EQUAL
.
          DISPLAY   *P1:24,*EL,*B,*V2LON,"Invoice not on file.    ";
          CALL      HITENTER
          GOTO      SINV0000
.
.------ get the details for this invoice number ------
.
SINV1000  MOVE      PRINSCAN,VSCANPMI
          MOVE      PRINDEBT,VDEBTOR
          MOVE      PRINNUMB,SAVKEY8
.
          CALL      LDDETAIL                * load the patients details
          CALL      SETV0000                * set up the V variables from the
.                                             invoice file
          CALL      DISP0000                * display the invoice details
.
.------ see if O.K. to print this invoice ------
.
SINV2000  MOVE      SP1,ANS
          KEYIN     *P1:24,*EL,"Print this Invoice (":
                    *V2LON,*DV,ANSY,*HOFF,*DV,SLASH:
                    *V2LON,*DV,ANSN,*HOFF,*DV,SLASH:
                    *V2LON,*DV,ANSC,*HOFF,") ? ",*V2LON,ANS;
.
          TYPE      ANS                     * see if we have a number
          GOTO      SINV2100 IF EQUAL
.
          REP       UPPLOW,ANS
          REP       "Y1N2C3",ANS
          TYPE      ANS                     * we should have a number
          GOTO      SINV2100 IF NOT EQUAL
.
          MOVE      ANS,FORM1
          BRANCH    FORM1,SINV3000,SINV0000,SINV9999
.
SINV2100  BEEP                              * invalid option chosen
          GOTO      SINV2000
.
.------ print the invoice ------
.
SINV3000  CALL      SINVH000                     * check for template header
          BRANCH    EXIT,SINV2000
          CALL      SINVT000                     * check for template tail
          BRANCH    EXIT,SINV2000
.
          CALL      PRNT0000
          GOTO      SINV0000
.
SINV9999  RETURN
+
.**********************************************************************
.*                                MULT0000                            *
.*            Print invoices for a range of invoice numbers           *
.**********************************************************************
MULT0000  CALL      SINVH000                     * check for template header
          BRANCH    EXIT,MULT9999
          CALL      SINVT000                     * check for template tail
          BRANCH    EXIT,MULT9999
.
          MOVE      ZERO,SINVOICE
          DISPLAY   *P1:4,*EF,"Start Invoice Number  : ":
                    *P1:5,"End   Invoice Number  : ":
                    *P25:4,*EL,UNDLN8;
          KEYIN     *P25:4,*V2LON,SINVOICE;
.
          COMPARE   ZERO,SINVOICE           * see if an invoice number was 
          GOTO      MULT0100 IF EQUAL         entered
          DISPLAY   *P25:4,*V2LON,SINVOICE;
          GOTO      MULT0150
.
.------ we want to start from invoice 0 ------
.
MULT0100  DISPLAY   *P25:4,*V2LON,"Start   ";
          COMPARE   ZERO,SINVOICE
.
.------ keyin the end invoice range ------
.
MULT0150  MOVE      ZERO,EINVOICE
          DISPLAY   *P25:5,*EL,UNDLN8;
          KEYIN     *P25:5,*V2LON,EINVOICE;
.
          COMPARE   ZERO,EINVOICE           * see if an invoice number was 
          GOTO      MULT0200 IF EQUAL         entered
          DISPLAY   *P25:5,*V2LON,EINVOICE;
          GOTO      MULT0300
.
.------ we want to go to the last invoice ------
.
MULT0200  DISPLAY   *P25:5,*V2LON,"Finish  ";
          MOVE      "99999999",EINVOICE
.
.------ see if we have a valid range ------
.
MULT0300  COMPARE   SINVOICE,EINVOICE
          GOTO      MULT1000 IF NOT LESS
.
          DISPLAY   *P1:24,*EL,*B,*V2LON,"Invalid invoice range.    ";
          CALL      HITENTER
          GOTO      MULT0150
.
.------ see if O.K. to continue ------
.
MULT1000  MOVE      SP1,ANS
          KEYIN     *P1:24,*EL,"Ok to proceed (":
                    *V2LON,*DV,ANSY,*HOFF,*DV,SLASH:
                    *V2LON,*DV,ANSN,*HOFF,*DV,SLASH:
                    *V2LON,*DV,ANSC,*HOFF,") ? ",*V2LON,ANS;
.
          TYPE      ANS                     * see if a number was entered
          GOTO      MULT1100 IF EQUAL
.
          REP       UPPLOW,ANS
          REP       "Y1N2C3",ANS
          TYPE      ANS                     * we should have a number
          GOTO      MULT1100 IF NOT EQUAL
.
          MOVE      ANS,FORM1
          BRANCH    FORM1,MULT2000,MULT0000,MULT9999
.
MULT1100  BEEP                              * invalid option chosen
          GOTO      MULT1000
.
.------ it's O.K. to proceed ------
.
MULT2000  DISPLAY   *P50:24,*EL,*V2LON,*BLINKON,"** Scanning ** ";
          MOVE      SINVOICE,KEY8
.
.------ read the invoice file ------
.
MULT2100  CALL      RDPRIN1
          COMPARE   ZERO,OVRCD
          GOTO      MULT2500 IF EQUAL
.
          CALL      RKPRIN1                 * get the next invoice file record
          BRANCH    OVRCD TO MULT9000
.
.------ see if the invoice found is in range ------
.
MULT2500  MOVE      PRINNUMB,FORM8
          COMPARE   FORM8,EINVOICE
          GOTO      MULT9000 IF LESS
.
          MOVE      PRINNUMB,SAVINV
          MOVE      PRINSCAN,VSCANPMI
          MOVE      PRINDEBT,VDEBTOR
          MOVE      PRINNUMB,SAVKEY8
.
.         check the medical practice user access
.
          PACK      KEY10,USERID,SP70
          CALL      RDPRALS1
          COMPARE   ZERO,OVRCD
          GOTO      MULT4000 IF EQUAL       * User has access to all Med.Prac.
.
          PACK      KEY16,PRINPRAC,USERID,SP70
          CALL      RDPRSEC1
          BRANCH    OVRCD,MULT6000          * no access
.
MULT4000  CALL      CRNG0000                * Check range of Claim code
          BRANCH    EXIT,MULT6000
.
          CALL      LDDETAIL                * load this patients details
.
          MOVE      SAVKEY8,KEY8
          CALL      RDPRIN1                 * read the invoice file
.
          CALL      SETV0000                * set up the V variables from the
.                                             invoice file
          CALL      DISP0000                * display the invoice details
          CALL      PRNT0000                * print the invoice
.
MULT6000  ADD       ONE,SAVINV
          MOVE      SAVINV,KEY8
          GOTO      MULT2100
.
.------ all invoices have been processed ------
.
MULT9000  DISPLAY   *P1:24,*EL,*B,*V2LON,"No more records.    ";
          CALL      HITENTER
.
MULT9999  RETURN
+
.**********************************************************************
.*                                OUTD0000                            *
.*    Routine to print outstanding invoices for a given date range    *
.**********************************************************************
OUTD0000  CALL      SINVH000                     * check for template header
          BRANCH    EXIT,OUTD9999
          CALL      SINVT000                     * check for template tail
          BRANCH    EXIT,OUTD9999
.
          DISPLAY   *P1:4,*EF,"Start Date    : ":
                    *P1:5,"End   Date    : ":
                    *P1:6,"Starting Name : ":
                    *P1:7,"Ending   Name : ":
                    *P1:9,"Min. Amt. Owing : ";
.
          MOVE      FOUR,CVERT
          MOVE      TEN7,CCOL
          UNPACK    SP6,CDAY,CMON,CYEAR
          MOVE      CCC,CCENT
          REP       " 0",CCENT
          MOVE      ZERO,CHIGHLT
.
          CALL      KEYDATE                 * keyin the date
          BRANCH    OVRCD,OUTD9999
.
          PACK      FROMDATE,CCENT,CYEAR,CMON,CDAY
          DISPLAY   *P17:5,*V2LON,CDD,*HOFF,"/",*V2LON,CMM,*HOFF,"/",*V2LON:
                           CCC,CYY;
.
.------ keyin the end date ------
.
OUTD0050  MOVE      FIVE,CVERT
          MOVE      CDD,CDAY
          MOVE      CMM,CMON
          MOVE      CYY,CYEAR
          MOVE      CCC,CCENT
          CALL      KEYDATE                 * keyin the date
          BRANCH    OVRCD,OUTD0000
.
          PACK      TODATE,CCENT,CYEAR,CMON,CDAY
          REP       " 0",TODATE
.
          MATCH     FROMDATE,TODATE         * make sure we have a valid date 
          GOTO      OUTD0100 IF NOT LESS      range
.
          DISPLAY   *P1:24,*EL,*B,*V2LON,"Invalid date range.    ";
          CALL      HITENTER
          GOTO      OUTD0050
.
.------ keyin the start name ------
.
OUTD0100  DISPLAY   *P17:6,*EL,UNDLN6;
          KEYIN     *P17:6,*V2LON,STRTNAME;
          DISPLAY   *P17:6,*V2LON,STRTNAME;
.
          ENDSET    STRTNAME
          APPEND    SP6,STRTNAME
          RESET     STRTNAME
.
          MATCH     SP6,STRTNAME            * see if a name was entered
          GOTO      OUTD0200 IF NOT EQUAL
          DISPLAY   *P17:6,*V2LON,"Start   ";
.
.------ keyin the end name ------
.
OUTD0200  DISPLAY   *P17:7,*EL,UNDLN6;
          KEYIN     *P17:7,*V2LON,ENDNAME;
          DISPLAY   *P17:7,*V2LON,ENDNAME;
.
          ENDSET    ENDNAME
          APPEND    SP6,ENDNAME
          RESET     ENDNAME
.
          MATCH     SP6,ENDNAME             * see if a name was entered
          GOTO      OUTD0300 IF NOT EQUAL
          DISPLAY   *P17:7,*V2LON,"Finish  ";
          MOVE      "ZZZZZZ",ENDNAME
.
.------ see if a valid range was entered ------
.
OUTD0300  MATCH     STRTNAME,ENDNAME
          GOTO      OUTD0400 IF NOT LESS
.
          DISPLAY   *P1:24,*EL,*B,*V2LON,"Invalid name range.    ";
          CALL      HITENTER
          GOTO      OUTD0200
.
.------ keyin the minimum amount owing ------
.
OUTD0400  MOVE      ZERO,MINAMNT
          MOVE      "-$9999999999.99",MINDISP
          DISPLAY   *P19:9,*EL,UNDLN10;
          KEYIN     *P19:9,*V2LON,MINAMNT;
          FEDIT     MINAMNT,MINDISP
          DISPLAY   *P19:9,*V2LON,MINDISP;
.
.------ enter an option ------
.
OUTD1000  MOVE      SP1,ANS
          KEYIN     *P1:24,*EL,"Ok to proceed (":
                    *V2LON,*DV,ANSY,*HOFF,*DV,SLASH:
                    *V2LON,*DV,ANSN,*HOFF,*DV,SLASH:
                    *V2LON,*DV,ANSC,*HOFF,") ? ",*V2LON,ANS;
.
          MATCH     ANSY,ANS                * see if Yes was entered
          GOTO      OUTD1100 IF EQUAL
          MATCH     ANSN,ANS                * see if No was entered
          GOTO      OUTD0000 IF EQUAL
          MATCH     ANSC,ANS                * see if cancel was entered
          GOTO      OUTD9999 IF EQUAL
          BEEP                              * invalid option
          GOTO      OUTD1000
.
.------ O.K. to continue ------
.
OUTD1100  DISPLAY   *P50:24,*EL,*V2LON,*BLINKON,"** Scanning ** ";
          PACK      KEY16,FROMDATE,SP8
          CALL      RSPRIN2                 * position on the invoice file
.
.------ read through the invoice file ------
.
OUTD1200  CALL      RKPRIN2
          BRANCH    OVRCD TO OUTD9000
.
          MATCH     PRINDATE,TODATE         * see if we are in the date range
          GOTO      OUTD9000 IF LESS
.
.         check the medical practice user access
.
          PACK      KEY10,USERID,SP70
          CALL      RDPRALS1
          COMPARE   ZERO,OVRCD
          GOTO      OUTD1220 IF EQUAL       * User has access to all Med.Prac.
.
          PACK      KEY16,PRINPRAC,USERID,SP70
          CALL      RDPRSEC1
          BRANCH    OVRCD,OUTD1200          * no access
.
OUTD1220  CALL      CRNG0000                * Check range of Claim code
          BRANCH    EXIT,OUTD1200
.
          MOVE      PRINDEBT,VDEBTOR
          MOVE      PRINSCAN,VSCANPMI
          MOVE      PRINNUMB,SAVINV   
          MOVE      PRINITOT,TMPAMT  
          ADD       PRINPAMT,TMPAMT   
          ADD       PRINHAMT,TMPAMT  
          ADD       PRINIAMT,TMPAMT 
          ADD       PRINMAMT,TMPAMT
          ADD       PRINVAMT,TMPAMT
          ADD       PRINOTHA,TMPAMT
          ADD       PRINJAMT,TMPAMT
.
          STRIP     ENDNAME
.
          CALL      LDDETAIL                * load the patients details
.
          MATCH     STRTNAME,FNSNAME        * see if the name is in range
          GOTO      OUTD1200 IF LESS
.
          MATCH     FNSNAME,ENDNAME         * see if the name is in range
          GOTO      OUTD1300 IF EQUAL
          GOTO      OUTD1200 IF LESS
.
.------ see if the amount owing is in range ------
.
OUTD1300  COMPARE   MINAMNT,TMPAMT          
          GOTO      OUTD1200 IF EQUAL      
          GOTO      OUTD1200 IF LESS
.
          MOVE      SAVINV,PRINNUMB
.
          CALL      SETV0000                * set up the V variables from the
.                                             invoice file
          CALL      DISP0000                * display the invoice details
          CALL      PRNT0000                * print the invoice
          GOTO      OUTD1200
.
.------ all records have been processed ------
.
OUTD9000  DISPLAY   *P1:24,*EL,*B,*V2LON,"No more records.    ";
          CALL      HITENTER
.
OUTD9999  RETURN
+
.**********************************************************************
.*                                OUTI0000                            *
.*   Routine to print outstanding invoices for a given invoice range  *
.**********************************************************************
OUTI0000  CALL      SINVH000                     * check for template header
          BRANCH    EXIT,OUTI9999
          CALL      SINVT000                     * check for template tail
          BRANCH    EXIT,OUTI9999
.
          DISPLAY   *P1:4,*EF,"Start Invoice : ":
                    *P1:5,"End   Invoice : ":
                    *P1:6,"Starting Name : ":
                    *P1:7,"Ending   Name : ":
                    *P1:9,"Min. Amt. Owing : ";
.
          MOVE      ZERO,SINVOICE
          DISPLAY   *P17:4,*EL,UNDLN8;
          KEYIN     *P17:4,*V2LON,SINVOICE;
          DISPLAY   *P17:4,*V2LON,SINVOICE;
.
          COMPARE   ZERO,SINVOICE           * see if an invoice was entered
          GOTO      OUTI0100 IF EQUAL
          GOTO      OUTI0100 IF LESS
          GOTO      OUTI0150
.
.------ we want to start at invoice 0 ------
.
OUTI0100  DISPLAY   *P17:4,*V2LON,"Start   ";
.
.------ keyin the end invoice ------
.
OUTI0150  MOVE      ZERO,EINVOICE
          DISPLAY   *P17:5,*EL,UNDLN8;
          KEYIN     *P17:5,*V2LON,EINVOICE;
          DISPLAY   *P17:5,*V2LON,EINVOICE;
.
          COMPARE   ZERO,EINVOICE           * see if an invoice number was 
          GOTO      OUTI0170 IF EQUAL         entered
          GOTO      OUTI0170 IF LESS
          GOTO      OUTI0200
.
.------ we want to go to the last invoice ------
.
OUTI0170  DISPLAY   *P17:5,*V2LON,"Finish  ";
          MOVE      "99999999",EINVOICE
.
.------ see if we have a valid invoice range ------
.
OUTI0200  COMPARE   SINVOICE,EINVOICE
          GOTO      OUTI0300 IF NOT LESS
.
          DISPLAY   *P1:24,*EL,*B,*V2LON,"Invalid invoice range.    ";
          CALL      HITENTER
          GOTO      OUTI0150
.
.------ keyin the start name ------
.
OUTI0300  DISPLAY   *P17:6,*EL,UNDLN6;
          KEYIN     *P17:6,*V2LON,STRTNAME;
          DISPLAY   *P17:6,*V2LON,STRTNAME;
.
          ENDSET    STRTNAME
          APPEND    SP6,STRTNAME
          RESET     STRTNAME
.
          MATCH     SP6,STRTNAME            * see if a name was entered
          GOTO      OUTI0400 IF NOT EQUAL
          DISPLAY   *P17:6,*V2LON,"Start   ";
.
.------ keyin the end name ------
.
OUTI0400  MOVE      SP6,ENDNAME
          DISPLAY   *P17:7,*EL,UNDLN6;
          KEYIN     *P17:7,*V2LON,ENDNAME;
          DISPLAY   *P17:7,*V2LON,ENDNAME;
.
          ENDSET    ENDNAME
          APPEND    SP6,ENDNAME
          RESET     ENDNAME
.
          MATCH     SP6,ENDNAME             * see if a name was entered
          GOTO      OUTI0500 IF NOT EQUAL
          DISPLAY   *P17:7,*V2LON,"Finish  ";
          MOVE      "ZZZZZZ",ENDNAME
.
.------ see if we have a valid name range ------
.
OUTI0500  MATCH     STRTNAME,ENDNAME
          GOTO      OUTI0600 IF NOT LESS
.
          DISPLAY   *P1:24,*EL,*B,*V2LON,"Invalid name range.    ";
          CALL      HITENTER
          GOTO      OUTI0400
.
.------ keyin the minimum amount owing ------
.
OUTI0600  MOVE      ZERO,MINAMNT
          MOVE      "-$9999999.99",MINDISP
          DISPLAY   *P19:9,*EL,UNDLN10;
          KEYIN     *P19:9,*V2LON,MINAMNT;
          FEDIT     MINAMNT,MINDISP
          DISPLAY   *P19:9,*V2LON,MINDISP;
.
.------ see if O.K. to continue ------
.
OUTI1000  MOVE      SP1,ANS
          KEYIN     *P1:24,*EL,"Ok to proceed (":
                    *V2LON,*DV,ANSY,*HOFF,*DV,SLASH:
                    *V2LON,*DV,ANSN,*HOFF,*DV,SLASH:
                    *V2LON,*DV,ANSC,*HOFF,") ? ",*V2LON,ANS;
.
          REP       UPPLOW,ANS
          MATCH     ANSY,ANS                * see if Yes was entered
          GOTO      OUTI2000 IF EQUAL
          MATCH     ANSN,ANS                * see if No was entered
          GOTO      OUTI0000 IF EQUAL
          MATCH     ANSC,ANS                * see if Cancel was entered
          GOTO      OUTI9999 IF EQUAL
          BEEP                              * invalid option entered
          GOTO      OUTI1000
.
.------ it is O.K. to continue ------
.
OUTI2000  DISPLAY   *P50:24,*EL,*V2LON,*BLINKON,"** Scanning ** ";
          MOVE      SINVOICE,KEY8
          CALL      RDPRIN1                 * read the invoice file
          COMPARE   ZERO,OVRCD
          GOTO      OUTI2200 IF EQUAL
.
.------ read through the invoice file ------
.
OUTI2100  CALL      RKPRIN1
          BRANCH    OVRCD TO OUTI9000
.
.------ see if invoice is in range ------
.
OUTI2200  MOVE      PRINNUMB,FORM8
          COMPARE   FORM8,EINVOICE
          GOTO      OUTI9000 IF LESS
.
.         check the medical practice user access
.
          PACK      KEY10,USERID,SP70
          CALL      RDPRALS1
          COMPARE   ZERO,OVRCD
          GOTO      OUTI2220 IF EQUAL       * User has access to all Med.Prac.
.
          PACK      KEY16,PRINPRAC,USERID,SP70
          CALL      RDPRSEC1
          BRANCH    OVRCD,OUTI2100          * no access
.
OUTI2220  CALL      CRNG0000                * Check range of Claim code
          BRANCH    EXIT,OUTI2100
.
          MOVE      PRINDEBT,VDEBTOR
          MOVE      PRINSCAN,VSCANPMI
          MOVE      PRINNUMB,SAVINV  
.
          STRIP     ENDNAME
.
          CALL      LDDETAIL                * load the patients details
.
          MATCH     STRTNAME,FNSNAME        * see if the name is in range
          GOTO      OUTI2100 IF LESS
.
          MATCH     FNSNAME,ENDNAME         * see if the name is in range
          GOTO      OUTI2300 IF EQUAL
          GOTO      OUTI2100 IF LESS
.
.------ calculate the amount owing ------
.
OUTI2300  MOVE      PRINITOT,TMPAMT
          ADD       PRINPAMT,TMPAMT   
          ADD       PRINHAMT,TMPAMT  
          ADD       PRINIAMT,TMPAMT 
          ADD       PRINMAMT,TMPAMT
          ADD       PRINVAMT,TMPAMT
          ADD       PRINOTHA,TMPAMT
          ADD       PRINJAMT,TMPAMT
.
          COMPARE   MINAMNT,TMPAMT          * see if the amount owing is in
          GOTO      OUTI2100 IF EQUAL         range
          GOTO      OUTI2100 IF LESS
          MOVE      SAVINV,PRINNUMB 
.
          CALL      SETV0000                * set up the V variables from the
.                                             invoice file
          CALL      DISP0000                * display the invoice details
          CALL      PRNT0000
          GOTO      OUTI2100
.
.------ we have finished processing all of the records ------
.
OUTI9000  DISPLAY   *P1:24,*EL,*B,*V2LON,"No more records.    ";
          CALL      HITENTER
.
OUTI9999  RETURN
+
.******************************************************************************
.*                                PRAC0000                                    *
.*    Routine to print outstanding invoices for a given Practice/date range   *
.******************************************************************************
PRAC0000  CALL      SINVH000                     * check for template header
          BRANCH    EXIT,PRAC9999
          CALL      SINVT000                     * check for template tail
          BRANCH    EXIT,PRAC9999
.         
          DISPLAY   *P1:4,*EF,"Medical Practice From : ":
                    *P1:5,"                 To   : ": 
                    *P1:6,"Start Date            : ":
                    *P1:7,"End   Date            : ":
                    *P1:9,"Min. Amt. Owing       : ";
.
PRAC0100  MOVE      TWENTY5,CCOL
          MOVE      FOUR,CVERT
          MOVE      "From",FROMTO
          MOVE      SP6,STRTPRAC
          CALL      GPRA0000                * get Medical Practice From
          BRANCH    EXIT,PRAC9999           * exitchar entered
          MATCH     SP6,MPRAC
          IF        @EQUAL
            DISPLAY   *P25:4,*V2LON,"Start   ",*HOFF
          ELSE
            MOVE      MPRAC,STRTPRAC
          ENDIF
.
PRAC0150  MOVE      FIVE,CVERT
          MOVE      "  To",FROMTO
          MOVE      SP6,ENDPRAC
          CALL      GPRA0000                * get Medical Practice To
          BRANCH    EXIT,PRAC9999           * exitchar entered
          MATCH     SP6,MPRAC
          IF        @EQUAL
            DISPLAY   *P25:5,*V2LON,"End     ",*HOFF
            MOVE      "zzzzzz",ENDPRAC
          ELSE
            MOVE      MPRAC,ENDPRAC
          ENDIF
.
          MATCH     STRTPRAC,ENDPRAC
          IF        @LESS
            DISPLAY   *P1:24,*EL,"End practice less than start practice.  ";
            CALL      HITENTER
            GOTO      PRAC0150
          ENDIF
.
.
PRAC0200  MOVE      SIX,CVERT
          MOVE      TWENTY5,CCOL
          UNPACK    SP6,CDAY,CMON,CYEAR
          MOVE      CCC,CCENT
          REP       " 0",CCENT
          MOVE      ZERO,CHIGHLT
.
          CALL      KEYDATE                 * keyin the date
          IF        OVRCD = 0
            PACK      FROMDATE,CCENT,CYEAR,CMON,CDAY
          ELSE
            MOVE      SP10,FROMDATE
            DISPLAY   *P25:6,*V2LON,"Start     ",*HOFF:
                      *P25:7,*V2LON,SP2,*HOFF,"/",*V2LON,SP2,*HOFF,"/",*V2LON:
                      SP10
          ENDIF
.
.------ keyin the end date ------
.
PRAC0300  MOVE      SEVEN,CVERT
          MOVE      TWENTY5,CCOL
          UNPACK    SP6,CDAY,CMON,CYEAR
          MOVE      CCC,CCENT
          REP       " 0",CCENT
.
          CALL      KEYDATE                 * keyin the date
          IF        OVRCD = 0
            PACK      TODATE,CCENT,CYEAR,CMON,CDAY
            REP       " 0",TODATE
            MATCH     FROMDATE,TODATE         * make sure we have a valid date
            IF        @LESS
              DISPLAY   *P1:24,*EL,*B,*V2LON,"Invalid date range.    ";
              CALL      HITENTER
              GOTO      PRAC0300
            ENDIF
          ELSE
            MOVE      "99999999",TODATE
            DISPLAY   *P25:7,*V2LON,"End       ",*HOFF
          ENDIF
.
.------ keyin the minimum amount owing ------
.
PRAC0400  MOVE      ZERO,MINAMNT
          MOVE      "-$9999999999.99",MINDISP
          DISPLAY   *P25:9,*EL,UNDLN10;
          KEYIN     *P25:9,*V2LON,MINAMNT;
          FEDIT     MINAMNT,MINDISP
          DISPLAY   *P25:9,*V2LON,MINDISP;
.
.------ enter an option ------
.
PRAC1000  MOVE      SP1,ANS
          KEYIN     *P1:24,*EL,"Ok to proceed (":
                    *V2LON,*DV,ANSY,*HOFF,*DV,SLASH:
                    *V2LON,*DV,ANSN,*HOFF,*DV,SLASH:
                    *V2LON,*DV,ANSC,*HOFF,") ? ",*V2LON,ANS;
          REP       UPPLOW,ANS
.
          MATCH     ANSY,ANS                * see if Yes was entered
          GOTO      PRAC1100 IF EQUAL
          MATCH     ANSN,ANS                * see if No was entered
          GOTO      PRAC0000 IF EQUAL
          MATCH     ANSC,ANS                * see if cancel was entered
          GOTO      PRAC9999 IF EQUAL
          BEEP                              * invalid option
          GOTO      PRAC1000
.
.------ O.K. to continue ------
.
PRAC1100  DISPLAY   *P50:24,*EL,*V2LON,*BLINKON,"** Scanning ** ";
          PACK      KEY16,FROMDATE,SP8
          CALL      RSPRIN2                 * position on the invoice file
.
.------ read through the invoice file ------
.
PRAC1200  CALL      RKPRIN2
          BRANCH    OVRCD TO PRAC9000
.
          MATCH     PRINDATE,TODATE         * see if we are in the date range
          GOTO      PRAC9000 IF LESS
.
          MATCH     STRTPRAC,PRINPRAC       * see if the name is in range
          GOTO      PRAC1200 IF LESS
.
          MATCH     PRINPRAC,ENDPRAC        * see if the name is in range
          GOTO      PRAC1200 IF LESS
.
.         check the medical practice user access
.
          PACK      KEY10,USERID,SP70
          CALL      RDPRALS1
          COMPARE   ZERO,OVRCD
          GOTO      PRAC1220 IF EQUAL       * User has access to all Med.Prac.
.
          PACK      KEY16,PRINPRAC,USERID,SP70
          CALL      RDPRSEC1
          BRANCH    OVRCD,PRAC1200          * no access
.
PRAC1220  CALL      CRNG0000                * Check range of Claim code
          BRANCH    EXIT,PRAC1200
.
          MOVE      PRINDEBT,VDEBTOR
          MOVE      PRINSCAN,VSCANPMI
          MOVE      PRINNUMB,SAVINV
          MOVE      PRINITOT,TMPAMT
          ADD       PRINPAMT,TMPAMT
          ADD       PRINHAMT,TMPAMT
          ADD       PRINIAMT,TMPAMT
          ADD       PRINMAMT,TMPAMT
          ADD       PRINVAMT,TMPAMT
          ADD       PRINOTHA,TMPAMT
          ADD       PRINJAMT,TMPAMT
.
          STRIP     ENDNAME
.
          CALL      LDDETAIL                * load the patients details
.
.------ see if the amount owing is in range ------
.
PRAC1300  COMPARE   MINAMNT,TMPAMT
          GOTO      PRAC1200 IF EQUAL
          GOTO      PRAC1200 IF LESS
.
          MOVE      SAVINV,PRINNUMB
.
          CALL      SETV0000                * set up the V variables from the
.                                             invoice file
          CALL      DISP0000                * display the invoice details
          CALL      PRNT0000                * print the invoice
          GOTO      PRAC1200
.
.------ all records have been processed ------
.
PRAC9000  DISPLAY   *P1:24,*EL,*B,*V2LON,"No more records.    ";
          CALL      HITENTER
.
PRAC9999  RETURN
+
.**********************************************************************
.*                                SETV0000                            *
.*      Set up the V variables from PRIKYDEB with the variables       *
.*      from the invoice file                                         *
.**********************************************************************
SETV0000  MOVE      PRINNAMR,TMPRESP
          MOVE      PRINPRA1,TMPRADD1
          MOVE      PRINPRA2,TMPRADD2
          MOVE      PRINPRA3,TMPRADD3
          MOVE      PRINPOST,TMPRPOST
          MOVE      PRINTELP,TMPRPTEL
          MOVE      PRINTELB,TMPRBTEL
          MOVE      PRINRELP,TMPRREL
.
SETV9999  RETURN
+
.**********************************************************************
.*                               DISP0000                             *
.*       Display the details of the invoice we are about to print     *
.**********************************************************************
DISP0000  DISPLAY   *P1:11,*EF:
                    *P50:11,*ULON,"Person Responsible for Account",*HOFF:
                    *P1:12,"Patient Name    :":
                    *P1:13,"        Address :":
                    *P1:17,"Invoice Number    :":
                    *P1:18,"Invoice Date      :":
                    *P1:19,"Invoice Amount    :":
                    *P1:21,"Claim Type        :":
                    *P1:22,"Service Doctor    :";
.
          MOVE      "ERROR - Unknown Doctor Code",VSVDCNAM
          MOVE      "ERROR - Unknown Doctor Type",PRIMTYPE
          MOVE      "Unknown Doctor Code",SHORTDOC
          MOVE      PRINDOCT,VSVDOCT   
          PACK      KEY10 WITH VSVDOCT
          PACK      KEY10 WITH VSVDOCT,SP10
          CALL      RDPMHCP1                * read the patient doctor file
          BRANCH    OVRCD TO DISP1000
.
          MOVE      ONE,PACFRMT
          MOVE      PMHCSNAM,PACSNAME
          MOVE      PMHCGNAM,PACGNAME
          MOVE      PMHCTITL,PACTITLE
          CALL      PACNAME                 * pack the doctors name
          MOVE      PACFNAME,VSVDCNAM
          MOVE      PMHCPRV1,VSVDPROV
.
          PACK      SHORTDOC,PMHCTITL,SP1,PMHCSNAM
          PACK      KEY5 WITH CODEDT,PMHCSPC1
          CALL      RDCODE1                 * read the patient codes file
          BRANCH    OVRCD TO DISP1000
          MOVE      TDESC,PRIMTYPE
.
DISP1000  MOVE      SP20,TDESC
          PACK      KEY5 WITH CODECL,PRINCLAM
          CALL      RDCODE1                 * read the patient codes file
          MOVE      TDESC,VCOMPDSC
          UNPACK    PRINDATE INTO CCENT,CYEAR,CMON,CDAY
          MOVE      TMPRESP,VPRANAME
.
          DISPLAY   *P19:12,*V2LON,VDEBNAME,*P50:12,VPRANAME:
                    *P19:13,VDEBADD1,*P50:13,TMPRADD1:
                    *P19:14,VDEBADD2,*P50:14,TMPRADD2:
                    *P19:15,VDEBADD3,VDEBPOST,*P50:15,TMPRADD3,TMPRPOST:
                    *P24:17,PRINNUMB:
                    *P24:18,CDAY,SLASH,CMON,SLASH,CCENT,CYEAR:
                    *P21:19,PRINITOT:
                    *P24:21,PRINCLAM,*P40:21,*HOFF,VCOMPDSC:
                    *P24:22,*V2LON,PRINDOCT,*P40:22,*HOFF,VSVDCNAM;
.
DISP9999  RETURN
+
.**********************************************************************
.*                               PRNT0000                             *
.*                  Routine to print the invoice                      *
.**********************************************************************
PRNT0000  DISPLAY   *P65:24,*V2LON,*BLINKON,"** Printing ** ";
          MOVE      FALSE,FLAGSOME
          MOVE      PRINNUMB,PRCNINVN
          MOVE      "Error - invalid practice",PRPRDESC
          MOVE      PRINPRAC,KEY6 
          CALL      RDPRPR1                 * read the practice file
.
          COMPARE   ZERO,PRPRTIME           * see if we want the service time
          GOTO      PRNT0050 IF EQUAL         on the invoice
          CALL      GETS0000                * Get service time 
.
.------ get the claim code details if they exist ------
.
PRNT0050  CALL      GETC0000                * get the claim code details if 
.                                             they exist
          CALL      NBNK0000                * Check for non-banked cash
          MOVE      PRINCLAM,TMPCLAIM
          CALL      PIHED000                * print the invoice header
.
          MOVE      ZERO,FLAGMESS
          MOVE      SP6,VRFDOCT
          MOVE      SP8,SAVRDATE
          UNPACK    SP70,VRFDCNAM,VRFDOCT,VRFDPROV,VREFERD,REFDATE
.
          PACK      KEY24,VDEBTOR,VSCANPMI,PRINNUMB,SP6
          CALL      RSPRDT3                 * position on the debtors 
.                                             transaction file
.------ read through the debtors transaction file ------
.
PRNT1000  CALL      RKPRDT3
          BRANCH    OVRCD,PRNT8000
.
          MATCH     VDEBTOR,PRDTDEBT        * compare debtors
          GOTO      PRNT8000 IF NOT EQUAL
.
          COMPARE   VSCANPMI,PRDTSCAN       * compare scan flags
          GOTO      PRNT8000 IF NOT EQUAL
.
          MATCH     PRINNUMB,PRDTINVN       * match invoice numbers
          GOTO      PRNT8000 IF NOT EQUAL
.
          BRANCH    FLAGMESS,PRNT1200       * skip if we have the message code
          MOVE      PRDTMESS,SAVMESS
          MOVE      ONE,FLAGMESS
.
.------ match referring doctors ------
.
PRNT1200  MATCH     PRDTREFD,VRFDOCT        * same ref. doctor?
          GOTO      PRNT1210 IF NOT EQUAL   * no
.
          MATCH     PRDTRDTE,SAVRDATE       * same ref. date?
          GOTO      PRNT1400 IF EQUAL       * yes, details same as previous
.
PRNT1210  MATCH     SP10,PRDTREFD            * see if we have a referring doctor
          GOTO      PRNT1400 IF EQUAL
          MOVE      PRDTOPS,TMPOPS
          MOVE      SP10,REFDATE
.
          MATCH     SP8,PRDTRDTE            * see if we have a referring date
          GOTO      PRNT1250 IF EQUAL
.
          UNPACK    PRDTRDTE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE                 * pack the date into required format
          MOVE      CPCDATE,REFDATE
.
.------ set up the referral details ------
.
PRNT1250  MOVE      PRDTREFT,VREFERD
          MOVE      PRDTREFD,VRFDOCT
          MOVE      PRDTRDTE,SAVRDATE
          MOVE      "                           ",VRFDCNAM
          MOVE      SP10,VRFDPROV
.
          MOVE      SP10,RPERIOD
          PACK      KEY5,ANSR,ANSF,PRDTRFPD
          CALL      RDCODE1
          IF        OVRCD<>1
            MOVE      TDESC,RPERIOD
          ENDIF
.
          PACK      KEY27,PRDTUNIQ,PRDTPRAC,PRDTDOCT,PRDTCODE,SP70
          CALL      RDPRHR1
          IF        OVRCD=0
            MATCH     SP70,PRHRREFD
            IF        !@EQUAL & !@EOS
              PACK      KEY20,PRHRREFD,PRHRHCPP,SP70
              CALL      RDPMHCL1
              IF        OVRCD=0
                MATCH     SP70,PMHLPRV1
                IF        !@EQUAL
                  MOVE      PMHLPRV1,VRFDPROV  * provider from a Linked Practice
                ENDIF
              ENDIF
            ENDIF
          ENDIF
.
          PACK      KEY6 WITH VRFDOCT
          PACK      KEY10,VRFDOCT,SP10
          CALL      RDPMHCP1                * read the patient doctor file
          BRANCH    OVRCD,PRNT1300
          MOVE      PMHCSNAM,PACSNAME
          MOVE      PMHCGNAM,PACGNAME
          MOVE      PMHCTITL,PACTITLE
          MOVE      ONE,PACFRMT
          CALL      PACNAME                 * pack the doctors name
          MOVE      PACFNAME,VRFDCNAM
          MATCH     SP70,VRFDPROV
          IF        @EQUAL
            MOVE      PMHCPRV1,VRFDPROV
          ENDIF
.
.------ print the referring doctor details ------
.
PRNT1300  CALL      PRDOC000           
.
.------ set up the rest of the details to print for the current transaction ---
.
PRNT1400  MOVE      PRDTCODE,TMPPIND
          MOVE      ONEHUND,PRDOFEEP
          PACK      KEY22,PRDTPRAC,PRDTDOCT,PRDTCLAM,PRDTCODE
          CALL      RDPRDO1                 * read the practice doctor file
.
          CALL      PRINV000                * print the current transaction
          MOVE      TRUE,FLAGSOME
          GOTO      PRNT1000
.
.------ no more records to process so see if any records were found ------
.
PRNT8000  COMPARE   ZERO,FLAGSOME
          GOTO      PRNT9000 IF EQUAL
.
          OPEN      PATMESG1,"patmesgf"
          PACK      PMLINE1 WITH SP30,SP30,SP5
          PACK      PMLINE2 WITH SP30,SP30,SP5
          MOVE      SAVMESS,KEY3
          CALL      RDMESG1                 * read the message file
.
          CALL      PRITL000                * print the invoice tail
          GOTO      PRNT9999
.
.------ no transactions found ------
.
PRNT9000  MATCH     "IBARSH",PGM
          GOTO      PRNT9999 IF EQUAL
.
          DISPLAY   *P1:24,*EL,*B,*V2LON,"*ERROR*",*HOFF:
                    " Trans. details missing. Key=[":
                    *V2LON,KEY24,*HOFF,"] Contact IBA ... ";
          KEYIN     ANS;
.
PRNT9999  RETURN
+
.**********************************************************************
.         Check for any non-banked cash for the invoice
.**********************************************************************
NBNK0000  MOVE      ZERO,CURRDEP
          MOVE      ZERO,NBNKDEPS
          OPEN      RCPDTEA3,"rcpdteaf"
          OPEN      RCPBNKA1,"rcpbnkaf"
          PACK      SAVKEY12,SP4,PRINNUMB,SP70
          PACK      KEY29,SAVKEY12,SP70
          CALL      RSRCDTE3
NBNK1000  CALL      RKRCDTE3
          BRANCH    OVRCD,NBNK9999
.
          MATCH     SAVKEY12,RCDTINVN
          GOTO      NBNK9999 IF NOT EQUAL
.
          MATCH     PRINDEBT,RCDTURNO       * Same U/R?
          GOTO      NBNK1000 IF NOT EQUAL
.
          MATCH     SP10,RCDTRELD
          GOTO      NBNK1000 IF NOT EQUAL   * has been released
.
          PACK      KEY12,RCDTRECN
          CALL      RDRCBNK1
          BRANCH    OVRCD,NBNK1000
          MATCH     "1",RCBNSTAT            * check if cancelled
          GOTO      NBNK1000 IF EQUAL
.
          ADD       RCDTAMNT,NBNKDEPS
          GOTO      NBNK1000
.
NBNK9999  RETURN
+
.**********************************************************************
.*                                GETS0000                            *
.*       Routine to get the service time for the invoice from the     *
.*       first transaction on the debtors transaction file            *
.**********************************************************************
GETS0000  PACK      KEY24,VDEBTOR,VSCANPMI,PRINNUMB,SP6
          CALL      RSPRDT3                 * get the first record on the 
          CALL      RKPRDT3                   debtors transaction file
          BRANCH    OVRCD,GETS9000
.
          MATCH     VDEBTOR,PRDTDEBT        * compare debtor numbers
          GOTO      GETS9000 IF NOT EQUAL
.
          COMPARE   VSCANPMI,PRDTSCAN       * compare scan flags
          GOTO      GETS9000 IF NOT EQUAL
.
          MATCH     PRINNUMB,PRDTINVN       * match invoice numbers
          GOTO      GETS9999 IF EQUAL
.
.------ we could not get the first debtors transaction record ------
.
GETS9000  MOVE      SP6,PRDTSTIM
.
GETS9999  RETURN
+
.**********************************************************************
.*                               GETC0000                             *
.*     Routine to get the claim details to print if required          *
.**********************************************************************
GETC0000  MOVE      ZERO,COUNTR
          MOVE      SP3,CLAIMTYP
          MOVE      SP20,CLAIMNUM
          MOVE      SP10,CLAIMDTE
          MOVE      SP30,EMPLNAME
.
          MATCH     SP3,PRINCLAM            * see if the claim type exists
          GOTO      GETC9999 IF EQUAL
.
          PACK      KEY5,CODECL,PRINCLAM
          CALL      RDCODE1                 * read the patient codes file
          BRANCH    OVRCD,GETC9999
.
.------ check the next patient indicator ------
.
GETC1000  ADD       ONE,COUNTR
.
          COMPARE   SIX,COUNTR              * see if no more indicators to
          GOTO      GETC9999 IF EQUAL         process
.
          LOAD      INDICATR,COUNTR,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5
.
          CMATCH    ANSW,INDICATR           * see if we have a workers
          GOTO      GETC2000 IF EQUAL         compensation claim
.
          CMATCH    ANSM,INDICATR           * see if we have a M.A.B. claim
          GOTO      GETC3000 IF EQUAL         
.
          CMATCH    ANSV,INDICATR           * see if we have a veterans affairs
          GOTO      GETC4000 IF EQUAL         claim
          GOTO      GETC1000
.
. ------- Workers Compensation -------
.
GETC2000  OPEN      PRIWCOM1,"priwcomf"
          PACK      KEY16,PRCNINVN,PRINCNUM
          CALL      RDPRWC1                 * read the workers compensation
          BRANCH    OVRCD,GETC2999            claim file
.         
          MATCH     SP3,CLAIMTYP
          GOTO      GETC2999 IF NOT EQUAL
          MOVE      "WC ",CLAIMTYP
          MOVE      PRWCCLMN,CLAIMNUM
          MOVE      PRWCNAME,EMPLNAME
.
          MATCH     SP8,PRINADTE
          GOTO      GETC2999 IF EQUAL
.
          UNPACK    PRINADTE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE                 * pack the date
          MOVE      CPCDATE,CLAIMDTE
.
.------ close the workers compensation claim file ------
.
GETC2999  CLOSE     PRIWCOM1
          GOTO      GETC1000
.
. ------- Motor Accident Board -------
.
GETC3000  OPEN      PRIMABD1,"primabdf"
          PACK      KEY16,PRCNINVN,PRINCNUM
          CALL      RDPRMA1                 * read the transport accident 
          BRANCH    OVRCD,GETC3999            commission file
.         
          MATCH     SP3,CLAIMTYP
          GOTO      GETC3999 IF NOT EQUAL
          MOVE      "TAC",CLAIMTYP
          MOVE      PRMAREFN,CLAIMNUM
.
          MATCH     SP8,PRINADTE
          GOTO      GETC3999 IF EQUAL
.
          UNPACK    PRINADTE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE                 * pack the date
          MOVE      CPCDATE,CLAIMDTE
.
.------ close the transport accident commission file ------
.
GETC3999  CLOSE     PRIMABD1
          GOTO      GETC1000
.
. ------- Veterans Affairs -------
.
GETC4000  OPEN      PRIVAFD1,"privafdf"
          PACK      KEY16,PRCNINVN,PRINCNUM
          CALL      RDPRVA1                 * read the veterans affairs file
          BRANCH    OVRCD,GETC4999
.
          MATCH     SP3,CLAIMTYP
          GOTO      GETC4999 IF NOT EQUAL
          MOVE      "VA ",CLAIMTYP
          MOVE      PRVACLAM,CLAIMNUM
.
.------ close the veterans affairs file ------
.
GETC4999  CLOSE     PRIVAFD1
          GOTO      GETC1000
.
GETC9999  RETURN
+
.*****************************************************************************
.*                               GPRA0000              Called by: PRAC0000   *
.*                       input start medical practice code                   *
.* Returns:          EXIT  0 = valid code input                              *
.*                         1 = exitchar input                                *
.*****************************************************************************
.
GPRA0000  MOVE      CVERT,SVERT
          KEYIN     *PCCOL:CVERT,*DV,UNDLN6:
                    *PCCOL:CVERT,*V2LON,MPRAC:
                    *PCCOL:CVERT,*DV,MPRAC
.
          CALL      CHK0000                      * see what was entered
          BRANCH    EXIT,GPRA5000:               * nothing entered
                         GPRA4000:               * ? entered
                         GPRA9500:               * exitchar input
                         GPRA8000                * valid input
.
          GOTO      GPRA0000                     * invalid input
.
GPRA4000  MOVE      ZERO,HLEF
          CALL      GETSCR00                     * save screen
GPRA4200  CALL      PRIPRADS                     * list codes on file
.
GPRA4500  DISPLAY   *P1:24,*EL,FROMTO," Medical Practice : "
          KEYIN     *P25:24,*DV,UNDLN6:
                    *P25:24,*V2LON,MPRAC:
                    *P25:24,*DV,MPRAC
.
          CALL      CHK0000                      * see what was entered
          BRANCH    EXIT,GPRA4900:               * nothing entered
                         GPRA4200:               * ? entered
                         GPRA9400:               * exitchar input
                         GPRA7900                * valid input
.
          GOTO      GPRA4500                     * invalid input
.
GPRA4900  CALL      PUTSCR00                     * restore screen
GPRA5000  MOVE      SP6,MPRAC
          GOTO      GPRA8500
.
GPRA7900  CALL      PUTSCR00                     * restore screen
          MOVE      SVERT,CVERT
          DISPLAY   *PCCOL:CVERT,*V2LON,MPRAC
GPRA8000  MOVE      TEN,FORM2
          ADD       CCOL,FORM2
          DISPLAY   *PFORM2:CVERT,PRPRDESC
.
GPRA8500  MOVE      ZERO,EXIT
          GOTO      GPRA9999
.
GPRA9400  CALL      FRESCR00
GPRA9500  MOVE      ONE,EXIT
.
GPRA9999  RETURN
+
.**************************************************************************
.*                              CHK0000                Called by: GPRA0000*
.*                see what was input for medical practice                 *
.* Returns:           EXIT   0 = invalid input                            *
.*                           1 = nothing input                            *
.*                           2 = ? input                                  *
.*                           3 = exitchar input                           *
.*                           4 = valid input                              *
.**************************************************************************
.
CHK0000  ENDSET     MPRAC
         APPEND     SP6,MPRAC
         RESET      MPRAC
.
         MATCH      SP6,MPRAC                    * anything entered ?
         GOTO       CHK8000 IF EQUAL             * yes
.
         MATCH      EXITCHAR,MPRAC               * exitchar input ?
         GOTO       CHK9000 IF EQUAL             * yes
.
         MATCH      QUEST,MPRAC                  * "?" input ?
         GOTO       CHK8500 IF EQUAL             * yes
.
         MOVE       MPRAC,KEY6
         CALL       RDPRPR1                      * record on file ?
         COMPARE    ZERO,OVRCD
         GOTO       CHK9500 IF EQUAL             * yes
.
         DISPLAY    *P1:24,*EL,*B,"Medical Practice not on file.  ";
         CALL       HITENTER
.
         MOVE       ZERO,EXIT
         GOTO       CHK9999
.
CHK8000  MOVE       ONE,EXIT
         GOTO       CHK9999
.
CHK8500  MOVE       TWO,EXIT
         GOTO       CHK9999
.
CHK9000  MOVE       THREE,EXIT
         GOTO       CHK9999
.
CHK9500  MOVE       FOUR,EXIT
.
CHK9999  RETURN
+
.**********************************************************************
.       Check range of claim code
.******************************************************************************
CRNG0000 MATCH     SP70,STCLM
         IF        !@EQUAL
           MATCH     STCLM,PRINCLAM
           GOTO      CRNG9000 IF LESS
         ENDIF
.
         MATCH     SP70,EDCLM
         IF        !@EQUAL
           MATCH     PRINCLAM,EDCLM
           GOTO      CRNG9000 IF LESS
         ENDIF
.
         MOVE      ZERO,EXIT
         GOTO      CRNG9999
.
CRNG9000 MOVE      ONE,EXIT
CRNG9999 RETURN
+
.**********************************************************************
SCHPRO00
SETDEF00
GETCOD00
OPEN0000
CLOS0000
GETSVAR   RETURN
+
.**********************************************************************
.
          INC       STD001IO
          INC       IBAPRINT
          INC       PATSNDX
          INC       PATSRCH
          INC       PRICALFS
          INC       PRIINVHL
          INC       PRIINVTL
          INC       PRIINVPR
          INC       CLPRIDTR
          INC       PRIKYDEB
          INC       PRIPRADS
          INC       PATCODKY
          INC       SEXDSP00
          INC       TFILENAM                * Generate Temp File Name
.
          INC       WEBERRIO/INC            * Web Server Error Logging
          INC       BOKRC1IO/INC
          INC       IBAPRNIO/INC
          INC       IBATMDIO/INC
          INC       IBATMHIO/INC
          INC       IBAGEDIO/INC
          INC       OUTPREIO/INC
.
          INC       PATCODIO/INC
          INC       PATIN1IO/INC
          INC       PMSHCPIO/INC
          INC       PMSHCLIO/INC
          INC       PMSPX2IO/INC
          INC       PATDRGIO/INC
          INC       PATGSRIO/INC
          INC       PATMA1IO/INC
          INC       PATMESIO/INC
          INC       PATMI1IO/INC
          INC       PMSVX1IO/INC
          INC       PATMWSIO/INC
          INC       PATPERIO/INC
          INC       PATPR1IO/INC
          INC       PATRE1IO/INC
          INC       PATVISIO/INC
.
          INC       HICITIIO/INC                 * HIC items invoice file
          INC       PRICNOIO/INC
          INC       PRIAUIIO/INC
          INC       PRIBULIO/INC
...          INC       PRIDBTIO/INC
          INC       PRIDOCIO/INC
          INC       PRIDTRIO/INC
          INC       PRIECTIO/INC
          INC       PRIEXCIO/INC                 * execption charges file
          INC       PRIFIGIO/INC
          INC       PRIFINIO/INC
          INC       PRIGRPIO/INC
          INC       PRIHDBIO/INC
          INC       PRIHISIO/INC
          INC       PRIHOLIO/INC
          INC       PRIHREIO/INC
          INC       PRIHTRIO/INC
          INC       PRIINVIO/INC
          INC       PRIINVIT/INC
          INC       PRIITMIO/INC
          INC       PRIMABIO/INC
          INC       PRIMGPIO/INC
          INC       PRIMULIO/INC
          INC       PRIPRAIO/INC
          INC       PRISPTIO/INC                 * spec. path. test file
          INC       PRISTAIO/INC
          INC       PRITESIO/INC
          INC       PRIVAFIO/INC
          INC       PRIWCOIO/INC
          INC       PRIALSIO/INC                 * Medical Prac.all user access
          INC       PRISECIO/INC                 * Medical Prac.security access
          INC       RCPBNKIO/INC
          INC       RCPBDTIO/INC
          INC       RCPREGIO/INC
          INC       RCPDTEIO/INC
          INC       COMDEPIO/INC                 * cash file
          INC       PATSNX2
          INC       PATGBCRN    
          INC       NZIBSRCH
          INC       NZHISIIO
          INC       CLPATMAS
          INC       CALCAGE
          INC       NHIMASIO/INC                 * NZHIS Variables
.
          INC       PATHSPIO/INC           * Hospital Details for GBCRN000
.
          INC       WEBIMCIO/INC
          INC       WEBB2BIO/INC

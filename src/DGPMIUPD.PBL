.**************************************************************************
.*  DGPMIUPD  :  Update PMI details for a Datagate request                *
.*               ~~~~~~~~~~~~~~~~~~                                       *
.*                                                                        *
.*  Author    :  ROD   (24/11/95)                                         *
.*  Mods      :                                                           *
.*           V11.04.01 05.02.2024  DA Sarkies      TSK 0936282            *
.*                     Fixed code to allow for 19 digit Health Fund Number*
.**************************************************************************
.*           V10.06.01 12/03/2015  Steve Armstrong CAR 314108             *
.*                     Removed reference to PATCGPFD (no longer in use)   *
.**************************************************************************
.*           V10.02.01 07/07/2011  Steve Armstrong CAR 240722             *
.*                     Added read of pmspx2af record prior to calling     *
.*                     UPDUR.                                             *
.*                     Mods to load extended surname & given name fields. *
.**************************************************************************
.*            V9.04.01 16/03/2005  Steve Armstrong CAR 59565              *
.*                     Added code to handle "" in a field to blank out    *
.*                     existing PMI data.                                 *
.**************************************************************************
.*            V9.02.03 14/11/2002  Davin                                  *
.*                     Removed reference to $$DBASE WEB compile option    *
.*            V9.02.02  22/04/2002  Mike Laming                           *
.*                     Replace PMEDI with Composite variable PMEDIXX      *
.*                     (which contains PMEDI+PTMXMCCD) Add call (SPLTPMED)*
.*                     to split these                                     *
.*            V9.02.01 26/09/2001 (18/06/2001)  Mike Laming               *
.*                     Add fields from PMI Master Extension 2 - PMSPX2    *
.*                     data fields PMPXINTR -> PMPXFREL (for RCH & SVHM)  *
.*                     for WEB based versions only                        *
.**************************************************************************
.*            V5.07.05 18/02/2000  Steve Armstrong                        *
.*                     Fixed setting of RPLYCODE to "00000" when no       *
.*                     error occurs.                                      *
.*            V5.07.04 15/12/1999  Steve Armstrong                        *
.*                     Mods to process messages from Eclipse Direct       *
.*                     interface (ECSRVPMI).                              *
.*            V5.07.03 08/09/1999  Steve Armstrong                        *
.*                     Added clear of brthdate so previous DOB's aren't   *
.*                     carried over to the next record                    *
.*            V5.07.02 17/08/1999  Steve Armstrong                        *
.*                     Mods for null dates & nul ethnicity (from Eclipse) *
.*            V5.07.01 22/12/1998  Davin                                  *
.*                     Y2K mods                                           *
.*            V5.07.00 26/10/1998  Davin                                  *
.*                     Mods for 507                                       *
.**************************************************************************
.*            V5.05.03 12/03/1998  Steve Armstrong     HWK                *
.*                     Mods to capture 3 ethnicity fields                 *
.*            V5.05.02 11/03/1998  Steve Armstrong                        *
.*                     Fixed setting of birthdate after VALID000          *
.*            V5.05.01 13/09/1997  Steve Armstrong                        *
.*                     Mods for new Master extension file variables       *
.*                     (PTMXOPER - PTMXPOST)                              *
.**************************************************************************
.*            V5.04.01 16/04/1997  Steve Armstrong                        *
.*                     Mods to use separate inbound & outbound comms      *
.*                     clients for PMI requests (DGATEIN/DGATEOUT)        *
.**************************************************************************
          DEFPROC   DGPMIUPD
.
          INC       PATPA1FD/INC
          INC       PATMI1FD/INC
          INC       NHIETHFD/INC
          INC       NHIMASFD/INC
          INC       PATPR1FD/INC
          INC       PATCALAG/INC
          INC       PATDHEAD/INC
          INC       PATRE1FD/INC
          INC       PATAK1FD/INC
.
BJDAY     FORM      3
CJDAY     FORM      3
COUNTR    FORM      1
EFFDATGP  DIM       8
ETHNIC1   DIM       2
ETHNIC2   DIM       2
ETHNIC3   DIM       2
KEEPOLAL  FORM      1
POSITN1   FORM      1
POSITN2   FORM      2
SURSYST   FORM      1
+
.*************************************************************************
.*  DGPMIUPD  :  Process datagate Update PMI details message             *
.*************************************************************************
DGPMIUPD  MOVE      "UPD",RPLYHEAD

          MATCH     "ECSRVPMI",PRGID
          IF        !@EQUAL
            READ      DGATEOUT;PURNO;             * read U/R number
          ENDIF
.
          CALL      VALID000                      * validate U/R number
          BRANCH    EXIT,DGUPD900                 * error
.
. the *SB will suppress the blank fill of fields so that if a field is null,
. then the field will remain as it was. This way, only fields that have
. changed, need to be sent.
.
          CLEAR     ETHNIC1
          CLEAR     ETHNIC2
          CLEAR     ETHNIC3
.
          MATCH     "ECSRVPMI",PRGID
          IF        !@EQUAL
.
            READ      DGATEOUT;*SB,PTITL,PHOSP,PLDAYS,PBDEBT,PSNAME,PGNAME:
                            PPSNAME,PADD1,PADD2,PSUBRB,PADD4,PPOST,PTELEP:
                            PTELEB,PSEX,PMSTAT,PBDATE,PCONT,PREG,PTYPE,POCCUP:
                            PLDDATE,PMEDIXX,PPENNO,PPNDTE,PREPAT,PSMOK,PMICRO:
                            PCEASE,PCASE,PAUTOPY,PHIGH1,PHIGH2,PHIGH3:
                            PLOCDOC,PFUNDH,PFNDTB,PFNDMM,PUSR1,PUSR2,PUSR3:
                            PUSR4,PUSR5,PUSR6,PUYN1,PUYN2,PUYN3,PYRRES:
                            PNKNAME,PNKADD1,PNKADD2,PNKSUBR,PNKADD4,PNKPOST:
                            PNKTELP,PNKTELB,PNKRELP,PFNDYY,PFNDCG,PDECDTE:
                            PDIET,PINITHOS,PHKADUNI,PTMAEMPC,PTMANOKO:
                            PTMANOKE,PTMADCNO,PTMXRDAT,PTMXMEAL,PTMXLGA:
                            PTMXLS,PTMXLSDT,PTMXFHMD,PTMXMHU1,PTMXMHU2:
                            PTMXMHU3,PTMXECNM,PTMXECA1,PTMXECA2,PTMXECA3:
                            PTMXECA4,PTMXECPC,PTMXECPP,PTMXECBP,PTMXECRE:
                            PTMXNRNM,PTMXNRA1,PTMXNRA2,PTMXNRA3,PTMXNRA4:
                            PTMXNRPC,PTMXNRPP,PTMXNRBP,PTMXNRRE,PTMX3BEX:
                            PTMXCARD,PTMXCEXP,PTMXCXMP,PTMXFMLY,PTMXCHNM:
                            PTMXDOFR,PMPXRHC1,PMPXRH1G,PTMXSPID,PMPXR1GC:
                            PTMXOSDT,PTNINMPI,KEEPOLAL,EFFDATGP:
                            PTMXOPER,PTMXUKDO,PTMXCELL,PTMXADD1,PTMXADD2:
                            PTMXADD3,PTMXADD4,PTMXPOST,ETHNIC1,ETHNIC2,ETHNIC3:
                            PMPXINTR,PMPXLNG1,PMPXLNG2,PMPXLNG3,PMPXPEML:
                            PMPXEDOB,PMPXCMOB,PMPXCEML,PMPXCCRP,PMPXKMOB:
                            PMPXKEML,PMPXKCRP,PMPXRMOB,PMPXREML,PMPXRCRP:
                            PMPXMEDC,PMPXDETY,PMPXPRIS,PMPXCSER,PMPXPHEI:
                            PMPXPWEI,PMPXDREC,PMPXDVAC,PMPXPNSD,PMPXUYN4:
                            PMPXUYN5,PMPXUYN6,PMPXABRG,PMPXPRVI,PMPXCRIN:
                            PMPXHOML,PMPXUDC1,PMPXUDC2,PMPXUDC3,PMPXUSR7:
                            PMPXUSR8,PMPXUSR9,PMPXMSNA,PMPXMGNA,PMPXMTLE:
                            PMPXMAD1,PMPXMAD2,PMPXMAD3,PMPXMAD4,PMPXMPOS:
                            PMPXMPNO,PMPXMBNO,PMPXMMNO,PMPXMEML,PMPXMCNT:
                            PMPXMCRP,PMPXMLAB,PMPXMREL,PMPXFSNA,PMPXFGNA:
                            PMPXFTLE,PMPXFAD1,PMPXFAD2,PMPXFAD3,PMPXFAD4:
                            PMPXFPOS,PMPXFPNO,PMPXFBNO,PMPXFMNO,PMPXFEML:
                            PMPXFCNT,PMPXFCRP,PMPXFLAB,PMPXFREL
.
            CALL      SPLTPMED              * Split PMEDIXX into PMEDI, PTMXMCCD.
            PACK      PTMASNAM,PSNAME,SP70
            PACK      FULLGNAM,PGNAME,SP70,SP70
            CALL      SEPRNAME
            PACK      PMPXFNAM,FRSTGNAM,SP70
            PACK      PMPXSNAM,SCNDGNAM,SP70
.
            CALL      VALETH00                    * validate ethnicity
            BRANCH    EXIT,DGUPD910               * error
.
            CALL      CHKBL000                    * check for blank char fields
            BRANCH    EXIT,DGUPD910               * error
          ELSE
            CALL      SETECL00                    * set fields from Eclipse
          ENDIF
.
          MOVE      ZERO,CSALIAS                  * assume not keeping as alias
          IF        KEEPOLAL=1
            MOVE      TWO,CSALIAS                 * keep but dont ask question
          ENDIF
.
.         Update details
.
          CALL      UPDUR
.
          MATCH     "ECSRVPMI",PRGID
          IF        !@EQUAL
            CALL      UPETH000                   * update ethnicity
          ENDIF
.
. send reply message as successful
.     NB.  SP1 at end of reply has been added because the interpreter does
.     not place a "|" after the last field, and Datagate requires this.  By
.     putting an extra field on the end (which is blank), a "|" will then
.     be added after the last field.
.
          MOVE      "00000",RPLYCODE              * successful message
          MATCH     "ECSRVPMI",PRGID
          IF        !@EQUAL
            MOVE      SP50,RPLYDESC               * clear error description
            PACK      CCENCODE,CCDATE,CCDST,CCSRC,CCNAME,REPLYRPL
            WRITE     DGATEIN;CCENCODE:
                            RPLYHEAD,RPLYCODE,RPLYDESC,DGMISC1:
                            DGMISC2,DGMISC3,SP1
          ENDIF
.
          ADD       ONE,SUCCPROC                  * increm # success transactns
          GOTO      DGUPD999
.
. --- send back an Error response ---
.
DGUPD900  MATCH     "ECSRVPMI",PRGID
          IF        !@EQUAL
            READ      DGATEOUT;CDGMBUFF           * clear message buffer
          ENDIF
.
DGUPD910  MATCH     "ECSRVPMI",PRGID
          IF        !@EQUAL
            PACK      CCENCODE,CCDATE,CCDST,CCSRC,CCNAME,REPLYRPL
            WRITE     DGATEIN;CCENCODE:
                               RPLYHEAD,RPLYCODE,RPLYDESC,DGMISC1:
                               DGMISC2,DGMISC3,SP1
          ENDIF
          ADD       ONE,ERRRPROC                  * increm # error transactions
.
DGUPD999  GOTO      DGUPDEND                      * got end of procedure
+
.***************************************************************************
.*                           SETECL00                                      *
.*         Update the relevant PMI fields if the update flag is not "{{"   *
.***************************************************************************
.
SETECL00    MATCH     UPDFLAG,ECINTITL
            IF        !@EQUAL
              MOVE      ECINTITL,PTITL
            ENDIF
.
            MATCH     UPDFLAG,ECINDEBT
            IF        !@EQUAL
              MOVE      ECINDEBT,PBDEBT
            ENDIF
.
            MATCH     UPDFLAG,ECINSNAM
            IF        !@EQUAL
              MOVE      ECINSNAM,PSNAME
            ENDIF
.
            MATCH     UPDFLAG,ECINGNAM
            IF        !@EQUAL
              MOVE      ECINGNAM,PGNAME
            ENDIF
.
            MATCH     UPDFLAG,ECINADD1
            IF        !@EQUAL
              MOVE      ECINADD1,PADD1
            ENDIF
.
            MATCH     UPDFLAG,ECINADD2
            IF        !@EQUAL
              MOVE      ECINADD2,PADD2
            ENDIF
.
            MATCH     UPDFLAG,ECINADD3
            IF        !@EQUAL
              MOVE      ECINADD3,PSUBRB
            ENDIF
.
            MATCH     UPDFLAG,ECINADD4
            IF        !@EQUAL
              MOVE      ECINADD4,PADD4
            ENDIF
.
            MATCH     UPDFLAG,ECINPOST
            IF        !@EQUAL
              MOVE      ECINPOST,PPOST
            ENDIF
.
            MATCH     UPDFLAG,ECINPTEL
            IF        !@EQUAL
              MOVE      ECINPTEL,PTELEP
            ENDIF
.
            MATCH     UPDFLAG,ECINBTEL
            IF        !@EQUAL
              MOVE      ECINBTEL,PTELEB
            ENDIF
.
            MATCH     UPDFLAG,ECINPSEX
            IF        !@EQUAL
              MOVE      ECINPSEX,PSEX
            ENDIF
.
            MATCH     UPDFLAG,ECINMSTA
            IF        !@EQUAL
              MOVE      ECINMSTA,PMSTAT
            ENDIF
.
            MATCH     UPDFLAG,ECINPDOB
            IF        !@EQUAL
              MOVE      ECINPDOB,PBDATE
            ENDIF
.
            MATCH     UPDFLAG,ECINCONT
            IF        !@EQUAL
              MOVE      ECINCONT,PCONT
            ENDIF
.
            MATCH     UPDFLAG,ECINPREG
            IF        !@EQUAL
              MOVE      ECINPREG,PREG
            ENDIF
.
            MATCH     UPDFLAG,ECINPTYP
            IF        !@EQUAL
              MOVE      ECINPTYP,PTYPE
            ENDIF
.
            MATCH     UPDFLAG,ECINOCCP
            IF        !@EQUAL
              MOVE      ECINOCCP,POCCUP
            ENDIF
.
            MATCH     UPDFLAG,ECINSMOK
            IF        !@EQUAL
              MOVE      ECINSMOK,PSMOK
            ENDIF
.
            MATCH     UPDFLAG,ECINCEAS
            IF        !@EQUAL
              MOVE      ECINCEAS,PCEASE
            ENDIF
.
            MATCH     UPDFLAG,ECINCASE
            IF        !@EQUAL
              MOVE      ECINCASE,PCASE
            ENDIF
.
            MATCH     UPDFLAG,ECINAUTO
            IF        !@EQUAL
              MOVE      ECINAUTO,PAUTOPY
            ENDIF
.
            MATCH     UPDFLAG,ECINLDOC
            IF        !@EQUAL
              MOVE      ECINLDOC,PLOCDOC
            ENDIF
.
            MATCH     UPDFLAG,ECINHFND
            IF        !@EQUAL
              MOVE      ECINHFND,PFUNDH
            ENDIF
.
            MATCH     UPDFLAG,ECINFTBL
            IF        !@EQUAL
              MOVE      ECINFTBL,PFNDTB
            ENDIF
.
            MATCH     UPDFLAG,ECINFMEM
            IF        !@EQUAL
              MOVE      ECINFMEM,PFNDMM
            ENDIF
.
            MATCH     UPDFLAG,ECINYRES
            IF        !@EQUAL
              MOVE      ECINYRES,PYRRES
            ENDIF
.
            MATCH     UPDFLAG,ECINNNAM
            IF        !@EQUAL
              MOVE      ECINNNAM,PNKNAME
            ENDIF
.
            MATCH     UPDFLAG,ECINNAD1
            IF        !@EQUAL
              MOVE      ECINNAD1,PNKADD1
            ENDIF
.
            MATCH     UPDFLAG,ECINNAD2
            IF        !@EQUAL
              MOVE      ECINNAD2,PNKADD2
            ENDIF
.
            MATCH     UPDFLAG,ECINNAD3
            IF        !@EQUAL
              MOVE      ECINNAD3,PNKSUBR
            ENDIF
.
            MATCH     UPDFLAG,ECINNAD4
            IF        !@EQUAL
              MOVE      ECINNAD4,PNKADD4
            ENDIF
.
            MATCH     UPDFLAG,ECINNPOS
            IF        !@EQUAL
              MOVE      ECINNPOS,PNKPOST
            ENDIF
.
            MATCH     UPDFLAG,ECINNPTL
            IF        !@EQUAL
              MOVE      ECINNPTL,PNKTELP
            ENDIF
.
            MATCH     UPDFLAG,ECINNBTL
            IF        !@EQUAL
              MOVE      ECINNBTL,PNKTELB
            ENDIF
.
            MATCH     UPDFLAG,ECINNREL
            IF        !@EQUAL
              MOVE      ECINNREL,PNKRELP
            ENDIF
.
            MATCH     UPDFLAG,ECINYRSM
            IF        !@EQUAL
              MOVE      ECINYRSM,PFNDYY
            ENDIF
.
            MATCH     UPDFLAG,ECINFCHG
            IF        !@EQUAL
              MOVE      ECINFCHG,PFNDCG
            ENDIF
.
            MATCH     UPDFLAG,ECINDDAT
            IF        !@EQUAL
              MOVE      ECINDDAT,PDECDTE
            ENDIF
.
            MATCH     UPDFLAG,ECINDIET
            IF        !@EQUAL
              MOVE      ECINDIET,PDIET
            ENDIF
.
            MATCH     UPDFLAG,ECINDCNO
            IF        !@EQUAL
              MOVE      ECINDCNO,PTMADCNO
            ENDIF
.
            MATCH     UPDFLAG,ECINRDAT
            IF        !@EQUAL
              MOVE      ECINRDAT,PTMXRDAT
            ENDIF
.
            MATCH     UPDFLAG,ECINMEAL
            IF        !@EQUAL
              MOVE      ECINMEAL,PTMXMEAL
            ENDIF
.
            MATCH     UPDFLAG,ECINFHMD
            IF        !@EQUAL
              MOVE      ECINFHMD,PTMXFHMD
            ENDIF
.
            MATCH     UPDFLAG,ECINECNM
            IF        !@EQUAL
              MOVE      ECINECNM,PTMXECNM
            ENDIF
.
            MATCH     UPDFLAG,ECINECA1
            IF        !@EQUAL
              MOVE      ECINECA1,PTMXECA1
            ENDIF
.
            MATCH     UPDFLAG,ECINECA2
            IF        !@EQUAL
              MOVE      ECINECA2,PTMXECA2
            ENDIF
.
            MATCH     UPDFLAG,ECINECA3
            IF        !@EQUAL
              MOVE      ECINECA3,PTMXECA3
            ENDIF
.
            MATCH     UPDFLAG,ECINECA4
            IF        !@EQUAL
              MOVE      ECINECA4,PTMXECA4
            ENDIF
.
            MATCH     UPDFLAG,ECINECPC
            IF        !@EQUAL
              MOVE      ECINECPC,PTMXECPC
            ENDIF
.
            MATCH     UPDFLAG,ECINECPP
            IF        !@EQUAL
              MOVE      ECINECPP,PTMXECPP
            ENDIF
.
            MATCH     UPDFLAG,ECINECBP
            IF        !@EQUAL
              MOVE      ECINECBP,PTMXECBP
            ENDIF
.
            MATCH     UPDFLAG,ECINECRE
            IF        !@EQUAL
              MOVE      ECINECRE,PTMXECRE
            ENDIF
.
            MATCH     UPDFLAG,ECINNRNM
            IF        !@EQUAL
              MOVE      ECINNRNM,PTMXNRNM
            ENDIF
.
            MATCH     UPDFLAG,ECINNRA1
            IF        !@EQUAL
              MOVE      ECINNRA1,PTMXNRA1
            ENDIF
.
            MATCH     UPDFLAG,ECINNRA2
            IF        !@EQUAL
              MOVE      ECINNRA2,PTMXNRA2
            ENDIF
.
            MATCH     UPDFLAG,ECINNRA3
            IF        !@EQUAL
              MOVE      ECINNRA3,PTMXNRA3
            ENDIF
.
            MATCH     UPDFLAG,ECINNRA4
            IF        !@EQUAL
              MOVE      ECINNRA4,PTMXNRA4
            ENDIF
.
            MATCH     UPDFLAG,ECINNRPC
            IF        !@EQUAL
              MOVE      ECINNRPC,PTMXNRPC
            ENDIF
.
            MATCH     UPDFLAG,ECINNRPP
            IF        !@EQUAL
              MOVE      ECINNRPP,PTMXNRPP
            ENDIF
.
            MATCH     UPDFLAG,ECINNRBP
            IF        !@EQUAL
              MOVE      ECINNRBP,PTMXNRBP
            ENDIF
.
            MATCH     UPDFLAG,ECINNRRE
            IF        !@EQUAL
              MOVE      ECINNRRE,PTMXNRRE
            ENDIF
.
            MATCH     UPDFLAG,ECINCARD
            IF        !@EQUAL
              MOVE      ECINCARD,PTMXCARD
            ENDIF
.
            MATCH     UPDFLAG,ECINCEXP
            IF        !@EQUAL
              MOVE      ECINCEXP,PTMXCEXP
            ENDIF
.
            MATCH     UPDFLAG,ECINCXMP
            IF        !@EQUAL
              MOVE      ECINCXMP,PTMXCXMP
            ENDIF
.
            MATCH     UPDFLAG,ECINFMLY
            IF        !@EQUAL
              MOVE      ECINFMLY,PTMXFMLY
            ENDIF
.
            MATCH     UPDFLAG,ECINREGP
            IF        !@EQUAL
              MOVE      ECINREGP,PMPXRHC1
            ENDIF
.
            MATCH     UPDFLAG,ECINGPPC
            IF        !@EQUAL
              MOVE      ECINGPPC,PMPXRH1G
            ENDIF
.
            MATCH     UPDFLAG,ECINOSDT
            IF        !@EQUAL
              MOVE      ECINOSDT,PTMXOSDT
            ENDIF
.
SETECL99  RETURN
+
.***************************************************************************
.*  VALID000  :  read patients details & make sure we have a valid patient *
.*               Returns:  EXIT=0 --> Valid patient,   EXIT=1 --> ERROR    *
.***************************************************************************
VALID000  MOVE      PURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD,VALID850                * no master details
.
          MOVE      PURNO,KEY8
          CALL      RDPMPX21
          BRANCH    OVRCD,VALID850
.
          CALL      SVMAS000                      * save old master file vars
.
          MOVE      ZERO,EXIT                     * we have a valid patient
          GOTO      VALID999
.
VALID850  MOVE      "Patient Master details not found",RPLYDESC
          MOVE      "01100",RPLYCODE
          MOVE      ONE,EXIT
          GOTO      VALID999
.
VALID999  RETURN
+
.***************************************************************************
.*  VALETH00  :  make sure that the ethnicity codes passed are valid       *
.*               Returns:  EXIT=0 --> Valid code,      EXIT=1 --> ERROR    *
.***************************************************************************
.
VALETH00  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,TWENTY1;*138,PTCNNHII
.
          COMPARE   ONE,PTCNNHII                 * nhi on ?
          GOTO      VALETH10 IF NOT EQUAL        * no - ignore
.
          OPEN      NHIETHA1,"nhiethaf"
          MOVE      ZERO,COUNTR                  * initialise counter
          WHILE     COUNTR < 3
            ADD       ONE,COUNTR                 * increment counter
            LOAD      KEY2,COUNTR,ETHNIC1,ETHNIC2,ETHNIC3
            MOVEFPTR  KEY2,POSITN1
            MOVELPTR  KEY2,POSITN2
            IF        POSITN1 <> 0 & POSITN2 <> 0
              MATCH     SP2,KEY2
              IF        !@EQUAL
                CALL      RDNHETH1               * ethnicity code on file ?
                BRANCH    OVRCD,VALETH50         * no - error
              ENDIF
            ENDIF
          DO
.
VALETH10  MOVE      ZERO,EXIT                     * ethnicity codes are valid
          GOTO      VALETH90
.
VALETH50  MOVE      "Ethnicity Code not on file",RPLYDESC
          MOVE      "01204",RPLYCODE
          MOVE      ONE,EXIT
.
VALETH90  CLOSE     NHIETHA1
.
VALETH99  RETURN
+
.***************************************************************************
.*                          UPETH000                                       *
.*          Update the Ethnicity fields in the NHI master record           *
.***************************************************************************
.
UPETH000  OPEN      NHIMASA1,"nhimasaf"
          OPEN      NHIMASA2,"nhimasaf"
.
          MOVE      PURNO,KEY8
          CALL      RDNHMAS2                     * nhi master record on file ?
          BRANCH    OVRCD,UPETH999               * no - ignore
.
          MOVE      NHMANMPI,KEY7
          CALL      RDNHMAS1                     * read on index 1
          BRANCH    OVRCD,UPETH999               * shouldn't happen
.
.         Check if ethnicity is null and if so, don't update
.
          MOVEFPTR  ETHNIC1,POSITN1
          MOVELPTR  ETHNIC1,POSITN2
          IF        POSITN1 <> 0 & POSITN2 <> 0
            MOVE      ETHNIC1,NHMAETH              * yes - update ethnicity
          ENDIF
.
          MOVEFPTR  ETHNIC2,POSITN1
          MOVELPTR  ETHNIC2,POSITN2
          IF        POSITN1 <> 0 & POSITN2 <> 0
            MOVE      ETHNIC2,NHMAETH2             * yes - update ethnicity
          ENDIF
.
          MOVEFPTR  ETHNIC3,POSITN1
          MOVELPTR  ETHNIC3,POSITN2
          IF        POSITN1 <> 0 & POSITN2 <> 0
            MOVE      ETHNIC3,NHMAETH3             * yes - update ethnicity
          ENDIF
.
          CALL      UPNHMAS1                     * update record
.
UPETH999  RETURN
+
.*****************************************************************************
.*                              CHKBL000           Called by:                *
.*                    Check for field blanking                               *
.*    If a character PMI field contains "", then this indicates that the     *
.*    field should be filled with blanks.                                    *
.* Returns:   EXIT  0 = Ok to continue                                       *
.*                  1 = Mandatory field not populated                        *
.*            RPLYCODE - Error number where EXIT = 1                         *
.*            RPLYDESC - Error text where EXIT = 1                           *
.*****************************************************************************
.
CHKBL000  MATCH     DBLQUOTE,PTITL
          IF        @EQUAL
            MOVE      "Patient title cannot be blank",RPLYDESC
            MOVE      "01160",RPLYCODE
            GOTO      CHKBL910
          ENDIF
.
          MATCH     DBLQUOTE,PSNAME
          IF        @EQUAL
            MOVE      "Patient surname cannot be blank",RPLYDESC
            MOVE      "01161",RPLYCODE
            GOTO      CHKBL910
          ENDIF
.
          MATCH     DBLQUOTE,PGNAME
          IF        @EQUAL
            MOVE      "Patient given name cannot be blank",RPLYDESC
            MOVE      "01162",RPLYCODE
            GOTO      CHKBL910
          ENDIF
.
          MATCH     DBLQUOTE,PPSNAME
          IF        @EQUAL
            MOVE      SP20,PPSNAME
          ENDIF
.
          MATCH     DBLQUOTE,PADD1
          IF        @EQUAL
            PACK      PADD1,SP30,SP30
          ENDIF
.
          MATCH     DBLQUOTE,PADD2
          IF        @EQUAL
            PACK      PADD2,SP30,SP30
          ENDIF
.
          MATCH     DBLQUOTE,PSUBRB
          IF        @EQUAL
            PACK      PSUBRB,SP30,SP30
          ENDIF
.
          MATCH     DBLQUOTE,PADD4
          IF        @EQUAL
            PACK      PADD4,SP30,SP30
          ENDIF
.
          MATCH     DBLQUOTE,PPOST
          IF        @EQUAL
            MOVE      SP20,PPOST
          ENDIF
.
          MATCH     DBLQUOTE,PTELEP
          IF        @EQUAL
            MOVE      SP20,PTELEP
          ENDIF
.
          MATCH     DBLQUOTE,PTELEB
          IF        @EQUAL
            MOVE      SP20,PTELEB
          ENDIF
.
          MATCH     DBLQUOTE,PSEX
          IF        @EQUAL
            MOVE      "Patient sex cannot be blank",RPLYDESC
            MOVE      "01164",RPLYCODE
            GOTO      CHKBL910
          ENDIF
.
          MATCH     DBLQUOTE,PMSTAT
          IF        @EQUAL
            MOVE      SP3,PMSTAT
          ENDIF
.
          MATCH     DBLQUOTE,PBDATE
          IF        @EQUAL
            MOVE      "Patient dob cannot be blank",RPLYDESC
            MOVE      "01163",RPLYCODE
            GOTO      CHKBL910
          ENDIF
.
          MATCH     DBLQUOTE,PCONT
          IF        @EQUAL
            MOVE      SP3,PCONT
          ENDIF
.
          MATCH     DBLQUOTE,PREG
          IF        @EQUAL
            MOVE      SP3,PREG
          ENDIF
.
          MATCH     DBLQUOTE,PTYPE
          IF        @EQUAL
            MOVE      SP3,PTYPE
          ENDIF
.
          MATCH     DBLQUOTE,POCCUP
          IF        @EQUAL
            MOVE      SP20,POCCUP
          ENDIF
.
          MATCH     DBLQUOTE,PLDDATE
          IF        @EQUAL
            MOVE      SP8,PLDDATE
          ENDIF
.
          MATCH     DBLQUOTE,PMEDI
          IF        @EQUAL
            MOVE      SP10,PMEDI
            MOVE      SP2,PTMXMCCD
          ENDIF
.
          MATCH     DBLQUOTE,PPENNO
          IF        @EQUAL
            MOVE      SP20,PPENNO 
          ENDIF
.
          MATCH     DBLQUOTE,PPNDTE
          IF        @EQUAL
            MOVE      SP6,PPNDTE
          ENDIF
.
          MATCH     DBLQUOTE,PREPAT
          IF        @EQUAL
            MOVE      SP10,PREPAT
          ENDIF
.
          MATCH     DBLQUOTE,PMICRO
          IF        @EQUAL
            MOVE      SP20,PMICRO
          ENDIF
.
          MATCH     DBLQUOTE,PHIGH1
          IF        @EQUAL
            MOVE      SP3,PHIGH1
          ENDIF
.
          MATCH     DBLQUOTE,PHIGH2
          IF        @EQUAL
            MOVE      SP3,PHIGH2
          ENDIF
.
          MATCH     DBLQUOTE,PHIGH3
          IF        @EQUAL
            MOVE      SP3,PHIGH3
          ENDIF
.
          MATCH     DBLQUOTE,PLOCDOC
          IF        @EQUAL
            MOVE      SP30,PLOCDOC
          ENDIF
.
          MATCH     DBLQUOTE,PFUNDH
          IF        @EQUAL
            MOVE      SP6,PFUNDH
          ENDIF
.
          MATCH     DBLQUOTE,PFNDTB
          IF        @EQUAL
            MOVE      SP8,PFNDTB
          ENDIF
.
          MATCH     DBLQUOTE,PFNDMM
          IF        @EQUAL
            MOVE      SP70,PFNDMM
          ENDIF
.
          MATCH     DBLQUOTE,PUSR1
          IF        @EQUAL
            MOVE      SP3,PUSR1
          ENDIF
.
          MATCH     DBLQUOTE,PUSR2
          IF        @EQUAL
            MOVE      SP3,PUSR2
          ENDIF
.
          MATCH     DBLQUOTE,PUSR3
          IF        @EQUAL
            MOVE      SP3,PUSR3
          ENDIF
.
          MATCH     DBLQUOTE,PUSR4
          IF        @EQUAL
            MOVE      SP3,PUSR4
          ENDIF
.
          MATCH     DBLQUOTE,PUSR5
          IF        @EQUAL
            MOVE      SP3,PUSR5
          ENDIF
.
          MATCH     DBLQUOTE,PUSR6
          IF        @EQUAL
            MOVE      SP3,PUSR6
          ENDIF
.
          MATCH     DBLQUOTE,PNKNAME
          IF        @EQUAL
            MOVE      SP20,PNKNAME
          ENDIF
.
          MATCH     DBLQUOTE,PNKADD1
          IF        @EQUAL
            PACK      PNKADD1,SP30,SP30
          ENDIF
.
          MATCH     DBLQUOTE,PNKADD2
          IF        @EQUAL
            PACK      PNKADD2,SP30,SP30
          ENDIF
.
          MATCH     DBLQUOTE,PNKSUBR
          IF        @EQUAL
            PACK      PNKSUBR,SP30,SP30
          ENDIF
.
          MATCH     DBLQUOTE,PNKADD4
          IF        @EQUAL
            PACK      PNKADD4,SP30,SP30
          ENDIF
.
          MATCH     DBLQUOTE,PNKPOST
          IF        @EQUAL
            MOVE      SP30,PNKPOST
          ENDIF
.
          MATCH     DBLQUOTE,PNKTELP
          IF        @EQUAL
            MOVE      SP20,PNKTELP
          ENDIF
.
          MATCH     DBLQUOTE,PNKTELB
          IF        @EQUAL
            MOVE      SP20,PNKTELB
          ENDIF
.
          MATCH     DBLQUOTE,PNKRELP
          IF        @EQUAL
            MOVE      SP10,PNKRELP
          ENDIF
.
          MATCH     DBLQUOTE,PFNDYY
          IF        @EQUAL
            MOVE      SP2,PFNDYY
          ENDIF
.
          MATCH     DBLQUOTE,PFNDCG
          IF        @EQUAL
            MOVE      SP6,PFNDCG
          ENDIF
.
          MATCH     DBLQUOTE,PDECDTE
          IF        @EQUAL
            MOVE      SP8,PDECDTE
          ENDIF
.
          MATCH     DBLQUOTE,PDIET
          IF        @EQUAL
            MOVE      SP3,PDIET
          ENDIF
.
          MATCH     DBLQUOTE,PINITHOS
          IF        @EQUAL
            MOVE      SP2,PINITHOS
          ENDIF
.
          MATCH     DBLQUOTE,PHKADUNI
          IF        @EQUAL
            MOVE      SP10,PHKADUNI
          ENDIF
.
          MATCH     DBLQUOTE,PTMAEMPC
          IF        @EQUAL
            MOVE      SP6,PTMAEMPC
          ENDIF
.
          MATCH     DBLQUOTE,PTMANOKO
          IF        @EQUAL
            MOVE      SP20,PTMANOKO
          ENDIF
.
          MATCH     DBLQUOTE,PTMANOKE
          IF        @EQUAL
            MOVE      SP6,PTMANOKE
          ENDIF
.
          MATCH     DBLQUOTE,PTMADCNO
          IF        @EQUAL
            MOVE      SP10,PTMADCNO
          ENDIF
.
          MATCH     DBLQUOTE,PTMXRDAT
          IF        @EQUAL
            MOVE      SP8,PTMXRDAT
          ENDIF
.
          MATCH     DBLQUOTE,PTMXMEAL
          IF        @EQUAL
            MOVE      SP30,PTMXMEAL
          ENDIF
.
          MATCH     DBLQUOTE,PTMXLGA
          IF        @EQUAL
            MOVE      SP4,PTMXLGA
          ENDIF
.
          MATCH     DBLQUOTE,PTMXLS
          IF        @EQUAL
            MOVE      SP3,PTMXLS
          ENDIF
.
          MATCH     DBLQUOTE,PTMXLSDT
          IF        @EQUAL
            MOVE      SP8,PTMXLSDT
          ENDIF
.
          MATCH     DBLQUOTE,PTMXFHMD
          IF        @EQUAL
            MOVE      SP1,PTMXFHMD
          ENDIF
.
          MATCH     DBLQUOTE,PTMXMHU1
          IF        @EQUAL
            MOVE      SP3,PTMXMHU1
          ENDIF
.
          MATCH     DBLQUOTE,PTMXMHU2
          IF        @EQUAL
            MOVE      SP3,PTMXMHU2
          ENDIF
.
          MATCH     DBLQUOTE,PTMXMHU3
          IF        @EQUAL
            MOVE      SP3,PTMXMHU3
          ENDIF
.
          MATCH     DBLQUOTE,PTMXECNM
          IF        @EQUAL
            MOVE      SP20,PTMXECNM
          ENDIF
.
          MATCH     DBLQUOTE,PTMXECA1
          IF        @EQUAL
            PACK      PTMXECA1,SP30,SP5
          ENDIF
.
          MATCH     DBLQUOTE,PTMXECA2
          IF        @EQUAL
            PACK      PTMXECA2,SP30,SP5
          ENDIF
.
          MATCH     DBLQUOTE,PTMXECA3
          IF        @EQUAL
            PACK      PTMXECA3,SP30,SP5
          ENDIF
.
          MATCH     DBLQUOTE,PTMXECA4
          IF        @EQUAL
            PACK      PTMXECA4,SP30,SP5
          ENDIF
.
          MATCH     DBLQUOTE,PTMXECPC
          IF        @EQUAL
            MOVE      SP20,PTMXECPC
          ENDIF
.
          MATCH     DBLQUOTE,PTMXECPP
          IF        @EQUAL
            MOVE      SP20,PTMXECPP
          ENDIF
.
          MATCH     DBLQUOTE,PTMXECBP
          IF        @EQUAL
            MOVE      SP20,PTMXECBP
          ENDIF
.
          MATCH     DBLQUOTE,PTMXECRE
          IF        @EQUAL
            MOVE      SP20,PTMXECRE
          ENDIF
.
          MATCH     DBLQUOTE,PTMXNRNM
          IF        @EQUAL
            MOVE      SP20,PTMXNRNM
          ENDIF
.
          MATCH     DBLQUOTE,PTMXNRA1
          IF        @EQUAL
            PACK      PTMXNRA1,SP30,SP5
          ENDIF
.
          MATCH     DBLQUOTE,PTMXNRA2
          IF        @EQUAL
            PACK      PTMXNRA2,SP30,SP5
          ENDIF
.
          MATCH     DBLQUOTE,PTMXNRA3
          IF        @EQUAL
            PACK      PTMXNRA3,SP30,SP5
          ENDIF
.
          MATCH     DBLQUOTE,PTMXNRA4
          IF        @EQUAL
            PACK      PTMXNRA4,SP30,SP5
          ENDIF
.
          MATCH     DBLQUOTE,PTMXNRPC
          IF        @EQUAL
            MOVE      SP8,PTMXNRPC
          ENDIF
.
          MATCH     DBLQUOTE,PTMXNRPP
          IF        @EQUAL
            MOVE      SP20,PTMXNRPP
          ENDIF
.
          MATCH     DBLQUOTE,PTMXNRBP
          IF        @EQUAL
            MOVE      SP20,PTMXNRBP
          ENDIF
.
          MATCH     DBLQUOTE,PTMXNRRE
          IF        @EQUAL
            MOVE      SP10,PTMXNRRE
          ENDIF
.
          MATCH     DBLQUOTE,PTMX3BEX
          IF        @EQUAL
            MOVE      SP8,PTMX3BEX
          ENDIF
.
          MATCH     DBLQUOTE,PTMXCARD
          IF        @EQUAL
            MOVE      SP20,PTMXCARD
          ENDIF
.
          MATCH     DBLQUOTE,PTMXCEXP
          IF        @EQUAL
            MOVE      SP8,PTMXCEXP
          ENDIF
.
          MATCH     DBLQUOTE,PTMXCXMP
          IF        @EQUAL
            MOVE      SP3,PTMXCXMP
          ENDIF
.
          MATCH     DBLQUOTE,PTMXFMLY
          IF        @EQUAL
            MOVE      SP20,PTMXFMLY
          ENDIF
.
          MATCH     DBLQUOTE,PTMXCHNM
          IF        @EQUAL
            MOVE      SP20,PTMXCHNM
          ENDIF
.
          MATCH     DBLQUOTE,PTMXDOFR
          IF        @EQUAL
            MOVE      SP3,PTMXDOFR
          ENDIF
.
          MATCH     DBLQUOTE,PMPXRHC1
          IF        @EQUAL
            MOVE      SP10,PMPXRHC1
          ENDIF
.
          MATCH     DBLQUOTE,PMPXRH1G
          IF        @EQUAL
            MOVE      SP6,PMPXRH1G
          ENDIF
.
          MATCH     DBLQUOTE,PTMXSPID
          IF        @EQUAL
            MOVE      SP20,PTMXSPID
          ENDIF
.
          MATCH     DBLQUOTE,PMPXR1GC
          IF        @EQUAL
            MOVE      SP2,PMPXR1GC
          ENDIF
.
          MATCH     DBLQUOTE,PTMXOSDT
          IF        @EQUAL
            MOVE      SP10,PTMXOSDT
          ENDIF
.
          MATCH     DBLQUOTE,PTMXOPER
          IF        @EQUAL
            MOVE      SP4,PTMXOPER
          ENDIF
.
          MATCH     DBLQUOTE,PTMXUKDO
          IF        @EQUAL
            MOVE      SP1,PTMXUKDO
          ENDIF
.
          MATCH     DBLQUOTE,PTMXCELL
          IF        @EQUAL
            MOVE      SP20,PTMXCELL
          ENDIF
.
          MATCH     DBLQUOTE,PTMXADD1
          IF        @EQUAL
            PACK      PTMXADD1,SP20,SP20
          ENDIF
.
          MATCH     DBLQUOTE,PTMXADD2
          IF        @EQUAL
            PACK      PTMXADD2,SP20,SP20
          ENDIF
.
          MATCH     DBLQUOTE,PTMXADD3
          IF        @EQUAL
            PACK      PTMXADD3,SP20,SP20
          ENDIF
.
          MATCH     DBLQUOTE,PTMXADD4
          IF        @EQUAL
            PACK      PTMXADD4,SP20,SP20
          ENDIF
.
          MATCH     DBLQUOTE,PTMXPOST
          IF        @EQUAL
            MOVE      SP20,PTMXPOST
          ENDIF
.
          MATCH     DBLQUOTE,PMPXLNG1
          IF        @EQUAL
            MOVE      SP70,PMPXLNG1  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXLNG2
          IF        @EQUAL
            MOVE      SP70,PMPXLNG2  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXLNG3
          IF        @EQUAL
            MOVE      SP70,PMPXLNG3  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXPEML
          IF        @EQUAL
            PACK      PMPXPEML,SP70,SP70  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXCMOB
          IF        @EQUAL
            MOVE      SP70,PMPXCMOB  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXCEML
          IF        @EQUAL
            PACK      PMPXCEML,SP70,SP70  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXKMOB
          IF        @EQUAL
            MOVE      SP70,PMPXKMOB  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXKEML
          IF        @EQUAL
            PACK      PMPXKEML,SP70,SP70  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXRMOB
          IF        @EQUAL
            MOVE      SP70,PMPXRMOB  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXREML
          IF        @EQUAL
            PACK      PMPXREML,SP70,SP70  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXMEDC
          IF        @EQUAL
            MOVE      SP70,PMPXMEDC  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXDETY
          IF        @EQUAL
            MOVE      SP70,PMPXDETY  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXPRIS
          IF        @EQUAL
            MOVE      SP70,PMPXPRIS  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXCSER
          IF        @EQUAL
            MOVE      SP70,PMPXCSER  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXDREC
          IF        @EQUAL
            MOVE      SP70,PMPXDREC  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXDVAC
          IF        @EQUAL
            MOVE      SP70,PMPXDVAC
          ENDIF
.
          MATCH     DBLQUOTE,PMPXPNSD
          IF        @EQUAL
            MOVE      SP70,PMPXPNSD
          ENDIF
.
          MATCH     DBLQUOTE,PMPXABRG
          IF        @EQUAL
            MOVE      SP70,PMPXABRG
          ENDIF
.
          MATCH     DBLQUOTE,PMPXPRVI
          IF        @EQUAL
            MOVE      SP70,PMPXPRVI
          ENDIF
.
          MATCH     DBLQUOTE,PMPXUDC1
          IF        @EQUAL
            MOVE      SP70,PMPXUDC1  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXUDC2
          IF        @EQUAL
            MOVE      SP70,PMPXUDC2
          ENDIF
.
          MATCH     DBLQUOTE,PMPXUDC3
          IF        @EQUAL
            MOVE      SP70,PMPXUDC3
          ENDIF
.
          MATCH     DBLQUOTE,PMPXUSR7
          IF        @EQUAL
            MOVE      SP70,PMPXUSR7
          ENDIF
.
          MATCH     DBLQUOTE,PMPXUSR8
          IF        @EQUAL
            MOVE      SP70,PMPXUSR8
          ENDIF
.
          MATCH     DBLQUOTE,PMPXUSR9
          IF        @EQUAL
            MOVE      SP70,PMPXUSR9
          ENDIF
.
          MATCH     DBLQUOTE,PMPXMSNA
          IF        @EQUAL
            MOVE      SP70,PMPXMSNA  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXMGNA
          IF        @EQUAL
            MOVE      SP70,PMPXMGNA  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXMTLE
          IF        @EQUAL
            MOVE      SP70,PMPXMTLE  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXMAD1
          IF        @EQUAL
            MOVE      SP70,PMPXMAD1  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXMAD2
          IF        @EQUAL
            MOVE      SP70,PMPXMAD2  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXMAD3
          IF        @EQUAL
            MOVE      SP70,PMPXMAD3  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXMAD4
          IF        @EQUAL
            MOVE      SP70,PMPXMAD4  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXMPOS
          IF        @EQUAL
            MOVE      SP70,PMPXMPOS  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXMPNO
          IF        @EQUAL
            MOVE      SP70,PMPXMPNO  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXMBNO
          IF        @EQUAL
            MOVE      SP70,PMPXMBNO  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXMMNO
          IF        @EQUAL
            MOVE      SP70,PMPXMMNO  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXMEML
          IF        @EQUAL
            PACK      PMPXMEML,SP70,SP70  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXMCNT
          IF        @EQUAL
            MOVE      SP70,PMPXMCNT  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXMREL
          IF        @EQUAL
            MOVE      SP70,PMPXMREL  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXFSNA
          IF        @EQUAL
            MOVE      SP70,PMPXFSNA  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXFGNA
          IF        @EQUAL
            MOVE      SP70,PMPXFGNA  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXFTLE
          IF        @EQUAL
            MOVE      SP70,PMPXFTLE  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXFAD1
          IF        @EQUAL
            MOVE      SP70,PMPXFAD1  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXFAD2
          IF        @EQUAL
            MOVE      SP70,PMPXFAD2  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXFAD3
          IF        @EQUAL
            MOVE      SP70,PMPXFAD3  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXFAD4
          IF        @EQUAL
            MOVE      SP70,PMPXFAD4  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXFPOS
          IF        @EQUAL
            MOVE      SP70,PMPXFPOS  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXFPNO
          IF        @EQUAL
            MOVE      SP70,PMPXFPNO  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXFBNO
          IF        @EQUAL
            MOVE      SP70,PMPXFBNO  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXFMNO
          IF        @EQUAL
            MOVE      SP70,PMPXFMNO  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXFEML
          IF        @EQUAL
            PACK      PMPXFEML,SP70,SP70  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXFCNT
          IF        @EQUAL
            MOVE      SP70,PMPXFCNT  
          ENDIF
.
          MATCH     DBLQUOTE,PMPXFREL
          IF        @EQUAL
            MOVE      SP70,PMPXFREL  
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      CHKBL999
.
CHKBL910  MOVE      ONE,EXIT
.
CHKBL999  RETURN
+
.
. IO's go in here
.
          INC       IBAOVRIO/INC
          INC       PATPA1IO/INC
          INC       PATAK1IO/INC
          INC       NHIETHIO/INC
          INC       NHIMASIO/INC
          INC       PATPR1IO/INC
          INC       PATRE1IO/INC
          INC       UPDUR
          INC       CALCAGE
.
DGUPDEND  ENDPROC

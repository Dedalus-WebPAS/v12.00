.------------------------------------------------------------------------------
. Get latest patient attribute details for admissno, attribute
. type "024"
. Input: URNUMBER
.        ADMISSNO
.        SUBITMNO
.
. Modifications: 
.------------------------------------------------------------------------------
. V11.03.00 13/02/2023 Thanh T        TSK 0917555
.           Initial version
.------------------------------------------------------------------------------
ATRFB000  UNPACK    DIM127,D1,SUBITMNO,DIM127
          MATCH     SP70,SUBITMNO
          GOTO      ATRFB999 IF EQUAL
          MOVE      SUBITMNO,SUBITMFO
.
          MOVE      "024",DIM3
          PACK      KEY35,URNUMBER,ADMISSNO,DIM3,Z70
          CALL      RSPTATR3
ATRFB002  CALL      RPPTATR3
          IF        OVRCD=1
            GOTO      ATRFB004
          ENDIF
.
          MATCH     URNUMBER,PTARURNO
          GOTO      ATRFB004 IF NOT EQUAL
.
          MATCH     ADMISSNO,PTARVISN
          GOTO      ATRFB004 IF NOT EQUAL
.
          MATCH     DIM3,PTARTYPE
          GOTO      ATRFB004 IF NOT EQUAL
.
          MATCH     "1",PTARDELR
          GOTO      ATRFB002 IF EQUAL
.
          GOTO      ATRFB005
.
. No row found
.
ATRFB004  CALL      CLPATATR
.
ATRFB005  BRANCH    SUBITMFO,ATRFB010,ATRFB020,ATRFB030,ATRFB040,ATRFB050:
                             ATRFB060,ATRFB070,ATRFB080,ATRFB090,ATRFB100:
                             ATRFB110,ATRFB120,ATRFB130,ATRFB140
.
          GOTO      ATRFB999
.
ATRFB010  MOVE      "ZS",CATEGORY
          MOVE      PTARCOD1,CODE
          CALL      CODITM00
          GOTO      ATRFB999
.
ATRFB020  WRITE     HTMLFILE;PTARCOD2;
          GOTO      ATRFB999
.
ATRFB030  WRITE     HTMLFILE;PTARCOD3;
          GOTO      ATRFB999
.
ATRFB040  WRITE     HTMLFILE;PTARCOD4;
          GOTO      ATRFB999
.
ATRFB050  WRITE     HTMLFILE;PTARVAL1;
          GOTO      ATRFB999
.
ATRFB060  WRITE     HTMLFILE;PTARVAL2;
          GOTO      ATRFB999
.
ATRFB070  WRITE     HTMLFILE;PTARVAL3;
          GOTO      ATRFB999
.
ATRFB080  WRITE     HTMLFILE;PTARVAL4;
          GOTO      ATRFB999
.
ATRFB090  WRITE     HTMLFILE;PTARTXT1;
          GOTO      ATRFB999
.
ATRFB100  WRITE     HTMLFILE;PTARTXT2;
          GOTO      ATRFB999
.
ATRFB110  WRITE     HTMLFILE;PTARTXT3;
          GOTO      ATRFB999
.
ATRFB120  WRITE     HTMLFILE;PTARTXT4;
          GOTO      ATRFB999
.
ATRFB130  MATCH     SP70,PTARDATE
          GOTO      ATRFB999 IF EQUAL
          UNPACK    PTARDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ATRFB999
.
ATRFB140  WRITE     HTMLFILE;PTARTIME;
          GOTO      ATRFB999
.
ATRFB999  RETURN



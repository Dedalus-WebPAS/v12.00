. *-----------------------------------------------------------------------
. * Include Name  :   EMRDELTM.PBL
. *
. * Function      :   CGI variables functions for EMRDELFD - emrdelaf.dat
. *-----------------------------------------------------------------------
.  Modifications Done :
.
.  V10.06.01  20/03/2015  Ebon Clements CAR 304779
.             Removed delay reason array
.  V10.06.00  11/03/2015  Ebon Clements CAR 304779
.             Added additional delay reasons and comments
.  V10.03.00  12/10/2012  Ebon Clements CAR 266929
.             Created include
. *-----------------------------------------------------------------------
.-------------------------------------------------------------------------
.   Clear Parameters for emergency delay reason file
.-------------------------------------------------------------------------
.
CPEMDE00  MOVE      Z70,EMDEL001
          MOVE      Z70,EMDEL002
          MOVE      Z70,EMDEL003
          MOVE      Z70,EMDEL004
          MOVE      Z70,EMDEL005
          MOVE      Z70,EMDEL006
          MOVE      Z70,EMDEL007
          MOVE      Z70,EMDEL008
          MOVE      Z70,EMDEL009
          MOVE      Z70,EMDEL010
          MOVE      Z70,EMDEL011
          MOVE      Z70,EMDEL012
          MOVE      Z70,EMDEL013
          MOVE      Z70,EMDEL014
          MOVE      Z70,EMDEL015
          MOVE      Z70,EMDEL016
          MOVE      Z70,EMDEL017
          MOVE      Z70,EMDEL018
.
CPEMDE99  RETURN
.
.--------------------------------------------------------------------------
. Tags for emergency delay reason file
.--------------------------------------------------------------------------
EMDE0000  BRANCH    FLDITMNO,EMDE0010,EMDE0020,EMDE0030,EMDE0040,EMDE0050:
                             EMDE0060,EMDE0070,EMDE0080,EMDE0090,EMDE0100:
                             EMDE0110,EMDE0120,EMDE0130,EMDE0140,EMDE0150:
                             EMDE0160,EMDE0170,EMDE0180,EMDE0190,EMDE0200:
                             EMDE0210,EMDE0220,EMDE0230,EMDE0240
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      EMDE9999
.
EMDE0010  WRITE     HTMLFILE;EMDEVISN;
          GOTO      EMDE9999
.
EMDE0020  UNPACK    EMDEDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMDE9999
.
EMDE0030  WRITE     HTMLFILE;EMDETIME;
          GOTO      EMDE9999
.
EMDE0040  MOVE      "Ya",CATEGORY
          MOVE      EMDETYPE,CODE
          CALL      CODITM00
          GOTO      EMDE9999
.
EMDE0050  WRITE     HTMLFILE;EMDECNTR;
          GOTO      EMDE9999
.
EMDE0060  MOVE      "Yb",CATEGORY
          MOVE      EMDEREAS,CODE
          CALL      CODITM00
          GOTO      EMDE9999
.
EMDE0070  WRITE     HTMLFILE;EMDEDELT;
          GOTO      EMDE9999
.
EMDE0080  MATCH     SP70,EMDECUID
          GOTO      EMDE9999 IF EQUAL
.
          PACK      KEY10,EMDECUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      EMDECUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      EMDE9999

EMDE0090  MATCH     EMDECDAT,SP70
          GOTO      EMDE9999 IF EQUAL
.
          UNPACK    EMDECDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMDE9999
.
EMDE0100  WRITE     HTMLFILE;EMDECTIM;
          GOTO      EMDE9999
.
EMDE0110  MATCH     SP70,EMDEUUID
          GOTO      EMDE9999 IF EQUAL
.
          PACK      KEY10,EMDEUUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      EMDEUUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      EMDE9999

EMDE0120  MATCH     EMDEUDAT,SP70
          GOTO      EMDE9999 IF EQUAL
.
          UNPACK    EMDEUDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMDE9999
.
EMDE0130  WRITE     HTMLFILE;EMDEUTIM;
          GOTO      EMDE9999
.
EMDE0140  CALL      DELT0000                * Tabel of visits delay reasons
          GOTO      EMDE9999
.
EMDE0150  MOVE      "Yb",CATEGORY
          MOVE      EMDEDR02,CODE
          CALL      CODITM00
          GOTO      EMDE9999
.
EMDE0160  MOVE      "Yb",CATEGORY
          MOVE      EMDEDR03,CODE
          CALL      CODITM00
          GOTO      EMDE9999
.
EMDE0170  MOVE      "Yb",CATEGORY
          MOVE      EMDEDR04,CODE
          CALL      CODITM00
          GOTO      EMDE9999
.
EMDE0180  MOVE      "Yb",CATEGORY
          MOVE      EMDEDR05,CODE
          CALL      CODITM00
          GOTO      EMDE9999
.
EMDE0190  MOVE      "Yb",CATEGORY
          MOVE      EMDEDR06,CODE
          CALL      CODITM00
          GOTO      EMDE9999
.
EMDE0200  MOVE      "Yb",CATEGORY
          MOVE      EMDEDR07,CODE
          CALL      CODITM00
          GOTO      EMDE9999
.
EMDE0210  MOVE      "Yb",CATEGORY
          MOVE      EMDEDR08,CODE
          CALL      CODITM00
          GOTO      EMDE9999
.
EMDE0220  MOVE      "Yb",CATEGORY
          MOVE      EMDEDR09,CODE
          CALL      CODITM00
          GOTO      EMDE9999
.
EMDE0230  MOVE      "Yb",CATEGORY
          MOVE      EMDEDR10,CODE
          CALL      CODITM00
          GOTO      EMDE9999
.
EMDE0240  WRITE     HTMLFILE;EMDECOMM;
          GOTO      EMDE9999
.
EMDE9999  RETURN
.
.--------------------------------------------------------------------------
. Set parameters for emergency delay reason file                     
.--------------------------------------------------------------------------
SPEMDE00  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPEMDE01,SPEMDE02,SPEMDE03,SPEMDE04,SPEMDE05:
                       SPEMDE06,SPEMDE07,SPEMDE08,SPEMDE09,SPEMDE10:
                       SPEMDE11,SPEMDE12,SPEMDE13,SPEMDE14,SPEMDE15:
                       SPEMDE16,SPEMDE17,SPEMDE18
.
          MOVE      ONE,EXIT
          GOTO      SPEMDE99
.
SPEMDE01  PACK      EMDEL001,QRYDATA,SP70
          GOTO      SPEMDE99
.
SPEMDE02  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      EMDEL002,CCENT,CYEAR,CMON,CDAY,SP70
          GOTO      SPEMDE99
.
SPEMDE03  PACK      EMDEL003,QRYDATA,SP70
          GOTO      SPEMDE99
.
SPEMDE04  PACK      EMDEL004,QRYDATA,SP70
          GOTO      SPEMDE99
.
SPEMDE05  PACK      EMDEL005,QRYDATA,SP70
          GOTO      SPEMDE99
.
SPEMDE06  PACK      EMDEL006,QRYDATA,SP70
          GOTO      SPEMDE99
.
SPEMDE07  PACK      EMDEL007,QRYDATA,SP70
          GOTO      SPEMDE99
.
SPEMDE08  PACK      EMDEL008,QRYDATA,SP70
          GOTO      SPEMDE99
.
SPEMDE09  PACK      EMDEL009,QRYDATA,SP70
          GOTO      SPEMDE99
.
SPEMDE10  PACK      EMDEL010,QRYDATA,SP70
          GOTO      SPEMDE99
.
SPEMDE11  PACK      EMDEL011,QRYDATA,SP70
          GOTO      SPEMDE99
.
SPEMDE12  PACK      EMDEL012,QRYDATA,SP70
          GOTO      SPEMDE99
.
SPEMDE13  PACK      EMDEL013,QRYDATA,SP70
          GOTO      SPEMDE99
.
SPEMDE14  PACK      EMDEL014,QRYDATA,SP70
          GOTO      SPEMDE99
.
SPEMDE15  PACK      EMDEL015,QRYDATA,SP70
          GOTO      SPEMDE99
.
SPEMDE16  PACK      EMDEL016,QRYDATA,SP70
          GOTO      SPEMDE99
.
SPEMDE17  PACK      EMDEL017,QRYDATA,SP70
          GOTO      SPEMDE99
.
SPEMDE18  PACK      EMDEL018,QRYDATA,SP70
          GOTO      SPEMDE99
.
SPEMDE99  RETURN
.
.--------------------------------------------------------------------------
. Update cgi to file vars for emergency delay reason file                     
.--------------------------------------------------------------------------
MVEMDE00  MATCH     EMDEL001,Z70
          IF        !@EQUAL
            MOVE      EMDEL001,EMDEVISN
          ENDIF
.
          MATCH     EMDEL002,Z70
          IF        !@EQUAL
            MOVE      EMDEL002,EMDEDATE
          ENDIF
.
          MATCH     EMDEL003,Z70
          IF        !@EQUAL
            MOVE      EMDEL003,EMDETIME
          ENDIF
.
          MATCH     EMDEL004,Z70
          IF        !@EQUAL
            MOVE      EMDEL004,EMDETYPE
          ENDIF
.
          MATCH     EMDEL005,Z70
          IF        !@EQUAL
            MOVE      EMDEL005,EMDECNTR
          ENDIF
.
          MATCH     EMDEL006,Z70
          IF        !@EQUAL
            MOVE      EMDEL006,EMDEREAS
          ENDIF
.
          MATCH     EMDEL007,Z70
          IF        !@EQUAL
            MOVE      EMDEL007,EMDEDELT
          ENDIF
.
          MATCH     EMDEL008,Z70
          IF        !@EQUAL
            MOVE      EMDEL008,EMDEDR02
          ENDIF
.
          MATCH     EMDEL009,Z70
          IF        !@EQUAL
            MOVE      EMDEL009,EMDEDR03
          ENDIF
.
          MATCH     EMDEL010,Z70
          IF        !@EQUAL
            MOVE      EMDEL010,EMDEDR04
          ENDIF
.
          MATCH     EMDEL011,Z70
          IF        !@EQUAL
            MOVE      EMDEL011,EMDEDR05
          ENDIF
.
          MATCH     EMDEL012,Z70
          IF        !@EQUAL
            MOVE      EMDEL012,EMDEDR06
          ENDIF
.
          MATCH     EMDEL013,Z70
          IF        !@EQUAL
            MOVE      EMDEL013,EMDEDR07
          ENDIF
.
          MATCH     EMDEL014,Z70
          IF        !@EQUAL
            MOVE      EMDEL014,EMDEDR08
          ENDIF
.
          MATCH     EMDEL015,Z70
          IF        !@EQUAL
            MOVE      EMDEL015,EMDEDR09
          ENDIF
.
          MATCH     EMDEL016,Z70
          IF        !@EQUAL
            MOVE      EMDEL016,EMDEDR10
          ENDIF
.
          MATCH     EMDEL017,Z70
          IF        !@EQUAL
            PACK      EMDECOMM,EMDEL017,SP70,SP70,SP70,SP70,SP70
.
            MATCH     EMDEL018,Z70
            IF        !@EQUAL
              PACK      EMDECOMM,EMDEL017,EMDEL018,SP70,SP70,SP70,SP70,SP70
            ENDIF
          ENDIF
.
MVEMDE99  RETURN
.
.--------------------------------------------------------------------------
. Clear file vars for emergency delay reason file                     
.--------------------------------------------------------------------------
CLEMDE00  MOVE      SP70,EMDEVISN
          MOVE      SP70,EMDEDATE
          MOVE      SP70,EMDETIME
          MOVE      SP70,EMDETYPE
          MOVE      SP70,EMDECNTR
          MOVE      SP70,EMDEREAS
          MOVE      SP70,EMDEDELT
          MOVE      SP70,EMDECUID
          MOVE      SP70,EMDECDAT
          MOVE      SP70,EMDECTIM
          MOVE      SP70,EMDEUUID
          MOVE      SP70,EMDEUDAT
          MOVE      SP70,EMDEUTIM
          MOVE      SP70,EMDEDR02
          MOVE      SP70,EMDEDR03
          MOVE      SP70,EMDEDR04
          MOVE      SP70,EMDEDR05
          MOVE      SP70,EMDEDR06
          MOVE      SP70,EMDEDR07
          MOVE      SP70,EMDEDR08
          MOVE      SP70,EMDEDR09
          MOVE      SP70,EMDEDR10
          PACK      EMDECOMM,SP70,SP70,SP70,SP70,SP70
          PACK      EMDESPAR,SP70,SP70
.
CLEMDE99  RETURN
.
.--------------------------------------------------------------------------
. Table of delay reasons for a visit
.--------------------------------------------------------------------------
DELT0000  PACK      KEY29,ADMISSNO,SP70
          CALL      RSEMDEL1
DELT1000  CALL      RKEMDEL1
          BRANCH    OVRCD,DELT9999
.                           
          MATCH     EMDEVISN,ADMISSNO            * Correct visit number
          GOTO      DELT9999 IF NOT EQUAL
.
          MATCH     "1",EMDEDELT                 * Don't display delete records
          GOTO      DELT1000 IF EQUAL
.
          UNPACK    EMDECDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70

          CLEAR     HTMLLINK
          APPEND    "javascript:updateDelay('",HTMLLINK
          APPEND    URNUMBER,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    EMDEVISN,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    DISPDATE,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    EMDETIME,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    EMDETYPE,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    EMDECNTR,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          MOVE      SP70,WBSENAM
          MATCH     SP70,EMDECUID
          IF        !@EQUAL
            PACK      KEY10,EMDECUID,SP70
            CALL      RDWBSE1
            IF        OVRCD=1
              MOVE      EMDECUID,WBSENAM
            ENDIF
          ENDIF
.
          MOVE      SP70,DISPTYPE
          MATCH     SP70,EMDETYPE
          IF        !@EQUAL
            PACK      KEY5,CATYA,EMDETYPE,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      EMDETYPE,TDESC
            ENDIF
            MOVE      TDESC,DISPTYPE
          ENDIF
.
          MOVE      SP70,DISPREAS
          MATCH     SP70,EMDEREAS
          IF        !@EQUAL
            PACK      KEY5,CATYB,EMDEREAS,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      EMDEREAS,TDESC
            ENDIF
            MOVE      TDESC,DISPREAS
          ENDIF
.
          MOVE      SP70,DISPRS02
          MATCH     SP70,EMDEDR02
          IF        !@EQUAL
            PACK      KEY5,CATYB,EMDEDR02,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      EMDEDR02,TDESC
            ENDIF
            MOVE      TDESC,DISPRS02
          ENDIF
.
          MOVE      SP70,DISPRS03
          MATCH     SP70,EMDEDR03
          IF        !@EQUAL
            PACK      KEY5,CATYB,EMDEDR03,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      EMDEDR03,TDESC
            ENDIF
            MOVE      TDESC,DISPRS03
          ENDIF
.
          MOVE      SP70,DISPRS04
          MATCH     SP70,EMDEDR04
          IF        !@EQUAL
            PACK      KEY5,CATYB,EMDEDR04,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      EMDEDR04,TDESC
            ENDIF
            MOVE      TDESC,DISPRS04
          ENDIF
.
          MOVE      SP70,DISPRS05
          MATCH     SP70,EMDEDR05
          IF        !@EQUAL
            PACK      KEY5,CATYB,EMDEDR05,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      EMDEDR05,TDESC
            ENDIF
            MOVE      TDESC,DISPRS05
          ENDIF
.
          MOVE      SP70,DISPRS06
          MATCH     SP70,EMDEDR06
          IF        !@EQUAL
            PACK      KEY5,CATYB,EMDEDR06,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      EMDEDR06,TDESC
            ENDIF
            MOVE      TDESC,DISPRS06
          ENDIF
.
          MOVE      SP70,DISPRS07
          MATCH     SP70,EMDEDR07
          IF        !@EQUAL
            PACK      KEY5,CATYB,EMDEDR07,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      EMDEDR07,TDESC
            ENDIF
            MOVE      TDESC,DISPRS07
          ENDIF
.
          MOVE      SP70,DISPRS08
          MATCH     SP70,EMDEDR08
          IF        !@EQUAL
            PACK      KEY5,CATYB,EMDEDR08,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      EMDEDR08,TDESC
            ENDIF
            MOVE      TDESC,DISPRS08
          ENDIF
.
          MOVE      SP70,DISPRS09
          MATCH     SP70,EMDEDR09
          IF        !@EQUAL
            PACK      KEY5,CATYB,EMDEDR09,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      EMDEDR09,TDESC
            ENDIF
            MOVE      TDESC,DISPRS09
          ENDIF
.
          MOVE      SP70,DISPRS10
          MATCH     SP70,EMDEDR10
          IF        !@EQUAL
            PACK      KEY5,CATYB,EMDEDR10,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      EMDEDR10,TDESC
            ENDIF
            MOVE      TDESC,DISPRS10
          ENDIF
.
          STRIP     EMDECOMM
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",EMDEDATE,EMDETIME,"#",":
                             "#"",DISPTYPE,"#",":
                             "#"",DISPREAS;
.
          MATCH     SP70,DISPRS02
          IF        !@EQUAL
            WRITE     HTMLFILE;"<br>",DISPRS02;
          ENDIF
.
          MATCH     SP70,DISPRS03
          IF        !@EQUAL
            WRITE     HTMLFILE;"<br>",DISPRS03;
          ENDIF
.
          MATCH     SP70,DISPRS04
          IF        !@EQUAL
            WRITE     HTMLFILE;"<br>",DISPRS04;
          ENDIF
.
          MATCH     SP70,DISPRS05
          IF        !@EQUAL
            WRITE     HTMLFILE;"<br>",DISPRS05;
          ENDIF
.
          MATCH     SP70,DISPRS06
          IF        !@EQUAL
            WRITE     HTMLFILE;"<br>",DISPRS06;
          ENDIF
.
          MATCH     SP70,DISPRS07
          IF        !@EQUAL
            WRITE     HTMLFILE;"<br>",DISPRS07;
          ENDIF
.
          MATCH     SP70,DISPRS08
          IF        !@EQUAL
            WRITE     HTMLFILE;"<br>",DISPRS08;
          ENDIF
.
          MATCH     SP70,DISPRS09
          IF        !@EQUAL
            WRITE     HTMLFILE;"<br>",DISPRS09;
          ENDIF
.
          MATCH     SP70,DISPRS10
          IF        !@EQUAL
            WRITE     HTMLFILE;"<br>",DISPRS10;
          ENDIF
.
          WRITE     HTMLFILE;"#",#"",WBSENAM,"#",";
.
          WRITE     HTMLFILE;*+,"#"",EMDECOMM,"#")"
.
          GOTO      DELT1000
.
DELT9999  RETURN

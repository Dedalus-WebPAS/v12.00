. *----------------------------------------------------------------------------
. * Include Name  :   PMSBDCTM.PBL
. *
. * Function      :   Common Routines for PMSBDCFD - pmsbdcaf
. *
. * Mods          :   V9.11.03 14/10/2008 Ebon Clements  CAR 174077
. *                            Added PMSBC015
. *                   V9.11.02 07/10/2008 Ebon Clements  CAR 174076
. *                            Added SP70 test to PMBCFTRC tag
. *                   V9.11.01 23/09/2008 Ebon Clements  CAR 174051
. *                            Added PMSBC014
. *                   V9.03.01 20/08/2003 Sylvek Litewka CAR 41826
. *                            Created include
. *----------------------------------------------------------------------------
.------------------------------------------------------------------------------
.   Clear Parameters for Patient Bed Closure file
.------------------------------------------------------------------------------
CPPMBC00  MOVE      Z70,PMSBC001
          MOVE      Z70,PMSBC002
          MOVE      Z70,PMSBC003
          MOVE      Z70,PMSBC004
          MOVE      Z70,PMSBC005
          MOVE      Z70,PMSBC006
          MOVE      Z70,PMSBC007
          MOVE      Z70,PMSBC008
          MOVE      Z70,PMSBC009
          MOVE      Z70,PMSBC010
          MOVE      Z70,PMSBC011
          MOVE      Z70,PMSBC012
          MOVE      Z70,PMSBC013
          MOVE      Z70,PMSBC014
          MOVE      Z70,PMSBC015
.
CPPMBC99  RETURN
.
.------------------------------------------------------------------------------
.   Clear file variables
.------------------------------------------------------------------------------
CLPMBC00  MOVE      SP70,PMBCWARD
          MOVE      SP70,PMBCBED   
          MOVE      SP70,PMBCFRDT 
          MOVE      SP70,PMBCFRTM
          MOVE      SP70,PMBCFRPR
          MOVE      SP70,PMBCTODT  
          MOVE      SP70,PMBCTOTM 
          MOVE      SP70,PMBCTOPR 
          MOVE      SP70,PMBCREAS
          MOVE      SP70,PMBCCRDT
          MOVE      SP70,PMBCCRTM  
          MOVE      SP70,PMBCCRID  
          MOVE      SP70,PMBCUPDT 
          MOVE      SP70,PMBCUPTM
          MOVE      SP70,PMBCUPID 
          MOVE      SP70,PMBCDOCT 
          MOVE      SP70,PMBCFTRC 
          MOVE      SP70,PMBCSPAR 
.
CLPMBC99  RETURN
.
.------------------------------------------------------------
.   Set Parameters for Patient Bed Closure file
.------------------------------------------------------------
SPMBC000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPMBC010,SPMBC020,SPMBC030,SPMBC040,SPMBC050:
                       SPMBC060,SPMBC070,SPMBC080,SPMBC090,SPMBC100:
                       SPMBC110,SPMBC120,SPMBC130,SPMBC140,SPMBC150
.
          MOVE      ONE,EXIT
          GOTO      SPMBC999
.
SPMBC010  SQUEEZE   QRYDATA
          MOVE      QRYDATA,PMSBC001
          PACK      PMSBC001,PMSBC001,SP70
          GOTO      SPMBC999
.
SPMBC020  SQUEEZE   QRYDATA
          MOVE      QRYDATA,PMSBC002
          PACK      PMSBC002,PMSBC002,SP70
          GOTO      SPMBC999
.
SPMBC030  PACK      QRYDATA,QRYDATA,SP70
          MATCH     SP70,QRYDATA
          GOTO      SPMBC999 IF EQUAL
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMSBC003,CCENT,CYEAR,CMON,CDAY
          GOTO      SPMBC999
.
SPMBC040  SQUEEZE   QRYDATA
          MOVE      QRYDATA,PMSBC004
          PACK      PMSBC004,PMSBC004,SP70
          GOTO      SPMBC999
.
SPMBC050  PACK      QRYDATA,QRYDATA,SP70
          MATCH     SP70,QRYDATA
          GOTO      SPMBC999 IF EQUAL
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMSBC005,CCENT,CYEAR,CMON,CDAY
          GOTO      SPMBC999
.
SPMBC060  MOVE      QRYDATA,PMSBC006
          GOTO      SPMBC999
.
SPMBC070  MOVE      QRYDATA,PMSBC007
          GOTO      SPMBC999
.
SPMBC080  PACK      QRYDATA,QRYDATA,SP70
          MATCH     SP70,QRYDATA
          GOTO      SPMBC999 IF EQUAL
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMSBC008,CCENT,CYEAR,CMON,CDAY
          GOTO      SPMBC999
.
SPMBC090  MOVE      QRYDATA,PMSBC009
          GOTO      SPMBC999
.
SPMBC100  MOVE      QRYDATA,PMSBC010
          GOTO      SPMBC999
.
SPMBC110  PACK      QRYDATA,QRYDATA,SP70
          MATCH     SP70,QRYDATA
          GOTO      SPMBC999 IF EQUAL
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMSBC011,CCENT,CYEAR,CMON,CDAY
          GOTO      SPMBC999
.
SPMBC120  MOVE      QRYDATA,PMSBC012
          GOTO      SPMBC999
.
SPMBC130  MOVE      QRYDATA,PMSBC013
          GOTO      SPMBC999
.
SPMBC140  MOVE      QRYDATA,PMSBC014
          GOTO      SPMBC999
.
SPMBC150  MOVE      QRYDATA,PMSBC015
          GOTO      SPMBC999
.
SPMBC999  RETURN
.
.------------------------------------------------------------
.    Display Patient Bed Closure Fields
.------------------------------------------------------------
PMBC0000  BRANCH    FLDITMNO,PMBC0100,PMBC0200,PMBC0300,PMBC0400,PMBC0500:
                             PMBC0600,PMBC0700,PMBC0800,PMBC0900,PMBC1000:
                             PMBC1100,PMBC1200,PMBC1300,PMBC1400,PMBC1500:
                             PMBC1600,PMBC1700
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      PMBC9999
.
PMBC0100  WRITE     HTMLFILE;PMBCWARD;           * Ward
          GOTO      PMBC9999
.
PMBC0200  WRITE     HTMLFILE;PMBCBED;            * Bed
          GOTO      PMBC9999
.
PMBC0300  MATCH     PMBCFRDT,SP70                * Closed From Date
          GOTO      PMBC9999 IF EQUAL
          UNPACK    PMBCFRDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PMBC9999
.
PMBC0400  WRITE     HTMLFILE;PMBCFRTM;           * Closed From Time
          GOTO      PMBC9999
.
PMBC0500  MATCH     PMBCTODT,SP70                * Closed To Date
          GOTO      PMBC9999 IF EQUAL
          UNPACK    PMBCTODT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PMBC9999
.
PMBC0600  WRITE     HTMLFILE;PMBCTOTM;           * Closed To Time
          GOTO      PMBC9999
.
PMBC0700  MOVE      "BU",CATEGORY                * Reason for Bed Closure
          MOVE      PMBCREAS,CODE
          CALL      CODITM00
          GOTO      PMBC9999
.          
PMBC0800  MATCH     PMBCCRDT,SP70                * Date Record Created
          GOTO      PMBC9999 IF EQUAL
          UNPACK    PMBCCRDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PMBC9999
.
PMBC0900  WRITE     HTMLFILE;PMBCCRTM;           * Time Record Created
          GOTO      PMBC9999
.
PMBC1000  WRITE     HTMLFILE;PMBCCRID;           * User ID - Creator
          GOTO      PMBC9999
.
PMBC1100  MATCH     PMBCUPDT,SP70                * Date Record Updated
          GOTO      PMBC9999 IF EQUAL
          UNPACK    PMBCUPDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PMBC9999
.
PMBC1200  WRITE     HTMLFILE;PMBCUPTM;           * Time Record Updated
          GOTO      PMBC9999
.
PMBC1300  WRITE     HTMLFILE;PMBCUPID;           * User ID - Last Update
          GOTO      PMBC9999
.
PMBC1400  WRITE     HTMLFILE;PMBCFRPR;           * Closed From Processed Ind
          GOTO      PMBC9999
.
PMBC1500  WRITE     HTMLFILE;PMBCTOPR;           * Closed To Processed Ind
          GOTO      PMBC9999
.
PMBC1600  MATCH     SP70,PMBCFTRC
          GOTO      PMBC9999 IF EQUAL
.
          WRITE     HTMLFILE;PMBCFTRC;           * Free Text Reason for Closure
          GOTO      PMBC9999
.
PMBC1700  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMBC1710
.
          PACK      KEY10,PMBCDOCT,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,PMBC9999
.
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      PMBC9999
.
PMBC1710  MATCH     SP70,PMBCDOCT
          GOTO      PMBC9999 IF EQUAL
.
          WRITE     HTMLFILE;PMBCDOCT;
          GOTO      PMBC9999
.
PMBC9999  RETURN
.
.------------------------------------------------------------
.    Move Parameters to File Variables (for Update)
.------------------------------------------------------------
MVPMBC00  MATCH     PMSBC001,Z70
          IF        !@EQUAL
            MOVE      PMSBC001,PMBCWARD
          ENDIF
.
          MATCH     PMSBC002,Z70
          IF        !@EQUAL
            MOVE      PMSBC002,PMBCBED
          ENDIF
.
          MATCH     PMSBC003,Z70
          IF        !@EQUAL
            MOVE      PMSBC003,PMBCFRDT
          ENDIF
.
          MATCH     PMSBC004,Z70
          IF        !@EQUAL
            MOVE      PMSBC004,PMBCFRTM
          ENDIF
.
          MATCH     PMSBC005,Z70
          IF        !@EQUAL
            MOVE      PMSBC005,PMBCTODT
          ENDIF
.
          MATCH     PMSBC006,Z70
          IF        !@EQUAL
            MOVE      PMSBC006,PMBCTOTM
          ENDIF
.
          MATCH     PMSBC007,Z70
          IF        !@EQUAL
            MOVE      PMSBC007,PMBCREAS
          ENDIF
.
          MATCH     PMSBC008,Z70
          IF        !@EQUAL
            MOVE      PMSBC008,PMBCCRDT
          ENDIF
.
          MATCH     PMSBC009,Z70
          IF        !@EQUAL
            MOVE      PMSBC009,PMBCCRTM
          ENDIF
.
          MATCH     PMSBC010,Z70
          IF        !@EQUAL
            MOVE      PMSBC010,PMBCCRID
          ENDIF
.
          MATCH     PMSBC011,Z70
          IF        !@EQUAL
            MOVE      PMSBC011,PMBCUPDT
          ENDIF
.
          MATCH     PMSBC012,Z70
          IF        !@EQUAL
            MOVE      PMSBC012,PMBCUPTM
          ENDIF
.
          MATCH     PMSBC013,Z70
          IF        !@EQUAL
            MOVE      PMSBC013,PMBCUPID
          ENDIF
.
          MATCH     PMSBC014,Z70
          IF        !@EQUAL
            MOVE      PMSBC014,PMBCFTRC
          ENDIF
.
          MATCH     PMSBC015,Z70
          IF        !@EQUAL
            MOVE      PMSBC015,PMBCDOCT
          ENDIF
.
MVPMBC99  RETURN
.

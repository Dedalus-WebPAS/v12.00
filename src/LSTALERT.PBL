.* ***************************************************************************
.*    Module    : LSTALERT.PBL
.*    Function  : Set up the Patient Alert column for Patient Lists
.*
.*    Requires  : Master Details Extension "patmx1af" record
.*                Master Details Extn 2    "pmspx2af" record (for new 3 alerts)
.*                URNUMBER & ADMISSNO
.*                ALRTLINK - Dim 127
.*                ALRTIMGE - Dim 127
.*                ALRTIMG2 - Dim 127
.*                ALRTIMG3 - Dim 127
.*                ALRTIMG4 - Dim 127
.*                ALRTIMGT - Dim 250
.*
.*    Mods      :
.*    V10.08.01  09/08/2016  Davin          TSK 0321234
.*               Changed to allow chronic alert indicator to be displayed
.*    V10.02.01  10/05/2011  Davin          CAR 239539 WA Health
.*               Changed to allow 3 alert indicators to be displayed
.*    V10.00.00  New to V10.00
.* ***************************************************************************
.
LSTALR00  PACK      ALRTLINK,SP70,SP70
          PACK      ALRTIMGE,SP70,SP70
          PACK      ALRTIMG2,SP70,SP70
          PACK      ALRTIMG3,SP70,SP70
          PACK      ALRTIMG4,SP70,SP70
          PACK      ALRTIMGT,SP70,SP70,SP70,SP70
.
          MATCH     "1",PMPXSIN7
          IF        @EQUAL
            CLEAR     ALRTIMGE
            APPEND    "<img border=0 hspace=4 align=absmiddle",ALRTIMGE
            APPEND    " src=../images/AlertIconM.gif>",ALRTIMGE
            RESET     ALRTIMGE
          ENDIF
.
          MATCH     "1",PMPXSIN8
          IF        @EQUAL
            CLEAR     ALRTIMG2
            APPEND    "<img border=0 hspace=4 align=absmiddle",ALRTIMG2
            APPEND    " src=../images/AlertIconB.gif>",ALRTIMG2
            RESET     ALRTIMG2
          ENDIF
.
          MATCH     "1",PMPXSIN9
          IF        @EQUAL
            CLEAR     ALRTIMG3
            APPEND    "<img border=0 hspace=4 align=absmiddle",ALRTIMG3
            APPEND    " src=../images/AlertIconR.gif>",ALRTIMG3
            RESET     ALRTIMG3
          ENDIF
.
          MATCH     "1",PMPXSN11
          IF        @EQUAL
            CLEAR     ALRTIMG4
            APPEND    "<img border=0 hspace=4 align=absmiddle",ALRTIMG4
            APPEND    " src=../images/AlertIconC.gif>",ALRTIMG4
            RESET     ALRTIMG4
          ENDIF
.
          MATCH     "1",PTMXSIN1
          IF        @EQUAL
            CLEAR     ALRTIMGE
            APPEND    "<img border=0 hspace=4 align=absmiddle",ALRTIMGE
            APPEND    " src=../images/AlertIcon.gif>",ALRTIMGE
            RESET     ALRTIMGE
            GOTO      LSTALR20
          ENDIF
.
          MATCH     "2",PTMXSIN1
          IF        @EQUAL
            CLEAR     ALRTIMGE
            APPEND    "<img border=0 hspace=4 align=absmiddle",ALRTIMGE
            APPEND    " src=../images/AlertIconBlack.gif>",ALRTIMGE
            RESET     ALRTIMGE
            GOTO      LSTALR20
          ENDIF
.
          MATCH     "3",PTMXSIN1
          IF        @EQUAL
            CLEAR     ALRTIMGE
            APPEND    "<img border=0 hspace=4 align=absmiddle",ALRTIMGE
            APPEND    " src=../images/AlertIconDelete.gif>",ALRTIMGE
            RESET     ALRTIMGE
            GOTO      LSTALR20
          ENDIF
.
          MATCH     "0",PTMXSIN1
          GOTO      LSTALR20 IF EQUAL
.
          MATCH     SP70,PTMXSIN1
          IF        !@EQUAL
            CLEAR     ALRTIMGE
            APPEND    "<img border=0 hspace=4 align=absmiddle",ALRTIMGE
            APPEND    " src=../images/AlertIcon",ALRTIMGE
            APPEND    PTMXSIN1,ALRTIMGE
            APPEND    ".gif>",ALRTIMGE
            RESET     ALRTIMGE
          ENDIF
.
LSTALR20  MATCH     SP70,ALRTIMGE
          IF        @EQUAL
            MATCH     SP70,ALRTIMG2
            IF        @EQUAL
              MATCH     SP70,ALRTIMG3
              IF        @EQUAL
                MATCH     SP70,ALRTIMG4
                IF        @EQUAL
                  GOTO      LSTALR99
                ENDIF
              ENDIF
            ENDIF
          ENDIF
          CLEAR     ALRTLINK
          APPEND    "javascript:PatientAlerts('",ALRTLINK
          APPEND    URNUMBER,ALRTLINK
          APPEND    "','",ALRTLINK
          APPEND    ADMISSNO,ALRTLINK
          APPEND    "')",ALRTLINK
          RESET     ALRTLINK
.
LSTALR99  RETURN

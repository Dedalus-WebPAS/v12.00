. *----------------------------------------------------------------------
. * Include Name  :   ALLBILTM.PBL
. *
. * Function      :   CGI variables for ALLBILTM - allbilaf.dat
. *
. * Includes Needed : ALLDEPFD - Allied Health Department Table file
. *                   ALLDEPIO - IO for Allied Health Department Table file
. *                   ALLSERFD - Allied Health Service Codes file
. *                   ALLSERIO - IO for Allied Health Service Codes file
. *                   PATITMFD - Patient Item Details file
. *                   PATITMIO - IO for Patient Item Details file
. *                   WEBSECFD - Web System Table WEB Security File
. *                   WEBSECIO - IO for Web System Table WEB Security File
. *                   
. * Modifications :
. * V9.09.01  24/08/2007  Ebon Clements CAR 133923
. *          Changed department selection lists to be in alphabetical order
. * V9.03.00 17/03/2004 Pat Dirito     
. *          Removed call of DEPITM99 label   
. *----------------------------------------------------------------------
. * V9.01.02 15/12/2001 Ebon Clements
. *          Mods to service selection list
. * V9.01.01 14/08/2001 Ebon Clements
. *          Added a selection list of departments form ALLDEPFD fil
. *----------------------------------------------------------------------
.
.------------------------------------------------------------------------
.   Clear Parameters for Allied Health Billing Table file
.------------------------------------------------------------------------
.
CPALBI00  MOVE      Z70,ALBIL001
          MOVE      Z70,ALBIL002
          MOVE      Z70,ALBIL003
          MOVE      Z70,ALBIL004
          MOVE      Z70,ALBIL005
          MOVE      Z70,ALBIL006
          MOVE      Z70,ALBIL007
          MOVE      Z70,ALBIL008
          MOVE      Z70,ALBIL009
          MOVE      Z70,ALBIL010
          MOVE      Z70,ALBIL011
.
CPALBI99  RETURN
.
.------------------------------------------------------------
. Add Billing Table Fields
.------------------------------------------------------------
ALBI0000  BRANCH    FLDITMNO,ALBI0100,ALBI0200,ALBI0300,ALBI0400,ALBI0500:
                             ALBI0600,ALBI0700,ALBI0800,ALBI0900,ALBI1000:
                             ALBI1100,ALBI1200
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      ALBI9999
.
ALBI0100  MOVE      "CG",CATEGORY
          MOVE      ALBIDEPT,CODE
          CALL      CODITM00
          GOTO      ALBI9999
.
ALBI0200  MOVE      "CL",CATEGORY
          MOVE      ALBICOMP,CODE
          CALL      CODITM00
          GOTO      ALBI9999
.
ALBI0300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,ALBI0310,ALBI0320
          PACK      KEY9,ALBIDEPT,ALBISERV,SP70
          CALL      RDALSER1
          BRANCH    OVRCD,ALBI9999
          WRITE     HTMLFILE;ALSRDESC;
          GOTO      ALBI9999
.
ALBI0310  WRITE     HTMLFILE;ALBISERV;
          GOTO      ALBI9999
.
ALBI0320  MOVE      SP70,KEY1
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      TWO,SERVFLAG
          MOVE      KEY1,SERVFLAG
.
          PACK      KEY9,ALBIDEPT,SP70
          CALL      RSALSER1                * Positional Read
ALBI0330  CALL      RKALSER1                * read a record
          BRANCH    OVRCD,ALBI9999
.
          MATCH     ALBIDEPT,ALSRDEPT
          GOTO      ALBI9999 IF NOT EQUAL
.
          IF        SERVFLAG = 0
            MATCH     "1",ALSRNURA
            GOTO      ALBI0330 IF EQUAL
          ENDIF
.
          IF        SERVFLAG = 1
            MATCH     "1",ALSRNURA
            GOTO      ALBI0330 IF NOT EQUAL
          ENDIF
.
.
          MATCH     ALBISERV,ALSRSERV
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",ALSRSERV,"#" selected>":
                                 ALSRDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",ALSRSERV,"#">":
                                 ALSRDESC,"</option>"
          ENDIF
          GOTO      ALBI0330
.
ALBI0400  WRITE     HTMLFILE;ALBITIME;
          GOTO      ALBI9999
.
ALBI0500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,ALBI0510
          CALL      GETINM00
          BRANCH    OVRCD,ALBI9999
          WRITE     HTMLFILE;PRITDESC;
          GOTO      ALBI9999
.
ALBI0510  WRITE     HTMLFILE;ALBIITEM;
          GOTO      ALBI9999
.
ALBI0600  MATCH     ALBICDAT,SP70
          GOTO      ALBI9999 IF EQUAL
          UNPACK    ALBICDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      ALBI9999
.
ALBI0700  WRITE     HTMLFILE;ALBICTIM;
          GOTO      ALBI9999
.
ALBI0800  MATCH     SP70,ALBICUIT
          GOTO      ALBI9999 IF EQUAL
          PACK      KEY10,ALBICUIT
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      ALBICUIT,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          PACK      KEY10,USERID
          CALL      RDWBSE1
          GOTO      ALBI9999
.
ALBI0900  MATCH     ALBIUDAT,SP70
          GOTO      ALBI9999 IF EQUAL
          UNPACK    ALBIUDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      ALBI9999
.
ALBI1000  WRITE     HTMLFILE;ALBIUTIM;
          GOTO      ALBI9999
.
ALBI1100  MATCH     SP70,ALBIUUID
          GOTO      ALBI9999 IF EQUAL
          PACK      KEY10,ALBIUUID
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      ALBIUUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          PACK      KEY10,USERID
          CALL      RDWBSE1
          GOTO      ALBI9999
.
ALBI1200  CALL      ALDPSL00
          GOTO      ALBI9999
.
ALBI9999  RETURN
.------------------------------------------------------------
. Get Item Description from PP Item Table
.------------------------------------------------------------
GETINM00  MOVE      " 0",KEY2
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          PACK      KEY22,KEY2,ALBIITEM,Z70
          CALL      RSPRIT1
GETINM10  CALL      RPPRIT1
          BRANCH    OVRCD,GETINM20
          COMPARE   ZERO,PRITFLAG
          GOTO      GETINM20 IF NOT EQUAL
          MATCH     ALBIITEM,PRITITMN
          GOTO      GETINM20 IF NOT EQUAL
          MATCH     KEY8,PRITDAT1
          GOTO      GETINM90 IF EQUAL
          GOTO      GETINM10 IF NOT LESS
          GOTO      GETINM90
.
GETINM20  MOVE      "&nbsp",PRITDESC
          MOVE      ONE,OVRCD
          GOTO      GETINM99
.
GETINM90  MOVE      ZERO,OVRCD
GETINM99  RETURN
.------------------------------------------------------------
.   Set Parameters for waiting list extension file
.------------------------------------------------------------
SPALBI00  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPALBI01,SPALBI02,SPALBI03,SPALBI04,SPALBI05:
                       SPALBI06,SPALBI07,SPALBI08,SPALBI09,SPALBI10:
                       SPALBI11
.
          MOVE      ONE,EXIT
          GOTO      SPALBI99
.
SPALBI01  SQUEEZE   QRYDATA
          MOVE      QRYDATA,ALBIL001
          PACK      ALBIL001,ALBIL001,SP70
          GOTO      SPALBI99
.
SPALBI02  SQUEEZE   QRYDATA
          MOVE      QRYDATA,ALBIL002
          PACK      ALBIL002,ALBIL002,SP70
          GOTO      SPALBI99
.
SPALBI03  SQUEEZE   QRYDATA
          MOVE      QRYDATA,ALBIL003
          PACK      ALBIL003,ALBIL003,SP70
          GOTO      SPALBI99
.
SPALBI04  SQUEEZE   QRYDATA
          MOVE      QRYDATA,ALBIL004
          PACK      ALBIL004,ALBIL004,SP70
          GOTO      SPALBI99
.
SPALBI05  MOVE      QRYDATA,ALBIL005
          GOTO      SPALBI99
.
SPALBI06  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      ALBIL006,CCENT,CYEAR,CMON,CDAY
          GOTO      SPALBI99
.
SPALBI07  MOVE      QRYDATA,ALBIL007
          GOTO      SPALBI99
.
SPALBI08  MOVE      QRYDATA,ALBIL008
          GOTO      SPALBI99
.
SPALBI09  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      ALBIL009,CCENT,CYEAR,CMON,CDAY
          GOTO      SPALBI99
.
SPALBI10  MOVE      QRYDATA,ALBIL010
          GOTO      SPALBI99
.
SPALBI11  MOVE      QRYDATA,ALBIL011
          GOTO      SPALBI99
.
SPALBI99  RETURN
.------------------------------------------------------------
.  Update extension file
.------------------------------------------------------------
MVALBI00  MATCH     ALBIL001,Z70
          IF        !@EQUAL
            MOVE      ALBIL001,ALBIDEPT
          ENDIF
.
          MATCH     ALBIL002,Z70
          IF        !@EQUAL
            MOVE      ALBIL002,ALBICOMP
          ENDIF
.
          MATCH     ALBIL003,Z70
          IF        !@EQUAL
            MOVE      ALBIL003,ALBISERV
          ENDIF
.
          MATCH     ALBIL004,Z70
          IF        !@EQUAL
            MOVE      ALBIL004,ALBITIME
          ENDIF
.
          MATCH     ALBIL005,Z70
          IF        !@EQUAL
            MOVE      ALBIL005,ALBIITEM
          ENDIF
.
          MATCH     ALBIL006,Z70
          IF        !@EQUAL
            MOVE      ALBIL006,ALBICDAT
          ENDIF
.
          MATCH     ALBIL007,Z70
          IF        !@EQUAL
            MOVE      ALBIL007,ALBICTIM
          ENDIF
.
          MATCH     ALBIL008,Z70
          IF        !@EQUAL
            MOVE      ALBIL008,ALBICUIT
          ENDIF
.
          MATCH     ALBIL009,Z70
          IF        !@EQUAL
            MOVE      ALBIL009,ALBIUDAT
          ENDIF
.
          MATCH     ALBIL010,Z70
          IF        !@EQUAL
            MOVE      ALBIL010,ALBIUTIM
          ENDIF
.
          MATCH     ALBIL011,Z70
          IF        !@EQUAL
            MOVE      ALBIL011,ALBIUUID
          ENDIF
.
MVALBI99  RETURN
.
.------------------------------------------------------------
.  Outputs a selection list of Department type
.  Tag Parameter 0=Description
.                1=Code
.                2=Selection List
.----------------------------------------------------------------
ALDPSL00  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,ALDPSL20,ALDPSL50
.
          MOVE      "CG",CATEGORY
          MOVE      ALBIDEPT,CODE
          CALL      GETCOD00
          WRITE     HTMLFILE;TDESC;
          GOTO      ALDPSL99
.
ALDPSL20  PACK      CODE,ALBIDEPT,SP70
          WRITE     HTMLFILE;CODE;
          GOTO      ALDPSL99
.
ALDPSL50  PACK      PTCDKEY2,ANSC,ANSG,SP70
          CALL      RDSCODE2                      * positional read
ALDPSL60  CALL      RDKCODE2                      * read a record
          BRANCH    OVRCD,ALDPSL99
.
          MATCH     "CG",TCODE
          GOTO      ALDPSL99 IF NOT EQUAL
.
          PACK      KEY3,ACODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALDPSL60
.
          MATCH     "1",ALDEACTV
          GOTO      ALDPSL60 IF EQUAL
.
          MATCH     ALBIDEPT,ALDEDEPT
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",ALDEDEPT," selected>":
                                TDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",ALDEDEPT,">":
                                TDESC,"</option>"
          ENDIF
          GOTO      ALDPSL60
.
ALDPSL99

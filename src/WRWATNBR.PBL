.*************************************************************************
.*                             WRWATNBR                                  *
.*                    Write a watnbraf record                            *
.*                                                                       *
.*                                                                       *
.*        WTNBRSFL must be set to Y or N                                 *
.*        WTNBRTYP must be set to C,D or E (change,delete,erase)         *
.*                                                                       *
.* Modifications:                                                        *
.*      V9.02.01  30/01/2003  Sandra Barcham CAR 35840                   *
.*                Added  Read before write                               *
.*      V5.08.01  16/06/2000  Tonii                                      *
.*                Commented out fields WTNBDTCG,WTNBDTBM,WTNBDTBT, no    *
.*                longer available                                       *
.*                                                                       *
.*************************************************************************
.
WRWATNBR
WRNBR000  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,SEVENTY9;*138,PTCNURHA
.
          COMPARE   ONE,PTCNURHA
          GOTO      WRNBR999 IF NOT EQUAL
.
          OPEN      WATNBRA1,"watnbraf"
.
          PACK      KEY5,ANSW,ANSU,WMUNIT
          CALL      RDCODE1
          MATCH     ANSN,TCINDC2
          IF        @EQUAL
            GOTO      WRNBR999
          ENDIF
.
          MOVE      WMURNO,WTNBURNO           * UR number
          MOVE      WMCODE,WTNBCODE           * procedure code
          MOVE      DWMCNT,WTNBCNT            * procedure count
          CALL      IBACLOCK
          PACK      WTNBEDAT,CCC,CYY,CMM,CDD  * effective date
          REP       " 0",WTNBEDAT
          CLOCK     TIME,CTIMEIS
          MOVE      CTIMEIS,WTNBETIM          * effective time
          MOVE      WMBOOK,WTNBBNUM           * booking number
          MOVE      WMUDEF1,WTNBUDF1          * UDF 1
          MOVE      WMUDEF2,WTNBUDF2          * UDF 2
          MOVE      WMUDEF3,WTNBUDF3          * UDF 3
          MOVE      WMUDEF4,WTNBUDF4          * UDF 4
          MOVE      WMUDEF5,WTNBUDF5          * UDF 5
          MOVE      WMUDEF6,WTNBUDF6          * UDF 6
          MOVE      WMUDEF7,WTNBUDF7          * UDF 7
          MOVE      WMUDEF8,WTNBUDF8          * UDF 8
          MOVE      WTWMDRSA,WTNBDRSA         * date of referral for FSA
          MOVE      WTWMDOSA,WTNBDOSA         * date of FSA
.          MOVE      WTWMDTAD,WTNBDTCG         * date certainty given
.          MOVE      BKREADAT,WTNBDTBM         * date booking made
.          MOVE      BKREEDAT,WTNBDTBT         * date for treatment
          MOVE      WTWMPHSP,WTNBPHSP         * principal health purchaser
          MOVE      PTMIAGNC,WTNBTRAG         * treatment agency
.
          IF        WMSTAT = 4
            MOVE      ATYPE,WTNBPCHS          * atype for health specialty
          ELSE
            MOVE      WMPCAT,WTNBPCHS         * wmpcat health specialty
          ENDIF
.
          MOVE      WTWPHDPE,WTNBBPRO         * booked procedure
          MOVE      DDATE,WTNBDTEC            * date of exit
          MOVE      WMPTY,WTNBSPFL            * staged/planned flag
.
          PACK      KEY36,WTNBRSFL,WTNBURNO,WTNBCODE,WTNBCNT,WTNBEDAT,WTNBETIM
          CALL      RAWTNBR1
          IF        OVRCD=1
            CALL      WRWTNBR1            * write watnbraf
          ENDIF
.
WRNBR999  RETURN
+

.*****************************************************************************
.*  Print Invoice body                                                        *
.*                                                                            *
.* Modifications :                                                            *
.*                                                                            *
.*        V12.00.01 22/05/2025  J.Tan          TSK 0955096                    *
.*                  Added Alphanumeric visit number changes                   *
.*        V11.04.05 23/08/2024 J.Tan           TSK 0939432                    *
.*                  Mod printing item with zero quantity for Ind.billing      *
.*        V11.04.04 05/05/2024  J.Tan          TSK 0927259                    *
.*                  Mod checking for parameter 'Print claim' (PTCNPRCL) and   *
.*                  Print ICD10 (PTCNPICD - PRNTICDC)                         *
.*        V11.04.03 28/03/2024  J.Tan          TSK 0943340                    *
.*                  Mod Pendelbury to reprint MV to print Date for zero amount*
.*        V11.04.02 14/02/2024  J.Tan          TSK 0942477                    *
.*                  Mod Cabrini Accom. to print additional desc.(PTDTDES2)    *
.*        V11.04.01 05.02.2024  DA Sarkies     TSK 0936282                    *
.*                  Increased size if soaces going into the health fund var   *
.*        V11.03.01 15/06/2023  Bella Turco    TSK 0931756                    *
.*                  Changed item quantity NODAYS from 2 to 4 chars when       *
.*                  printed in SJOG invoices (PSJG2004)                       *
.*        V11.01.03 14/09/2021  Davin          TSK 0911277                    *
.*                  Increased print size of Gross Total,Line Total,GST Total  *
.*                  and Rate to 7.2 from 6.2 for RCH (PRCH0000)               *
.*        V11.01.02 30/08/2021  J.Tan          TSK 0910799                    *
.*                  Fixed printing Rreferring ADF                             *
.*        V11.01.01 03/08/2021  J.Tan          TSK 0909134                    *
.*                  Fixed printing no of days for SJOG accommodation          *
.*        V11.00.03 14/01/2021  J.Tan          TSK 0883075                    *
.*                  Mod to print Referring ADF Address lines                  *
.*        V11.00.02 14/10/2020  J.Tan          TSK 0894879                    *
.*                  Mod RCH Invoice to print 30 chars of Item description     *
.*        V11.00.01 04/03/2020  J.Tan          TSK 0838262                    *
.*                  Added Effective from and to date to MBS Item file         *
.*        V10.15.02 16/01/2020  J.Tan            TSK 0887166                  *
.*                  Fixed I*C rcpdteaf index 6                                *
.*        V10.15.01 13/01/2020  J.Tan            TSK 0883332                  *
.*                  Fixed MAXLINE - print multi page invoice WCOMP000 MTACC000*
.*        V10.14.01 20/03/2019  J.Tan            TSK 0857392                  *
.*                  Changed RCP Transaction count from DIM3 to DIM5           *
.*        V10.07.02 29/01/2016  J.Tan         CAR 303942                      *
.*                  Mods for Payment types                                    *
.*        V10.07.01 18/11/2015  J.Tan         CAR 303942                      *
.*                  Added new payment types                                   *
.*        V10.06.02 07/08/2015  Davin          CAR 317002                     *
.*                  Print pmexname instead of pmexicon for ADF MO (defc0000)  *
.*        V10.06.01 02/04/2015  Ania P         CAR 313236                     *
.*                  Removed "I" from "PMIKeys"                                *
.*        V10.05.02 12/01/2014  Peter Vela     CAR 310738                     *
.*                  Changed Contact to Referring ADF MO                       *
.*        V10.05.01 29/10/2014  J.Tan          CAR 307268                     *
.*                  Mods Mechanical Vent. item to print/display MV From date  *
.*        V10.04.04 29/09/2014  J.Tan          CAR 291619                     *
.*                  Mods Mechanical Vent. for reprinting invoice              *
.*        V10.04.03 27/02/2014  J.Tan          CAR 275810                     *
.*                  Mods printing details for Defence force claim             *
.*        V10.04.01 03/01/2013  J.Tan          CAR 273713                     *
.*                  Mods to print payment types of a Receipt                  *
.*        V10.03.12 07/11/2012  J.Tan          CAR 283618                     *
.*                  Mods for Independence Services Billing                    *
.*        V10.03.11 16/10/2012  J.Tan          CAR 274111                     *
.*                  Fixed to include Credit notes for Reprint West Wimmera Inv*
.*        V10.03.10 12/10/2012  J.Tan          CAR 274381                     *
.*                  Mods printing Accom.desc.for PTCNIDES=0                   *
.*        V10.03.09 07/08/2012  J.Tan          CAR 268874                     *
.*                  Fixed printing West Wimmera Invoice layout                *
.*        V10.03.08 25/07/2012  J.Tan          CAR 266612                     *
.*                  Mods Cabrini item to print rates intead of TotalAmt-No GST*
.*        V10.03.07 02/05/2012  J.Tan          CAR 264231                     *
.*                  Fixed printing HEC Event item code                        *
.*        V10.03.06 26/04/2012  J.Tan          CAR 264231                     *
.*                  Fixed printing HEC emergency invoice                      *
.*        V10.03.05 27/03/2012  J.Tan          CAR 262517                     *
.*                  Mods SJOG layout to print item rate                       *
.*        V10.03.04 21/03/2012  J.Tan          CAR 262115                     *
.*                  Mods STV layout to print quantity                         *
.*        V10.03.03 24/02/2012  J.Tan          CAR 260743                     *
.*                  Fixed non-banked deposit                                  *
.*        V10.03.02 03/02/2012  J.Tan          CAR 259576                     *
.*                  Fixed date after printing TAIL                            *
.*        V10.03.01 11/01/2012  J.Tan          CAR 257142                     *
.*                  Fixed hospital provider number for multi hospital         *
.*        V10.02.03 13/10/2011  J.Tan          CAR 253138                     *
.*                  Fixed printing claims for emergency                       *
.*        V10.02.02 04/10/2011  J.Tan          CAR 252508                     *
.*                  Fixed to deposits                                         *
.*        V10.02.01 29/09/2011  J.Tan          CAR 252227                     *
.*                  Fixed to print EMR Item for SJOG                          *
.*        V10.01.02 28/09/2011  J.Tan          CAR 252125                     *
.*                  Fixed to print claim details for SJOG                     *
.*        V10.01.01 28/03/2011  Mike Laming   CAR 240107                      *
.*                  Mods to PATECDaf & PATECOaf variables & Keys              *
.*****************************************************************************
.
PRTINVBD

.*******************************************************************************
.         Print line of invoice
.*******************************************************************************
PRLN0000  MOVE      ZERO,MECHVFLG
          IF        RECFLAG=2
            CALL      MVFL0000          * Move pmsmtiaf to patdtraf file
          ENDIF
          MOVE      LSTRATE,XLSTRATE
          MOVE      LINETOT,XLINETOT
          MOVE      LINEGST,XLINEGST
.
          IF        ISBLFLAG=1 & RECFLAG=2
            MATCH     "1",PTCNISBZ
            IF        @EQUAL
              COMPARE   ZERO,NODAYS
              GOTO      PRLN9999 IF EQUAL    * Item with zero quantity
            ENDIF
          ENDIF
.
          IF        NODAYS=0
            MOVE      ONE,NODAYS
          ENDIF
.
PRLN1200  PACK      DIM25,TDDESC,SP70
.
          MOVE      TOTGST,XTOTGST
          MOVE      GROSSTOT,XGROSTOT
.
.         RECFLAG  0-Print Lumpsum, 1-Accommodation, 2-Items, 3-Invoice total
.                  4-Cash, 5-Journals, 6-Credit Notes, 7-Estimate rebate
.
          MOVE      LINETOT,FORM12P2
          ADD       LINEGST,FORM12P2
          COMPARE   ZERO,RECFLAG
          GOTO      PRLN1400 IF EQUAL          * Lumpsum
          BRANCH    RECFLAG,PRLN1400,PRLN1400,PRLN1300
          GOTO      PRLN2000
.
PRLN1300  MOVE      GROSSTOT,FORM12P2
          ADD       TOTGST,FORM12P2
PRLN1400  MOVE      FORM12P2,LNTOTAL
          IF        ISBLFLAG=1 & RECFLAG=2
            MATCH     "1",PTCNISBZ
            IF        @EQUAL
              COMPARE   ZERO,NODAYS
              GOTO      PRLN9999 IF EQUAL        * item zero quantity
            ENDIF
            MOVE      DFDATE,ISBLDATE
            ADD       NODAYS,ISBLDATE
            MOVE      ISBLDATE,DTDATE
          ENDIF
.
PRLN2000  UNPACK    DFDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
.
          IF        PTCNINVL=24
            CALL      PSJG0000                  * SJOG
            GOTO      PRLN9999
          ENDIF
.
          IF        PTCNINVL=25
            CALL      PCBR0000                  * Cabrini
            GOTO      PRLN9999
          ENDIF
.
          COMPARE   ONE,RECFLAG
          GOTO      PRLN6000 IF NOT EQUAL     * Not an accommodation record
.
          IF        DCFLAG=1
            COMPARE   ZERO,NODAYS
            GOTO      PRLN9999 IF EQUAL
            GOTO      PRLN9999 IF LESS
          ELSE
            IF        CMXFLAG=1
              MATCH     ADATE,DDATE
              IF        @EQUAL
                COMPARE   ZERO,LSTRATE
                GOTO      PRLN9999 IF EQUAL   * daycase without daily charge
              ENDIF
            ENDIF
          ENDIF
.
PRLN6000  IF        PTCNINVL=14
            CALL      PRCH0000                 * RCH
            GOTO      PRLN9999
          ENDIF
.
          IF        PTCNINVL=19
            IF        PTCNINVB=1
              CALL      LAWS0000              * West wimmera landscape
            ELSE
              CALL      LAWW0000              * West wimmera landscapa with RHS
            ENDIF
            GOTO      PRLN9999
          ENDIF
.
          COMPARE   "11",PTCNINVL
          CALL      PHSP0000 IF EQUAL         * Holy Spirit
          COMPARE   "12",PTCNINVL
          CALL      PGRS0000 IF EQUAL         * Greenslopes
          COMPARE   "15",PTCNINVL
          CALL      PSTV0000 IF EQUAL         * St Vincent
          COMPARE   "16",PTCNINVL
          CALL      PPEN0000 IF EQUAL         * Pendlebury
          COMPARE   "18",PTCNINVL
          CALL      PHEC0000 IF EQUAL         * HEC
.
PRLN9999  RETURN
+
.*******************************************************************************
.         Move fields from pmsmtiaf to patdtraf for printing
.         EPSFLAG 1=Accom, 2=Theatre 3=Misc.Item 5=Cash 6=Journal 8=Procedure
.*******************************************************************************
MVFL0000  BRANCH    RPRTFLAG,MVFL1000        * Reprinting invoice
.
          MOVE      PMMIITEM,TITEMNO
          MOVE      PMMIITEM,PRTITCOD
          MOVE      PMMIDESC,TDDESC
          MOVE      PMMIDES2,PTDTDES2
          MOVE      PMMIRTYP,EPSFLAG
.
          MOVE      PMMISERV,TSERVS
          MATCH     "3",PMMIRTYP
          IF        @EQUAL
            MOVE      PMMIMVBR,MECHVFLG     * Mechanical vent billing
          ENDIF
          MOVE      PMMISVTM,ATDTSVTM
          MOVE      PMMIINCT,ATSPARE1
          GOTO      MVFL9999
.
.         Inpatient
.
MVFL1000  MOVE      TRECTYPE,EPSFLAG
          MOVE      TITEMNO,PRTITCOD
          BRANCH    PVITYPE,MVFL2000,MVFL3000
          MATCH     " 9",PTVITYPE
          GOTO      MVFL2000 IF EQUAL     * Event
.
          IF        TRECTYPE=3
            MOVE      PTDTEPSD,MECHVFLG     * Mechanical vent billing
          ENDIF
          GOTO      MVFL9999
.
.         Emergency
.
MVFL2000  MOVE      ATSERVS,TSERVS
          MOVE      ATITEMNO,PRTITCOD
          MOVE      ATDDESC,TDDESC
          IF        ATRECTYP=5
            MOVE      "8",EPSFLAG         * Procedures
          ENDIF
          GOTO      MVFL9999
.
.         Outpatient
.
MVFL3000  MOVE      OTSERVS,TSERVS
          MOVE      OTITEMNO,PRTITCOD
          MOVE      OTDDESC,TDDESC
          GOTO      MVFL9999
.
MVFL9999  RETURN
+
.*******************************************************************************
.         Print accommodation and items for Greenslopes (PTCNINVL=12)
.         PTCNINVB=2  ( Landscape with right hand side)
.*******************************************************************************
PGRS0000  BRANCH    RECFLAG,PGRS1000,PGRS2000,PGRS3000,PGRS4000,PGRS5000:
                            PGRS6000,PGRS7000
.
.         Print lumpsum
.
          CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *2,CPDATE:
                    *25,SAVDES1;
.
          IF        PTCNIDES=1
            CALL      PEOL0000
            CALL      CKTL0000     * check if tail needs to be printed
            PRINT     *25,SAVDES2;
          ENDIF
.
          IF        PTCNINVB=1
            PRINT     *96,XLINETOT:
                      *107,XLINEGST,*123,LNTOTAL;
          ELSE
            MOVE      XLINEGST,FORM62
            PRINT     *75,XLINETOT:
                      *85,FORM62,*94,LNTOTAL;
          ENDIF
          GOTO      PGRS9000
.
.         Print Accommodation
.
PGRS1000  CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *2,CPDATE;
.
          UNPACK    DTDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
.
          PRINT     *11,CPDATE;
          IF        NODAYS>0
            PRINT     *20,NODAYS;
          ENDIF
          PRINT     *25,TDDESC;
.
          IF        PTCNINVB=1
            PRINT     *85,XLSTRATE,*96,XLINETOT:
                      *107,XLINEGST,*123,LNTOTAL;
          ELSE
            MOVE      XLINEGST,FORM62
            PRINT     *64,XLSTRATE,*75,XLINETOT:
                      *85,FORM62,*94,LNTOTAL;
          ENDIF
          GOTO      PGRS9000
.
.         Print Items
.
PGRS2000  CALL      CKTL0000     * check if tail needs to be printed
          IF        MECHVFLG=1 & RPRTFLAG=0
            PRINT     *2,CPDATE:
                      *20,MVDAYS;
          ELSE
            MOVE      NODAYS,F3
            IF        MECHVFLG=1
              IF        LNTOTAL<>0
                PRINT     *2,CPDATE:
                          *20,F3;
              ENDIF
            ELSE
              PRINT     *2,CPDATE:
                        *20,F3;
            ENDIF
          ENDIF
.
          IF        EPSFLAG=2 & PTMBSINV=1
            PRINT     *25,"THEATRE FEE ";
          ELSE
            PRINT     *25,DIM25;
          ENDIF
          PRINT     *51,PRTITCOD;
.
          IF        PTCNINVB=1
            PRINT     *96,XLINETOT:
                      *107,XLINEGST,*123,LNTOTAL;
          ELSE
            MOVE      XLINEGST,FORM62
            PRINT     *64,XLSTRATE:
                      *75,XLINETOT:
                      *85,FORM62,*94,LNTOTAL;
          ENDIF
          GOTO      PGRS9000
.
.         Invoice total
.
PGRS3000  MOVE      MAXLINE,FORM2
          SUB       ONE,FORM2
          COMPARE   FORM2,COUNT
          CALL      TAIL IF NOT LESS
          IF        PTCNINVB=1
            PRINT     *123,"----------":
                      *N,*25,IVTOTDES,*96,XGROSTOT:
                      *107,XTOTGST,*123,LNTOTAL;
          ELSE
            MOVE      XTOTGST,FORM62
            PRINT     *94,"----------":
                      *N,*25,IVTOTDES,*75,XGROSTOT:
                      *85,FORM62,*94,LNTOTAL;
          ENDIF
          ADD       ONE,COUNT
          GOTO      PGRS9000
.
.         Cash
.
PGRS4000  BRANCH    RPRTFLAG,PGRS4100      * reprint invoice
          BRANCH    PLINFLAG,PGRS4120
          CALL      CKTL0000     * check if tail needs to be printed
          IF        PTCNINVB=1
            PRINT     *2,CPDATE:
                      *25,"PAYMENT RECEIVED WITH THANKS",KEY3:
                      *123,LNTOTAL;
          ELSE
            PRINT     *2,CPDATE:
                      *25,"PAYMENT RECEIVED WITH THANKS",KEY3:
                      *94,LNTOTAL;
          ENDIF
          GOTO      PGRS9000
.
.         Cash details for reprint invoice
.
PGRS4100  BRANCH    PLINFLAG,PGRS4200,PGRS9999
PGRS4120  CALL      CKTL0000     * check if tail needs to be printed
          MOVE      DIM14,DIM6               * Payment type
          MOVE      DIM25,KEY24
          IF        PTCNINVB=1
            PRINT     *2,CPDATE:
                      *25,KEY24,*50,TRECEIPT:
                      *62,DIM6,DEFINDIC,*123,LNTOTAL;
          ELSE
            PRINT     *2,CPDATE:
                      *25,DIM25,*75,TRECEIPT:
                      *87,DIM6,DEFINDIC,*94,LNTOTAL;
          ENDIF
          GOTO      PGRS9000
.
.         Cash total for reprint invoice
.
PGRS4200  IF        PTCNINVB=1
            MOVE      MAXLINE,FORM2
            SUB       ONE,FORM2
            COMPARE   FORM2,COUNT
            CALL      TAIL IF NOT LESS
            PRINT     *123,"----------":
                      *N,*52,"Payment Total",*123,LNTOTAL;
            ADD       ONE,COUNT
          ELSE
            CALL      CKTL0000     * check if tail needs to be printed
            PRINT     *64,"Payment Total",*94,LNTOTAL;
          ENDIF
          GOTO      PGRS9000
.
.         Journals
.
PGRS5000  BRANCH    PLINFLAG,PGRS5100
          CALL      CKTL0000     * check if tail needs to be printed
          IF        PTCNINVB=1
            PRINT     *2,CPDATE:
                      *25,DIM25,*50,TRECEIPT,*62,DIM6;
            IF        PTDTGSTM <> 0
              MOVE      PTDTGSTM,FORM7P2
              PRINT     *107,LNTOTAL;
            ENDIF
            PRINT     *123,FORM7P2;
          ELSE
            PRINT     *2,CPDATE:
                      *25,DIM25,*64,TRECEIPT,*76,DIM6;
            IF        PTDTGSTM <> 0
              MOVE      PTDTGSTM,FORM62
              PRINT     *85,FORM62;
            ENDIF
            PRINT     *94,LNTOTAL;
          ENDIF
          GOTO      PGRS9000
.
PGRS5100  MOVE      MAXLINE,FORM2
          SUB       ONE,FORM2
          COMPARE   FORM2,COUNT
          CALL      TAIL IF NOT LESS
.
          IF        PTCNINVB=1
            PRINT     *123,"----------":
                      *N,*52,"Adjustment Total",*123,LNTOTAL;
          ELSE
            PRINT     *94,"----------":
                      *N,*64,"Adjustment Total",*94,LNTOTAL;
          ENDIF
          ADD       ONE,COUNT
          GOTO      PGRS9000
.
.         Credit Notes
.
PGRS6000  CALL      CKTL0000     * check if tail needs to be printed
          IF        PTCNINVB=1
            PRINT     *51,"Credit Note Total",*123,LNTOTAL;
          ELSE
            PRINT     *51,"CREDIT NOTE TOTAL",*94,LNTOTAL;
          ENDIF
          GOTO      PGRS9000
.
.         Estimate rebate
.
PGRS7000  MOVE      MAXLINE,FORM2
          SUB       ONE,FORM2
          COMPARE   FORM2,COUNT
          CALL      TAIL IF NOT LESS
.
          SUB       PTINPMAM,REBTOT
          IF        PTCNINVB=1
            PRINT     *52,"ESTIMATE REBATE",*123,LNTOTAL,*N:
                      *52,"Patient Moiety       ",*118,PTINPMAM;
          ELSE
            PRINT     *64,"ESTIMATE REBATE",*94,LNTOTAL,*N;
            MOVE      PTINPMAM,LNTOTAL
            PRINT     *64,"Patient Moiety       ",*94,LNTOTAL;
          ENDIF
          ADD       ONE,COUNT
          GOTO      PGRS9000
.
PGRS9000  CALL      PEOL0000
PGRS9999  RETURN
+
.*******************************************************************************
.         Print accommodation and items for RCH (PTCNINVL=14)
.*******************************************************************************
PRCH0000  BRANCH    RECFLAG,PRCH1000,PRCH2000,PRCH3000,PRCH4000,PRCH5000:
                            PRCH6000,PRCH7000
.
.         Lumpsum
.
          CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *1,CPDATE,*23,SAVDES1;
.
          IF        PTCNIDES=1
            CALL      PEOL0000
            CALL      CKTL0000     * check if tail needs to be printed
            PRINT     *25,SAVDES2;
          ENDIF
.
          CALL      PEOL0000
          CALL      CKTL0000
          MOVE      LINETOT,FORM7P2
          PRINT     *48,FORM7P2;
          MOVE      LINEGST,FORM7P2
          PRINT     *58,FORM7P2;
          PRINT     *70,LNTOTAL;
          GOTO      PRCH9000
.
.         Accommodation
.
PRCH1000  CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *1,CPDATE;
.
          MOVE      NODAYS,F3
          UNPACK    DTDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     *10,CPDATE:
                    *19,F3:
                    *23,TDDESC;
.
          IF        PTCNIDES=1
            CALL      PEOL0000
            CALL      CKTL0000
            PRINT     *23,PTDTDES2;
          ENDIF
          BRANCH    PRTIFLAG,PRCH9000
.
          CALL      PEOL0000
          CALL      CKTL0000
          MOVE      LSTRATE,FORM7P2
          PRINT     *22,FORM7P2;
          MOVE      LINETOT,FORM7P2
          PRINT     *48,FORM7P2;
          MOVE      LINEGST,FORM7P2
          PRINT     *58,FORM7P2;
          PRINT     *70,LNTOTAL;
.
          GOTO      PRCH9000
.
.         Items
.
PRCH2000  CALL      CKTL0000     * check if tail needs to be printed
          COMPARE   EIGHT,EPSFLAG
          GOTO      PRCH2100 IF EQUAL      * Procedures
.
          MOVE      TDDESC,DIM25
          PRINT     *1,CPDATE:
                    *18,NODAYS;
.
          IF        PRTIFLAG=1
            PRINT     *24,PRTITCOD;
            GOTO      PRCH9000
          ENDIF
.
.         print MBS on one line
.
          IF        EPSFLAG=2
            PRINT     *24,PRTITCOD;
            MOVE      LINETOT,FORM7P2
            PRINT     *48,FORM7P2;
            MOVE      LINEGST,FORM7P2
            PRINT     *58,FORM7P2;
            PRINT     *70,LNTOTAL;
            GOTO      PRCH9000
          ELSE
            PRINT     *24,TDDESC,*56,PRTITCOD;
          ENDIF
.
          CALL      PEOL0000
          CALL      CKTL0000
          MOVE      LSTRATE,FORM7P2
          PRINT     *24,FORM7P2;
          MOVE      LINETOT,FORM7P2
          PRINT     *48,FORM7P2;
          MOVE      LINEGST,FORM7P2
          PRINT     *58,FORM7P2;
          PRINT     *70,LNTOTAL;
          GOTO      PRCH9000
.
.         Procedures
.
PRCH2100  PRINT     *1,CPDATE;
          IF        ATSPARE1=1
            PRINT     *10,ATDTSVTM;
          ENDIF
.
          PACK      KEY8,TRECEIPT
          PRINT     *18,TDDESC,*49,PRTITCOD,*60,KEY8,*70,LNTOTAL;
          GOTO      PRCH9000
.
.         Invoice total
.
PRCH3000  MOVE      MAXLINE,FORM2
          SUB       ONE,FORM2
          COMPARE   FORM2,COUNT
          CALL      TAIL IF NOT LESS
.
          MOVE      IVTOTDES,KEY15
          MOVE      GROSSTOT,FORM7P2
          PRINT     *70,"----------":
                    *N,*24,KEY15,*48,FORM7P2;
          MOVE      TOTGST,FORM7P2
          PRINT     *58,FORM7P2,*70,LNTOTAL;
          ADD       ONE,COUNT
          GOTO      PRCH9000
.
.         Cash
.
PRCH4000  CALL      CKTL0000     * check if tail needs to be printed
          BRANCH    RPRTFLAG,PRCH4100
          BRANCH    PLINFLAG,PRCH4120
          PRINT     *1,CPDATE:
                    *23,"PAYMENT RECEIVED WITH THANKS":
                    *70,LNTOTAL;
          GOTO      PRCH9000
.
PRCH4100  
.         BRANCH    PLINFLAG,PRCH4200
          BRANCH    PLINFLAG,PRCH9999,PRCH9999
PRCH4120  MOVE      DIM14,DIM6               * Payment type
          UNPACK    DIM25,DIM21
          PRINT     *1,CPDATE:
                    *24,DIM21,*46,TRECEIPT,DEFINDIC:
                    *62,DIM6,*70,LNTOTAL;
          GOTO      PRCH9000
.
PRCH4200  MOVE      MAXLINE,FORM2
          SUB       ONE,FORM2
          COMPARE   FORM2,COUNT
          CALL      TAIL IF NOT LESS
.
          PRINT     *70,"----------":
                    *N,*54,"Payment Total",*70,LNTOTAL;
          ADD       ONE,COUNT
          GOTO      PRCH9000
.
.         Journals
.
PRCH5000  
.         BRANCH    PLINFLAG,PRCH5100
          BRANCH    PLINFLAG,PRCH9999
          CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *1,CPDATE:
                    *24,DIM25,*50,TRECEIPT,*63,DIM6,*70,LNTOTAL;
          GOTO      PRCH9000
.
PRCH5100  MOVE      MAXLINE,FORM2
          SUB       ONE,FORM2
          COMPARE   FORM2,COUNT
          CALL      TAIL IF NOT LESS
          PRINT     *70,"----------":
                    *N,*54,"Adjustment Total",*70,LNTOTAL;
          ADD       ONE,COUNT
          GOTO      PRCH9000
.
PRCH6000  CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *51,"CREDIT NOTE TOTAL",*70,LNTOTAL;
          GOTO      PRCH9000
.
PRCH7000 
          GOTO      PRCH9999
.
PRCH9000  CALL      PEOL0000
PRCH9999  RETURN
+
.*******************************************************************************
.         Print accommodation and items for STV (PTCNINVL=15)
.*******************************************************************************
PSTV0000  BRANCH    RECFLAG,PSTV1000,PSTV2000,PSTV3000,PSTV4000,PSTV5000:
                            PSTV6000,PSTV7000
.
.         Lumpsum
.
          CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *1,CPDATE,*23,SAVDES1;
.
          IF        PTCNIDES=1
            CALL      PEOL0000
            CALL      CKTL0000     * check if tail needs to be printed
            PRINT     *25,SAVDES2;
          ENDIF
.
          CALL      PEOL0000
          PRINT     *60,XLINETOT:
                    *69,LNTOTAL;
          GOTO      PSTV9000
.
.         Accommodation
.
PSTV1000  CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *1,CPDATE;
.
          UNPACK    DTDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT    *10,CPDATE:
                   *18,NODAYS:
                   *23,TDDESC;
.
          BRANCH    PRTIFLAG,PSTV9000
.
          CALL      PEOL0000
          PRINT     *60,XLSTRATE:
                    *69,LNTOTAL;
          GOTO      PSTV9000
.
.         Items
.
PSTV2000  CALL      CKTL0000     * check if tail needs to be printed
          COMPARE   EIGHT,EPSFLAG
          GOTO      PSTV2100 IF EQUAL    * procedure
.
          IF        MECHVFLG=1 & RPRTFLAG=0
            PRINT     *1,CPDATE:
                      *17,MVDAYS;
          ELSE
            IF        MECHVFLG=1
              IF        LNTOTAL<>0
                PRINT     *1,CPDATE:
                          *17,TSERVS;
              ENDIF
            ELSE
              IF        TSERVS=0
                MOVE      ONE,TSERVS
              ENDIF
              PRINT     *1,CPDATE:
                        *17,TSERVS;
            ENDIF
          ENDIF
.
          IF        EPSFLAG=2 & PTMBSINV=1
            PRINT     *23,"THEATRE FEE ";
          ELSE
            PRINT     *23,DIM25;
          ENDIF
          PRINT     *55,PRTITCOD;
.
          BRANCH    PRTIFLAG,PSTV9000
          CALL      PEOL0000
          CALL      CKTL0000     * check if tail needs to be printed
.
          PRINT     *69,LNTOTAL;
          GOTO      PSTV9000
.
.         Procedure
.
PSTV2100  PRINT     *2,CPDATE;
          IF        ATSPARE1=1
            PRINT     *10,ATDTSVTM;
          ENDIF
.
          PACK      KEY8,TRECEIPT
          PRINT     *18,TDDESC,*49,PRTITCOD,*60,KEY8,*69,LNTOTAL;
          GOTO      PSTV9000
.
.         Invoice total
.
PSTV3000  MOVE      MAXLINE,FORM2
          SUB       ONE,FORM2
          COMPARE   FORM2,COUNT
          CALL      TAIL IF NOT LESS
.
          PRINT     *69,"----------":
                    *N,*23,IVTOTDES:
                    *69,LNTOTAL;
          ADD       ONE,COUNT
          GOTO      PSTV9000
.
.         Cash
.
PSTV4000  CALL      CKTL0000     * check if tail needs to be printed
          BRANCH    RPRTFLAG,PSTV4100
          BRANCH    PLINFLAG,PSTV4120
          PRINT     *2,CPDATE:
                    *25,"PAYMENT RECEIVED WITH THANKS":
                    *69,LNTOTAL;
          GOTO      PSTV9000
.
.         Cash details on reprint
.
PSTV4100  BRANCH    PLINFLAG,PSTV4200,PSTV9999
PSTV4120  MOVE      DIM14,DIM6               * Payment type
          PRINT     *1,CPDATE:
                    *23,DIM25,*50,TRECEIPT,*62,DIM6,DEFINDIC:
                    *69,LNTOTAL;
          GOTO      PSTV9000
.
.         Cash total on reprint
.
PSTV4200  MOVE      MAXLINE,FORM2
          SUB       ONE,FORM2
          COMPARE   FORM2,COUNT
          CALL      TAIL IF NOT LESS
.
          PRINT     *69,"----------":
                    *N,*52,"Payment Total",*69,LNTOTAL;
          ADD       ONE,COUNT
          GOTO      PSTV9000
.
.         Journals
.
PSTV5000  BRANCH    PLINFLAG,PSTV5100
          CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *1,CPDATE:
                    *23,DIM25,*50,TRECEIPT,*62,DIM6,*69,LNTOTAL;
          GOTO      PSTV9000
.
PSTV5100  MOVE      MAXLINE,FORM2
          SUB       ONE,FORM2
          COMPARE   FORM2,COUNT
          CALL      TAIL IF NOT LESS
          PRINT     *69,"----------":
                    *N,*52,"Adjustment Total",*69,LNTOTAL;
          ADD       ONE,COUNT
          GOTO      PSTV9000
.
.         Credit Note
.
PSTV6000  CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *51,"CREDIT NOTE TOTAL",*69,LNTOTAL;
          GOTO      PSTV9000
.
PSTV7000
          GOTO      PSTV9999
.
PSTV9000  CALL      PEOL0000
PSTV9999  RETURN
+
.*******************************************************************************
.         Print accommodation and items for HSP - PTCNINVL=11
.*******************************************************************************
PHSP0000  BRANCH    RECFLAG,PHSP1000,PHSP2000,PHSP3000,PHSP4000,PHSP5000:
                            PHSP6000,PHSP7000
.         Lumpsum
.
          CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *2,CPDATE:
                    *25,SAVDES1;
.
          IF        PTCNIDES=1
            CALL      PEOL0000
            CALL      CKTL0000     * check if tail needs to be printed
            PRINT     *25,SAVDES2;
          ENDIF
.
          CALL      PEOL0000
          PRINT     *39,XLINETOT:
                    *53,XLINEGST,*69,LNTOTAL;
          GOTO      PHSP9000
.
PHSP1000  CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *2,CPDATE;
.
          UNPACK    DTDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     *12,CPDATE,*20,NODAYS:
                    *25,TDDESC;
.
          IF        PTCNIDES=1
            CALL      PEOL0000
            CALL      CKTL0000     * check if tail needs to be printed
            PRINT     *25,PTDTDES2;
          ENDIF
.
          CALL      PEOL0000
          CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *25,XLSTRATE,*39,XLINETOT:
                    *53,XLINEGST,*69,LNTOTAL;
          GOTO      PHSP9000
.
PHSP2000  CALL      CKTL0000     * check if tail needs to be printed
          COMPARE   EIGHT,EPSFLAG
          GOTO      PHSP2100 IF EQUAL     * Procedures
.
          IF        MECHVFLG=1 & RPRTFLAG=0
            PRINT     *2,CPDATE:
                      *20,MVDAYS;
          ELSE
            IF        MECHVFLG=1
              IF        LNTOTAL<>0
                PRINT     *2,CPDATE:
                          *20,NODAYS;
              ENDIF
            ELSE
              PRINT     *2,CPDATE:
                        *20,NODAYS;
            ENDIF
          ENDIF
.
          IF        EPSFLAG=2 & PTMBSINV=1
            PRINT     *25,"THEATRE FEE ";
          ELSE
            PRINT     *25,DIM25;
          ENDIF
          PRINT     *51,PRTITCOD;
.
          CALL      PEOL0000
          CALL      CKTL0000     * check if tail needs to be printed
          IF        TSERVS<>0
            MOVE      LSTRATE,FORM52
            PRINT     *25,FORM52;     * single unit price
          ENDIF
.
          PRINT     *39,XLINETOT:
                    *53,XLINEGST,*69,LNTOTAL;
          GOTO      PHSP9000
.
.         Procedures
.
PHSP2100  PRINT     *2,CPDATE;
          IF        ATSPARE1 =1
            PRINT     *10,ATDTSVTM;
          ENDIF
.
          PACK      KEY8,TRECEIPT
          PRINT     *18,TDDESC,*49,PRTITCOD,*60,KEY8,*69,LNTOTAL;
          GOTO      PHSP9000
.
.         Invoice total
.
PHSP3000  BRANCH    PVITYPE,PHSP9999,PHSP3200
          CALL      CKTL0000     * check if tail needs to be printed
          MOVE      MAXLINE,FORM2
          SUB       ONE,FORM2
          COMPARE   FORM2,COUNT
          CALL      TAIL IF NOT LESS
.
          MOVE      IVTOTDES,KEY14
          PRINT     *69,"----------":
                    *N,*25,KEY14,*39,XGROSTOT:
                    *53,XTOTGST,*69,LNTOTAL;
          ADD       ONE,COUNT
          GOTO      PHSP9000
.
.         Outpatient
.
PHSP3200  CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *34,IVTOTDES:
                    *49,XGROSTOT,*59,XTOTGST,*70,LNTOTAL;
          GOTO      PHSP9000
.
.         Cash
.
PHSP4000  CALL      CKTL0000     * check if tail needs to be printed
          BRANCH    RPRTFLAG,PHSP4100
          BRANCH    PLINFLAG,PHSP4120
          PRINT     *2,CSDAY,SLASH,CSMON,SLASH,CSYEAR:
                    *25,"PAYMENT RECEIVED WITH THANKS":
                    *69,LNTOTAL:
                    *75,KEY3;
          GOTO      PHSP9000
.
.         Cash details for reprint invoice
.
PHSP4100  BRANCH    PLINFLAG,PHSP4200,PHSP9999
PHSP4120  MOVE      DIM14,DIM6               * Payment type
          MOVE      DIM25,DIM21
          PRINT    *2,CPDATE:
                   *25,DIM21,*50,TRECEIPT,*62,DIM6,DEFINDIC,*69,LNTOTAL;
          GOTO      PHSP9000
.
.         Cash total for reprint invoice
.
PHSP4200  MOVE      MAXLINE,FORM2
          SUB       ONE,FORM2
          COMPARE   FORM2,COUNT
          CALL      TAIL IF NOT LESS
          PRINT     *69,"----------":
                    *N,*52,"Payment Total",*69,LNTOTAL;
          ADD       ONE,COUNT
          GOTO      PHSP9000
.
.         Journal
.
PHSP5000  BRANCH    PLINFLAG,PHSP5100
          CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *2,CPDATE:
                    *25,DIM25,*50,TRECEIPT,*62,DIM6,*69,LNTOTAL;
          GOTO      PHSP9000
.
PHSP5100  MOVE      MAXLINE,FORM2
          SUB       ONE,FORM2
          COMPARE   FORM2,COUNT
          CALL      TAIL IF NOT LESS
          PRINT     *69,"----------":
                    *N,*52,"Adjustment Total",*69,LNTOTAL;
          ADD       ONE,COUNT
          GOTO      PHSP9000
.
.         Credit Notes
.
PHSP6000  CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *51,"CREDIT NOTE TOTAL",*69,LNTOTAL;
          GOTO      PHSP9000
.
.         Estimate rebate
.
PHSP7000  CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *25,"ESTIMATE REBATE",*69,LNTOTAL;
          GOTO      PHSP9000
.
PHSP9000  CALL      PEOL0000
PHSP9999  RETURN
+
.*******************************************************************************
.         Print accommodation and items for Pendlebury (PTCNINVL=16)
.*******************************************************************************
PPEN0000  BRANCH    RECFLAG,PPEN1000,PPEN2000,PPEN3000,PPEN4000,PPEN5000:
                            PPEN6000,PPEN7000
.
.         Lumpsum
.
          CALL      CKTL0000     * check if tail needs to be printed
.
          COMPARE   ONE,PTCNIDES
          GOTO      PPEN0200 IF NOT EQUAL      * Print one line of Accom.
.
          PRINT     *1,CPDATE,*25,SAVDES1;
.
          CALL      PEOL0000
          CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *23,SAVDES2;
          GOTO      PPEN0800
.
.         Print one line of Accommodation
.
PPEN0200  MOVE      SP70,KEY60
          CLEAR     KEY60
          APPEND    SAVDES1,KEY60
          MATCH     SP70,SAVDES2
          IF        !@EQUAL
            RESET     KEY60
            STRIP     KEY60
            ENDSET    KEY60
            APPEND    "/",KEY60
            APPEND    SAVDES2,KEY60
          ENDIF
          APPEND    SP70,KEY60
          RESET     KEY60
.
          PRINT     *1,CPDATE,*25,KEY60;
          GOTO      PPEN0800
.
PPEN0800  BRANCH    PRTIFLAG,PPEN9000
.
          CALL      PEOL0000
          CALL      CKTL0000
          PRINT     *47,XLINETOT,*57,XLINEGST:
                    *69,LNTOTAL;
          GOTO      PPEN9000
.
.         Accommodation
.
PPEN1000  CALL      CKTL0000     * check if tail needs to be printed
.
          COMPARE   ONE,PTCNIDES
          GOTO      PPEN1200 IF NOT EQUAL      * Print one line of Accom.
.
          PRINT     *1,CPDATE;
.
          UNPACK    DTDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     *12,CPDATE,*20,NODAYS,*25,TDDESC;
.
          CALL      PEOL0000
          CALL      CKTL0000
          PRINT     *25,PTDTDES2;
          GOTO      PPEN1800
.
PPEN1200  MOVE      SP70,KEY60
          CLEAR     KEY60
          APPEND    TDDESC,KEY60
          MATCH     SP70,PTDTDES2
          IF        !@EQUAL
            RESET     KEY60
            STRIP     KEY60
            ENDSET    KEY60
            APPEND    "/",KEY60
            APPEND    PTDTDES2,KEY60
          ENDIF
          APPEND    SP70,KEY60
          RESET     KEY60
.
          PRINT     *1,CPDATE;
.
          UNPACK    DTDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     *12,CPDATE,*20,NODAYS,*25,KEY60;
.
PPEN1800  BRANCH    PRTIFLAG,PPEN9000        * Reprint invoice without amount
.
          CALL      PEOL0000
          CALL      CKTL0000
          PRINT     *25,XLSTRATE,*47,XLINETOT:
                    *57,XLINEGST,*69,LNTOTAL;
          GOTO      PPEN9000
.
.         Items
.
PPEN2000  CALL      CKTL0000     * check if tail needs to be printed
          COMPARE   EIGHT,EPSFLAG
          GOTO      PPEN2100 IF EQUAL      * Procedure
.
          IF        MECHVFLG=1 & RPRTFLAG=0
            PRINT     *1,CPDATE:
                      *20,MVDAYS;
          ELSE
            IF        ISBLFLAG=1
              PRINT     *1,CPDATE;
              PACK      DTDATE,DTDATE,SP70
              MATCH     SP70,DTDATE
              IF        !@EQUAL
                UNPACK    DTDATE,CCENT,CYEAR,CMON,CDAY
                CALL      PACDATE
                PRINT     *12,CPDATE;
              ENDIF
              PRINT     *20,NODAYS;
            ELSE
              IF        MECHVFLG=1
                PRINT     *1,CPDATE:
                          *23,DIM25;
                GOTO      PPEN2040
              ELSE
                PRINT     *1,CPDATE:
                          *20,NODAYS;
              ENDIF
            ENDIF
          ENDIF
.
PPEN2020  PRINT     *25,DIM25;
PPEN2040  PRINT     *53,PRTITCOD;
.
          IF        EPSFLAG=2 & PTCNPRCL=1
            IF        CLAIM=1 | CLAIM=2
              PRINT     *62,"BAND:",XBANDING;    *  only for WC or TAC
            ENDIF
          ENDIF
.
          BRANCH    PRTIFLAG,PPEN9000        * Reprint invoice without amount
.
          CALL      PEOL0000
          CALL      CKTL0000
          PRINT     *25,XLSTRATE:
                    *47,XLINETOT,*57,XLINEGST:
                    *69,LNTOTAL;
          GOTO      PPEN9000
.
.         Procedures
.
PPEN2100  PRINT    *1,CPDATE;
.
          IF        ATSPARE1=1
            PRINT    *10,ATDTSVTM;           * print time
          ENDIF
.
          MOVE      TDDESC,KEY27
          PRINT     *25,KEY27,*53,PRTITCOD;
          CALL      PEOL0000
          CALL      CKTL0000
.
          PRINT     *47,XLINETOT,*57,XLINEGST:
                    *69,LNTOTAL;
          GOTO      PPEN9000
.
.         Invoice total
.
PPEN3000  MOVE      MAXLINE,FORM2
          SUB       ONE,FORM2
          COMPARE   FORM2,COUNT
          CALL      TAIL IF NOT LESS
.
          PRINT     *69,"----------":
                    *N,*25,IVTOTDES,*47,XGROSTOT:
                    *57,XTOTGST,*69,LNTOTAL;
          ADD       ONE,COUNT
          GOTO      PPEN9000
.
.         Cash
.
PPEN4000  BRANCH    RPRTFLAG,PPEN4100
          BRANCH    PLINFLAG,PPEN4120
          CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *2,CPDATE:
                    *25,"PAYMENT RECEIVED WITH THANKS",KEY3:
                    *69,LNTOTAL;
          GOTO      PPEN9000
.
.         Cash details on reprint invoice
.
PPEN4100  BRANCH    PLINFLAG,PPEN9999,PPEN9999
PPEN4120  MOVE      DIM14,DIM6               * Payment type
          UNPACK    DIM25,DIM21
          CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *1,CPDATE:
                    *25,DIM21,*46,TRECEIPT,DEFINDIC:
                    *62,DIM6,*69,LNTOTAL;
          GOTO      PPEN9000
.
.         Journals
.
PPEN5000  BRANCH    PLINFLAG,PPEN9999
          CALL      CKTL0000     * check if tail needs to be printed
          MOVE      DIM25,DIM24
          PRINT     *1,CPDATE:
                    *25,DIM24,*49,TRECEIPT,*61,DIM6,*69,LNTOTAL;
          GOTO      PPEN9000
.
.         Credit Notes
.
PPEN6000  CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *51,"CREDIT NOTE TOTAL",*69,LNTOTAL;
          GOTO      PPEN9000
.
.         Estimate rebate
.
PPEN7000  CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *25,"ESTIMATE REBATE",*69,LNTOTAL;
          GOTO      PPEN9000
.
PPEN9000  CALL      PEOL0000
PPEN9999  RETURN
+
.*******************************************************************************
.         Print accommodation and items for HEC (PTCNINVL=18)       
.*******************************************************************************
PHEC0000  BRANCH    RECFLAG,PHEC1000,PHEC2000,PHEC3000,PHEC4000,PHEC5000:
                            PHEC6000,PHEC7000
.
.         Lumpsum
.
          CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *1,CPDATE,*25,SAVDES1;
.
          IF        PTCNIDES=1
            CALL      PEOL0000
            CALL      CKTL0000     * check if tail needs to be printed
            PRINT     *23,SAVDES2;
          ENDIF
.
          BRANCH    PRTIFLAG,PHEC9000
.
          CALL      PEOL0000
          CALL      CKTL0000
          PRINT     *47,XLINETOT,*57,XLINEGST:
                    *69,LNTOTAL;
          GOTO      PHEC9000
.
.         Accommodation
.
PHEC1000  CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *1,CPDATE;
.
          UNPACK    DTDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     *12,CPDATE,*20,NODAYS,*25,TDDESC;
.
          IF        PTCNIDES=1
            CALL      PEOL0000
            CALL      CKTL0000
            PRINT     *25,PTDTDES2;
          ENDIF
.
          BRANCH    PRTIFLAG,PHEC9000        * Reprint invoice without amount
.
          CALL      PEOL0000
          CALL      CKTL0000
          PRINT     *25,XLSTRATE,*47,XLINETOT:
                    *57,XLINEGST,*69,LNTOTAL;
          GOTO      PHEC9000
.
.         Items
.
PHEC2000  CALL      CKTL0000     * check if tail needs to be printed
          BRANCH    PVITYPE,PHEC2100
          MATCH     " 9",PTVITYPE
          GOTO      PHEC2100 IF EQUAL        * Emergency event
.
          IF        MECHVFLG=1 & RPRTFLAG=0
            PRINT     *1,CPDATE:
                      *20,MVDAYS;
          ELSE
            IF        MECHVFLG=1
              IF        LNTOTAL<>0
                PRINT     *1,CPDATE:
                          *20,NODAYS;
              ENDIF
            ELSE
              PRINT     *1,CPDATE:
                        *20,NODAYS;
            ENDIF
          ENDIF
.
          PRINT     *25,DIM25,*53,PRTITCOD;
.
          IF        EPSFLAG=2 & PTCNPRCL=1
            IF        CLAIM=1 | CLAIM=2
              PRINT     *62,"BAND:",XBANDING;    *  only for WC or TAC
            ENDIF
          ENDIF
.
          BRANCH    PRTIFLAG,PHEC9000        * Reprint invoice without amount
.
          CALL      PEOL0000
          CALL      CKTL0000
          IF        EPSFLAG=3
            PRINT     *24,XLSTRATE;
          ENDIF
          PRINT     *47,XLINETOT,*57,XLINEGST:
                    *69,LNTOTAL;
          GOTO      PHEC9000
.
.         Procedure
.
PHEC2100   PRINT    *1,CPDATE,*10,PRTITCOD,*20,TDDESC:
                    *57,XLINEGST:
                    *69,LNTOTAL;
          GOTO      PHEC9000
.
.         Invoice total
.
PHEC3000  MOVE      MAXLINE,FORM2
          SUB       ONE,FORM2
          COMPARE   FORM2,COUNT
          CALL      TAIL IF NOT LESS
.
          BRANCH    PVITYPE,PHEC3100
          MATCH     " 9",PTVITYPE
          GOTO      PHEC3100 IF EQUAL        * Emergency event
.
          PRINT     *69,"----------":
                    *N,*25,IVTOTDES,*47,XGROSTOT:
                    *57,XTOTGST,*69,LNTOTAL;
          ADD       ONE,COUNT
          GOTO      PHEC9000
.
.         Emergency
.
PHEC3100  PRINT     *69,"----------":
                    *N,*25,IVTOTDES,*57,XLINEGST,*69,LNTOTAL;
          ADD       ONE,COUNT
          GOTO      PHEC9000
.
.         Cash
.
PHEC4000  BRANCH    RPRTFLAG,PHEC4100
          BRANCH    PLINFLAG,PHEC4120
          CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *2,CPDATE:
                    *25,"PAYMENT RECEIVED WITH THANKS",KEY3:
                    *69,LNTOTAL;
          GOTO      PHEC9000
.
.         Cash details on reprint invoice
.
PHEC4100  BRANCH    PLINFLAG,PHEC9999,PHEC9999
PHEC4120  MOVE      DIM14,DIM6               * Payment type
          UNPACK    DIM25,DIM21
          CALL      CKTL0000     * check if tail needs to be printed
          MOVE      DIM25,DIM21
          PRINT     *1,CPDATE:
                    *25,DIM21,*46,TRECEIPT,DEFINDIC:
                    *62,DIM6,*69,LNTOTAL;
          GOTO      PHEC9000
.
.         Journals
.
PHEC5000  BRANCH    PLINFLAG,PHEC9999
          CALL      CKTL0000     * check if tail needs to be printed
          MOVE      DIM25,DIM24
          PRINT     *1,CPDATE:
                    *25,DIM24,*49,TRECEIPT,*61,DIM6,*69,LNTOTAL;
          GOTO      PHEC9000
.
.         Credit Notes
.
PHEC6000  CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *51,"CREDIT NOTE TOTAL",*69,LNTOTAL;
          GOTO      PHEC9000
.
.         Estimate rebate
.
PHEC7000  CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *25,"ESTIMATE REBATE",*69,LNTOTAL;
          GOTO      PHEC9000
.
PHEC9000  CALL      PEOL0000
PHEC9999  RETURN
+
.*******************************************************************************
.         Print accommodation and items for SJOG
.*******************************************************************************
PSJG0000  CALL      CKTL0000     * check if tail needs to be printed
          BRANCH    RECFLAG,PSJG1000,PSJG2000,PSJG3000,PSJG4000,PSJG5000:
                            PSJG6000,PSJG7000
.
.         Lumpsum
.
          MOVE      SAVDES1,KEY25
          PRINT     *1,CPDATE,*20,KEY25;
.
          MOVE      LINETOT,FORM7P2
          MOVE      LINEGST,FORM52
          PRINT     *46,FORM7P2,*60,FORM52:
                    *68,LNTOTAL;
          GOTO      PSJG9000
.
.         Accommodation
.
PSJG1000  PRINT     *1,CPDATE;
.
          UNPACK    DTDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     *11,CPDATE:
                    *20,TADMTYP;
.
          MOVE      TDDESC,KEY16
          PRINT     *30,KEY16;
.
          MOVE      NODAYS,F3
          MOVE      XLINEGST,FORM52
          PRINT     *47,XLSTRATE:
                    *57,F3:
                    *60,FORM52:
                    *68,LNTOTAL;
          GOTO      PSJG9000
.
.         Items
.
PSJG2000  COMPARE   EIGHT,EPSFLAG
          GOTO      PSJG2010 IF EQUAL      * Emergency procedure
.
.         Is this a theatre item ?
.
          COMPARE   TWO,EPSFLAG
          GOTO      PSJG2004 IF NOT EQUAL  * must be misc.items
          PRINT     *1,CPDATE:
                    *20,"Theatre":
                    *30,PRTITCOD:
                    *47,XLSTRATE;
          GOTO      PSJG2006
.
PSJG2004  PRINT     *1,CPDATE;
          MOVE      TDDESC,KEY17
          PRINT     *20,PRTITCOD,*30,KEY17;
.
          MOVE      ZERO,FORM4
.         MOVE      NODAYS,F2
          MOVE      NODAYS,F4
.
          PRINT     *47,XLSTRATE,*56,F4;
.
PSJG2006  MOVE      XLINEGST,FORM52
          PRINT     *60,FORM52,*68,LNTOTAL;
          GOTO      PSJG9000
.
.         Procedures
.
PSJG2010  PRINT     *1,CPDATE,*10,ATDTSVTM,*20,PRTITCOD:
                    *47,XLSTRATE,*59,XLINEGST,*68,LNTOTAL;
          GOTO      PSJG9000
.
.         Invoice total
.
PSJG3000  MOVE      MAXLINE,FORM2
          SUB       ONE,FORM2
          COMPARE   FORM2,COUNT
          CALL      TAIL IF NOT LESS
          MOVE      IVTOTDES,KEY14
.
          BRANCH    PVITYPE,PSJG3100,PSJG3200
          MATCH     " 9",PTVITYPE
          GOTO      PSJG3100 IF EQUAL        * Emergency event
.
          PRINT     *68,"----------":
                    *N,*30,KEY14,*47,XGROSTOT:
                    *59,XTOTGST,*68,LNTOTAL;
          ADD       ONE,COUNT
          GOTO      PSJG9000
.
.         Emergency
.
PSJG3100  PRINT     *68,"----------":
                    *N,*30,KEY14,*47,XGROSTOT:
                    *59,XTOTGST,*68,LNTOTAL;
          ADD       ONE,COUNT
          GOTO      PSJG9000
.
.         Outpatient
.
PSJG3200  PRINT     *68,"----------":
                    *N,*30,KEY14:
                    *47,XGROSTOT,*59,XTOTGST,*68,LNTOTAL;
          ADD       ONE,COUNT
          GOTO      PSJG9000
.
.         Cash
.
PSJG4000  BRANCH    RPRTFLAG,PSJG4100
          BRANCH    PLINFLAG,PSJG4120
          PRINT     *1,CPDATE:
                    *30,"PAYMENT RECEIVED WITH THANKS",KEY3:
                    *68,LNTOTAL;
          GOTO      PSJG9000
.
.         Cash details on reprint invoice
.
PSJG4100  BRANCH    PLINFLAG,PSJG4200,PSJG4300
PSJG4120  MOVE      RCBDPAYD,KEY17
          PRINT     *1,CPDATE,*30,KEY17,*47,DIM14,*68,LNTOTAL;
          GOTO      PSJG9000
.
PSJG4200  MOVE      MAXLINE,FORM2
          SUB       ONE,FORM2
          COMPARE   FORM2,COUNT
          CALL      TAIL IF NOT LESS
          PRINT     *68,"----------":
                    *N,*30,"Payment Total",*68,LNTOTAL;
          ADD       ONE,COUNT
          GOTO      PSJG9000
.
PSJG4300  PRINT     *30,"Balance Payable",*63,NETTOT;
          GOTO      PSJG9000
.
.         Journals
.
PSJG5000  BRANCH    PLINFLAG,PSJG5100
          PRINT     *1,CPDATE:
                    *20,DIM25,*47,TRECEIPT,*60,DIM6,*68,LNTOTAL;
          GOTO      PSJG9000
.
PSJG5100  MOVE      MAXLINE,FORM2
          SUB       ONE,FORM2
          COMPARE   FORM2,COUNT
          CALL      TAIL IF NOT LESS
.
          PRINT     *68,"----------":
                    *N,*27,"Adjustment Total",*68,LNTOTAL;
          ADD       ONE,COUNT
          GOTO      PSJG9000
.
.         Credit notes
.
PSJG6000  PRINT     *30,"CREDIT NOTE NO.",PMCNCRNO,*68,LNTOTAL;
          GOTO      PSJG9000
.
.         Estimate rebate
.
PSJG7000  PRINT     *28,"Estimate Rebate",*68,LNTOTAL;
          GOTO      PSJG9000
.
PSJG9000  CALL      PEOL0000
PSJG9999  RETURN
+
.*******************************************************************************
.         Print accommodation and items for Cabrini
.*******************************************************************************
PCBR0000  CALL      CKTL0000     * check if tail needs to be printed
          BRANCH    RECFLAG,PCBR1000,PCBR2000,PCBR3000,PCBR4000,PCBR5000:
                            PCBR6000,PCBR7000
.
.         Lumpsum
.
          PRINT     *1,CPDATE,*19,SAVDES1;
          MOVE      LINETOT,FORM52
          MOVE      LNTOTAL,FORM62
          PRINT     *50,FORM52:
                    *63,XLINEGST:
                    *72,FORM62;
          GOTO      PCBR9000
.
.         Accommodation
.
PCBR1000  PRINT     *1,CPDATE;
.
          PACK      SDIM30,TDDESC,SP70
          STRIP     SDIM30
.
          MOVE      SP70,KEY30
          CLEAR     KEY30
          APPEND    SDIM30,KEY30
          APPEND    "/",KEY30
          APPEND    PTDTDES2,KEY30
          APPEND    SP70,KEY30
          RESET     KEY30
.
          UNPACK    DTDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     *10,CPDATE:
                    *19,KEY30;
.
          MOVE      NODAYS,F3
          MOVE      XLSTRATE,FORM52
          MOVE      LNTOTAL,FORM62
          PRINT     *50,FORM52:
                    *60,F3:
                    *63,XLINEGST:
                    *72,FORM62;
          GOTO      PCBR9000
.
PCBR2000  COMPARE   EIGHT,EPSFLAG
          GOTO      PCBR2100 IF EQUAL          * Procedures
.
          PRINT     *1,CPDATE;
          IF        EPSFLAG=2
            PRINT     *10,PRTITCOD:
                      *19,"Theatre":
                      *48,XLINETOT;
          ELSE
            MOVE      XLSTRATE,FORM52
            PRINT     *10,PRTITCOD,*19,TDDESC:
                      *50,FORM52;
          ENDIF
.
          MOVE      NODAYS,F3
          MOVE      LNTOTAL,FORM62
          PRINT     *60,F3:
                    *63,XLINEGST:
                    *72,FORM62;
          GOTO      PCBR9000
.
PCBR2100  MOVE     TDDESC,DIM20
          MOVE     XLSTRATE,FORM52
.
          MOVE     LNTOTAL,FORM62
          PRINT    *1,CPDATE,*10,ATDTSVTM:
                   *19,PRTITCOD,*29,DIM20:
                   *50,FORM52,*63,XLINEGST,*72,FORM62;
          GOTO      PCBR9000
.
.         End of invoice
.
PCBR3000  MOVE      MAXLINE,FORM2
          SUB       ONE,FORM2
          COMPARE   FORM2,COUNT
          CALL      TAIL IF NOT LESS
.
          BRANCH    PVITYPE,PCBR3100,PCBR3200
          MATCH     " 9",PTVITYPE
          GOTO      PCBR3100 IF EQUAL        * Emergency event
.
          PACK      KEY14,IVTOTDES,SP20
          MOVE      LNTOTAL,FORM62
          PRINT     *73,"--------":
                    *N,*19,KEY14,*49,XGROSTOT:
                    *63,XTOTGST,*72,FORM62;
          ADD       ONE,COUNT
          GOTO      PCBR9000
.
.         Emergency
.
PCBR3100  PRINT     *73,"--------":
                    *N,*19,IVTOTDES,*71,LNTOTAL;
          ADD       ONE,COUNT
          GOTO      PCBR9000
.
.         Outpatient
.
PCBR3200  MOVE      LNTOTAL,FORM62
          PRINT     *73,"--------":
                    *N,*19,IVTOTDES:
                    *49,XGROSTOT,*63,XTOTGST,*72,FORM62;
          ADD       ONE,COUNT
          GOTO      PCBR9000
.
.         Cash
.
PCBR4000  BRANCH    RPRTFLAG,PCBR4100
          BRANCH    PLINFLAG,PCBR4120
          PRINT     *1,CPDATE:
                    *19,"PAYMENT RECEIVED WITH THANKS",KEY3:
                    *71,LNTOTAL;
          GOTO      PCBR9000
.
.         Reprint invoice
.
PCBR4100  BRANCH    PLINFLAG,PCBR4200,PCBR4300
PCBR4120  UNPACK    RCBDPAYD,KEY30
          PRINT     *1,CPDATE,*19,KEY30,*50,DIM14,*71,LNTOTAL;
          GOTO      PCBR9000
.
PCBR4200  MOVE      MAXLINE,FORM2
          SUB       ONE,FORM2
          COMPARE   FORM2,COUNT
          CALL      TAIL IF NOT LESS
.
          PRINT     *73,"--------":
                    *N,*19,"Payment Total",*71,LNTOTAL;
          ADD       ONE,COUNT
          GOTO      PCBR9000
.
PCBR4300  PRINT     *19,"Balance Payable",*66,NETTOT;
          GOTO      PCBR9000
.
.         Journals
.
PCBR5000  BRANCH    PLINFLAG,PCBR5100
          PRINT     *1,CPDATE:
                    *19,TDDESC,*50,DIM6,*59,TRECEIPT,*71,LNTOTAL;
          GOTO      PCBR9000
.
PCBR5100  MOVE      MAXLINE,FORM2
          SUB       ONE,FORM2
          COMPARE   FORM2,COUNT
          CALL      TAIL IF NOT LESS
          PRINT     *73,"--------":
                    *N,*19,"Adjustment Total",*71,LNTOTAL;
          ADD       ONE,COUNT
          GOTO      PCBR9000
.
.         Credit notes
.
PCBR6000  MOVE      CREDTOT,LNTOTAL
          PRINT     *19,"Credit Note Total",*71,LNTOTAL;
          GOTO      PCBR9000
.
PCBR7000  PRINT     *19,"ESTIMATE REBATE",*71,LNTOTAL;
          GOTO      PCBR9000
.
PCBR9000  CALL      PEOL0000
PCBR9999  RETURN
+
.*******************************************************************************
.         Print West Wimmera Landscape PTCNINVB=1
.*******************************************************************************
LAWS0000  BRANCH    RECFLAG,LAWS1000,LAWS2000,LAWS3000,LAWS4000,LAWS5000:
                            LAWS6000,LAWS7000
.
.         Lumpsum
.
          CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *2,CPDATE:
                    *25,SAVDES1:
                    *97,XLINETOT:
                    *108,XLINEGST,*123,LNTOTAL;
          GOTO      LAWS9000
.
.         Accommodation
.
LAWS1000  CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *2,CPDATE;
.
          MOVE      NODAYS,F3
          UNPACK    DTDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     *12,CPDATE:
                    *21,F3:
                    *25,TDDESC:
                    *85,XLSTRATE,*97,XLINETOT:
                    *108,XLINEGST,*123,LNTOTAL;
.
          IF        PTCNIDES=1
            CALL      PEOL0000
            CALL      CKTL0000
            PRINT     *25,PTDTDES2;
          ENDIF
          GOTO      LAWS9000
.
.         Item
.
LAWS2000  CALL      CKTL0000     * check if tail needs to be printed
          BRANCH    PVITYPE,LAWS2100
          MATCH     " 9",PTVITYPE
          GOTO      LAWS2100 IF EQUAL    * Event
.
          MOVE      NODAYS,F3
          IF        MECHVFLG=1 & RPRTFLAG=0
            PRINT     *2,CPDATE:
                      *20,MVDAYS;
          ELSE
            IF        MECHVFLG=1
              IF        LNTOTAL<>0
                PRINT     *2,CPDATE:
                          *21,F3;
              ENDIF
            ELSE
              PRINT     *2,CPDATE:
                        *21,F3;
            ENDIF
          ENDIF
          IF        EPSFLAG=2 & PTMBSINV=1
            PRINT     *25,"THEATRE FEE ":
                      *58,PRTITCOD;
          ELSE
            PRINT     *25,TDDESC:
                      *58,PRTITCOD;
          ENDIF
.
          IF        EPSFLAG=3
            IF        TSERVS<>0
              MOVE      LSTRATE,FORM52
              PRINT     *85,FORM52;
            ENDIF
          ENDIF
.
          PRINT       *97,XLINETOT:
                      *108,XLINEGST,*123,LNTOTAL;
          GOTO      LAWS9000
.
LAWS2100  PRINT     *2,CPDATE,*20,NODAYS:   * MBS Desc.
                    *25,DIM25,*51,PRTITCOD:
                    *97,XLINETOT,*108,XLINEGST:
                    *123,LNTOTAL;
          GOTO      LAWW9000
.
.         Invoice total
.
LAWS3000  MOVE      MAXLINE,FORM2
          SUB       ONE,FORM2
          COMPARE   FORM2,COUNT
          CALL      TAIL IF NOT LESS
.
          CALL      CKTL0000     * check if tail needs to be printed
          BRANCH    PVITYPE,LAWS3100,LAWS3100
          PRINT     *123,"----------":
                    *N,*52,IVTOTDES:
                    *97,XGROSTOT:
                    *108,XTOTGST,*123,LNTOTAL;
          ADD       ONE,COUNT
          GOTO      LAWS9000
.
.         Emergency
.
LAWS3100  PRINT     *123,"----------":
                    *N,*25,IVTOTDES,*97,XGROSTOT:
                    *108,XTOTGST,*123,LNTOTAL;
          ADD       ONE,COUNT
          GOTO      LAWS9000
.
.         Cash
.
LAWS4000  
          BRANCH    RPRTFLAG,LAWS4100             * Reprint invoice
          BRANCH    PLINFLAG,LAWS4120
.
          CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *2,CPCDATE:
                    *25,"PAYMENT RECEIVED WITH THANKS":
                    *123,LNTOTAL;
          GOTO      LAWS9000
.
LAWS4100  BRANCH    PLINFLAG,LAWS4200,LAWS9999
LAWS4120  MOVE      DIM14,DIM6               * Payment type
          CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *2,CPDATE:
                    *25,DIM25,*50,TRECEIPT:
                    *62,DIM6,*123,LNTOTAL;
          GOTO      LAWS9000
.
LAWS4200  MOVE      MAXLINE,FORM2
          SUB       ONE,FORM2
          COMPARE   FORM2,COUNT
          CALL      TAIL IF NOT LESS
.
          PRINT     *123,"----------":
                    *N,*52,"Payment Total",*123,LNTOTAL;
          ADD       ONE,COUNT
          GOTO      LAWS9000
.
.         Journals
.
LAWS5000  BRANCH    PLINFLAG,LAWS5100
          CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *2,CPDATE:
                    *25,DIM25,*50,TRECEIPT,*62,DIM6;
          IF        PTDTGSTM <> 0
            MOVE      PTDTGSTM,FORM7P2
            PRINT     *108,FORM7P2;
          ENDIF
          PRINT     *123,LNTOTAL;
          GOTO      LAWS9000
.
LAWS5100  MOVE      MAXLINE,FORM2
          SUB       ONE,FORM2
          COMPARE   FORM2,COUNT
          CALL      TAIL IF NOT LESS
.
          PRINT     *123,"----------":
                    *N,*52,"Adjustment Total",*123,LNTOTAL;
          ADD       ONE,COUNT
          GOTO      LAWS9000
.
.         Credit notes
.
LAWS6000  CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *51,"Credit Note Total",*123,LNTOTAL;
          GOTO      LAWS9000
.
.         Estimate rebate
.
LAWS7000  CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *51,"ESTIMATE REBATE",*123,LNTOTAL;
          GOTO      LAWS9000
.
LAWS9000  CALL      PEOL0000
LAWS9999  RETURN
+
.*******************************************************************************
.         Print West Wimmera Lanscape with Right Hand Side PTCNINVB=2
.*******************************************************************************
LAWW0000  BRANCH    RECFLAG,LAWW1000,LAWW2000,LAWW3000,LAWW4000,LAWW5000:
                            LAWW6000,LAWW9999
.
.         Lumpsum
.
          CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *2,CPDATE:
                    *25,SAVDES1:
                    *75,XLINETOT:
                    *85,XLINEGST,*94,LNTOTAL;
          MOVE      SAVDES2,PTDTDES2
          GOTO      LAWW1800
.
.         Accommodation
.
LAWW1000  CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *2,CPDATE;
.
          MOVE      NODAYS,F3
          UNPACK    DTDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     *11,CPDATE:
                    *21,F3:
                    *25,TDDESC:
                    *64,XLSTRATE,*75,XLINETOT:
                    *85,XLINEGST,*94,LNTOTAL;
.
LAWW1800  IF        PTCNIDES=1
            CALL      PEOL0000
            CALL      CKTL0000
            PRINT     *25,PTDTDES2;
          ENDIF
          GOTO      LAWW9000
.
.         Item
.
LAWW2000  CALL      CKTL0000     * check if tail needs to be printed
          BRANCH    PVITYPE,LAWW2100
          MATCH     " 9",PTVITYPE
          GOTO      LAWW2100 IF EQUAL    * Event
.
          MOVE      NODAYS,F3
          IF        MECHVFLG=1 & RPRTFLAG=0
            PRINT     *2,CPDATE:
                      *20,MVDAYS;
          ELSE
            IF        MECHVFLG=1
              IF        LNTOTAL<>0
                PRINT     *2,CPDATE:
                          *21,F3;
              ENDIF
            ELSE
              PRINT     *2,CPDATE:
                        *21,F3;
            ENDIF
          ENDIF
          IF        EPSFLAG=2 & PTMBSINV=1
            PRINT     *25,"THEATRE FEE ":
                      *58,PRTITCOD;
          ELSE
            PRINT     *25,TDDESC:
                      *58,PRTITCOD;
          ENDIF
.
          IF        TSERVS<>0
            MOVE      LSTRATE,FORM52
            PRINT     *64,FORM52;
          ENDIF
.
          PRINT     *75,XLINETOT:
                    *85,XLINEGST,*94,LNTOTAL;
          GOTO      LAWW9000
.
.         Emergency
.
LAWW2100  MOVE      TDDESC,DIM25
          PRINT     *2,CPDATE,*20,NODAYS:
                    *25,DIM25,*51,PRTITCOD:
                    *75,XLINETOT,*85,XLINEGST:
                    *94,LNTOTAL;
          GOTO      LAWW9000
.
.         Invoice total
.
LAWW3000  MOVE      MAXLINE,FORM2
          SUB       ONE,FORM2
          COMPARE   FORM2,COUNT
          CALL      TAIL IF NOT LESS
.
          PRINT     *94,"----------":
                    *N,*25,IVTOTDES,*75,XGROSTOT:
                    *85,XTOTGST,*94,LNTOTAL;
          ADD       ONE,COUNT
          GOTO      LAWW9000
.
.         Cash
.
LAWW4000  CALL      CKTL0000     * check if tail needs to be printed
          BRANCH    RPRTFLAG,LAWW4100
          BRANCH    PLINFLAG,LAWW4120
          PRINT     *2,CPCDATE:
                    *25,"PAYMENT RECEIVED WITH THANKS":
                    *94,LNTOTAL;
          GOTO      LAWW9000
.
.         Cash details on reprint
.
LAWW4100  BRANCH    PLINFLAG,LAWW4200,LAWW9999
LAWW4120  MOVE      DIM14,DIM6               * Payment type
          PRINT     *2,CPDATE:
                    *25,DIM25,*75,TRECEIPT:
                    *87,DIM6,*94,LNTOTAL;
          GOTO      LAWW9000
.
LAWW4200  PRINT     *64,"Payment Total",*94,LNTOTAL;
          GOTO      LAWW9000
.
.         Journals
.
LAWW5000  CALL      CKTL0000     * check if tail needs to be printed
          BRANCH    PLINFLAG,LAWW5100
          MOVE      TRECEIPT,KEY10
          PRINT     *2,CPDATE:
                    *25,DIM25,*64,KEY10,*74,DIM6;
          IF        PTDTGSTM <> 0
            MOVE      PTDTGSTM,FORM6P2
            PRINT     *85,FORM6P2;
          ENDIF
          PRINT     *94,LNTOTAL;
          GOTO      LAWW9000
.
LAWW5100  PRINT     *64,"Adjustment Total",*94,LNTOTAL;
          GOTO      LAWW9000
.
.         Credit Notes
.
LAWW6000  CALL      CKTL0000     * check if tail needs to be printed
          PRINT     *51,"CREDIT NOTE TOTAL",*94,LNTOTAL;
          GOTO      LAWW9000
.
LAWW9000  CALL      PEOL0000
LAWW9999  RETURN
+
.*******************************************************************************
.         Print end of line and right hand side of landscape invoice PTCNINVB=2
.         for invoice layout (PTCNINVL)= 12 Greenslope & 19 West Wimmera
.*******************************************************************************
PEOL0000  COMPARE   TWO,PTCNINVB
          GOTO      PEOL8000 IF NOT EQUAL  * Not printing Landscape with RHS
.
          COMPARE   "19",PTCNINVL      * Print Right hand side for West Wimmera
          GOTO      PEOL2000 IF EQUAL
.
          BRANCH    RPRTFLAG,PEOL2000  * Reprint invoice
.
          IF        PTCNINVL=12
            CALL      PRTEOL12         * Print Right hand side for Greenslope
          ENDIF
.
.         IF        PTCNINVL=19
.           CALL      PRTEOL19         * Print Right hand side for West Wimmera
.         ENDIF
          GOTO      PEOL9000
.
PEOL2000  MOVE      COUNT,F3
          COMPARE   ZERO,F3
          GOTO      PEOL2200 IF EQUAL
          BRANCH    F3 OF PEOL8000,PEOL8000,PEOL8000,PEOL8000,PEOL8000:
                          PEOL8000,PEOL8000,PEOL8000,PEOL8000,PEOL2300:
                          PEOL8000,PEOL8000,PEOL8000,PEOL8000,PEOL8000:
                          PEOL8000,PEOL8000,PEOL8000,PEOL8000,PEOL2400
          GOTO      PEOL8000
.
PEOL2200  PRINT     *116,AADMNO
          GOTO      PEOL9000
.
PEOL2300  PRINT     *116,PINVNO
          GOTO      PEOL9000
.
PEOL2400  IF        RPRTFLAG=1
            MOVE      PINVAMT,FORM82
            ADD       PINVPATA,FORM82
            ADD       PINVHFDA,FORM82
            ADD       PINVOTHA,FORM82
            ADD       PINVJOUR,FORM82
            ADD       PTINCRTT,FORM82
            ADD       PTINGSTJ,FORM82
          ELSE
            MOVE      GROSSTOT,FORM82
            ADD       TOTGST,FORM82
          ENDIF
          PRINT     *116,FORM82
          GOTO      PEOL9000
.
.        No extra details to print
.
PEOL8000  PRINT     *N;
.
PEOL9000  ADD       ONE,COUNT
PEOL9999  RETURN
+
.*******************************************************************************
.        Print the claim details at the end of the invoice (print original inv.)
.*******************************************************************************
PRTCLMS  MOVE      AADMNO,KEY8
         BRANCH    CLAIM OF PRTCL300,PRTCL200,PRTCL100,PRTCL400
         GOTO      PRTCL999
.         
. ----- Veteran affairs -----
.
PRTCL100 CALL      VTAFF000
         GOTO      PRTCL999
.         
. ----- Motor accident board (TAC) -----
.
PRTCL200 CALL      MTACC000
         GOTO      PRTCL999
.
. ----- Workers comp -----
.
PRTCL300  CALL     WCOMP000
         GOTO      PRTCL999
.
. ----- Defence Force -----
.
PRTCL400  CALL     DFORC000
         GOTO      PRTCL999
.
PRTCL999  RETURN
+
.*********************************************************************
.*                  WCOMP000                                         *
.*        Print the workers compensation details                     *
.*********************************************************************
WCOMP000  OPEN      PATWC1A1,"patwc1af"
          CALL      RDWCOM1
          BRANCH    OVRCD OF WCOMP999       * no details to print
.
          MOVE      MAXLINE,FORM2
          SUB       "10",FORM2
          COMPARE   FORM2,COUNT
          GOTO      WCOMP300 IF EQUAL
          GOTO      WCOMP300 IF LESS
.
WCOMP015  COMPARE   MAXLINE,COUNT
          GOTO      WCOMP200 IF NOT LESS
          CALL      PEOL0000                * Print RHS if necessary
          GOTO      WCOMP015
WCOMP200  CALL      TAIL
.
WCOMP300  MOVE      SP30,INAME
          MOVE      SP30,IADD1
          MOVE      SP30,IADD2
          MOVE      SP20,IADD3
          MOVE      SP4,IPOST
.
          COMPARE   ONE,WCACCPT
          GOTO      WCOMP400 IF NOT EQUAL
          MOVE      WCICODE,KEY6
          OPEN      PATIN1A1,"patin1af"
          CALL      RDINSR1
.
WCOMP400  UNPACK    WCACDAT WITH CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      WCEADD3,KEY25
          UNPACK    WCEADD1,KEY30
.
          CALL      WCRH0000         * Print Claim with right hand side
WCOMP999  RETURN
+
.*********************************************************************
.         Print with right hand side
.*********************************************************************
WCRH0000  CALL      PEOL0000
.
          PRINT     *2,"Claim Number     : ",WCCLMNO;
          CALL      PEOL0000
.
          PRINT     *2,"Date of Accident : ",CPCDATE;
          CALL      PEOL0000
.
          PRINT     *2,"Employer:",*35,"Insurance Company:";
          CALL      PEOL0000
.
          PRINT     *2,WCENAME,*35,INAME;
          CALL      PEOL0000
.
          PRINT     *2,KEY30,*35,IADD1;
          CALL      PEOL0000
.
          UNPACK    WCEADD2,KEY30
          PRINT     *2,KEY30,*35,IADD2;
          CALL      PEOL0000
.
          UNPACK    IADD3,KEY20
          PRINT     *2,KEY25,*28,WCEPOST,*38,KEY20,*61,IPOST;
          CALL      PEOL0000
.
          PACK      KEY10,CAPPRVNO,SP70
          IF        IBCNMHOS=1
            OPEN      PATHSPA1,"pathspaf"
            MOVE      PMVXMHOS,KEY3
            CALL      RDPTHSP1
            IF        OVRCD=0
              PACK      KEY10,PTHSAPPR,SP70
            ENDIF
          ENDIF
          PRINT     *2,"Hospital Provider Number : ",KEY10;
          CALL      PEOL0000
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          REP       " 0",CPCDATE
          PRINT     *2,"Date of Birth            : ",CPCDATE;
          CALL      PEOL0000
.
CLRH9999  RETURN
+
.*********************************************************************
.*                  MTACC000                                         *
.*                 Print Motor Accident Details                      *
.*********************************************************************
MTACC000  MOVE      PINVADM,KEY8
          OPEN      PATWMAB1,"patwmabf"
          CALL      RDWMAB1
          BRANCH    OVRCD OF MTACC999       * no details to print
.
          MOVE      MAXLINE,FORM2
          SUB       "8",FORM2
          COMPARE   FORM2,COUNT
          GOTO      MTACC300 IF EQUAL
          GOTO      MTACC300 IF LESS
.
MTACC015  COMPARE   MAXLINE,COUNT
          GOTO      MTACC200 IF NOT LESS
.
          CALL      PEOL0000                  * print RHS
          GOTO      MTACC015
MTACC200  CALL      TAIL
.
MTACC300  UNPACK    MACDAT WITH CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
.
          CALL      MTRH0000               * print RHS
MTACC999  RETURN
+
.*********************************************************************
.          Print Transport accident with the Right hand side
.*********************************************************************
MTRH0000  CALL      PEOL0000
.
          PRINT     *2,"Reference Number         : ",MREFNO;
          CALL      PEOL0000
.
          PRINT     *2,"Date of Accident         : ",CPCDATE;
          CALL      PEOL0000
.
          PRINT     *2,"Police Station           : ",MPOLIC;
          CALL      PEOL0000
.
          PRINT     *2,"Car Registration Numbers : ",MCREGO;
          CALL      PEOL0000
.
          PRINT     *2,"Solicitor's Name         : ",MSNAME;
          CALL      PEOL0000
.
          CALL      GETWPR00                 * get ward provider number
          CALL      PEOL0000
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          REP       " 0",CPCDATE
          PRINT     *2,"Date of Birth            : ",CPCDATE;
          CALL      PEOL0000
.
MTRH9999  RETURN
+
.*********************************************************************
.*                  VTAFF000                                         *
.*        Print Veteran's affair details                             *
.*********************************************************************
VTAFF000  MOVE      PINVADM,KEY8
          OPEN      PATWVET1,"patwvetf"
          CALL      RDWVET1
          BRANCH    OVRCD OF VTAFF999       * no details to print
.
          MOVE      MAXLINE,FORM2
          SUB       "2",FORM2
.
          COMPARE   FORM2,COUNT
          GOTO      VTAFF300 IF EQUAL
          GOTO      VTAFF300 IF LESS
.
VTAFF015  COMPARE   MAXLINE,COUNT
          GOTO      VTAFF200 IF NOT LESS
          CALL      PEOL0000                  * print RHS
          GOTO      VTAFF015
.
VTAFF200  CALL      TAIL
.
VTAFF300  CALL      VTRH0000                * Print details with RHS
VTAFF999  RETURN
+
.*********************************************************************
.         Print veteran details with Right hand side
.*********************************************************************
VTRH0000  CALL      PEOL0000
.
          PRINT     *2,"Claim Number : ",VCLMNO;
          CALL      PEOL0000
.
VTRH9999  RETURN
+
.*********************************************************************
.*                  DFORC000                                         *
.*        Print Defence Force details                                *
.*********************************************************************
DFORC000  LOAD      ACLAIM,PVITYPE,EMVICOMP,OBACOMP
          PACK      KEY11,PINVADM,ACLAIM
          OPEN      PMSEXTA1,"pmsextaf"
          CALL      RDPMEXT1
          BRANCH    OVRCD OF DFORC999       * no details to print
.
          MOVE      MAXLINE,FORM2
          SUB       "14",FORM2
.
          COMPARE   FORM2,COUNT
          GOTO      DFORC300 IF EQUAL
          GOTO      DFORC300 IF LESS
.
DFORC015  COMPARE   MAXLINE,COUNT
          GOTO      DFORC200 IF NOT LESS
          CALL      PEOL0000 
          GOTO      DFORC015
.
DFORC200  CALL      TAIL
.
DFORC300  CALL      DEFC0000                * Print details of Defence force
DFORC999  RETURN
+
.*********************************************************************
.         Print Defence force details
.*********************************************************************
DEFC0000  CALL      PEOL0000
.
          MOVE      PMPXFNAM,KEY78
          STRIP     KEY78
          ENDSET    KEY78
          APPEND    SP1,KEY78
          APPEND    PMPXSNAM,KEY78
          RESET     KEY78
.
          PRINT     *2,"Entitled Person's Name      :";
          CALL      PEOL0000
          PRINT     *2,KEY78;
          CALL      PEOL0000
          PRINT     *2,PTMASNAM;
          CALL      PEOL0000
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          REP       " 0",CPCDATE
          PRINT     *2,"Entitled Person's DOB       : ",CPCDATE;
          CALL      PEOL0000
.
          PRINT     *2,"PMKeys Number               : ",PMEXPMKN;
          CALL      PEOL0000
.
          PRINT     *2,"DAN Number                  : ",PMEXDANO;
          CALL      PEOL0000
          MOVE      SP70,CPCDATE
          MATCH     SP70,PMEXDAT1
          IF        !@EQUAL
            UNPACK    PMEXDAT1,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
            REP       " 0",CPCDATE
          ENDIF
          PRINT     *2,"Referral Date               : ",CPCDATE;
          CALL      PEOL0000
.
          MOVE      SP70,KEY48
          UNPACK    PMEXNAME,KEY48
          PRINT     *2,"Referring ADF MO            : ",KEY48;
          CALL      PEOL0000
.
          PRINT     *2,"Referring ADF Health Centre : ";
          PRINT     *32,PMEXADD1;
          CALL      PEOL0000
.
          PRINT     *32,PMEXADD2;
          CALL      PEOL0000
.
          PRINT     *32,PMEXADD3;
          CALL      PEOL0000
.
          PRINT     *32,PMEXADD4;
          CALL      PEOL0000
.
          PRINT     *32,PMEXPOST;
          CALL      PEOL0000
.
DEFC9999  RETURN
+
.******************************************************************************
. GETWPR00 : Get ward provider number if one exists
.******************************************************************************
GETWPR00  COMPARE   "16",PTCNINVL
          GOTO      GETWPR90 IF NOT EQUAL   * only for this layout
.
          OPEN      PATDTRA5,"patdtraf"
          PACK      KEY23,PINVNO,ONE,Z70
          CALL      RDSDTRN5
GETWPR10  CALL      RDPDTRN5
          BRANCH    OVRCD,GETWPR90
.
          MATCH     PINVNO,TREF              * check invoice
          GOTO      GETWPR90 IF NOT EQUAL
.
          COMPARE   ONE,TRECTYPE
          GOTO      GETWPR90 IF NOT EQUAL    * Not accommodation record
.
          MATCH     SP70,TDWARD
          GOTO      GETWPR90 IF EQUAL
.
          PACK      KEY6,TDWARD,SP70
          CALL      RDWARD1                 * read with accommodation ward
          BRANCH    OVRCD,GETWPR90
.
          MATCH     SP70,PTWDGLDG           * if blank use hospital prov number
          GOTO      GETWPR90 IF EQUAL
.
          PRINT     *2,"Ward Provider Number     : ",PTWDGLDG;
          GOTO      GETWPR99
.
GETWPR90  PACK      KEY10,CAPPRVNO,SP70
          IF        IBCNMHOS=1
            OPEN      PATHSPA1,"pathspaf"
            MOVE      PMVXMHOS,KEY3
            CALL      RDPTHSP1
            IF        OVRCD=0
              PACK      KEY10,PTHSAPPR,SP70
            ENDIF
          ENDIF
          PRINT     *2,"Hospital Provider Number : ",KEY10;
GETWPR99  RETURN
+
.*******************************************************************************
.         Check if Tail need to be printed
.*******************************************************************************
CKTL0000  COMPARE   MAXLINE,COUNT
          GOTO      CKTL9999 IF LESS
.
          CALL      TAIL
          UNPACK    DFDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
.
CKTL9999  RETURN
+
.*******************************************************************************
.         Print Cash before end of invoice
.*******************************************************************************
ENDPRT00  MOVE      CNAME TO DIM30
          MOVE      CHPPOST TO DIM4
          MOVE      SP6,DMEMB
          IF        CMEMB=1
            LOAD      DMEMB USING AMEMB OF MEMBER
          ENDIF
.
          IF        PTCNINVL=24 | PTCNINVL=25
            CALL      GEND0000
            ADD       NBNKAMNT,CSAMT
            GOTO      ENDPRT80
          ENDIF
.
          COMPARE   ZERO,NBNKAMNT
          GOTO      ENDPRT20 IF NOT EQUAL
.
          COMPARE   ZERO TO CSAMT
          GOTO      ENDPRT10 IF EQUAL
.
.         Check if there is any cash to be printed
.
          BRANCH    CASHFLAG OF ENDPRT20
.
.-------- No cash to print ---------
.
ENDPRT10  MOVE      NETTOT,TPATAMTP
          GOTO      ENDPRT80
.
.-------- Print cash receipt total ------
.
ENDPRT20  COMPARE   NINE,CFEETYP
          GOTO      ENDPRT40 IF EQUAL     * Johns Hopkins
.
          CALL      CKRC0000              * Check if we Print payments details
          ADD       NBNKAMNT,CSAMT
          MOVE      NETTOT TO TPATAMTP
          SUB       CSAMT FROM NETTOT
          GOTO      ENDPRT80
.
.         Print total receipt only
.
ENDPRT40  ADD       NBNKAMNT,CSAMT
          MULT      SEQ,CSAMT             * Print as a negative
          MOVE      SP70,KEY3
          MOVE      CSAMT,FORM62
          IF        NBNKAMNT<>0
            MOVE      "(*)",KEY3
          ENDIF
.
          MOVE      CSAMT,LNTOTAL
          PACK      DFDATE,CSCENT,CSYEAR,CSMON,CSDAY
          MOVE      FOUR,RECFLAG              * flag for printing payments
          MOVE      ZERO,PLINFLAG
          CALL      PRLN0000                  * Print line of invoice
.
          MULT      SEQ,CSAMT
          MOVE      NETTOT TO TPATAMTP
          SUB       CSAMT FROM NETTOT
.
.-------- Load up the word MEMBER if this is a member ------
.
ENDPRT80  COMPARE   NINE,CFEETYP
          GOTO      ENDPRT90 IF EQUAL       * Johns Hopkins
.
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,HUND05;*189,PTCNPRCL
.
          IF        PTCNPRCL=1
            CALL      PRTCLMS               * print claim code
          ENDIF
.
          IF        CLAIM=1 | CLAIM=2
            PROC      PRNTICDC              * Print ICD10 Codes for TAC or WC
          ENDIF
.
.         For Emergency HEC
.
ENDPRT88  COMPARE   "18",PTCNINVL
          GOTO      ENDPRT90 IF NOT EQUAL    * not HEC
          BRANCH    PVITYPE,ENDPRT89         * Emergency
          MATCH     " 9",PTVITYPE
          GOTO      ENDPRT90 IF NOT EQUAL    * Emergency event
.
ENDPRT89  CALL      PADC0000            * Print Attending doctor
          PROC      PRBIL000            * Print Billing Comment
.
ENDPRT90  MOVE      ZERO,PAYMTTOT
          MOVE      ZERO,CREDTOT
          CALL      NTAIL000
.
ENDPRT99  RETURN
+
. *****************************************************************************
.         Print Attending doctor
. *****************************************************************************
PADC0000  OPEN     PMSHCPA1,"pmshcpaf"
          UNPACK   SP70,KEY25,PMHCPRV1
.
          PACK     KEY10,EMVIDOCT,SP70   * current doctor
          MATCH    "1",EMCNGINV
          GOTO     PADC3000 IF NOT EQUAL
.
          CALL     PFDOC000          * get the first Service doct.
.
          MATCH    SP70,SERVDOCT
          GOTO     PADC3000 IF EQUAL
          MATCH    "ALL",SERVDOCT
          GOTO     PADC3000 IF EQUAL
.
          PACK     KEY10,SERVDOCT,SP70
PADC3000  CALL     RDPMHCP1
          IF       OVRCD<>1
            MOVE     PMHCTITL,FMTTITLE
            MOVE     PMHCGNAM,FMTGNAME
            MOVE     PMHCSNAM,FMTSNAME
            CALL     DOCNM000
            PACK     KEY25,DOCFNAME
          ENDIF
.
          MOVE      MAXLINE,FORM2
          SUB       "1",FORM2
          COMPARE   FORM2,COUNT               * Check For A Full Page
          CALL      TAIL IF NOT LESS
.
          PRINT    *N,*1,"Attending Doctor:",KEY25:
                   *44,"Provider Number:",PMHCPRV1
          ADD      TWO,COUNT
PADC9999  RETURN
+
. *****************************************************************************
.         Get the first doctor
. *****************************************************************************
PFDOC000  MOVE      SP70,KEY10
          COMPARE   NINE,PVITYPE
          GOTO      PFDOC800 IF EQUAL      * Emergency event
.
.         Emergency visit - check history file
.
          OPEN      EMRHISA1,"emrhisaf"
          PACK      KEY22,ADANUMB,SP70
          CALL      RDEMHIS1
PFDOC100  CALL      RKEMHIS1
          BRANCH    OVRCD,PFDOC9999
.
          MATCH     DADANUMB,EMHIVIS
          GOTO      PFDOC9999 IF NOT EQUAL
.
          MATCH     SP70,EMHIDOC
          GOTO      PFDOC100 IF EQUAL
.
          MOVE      EMHIDOC,KEY10
          GOTO      PFDOC999
.
.         Emergency Event
.
PFDOC800  OPEN      PMSEVTA1,"pmsevtaf"
          MOVE      ADANUMB,KEY8
          CALL      RDPMEVT1
          BRANCH    OVRCD,PFDOC999
.
          MOVE      PMEVACON,KEY10
PFDOC999  RETURN
+
.*****************************************************************
.         Print end of invoice for PTCNINVL=24 and 25
.*****************************************************************
GEND0000
.        Check if there is any cash to be printed
.
          COMPARE   ZERO,NBNKAMNT
          GOTO      GEND2000 IF NOT EQUAL
.
          COMPARE   ZERO TO CSAMT
          GOTO      GEND2000 IF NOT EQUAL
.
          MOVE      NETTOT,TPATAMTP
          GOTO      GEND3000
.
.        Print cash receipt total
.
GEND2000  MULT      SEQ,CSAMT             * Print as a negative
          CALL      GCDE0000
          MULT      SEQ,CSAMT
          MOVE      NETTOT TO TPATAMTP
          SUB       CSAMT FROM NETTOT
          SUB       NBNKAMNT,NETTOT
.
.        Load up the word MEMBER if this is a member
.
GEND3000  IF        PTCNINVL=25
            CALL      CKTL0000
            PRINT     *19,"Balance Payable":
                      *66,NETTOT
          ELSE
            MOVE      CSAMT,FORM12P2
            ADD       NBNKAMNT,FORM12P2
            IF        FORM12P2<>0
              MOVE      MAXLINE,FORM2
              SUB       ONE,FORM2
              COMPARE   FORM2,COUNT
              CALL      TAIL IF NOT LESS
              PRINT     *63,"---------------":
                        *N,*30,"Payment Total":
                        *63,FORM12P2
              ADD       TWO,COUNT
            ENDIF
            CALL      CKTL0000
            PRINT     *30,"Balance Payable":
                      *63,NETTOT
          ENDIF
          ADD       ONE,COUNT
GEND9999  RETURN
+
.***************************************************************************
.        Check if any deposit details are to be printed
.***************************************************************************
GCDE0000  OPEN      COMDEPA2,"comdepaf"
          OPEN      RCPDTEA1,"rcpdteaf"
          OPEN      RCPDTEA6,"rcpdteaf"
          OPEN      RCPBDTA1,"rcpbdtaf"
          MOVE      AADMNO,DAADMNO
          MOVE      "0",CMDESTAT
          MOVE      ZERO,FINDFLG
          PACK      KEY26,AADMNO,CMDESTAT,SP70
          CALL      RSCMDEP2
GCDE1000  CALL      RKCMDEP2
          BRANCH    OVRCD OF GCDE2000
.
          MATCH     DAADMNO,CMDEADMN
          GOTO      GCDE2000 IF NOT EQUAL
.
          MATCH     "0",CMDESTAT                   * Deposit held?
          GOTO      GCDE2000 IF NOT EQUAL
.
          PACK      KEY17,CMDERECN,CMDETCNT
          CALL      RDRCDTE1
          BRANCH    OVRCD,GCDE1000
.
          IF        IPATFLAG=1
            MATCH     "9",RCDTSFLG
            GOTO      GCDE1000 IF NOT EQUAL        * Not included
          ENDIF
.
          MOVE      ONE,FINDFLG
          GOTO      GCDE6000
.
GCDE2000  PACK      KEY25,AADMNO,SP70
          CALL      RSRCDTE6
GCDE3000  CALL      RKRCDTE6
          BRANCH    OVRCD,GCDE9999
.
          MATCH     DAADMNO,RCDTVIST
          GOTO      GCDE9999 IF NOT EQUAL
.
          MATCH     SP10,RCDTINVN          * Invoice number must be blank
          GOTO      GCDE3000 IF NOT EQUAL
          MATCH     SP10,RCDTRELD
          GOTO      GCDE3000 IF NOT EQUAL   * has been released
.
          IF        IPATFLAG=1
            MATCH     "9",RCDTSFLG
            GOTO      GCDE3000 IF NOT EQUAL        * Not included
          ENDIF
.
          PACK      KEY12,RCDTRECN
          CALL      RDRCBNK1
          BRANCH    OVRCD,GCDE3000
          MATCH     "1",RCBNSTAT            * check if cancelled
          GOTO      GCDE3000 IF EQUAL
.
          MOVE      TWO,FINDFLG
.
.        Read Receipt bank details to get the payee details
.
GCDE6000  PACK      KEY15,RCDTRECN,SP70
          CALL      RSRCBDT1
          CALL      RKRCBDT1
          BRANCH    OVRCD,GCDE8000
.
          MATCH     RCDTRECN,RCBDRECN
          GOTO      GCDE8000 IF NOT EQUAL
.
          CALL      GCSDS000                * Get payment type desc.
.
          UNPACK    RCBDTDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
.
          MOVE      SP70,KEY1
          IF        FINDFLG=2
            ENDSET    DIM14
            APPEND    "*",DIM14             * Non-banked
            APPEND    SP70,DIM14
            RESET     DIM14
          ENDIF
.
          IF        F2=2
            MOVE      RCBDDRAW,RCBDPAYD     * Cheque - use the drawer as payee
          ENDIF
.
          MOVE      RCDTAMNT,FORM12P2
          MULT      SEQ,FORM12P2
.
          COMPARE   "23",PTCNINVL
          GOTO      GCDE7000 IF EQUAL      * SX
.
          IF        PTCNINVL=25
            UNPACK    RCBDPAYD,KEY30
            PRINT     *1,CPDATE,*19,KEY30,*50,DIM14,*66,FORM12P2;
          ELSE
            UNPACK    RCBDPAYD,KEY17
            PRINT     *1,CPDATE,*30,KEY17,*47,DIM14,*63,FORM12P2;
          ENDIF
.
          CALL      PEOL0000
          CALL      CKTL0000
          GOTO      GCDE8000
.
.         SX
.
GCDE7000  COMPARE   FORM2,COUNT
          CALL      TAIL IF NOT LESS
.
          MOVE      FORM12P2,FORM7P2
          MOVE      RCBDPAYD,KEY39
          PRINT     *3,"RECEIPT ##",RCDTRECN,*25,"Payer:",KEY39,*70,FORM7P2
          ADD       ONE,COUNT
.
GCDE8000  BRANCH    FINDFLG,GCDE1000,GCDE3000
.
GCDE9999  RETURN
+
. *****************************************************************************
.     Get payment type description
. *****************************************************************************
GCSDS000 MOVE      ZERO,F2
         MOVE      RCBDPTYP,F1
         MOVE      F1,F2
.
         MOVE      SP70,DIM14
         MOVE      "Py",KEY2
         PACK      KEY5,KEY2,RCBDPCOD
         CALL      RDCODE1
         BRANCH    OVRCD,GCSDS999
.
         MOVE      ZERO,F2
         SQUEEZE   PTCDNHCP
         MOVE      PTCDNHCP,F2
.
         PACK      DIM14,TDESC
         COMPARE   "3",F2                    * Check for Credit Card
         GOTO      GCSDS200 IF EQUAL
.
         COMPARE   "6",F2                    * Check for EFTPOS
         GOTO      GCSDS999 IF NOT EQUAL
.
GCSDS200 MATCH     SP70,RCBDCRDT
         GOTO      GCSDS999 IF EQUAL
.
         MOVE      "CR",KEY2
         PACK      KEY5,KEY2,RCBDCRDT
         CALL      RDCODE1
         BRANCH    OVRCD,GCSDS999
.
         PACK      DIM14,TDESC
         COMPARE   "3",F2                  * Check for Credit Card
         GOTO      GCSDS999 IF EQUAL
.
         MATCH     "1",RCBDEFTT
         GOTO      GCSDS999 IF EQUAL       * EFTPOS Cash
         MOVE      "EFT",KEY3
         MOVE      "EFT/CR",KEY6
         PACK      DIM14,KEY6,SP70

GCSDS999 RETURN
+
. *****************************************************************************
.     Check if all of this patient's receipts are for same visit and register
. *****************************************************************************
CKRC0000  OPEN      COMDEPA2,"comdepaf"
          OPEN      RCPDTEA1,"rcpdteaf"
          OPEN      RCPDTEA6,"rcpdteaf"
          OPEN      RCPBDTA1,"rcpbdtaf"
          OPEN      RCPCRSA1,"rcpcrsaf"
          MOVE      SP70,CSREPNO
          MOVE      AADMNO,DAADMNO
          MOVE      "0",CMDESTAT
          MOVE      ZERO,FINDFLG
          PACK      KEY26,AADMNO,CMDESTAT,SP70
          CALL      RSCMDEP2
CKRC1000  CALL      RKCMDEP2
          BRANCH    OVRCD OF CKRC2000
.
          MATCH     DAADMNO,CMDEADMN
          GOTO      CKRC2000 IF NOT EQUAL
.
          MATCH     "0",CMDESTAT                   * Deposit held?
          GOTO      CKRC2000 IF NOT EQUAL
.
          PACK      KEY17,CMDERECN,CMDETCNT
          CALL      RDRCDTE1
          BRANCH    OVRCD,CKRC1000
.
          MATCH     RCDTRECN,CSREPNO
          GOTO      CKRC1000 IF EQUAL
.
          IF        IPATFLAG=1
            MATCH     "9",RCDTSFLG
            GOTO      CKRC1000 IF NOT EQUAL        * Not included
          ENDIF
          MOVE      ONE,FINDFLG
.
          GOTO      CKRC6000
.
CKRC2000  PACK      KEY25,AADMNO,SP70
          CALL      RSRCDTE6
CKRC3000  CALL      RKRCDTE6
          BRANCH    OVRCD,CKRC9000
.
          MATCH     DAADMNO,RCDTVIST
          GOTO      CKRC9000 IF NOT EQUAL
.
          MATCH     SP10,RCDTINVN          * Invoice number must be blank
          GOTO      CKRC3000 IF NOT EQUAL
          MATCH     SP10,RCDTRELD
          GOTO      CKRC3000 IF NOT EQUAL   * has been released
.
          IF        IPATFLAG=1
            MATCH     "9",RCDTSFLG
            GOTO      CKRC3000 IF NOT EQUAL        * Not included
          ENDIF
.
          PACK      KEY12,RCDTRECN
          CALL      RDRCBNK1
          BRANCH    OVRCD,CKRC3000
          MATCH     "1",RCBNSTAT            * check if cancelled
          GOTO      CKRC3000 IF EQUAL
.
          MATCH     RCDTRECN,CSREPNO
          GOTO      CKRC3000 IF EQUAL
.
          MOVE      TWO,FINDFLG
.
.        Read Receipt bank details (rcpbdtaf) to get the payee details
.        Check if total amt of Payee details of receipt is equal to total
.        patient receipt
.
CKRC6000  MOVE      RCDTRECN,KEY12             * Save current receipt no
.
          CALL      RCPR0000                   * Check receipt
          BRANCH    EXIT,CKRC8000
.
.
          PACK      KEY15,RCDTRECN,SP70
          CALL      RSRCBDT1
          CALL      RKRCBDT1
          BRANCH    OVRCD,CKRC8000
.
          MATCH     RCDTRECN,RCBDRECN
          GOTO      CKRC8000 IF NOT EQUAL
.
          CALL      SETP0000                   * Set up payer details
          CALL      GCSDS000                * Get payment type desc.
.
          UNPACK    RCBDTDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
.
          IF        F2=2
            MOVE      RCBDDRAW,RCBDPAYD     * Cheque - use the drawer as payee
          ENDIF
.
          MOVE      SP70,DEFINDIC
          IF        FINDFLG=2
            MOVE      "*",DEFINDIC          * Non-banked
          ENDIF
.
          MOVE      RCDTRECN,TRECEIPT
          MULT      "-1",RCDTAMNT
          MOVE      RCDTAMNT,LNTOTAL
          MOVE      KEY25,TDDESC
          MOVE      KEY25,DIM21
          MOVE      RCDTTDAT,DFDATE
          MOVE      FOUR,RECFLAG           * flag for printing cash details
          MOVE      ONE,PLINFLAG
          CALL      PRLN0000               * Print unreleased cash
.
CKRC8000 BRANCH    FINDFLG,CKRC1000,CKRC3000
.
CKRC9000  MOVE      ZERO,EXIT
CKRC9999  RETURN
+
. *****************************************************************************
.         Check if Receipt is for a visit and one invoice only
. *****************************************************************************
RCPR0000  OPEN      RCPBDTA1,"rcpbdtaf"
          MOVE      ZERO,FORM12P2
          PACK      KEY15,KEY12,SP70
          CALL      RDRCBDT1
RCPR1000  CALL      RKRCBDT1
          BRANCH    OVRCD OF RCPR6000
.
          MATCH     RCBDRECN,KEY12
          GOTO      RCPR6000 IF NOT EQUAL        * different receipt
.
          PACK      KEY15,RCBDRECN,RCBDUNIQ,SP70
          CALL      RDRCCRS1
          IF        OVRCD=1
            MOVE      ZERO,RCCRSAMN         * Surcharge amount
          ENDIF
          SUB       RCCRSAMN,RCBDPAMT
.
          ADD       RCBDPAMT,FORM12P2
          GOTO      RCPR1000
.
RCPR6000  COMPARE   FORM12P2,RCDTAMNT
          GOTO      RCPR9200 IF NOT EQUAL
.
          CALL      PTYP0000                     * Print payment types
          MOVE      ONE,EXIT
          GOTO      RCPR9999
.
RCPR9200  MOVE      ZERO,EXIT
          GOTO      RCPR9999
.
RCPR9999  RETURN
+
.**********************************************************************
.         Print payment types for the receipt
.**********************************************************************
PTYP0000  MOVE      SP70,DEFINDIC
          IF        FINDFLG=2
            MOVE      "*",DEFINDIC             * for unreleased
          ENDIF
          MOVE      ZERO,PCFLAG
          PACK      KEY15,KEY12,SP70
          CALL      RDRCBDT1
PTYP1000  CALL      RKRCBDT1
          BRANCH    OVRCD OF PTYP9999
.
          MATCH     RCBDRECN,KEY12
          GOTO      PTYP9999 IF NOT EQUAL        * different receipt
.
          PACK      KEY15,RCBDRECN,RCBDUNIQ,SP70
          CALL      RDRCCRS1
          IF        OVRCD=1
            MOVE      ZERO,RCCRSAMN         * Surcharge amount
          ENDIF
          SUB       RCCRSAMN,RCBDPAMT
          MULT      "-1",RCBDPAMT
.
          BRANCH    PCFLAG,PTYP7400
.
          MOVE      ONE,PCFLAG
          CALL      SETP0000                   * Set up payer details
          CALL      GCSDS000                * Get payment type desc.
.
          MOVE      RCBDTDAT,DFDATE
          MOVE      RCDTRECN,TRECEIPT
          MOVE      RCBDPAMT,LNTOTAL
          MOVE      FOUR,RECFLAG       * flag for printing payments
          MOVE      ONE,PLINFLAG
          CALL      PRLN0000           * Print line of inv
          GOTO      PTYP1000
.
PTYP7400  CALL      GCSDS000                * Get payment type desc.
.
          MOVE      SP70,DFDATE
          MOVE      SP70,TRECEIPT
          MOVE      SP70,TDDESC
          UNPACK    SP70,DIM21,DIM25
          MOVE      SP70,DEFINDIC
          MOVE      RCBDPAMT,LNTOTAL
          MOVE      FOUR,RECFLAG       * flag for printing payments
          MOVE      ONE,PLINFLAG
          CALL      PRLN0000           * Print line of inv
          GOTO      PTYP1000
.
PTYP9999  RETURN
+
. *****************************************************************************
.         Set payer details
. *****************************************************************************
SETP0000  MOVE      RCDTDPTY,KEY3         * Deposit type
.
          PACK      KEY12,RCDTRECN
          CALL      RDRCBNK1
          MOVE      ANSP,KEY1
          MOVE      RCBNTTYP,F1
          LOAD      KEY1,F1,ANSH,ANSI,ANSG,ANSH
          UNPACK    RCBNRCOD,KEY6           * Health Fund or Insurance code

          MOVE      SP70,KEY25
          CLEAR     KEY25
          MATCH     SP70,KEY3
          GOTO      SETP7000 IF NOT EQUAL   * Deposit
          APPEND    "FROM ",KEY25
          MATCH     SP70,KEY1
          GOTO      SETP4000 IF EQUAL
.
          MATCH     "H",KEY1
          GOTO      SETP1000 IF NOT EQUAL
.
          MOVE      "HEALTH FUND",KEY20
          MATCH     SP70,KEY6
          GOTO      SETP0800 IF EQUAL       * blank health fund code
.
          MOVE      "0000    ",HFTABL
          PACK      KEY14,KEY6,HFTABL,SP10
          CALL      RDFUND1
          IF        OVRCD=0
            MOVE      HFNAME,KEY20
          ENDIF
SETP0800  APPEND    KEY20,KEY25
          GOTO      SETP8000
.
SETP1000  MATCH     "I",KEY1
          GOTO      SETP2000 IF NOT EQUAL
.
          MOVE      "INSURANCE  ",KEY20
          MATCH     SP70,KEY6
          GOTO      SETP1800 IF EQUAL       * blank insurance code
.
          OPEN      PATIN1A1,"patin1af"
          CALL      RDINSR1
          IF        OVRCD=0
            MOVE      INAME,KEY20
          ENDIF
SETP1800  APPEND    KEY20,KEY25
          GOTO      SETP8000
.
SETP2000  MATCH     "G",KEY1
          GOTO      SETP3000 IF NOT EQUAL
.
          APPEND    "GOVERNMENT DEPARTMENT",KEY25
          GOTO      SETP8000
.
SETP3000  MATCH     "P",KEY1
          GOTO      SETP8000 IF NOT EQUAL
SETP4000  APPEND    "PATIENT    ",KEY25
          GOTO      SETP8000
.
SETP7000  PACK      KEY5,ANSD,ANSP,KEY3,SP70
          CALL      RDCODE1
          IF        OVRCD=0
            APPEND    "DEPOSIT - ",KEY25
            APPEND    TDESC,KEY25
          ENDIF
.
SETP8000  APPEND    SP70,KEY25
          RESET     KEY25
          MOVE      KEY25,DIM25
          MOVE      DIM25,DIM21
          MOVE      DIM25,TDDESC
.
SETP9999  RETURN
+
.**********************************************************************
.*                            NTAIL000                                *
.*                       Print Normal Tail                            *
.**********************************************************************
NTAIL000  WHILE     COUNT<MAXLINE
            CALL      PEOL0000
          DO
.
          CALL      SINVT000                 * set up tail stationery code
          BRANCH    EXIT,NTAIL9999
.
          MOVE      ZERO,MPGEFLAG            * indicate single/last page
          ADD       ONE,CPAGENO
          CALL      PRTINVTL                 * print templated invoice tail
.
          COMPARE   FORM3,IBTHLENG           * check if last line is same as
          GOTO      NTAIL999 IF EQUAL        * page length
          PRINT     *N;
.
NTAIL999  RETURN
+
.*******************************************************************************
.         Print the tail of the invoice for multi-page invoices
.*******************************************************************************
TAIL      WHILE     MAXLINE>COUNT                
            PRINT     *N;
            ADD       ONE,COUNT
          DO
.         
          CALL      SINVT000               * set up for templating
          MOVE      ONE,MPGEFLAG           * indicate multipage
          ADD       ONE,CPAGENO             
          CALL      PRTINVTL               * print templated invoice tail
          CALL      INITIVAR
.
          COMPARE   FORM3,IBTHLENG         * check if last line is same as
          GOTO      TAIL90 IF EQUAL        * page length
          PRINT     *N;
.
TAIL90    CALL      HEAD
TAIL99    RETURN
+
.*******************************************************************************
.         Print the heading for the invoice
.*******************************************************************************
HEAD      CALL      SINVH000                * set up header stationery code
          BRANCH    EXIT,HEAD99
          CALL      PRTINVHL                * print templated invoice header
          MOVE      ZERO,COUNT
.
HEAD10    COMPARE   CURRROW,IBTHLENG
          GOTO      HEAD99 IF LESS
          PRINT     *N;
          ADD       ONE,CURRROW
          GOTO      HEAD10
.
HEAD99    RETURN
+
.*******************************************************************************
.         Initialise special variables for printing invoice
.*******************************************************************************
INITIVAR COMPARE   TWO,PTCNINVB
         GOTO      INITI999 IF NOT EQUAL     * Not printing right Handside
.
         MOVE      ZERO,THEACHG
         MOVE      SP8,THEADTE
         MOVE      ZERO,LWCHG
         MOVE      SP8,LWDT
         MOVE      ZERO,HDUDAY1
         MOVE      ZERO,HDUDAY2
         MOVE      SP8,FHDUDT1
         MOVE      SP8,FHDUDT2
         MOVE      SP8,THDUDT1
         MOVE      SP8,THDUDT2
         MOVE      ZERO,HDUFLG
         MOVE      ZERO,OTCHG1
         MOVE      ZERO,OTCHG2
         MOVE      SP8,OTDT1
         MOVE      SP8,OTDT2
         MOVE      ZERO,OTFLG
         MOVE      SP15,OTDESC1
         MOVE      SP15,OTDESC2
.
         MOVE      ZERO,SURGFLG
         MOVE      ZERO,MBSNUM
         MOVE      SP9,MBS1
         MOVE      SP9,MBS2
         MOVE      SP9,MBS3
         MOVE      SP8,MBSDT1
         MOVE      SP8,MBSDT2
         MOVE      SP8,MBSDT3
         MOVE      SP10,MBSCH1
         MOVE      SP10,MBSCH2
         MOVE      SP10,MBSCH3
.
         MOVE      ZERO,ACSHARE             * Assume not a share accomodation
         MOVE      ZERO,ACPRIVT             * Assume not private accomodation
         MOVE      SP3,DSTAT
         MOVE      SP2,REGIST8
.
         MOVE     SP30,FUNDNM
         MOVE     SP30,TABLNM
         MOVE     SP70,TABLNN
         MOVE     SP30,P2NAME
         UNPACK   SP30 WITH ACCSHRD,ACCPRIV,ACCDAYC,DSCHY,DSCHN:
                            DISCODE,ADMCODE
         MOVE     SP8,ADDATE
         MOVE     SP10,B10DATE
         MOVE     SP10,CURDATE
         MOVE     SP10,DLCDATE
         MOVE     SP4,ACDAYS
         MOVE     SP20,ACTOTAL
         MOVE     SP30,ADOCNAM
         MOVE     SP30,XDESC1
         MOVE     SP30,XDESC2
.
         MOVE     ZERO TO SURGFLG
         MOVE     ZERO TO HDUDAY1
         MOVE     ZERO TO HDUDAY2
         MOVE     ZERO TO THEACHG
         MOVE     ZERO TO LWCHG
         MOVE     ZERO TO OTCHG1
         MOVE     ZERO TO OTCHG2
.
         MOVE     ONE TO OVERPFL
INITI999 RETURN
+
.******************************************************************************
.*                                 PROACC00                                   *
.*              Process Any Special Code For Accomodation Records             *
.******************************************************************************
PROACC00  COMPARE   TWO,PTCNINVB
          GOTO      PROACC99 IF NOT EQUAL   * Not printing Right handside
.
          COMPARE   THREE,PROGFLAG
          GOTO      PROACC99 IF EQUAL
.
          MOVE      TWO,TCFORM6
          PACK      KEY5,CODEBT,STRBTYP
          CALL      RDCODE1                 * Read the codes file
.
          STORE     ONE,TCFORM6,ACPRIVT,ACSHARE
.
          MATCH     BEDTYP,WRTYPE
          GOTO      PROACC99 IF NOT EQUAL
.
          BRANCH    HDUFLG,PROACC10
.
          MOVE      ONE,HDUFLG
          PACK      FHDUDT1,FDAY1,SLASH,FMON1,SLASH,FYEAR1
          REP       " 0",FHDUDT1
          PACK      THDUDT1,TDAY1,SLASH,TMON1,SLASH,TYEAR1
          REP       " 0",THDUDT1
          MOVE      NODAYS,HDUDAY1
          GOTO      PROACC99
.
PROACC10  PACK      FHDUDT2,FDAY1,SLASH,FMON1,SLASH,FYEAR1
          REP       " 0",FHDUDT2
          PACK      THDUDT2,TDAY1,SLASH,TMON1,SLASH,TYEAR1
          REP       " 0",THDUDT2
          MOVE      NODAYS,HDUDAY2
PROACC99  RETURN
+
.*******************************************************************************
.         Theatre fees
.*******************************************************************************
PROTHE00  COMPARE   "12",PTCNINVL
          GOTO      PROTHE05 IF EQUAL          * Greenslopes
          COMPARE   "19",PTCNINVL
          GOTO      PROTHE99 IF NOT EQUAL      * Not West Wimmera
.
.         Check if it exists in item file ( if it is, use it as the MBS code )
.         Use the receipt number as the MBS code
.
PROTHE05  OPEN      PATITEM1,"patitemn"
          MOVE      PRTITCOD,KEY9                                    
          PACK      KEY8,TFCENT,TFYEAR,TFMONTH,TFDAY
          REP       " 0",KEY8
          PACK      KEY17,KEY9,KEY8,SP70
          CALL      PATITMRD
          IF        OVRCD=1
            MOVE      TRECEIPT TO PRTITCOD
          ENDIF
.
          ADD       LINETOT,THEACHG
          PACK      THEADTE,TFDAY,SLASH,TFMONTH,SLASH,TFYEAR
          REP       " 0",THEADTE
          MOVE      ONE,SURGFLG
          ADD       ONE,MBSNUM
          BRANCH    MBSNUM,PROTHE10,PROTHE20,PROTHE30
.
          GOTO      PROTH199
.
PROTHE10  MOVE      PRTITCOD,MBS1
          MOVE      THEADTE,MBSDT1
          MOVE      LINETOT,MBSCH1
          GOTO      PROTH199
.
PROTHE20  MOVE      PRTITCOD,MBS2
          MOVE      THEADTE,MBSDT2
          MOVE      LINETOT,MBSCH2
          GOTO      PROTH199
.
PROTHE30  MOVE      PRTITCOD,MBS3
          MOVE      THEADTE,MBSDT3
          MOVE      LINETOT,MBSCH3
.
PROTHE99  RETURN
+
.******************************************************************************
.*                                 PROCMISC                                   *
.*           Process Any Special Code For Normal Miscellaneous Items          *
.******************************************************************************
PROCMISC  COMPARE   "12",PTCNINVL
          GOTO      PROCM100 IF EQUAL          * Greenslopes
          COMPARE   "19",PTCNINVL
          GOTO      PROCM999 IF NOT EQUAL      * Not West Wimmera
.
PROCM100  MOVE      TITEMNO,PRTITCOD
.
          MATCH     "LW       ",PRTITCOD
          GOTO      PROCM194 IF EQUAL
.
. ----- Check to see if the item is numeric, if so put it into -----
. ----- the variable PRTITCOD, otherwise move spaces to PRTITCOD -----
.
PROCM191  MOVE      PRTITCOD,ANS
.
          MATCH     SP1,ANS
          GOTO      PROCM192 IF EQUAL
.
          TYPE      ANS
          GOTO      PROCM193 IF NOT EQUAL
.
          BUMP      PRTITCOD
          GOTO      PROCM191 IF NOT EOS
.
PROCM192  RESET     PRTITCOD
          GOTO      PROCM195
.
PROCM193  MOVE      SP9,PRTITCOD
          GOTO      PROCM195
.
PROCM194  MOVE      TRECEIPT,PRTITCOD
.
. ----- Check for labour ward/procedure room fee's, etc -----
.
PROCM195  COMPARE   THREE,PROGFLAG
          GOTO      PROCM999 IF EQUAL
.
          MATCH     "LW ",TMISGRP
          GOTO      PROCM196 IF NOT EQUAL
.
          MOVE      LWCODE,ANS1
          GOTO      PROCM198
.
. ----- Not a labour ward, check the other possibilities -----
.
PROCM196  MATCH     "PRF",TMISGRP
          GOTO      PROCM197 IF EQUAL
.
          MATCH     "BO ",TMISGRP
          GOTO      PROCM197 IF EQUAL
.
          MATCH     "LA ",TMISGRP
          GOTO      PROCM197 IF EQUAL
.
          GOTO      PROCM999
.
PROCM197  MOVE      OTCODE,ANS1
.
. ----- Loop over the codes file for this category -----
.
PROCM198  PACK      KEY5,ANS1,SP3
          CALL      RDSCODE1                * Position on & read the codes file
PROCM199  CALL      RDKCODE1
          BRANCH    OVRCD,PROCM999
.
          MATCH     ANS1,TCODE
          GOTO      PROCM999 IF NOT EQUAL
.
          MATCH     TMISGRP,ACODE
          GOTO      PROCM199 IF NOT EQUAL
.
          MATCH     "LW",TCODE
          GOTO      PROCM19A IF EQUAL
.
          MATCH     "OT",TCODE
          GOTO      PROCM19E IF EQUAL
.
          GOTO      PROCM999
.
PROCM19A  MOVE      LINETOT,LWCHG
          PACK      LWDT,TFDAY,SLASH,TFMONTH,SLASH,TFCENT,TFYEAR
          REP       " 0",LWDT
.
          MOVE      ONE,SURGFLG
          ADD       ONE,MBSNUM
          BRANCH    MBSNUM,PROCM19B,PROCM19C,PROCM19C
.
          GOTO      PROCM999
.
PROCM19B  MOVE      DIM4,MBS1
          PACK      MBSDT1,TFDAY,SLASH,TFMONTH,SLASH,TFYEAR
          REP       " 0",MBSDT1
          MOVE      LINETOT,MBSCH1
          GOTO      PROCM999
.
PROCM19C  MOVE      DIM4,MBS2
          PACK      MBSDT2,TFDAY,SLASH,TFMONTH,SLASH,TFYEAR
          REP       " 0",MBSDT2
          MOVE      LINETOT,MBSCH1
          GOTO      PROCM999
.
PROCM19D  MOVE      DIM4,MBS3
          PACK      MBSDT3,TFDAY,SLASH,TFMONTH,SLASH,TFYEAR
          REP       " 0",MBSDT3
          MOVE      LINETOT,MBSCH1
          GOTO      PROCM999
.
PROCM19E  BRANCH    OTFLG,PROCM19F
.
          MOVE      ONE,OTFLG
          MOVE      LINETOT,OTCHG1
          PACK      OTDT1,TFDAY,SLASH,TFMONTH,SLASH,TFYEAR
          REP       " 0",OTDT1
          MOVE      TDDESC,OTDESC1
          GOTO      PROCM999
.
PROCM19F  MOVE      LINETOT,OTCHG2
          PACK      OTDT2,TFDAY,SLASH,TFMONTH,SLASH,TFYEAR
          REP       " 0",OTDT2
          MOVE      TDDESC,OTDESC2
.
PROCM999  RETURN
+
.******************************************************************************
.*                                 SETUPIV                                    *
.*                Set Up Any Special Variables For The Invoice                *
.******************************************************************************
SETUPIV   OPEN      PATFN1A1,"patfn1af"
          MOVE      SP30,HFNAME
          PACK      KEY14,AFUNDH,ZERO8
          CALL      RDFUND1                 * Read the health fund file
.
          MOVE      HFNAME,FUNDNM
          MOVE      SP30,HFNAME
.
          PACK      KEY14,AFUNDH,AFNDTB
          CALL      RDFUND1                 * Read the health fund file
.
.         CLOSE     PATFN1A1
          MOVE      HFNAME,TABLNM
          MOVE      AFNDMM,TABLNN
          MOVE      PNAME,P2NAME
.
. ----- Set up discharge indicator -----
.
          MOVE      SP1,DSCHY
          MOVE      SP1,DSCHN
          LOAD      DSCHY,ASTAT,SP1,SP1,X1,SP1
          LOAD      DSCHN,ASTAT,X1,X1,SP1,X1
.
          MOVE      DSTAT,DISCODE
          LOAD      DISCODE,DISFLG,SP3         * If no discharge rec
.
          MOVE      ATYPE,ADMCODE
.
. ----- Set up accomodation indicator -----
.
          MOVE      SP1,ACCSHRD
          LOAD      ACCSHRD,ACSHARE,X1
.
          MOVE      SP1,ACCPRIV
          LOAD      ACCPRIV,ACPRIVT,X1
.
          MOVE      SP1,ACCDAYC
          LOAD      ACCDAYC,ACDAYCS,X1
.
          SUB       GOVTOTAL,ACCMTOT
          MOVE      ACCMTOT,ACTOTAL
          MOVE      TOTDAYS,ACDAYS
.
          MOVE      SP30,ADOCNAM
          PACK      KEY6,ADOCTA
          CALL      RDDOCT1                 * Read the doctors file
          IF        OVRCD<>1
            MOVE      DGNAME,ANS
            PACK      ADOCNAM,ANS,DOT,DSNAME
          ENDIF
          BRANCH    DISFLG,SETUP20
.
          OPEN      PATECDA2,"patecdaf"
          PACK      KEY16,DADMNO,SP20
          CALL      RSPTECD2                * Position on & read a patient
SETUP10   CALL      RKPTECD2                  episode disease file record
          BRANCH    OVRCD,SETUP20
.
          MATCH     DADMNO,PTEDADMN
          GOTO      SETUP20 IF NOT EQUAL
.
          MATCH     "P",PTEDTYPE
          GOTO      SETUP10 IF NOT EQUAL
.
          OPEN      PATICDD1,"paticddf"
          OPEN      PATI10D1,"pati10df"
          PACK      KEY9,PTEDCODE
          CALL      RDICD1                  * Read the ICD9 disease file
          BRANCH    OVRCD,SETUP20
.
          MOVE      ":",ANS
          PACK      XDESC,PTEDCODE,ANS,SP1,DDESC
          GOTO      SETUP40
.
SETUP20   MOVE      ADIAG1,XDESC
.
SETUP40   UNPACK    ALACDTE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPDATE,DLCDATE
.
          MOVE      A10DATE,ADDATE
          MOVE      D10DATE,CURDATE
          MATCH     SP10,CURDATE
          IF        @EQUAL
            PACK      CURDATE,CDD,SLASH,CMM,SLASH,CCC,CYY
            REP       " 0",CURDATE
          ENDIF
SETUP99   RETURN
+
.*******************************************************************************
.        This subroutine prints the end of each line in the body of the invoice
.******************************************************************************
PRTEOL12 BRANCH    COUNT OF P12OL1,N12EOL,N12EOL,N12EOL,P12OL2:
                            N12EOL,N12EOL,P12OL3,N12EOL,N12EOL:        *10
                            N12EOL,N12EOL,P12OL4,N12EOL,P12OL5:
                            N12EOL,P12OL5A,N12EOL,P12OL6,P12OL8:       *20
                            P12OL9,P12OL10,P12OL11,N12EOL,N12EOL:
                            N12EOL,P12OL12,P12OL13,P12OL14,N12EOL:     *30
                            P12OL15,P12OL16,N12EOL,P12OL17,N12EOL:
                            P12OL18,P12OL19,P12OL20,P12OL21
         GOTO      N12EOL
.
.        Day Case (X or blank), Admission date, Admission code
.
P12OL1   PRINT     *85,ACCDAYC,*110,ADDATE,*125,ADMCODE;
         GOTO      N12EOL
.
.        Accomodation date from, & to, and number of accomodation days
.
P12OL2   PRINT     *90,DLCDATE,*105,CURDATE,*124,ACDAYS;
         GOTO      N12EOL
.
.        Accomodation total charge
.
P12OL3   PRINT     *111,ACTOTAL;
         GOTO      N12EOL
.
.        Attending Doctors Name
.
P12OL4   PRINT     *99,ADOCNAM;
         GOTO      N12EOL
.
.        Disease code or Diagnosis
.
P12OL5   PRINT     *99,XDESC1;
         GOTO      N12EOL
.
P12OL5A  PRINT     *99,XDESC2;
         GOTO      N12EOL
.
P12OL6   BRANCH    OVERPFL TO N12EOL
         IF        SURGFLG=1
           PRINT     *85,"SECTION 2. SURGICAL OR OBSTETRIC PATIENT";
         ELSE
           PRINT     *85,"SECTION 1. NON-SURGICAL PATIENT";
         ENDIF
         GOTO      N12EOL
.
P12OL8    BRANCH    OVERPFL TO N12EOL
          IF        SURGFLG=1
            PRINT     *96,"MBS No.",*113,"DATE OF PROCEDURE";
          ELSE
            PACK      KEY5 WITH CODEA,ATYPE
            CALL      RDCODE1
            BRANCH    OVRCD OF N12EOL
            PRINT     *96,"- ",TDESC
          ENDIF
         GOTO      N12EOL
.
P12OL9    IF        SURGFLG=1
            PRINT     *96,MBS1,*113,MBSDT1,*122,MBSCH1;
          ENDIF
          GOTO      N12EOL
.
P12OL10   IF        SURGFLG=1
            MATCH     SP4,MBS2
            IF        !@EQUAL
              PRINT     *96,MBS2,*113,MBSDT2,*122,MBSCH2;
            ENDIF
          ENDIF
          GOTO      N12EOL
.
P12OL11   IF        SURGFLG=1
            MATCH     SP4,MBS3
            IF        !@EQUAL
              PRINT     *96,MBS3,*113,MBSDT3,*122,MBSCH3;
            ENDIF
          ENDIF
          GOTO      N12EOL
.
P12OL12   IF        HDUDAY1<>0
            PRINT     *103,"FROM      TO    TOTAL DAYS";
          ENDIF
          GOTO      N12EOL
.
P12OL13   IF        HDUDAY1<>0
            PRINT     *85,"HIGH DEPENDENCY":
                      *102,FHDUDT1," ",THDUDT1,"    ",HDUDAY1;
          ENDIF
          GOTO      N12EOL
.
P12OL14   IF        HDUDAY2<>0
            PRINT     *102,FHDUDT2," ",THDUDT2,"    ",HDUDAY2;
          ENDIF
          GOTO      N12EOL
.
P12OL15   IF        THEACHG<>0
            PRINT     *85,"THEATRE FEE",*108,"DATE",*123,"CHARGE";
          ENDIF
          GOTO      N12EOL
.
P12OL16   IF        THEACHG<>0
            MATCH     ADATE,DDATE
            IF        @EQUAL
              PRINT     *85,"DAY CARE (SDTF)",*107,THEADTE,*119,"$",THEACHG;
            ELSE
              PRINT     *85,"IN PATIENT (ITF)",*107,THEADTE,*119,"$",THEACHG;
            ENDIF
          ENDIF
          GOTO      N12EOL
.
P12OL17   IF        LWCHG<>0
            PRINT     *85,"LABOUR WARD (LW)",*107,LWDT,*119,"$",LWCHG;
          ENDIF
          GOTO      N12EOL
.
P12OL18   IF        OTCHG1<>0
            PRINT     *85,"OTHER:ITEMS (e.g. PROCEDURE ROOM)";
          ENDIF
          GOTO      N12EOL
.
P12OL19   IF       OTCHG1<>0
            PRINT     *85,"---------------------------------";
          ENDIF
          GOTO      N12EOL
.
P12OL20   IF        OTCHG1<>0
            PRINT     *85,OTDESC1,*107,OTDT1,*119,"$",OTCHG1
          ENDIF
          GOTO      N12EOL
.
P12OL21   IF        OTCHG2<>0
            PRINT     *85,OTDESC2,*107,OTDT2,*119,"$",OTCHG2
          ENDIF
          GOTO      N12EOL
.
.        No extra details to print
.
N12EOL   PRINT     *N;
         RETURN
+
.******************************************************************************
.*                                 PRTEOL19 - West Wimmera                    *
.*                         Print The End Of Each Line                         *
.******************************************************************************
PRTEOL19  BRANCH    COUNT,PRTEL191,PRTEL19Z,PRTEL19Z,PRTEL19Z,PRTEL192:
                          PRTEL19Z,PRTEL19Z,PRTEL193,PRTEL19Z,PRTEL19Z: 10
                          PRTEL19Z,PRTEL19Z,PRTEL194,PRTEL19Z,PRTEL195:
                          PRTEL19Z,PRTEL196,PRTEL19Z,PRTEL198,PRTEL199: 20
                          PRTEL19A,PRTEL19B,PRTEL19Z,PRTEL19Z,PRTEL19Z:
                          PRTEL19Z,PRTEL19C,PRTEL19D,PRTEL19E,PRTEL19Z: 30
                          PRTEL19F,PRTEL19G,PRTEL19Z,PRTEL19H,PRTEL19Z:
                          PRTEL19I,PRTEL19J,PRTEL19K,PRTEL19L           39
.
          GOTO      PRTEL19Z
.
PRTEL191  PRINT     *85,ACCDAYC,*110,ADDATE,*125,ADMCODE;
          GOTO      PRTEL19Z
.
PRTEL192  PRINT     *90,DLCDATE,*105,CURDATE,*124,ACDAYS;
          GOTO      PRTEL19Z
.
PRTEL193  PRINT     *111,ACTOTAL;
          GOTO      PRTEL19Z
.
PRTEL194  PRINT     *99,ADOCNAM;
          GOTO      PRTEL19Z
.
PRTEL195  PRINT     *99,XDESC;
          GOTO      PRTEL19Z
.
PRTEL196  BRANCH    OVERPFL,PRTEL19Z
          IF        SURGFLG=1
            PRINT     *85,"SECTION 2. SURGICAL OR OBSTETRIC PATIENT";
          ELSE
            PRINT     *85,"SECTION 1. NON-SURGICAL PATIENT";
          ENDIF
          GOTO      PRTEL19Z
.
PRTEL198  BRANCH    OVERPFL,PRTEL19Z
          IF        SURGFLG=1
            PRINT     *96,"MBS No.",*113,"DATE OF PROCEDURE";
          ELSE
            PACK      KEY5,CODEA,ATYPE
            CALL      RDCODE1               * Read the codes file
            IF        OVRCD<>1
              PRINT     *96,"- ",TDESC;
            ENDIF
          ENDIF
          GOTO      PRTEL19Z
.
PRTEL199  IF        SURGFLG=1
            PRINT     *96,MBS1,*113,MBSDT1,*122,MBSCH1;
          ENDIF
          GOTO      PRTEL19Z
.
PRTEL19A  IF        SURGFLG=1
            PRINT     *96,MBS2,*113,MBSDT2,*122,MBSCH2;
          ENDIF
          GOTO      PRTEL19Z
.
PRTEL19B  IF        SURGFLG=1
            PRINT     *96,MBS3,*113,MBSDT3,*122,MBSCH3;
          ENDIF
          GOTO      PRTEL19Z
.
PRTEL19C  IF        HDUDAY1<>0
            PRINT     *103,"FROM      TO    TOTAL DAYS";
          ENDIF
          GOTO      PRTEL19Z
.
PRTEL19D  IF        HDUDAY1<>0
            PRINT     *85,"HIGH DEPENDENCY":
                      *102,FHDUDT1," ",THDUDT1,"    ",HDUDAY1;
          ENDIF
          GOTO      PRTEL19Z
.
PRTEL19E  IF        HDUDAY2<>0
            PRINT     *102,FHDUDT2," ",THDUDT2,"    ",HDUDAY2;
          ENDIF
          GOTO      PRTEL19Z
.
PRTEL19F  IF        THEACHG<>0
            PRINT     *85,"THEATRE FEE",*108,"DATE",*123,"CHARGE";
          ENDIF
          GOTO      PRTEL19Z
.
PRTEL19G  IF        THEACHG<>0
            MATCH     ADATE,DDATE
            IF        @EQUAL
              PRINT     *85,"DAY CARE (SDTF)",*107,THEADTE,*119,"$",THEACHG;
            ELSE
              PRINT     *85,"IN PATIENT (ITF)",*107,THEADTE,*119,"$",THEACHG;
            ENDIF
          ENDIF
          GOTO      PRTEL19Z
.
PRTEL19H  IF        LWCHG<>0
            PRINT     *85,"LABOUR WARD (LW)",*107,LWDT,*119,"$",LWCHG;
          ENDIF
          GOTO      PRTEL19Z
.
PRTEL19I  IF        OTCHG1<>0
            PRINT     *85,"OTHER:ITEMS (e.g. PROCEDURE ROOM)";
          ENDIF
          GOTO      PRTEL19Z
.
PRTEL19J  IF        OTCHG1<>0
            PRINT     *85,"---------------------------------";
          ENDIF
          GOTO      PRTEL19Z
.
PRTEL19K  IF        OTCHG1<>0
            PRINT     *85,OTDESC1,*107,OTDT1,*119,"$",OTCHG1;
          ENDIF
          GOTO      PRTEL19Z
.
PRTEL19L  IF        OTCHG2<>0
            PRINT     *85,OTDESC2,*107,OTDT2,*119,"$",OTCHG2;
          ENDIF
          GOTO      PRTEL19Z
.
PRTEL19Z  PRINT     *N;
          RETURN
+
.

.-------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.00.00"
.-------------------------------------------------------
. V9.04.01  11.04.2005 Peter Vela CAR 59696
.           Recompiled for SINUSAGE
. V9.03.01  10.09.2003 Steve Downing (VF.11.01 CAR 9375)
.           Recompiled for SINREBFD & SINREBIO
.-------------------------------------------------------
. V9.02.00  03.05.2002  Glenn Saunders
.           Export to new release i.e. v9.02 from vf.09
.-------------------------------------------------------
. VF.09.B01 02.11.2000 Charles Handaya
.           Recompiled for sincchaf and SINUSAGE change
.           Modification of Warehouse Security
.-------------------------------------------------------
. VF.01.01  18.07.2000 Charles Handaya
.           Omnicell import file - Move spaces into Restock ID (SIBARESI)
.           Quote 9817
.-------------------------------------------------------
. VF.00.03  05.01.2000 Charles Handaya
.           Recompiled for APSMASIO change
.           22.12.1999 Charles Handaya
.           Recompiled for Fixing Audit Date (CCYYMMDD)
. VF.00.02  02.11.1999 Sandra Barcham
.           Change locked message to use X
. VF.00.01  27.05.1999 Sandra Barcham
.           Allow X for exit on record locked question
.-------------------------------------------------------
INITAVC    FORM     12.6
TOTALCST   FORM     12.2
TOTALPAG   FORM     12.2
RECCOUNT   FORM     8
.
IMPORTFN   DIM      8
IMPORTFL   FILE     ASCII, FIXED=500
.REQTYPE    DIM      1
.REQNUMB    DIM      7
REQCST     DIM      5
REQCATA    DIM      7
REQWARH    DIM      5
REQIREQ    FORM     6
REQIQTY    FORM     6
LASTCST    DIM      5
LASTDEL    DIM      50
LOWUP     INIT      "AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz"
.-------------------------------------------------------
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBASIN32
.   Function      :   Input Picking Sheets Variance           
.   Generated  On :   13/12/2005
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       SINBACFD/INC
          INC       SINCCAFD/INC
          INC       SINCCBFD/INC
          INC       SINCCEFD/INC
          INC       SINCCFFD/INC
          INC       SINCCHFD/INC
          INC       SINCGBFD/INC
          INC       SINCIAFD/INC
          INC       SINCIEFD/INC
          INC       SINCIFFD/INC
          INC       SINCIHFD/INC
          INC       SINCIIFD/INC
          INC       SINCODFD/INC
          INC       SINCONFD/INC
          INC       SINITMFD/INC
          INC       SINNATFD/INC
          INC       SINPERFD/INC
          INC       SINPRQFD/INC
          INC       SINREAFD/INC
          INC       SINREBFD/INC
          INC       SINSUAFD/INC
          INC       SINSUBFD/INC
          INC       SINTMPDF/INC
          INC       SINWARFD/INC
          INC       SINWRKDF    
          INC       SINWRKFD/INC
          INC       SINWSEFD/INC
.=========================
.Local Variable Definition
.-------------------------
REQTYPE   DIM       1 * Scr 00 Fld     1
REQTDESC  DIM      30 * Scr 00 Fld     3
DIFFEREN  FORM     12.2 * Scr 00 Fld    17
NEWSOH    FORM     12.2 * Scr 00 Fld    18
STOKTAKE  FORM      1 * Scr 00 Fld    19
NEWBACK   FORM     12.2 * Scr 00 Fld    23
ISSQTY    FORM     12.2 * Scr 00 Fld    24
BACKORD   FORM     12.2 * Scr 00 Fld    25
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBASIN32"
PRGNAM    INIT      "Input Picking Sheets Variance           "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          MOVE      PORT,PARENTID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      RINCOCAT
          CALL      SC01L000
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          MOVE      "   24",AUDTSECT
          MOVE      "206",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening sinaudba";
            OPEN      SINAUDBA,"sinaudba"
          ENDIF
          DISPLAY   *P56:24,"Opening sinbacaf";
          OPEN      SINBACA1,"sinbacaf"
          DISPLAY   *P56:24,"Opening sinbacaf";
          OPEN      SINBACA2,"sinbacaf"
          DISPLAY   *P56:24,"Opening sinbacaf";
          OPEN      SINBACA3,"sinbacaf"
          DISPLAY   *P56:24,"Opening sinccaaf";
          OPEN      SINCCAA1,"sinccaaf"
          DISPLAY   *P56:24,"Opening sinccaaf";
          OPEN      SINCCAA2,"sinccaaf"
          DISPLAY   *P56:24,"Opening sinccbaf";
          OPEN      SINCCBA1,"sinccbaf"
          DISPLAY   *P56:24,"Opening sincceaf";
          OPEN      SINCCEA1,"sincceaf"
          DISPLAY   *P56:24,"Opening sincceaf";
          OPEN      SINCCEA2,"sincceaf"
          DISPLAY   *P56:24,"Opening sinccfaf";
          OPEN      SINCCFA1,"sinccfaf"
          DISPLAY   *P56:24,"Opening sinccfaf";
          OPEN      SINCCFA2,"sinccfaf"
          DISPLAY   *P56:24,"Opening sincchaf";
          OPEN      SINCCHA1,"sincchaf"
          DISPLAY   *P56:24,"Opening sincchaf";
          OPEN      SINCCHA2,"sincchaf"
          DISPLAY   *P56:24,"Opening sincchaf";
          OPEN      SINCCHA3,"sincchaf"
          DISPLAY   *P56:24,"Opening sincchaf";
          OPEN      SINCCHA4,"sincchaf"
          DISPLAY   *P56:24,"Opening sincchaf";
          OPEN      SINCCHA5,"sincchaf"
          DISPLAY   *P56:24,"Opening sincgbaf";
          OPEN      SINCGBA1,"sincgbaf"
          DISPLAY   *P56:24,"Opening sinciaaf";
          OPEN      SINCIAA1,"sinciaaf"
          DISPLAY   *P56:24,"Opening sinciaaf";
          OPEN      SINCIAA2,"sinciaaf"
          DISPLAY   *P56:24,"Opening sinciaaf";
          OPEN      SINCIAA3,"sinciaaf"
          DISPLAY   *P56:24,"Opening sincieaf";
          OPEN      SINCIEA1,"sincieaf"
          DISPLAY   *P56:24,"Opening sincieaf";
          OPEN      SINCIEA2,"sincieaf"
          DISPLAY   *P56:24,"Opening sincifaf";
          OPEN      SINCIFA1,"sincifaf"
          DISPLAY   *P56:24,"Opening sincifaf";
          OPEN      SINCIFA2,"sincifaf"
          DISPLAY   *P56:24,"Opening sincihaf";
          OPEN      SINCIHA1,"sincihaf"
          DISPLAY   *P56:24,"Opening sincihaf";
          OPEN      SINCIHA2,"sincihaf"
          DISPLAY   *P56:24,"Opening sinciiaf";
          OPEN      SINCIIA1,"sinciiaf"
          DISPLAY   *P56:24,"Opening sincodaf";
          OPEN      SINCODA1,"sincodaf"
          DISPLAY   *P56:24,"Opening sincodaf";
          OPEN      SINCODA2,"sincodaf"
          DISPLAY   *P56:24,"Opening sinitmaf";
          OPEN      SINITMA1,"sinitmaf"
          DISPLAY   *P56:24,"Opening sinperaf";
          OPEN      SINPERA1,"sinperaf"
          DISPLAY   *P56:24,"Opening sinperaf";
          OPEN      SINPERA2,"sinperaf"
          DISPLAY   *P56:24,"Opening sinprqaf";
          OPEN      SINPRQA1,"sinprqaf"
          DISPLAY   *P56:24,"Opening sinreaaf";
          OPEN      SINREAA1,"sinreaaf"
          DISPLAY   *P56:24,"Opening sinreaaf";
          OPEN      SINREAA2,"sinreaaf"
          DISPLAY   *P56:24,"Opening sinreaaf";
          OPEN      SINREAA3,"sinreaaf"
          DISPLAY   *P56:24,"Opening sinreaaf";
          OPEN      SINREAA4,"sinreaaf"
          DISPLAY   *P56:24,"Opening sinrebaf";
          OPEN      SINREBA1,"sinrebaf"
          DISPLAY   *P56:24,"Opening sinrebaf";
          OPEN      SINREBA2,"sinrebaf"
          DISPLAY   *P56:24,"Opening sinrebaf";
          OPEN      SINREBA3,"sinrebaf"
          DISPLAY   *P56:24,"Opening sinsuaaf";
          OPEN      SINSUAA1,"sinsuaaf"
          DISPLAY   *P56:24,"Opening sinsuaaf";
          OPEN      SINSUAA2,"sinsuaaf"
          DISPLAY   *P56:24,"Opening sinsuaaf";
          OPEN      SINSUAA3,"sinsuaaf"
          DISPLAY   *P56:24,"Opening sinsubaf";
          OPEN      SINSUBA1,"sinsubaf"
          DISPLAY   *P56:24,"Opening sinwaraf";
          OPEN      SINWARA1,"sinwaraf"
          DISPLAY   *P56:24,"Opening sinwaraf";
          OPEN      SINWARA2,"sinwaraf"
          DISPLAY   *P56:24,"Opening sinwseaf";
          OPEN      SINWSEA1,"sinwseaf"
          DISPLAY   *P56:24,"Opening sinwseaf";
          OPEN      SINWSEA2,"sinwseaf"
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "00",SCRID
          IF         @EQUAL
            CALL       PS00L000   * Main Screen                        
          ENDIF
          MATCH     "01",SCRID
          IF         @EQUAL
            CALL       PS01L000   * Menu                               
          ENDIF
          MATCH     "02",SCRID
          IF         @EQUAL
            CALL       PS02L000   * Import Variance File               
          ENDIF
          RETURN
.--------------------------------
. Screen - Main Screen                        
.--------------------------------
SC00L000
SC00L100
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    4",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC00L200
          CALL      CF00L000 * Clear Fields
          CALL      ONAT0000
SC00L300
          CALL      KY00L000 * Enter Key Fields
          BRANCH    EXIT,SC00L999,SC00L999
SC00L400
          CALL      WP00L000 * Load any WP Details
SC00L500
          CALL      LM00L000 * Load any Batch Details
SC00L600
          CALL      DF00L000 * Display Fields
SC00L700
          CALL      SF00L000 * Select Fields
          BRANCH    EXIT,SC00L100,SC00L100,SC00L200
SC00L800
SC00L900
SC00L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Main Screen                        
.-------------------------------------------------------
CF00L000  COMPARE   ZERO,ACCEPT
              GOTO      CF00L999 IF EQUAL
          MOVE      SP70,REQTYPE 
          MOVE      SP70,REQNUMB 
          MOVE      SP70,REQTDESC
          MOVE      SP70,SIRACST 
          MOVE      SP70,SIRADEL 
          MOVE      SP70,SIRADAT 
          MOVE      SP70,SIRBWAR 
          MOVE      SP70,SIWADES 
          MOVE      SP70,SIRBCAT 
          MOVE      SP70,SIIADES 
          MOVE      ZERO,SIRBRQT 
          MOVE      ZERO,SIRBIQT 
          MOVE      SP70,SICADESC
          MOVE      ZERO,DIFFEREN
          MOVE      ZERO,NEWSOH  
          MOVE      ZERO,STOKTAKE
          MOVE      ZERO,SIIESOH 
          MOVE      ZERO,NEWBACK 
          MOVE      ZERO,ISSQTY  
          MOVE      ZERO,BACKORD 
CF00L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Main Screen                        
.--------------------------------------------------------
KY00L000
.
KY00L110
.
.
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,REQTYPE 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    2",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,REQNUMB 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    3",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,REQTDESC
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      EREQT000
          BRANCH    EXIT,KY00L900,KY00L900
          MOVE      ZERO,ACCEPT
          MOVE      REQTYPE,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      REQTYPE,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    2",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      REQNUMB,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    3",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      REQTDESC,VAR     
            CALL      DISPITEM
          ENDIF
.
KY00L120
.
.
          MOVE      "    6",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SIRACST 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SIRADEL 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    8",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SIRADAT 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   16",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SICADESC
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          MOVE      "    2",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      EREQN000
          BRANCH    EXIT,KY00L110,KY00L900
          MOVE      ZERO,ACCEPT
          MOVE      REQNUMB,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    6",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SIRACST,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SIRADEL,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    8",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            UNPACK    SIRADAT,CCENT,CYEAR,CMON,CDAY           
            CALL      PACDATE
            MOVE      CPCDATE,VAR
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   16",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SICADESC,VAR     
            CALL      DISPITEM
          ENDIF
.
KY00L130
.
.
          MOVE      "    9",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SIRBWAR 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   10",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SIWADES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   12",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SIIADES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   13",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SIRBRQT 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   14",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SIRBIQT 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   22",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SIIESOH 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   25",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,BACKORD 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          MOVE      "   11",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      KSIIA000
          BRANCH    EXIT,KY00L120,KY00L900
          MOVE      ZERO,ACCEPT
          CALL      MVACCEPT
          MOVE      SIRBCAT,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    9",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SIRBWAR,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   10",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SIWADES,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   12",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SIIADES,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   13",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SIRBRQT,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   14",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SIRBIQT,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   22",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SIIESOH,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   25",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      BACKORD,VAR      
            CALL      DISPITEM
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      KY00L999
.
KY00L900  MOVE      ONE,EXIT
KY00L999  RETURN
.---------------------------------------------------------
. Load WP files for : Main Screen                        
.---------------------------------------------------------
WP00L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Main Screen                        
.---------------------------------------------------------
LM00L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Main Screen                        
.---------------------------------------------------------
DF00L000
          BRANCH   ACCEPT,DF00L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF00L900
          MATCH    PRGID,SCPSPID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF00L010 IF NOT EQUAL
.
          CALL     PS00L000 * Display Field
          GOTO     DF00L010
DF00L900
DF00L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Main Screen                        
.---------------------------------------------------------
PS00L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS00L999,PS00L999,PS00L101,PS00L999:
                            PS00L999,PS00L102,PS00L103,PS00L104:
                            PS00L105,PS00L106,PS00L999,PS00L107:
                            PS00L108,PS00L109,PS00L999,PS00L110:
                            PS00L111,PS00L112,PS00L113,PS00L999:
                           PS00L999,PS00L114,PS00L115,PS00L116:
                            PS00L117
          GOTO     PS00L999
.
PS00L101
          MOVE      REQTDESC,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L102
          MOVE      SIRACST,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L103
          MOVE      SIRADEL,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L104
          UNPACK    SIRADAT,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L105
          MOVE      SIRBWAR,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L106
          MOVE      SIWADES,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L107
          MOVE      SIIADES,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L108
          MOVE      SIRBRQT,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L109
          MOVE      SIRBIQT,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L110
          MOVE      SICADESC,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L111
          MOVE      DIFFEREN,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L112
          MOVE      NEWSOH,VAR       
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L113
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      STOKTAKE,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L114
          MOVE      SIIESOH,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L115
          MOVE      NEWBACK,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L116
          MOVE      ISSQTY,VAR       
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L117
          MOVE      BACKORD,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
PS00L999
          RETURN
.---------------------------------------------------------
. Selections for : Main Screen                        
.---------------------------------------------------------
SF00L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF00L001  BRANCH   ACCEPT,SF00L020
.
SF00L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L101,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L102,SF00L006:
                            SF00L006,SF00L103,SF00L104,SF00L006:
                           SF00L006,SF00L006,SF00L105,SF00L106:
                            SF00L006
SF00L006  BEEP
          GOTO     SF00L005
SF00L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF00L090
          MATCH    PRGID,SCSLPID
          GOTO     SF00L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF00L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L103,SF00L104,SF00L020:
                           SF00L020,SF00L020,SF00L105,SF00L106:
                            SF00L020
          GOTO     SF00L020
SF00L090  MOVE     ZERO,ACCEPT
          GOTO     SF00L001
.
SF00L101
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L102
          CALL      WSIRB000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L103
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KNSOH000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L103
            ENDIF
            BRANCH    EXIT,SF00L103,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      NEWSOH,VAR       
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L104
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,STOKTAKE
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      STOKTAKE,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L105
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KBACK000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L105
            ENDIF
            BRANCH    EXIT,SF00L105,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      NEWBACK,VAR      
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L106
.
.
          MOVE      "   17",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DIFFEREN
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KNUMI000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L106
            ENDIF
            BRANCH    EXIT,SF00L106,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      ISSQTY,VAR       
          CALL      DISPITEM
.
.
          MOVE      "   17",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      DIFFEREN,VAR     
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
SF00L990  MOVE      ONE,EXIT * Exit Char Restart
SF00L999  RETURN
.--------------------------------
. Screen - Menu                               
.--------------------------------
SC01L000
SC01L100
          MOVE      "01",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC01L200
          CALL      CF01L000 * Clear Fields
SC01L300
          CALL      KY01L000 * Enter Key Fields
          BRANCH    EXIT,SC01L999,SC01L999
SC01L400
          CALL      WP01L000 * Load any WP Details
SC01L500
          CALL      LM01L000 * Load any Batch Details
SC01L600
          CALL      DF01L000 * Display Fields
SC01L700
          CALL      SF01L000 * Select Fields
          BRANCH    EXIT,SC01L100,SC01L100,SC01L200
SC01L800
SC01L900
SC01L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Menu                               
.-------------------------------------------------------
CF01L000
CF01L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Menu                               
.--------------------------------------------------------
KY01L000
          MOVE      ZERO,EXIT
          GOTO      KY01L999
.
KY01L900  MOVE      ONE,EXIT
KY01L999  RETURN
.---------------------------------------------------------
. Load WP files for : Menu                               
.---------------------------------------------------------
WP01L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Menu                               
.---------------------------------------------------------
LM01L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Menu                               
.---------------------------------------------------------
DF01L000
          BRANCH   ACCEPT,DF01L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF01L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF01L900
          MATCH    PRGID,SCPSPID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF01L010 IF NOT EQUAL
.
          CALL     PS01L000 * Display Field
          GOTO     DF01L010
DF01L900
DF01L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Menu                               
.---------------------------------------------------------
PS01L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS01L999,PS01L999,PS01L999,PS01L999
          GOTO     PS01L999
PS01L999
          RETURN
.---------------------------------------------------------
. Selections for : Menu                               
.---------------------------------------------------------
SF01L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF01L001  BRANCH   ACCEPT,SF01L020
.
SF01L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L006,SF01L101,SF01L102,SF01L103
SF01L006  BEEP
          GOTO     SF01L005
SF01L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF01L090
          MATCH    PRGID,SCSLPID
          GOTO     SF01L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF01L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L020,SF01L020,SF01L020,SF01L020
          GOTO     SF01L020
SF01L090  MOVE     ZERO,ACCEPT
          GOTO     SF01L001
.
SF01L101
          MOVE      ZERO,EXIT
          GOTO      SF01L999
.
SF01L102
          CALL      SC00L000
          MOVE      ONE,EXIT
          GOTO      SF01L999
.
SF01L103
          CALL      IMPT0000
          MOVE      ONE,EXIT
          GOTO      SF01L999
SF01L990  MOVE      ONE,EXIT * Exit Char Restart
SF01L999  RETURN
.--------------------------------
. Screen - Import Variance File               
.--------------------------------
SC02L000
SC02L100
          MOVE      "02",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    4",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC02L200
          CALL      CF02L000 * Clear Fields
SC02L300
          CALL      KY02L000 * Enter Key Fields
          BRANCH    EXIT,SC02L999,SC02L999
SC02L400
          CALL      WP02L000 * Load any WP Details
SC02L500
          CALL      LM02L000 * Load any Batch Details
SC02L600
          CALL      DF02L000 * Display Fields
SC02L700
          CALL      SF02L000 * Select Fields
          BRANCH    EXIT,SC02L100,SC02L100,SC02L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC02L800
SC02L900
SC02L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Import Variance File               
.-------------------------------------------------------
CF02L000
CF02L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Import Variance File               
.--------------------------------------------------------
KY02L000
          MOVE      ZERO,EXIT
          GOTO      KY02L999
.
KY02L900  MOVE      ONE,EXIT
KY02L999  RETURN
.---------------------------------------------------------
. Load WP files for : Import Variance File               
.---------------------------------------------------------
WP02L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Import Variance File               
.---------------------------------------------------------
LM02L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Import Variance File               
.---------------------------------------------------------
DF02L000
          BRANCH   ACCEPT,DF02L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF02L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF02L900
          MATCH    PRGID,SCPSPID
          GOTO     DF02L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF02L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF02L010 IF NOT EQUAL
.
          CALL     PS02L000 * Display Field
          GOTO     DF02L010
DF02L900
DF02L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Import Variance File               
.---------------------------------------------------------
PS02L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS02L101,PS02L102,PS02L103,PS02L999:
                            PS02L999,PS02L104,PS02L105,PS02L106:
                            PS02L107,PS02L108,PS02L109,PS02L110:
                            PS02L111,PS02L112,PS02L999,PS02L113:
                            PS02L114,PS02L115,PS02L116,PS02L999:
                           PS02L999,PS02L117,PS02L118,PS02L119:
                            PS02L120
          GOTO     PS02L999
.
PS02L101
          MOVE      REQTYPE,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L102
          MOVE      REQNUMB,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L103
          MOVE      REQTDESC,VAR     
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L104
          MOVE      SIRACST,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L105
          MOVE      SIRADEL,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L106
          UNPACK    SIRADAT,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L107
          MOVE      SIRBWAR,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L108
          MOVE      SIWADES,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L109
          MOVE      SIRBCAT,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L110
          MOVE      SIIADES,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L111
          MOVE      SIRBRQT,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L112
          MOVE      SIRBIQT,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L113
          MOVE      SICADESC,VAR     
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L114
          MOVE      DIFFEREN,VAR     
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L115
          MOVE      NEWSOH,VAR       
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L116
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      STOKTAKE,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L117
          MOVE      SIIESOH,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L118
          MOVE      NEWBACK,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L119
          MOVE      ISSQTY,VAR       
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L120
          MOVE      BACKORD,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
PS02L999
          RETURN
.---------------------------------------------------------
. Selections for : Import Variance File               
.---------------------------------------------------------
SF02L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF02L001  BRANCH   ACCEPT,SF02L020
.
SF02L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF02L006,SF02L006,SF02L006,SF02L006:
                            SF02L101,SF02L006,SF02L006,SF02L006:
                            SF02L006,SF02L006,SF02L006,SF02L006:
                            SF02L006,SF02L006,SF02L102,SF02L006:
                            SF02L006,SF02L103,SF02L104,SF02L006:
                           SF02L006,SF02L006,SF02L105,SF02L106:
                            SF02L006
SF02L006  BEEP
          GOTO     SF02L005
SF02L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF02L090
          MATCH    PRGID,SCSLPID
          GOTO     SF02L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF02L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF02L020,SF02L020,SF02L020,SF02L020:
                            SF02L020,SF02L020,SF02L020,SF02L020:
                            SF02L020,SF02L020,SF02L020,SF02L020:
                            SF02L020,SF02L020,SF02L020,SF02L020:
                            SF02L020,SF02L103,SF02L104,SF02L020:
                           SF02L020,SF02L020,SF02L105,SF02L106:
                            SF02L020
          GOTO     SF02L020
SF02L090  MOVE     ZERO,ACCEPT
          GOTO     SF02L001
.
SF02L101
          MOVE      ZERO,EXIT
          GOTO      SF02L999
.
SF02L102
          CALL      WSIRB000
          MOVE      ZERO,EXIT
          GOTO      SF02L999
.
SF02L103
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KNSOH000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L103
            ENDIF
            BRANCH    EXIT,SF02L103,SF02L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF02L990 IF EQUAL
          ENDIF
          MOVE      NEWSOH,VAR       
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L104
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,STOKTAKE
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      STOKTAKE,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L105
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KBACK000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L105
            ENDIF
            BRANCH    EXIT,SF02L105,SF02L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF02L990 IF EQUAL
          ENDIF
          MOVE      NEWBACK,VAR      
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L106
.
.
          MOVE      "   17",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DIFFEREN
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KNUMI000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L106
            ENDIF
            BRANCH    EXIT,SF02L106,SF02L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF02L990 IF EQUAL
          ENDIF
          MOVE      ISSQTY,VAR       
          CALL      DISPITEM
.
.
          MOVE      "   17",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      DIFFEREN,VAR     
            CALL      DISPITEM
          ENDIF
          GOTO     SF02L001
SF02L990  MOVE      FOUR,EXIT * Exit Char Exit
SF02L999  RETURN
.@@@@@ Function Restart Point @@@@@
. ------------------------------------------------------------
. Read Catalog Code Keyin Control Information
.
. INCOCATE  FORM      1         67      Catalog Code Type
. 0 Normal Keyin,   1 *JR *DE,   2 Generated ,  3 Generated with Check Digit
. INCONCAT  FORM      7         68      Next Generated Catalog Number
.------------------------------------------------------------
RINCOCAT  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF FORMAT
          READ      CONTROLF,SIXTY3;*67,INCOCATE
          TRAPCLR   FORMAT
          IF        OVRCD=1
            MOVE      ZERO,INCOCATE
            WRITAB    CONTROLF,SIXTY3;*67,INCOCATE
          ENDIF
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF FORMAT
          READ      CONTROLF,TWENTY3;*120,HBACK
          TRAPCLR   FORMAT
          IF        OVRCD=1
            MOVE      ZERO,HBACK
            WRITAB    CONTROLF,TWENTY3;*120,HBACK
          ENDIF
.
          RETURN
.------------------------------------------------------------------------
. Open Nato X-Ref File if required
.------------------------------------------------------------------------
ONAT0000  OPEN      CONTROLF,"controlf"
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF FORMAT
          READ      CONTROLF,SIXTY3;*143,HNONUSAG
          TRAPCLR   FORMAT
          IF        OVRCD=1
            MOVE      ONE,HNONUSAG
            WRITAB    CONTROLF,SIXTY3;*143,HNONUSAG
          ENDIF
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF FORMAT
          READ      CONTROLF,SIXTY3;*141,INCNNATO
          TRAPCLR   FORMAT
          IF        OVRCD=1
            MOVE      ZERO,INCNNATO
            WRITAB    CONTROLF,SIXTY3;*141,INCNNATO
          ENDIF
.
          IF        INCNNATO=1
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      SINNATA1,"sinnataf"
            TRAPCLR   IO
            IF        OVRCD=1
              DISPLAY   *P1:24,*EL,*B,"Nato file does not exist. Run fixit.  ";
              CALL      HITENTER
              CHAIN     PGM
            ENDIF
.
            OPEN      SINNATA2,"sinnataf"
          ENDIF
.
ONAT9999  RETURN
.----------------------------------------
. Move one to accept to for insert mode
.----------------------------------------
MVACCEPT  MOVE      ONE,ACCEPT
          RETURN
.----------------------------------------------------------------------
. Enter requisition type
.----------------------------------------------------------------------
EREQT000  CALL      VCATRT00        * Verify Category Ok
          BRANCH    REQTSTAT,EREQT800,EREQT900
.
          CALL      REQTYP00
          BRANCH    EXIT,EREQT999,EREQT999
          MOVE      SICDDESC,REQTDESC
.
          READ      CONTROLF,SIXTY3;*133,INCOSI40
          PACK      INCOSI40,INCOSI40,SP70
          REP       " 0",INCOSI40
          MATCH     "1",INCOSI40
          IF        @EQUAL
            MATCH     "I",REQTYPE
            IF        @EQUAL
              BEEP
              CLEAR     DISPMSG
              APPEND    "You May Not Modify Imprests - ",DISPMSG
              RESET     DISPMSG
              CALL      MESSAGE1
              GOTO      EREQT000
            ENDIF
          ENDIF
.
          GOTO      EREQT999
.
EREQT800  MOVE      ZERO,EXIT       * Only One Requisition Type
          GOTO      EREQT999
.
EREQT900  MOVE      "Requisition Type Codes Missing. (Cat. RT ) - ",DISPMSG
          CALL      MESSAGE1
          MOVE      TWO,EXIT
          GOTO      EREQT999
.
EREQT999  RETURN
.
VCATRT00  MOVE      "RT    ",KEY6
          CALL      RDSICD1
          BRANCH    OVRCD,VCATRT90
          CALL      RKSICD1
          BRANCH    OVRCD,VCATRT90
          MATCH     "RT ",SICDCATA
          GOTO      VCATRT90 IF NOT EQUAL
.
VCATRT10
          CALL      RKSICD1
          BRANCH    OVRCD,VCATRT80
          MATCH     "RT ",SICDCATA
          GOTO      VCATRT80 IF NOT EQUAL
          MATCH     "R  ",SICDCODE
          GOTO      VCATRT10 IF EQUAL
          MOVE      ZERO,REQTSTAT
          GOTO      VCATRT99
.
VCATRT80  CALL      RPSICD1
          MOVE      SICDCODE,REQTYPE
          MATCH     ANSR,REQTYPE         * Type "R" is Reserved for Returns
          GOTO      VCATRT90 IF EQUAL
          MOVE      SICDDESC,REQTDESC
          MOVE      ONE,REQTSTAT
          GOTO      VCATRT99
.
VCATRT90  MOVE      TWO,REQTSTAT   * Nothing Setup
          GOTO      VCATRT99
.
VCATRT99  RETURN
.
REQTYP00  KEYIN     *PCCOL:CVERT,*V2LON,*RV,*+,REQTYPE
          PACK      SEQTYPE,REQTYPE,REQTYPE,SP70
          MOVE      REQTYPE,SICDCODE
          ENDSET    SICDCODE
          APPEND    SP70,SICDCODE
          RESET     SICDCODE
.
          MATCH     SP70,SICDCODE
          GOTO      REQTYP90 IF EQUAL
.
          CMATCH    EXITCHAR,SICDCODE
          GOTO      REQTYP95 IF EQUAL
.
          CMATCH    QUEST,SICDCODE
          GOTO      REQTYP10 IF NOT EQUAL
.
          MOVE      "RT ",SICDCATA
          MOVE      CCITEM,SCCITEM
          CALL      HSICDB00
          MOVE      SCCITEM,CCITEM
.
          ENDSET    SICDCODE
          APPEND    SP70,SICDCODE
          RESET     SICDCODE
.
          MATCH     SP70,SICDCODE
          GOTO      REQTYP00 IF EQUAL
.
          DISPLAY   *PCCOL:CVERT,*V2LON,SICDCODE
REQTYP10
          MOVE      "RT ",SICDCATA
          PACK      KEY6,SICDCATA,SICDCODE
          CALL      RDSICD1
          BRANCH    OVRCD,REQTYP80
          MOVE      SICDCODE,REQTYPE
          MATCH     ANSR,REQTYPE         * Type "R" is Reserved for Returns
          GOTO      REQTYP70 IF EQUAL
          MOVE      ZERO,EXIT
          GOTO      REQTYP99
.
REQTYP70  MOVE      "Requisition Type is for Return of Stock - ",DISPMSG
          CALL      MESSAGE1
          GOTO      REQTYP00
.
REQTYP80  MOVE      "Requisition Type Does Not Exist - ",DISPMSG
          CALL      MESSAGE1
          GOTO      REQTYP00
REQTYP90  MOVE      ONE,EXIT
          GOTO      REQTYP99
REQTYP95  MOVE      TWO,EXIT
REQTYP99  RETURN
.
.----------------------------------------------------------------------
. Enter requisition number
.----------------------------------------------------------------------
EREQN000  MOVE      SP70,REQNUMB
          KEYIN     *PCCOL:CVERT,*DV,REQNUMB:
                    *PCCOL:CVERT,*V2LON,*DE,*JR,REQNUMB
          PACK      REQNUMB,REQNUMB,SP70
          PACK      SEQNUMB,REQNUMB,SP70
.
          DISPLAY   *PCCOL:CVERT,*V2LON,REQNUMB
          MATCH     SP70,REQNUMB
          GOTO      EREQN900 IF EQUAL
          PACK      KEY8,REQTYPE,REQNUMB,SP70
          UNPACK    KEY8,SIRBTYP,SIRBREQ
          CALL      RDSIRA1
          IF        OVRCD=1
            MOVE      "Requisition Not on File - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      EREQN000
          ENDIF
.
          MOVE      SIRACST,KEY5
          CALL      RDSICA1
.
          PACK      KEY8,REQTYPE,REQNUMB,SP70
          REPEAT
            CALL      RLSIRA1
            BRANCH    OVRCD,EREQN000   * should be there !!
            IF        OVRCD=2
              PACK      DISPMSG,SP70,SP70
              CALL      MESSAGE2
              KEYIN     *P1:24,*EL,"Requisition Locked - (":
                        *V2LON,"R",*HOFF,")etry or e(":
                        *V2LON,"X",*HOFF,")it ? ",ANS
              CALL      MESSAGE3
              PACK      ANS,ANS,SP70
              REP       UPPLOW,ANS
              MATCH     "X",ANS
              GOTO      EREQN000 IF EQUAL
              MATCH     "E",ANS
              GOTO      EREQN000 IF EQUAL
            ENDIF
          UNTIL     OVRCD=0
.
          MOVE      ZERO,EXIT
          GOTO      EREQN999
.
EREQN900
          IF        REQTSTAT=0
            MOVE      ONE,EXIT
          ELSE
            MOVE      TWO,EXIT
          ENDIF
.
EREQN999  RETURN
.********************************************************************
. Keyin catalog code
.********************************************************************
KSIIA000  MOVE      ZERO,CKEYTYP
          CALL      KSIIAA00
          BRANCH    EXIT,KSIIA950,KSIIA950
.
          PACK      KEY15,SIIACAT,REQTYPE,REQNUMB,SP70
          PACK      KEY20,SIIACAT,REQTYPE,REQNUMB,SP70
          CALL      RSSIRB2
          CALL      RKSIRB2
          BRANCH    OVRCD,KSIIA810    * Not on Requisition
          PACK      KEY20,SIRBCAT,SIRBTYP,SIRBREQ,SIRBWAR,SP70
          MATCH     KEY15,KEY20
          GOTO      KSIIA810 IF NOT EQUAL
.
. Check for more than one Warehouse.
.------------------------------------
          CALL      RKSIRB2
          BRANCH    OVRCD,KSIIA100   * Not More Than One
          PACK      KEY20,SIRBCAT,SIRBTYP,SIRBREQ,SIRBWAR,SP70
          MATCH     KEY15,KEY20
          GOTO      KSIIA100 IF NOT EQUAL
.
. On More Than One Warehouse on the same requisition (This will be Rare)
.-----------------------------------------------------------------------
          MOVE      "    9",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Warehouse Field Missing from Screen - ",DISPMSG
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
.
KSIIA050  MOVE      ZERO,CKEYTYP
          CALL      KSIWSA00
          BRANCH    EXIT,KSIIA820,KSIIA820
          PACK      KEY20,SIIACAT,REQTYPE,REQNUMB,SIWAWAR
          CALL      RDSIRB2
          BRANCH    OVRCD,KSIIA830
          GOTO      KSIIA110
.
. Only One So Read Back Last Record.
.-----------------------------------
KSIIA100  CALL      RPSIRB2
.
KSIIA110  PACK      KEY9,PASSCODE,SIRBWAR,SP70   * check warehouse security
          CALL      RDSIWS1
          BRANCH    OVRCD,KSIIA890
.
          PACK      KEY12,SIRBCAT,SIRBWAR
          CALL      SISIWK1
          IF        OVRCD=0
            BEEP
            MOVE      "Catalog in Stocktake for Warehouse - ",DISPMSG
            CALL      MESSAGE1
            GOTO      KSIIA000
          ENDIF
.
          MOVE      SIRBRQT,SSIRBRQT        * save old values
          MOVE      SIRBIQT,SSIRBIQT
          MOVE      SIRBAMT,SSIRBAMT
          IF        HBACK<>1
            MOVE      ZERO,BACKORD
          ELSE
            ASSIGN    SIRBRQT-SIRBIQT,BACKORD
          ENDIF
          PACK      KEY20,SIRBTYP,SIRBREQ,SIRBWAR,SIRBCAT,SP70
          CALL      RDSIRB1
          IF        OVRCD=1
            MOVE      "Index Corrupt on SINREB. Fatal Error - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
.
          PACK      KEY17,SIRBBCH,SIRBLED,SIRBACC
          MATCH     SP70,KEY17
          IF        !(@EQUAL)
            MOVE      "Requisition Has Been Transfer to GL - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            MATCH     "*",ANS
            IF        !(@EQUAL)
              MOVE      TWO,EXIT
              GOTO      KSIIA999
            ENDIF
          ENDIF
.
          PACK      KEY12,SIRBCAT,SIRBWAR
          REPEAT
            CALL      RLSIIE1
            IF        OVRCD=1
              MOVE      "Catalog Not Located At This Warehouse - ",DISPMSG
              CALL      MESSAGE1
              GOTO      FATALERR
            ENDIF
            IF        OVRCD=2
              PACK      DISPMSG,SP70,SP70
              CALL      MESSAGE2
              KEYIN     *P1:24,*EL,"Catalog/Warehouse Locked - (":
                        *V2LON,"R",*HOFF,")etry or e(":
                        *V2LON,"X",*HOFF,")it ? ",*V2LON,ANS
              CALL      MESSAGE3
              PACK      ANS,ANS,SP70
              REP       UPPLOW,ANS
              MATCH     "X",ANS
              GOTO      KSIIA000 IF EQUAL
              MATCH     "E",ANS
              GOTO      KSIIA000 IF EQUAL
            ENDIF
          UNTIL     OVRCD=0
.
          MOVE      ZERO,EXIT
          GOTO      KSIIA999
.
KSIIA810  MOVE      "Catalog not on this Requisition - ",DISPMSG
          BEEP
          CALL      MESSAGE1
          GOTO      KSIIA000
.
KSIIA820  MOVE      "   11",FLDID
          CALL      GETPOSIT
          GOTO      KSIIA000
.
KSIIA830  MOVE      "Catalog/Warehouse NOT on this Requisition - ",DISPMSG
          BEEP
          CALL      MESSAGE1
          GOTO      KSIIA050
.
KSIIA890  BEEP
          CLEAR     DISPMSG
          APPEND    "You have no access for Warehouse ",DISPMSG
          APPEND    SIRBWAR,DISPMSG
          APPEND    " - ",DISPMSG
          CALL      MESSAGE1
          GOTO      KSIIA000
.
KSIIA900  MOVE      ZERO,EXIT
          GOTO      KSIIA999
.
KSIIA950  UNPACK    SP70,SIRBCAT,SAVECAT
          MOVE      ONE,EXIT
.
KSIIA999  RETURN
.----------------------------------------------------------------------
. Save data
.------------
. Requisition Record Has Been Locked.
. Catalog/Warehouse Record has been Locked.
.----------------------------------------------------------------------
WSIRB000  ASSIGN    (SIRBAMT/SIRBIQT),INITAVC
.
          IF        INITAVC=0
            MOVE      SIIAAVC,INITAVC
          ENDIF
          ASSIGN    SIRATOT-(DIFFEREN*INITAVC),SIRATOT
          CALL      UPSIRA1
.
          CALL      UPITM000              * Update Item History & Usage
.
          IF        NEWSOH<>SIIESOH
            MOVE      NEWSOH,SIIESOH      * Set up new stock on hand
            CALL      UPSIIE1
            CALL      SOHITM00
          ENDIF
.
          COMPARE   NEWBACK,BACKORD
          CALL      UBACK000 IF NOT EQUAL * Backorders if Required
.
          COMPARE   ONE,STOKTAKE
          CALL      USTOK000 IF EQUAL     * Place On Backorder
.
          ASSIGN    (SIRBAMT-(DIFFEREN*INITAVC)),SIRBAMT
          MOVE      ISSQTY,SIRBIQT
          CALL      UPSIRB1
.
WSIRB999
          PACK      KEY12,SIIACAT,SIWAWAR,SP70   * Unlock Catalog/Warehouse
          CALL      UUSIIE1
          PACK      KEY8,SIRATYP,SIRAREQ,SP70    * Unlock Requisition
          CALL      UUSIRA1
          RETURN
.-----------------------------------
. Update Backorder File
.-----------------------------------
UBACK000
          COMPARE   ONE,HBACK
          GOTO      UBACK999 IF NOT EQUAL
.
          MOVE      SIRACST,SIBACST
          PACK      SIBAREQ,SIRATYP,SIRAREQ
          MOVE      SIRBCAT,SIBACAT
          MOVE      SIRBWAR,SIBAWAR
          PACK      KEY25,SIBACST,SIBACAT,SIBAREQ,SIBAWAR
          IF        NEWBACK=0
            CALL      RDSIBA1
            IF        OVRCD=0
              CALL      DESIBA1
              MOVE      FOUR,AUDTTYPE          * Delete Audit
              CALL      WASIBA00
            ENDIF
            GOTO      UBACK999
          ENDIF
          CALL      RDSIBA1
          IF        OVRCD=0
            MOVE      TWO,AUDTTYPE
            CALL      WASIBA00                 * Before Audit Change
            MOVE      NEWBACK,SIBAQTY
            CALL      UPSIBA1
            MOVE      THREE,AUDTTYPE
            CALL      WASIBA00                 * After Audit Change
          ELSE
            MOVE      NEWBACK,SIBAQTY
            MOVE      SIRADAT,SIBADAT
            MOVE      SP70,SIBARESI
            CALL      WRSIBA1
            MOVE      ONE,AUDTTYPE
            CALL      WASIBA00                 * Audit Added
          ENDIF
UBACK999  RETURN
.-----------------------------------
. Update Item History
.-----------------------------------
UPITM000  MOVE      SIRADAT,SIPEDATE
          CALL      RSIPE000                       * Get Usage Period
          PACK      SIITPER,SIPEYEAR,SIPEPER
.
          PACK      KEY5,SIRACST
          CALL      RDSICA1   * Read Cost Centre
.
          MOVE      SIRBWAR,SIITWAR                * Warehouse
          MOVE      SIRBCAT,SIITCAT                * Catalog
          MOVE      DIFFEREN,SIITQTY               * Quantity
          ASSIGN    DIFFEREN*INITAVC,SIITAMT       * Cost
          MOVE      SIRACST,SIITCST                * Cost Centre
          PACK      SIITREQ,SIRATYP,SIRAREQ        * Requisition
          MOVE      "9",SIITTYP                    * Correction
          MOVE      SP70,SIITPUR                   * P/O Number NA
          MOVE      SIIESOH,SIITSOH                * Stock on Hand
          MOVE      "Picking Sheet Variance",SIITREF
          MOVE      SP70,SIITSPA                   * Spare
.
          MOVE      PRGID,SIITPRG                  * Program
          MOVE      PORT,SIITPOR                   * Port
          MOVE      PASSCODE,SIITOPR               * Operator
          PACK      SIITDAT,CCC,CYY,CMM,CDD        * Date
          REP       " 0",SIITDAT
          REPEAT
            CLOCK     TIME,SIITTIM
            PACK      KEY28,SIITWAR,SIITCAT,SIITDAT,SIITTIM,SP70
            CALL      RASIIT1
          UNTIL     OVRCD=1
          CALL      WRSIIT1
.
          ASSIGN    DIFFEREN*SEQ,SIUSQTY           * Quantity
          ASSIGN    SEQ*DIFFEREN*INITAVC,SIUSCST   * Cost
          CALL      SINUSAGE                       * Update Usage
.
          RETURN
.------------------------------------------------------------
. Update Item for Next Stocktake
.------------------------------------------------------------
USTOK000
          PACK      KEY12,SIIACAT,SIWAWAR,SP70
          MOVE      ONE,SIIESTI
          CALL      UPSIIE1
.
USTOK999  RETURN
.--------------------------------------------------
. Stock on Hand New Value
.--------------------------------------------------
SOHITM00  MOVE      SIRADAT,SIPEDATE
          CALL      RSIPE000                       * Get Usage Period
          PACK      SIITPER,SIPEYEAR,SIPEPER
          MOVE      SIRBWAR,SIITWAR                * Warehouse
          MOVE      SIRBCAT,SIITCAT                * Catalog
          MOVE      SIIESOH,SIITQTY                * Quantity
          MOVE      ZERO,SIITAMT                   * Cost
          MOVE      SP70,SIITCST                   * Cost Centre
          PACK      SIITREQ,SIRATYP,SIRAREQ        * Requisition
          MOVE      "1",SIITTYP                    * Stock Adjustment
          MOVE      SP70,SIITPUR                   * P/O Number NA
          MOVE      SIIESOH,SIITSOH                * Stock on Hand
          MOVE      "New Stock Balance Input",SIITREF
          MOVE      SP70,SIITSPA                   * Spare
.
          MOVE      PRGID,SIITPRG                  * Program
          MOVE      PORT,SIITPOR                   * Port
          MOVE      PASSCODE,SIITOPR               * Operator
          PACK      SIITDAT,CCC,CYY,CMM,CDD        * Date
          REP       " 0",SIITDAT
          REPEAT
            CLOCK     TIME,SIITTIM
            PACK      KEY28,SIITWAR,SIITCAT,SIITDAT,SIITTIM,SP70
            CALL      RASIIT1
          UNTIL     OVRCD=1
          CALL      WRSIIT1
          RETURN
.----------------------------------------------------------------------
. keyin amount
.----------------------------------------------------------------------
KNSOH000  ASSIGN    SIIESOH+DIFFEREN,NEWSOH
          IF        NEWSOH<0
            MOVE      ZERO,NEWSOH
          ENDIF
          KEYIN     *PCCOL:CVERT,*V2LON,*RV,NEWSOH
          IF        NEWSOH<0
            CLEAR     DISPMSG
            APPEND    "Must not be less than zero - ",DISPMSG
            CALL      MESSAGE1
            GOTO      KNSOH000
          ENDIF
.
KNSOH999  RETURN
.----------------------------------------------------------------------
. keyin amount
.----------------------------------------------------------------------
KBACK000  IF        HBACK<>1
            MOVE      ZERO,NEWBACK
            GOTO      KBACK999
          ENDIF
.
          ASSIGN    SIRBRQT-ISSQTY,NEWBACK
          IF        NEWBACK<0
            MOVE      ZERO,NEWBACK
          ENDIF
          KEYIN     *PCCOL:CVERT,*V2LON,*RV,NEWBACK
          IF        NEWBACK<0
            CLEAR     DISPMSG
            APPEND    "Must not be less than zero - ",DISPMSG
            CALL      MESSAGE1
            GOTO      KBACK000
          ENDIF
KBACK999  RETURN
.----------------------------------------------------------------------
. keyin amount
.----------------------------------------------------------------------
KNUMI000  MOVE      SIRBIQT,ISSQTY
          KEYIN     *PCCOL:CVERT,*V2LON,*RV,ISSQTY
          IF        ISSQTY<0
            BEEP
            MOVE      "Must be greater than zero - ",DISPMSG
            CALL      MESSAGE1
            GOTO      KNUMI000
          ENDIF
.
          ASSIGN    SIRBIQT-ISSQTY,DIFFEREN
          COMPARE   ZERO,DIFFEREN
          GOTO      KNUMI999 IF NOT EQUAL
.
          MOVE      SP70,DISPMSG
          CALL      MESSAGE2
          BEEP
.
KNUMI100  MOVE      "N",ANS
          KEYIN     *P1:24,*EL,"Difference = 0. Do You Want to Continue (":
                    *V2LON,"Y",*HOFF,"/",*V2LON,"N",*HOFF,") ? ",*V2LON,*RV,ANS
          REP       UPPLOW,ANS
          MATCH     "Y",ANS
          GOTO      KNUMI800 IF EQUAL
          MATCH     "N",ANS
          GOTO      KNUMI100 IF NOT EQUAL
          MOVE      TWO,EXIT
.
KNUMI800  CALL      MESSAGE3
.
KNUMI999  RETURN
.----------------------------------------------------------------------
. Import Picking Sheet Variances
.----------------------------------------------------------------------
IMPT0000  CALL      COPY0000          * Get File
          BRANCH    EXIT,IMPT9999
          CALL      VERI0000          * Verify Contents
          BRANCH    EXIT,IMPT9999
          IF        RECCOUNT=0
            BEEP
            MOVE      "No Variances to Process - ",DISPMSG
            CALL      MESSAGE1
          ENDIF
.
          OPEN      IMPORTFL,IMPORTFN
          MOVE      "90",CLNO
          MOVE      ZERO,CPAGENO
          CLOCK     TIME,CTIMEIS
          MOVE      SP70,LASTCST
          MOVE      SP70,LASTDEL
          MOVE      ZERO,TOTALPAG
.
IMPT1000  READ      IMPORTFL,SEQ;REQTYPE,REQNUMB,REQCST,REQCATA,REQWARH:
                                 REQIREQ,REQIQTY
          GOTO      IMPT9000 IF OVER
.
          MOVE      REQIQTY,ISSQTY
.
          MOVE      "RT ",SICDCATA
          PACK      KEY6,SICDCATA,SICDCODE
          CALL      RDSICD1
          BRANCH    OVRCD,REQTYP80
.
          CALL      LOCREQ00
          BRANCH    EXIT,IMPT1000
.
          CALL      GETCAT00
          BRANCH    EXIT,IMPT1000
.
          ASSIGN    SIRBIQT-ISSQTY,DIFFEREN
          ASSIGN    SIIESOH+DIFFEREN,NEWSOH
          IF        HBACK<>1
            MOVE      ZERO,NEWBACK
            MOVE      ZERO,BACKORD
          ELSE
            ASSIGN    SIRBRQT-SIRBIQT,BACKORD
            ASSIGN    SIRBRQT-ISSQTY,NEWBACK
          ENDIF
          MOVE      ONE,STOKTAKE
.
          COMPARE   SIRBIQT,ISSQTY
          GOTO      IMPT2000 IF EQUAL
          COMPARE   REQIREQ,REQIQTY
          GOTO      IMPT2000 IF EQUAL
.
          CALL      SC02L000
.
IMPT2000  CALL      PRNT0000
.
          GOTO      IMPT1000
.
IMPT9000  CLOSE     IMPORTFL,DELETE
          CALL      UUSIRA1
          CALL      UUSIIE1
          CALL      TAIL0000
          PRINT     *N,*N,*45,"***  End of Report  ***"
IMPT9999  RETURN
.------------------------------------------------------------
. Read & Lock Requisition
.------------------------------------------------------------
LOCREQ00  PACK      KEY8,REQTYPE,REQNUMB,SP70
          UNPACK    KEY8,SIRBTYP,SIRBREQ
          IF        REQIREQ=REQIQTY
            CALL      RDSIRA1
          ELSE
            CALL      RLSIRA1
          ENDIF
          BRANCH    OVRCD,LOCREQ90,LOCREQ10
          MOVE      SIRACST,KEY5
          CALL      RDSICA1
          MOVE      ZERO,EXIT
          GOTO      LOCREQ99
.
LOCREQ10  PACK      DISPMSG,SP70,SP70
          CALL      MESSAGE2
          KEYIN     *P1:24,*EL,"Requisition Locked - (":
                    *V2LON,"R",*HOFF,")etry or e(":
                    *V2LON,"X",*HOFF,")it ? ",ANS
          CALL      MESSAGE3
          PACK      ANS,ANS,SP70
          REP       UPPLOW,ANS
          MATCH     "R",ANS
          GOTO      LOCREQ00 IF EQUAL
          MATCH     "X",ANS
          GOTO      LOCREQ90 IF EQUAL
          MATCH     "E",ANS
          GOTO      LOCREQ10 IF NOT EQUAL
.
LOCREQ90  MOVE      ONE,EXIT
.
LOCREQ99  RETURN
.------------------------------------------------------------
. Get Catalog Details
.------------------------------------------------------------
GETCAT00  MOVE      REQCATA,KEY7
          CALL      RDSIIA1
          BRANCH    OVRCD,GETCAT95    * Invalid Catalog
.
          PACK      KEY20,REQCATA,REQTYPE,REQNUMB,REQWARH,SP70
          CALL      RDSIRB2
          BRANCH    OVRCD,GETCAT90    * Not on Requisition
.
          PACK      KEY12,SIRBCAT,SIRBWAR
          CALL      SISIWK1
          COMPARE   ZERO,OVRCD
          GOTO      GETCAT85 IF EQUAL * On Stocktake
.
          MOVE      SIRBRQT,SSIRBRQT  * save old values
          MOVE      SIRBIQT,SSIRBIQT
          MOVE      SIRBAMT,SSIRBAMT
          IF        HBACK<>1
            MOVE      ZERO,BACKORD
          ELSE
            ASSIGN    SIRBRQT-SIRBIQT,BACKORD
          ENDIF
.
          PACK      KEY20,SIRBTYP,SIRBREQ,SIRBWAR,SIRBCAT,SP70
          CALL      RDSIRB1
          BRANCH    OVRCD,GETCAT80
.
          COMPARE   REQIREQ,REQIQTY
          GOTO      GETCAT10 IF EQUAL
.
          PACK      KEY17,SIRBBCH,SIRBLED,SIRBACC,SP70
          MATCH     SP70,KEY17
          GOTO      GETCAT75 IF NOT EQUAL
.
GETCAT10  PACK      KEY12,SIRBCAT,SIRBWAR
          IF        REQIREQ=REQIQTY
            CALL      RDSIIE1
          ELSE
            CALL      RLSIIE1
          ENDIF
          BRANCH    OVRCD,GETCAT70,GETCAT20
          MOVE      ZERO,EXIT
          GOTO      GETCAT99
.
GETCAT20  PACK      DISPMSG,SP70,SP70
          CALL      MESSAGE2
          KEYIN     *P1:24,*EL,"Catalog/Warehouse Locked - (":
                    *V2LON,"R",*HOFF,")etry or e(":
                    *V2LON,"X",*HOFF,")it ? ",*V2LON,ANS
          CALL      MESSAGE3
          PACK      ANS,ANS,SP70
          REP       UPPLOW,ANS
          MATCH     "R",ANS
          GOTO      GETCAT10 IF EQUAL
          MATCH     "X",ANS
          GOTO      GETCAT98 IF EQUAL
          MATCH     "E",ANS
          GOTO      GETCAT20 IF NOT EQUAL
          GOTO      GETCAT98
.
GETCAT70  MOVE      "Catalog Not Located At This Warehouse - ",DISPMSG
          BEEP
          CALL      MESSAGE1
          GOTO      GETCAT98
.
GETCAT75  CLEAR     DISPMSG
          APPEND    "Requisition ",DISPMSG
          APPEND    SIRBTYP,DISPMSG
          APPEND    SIRBREQ,DISPMSG
          APPEND    " Has Been Transfer to GL - ",DISPMSG
          RESET     DISPMSG
          BEEP
          CALL      MESSAGE1
          GOTO      GETCAT98
.
GETCAT80  MOVE      "Index Corrupt on SINREB. Fatal Error - ",DISPMSG
          BEEP
          CALL      MESSAGE1
          GOTO      FATALERR
.
GETCAT85  BEEP
          MOVE      "Catalog in Stocktake for Warehouse - ",DISPMSG
          CALL      MESSAGE1
          GOTO      GETCAT98
.
GETCAT90  MOVE      "Catalog not on this Requisition - ",DISPMSG
          BEEP
          CALL      MESSAGE1
          GOTO      GETCAT98
.
GETCAT95  MOVE      "Invalid Catalog Code - ",DISPMSG
          BEEP
          CALL      MESSAGE1
          GOTO      GETCAT98
.
GETCAT98  MOVE      ONE,EXIT
.
GETCAT99  RETURN
.------------------------------------------------------------
. Copy File from DOS to UNIX using script ibasin32.us1
.------------------------------------------------------------
COPY0000  DISPLAY   *P20:15,*EL,"Copying download file from PC ";
          CLEAR     IMPORTFN
          APPEND    "downld",IMPORTFN
          APPEND    PORT,IMPORTFN
          RESET     IMPORTFN
          REP       " 0",IMPORTFN
          REP       LOWUP,IMPORTFN
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      IMPORTFL,IMPORTFN
          TRAPCLR   IO
          IF        OVRCD=0
            CLEAR     DISPMSG
            APPEND    "ERROR - ",DISPMSG
            APPEND    IMPORTFN,DISPMSG
            APPEND    " File Exists - ",DISPMSG
            RESET     DISPMSG
            BEEP
            MOVE      NO,DEFYESNO
            CALL      MESSAGE4
            IF        EXIT=1
              CHAIN     PGM
            ENDIF
            CLOSE     IMPORTFL,DELETE
          ENDIF
.
          MOVE      "0",HLEF
          CALL      GETSCR00
          DISPLAY   *P1:24,*EL
          CLEAR     KEY80
          APPEND    "ibasin32.us1 ",KEY80
          APPEND    IMPORTFN,KEY80
          APPEND    ".txt",KEY80
          RESET     KEY80
          EXECUTE   KEY80,TASKID
          CALL      PUTSCR00
.
          MOVE      ZERO,EXIT
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      IMPORTFL,IMPORTFN
          TRAPCLR   IO
          IF        OVRCD=1
            CLEAR     DISPMSG
            APPEND    "ERROR - ",DISPMSG
            APPEND    IMPORTFN,DISPMSG
            APPEND    " File Does Not Exist - ",DISPMSG
            RESET     DISPMSG
            BEEP
            MOVE      NO,DEFYESNO
            CALL      MESSAGE1
            MOVE      ONE,EXIT
          ENDIF
          RETURN
.------------------------------------------------------------
. Verify File Contents
.------------------------------------------------------------
VERI0000  MOVE      ZERO,SECTOR
          MOVE      ZERO,RECCOUNT
.
VERI1000  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF FORMAT
          ADD       ONE,SECTOR
          READ      IMPORTFL,SEQ;REQTYPE,REQNUMB,REQCST,REQCATA,REQWARH:
                                 REQIREQ,REQIQTY
          GOTO      VERI9900 IF OVER
          TRAPCLR   FORMAT
          BRANCH    OVRCD,VERI9000
          COMPARE   REQIREQ,REQIQTY
          GOTO      VERI1000 IF EQUAL
.
          MOVE      "RT ",SICDCATA
          PACK      KEY6,SICDCATA,SICDCODE
          CALL      RDSICD1
          BRANCH    OVRCD,VERI9100
.
          CALL      LOCREQ00
          BRANCH    EXIT,VERI9800
.
          CALL      GETCAT00
          BRANCH    EXIT,VERI9800
          COMPARE   SIRBIQT,ISSQTY
          GOTO      VERI1000 IF EQUAL
.
          ADD       ONE,RECCOUNT
.
          GOTO      VERI1000
.
VERI9000  BEEP
          MOVE      "ERROR : RECORD FORMAT ERROR - ",DISPMSG
          CALL      MESSAGE1
          GOTO      VERI9800
.
VERI9100  BEEP
          MOVE      "ERROR : INVALID REQ. TYPE - ",DISPMSG
          CALL      MESSAGE1
          GOTO      VERI9800
.
VERI9800  BEEP
          CLEAR     DISPMSG
          APPEND    "ERROR IN RECORD - ",DISPMSG
          APPEND    SECTOR,DISPMSG
          RESET     DISPMSG
          CALL      MESSAGE1
          MOVE      ONE,EXIT
          GOTO      VERI9999
.
VERI9900  MOVE      ZERO,EXIT
.
VERI9999  RETURN
.------------------------------------------------------------
. Print Picking List
.------------------------------------------------------------
PRNT0000  MATCH     REQCST,LASTCST
          IF        !@EQUAL
            CALL      HEAD0000
            MOVE      ZERO,TOTALCST
            MOVE      REQCST,LASTCST
          ELSE
            MATCH     SIRADEL,LASTDEL
            IF        !@EQUAL
              CALL      HEAD0000
              MOVE      SIRADEL,LASTDEL
            ENDIF
          ENDIF
.
          COMPARE   "50",CLNO
          CALL      HEAD0000 IF NOT LESS
.
          MOVE      "99,999,999.99",KEY13
          FEDIT     SIRBRQT,KEY13
          MATCH     "*",KEY13
          IF        @EQUAL
            MOVE      "9999999999.99",KEY13
            FEDIT     SIRBRQT,KEY13
          ENDIF
.
          MOVE      "9,999,999.99",KEY12
          FEDIT     SIRBIQT,KEY12
          MATCH     "*",KEY12
          IF        @EQUAL
            MOVE      "999999999.99",KEY12
            FEDIT     SIRBIQT,KEY12
          ENDIF
.
          MOVE      "999,999,999.99",KEY14
          FEDIT     SIRBAMT,KEY14
          MATCH     "*",KEY14
          IF        @EQUAL
            MOVE      "99999999999.99",KEY14
            FEDIT     SIRBAMT,KEY14
          ENDIF
.
          UNPACK    SIRADAT,CCENT,CYEAR,CMON,CDAY
          UNPACK    SIRADAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     "|",SIIERAS,"| ",SIIACAT,SP1,SIIADES,"|",*95,"|":
                    *108,"| ",CPCDATE,*132,"|"
          PRINT     "|",*10,"|",*64,SIIAISS," | ",KEY13,"|":
                    KEY12,"| ",SIRATYP,SIRAREQ,KEY14,"|"
          ADD       SIRBAMT,TOTALPAG
          ADD       SIRBAMT,TOTALCST
.
          ADD       "2",CLNO
.
PRNT9999  RETURN
.------------------------------------------------------------
. HEAD - Print page header
.------------------------------------------------------------
HEAD0000  COMPARE   ZERO,CPAGENO
          CALL      TAIL0000 IF NOT EQUAL
          MOVE      SP70,SIWADES
          PACK      KEY5,SIRBWAR,SP70
          CALL      RDSIWA1
.
          MOVE      SP70,SICADESC
          PACK      KEY5,REQCST,SP70
          CALL      RDSICA1
.
...          MOVE      "- Requisitions      ",CPHDROPT
.
          CALL      HEAD132
          ADD       "6",CLNO
          PRINT     *1,"Cost Centre       : ",REQCST,SP2,SICADESC:
                    *N,"Warehouse         : ",SIRBWAR,SP2,SIWADES:
                    *N,"Delivery Address  : ",SICADAD1
.
          MATCH     SP70,SICADAD2
          IF        !@EQUAL
            PRINT     "                  : ",SICADAD2
            ADD       "1",CLNO
          ENDIF
.
          MATCH     SP70,SICADAD3
          IF        !@EQUAL
            PRINT     "                  : ",SICADAD3
            ADD       "1",CLNO
          ENDIF
.
          PRINT     "Delivery Details  : ",SIRADEL
          CALL      UND132
          PRINT     "|Rack &  | Catalog Description                      ":
                    "                           |    Req'd Qty | Issue Qt":
                    "y  | Req'n Date            |"
          PRINT     "|Shelf   |                                          ":
                    "           Issue Unit      |              |         ":
                    "   | Req'n No.   Total Cost|"
          CALL      UND132
.
HEAD9999  RETURN
.------------------------------------------------------------
. TAIL - Print page footer
.------------------------------------------------------------
TAIL0000  MOVE      "999,999,999.99",KEY14
          FEDIT     TOTALPAG,KEY14
          MATCH     "*",KEY14
            IF        @EQUAL
              MOVE      "99999999999.99",KEY14
              FEDIT     TOTALPAG,KEY14
          ENDIF
          MOVE      ZERO,TOTALPAG
.
          CALL      UND132
          PRINT     *92,"| Page Total : ",*118,KEY14,"|"
.
          MOVE      "999,999,999.99",KEY14
          FEDIT     TOTALCST,KEY14
          MATCH     "*",KEY14
            IF        @EQUAL
              MOVE      "99999999999.99",KEY14
              FEDIT     TOTALCST,KEY14
          ENDIF
.
          PRINT     *92,"| C/C  Total : ",*118,KEY14,"|":
                    *N,*92,"*---------------------------------------*"
          MOVE      ZERO,EXIT
          PRINT     *N,*N:
                    *21,"------------------",*51,"--------------------":
                    *N,*21,"P I C K E D    B Y",*51,"R E C E I V E D   BY"
TAIL9999  RETURN
.
.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       SINBACIO/INC
          INC       SINCCAIO/INC
          INC       SINCCBIO/INC
          INC       SINCCEIO/INC
          INC       SINCCFIO/INC
          INC       SINCCHIO/INC
          INC       SINCGBIO/INC
          INC       SINCIAIO/INC
          INC       SINCIAKY    
          INC       SINCIEIO/INC
          INC       SINCIFIO/INC
          INC       SINCIHIO/INC
          INC       SINCIIIO/INC
          INC       SINCODIO/INC
          INC       SINCODKY    
          INC       SINITMIO/INC
          INC       SINNATIO/INC
          INC       SINPERCD    
          INC       SINPERIO/INC
          INC       SINPRQIO/INC
          INC       SINREAIO/INC
          INC       SINREBIO/INC
          INC       SINSUAIO/INC
          INC       SINSUBIO/INC
          INC       SINUSAGE    
          INC       SINWARIO/INC
          INC       SINWRKCD    
          INC       SINWRKIO/INC
          INC       SINWSEIO/INC
          INC       SINWSEKY    
.
          INC       STDGENCD
.

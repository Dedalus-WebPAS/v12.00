.----------------------------------------------------------------------
. Program       : FHRWEB01
.
. Function      : FHIR Patient Resource Inbound Server
.
. Modifications :
.
.----------------------------------------------------------------------
. V12.00.01 30/05/2025  Jacob Jackson    TSK 0955096
.           Alphanumeric changes
. V11.04.01 27/11/2023  Peter Vela       TSK 0935874
.           Removed includes for DXPATMAS, PRINTEMR, WEBLBEMR
.           to prevent compile errors
. V11.03.01 17/10/2023  Peter Vela       TSK 0935874
.           Added parameter check for pmsihiaf
. V11.02.01 03/09/2022  Peter Vela      0923308
.           Created FHIR Patient Resource Inbound Server
.----------------------------------------------------------------------
          INC       IBAWEBDF    
          INC       PATCOMM/INC
          INC       CHKDIGVR/INC
          INC       EMRICDFD/INC
          INC       EMRHISFD/INC 
          INC       APSMASFD/INC
          INC       AAEDE1FD/INC
          INC       EMRLPCFD/INC
          INC       EMRCONFD/INC                                       *I-50421
          INC       EMRLOCFD/INC
          INC       EMRSITFD/INC
          INC       PATCALAG/INC
          INC       PATDHEAD/INC
          INC       ELTRONVR/INC
          INC       EOCLNKFD/INC
          INC       EOCREFFD/INC
          INC       EMRVISFD/INC
          INC       EMRCLIFD/INC
          INC       EMRGRCFD/INC
          INC       EMRPROFD/INC                                       *I-50421
          INC       EMRUNKFD/INC
.
          INC       HL7FP1FD/INC
          INC       HL7P1AFD/INC
          INC       HL7P1BFD/INC
          INC       HL7P1CFD/INC
          INC       HL7FP2FD/INC
          INC       HL7FP3FD/INC
          INC       HL7P3AFD/INC
          INC       HL7FP4FD/INC
          INC       HL7P4AFD/INC
          INC       HL7FP5FD/INC
          INC       HL7FP6FD/INC
          INC       HL7P6AFD/INC
          INC       HL7P6BFD/INC
          INC       HL7FP7FD/INC
          INC       HL7FP8FD/INC
          INC       HL7FP9FD/INC
          INC       HL7P1DFD/INC
        
.
          INC       DEATHATD/INC
          INC       PATAK1FD/INC
          INC       PATAM1FD/INC
          INC       PATCCHFD/INC
          INC       PMSCURFD/INC
          INC       PMSDAUFD/INC
          INC       PATINVFD/INC
          INC       PATLOCFD/INC
          INC       PATGSRFD/INC
          INC       PATURAFD/INC
          INC       PATPA1FD/INC
          INC       PATPR1FD/INC
          INC       BOKRC1FD/INC
          INC       IBADLABS/INC
          INC       IBATMDFD/INC
          INC       MEHDLSFD/INC
          INC       NHIETHFD/INC
          INC       NHIMASFD/INC
          INC       OUTBB1FD/INC
          INC       OUTBOAFD/INC
          INC       OPRNURFD/INC
          INC       OPRCONFD/INC
          INC       PATCONFD/INC
          INC       AAECONFD/INC   *****
          INC       PATALRFD/INC   *****
          INC       PMSALNFD/INC
          INC       PATDO1FD/INC
          INC       PATFN1FD/INC
          INC       PATGO1FD/INC
          INC       PATHSPFD/INC
          INC       PMSCCDFD/INC
          INC       PMSCEXFD/INC
          INC       PMSCEXTD/INC
          INC       PMSHCPFD/INC
          INC       PMSHCGFD/INC
          INC       PMSHCPTD/INC
          INC       PMSHCGTD/INC
          INC       PMSIHIFD/INC
          INC       PMSMDTFD/INC
          INC       PMSMTXFD/INC
          INC       PMSUPDFD/INC
          INC       PATIN1FD/INC
          INC       PRIITMFD/INC
          INC       PRIHREFD/INC
          INC       PATITMFD/INC                                       *I-50421
          INC       PATICDFD/INC                                       *I-50421
          INC       PATICOFD/INC                                       *I-50421
          INC       PATMA1FD/INC
          INC       PATMI1FD/INC
          INC       PMSPX2FD/INC
          INC       PMSRELFD/INC              
          INC       PMSTLEFD/INC   
          INC       PATNIDFD/INC
          INC       PATRE1FD/INC
          INC       PATVADFD/INC
          INC       PATVISFD/INC
          INC       PMSVX1FD/INC                                       *I-55214
          INC       PATWC1FD/INC 
          INC       PMSWX1FD/INC
          INC       PATWMAFD/INC
          INC       PATWR1FD/INC
          INC       PATWVEFD/INC
          INC       PRIDTRFD/INC
.
          INC       PATATRFD/INC
          INC       PATATRTD/INC
.
          INC       SCRPSTFD/INC
          INC       SCRSBGFD/INC
          INC       SCRSLTFD/INC
          INC       SCRMASFD/INC
          INC       PATHGPFD/INC
.
          INC       EMRDCMFD/INC       
          INC       OBSDETFD/INC                                       *I-54627
          INC       OBSMTXFD/INC
          INC       OBSMDTFD/INC
          INC       EMRISMFD/INC 
          INC       EMRINCFD/INC 
          INC       EMRWFMFD/INC
          INC       EMRVCDFD/INC
          INC       EMRMTXFD/INC
          INC       EMRVPRFD/INC
          INC       VISCMTFD/INC
          INC       VISCODFD/INC
          INC       VISMDTFD/INC
          INC       VISXDCFD/INC
          INC       EMRMANFD/INC 
          INC       VISMTXFD/INC
          INC       TFILEVAR/INC
          INC       WEBDINVS/INC
.
ANSLI     INIT      "i"
ANSLW     INIT      "w"
ANSLC     INIT      "c"
ANSLT     INIT      "t"
ALIASSTS  DIM       1
ADD       DIM       2
AMM       DIM       2
AYY       DIM       2
ACC       DIM       2
ACTION    DIM       1
AUDTATRB  FORM      1
CBOOK     FORM      1
DAYDESC   DIM       9
DEEXDATE  DIM       8
DIM16     DIM       16
DIM30     DIM       30
DIM50     DIM       50
DIM80     DIM       80
DIM100    DIM       100
DFNAME    DIM       60
DSMOKE    DIM       3
F3A       FORM      3
ERRORIND  DIM       1
ERRORDSC  DIM       500
GATTIMER  FORM      3
GETTOKF4  FORM      4
GPFRMTNM  DIM       40
HWDSOUR   DIM       3
HBWAIT    FORM      1
LINEA17   DIM       17
LINEB17   DIM       17
LINEC17   DIM       17
LINED17   DIM       17
LINEE17   DIM       17
LINEF17   DIM       17
LINEG17   DIM       17
LINEH17   DIM       17
LINEI17   DIM       17
LINEA37   DIM       37
LINEB37   DIM       37
LINEC37   DIM       37
LINED37   DIM       37
LINEE37   DIM       37
LINEF37   DIM       37
LINEG37   DIM       37
LINEH37   DIM       37
LINEI37   DIM       37
TYPE4     INIT      "004"
TYPE5     INIT      "005"
.
SAVKEY5   DIM       5
SAVKEY19  DIM       19
SAVEPRAC  DIM       10        
.SAVEPCTR  DIM       2
SAVEALIA  FORM      1
SAVENCOM  FORM      1
SAVEDCOM  FORM      1
SAVEPHCP  DIM       10
SAVDOC    DIM       10
SAVEUSR1  DIM       3
SAVEPRVI  DIM       3
SAVEFLDR  DIM       3
SAVESN16  DIM       1
SAVEKEY9  DIM       9
SAVELINE  FORM      3
SAVELINK  DIM       3
SAVEMDOB  DIM       8
SAVEPCTR  DIM       2
.SAVEPHCP  DIM       1
.SAVEPRAC  DIM       1
SAVEPROV  DIM       1
SAVEPRTY  DIM       3
SAVEREFN  DIM       8
SAVESNAM  DIM       4
SAVEXFNM  DIM       4
SAVEXSNM  DIM       4
SAVETITL  DIM       4
SAVEPSEX  DIM       1
SAVEPDOB  DIM       8
SAVEPFGN  DIM       2
SAVEPMST  DIM       3
SAVEPREG  DIM       3
SAVEPCNT  DIM       3
SAVEPTYP  DIM       3
SAVEABRG  DIM       3
SAVEUSR7  DIM       3
SAVEMEDI  DIM       1
SAVEMCCD  DIM       2
SAVEMEDC  DIM       8
SAVECONP  DIM       1
SAVEUPRF  DIM       3
SAVEINTR  DIM       1
SAVELNG1  DIM       3
.SAVEPRVI  DIM       3
.
SPPXUCC4  DIM       3
SPPXUCC5  DIM       3
SPPXATF1  DIM       80
SPPXATF2  DIM       80
SKEY8     DIM       8
DOCTIME   DIM       8
HOUR      DIM       2
MEDINUMB  DIM       13
MIN       DIM       2
MONTHDES  DIM       9
NUM3      FORM      3
PTFRMTNM  DIM       40
SEC       DIM       2
MEDNOTES  DIM       70
TEMPDATE  DIM       12
.
NEWCOUNT  FORM      10
.
WTCNUSBC  FORM      1
.
ADLABEL   FORM      2
ATT       DIM       80         * attribute string
AFTDECP   FORM      2          * After Decimal Place
AFTDECPF  FORM      2          * After Decimal Place Format String
.
BEFDECP   FORM      2          * Before Decimal Place
BEFDECPF  FORM      2          * Before Decimal Place Format String
BIRTHDAT  DIM       10            * formatted DOB variable
.
CALDAYS    FORM      3
CDEFPRT2  DIM       6
CHG       FORM      1
CHKMNCNT  FORM      1          * check mandatory fields cycle counter
CLAIMCOD  DIM       3
CLMDET1   DIM       50
CLMDET2   DIM       50
CMDLINE   DIM       200
CONTTYPE  DIM       1
CONTTYP2  FORM      1
COUNTER   FORM      1
CPPAPER2  FORM      2
CODEDESC  DIM       100                                                *I-50421
.
DCASE     DIM       3
DECIMALP  INIT      "."  
DIM2L     DIM       2
DIM3      DIM       3
DIM4      DIM       4
DIM9      DIM       9
DIM10A    DIM       10
DIM10B    DIM       10
DIM11     DIM       11
DIM11G    DIM       11            * given name variable for small labels
DIM11S    DIM       11            * surname variable for small labels
DIM14     DIM       14
DIM17     DIM       17
DIM18     DIM       18            * given name variable for large labels
DIM31     DIM       31            * formatted address
DIM60     DIM       60
DETNTREC  FORM      2
DOCTCODE  DIM       6
BURNO     DIM       9
BADMNO    DIM       9
PTURNO    DIM       8             * U/R variable (spaces removed)
PTADMNO   DIM       8             * Admission No variable (spaces removed)
EDOCNAME  DIM       23
PSURNAME  DIM       23
PGIVNAME  DIM       23
PCLMTYPD  DIM       20
PADDRSS1  DIM       23 
PADDRSS2  DIM       23
PAGEYRS   DIM       4
PGPNAME   DIM       30
PRTLABL1  DIM       17
PRTLABL2  DIM       20
PRTLABL3  DIM       16
PRTLABL4  DIM       15
PRTLABL5  DIM       17
PRTLABL6  DIM       24
.
SPKMOBL   DIM       20
.
EMRFLAG   FORM      1 
EMRPREV   DIM       20 
EMRSEEN   DIM       8
EMRDOCT   DIM       13
EMRINSUR  DIM       5
EMRDESC   DIM       20
EMRURNO   DIM       8
ENDFLG    FORM      1
.
FIRSTCH   FORM      1                                                  *I-60700
FIELDNO   FORM      5
FORM1A    FORM      1                                                  *I-54627
FORM1B    FORM      1                                                  *I-54627
FORM3A    FORM      3                                                  *I-50421
FORM5     FORM      5
FORM21    FORM      21
FORMAT21  FORM      21
FRMPRINT  DIM       6
.                                                                     *I-196463
DIM3A     DIM       3
DIM3B     DIM       3
DIM15A    DIM       15
DIM50A    DIM       50
DIM80A    DIM       80
.
LINSREQD  FORM      5
.
MBIRURNO  DIM       8
MBIRTYOR  DIM       24
.
PAGENUMB  FORM      3
PAGETOTL  FORM      3
PAGEMAXL  FORM      3                       * Maximum lines per page
PASSNO    FORM      1
PGLINES   DIM       6
PRINTEND  FORM      1
.
SAVKEY79  DIM       79
.
WFLINE3A  DIM       20
WFLINE2A  DIM       20
WFLINE8A  DIM       20
WFLINE6A  DIM       20
WFLINE4A  DIM       20
WFLINE7A  DIM       20
WFLINE5A  DIM       20
WFLINE1A  DIM       20
.
HIGH14    DIM       4
HIGH24    DIM       4
HIGH34    DIM       4
.HELPAGE   FORM      1
.HELPRNT   FORM      3
.HELSIZE   FORM      1
.HEMR5COD  DIM       6            * Code for user defined stationary
HEPMR5B   FORM      "1"          * Patient MR5 form sheet 1=Yes, 0=No
.HEMR5L    FORM      "1"          * Layout for MR5.
.                                  0 = Modbury
.                                  1 = User Defined
.
IHINUMBR  DIM       20
JYEAR     FORM      2
.
LASTROW   FORM      3
LABSIZE   FORM      1
LARGELAB  DIM       16
SMALLLAB  DIM       21
LBLPRINT  DIM       6
LABELATT  DIM       80[24]
LABELDAT  DIM       80[24]
LABELTYP  DIM       10
LLCNT     FORM      5
LEFTBRAK  INIT      "(" 
LINE60    DIM       60                                                 *I-60700
.
MANDINUR  FORM      1
MADESC    DIM       3
MODE4     DIM       4
.
NEGOFSET  DIM       8             * U/R variable (spaces removed)
NMPNUMB   DIM       20
NOLABEL   FORM      3
NOTEFILT  DIM       3
.
OPFLG     FORM      1
OPERCODE  DIM       4
OLDCCDDT  DIM       8
OLDCOLOR  DIM       3
.
PRDGFLAG  FORM      1
PRINTVAR  DIM       80
PRIDSYET  FORM      1
.
QADD1     DIM       25
QADD2     DIM       25
QADD4     DIM       15
QGNAME    DIM       14
QLOCDOC   DIM       30
QMEDI     DIM       10
QOCCUP    DIM       14
QPOST     DIM       4
QSAGE     FORM      3
QSEX      DIM       1
QSNAME    DIM       15
QSUBRB    DIM       15
QTELEP    DIM       12
QTITL     DIM       4
.
RESPONSD  DIM       3             * Cat EZ code for doctor responsible
RESPONSN  DIM       3             * Cat EZ code for nurse responsible
RESPONSC  DIM       3             * Cat EZ code for psc responsible
REFDEVF6  FORM      6
.
RTAOVRCD  FORM      1
.
SAVTYP    DIM       3
SAVKEY35  DIM       27
SCRID     DIM       2
SHRTBDAT  DIM       8
SHRTMDAT  DIM       7
SHRTVDAT  DIM       8
SVSTNCOD  DIM       6
STATNCOD  DIM       6
SIT4      DIM       4
SRC4      DIM       4
SURSYST   FORM      1
.
TEMPTRID  DIM       24
TEMPMSID  DIM       36
TRIDFILE  DIM       8
.
USERNAME  DIM       10
UPDTTYPE  DIM       1
.
MSIDFILE  DIM       8
.
UNIQF5    FORM      5
VADESC    DIM       3
VISITDAT  DIM       10            * formatted emergency visit date variable
VISITNUM  DIM       8             * emergency visit number variable
VISNOTES  DIM       100
.
WAITTIME  FORM      4
WCDESC    DIM       3
WCNAME    DIM       20
WDATE1    DIM       8
WDATE2    DIM       8
XPRIDIAG  DIM       6      * Primary Diagnosis
XADDIAG1  DIM       6      * Additional Diagnosis 1
.
VISXDCIN  FORM      1
.
ANSHP     INIT      "HP"
ANSPP     INIT      "PP"
CODEA     INIT      "A "
CODEA1    INIT      "A1"
CODEA2    INIT      "A2"
CODEA3    INIT      "A3"
CODEA4    INIT      "A4"
CODEA5    INIT      "A5"
CODEA6    INIT      "A6"
CODEA7    INIT      "A7"
CODEA8    INIT      "A8"
CODEAA    INIT      "AA"
CODEAE    INIT      "AE"
CODEAI    INIT      "AI"
CODEAP    INIT      "AP"
CODEAR    INIT      "AR"
CODECL    INIT      "CL"
CODEC     INIT      "C "
CODECC    INIT      "CC"
CODECT    INIT      "ct"
CODEEA    INIT      "EA"
CODEES    INIT      "ES"
CODEEP    INIT      "EP"
CODEED    INIT      "ED"
CODEEW    INIT      "EW"
CODEEZ    INIT      "EZ"
CODEH1    INIT      "H1"
CODEH2    INIT      "H2"
CODEH3    INIT      "H3"
CODEM     INIT      "M "
CODEP     INIT      "P "
CODEP1    INIT      "P1"
CODEP2    INIT      "P2"
CODEP3    INIT      "P3"
CODEP4    INIT      "P4"
CODEP5    INIT      "P5"
CODEP6    INIT      "P6"
CODER     INIT      "R "
CODERA    INIT      "RA"
CODET     INIT      "T "
CODEV6    INIT      "V6"
CODEV7    INIT      "V7"
CODEV8    INIT      "V8"
CODES     INIT      "S "
CATcw     INIT      "cw"
CATst     INIT      "st"
CATEA     INIT      "ea"
CATEB     INIT      "eb"
CATEC     INIT      "ec"
CATED     INIT      "ed"
CATEE     INIT      "ee"
CATEF     INIT      "ef"
CATEG     INIT      "eg"
CATEH     INIT      "eh"
CATEI     INIT      "ei"
CATEJ     INIT      "ej"
CATEK     INIT      "ek"
CATEL     INIT      "el"
CATEM     INIT      "em"
CATEN     INIT      "en"
CATEO     INIT      "eo"
CATEP     INIT      "ep"
CATEQ     INIT      "eq"
CATER     INIT      "er"
CATES     INIT      "es"
CATET     INIT      "et"
CATEU     INIT      "eu"
CATEV     INIT      "ev"
CATEW     INIT      "ew"
CATEY     INIT      "ey"
CATHP     INIT      "HP"
CATLS     INIT      "LS"
CATTC     INIT      "tc"
CATWS     INIT      "ws"                                               *I-59548
CATWT     INIT      "wt"
CATWU     INIT      "wu"
CATWQ     INIT      "wq"                                               *I-59548
CATWR     INIT      "wr"                                               *I-59548
CATW0     INIT      "w0"
DASH      INIT      "-"
OTHER     INIT      "Other"
SP12      INIT      "            "
SP127     INIT      "                                          ":
                    "                                          ":
                    "                                           "
SP40      INIT      "                                       "
X27       INIT      "XXXXXXXXXXXXXXXXXXXXXXXXXXX"
X100      INIT      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
ZERO4     INIT      "0000"
.
CARET     INIT      "^"
MJAN      INIT      "January"
MFEB      INIT      "February"
MMAR      INIT      "March"
MAPR      INIT      "April"
MMAY      INIT      "May"
MJUN      INIT      "June"
MJUL      INIT      "July"
MAUG      INIT      "August"
MSEP      INIT      "September"
MOCT      INIT      "October"
MNOV      INIT      "November"
MDEC      INIT      "December"
.
DEVISLAB  DIM       20
KEYSTLAB  DIM       17
KEYEXLAB  DIM       17
DEVIXLAB  DIM       20
.
DEVISVAL  DIM       6
KEYSTVAL  DIM       6
KEYEXVAL  DIM       19
DEVIXVAL  DIM       19
.
ACCTKLAB  DIM       16
ACCTKVAL  DIM       837
ACCDELAB  DIM       30
ACCDEVAL  DIM       19
ACCKELAB  DIM       16
ACCKEVAL  DIM       19
ACCTTLAB  DIM       16
ACCTTVAL  DIM       6
ACCEILAB  DIM       15
ACCEIVAL  DIM       4
.
URNLNGTH  FORM      2
URCHKDGT  FORM      4
URWTARAY  INIT      "234567"
URCHKPRD  FORM      2
URNOWGHT  FORM      1
.
FORM8     FORM      8
.
MHCNAUDA  FORM      1   
MHCNUSE   FORM      1   
MHCEMPST  DIM       2   
MHADMFLG  FORM      1
MHCNUDSA  FORM      1   
MHCNUNIQ  FORM      8   
MHCNMHLS  DIM       2   
.
. PROGRAM CONSTANTS
. -----------------
.
. Site specific soft font (16602). Change to this when delivery to site
.
ARIAL10N  INIT      "(8U(s1p10.00v0s0b16602T"  * Arial 10pt font/normal
ARIAL10B  INIT      "(8U(s1p10.00v0s3b16602T"  * Arial 10pt font/bold
.
.ARIAL10N  INIT      "(8U(s1p10.00v0s0b0T"     * Time Roman 10pt font/normal
.ARIAL10B  INIT      "(8U(s1p10.00v0s3b0T"     * Time Roman 10pt font/bold
.
HORZT001  INIT      "&a1C"      * tab to column 1
HORZT028  INIT      "&a28C"     * tab to column 28 
HORZT049  INIT      "&a49C"     * tab to column 49 
HORZT050  INIT      "&a50C"     * tab to column 50 
HORZT057  INIT      "&a57C"     * tab to column 57
HORZT082  INIT      "&a82C"     * tab to column 82 
HORZT086  INIT      "&a86C"     * tab to column 86
HORZT099  INIT      "&a99C"     * tab to column 99
HORZT100  INIT      "&a100C"    * tab to column 100
HORZT113  INIT      "&a113C"    * tab to column 113
HORZT141  INIT      "&a141C"    * tab to column 141
HORZT148  INIT      "&a148C"    * tab to column 148
HORZT149  INIT      "&a149C"    * tab to column 149
HORZT155  INIT      "&a155C"    * tab to column 155 
HORZT170  INIT      "&a170C"    * tab to column 170 
.
LINESPAC  INIT      "&l6D"      * line spacing - 6 lines/inch
.
NBARCODE  INIT      "(6U(s0p6.25h18.0v0s-6b0T*"      * Barcode style
.
PRIRESET  INIT      "E"         * printer reset
.
TMARGIN   INIT      "&l1e68F"   * top margin - 1 line
.                                   text length - 68 lines
.
.         Vertical movement is required for the barcode otherwise
.         it will print above the top line of the large labels (verttab1/2)
.
VERTTAB1  INIT      "*p+30Y"    * move 30 PCL units down (for barcode)
VERTTAB2  INIT      "*p-30Y"    * move 30 PCL units up (for barcode)
VERTTAB3  INIT      "*p+5Y"     * move 5  PCL units up (vertical space between
VERTTAB5  INIT      "*p+5Y"     * move 2  PCL units up (vertical space between
CONST1    INIT      "ED  UR"
CONST2    INIT      "A/T"
CONST3    INIT      "GP:"
.-------------------------------------------------------------------------------
NSETBOLD  INIT      "(s0bT"
SETBOLD   INIT      "(s7bT"
.
ALRCOMM   DIM       100
MULTILIN  FORM      1  
.-------------------------------------------------------------------------------
PRGID     INIT      "FHRWEB01"
VERSION   INIT      "V12.00.01"
PRGNAM    INIT      "FHIR Patient Resource Inbound Server"
.-------------------------------------------------------------------------------
.
          CALL      WEBINT00       * Initialise Fifo Etc.
.
          CALL      INIT0000       * Open Files
.
MAIN0000  COMMIT
.
          BEGIN
.
          DISPLAY   *W2
.
          MATCH     "1",PTCNFHIR
          GOTO      MAIN0000 IF NOT EQUAL
.
          MATCH     "1",PTCNFHPA
          GOTO      MAIN0000 IF NOT EQUAL
.
          MOVE      ZERO,EXIT
.
          PACK      KEY79,SP70,SP70
          CALL      RSHLFP14
MAIN1000  CALL      RKHLFP14
          BRANCH    OVRCD,MAIN9999
.
          MATCH     SP70,HLP1STAT
          GOTO      MAIN9999 IF NOT EQUAL
.
          DISPLAY   *W10
.
          PACK      KEY78,HLP1RSID,HLP1VRID,HLP1CNT1,SP70
          CALL      RDHLP1A1
          IF        OVRCD=1
            CALL      CLHL7P1A
          ENDIF 
.
          PACK      KEY78,HLP1RSID,HLP1VRID,HLP1CNT1,SP70
          CALL      RDHLP1B1
          IF        OVRCD=1
            CALL      CLHL7P1B
          ENDIF
.
          PACK      KEY78,HLP1RSID,HLP1VRID,HLP1CNT1,SP70
          CALL      RDHLP1C1
          IF        OVRCD=1
            CALL      CLHL7P1C
          ENDIF
.
          MOVE      SP70,ERRORIND
.
          MATCH     "         1",HLP1VRID
          IF        @EQUAL
.
            CALL      WRTMAS00
.
          ELSE
.
            CALL      UPDMAS00 
.
          ENDIF
.UPTOHERE
.
          PACK      KEY79,HLP1STAT,HLP1RSID,HLP1VRID,HLP1CNT1,SP70
          CALL      RAHLFP14
          IF        OVRCD=0
.
            MATCH     "1",ERRORIND
            IF        @EQUAL
              MOVE      "E",HLP1STAT
            ELSE
              MOVE      "1",HLP1STAT
            ENDIF
.
            TRAP      OVERCOND IF IO
            CALL      UPHLFP14
            TRAPCLR   IO         
.
          ENDIF
.
MAIN9999  GOTO      MAIN0000
.
.------------------------------------------------------------
. Program Initialisation
.------------------------------------------------------------
INIT0000  MOVE      ONE,EMRFLAG
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      EMRVISA1,"emrvisaf"
          OPEN      EMRVISA2,"emrvisaf"
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      ZERO,EMRFLAG
          ENDIF
          OPEN      EMRCLIA1,"emrcliaf"
.
          OPEN      EMRHISA1,"emrhisaf"
          OPEN      EMRDCMA1,"emrdcmaf"
          OPEN      OBSDETA1,"obsdetaf"                                *I-54627
          OPEN      OBSMDTA1,"obsmdtaf"     * Patient Medical Notes
          OPEN      OBSMTXA1,"obsmtxaf"     * Patient Medical Notes fre
.
          OPEN      BOKRC1A6,"bokrc1af"
          OPEN      PATINVR3,"patinvrf"
          OPEN      PATLOCA1,"patlocaf"
          OPEN      PATGSRN1,"patgsrnf"
          OPEN      PMSCURA1,"pmscuraf"
.
          OPEN      VISCMTA1,"viscmtaf"
          OPEN      VISMTXA1,"vismtxaf"
          OPEN      EMRICDA1,"emricdaf"
          OPEN      EMRWFMA1,"emrwfmaf"
          OPEN      EMRWFMA2,"emrwfmaf"
          OPEN      EMRWFMA3,"emrwfmaf"
          OPEN      EMRWFMA4,"emrwfmaf"
          OPEN      EMRISMA1,"emrismaf"
          OPEN      EMRINCA1,"emrincaf"
          OPEN      EMRINCA2,"emrincaf"
          OPEN      EMRINCA3,"emrincaf"
          OPEN      EMRVCDA1,"emrvcdaf"
          OPEN      EMRVCDA2,"emrvcdaf"                               *I-215117
          OPEN      EMRMTXA3,"emrmtxaf"
.
          OPEN      EMRUNKA1,"emrunkaf"
          OPEN      EMRLPCA1,"emrlpcaf"
          OPEN      EMRLOCA1,"emrlocaf"
          OPEN      EMRPROA1,"emrproaf"                                *I-50421
          OPEN      EMRSITA1,"emrsitaf"
.
          OPEN      OPRNURA1,"oprnuraf"                   
          OPEN      PATALRT1,"patalrtf"                                *I-54627
          OPEN      PATALTT1,"pataltaf"
          OPEN      PATHSPA1,"pathspaf"
          OPEN      PATURAD1,"paturadf"
          OPEN      PMSMDTA1,"pmsmdtaf"
          OPEN      PMSALNA1,"pmsalnaf"
          OPEN      PMSMDTA1,"pmsmdtaf"
          OPEN      PMSMTXA1,"pmsmtxaf"
          OPEN      PATMA1A1,"patma1af"
          OPEN      PATMI1A1,"patmi1af"
          OPEN      PATMX1A1,"patmx1af"
          OPEN      PATPR1A1,"patpr1af"
          OPEN      PMSCCDA1,"pmsccdaf"
          OPEN      PMSPX2A1,"pmspx2af"
          OPEN      PATVISA1,"patvisaf"
          OPEN      PATVISA2,"patvisaf"
          OPEN      AAEDE1A1,"aaede1af"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATDO1A1,"patdo1af"
          OPEN      PATITEM1,"patitemn"                                *I-50421
          OPEN      PATICDO1,"paticdof"                                *I-50421
          OPEN      PATRE1A1,"patre1af"
          OPEN      PATFN1A1,"patfn1af"
          OPEN      PATWR1A1,"patwr1af"
          OPEN      PMSHCPA1,"pmshcpaf"
          OPEN      PMSHCGA1,"pmshcgaf"
          OPEN      PATVADA1,"patvadaf"
          OPEN      PMSVX1A1,"pmsvx1af"                                *I-55214
          OPEN      PMSRELA1,"pmsrelaf"
          OPEN      PMSTLEA1,"pmstleaf"
          OPEN      PMSCEXA1,"pmscexaf"
          OPEN      PRIITEM1,"priitemf"
          OPEN      PRIDTRA1,"pridtraf"
          OPEN      PRIDTRA4,"pridtraf"
          OPEN      PRIHREF1,"prihreff"
          OPEN      VISCODA1,"viscodaf"
          OPEN      VISMDTA1,"vismdtaf"
.
          OPEN      IBAPDFA1,"ibapdfaf"
          OPEN      IHAPASS1,"ihapassf"
          OPEN      IBACODE1,"ibacodef"
          OPEN      IBATMHA1,"ibatmhaf"
          OPEN      IBATDET1,"ibatmdaf"
          OPEN      IBASPOL1,"ibaspolf"
          OPEN      MEHDLSA1,"mehdlsaf"
          OPEN      WEBSECA3,"websecaf"
.
          OPEN      SCRSBGA1,"scrsbgaf"
          OPEN      SCRPSTA1,"scrpstaf"
          OPEN      SCRMASA1,"scrmasaf"
          OPEN      PATHGRP1,"pathgrpf"
.
          CALL      RDCTRL00
.
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,TWO;*182,CSNAME                           *I-54627
.
          READ      CONTROLF,TWENTY1;*138,PTCNNHII
          READ      CONTROLF,THIRTY;*89,HELPAGE,*90,HELPRNT,HELSIZE
.
          READ      CONTROLF,FIFTY9;*132,CALRDESC
          READ      CONTROLF,SEVENTY8;*64,AECNLABL
          READ      CONTROLF,EIGHTY;*250,PTCNHDPS
          READ      CONTROLF,EIGHTY9;*138,EMCNICDF                     *I-50421
          READ      CONTROLF,HUND03;*220,PTCNDEES,*221,PTCNDDES
          READ      CONTROLF,HUND18;*138,PTCNNEWC,*167,PTCNNWCA
          READ      CONTROLF,HUND20;*158,PTCNUNET
          READ      CONTROLF,HUND22;*8,EMCNURSE
          READ      CONTROLF,HUND29;*1,PTCNWSDR,*61,PTCNWSIN,*62,PTCNRKDY:
                                    *68,PTCNTKMN,*88,PTCNIHCW,*245,PTCNFHIR:
                                    *246,PTCNFHPA

.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
.
          IF        EMCNICDF=0
              OPEN      PATICDD1,"paticddf"
              OPEN      PATICDD2,"paticddf"
              OPEN      PATI10D1,"pati10df"
              OPEN      PATI10D2,"pati10df"
          ELSE
              OPEN      EMRICDA1,"emricdaf"
              OPEN      EMRICDA2,"emricdaf"
              OPEN      EMRICDA3,"emricdaf"
          ENDIF
.
          MATCH     "0",PTCNUNET
          IF        !@EQUAL
              OPEN      PMSIHIA1,"pmsihiaf"     * IHI Details
          ENDIF
.
          MOVE      ZERO,VISXDCIN
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      VISXDCA1,"visxdcaf"
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      ONE,VISXDCIN
          ENDIF
.
          MATCH     "1",PTCNNWCA
          IF        @EQUAL
            OPEN      PMSAUDCE,"pmsaudce"
            OPEN      PMSAUDC2,"pmsaudce"
          ENDIF
.
. **** FHIR ****
.
          MATCH     "1",PTCNFHIR
          IF        @EQUAL
            MATCH     "1",PTCNFHPA
            IF        @EQUAL
              OPEN      HL7FP1A1,"hl7fp1af"
              OPEN      HL7FP1A4,"hl7fp1af"
              OPEN      HL7P1AA1,"hl7p1aaf"
              OPEN      HL7P1BA1,"hl7p1baf"
              OPEN      HL7P1CA1,"hl7p1caf"
              OPEN      HL7FP2A1,"hl7fp2af"
              OPEN      HL7FP3A1,"hl7fp3af"
              OPEN      HL7P3AA1,"hl7p3aaf"
              OPEN      HL7FP4A1,"hl7fp4af"
              OPEN      HL7P4AA1,"hl7p4aaf"
              OPEN      HL7FP5A1,"hl7fp5af"
              OPEN      HL7FP6A1,"hl7fp6af"
              OPEN      HL7P6AA1,"hl7p6aaf"
              OPEN      HL7P6BA1,"hl7p6baf"
              OPEN      HL7FP7A1,"hl7fp7af"
              OPEN      HL7FP8A1,"hl7fp8af"
              OPEN      HL7FP9A1,"hl7fp9af"
              OPEN      HL7P1DA1,"hl7p1daf"
            ENDIF
          ENDIF
.
          IF        CAUDM=0
            OPEN      PATAM1A1,"patam1af"
          ENDIF
.
          MOVE      ZERO,AUDTATRB
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PATCCHA1,"patcchaf"
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      ONE,AUDTATRB
          ENDIF
.
          RETURN
.
.------------------------------------------------------------
. Write Patient Master 
.------------------------------------------------------------
WRTMAS00  CALL      CLPATMAS
          CALL      CLPMSPX2 
.
          MOVE      THREE,CPSYSTEM
          CALL      GNXTUR
.
          MATCH     ZEROUR,PURNO
          IF        @EQUAL
            MOVE      "1",ERRORIND
            MOVE      "Error: Invalid UR Number",HLP1PRDS
            GOTO      WRTMAS99
          ELSE
            MOVE    PURNO,HLP1URNO
          ENDIF
.
          CALL      GTPAGE00
          CALL      GTGEND00
          CALL      GTMARS00
          CALL      GTADDR00
          CALL      GTTELC00
          CALL      GTEXTN00
          CALL      GTIDEN00
          CALL      GTDECE00
          CALL      GTCONT00
          CALL      GTPVAR00
          CALL      GTCOMM00
          CALL      GTNAME00
.
          CALL      WRTUR
          IF        EXIT=1
            MOVE      "1",ERRORIND
            MOVE      "Error: Write UR failed.",HLP1PRDS
            GOTO      WRTMAS99
          ENDIF
.
          CALL      GTCONC00
          CALL      GTXCON00
          CALL      GTALIA00
.
WRTMAS99  RETURN
.
.------------------------------------------------------------
. Get General PMI Variables
.------------------------------------------------------------
GTPVAR00    CALL      IBACLOCK
            PACK      PTMXRDAT,CCC,CYY,CMM,CDD
            REP       " 0",PTMXRDAT
.
            MATCH     "true",HL1AMBBO
            IF        @EQUAL
              MOVE      "1",PMPXSN20
            ENDIF
.
            MATCH     SP70,HL1AMBIN
            IF        !@EQUAL
              MOVE      ZERO,FORM2
              MOVE      HL1AMBIN,DIM2
              RJUSTIFY  DIM2
              MOVE      DIM2,FORM2
.
              IF        FORM2>0
                MOVE      "1",PMPXSN20
              ENDIF
.
            ENDIF
.
GTPVAR99  RETURN
.
.------------------------------------------------------------
. Get Communication Segment hl7p1daf
.------------------------------------------------------------
GTCOMM00  PACK      KEY82,HLP1RSID,HLP1VRID,HLP1CNT1,SP70
          CALL      RSHLP1D1
GTCOMM10  CALL      RKHLP1D1
          BRANCH    OVRCD,GTCOMM99
.
          MATCH     HLP1RSID,HL1DRSID
          GOTO      GTCOMM99 IF NOT EQUAL
.
          MATCH     HLP1VRID,HL1DVRID
          GOTO      GTCOMM99 IF NOT EQUAL
.
          MATCH     HLP1CNT1,HL1DCNT1
          GOTO      GTCOMM99 IF NOT EQUAL
.
          MATCH     "   1",HL1DCNT2
          IF        @EQUAL
            MOVE      HL1DCCOD,PMPXLNG1
          ENDIF          
.
          MATCH     "   2",HL1DCNT2
          IF        @EQUAL
            MOVE      HL1DCCOD,PMPXLNG2
          ENDIF
.
          MATCH     "   3",HL1DCNT2
          IF        @EQUAL
            MOVE      HL1DCCOD,PMPXLNG3
          ENDIF
.

.
          GOTO      GTCOMM10
.
GTCOMM99  RETURN
.
.------------------------------------------------------------
. Get GeneralPractitioner Segment hl7fp3af
.------------------------------------------------------------
GTGENP00  PACK      KEY82,HLP1RSID,HLP1VRID,HLP1CNT1,SP70
          CALL      RSHLFP31
GTGENP10  CALL      RKHLFP31
          BRANCH    OVRCD,GTGENP99
.
          MATCH     HLP1RSID,HLP3RSID
          GOTO      GTGENP99 IF NOT EQUAL
.
          MATCH     HLP1VRID,HLP3VRID
          GOTO      GTGENP99 IF NOT EQUAL
.
          MATCH     HLP1CNT1,HLP3CNT1
          GOTO      GTGENP99 IF NOT EQUAL
.
          PACK      KEY82,HLP3RSID,HLP3VRID,HLP3CNT1,HLP3CNT2,SP70
          CALL      RDHLP3A1
          IF        OVRCD=1
            CALL      CLHL7P3A
          ENDIF
.
          MATCH     "   1",HLP3CNT2
          IF        @EQUAL
            MOVE      HLP3IDVA,PMPXRHC1
          ENDIF
.
          MATCH     "   2",HLP3CNT2
          IF        @EQUAL
            MOVE      HLP3IDVA,PTMAHCP1
          ENDIF
.
          MATCH     "   3",HLP3CNT2
          IF        @EQUAL
            MOVE      HLP3IDVA,PTMAHCP2
          ENDIF
.
          MATCH     "   4",HLP3CNT2
          IF        @EQUAL
            MOVE      HLP3IDVA,PTMAHCP3
          ENDIF
.
          MATCH     "   5",HLP3CNT2
          IF        @EQUAL
            MOVE      HLP3IDVA,PTMAHCP4
          ENDIF
.
          MATCH     "   6",HLP3CNT2
          IF        @EQUAL
            MOVE      HLP3IDVA,PTMAHCP5
          ENDIF
.
          MATCH     "   7",HLP3CNT2
          IF        @EQUAL
            MOVE      HLP3IDVA,PMPXAHC1
          ENDIF
.
          MATCH     "   8",HLP3CNT2
          IF        @EQUAL
            MOVE      HLP3IDVA,PMPXAHC2
          ENDIF
.
          GOTO      GTGENP10
.
GTGENP99  RETURN
.
.------------------------------------------------------------
. Get Deceased Details
.------------------------------------------------------------
GTDECE00  MATCH     "true",HL1ADEBO
          IF        @EQUAL
            MOVE      ONE,PCEASE
          ENDIF
.
          MATCH     SP70,HL1ADEDT
          IF        !@EQUAL
            MOVE      ONE,PCEASE
.
            UNPACK    HL1ADEDT,CCENT,CYEAR,KEY1,CMON,KEY1,CDAY
            PACK      PDECDTE,CCENT,CYEAR,CMON,CDAY,SP70
          ENDIF
.
GTDECE99  RETURN
.
.------------------------------------------------------------
. Get Contact Segment hl7fp6af
.------------------------------------------------------------
GTCONT00  PACK      KEY82,HLP1RSID,HLP1VRID,HLP1CNT1,SP70
          CALL      RSHLFP61
GTCONT10  CALL      RKHLFP61
          BRANCH    OVRCD,GTCONT99
.
          MATCH     HLP1RSID,HLP6RSID
          GOTO      GTCONT99 IF NOT EQUAL
.
          MATCH     HLP1VRID,HLP6VRID
          GOTO      GTCONT99 IF NOT EQUAL
.
          MATCH     HLP1CNT1,HLP6CNT1
          GOTO      GTCONT99 IF NOT EQUAL
.
          PACK      KEY82,HLP6RSID,HLP6VRID,HLP6CNT1,HLP6CNT2,SP70
          CALL      RDHLP6A1
          IF        OVRCD=1
            CALL      CLHL7P6A
          ENDIF
.
          PACK      KEY82,HLP6RSID,HLP6VRID,HLP6CNT1,HLP6CNT2,SP70
          CALL      RDHLP6B1
          IF        OVRCD=1
            CALL      CLHL7P6B
          ENDIF
.
          MATCH     "N ",HLP6RCOD
          IF        @EQUAL
.
            CLEAR     PNKNAME
            APPEND    HLP6NGIV,PNKNAME
            RESET     PNKNAME
            STRIP     PNKNAME
            ENDSET    PNKNAME
            APPEND    SP1,PNKNAME
            APPEND    HLP6NFAM,PNKNAME
            RESET     PNKNAME
.
            MOVE      HL6AALN1,PNKADD1
            MOVE      HL6AALN2,PNKADD2
            MOVE      HL6AALN3,PNKSUBR
            MOVE      HL6AALN4,PNKADD4
            MOVE      HL6AAPOS,PNKPOST
.
            MATCH     "PHONE",HL6ATSYS
            IF        @EQUAL
              MATCH     "HOME",HL6ATUSE
              IF        @EQUAL
                MOVE      HL6ATVAL,PNKTELP
              ENDIF
              MATCH     "WORK",HL6ATUSE
              IF        @EQUAL
                MOVE      HL6ATVAL,PNKTELB
              ENDIF
              MATCH     "MOBILE",HL6ATUSE
              IF        @EQUAL
                MOVE      HL6ATVAL,PMPXKMOB
              ENDIF
            ENDIF
.
            MATCH     "PHONE",HL6ATSY2
            IF        @EQUAL
              MATCH     "HOME",HL6ATUS2
              IF        @EQUAL
                MOVE      HL6ATVA2,PNKTELP
              ENDIF
              MATCH     "WORK",HL6ATUS2
              IF        @EQUAL
                MOVE      HL6ATVA2,PNKTELB
              ENDIF
              MATCH     "MOBILE",HL6ATUS2
              IF        @EQUAL
                MOVE      HL6ATVA2,PMPXKMOB
              ENDIF
            ENDIF
.
            MATCH     "PHONE",HL6ATSY3
            IF        @EQUAL
              MATCH     "HOME",HL6ATUS3
              IF        @EQUAL
                MOVE      HL6ATVA3,PNKTELP
              ENDIF
              MATCH     "WORK",HL6ATUS3
              IF        @EQUAL
                MOVE      HL6ATVA3,PNKTELB
              ENDIF
              MATCH     "MOBILE",HL6ATUS3
              IF        @EQUAL
                MOVE      HL6ATVA3,PMPXKMOB
              ENDIF
            ENDIF
.
            MOVE      HLP6RCO2,PNKRELP
.
            MATCH     "EMAIL",HL6ATSYS
            IF        @EQUAL
              MOVE      HL6ATVAL,PMPXKEML
            ENDIF
.
            MATCH     "EMAIL",HL6ATSY2
            IF        @EQUAL
              MOVE      HL6ATVA2,PMPXKEML
            ENDIF
.
            MATCH     "EMAIL",HL6ATSY3
            IF        @EQUAL
              MOVE      HL6ATVA3,PMPXKEML
            ENDIF
.
          ENDIF 
.
          MATCH     "C ",HLP6RCOD
          IF        @EQUAL
.
            CLEAR     PTMXECNM
            APPEND    HLP6NGIV,PTMXECNM
            RESET     PTMXECNM
            STRIP     PTMXECNM
            ENDSET    PTMXECNM
            APPEND    SP1,PTMXECNM
            APPEND    HLP6NFAM,PTMXECNM
            RESET     PTMXECNM
.
            MOVE      HL6AALN1,PTMXECA1
            MOVE      HL6AALN2,PTMXECA2
            MOVE      HL6AALN3,PTMXECA3
            MOVE      HL6AALN4,PTMXECA4
            MOVE      HL6AAPOS,PTMXECPC
.
            MATCH     "PHONE",HL6ATSYS
            IF        @EQUAL
              MATCH     "HOME",HL6ATUSE
              IF        @EQUAL
                MOVE      HL6ATVAL,PTMXECPP
              ENDIF
              MATCH     "WORK",HL6ATUSE
              IF        @EQUAL
                MOVE      HL6ATVAL,PTMXECBP
              ENDIF
              MATCH     "MOBILE",HL6ATUSE
              IF        @EQUAL
                MOVE      HL6ATVAL,PMPXCMOB
              ENDIF
            ENDIF
.
            MATCH     "PHONE",HL6ATSY2
            IF        @EQUAL
              MATCH     "HOME",HL6ATUS2
              IF        @EQUAL
                MOVE      HL6ATVA2,PTMXECPP
              ENDIF
              MATCH     "WORK",HL6ATUS2
              IF        @EQUAL
                MOVE      HL6ATVA2,PTMXECBP
              ENDIF
              MATCH     "MOBILE",HL6ATUS2
              IF        @EQUAL
                MOVE      HL6ATVA2,PMPXCMOB
              ENDIF
            ENDIF
.
            MATCH     "PHONE",HL6ATSY3
            IF        @EQUAL
              MATCH     "HOME",HL6ATUS3
              IF        @EQUAL
                MOVE      HL6ATVA3,PTMXECPP
              ENDIF
              MATCH     "WORK",HL6ATUS3
              IF        @EQUAL
                MOVE      HL6ATVA3,PTMXECBP
              ENDIF
              MATCH     "MOBILE",HL6ATUS3
              IF        @EQUAL
                MOVE      HL6ATVA3,PMPXCMOB
              ENDIF
            ENDIF
.
            MOVE      HLP6RCO2,PTMXECRE
.
            MATCH     "EMAIL",HL6ATSYS
            IF        @EQUAL
              MOVE      HL6ATVAL,PMPXCEML
            ENDIF
.
            MATCH     "EMAIL",HL6ATSY2
            IF        @EQUAL
              MOVE      HL6ATVA2,PMPXCEML
            ENDIF
.
            MATCH     "EMAIL",HL6ATSY3
            IF        @EQUAL
              MOVE      HL6ATVA3,PMPXCEML 
            ENDIF
.
          ENDIF
.
          MATCH     "FAMMEMB",HLP6RCOD
          IF        @EQUAL
.
            CLEAR     PTMXNRNM
            APPEND    HLP6NGIV,PTMXNRNM
            RESET     PTMXNRNM
            STRIP     PTMXNRNM
            ENDSET    PTMXNRNM
            APPEND    SP1,PTMXNRNM
            APPEND    HLP6NFAM,PTMXNRNM
            RESET     PTMXNRNM
.
            MOVE      HL6AALN1,PTMXNRA1
            MOVE      HL6AALN2,PTMXNRA2
            MOVE      HL6AALN3,PTMXNRA3
            MOVE      HL6AALN4,PTMXNRA4
            MOVE      HL6AAPOS,PTMXNRPC
.
            MATCH     "PHONE",HL6ATSYS
            IF        @EQUAL
              MATCH     "HOME",HL6ATUSE
              IF        @EQUAL
                MOVE      HL6ATVAL,PTMXNRPP
              ENDIF
              MATCH     "WORK",HL6ATUSE
              IF        @EQUAL
                MOVE      HL6ATVAL,PTMXNRBP
              ENDIF
              MATCH     "MOBILE",HL6ATUSE
              IF        @EQUAL
                MOVE      HL6ATVAL,PMPXRMOB
              ENDIF
            ENDIF
.
            MATCH     "PHONE",HL6ATSY2
            IF        @EQUAL
              MATCH     "HOME",HL6ATUS2
              IF        @EQUAL
                MOVE      HL6ATVA2,PTMXNRPP
              ENDIF
              MATCH     "WORK",HL6ATUS2
              IF        @EQUAL
                MOVE      HL6ATVA2,PTMXNRBP
              ENDIF
              MATCH     "MOBILE",HL6ATUS2
              IF        @EQUAL
                MOVE      HL6ATVA2,PMPXRMOB
              ENDIF
            ENDIF
.
            MATCH     "PHONE",HL6ATSY3
            IF        @EQUAL
              MATCH     "HOME",HL6ATUS3
              IF        @EQUAL
                MOVE      HL6ATVA3,PTMXNRPP
              ENDIF
              MATCH     "WORK",HL6ATUS3
              IF        @EQUAL
                MOVE      HL6ATVA3,PTMXNRBP
              ENDIF
              MATCH     "MOBILE",HL6ATUS3
              IF        @EQUAL
                MOVE      HL6ATVA3,PMPXRMOB
              ENDIF
            ENDIF
.
            MOVE      HLP6RCO2,PTMXNRRE
.
            MATCH     "EMAIL",HL6ATSYS
            IF        @EQUAL
              MOVE      HL6ATVAL,PMPXREML
            ENDIF
.
            MATCH     "EMAIL",HL6ATSY2
            IF        @EQUAL
              MOVE      HL6ATVA2,PMPXREML
            ENDIF
.
            MATCH     "EMAIL",HL6ATSY3
            IF        @EQUAL
              MOVE      HL6ATVA3,PMPXREML
            ENDIF
.
          ENDIF
.
          MATCH     "MTH",HLP6RCOD
          IF        @EQUAL
.
            MOVE      HLP6NGIV,PMPXMGNA
            MOVE      HLP6NFAM,PMPXMSNA
            MOVE      HLP6NPRE,PMPXMTLE
.
            MOVE      HL6AALN1,PMPXMAD1
            MOVE      HL6AALN2,PMPXMAD2
            MOVE      HL6AALN3,PMPXMAD3
            MOVE      HL6AALN4,PMPXMAD4
            MOVE      HL6AAPOS,PMPXMPOS
.
            MATCH     "PHONE",HL6ATSYS
            IF        @EQUAL
              MATCH     "HOME",HL6ATUSE
              IF        @EQUAL
                MOVE      HL6ATVAL,PMPXMPNO
              ENDIF
              MATCH     "WORK",HL6ATUSE
              IF        @EQUAL
                MOVE      HL6ATVAL,PMPXMBNO
              ENDIF
              MATCH     "MOBILE",HL6ATUSE
              IF        @EQUAL
                MOVE      HL6ATVAL,PMPXMMNO
              ENDIF
            ENDIF
.
            MATCH     "PHONE",HL6ATSY2
            IF        @EQUAL
              MATCH     "HOME",HL6ATUS2
              IF        @EQUAL
                MOVE      HL6ATVA2,PMPXMPNO
              ENDIF
              MATCH     "WORK",HL6ATUS2
              IF        @EQUAL
                MOVE      HL6ATVA2,PMPXMBNO
              ENDIF
              MATCH     "MOBILE",HL6ATUS2
              IF        @EQUAL
                MOVE      HL6ATVA2,PMPXMMNO
              ENDIF
            ENDIF
.
            MATCH     "PHONE",HL6ATSY3
            IF        @EQUAL
              MATCH     "HOME",HL6ATUS3
              IF        @EQUAL
                MOVE      HL6ATVA3,PMPXMPNO
              ENDIF
              MATCH     "WORK",HL6ATUS3
              IF        @EQUAL
                MOVE      HL6ATVA3,PMPXMBNO
              ENDIF
              MATCH     "MOBILE",HL6ATUS3
              IF        @EQUAL
                MOVE      HL6ATVA3,PMPXMMNO
              ENDIF
            ENDIF
.
            MOVE      HLP6RCO2,PMPXMREL
.
            MATCH     "EMAIL",HL6ATSYS
            IF        @EQUAL
              MOVE      HL6ATVAL,PMPXMEML
            ENDIF
.
            MATCH     "EMAIL",HL6ATSY2
            IF        @EQUAL
              MOVE      HL6ATVA2,PMPXMEML
            ENDIF
.
            MATCH     "EMAIL",HL6ATSY3
            IF        @EQUAL
              MOVE      HL6ATVA3,PMPXMEML
            ENDIF
.
          ENDIF
.
          MATCH     "FTH",HLP6RCOD
          IF        @EQUAL
.
            MOVE      HLP6NGIV,PMPXFGNA
            MOVE      HLP6NFAM,PMPXFSNA
            MOVE      HLP6NPRE,PMPXFTLE
.
            MOVE      HL6AALN1,PMPXFAD1
            MOVE      HL6AALN2,PMPXFAD2
            MOVE      HL6AALN3,PMPXFAD3
            MOVE      HL6AALN4,PMPXFAD4
            MOVE      HL6AAPOS,PMPXFPOS
.
            MATCH     "PHONE",HL6ATSYS
            IF        @EQUAL
              MATCH     "HOME",HL6ATUSE
              IF        @EQUAL
                MOVE      HL6ATVAL,PMPXFPNO
              ENDIF
              MATCH     "WORK",HL6ATUSE
              IF        @EQUAL
                MOVE      HL6ATVAL,PMPXFBNO
              ENDIF
              MATCH     "MOBILE",HL6ATUSE
              IF        @EQUAL
                MOVE      HL6ATVAL,PMPXFMNO
              ENDIF
            ENDIF
.
            MATCH     "PHONE",HL6ATSY2
            IF        @EQUAL
              MATCH     "HOME",HL6ATUS2
              IF        @EQUAL
                MOVE      HL6ATVA2,PMPXFPNO
              ENDIF
              MATCH     "WORK",HL6ATUS2
              IF        @EQUAL
                MOVE      HL6ATVA2,PMPXFBNO
              ENDIF
              MATCH     "MOBILE",HL6ATUS2
              IF        @EQUAL
                MOVE      HL6ATVA2,PMPXFMNO
              ENDIF
            ENDIF
.
            MATCH     "PHONE",HL6ATSY3
            IF        @EQUAL
              MATCH     "HOME",HL6ATUS3
              IF        @EQUAL
                MOVE      HL6ATVA3,PMPXFPNO
              ENDIF
              MATCH     "WORK",HL6ATUS3
              IF        @EQUAL
                MOVE      HL6ATVA3,PMPXFBNO
              ENDIF
              MATCH     "MOBILE",HL6ATUS3
              IF        @EQUAL
                MOVE      HL6ATVA3,PMPXFMNO
              ENDIF
            ENDIF
.
            MOVE      HLP6RCO2,PMPXFREL
.
            MATCH     "EMAIL",HL6ATSYS
            IF        @EQUAL
              MOVE      HL6ATVAL,PMPXFEML
            ENDIF
.
            MATCH     "EMAIL",HL6ATSY2
            IF        @EQUAL
              MOVE      HL6ATVA2,PMPXFEML
            ENDIF
.
            MATCH     "EMAIL",HL6ATSY3
            IF        @EQUAL
              MOVE      HL6ATVA3,PMPXFEML
            ENDIF
.
          ENDIF
.

.
          GOTO      GTCONT10
.
GTCONT99  
.         CALL      GTXCON00
.
          RETURN
.------------------------------------------------------------
. Get Identifier Segment hl7fp2af
.------------------------------------------------------------
GTIDEN00  PACK      KEY82,HLP1RSID,HLP1VRID,HLP1CNT1,SP70
          CALL      RSHLFP21
GTIDEN10  CALL      RKHLFP21
          BRANCH    OVRCD,GTIDEN99
.
          MATCH     HLP1RSID,HLP2RSID
          GOTO      GTIDEN99 IF NOT EQUAL
.
          MATCH     HLP1VRID,HLP2VRID
          GOTO      GTIDEN99 IF NOT EQUAL
.
          MATCH     HLP1CNT1,HLP2CNT1
          GOTO      GTIDEN99 IF NOT EQUAL
.
          MATCH    "MC ",HLP2IDCD
          IF       @EQUAL
            SCAN     "medicare-number",HLP2SYST
            IF        @EQUAL
              MOVE      HLP2IDVA,PMEDI
              UNPACK    HLP2IDVA,KEY10,PTMXMCCD
              MOVE      HLP2PEND,PMPXMEDC
            ENDIF
          ENDIF
.
          MATCH    "PEN ",HLP2IDCD
          IF       @EQUAL
            SCAN     "centrelink-customer-reference-number",HLP2SYST
            IF        @EQUAL
              MOVE      HLP2IDVA,PPENNO
              MOVE      HLP2PEND,PPNDTE
            ENDIF
          ENDIF
.
          MATCH    "MB ",HLP2IDCD
          IF       @EQUAL
            MOVE        HLP2IVAL,PFUNDH
            MOVE        HLP2CCOD,PFNDTB
            MOVE        HLP2IDVA,PFNDMM
          ENDIF
.
          SCAN     "dva",HLP2SYST
          IF       @EQUAL
.
            PACK     KEY5,ANSD,ANSX,HLP2IDCD,SP70
            CALL     RDCODE1
            IF       OVRCD=0
              MOVE     HLP2IDCD,PMPXDVAC
              GOTO     GTIDEN90
            ENDIF
.
            PACK     KEY5,ANSD,ANSX,SP70
            CALL     RDSCODE1
GTIDEN20    CALL     RDKCODE1
            BRANCH   OVRCD,GTIDEN90            
.
            MATCH    "DX",TCODE  
            GOTO     GTIDEN90 IF NOT EQUAL
.
            MATCH    "DVG",HLP2IDCD
            IF       @EQUAL
              MATCH    "G",THCSCOD
              IF       @EQUAL
                MOVE     ACODE,PMPXDVAC
                GOTO     GTIDEN90
              ENDIF
            ENDIF
.
            MATCH    "DVW",HLP2IDCD
            IF       @EQUAL
              MATCH    "W",THCSCOD
              IF       @EQUAL
                MOVE     ACODE,PMPXDVAC
                GOTO     GTIDEN90
              ENDIF
            ENDIF
.
            MATCH    "DVO",HLP2IDCD
            IF       @EQUAL
              MATCH    "O",THCSCOD
              IF       @EQUAL
                MOVE     ACODE,PMPXDVAC
                GOTO     GTIDEN90
              ENDIF
            ENDIF
.
            GOTO     GTIDEN20
.
          ENDIF
.
GTIDEN90  GOTO      GTIDEN10
.
GTIDEN99  
.         CALL      GTCONC00
.
          RETURN
.
.------------------------------------------------------------
. Get Extension Segment hl7fp5af
.------------------------------------------------------------
GTEXTN00  PACK      KEY82,HLP1RSID,HLP1VRID,HLP1CNT1,SP70
          CALL      RSHLFP51
GTEXTN10  CALL      RKHLFP51
          BRANCH    OVRCD,GTEXTN99
.
          MATCH     HLP1RSID,HLP5RSID
          GOTO      GTEXTN99 IF NOT EQUAL
.
          MATCH     HLP1VRID,HLP5VRID
          GOTO      GTEXTN99 IF NOT EQUAL
.
          MATCH     HLP1CNT1,HLP5CNT1
          GOTO      GTEXTN99 IF NOT EQUAL
.
          SCAN     "patient-birthPlace",HLP5EURL
          IF        @EQUAL
            MOVE      HLP5ACOU,PCONT                   * How do we map COB?
          ENDIF
.
          SCAN     "patient-religion",HLP5EURL
          IF        @EQUAL
.
            PACK      KEY5,ANSR,SP1,HLP5CODE,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      HLP5CODE,PREG
            ENDIF
.
            PACK      KEY5,ANSR,SP70                   * How do we map Religion?
            CALL      RDSCODE1
GTEXTN20    CALL      RDKCODE1
            BRANCH    OVRCD,GTEXTN90
.
            MATCH     "R ",TCODE
            GOTO      GTEXTN90 IF NOT EQUAL
.
            MATCH     HLP5CODE,THCSCOD
            GOTO      GTEXTN20 IF NOT EQUAL
.
            MOVE      ACODE,PREG
.
            GOTO      GTEXTN90
. 
          ENDIF
.
          SCAN     "indigenous-status",HLP5EURL
          IF        @EQUAL
.
            PACK      KEY5,ANSV,ANSA,HLP5CODE,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      HLP5CODE,PMPXABRG
            ENDIF
.
            PACK      KEY5,ANSV,ANSA,SP70  
            CALL      RDSCODE1
GTEXTN30    CALL      RDKCODE1
            BRANCH    OVRCD,GTEXTN90
.
            MATCH     "VA",TCODE
            GOTO      GTEXTN90 IF NOT EQUAL
.
            MATCH     HLP5CODE,THCSCOD
            GOTO      GTEXTN30 IF NOT EQUAL
.
            MOVE      ACODE,PMPXABRG
.
            GOTO      GTEXTN90
.
          ENDIF
.
          SCAN     "date-of-arrival",HLP5EURL
          IF        @EQUAL
            MOVE      HLP5VALU,PTMXOSDT                * Date of Arrival  
          ENDIF
.
          SCAN     "patient-interpreterRequired",HLP5EURL
          IF        @EQUAL
.
            MOVE      "U",PMPXINTR
.
            MATCH     "true",HLP5VALU
            IF        @EQUAL
              MOVE      "1",PMPXINTR
            ENDIF
.           
            MATCH     "false",HLP5VALU
            IF        @EQUAL
              MOVE      "0",PMPXINTR
            ENDIF
.
          ENDIF
.
          SCAN     "nz-iwi",HLP5EURL
          IF        @EQUAL
.
            PACK      KEY5,ANSLI,ANSLW,HLP5CODE,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MATCH     SP70,PMPXIWI1
              IF        @EQUAL
                MOVE      HLP5CODE,PMPXIWI1
              ENDIF
.
              MATCH     SP70,PMPXIWI2
              IF        @EQUAL
                MOVE      HLP5CODE,PMPXIWI2
              ENDIF
.
              MATCH     SP70,PMPXIWI3
              IF        @EQUAL
                MOVE      HLP5CODE,PMPXIWI3
              ENDIF
            ENDIF
.
            PACK      KEY5,ANSLI,ANSLW,SP70
            CALL      RDSCODE1
GTEXTN40    CALL      RDKCODE1
            BRANCH    OVRCD,GTEXTN90
.
            MATCH     "iw",TCODE
            GOTO      GTEXTN90 IF NOT EQUAL
.
            MATCH     HLP5CODE,THCSCOD
            GOTO      GTEXTN40 IF NOT EQUAL
.
            MATCH     SP70,PMPXIWI1
            IF        @EQUAL
              MOVE      ACODE,PMPXIWI1 
            ENDIF
.
            MATCH     SP70,PMPXIWI2
            IF        @EQUAL
              MOVE      ACODE,PMPXIWI2
            ENDIF
.
            MATCH     SP70,PMPXIWI3
            IF        @EQUAL
              MOVE      ACODE,PMPXIWI3
            ENDIF
.
            GOTO      GTEXTN40
.
          ENDIF
.
          SCAN     "patient-genderIdentity",HLP5EURL
          IF        @EQUAL
.
            PACK      KEY5,ANSG,ANSLI,HLP5CODE,SP70
            CALL      RDCODE1
            IF        OVRCD=0 
              MOVE      HLP5CODE,PMPXUCC4
            ENDIF
.
            MOVE      HLP5CODE,PMPXATF1
            MATCH     SP70,HLP5TEXT
            IF        !@EQUAL
              MOVE      HLP5TEXT,PMPXATF1
            ENDIF
.
          ENDIF
.
          SCAN     "patient-citizenship",HLP5EURL
          IF        @EQUAL
            MOVE      HLP5CODE,PTYPE
          ENDIF
.
GTEXTN90  GOTO     GTEXTN10
.
GTEXTN99  RETURN
.------------------------------------------------------------
. Get DOB and Age hl7p1aaf
.------------------------------------------------------------
GTPAGE00  MOVE      HL1ABDAT,PBDATE
.
          MATCH     SP70,PBDATE
          IF        !@EQUAL
            CALL      IBACLOCK
            UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            REP       " 0",AGEDATE 
            CALL      CALCAGE    
            MOVE      PSAGEYRS,PSAGE          
          ENDIF
.
GTPAGE99  RETURN
.
.------------------------------------------------------------
. Get Name Segment hl7fp7af
.------------------------------------------------------------
GTNAME00  PACK      KEY82,HLP1RSID,HLP1VRID,HLP1CNT1,SP70
          CALL      RSHLFP71
GTNAME10  CALL      RKHLFP71
          BRANCH    OVRCD,GTNAME99
.
          MATCH     HLP1RSID,HLP7RSID
          GOTO      GTNAME99 IF NOT EQUAL
.
          MATCH     HLP1VRID,HLP7VRID
          GOTO      GTNAME99 IF NOT EQUAL
.
          MATCH     HLP1CNT1,HLP7CNT1 
          GOTO      GTNAME99 IF NOT EQUAL
.
          MATCH     "OFFICIAL",HLP7NUSE
          IF        @EQUAL
            MOVE      HLP7NPR1,PTITL 
            MOVE      HLP7NFAM,PSNAME
            MOVE      HLP7NFAM,PTMASNAM
            MOVE      HLP7NGV1,PGNAME
            MOVE      HLP7NGV1,PMPXFNAM
            MOVE      HLP7NGV2,PMPXSNAM
          ENDIF
.
          MATCH     "USUAL",HLP7NUSE
          IF        @EQUAL
            MOVE      HLP7NFAM,PMPXPFSN
            MOVE      HLP7NGV1,PMPXPFGN
          ENDIF
.
          MATCH     "MAIDEN",HLP7NUSE
          IF        @EQUAL
            MOVE      HLP7NFAM,PMPXMAID
          ENDIF
.
.         MATCH     "NICKNAME",HLP7NUSE
.         IF        @EQUAL
.           CALL      WRALI000 
.         ENDIF
.
.         MATCH     "TEMP",HLP7NUSE
.         IF        @EQUAL
.           CALL      WRALI000
.         ENDIF
.
.         MATCH     "ANONYMOUS",HLP7NUSE
.         IF        @EQUAL
.           CALL      WRALI000
.         ENDIF
.
.         MATCH     "OLD",HLP7NUSE
.         IF        @EQUAL
.           CALL      WRALI000
.         ENDIF
.
          GOTO      GTNAME10
.
GTNAME99  RETURN
.
.------------------------------------------------------------
. Get Address Segment hl7fp7af
.------------------------------------------------------------
GTADDR00  PACK      KEY82,HLP1RSID,HLP1VRID,HLP7CNT1,SP70
          CALL      RSHLFP91
GTADDR10  CALL      RKHLFP91
          BRANCH    OVRCD,GTADDR99
.
          MATCH     HLP1RSID,HLP9RSID
          GOTO      GTADDR99 IF NOT EQUAL
.
          MATCH     HLP1VRID,HLP9VRID
          GOTO      GTADDR99 IF NOT EQUAL
.
          MATCH     HLP1CNT1,HLP9CNT1
          GOTO      GTADDR99 IF NOT EQUAL
.
          MATCH     "HOME",HLP9AUSE
          IF        @EQUAL
            MOVE      HLP9ALN1,PADD1
            MOVE      HLP9ALN2,PADD2
            MOVE      HLP9ACTY,PSUBRB
            MOVE      HLP9ASTA,PADD4
            MOVE      HLP9APOC,PPOST
.
            MATCH     "BOTH",HLP9ATYP
            IF        @EQUAL
              MOVE      HLP9ALN1,PADD1
              MOVE      HLP9ALN2,PADD2
              MOVE      HLP9ACTY,PSUBRB
              MOVE      HLP9ASTA,PADD4
              MOVE      HLP9APOC,PPOST
            ENDIF
.
            MATCH     "PHYSICAL",HLP9ATYP
            IF        @EQUAL
              MOVE      HLP9ALN1,PADD1
              MOVE      HLP9ALN2,PADD2
              MOVE      HLP9ACTY,PSUBRB
              MOVE      HLP9ASTA,PADD4
              MOVE      HLP9APOC,PPOST
            ENDIF
.
            MATCH     "POSTAL",HLP9ATYP
            IF        @EQUAL
              MOVE      HLP9ALN1,PTMXADD1
              MOVE      HLP9ALN2,PTMXADD2
              MOVE      HLP9ACTY,PTMXADD3
              MOVE      HLP9ASTA,PTMXADD4
              MOVE      HLP9APOC,PTMXPOST
            ENDIF
.
          ENDIF
.
          GOTO      GTADDR10
.
GTADDR99  RETURN
.
.------------------------------------------------------------
. Get Telecom Segment hl7fp8af
.------------------------------------------------------------
GTTELC00  PACK      KEY82,HLP1RSID,HLP1VRID,HLP7CNT1,SP70
          CALL      RSHLFP81
GTTELC10  CALL      RKHLFP81
          BRANCH    OVRCD,GTTELC99
.
          MATCH     HLP1RSID,HLP8RSID
          GOTO      GTTELC99 IF NOT EQUAL
.
          MATCH     HLP1VRID,HLP8VRID
          GOTO      GTTELC99 IF NOT EQUAL
.
          MATCH     HLP1CNT1,HLP8CNT1
          GOTO      GTTELC99 IF NOT EQUAL
.
          MATCH     "PHONE",HLP8TSYS
          IF        @EQUAL
            MATCH     "HOME",HLP8TUSE
            IF        @EQUAL
              MOVE      HLP8TVAL,PTELEP
            ENDIF
            MATCH     "WORK",HLP8TUSE
            IF        @EQUAL
              MOVE      HLP8TVAL,PTELEB
            ENDIF
            MATCH     "MOBILE",HLP8TUSE
            IF        @EQUAL
              MOVE      HLP8TVAL,PTMXCELL
            ENDIF
          ENDIF
.
          MATCH     "EMAIL",HLP8TSYS
          IF        @EQUAL
            MOVE      HLP8TVAL,PMPXPEML
          ENDIF
.
          MATCH     "FAX",HLP8TSYS
          IF        @EQUAL
            MOVE      HLP8TVAL,PMPXPFAX
          ENDIF
.
          GOTO      GTTELC10
.
GTTELC99  RETURN
.
.------------------------------------------------------------
. Get Gender hl7p1aaf
.------------------------------------------------------------
GTGEND00  MATCH     "FEMALE",HL1AGEND
          IF        @EQUAL
.
            PACK      KEY5,ANSG,SP70
            CALL      RDSCODE1
GTGEND10    CALL      RDKCODE1
            BRANCH    OVRCD,GTGEND99
.
            MATCH     "G ",TCODE
            GOTO      GTGEND99 IF NOT EQUAL
.
            MATCH     "2",TCINDC1 
            GOTO      GTGEND10 IF NOT EQUAL
.
            MOVE      ACODE,PSEX
            GOTO      GTGEND99
          ENDIF
.
          MATCH     "MALE",HL1AGEND
          IF        @EQUAL
.
            PACK      KEY5,ANSG,SP70
            CALL      RDSCODE1
GTGEND20    CALL      RDKCODE1
            BRANCH    OVRCD,GTGEND99
.
            MATCH     "G ",TCODE
            GOTO      GTGEND99 IF NOT EQUAL
.
            MATCH     "1",TCINDC1
            GOTO      GTGEND20 IF NOT EQUAL
.
            MOVE      ACODE,PSEX
            GOTO      GTGEND99
          ENDIF          
.
          MATCH     "OTHER",HL1AGEND
          IF        @EQUAL
.
            PACK      KEY5,ANSG,SP70
            CALL      RDSCODE1
GTGEND30    CALL      RDKCODE1
            BRANCH    OVRCD,GTGEND99
.
            MATCH     "G ",TCODE
            GOTO      GTGEND99 IF NOT EQUAL
.
            MATCH     "3",TCINDC1
            GOTO      GTGEND30 IF NOT EQUAL
.
            MOVE      ACODE,PSEX
            GOTO      GTGEND99
          ENDIF
.
          MATCH     "UNKNOWN",HL1AGEND
          IF        @EQUAL
.
            PACK      KEY5,ANSG,SP70
            CALL      RDSCODE1
GTGEND40    CALL      RDKCODE1
            BRANCH    OVRCD,GTGEND99
.
            MATCH     "G ",TCODE
            GOTO      GTGEND99 IF NOT EQUAL
.
            MATCH     "9",TCINDC1
            GOTO      GTGEND40 IF NOT EQUAL
.
            MOVE      ACODE,PSEX
            GOTO      GTGEND99
          ENDIF
.
GTGEND99  RETURN
.
.------------------------------------------------------------
. Get Marital Status hl7p1aaf
.------------------------------------------------------------
GTMARS00  MATCH     "UNK",HL1AMACO
          IF        @EQUAL
.
            PACK      KEY5,ANSM,SP70
            CALL      RDSCODE1
GTMARS05    CALL      RDKCODE1
            BRANCH    OVRCD,GTMARS99
.
            MATCH     "M ",TCODE
            GOTO      GTMARS99 IF NOT EQUAL
.
            MATCH     "6",THCSCOD
            GOTO      GTMARS05 IF NOT EQUAL
.
            MOVE      ACODE,PMSTAT
            GOTO      GTMARS99
          ENDIF
.
          MATCH     "W ",HL1AMACO
          IF        @EQUAL
.
            PACK      KEY5,ANSM,SP70
            CALL      RDSCODE1
GTMARS10    CALL      RDKCODE1
            BRANCH    OVRCD,GTMARS99
.
            MATCH     "M ",TCODE
            GOTO      GTMARS99 IF NOT EQUAL
.
            MATCH     "2",THCSCOD
            GOTO      GTMARS10 IF NOT EQUAL
.
            MOVE      ACODE,PMSTAT
            GOTO      GTMARS99
          ENDIF
.
          MATCH     "S ",HL1AMACO
          IF        @EQUAL
.
            PACK      KEY5,ANSM,SP70
            CALL      RDSCODE1
GTMARS15    CALL      RDKCODE1
            BRANCH    OVRCD,GTMARS99
.
            MATCH     "M ",TCODE
            GOTO      GTMARS99 IF NOT EQUAL
.
            MATCH     "1",THCSCOD
            GOTO      GTMARS15 IF NOT EQUAL
.
            MOVE      ACODE,PMSTAT
            GOTO      GTMARS99
          ENDIF
.
          MATCH     "U ",HL1AMACO
          IF        @EQUAL
.
            PACK      KEY5,ANSM,SP70
            CALL      RDSCODE1
GTMARS20    CALL      RDKCODE1
            BRANCH    OVRCD,GTMARS99
.
            MATCH     "M ",TCODE
            GOTO      GTMARS99 IF NOT EQUAL
.
            MATCH     "1",THCSCOD
            GOTO      GTMARS20 IF NOT EQUAL
.
            MOVE      ACODE,PMSTAT
            GOTO      GTMARS99
          ENDIF
.
          MATCH     "T ",HL1AMACO
          IF        @EQUAL
.
            PACK      KEY5,ANSM,SP70
            CALL      RDSCODE1
GTMARS25    CALL      RDKCODE1
            BRANCH    OVRCD,GTMARS99
.
            MATCH     "M ",TCODE
            GOTO      GTMARS99 IF NOT EQUAL
.
            MATCH     "6",THCSCOD
            GOTO      GTMARS25 IF NOT EQUAL
.
            MOVE      ACODE,PMSTAT
            GOTO      GTMARS99
          ENDIF
.
          MATCH     "P ",HL1AMACO
          IF        @EQUAL
.
            PACK      KEY5,ANSM,SP70
            CALL      RDSCODE1
GTMARS30    CALL      RDKCODE1
            BRANCH    OVRCD,GTMARS99
.
            MATCH     "M ",TCODE
            GOTO      GTMARS99 IF NOT EQUAL
.
            MATCH     "5",THCSCOD
            GOTO      GTMARS30 IF NOT EQUAL
.
            MOVE      ACODE,PMSTAT
            GOTO      GTMARS99
          ENDIF
.
          MATCH     "C ",HL1AMACO
          IF        @EQUAL
.
            PACK      KEY5,ANSM,SP70
            CALL      RDSCODE1
GTMARS35    CALL      RDKCODE1
            BRANCH    OVRCD,GTMARS99
.
            MATCH     "M ",TCODE
            GOTO      GTMARS99 IF NOT EQUAL
.
            MATCH     "5",THCSCOD
            GOTO      GTMARS35 IF NOT EQUAL
.
            MOVE      ACODE,PMSTAT
            GOTO      GTMARS99
          ENDIF
.
          MATCH     "M ",HL1AMACO
          IF        @EQUAL
.
            PACK      KEY5,ANSM,SP70
            CALL      RDSCODE1
GTMARS40    CALL      RDKCODE1
            BRANCH    OVRCD,GTMARS99
.
            MATCH     "M ",TCODE
            GOTO      GTMARS99 IF NOT EQUAL
.
            MATCH     "5",THCSCOD
            GOTO      GTMARS40 IF NOT EQUAL
.
            MOVE      ACODE,PMSTAT
            GOTO      GTMARS99
          ENDIF
.
          MATCH     "L ",HL1AMACO
          IF        @EQUAL
.
            PACK      KEY5,ANSM,SP70
            CALL      RDSCODE1
GTMARS45    CALL      RDKCODE1
            BRANCH    OVRCD,GTMARS99
.
            MATCH     "M ",TCODE
            GOTO      GTMARS99 IF NOT EQUAL
.
            MATCH     "4",THCSCOD
            GOTO      GTMARS45 IF NOT EQUAL
.
            MOVE      ACODE,PMSTAT
            GOTO      GTMARS99
          ENDIF
.
          MATCH     "I ",HL1AMACO
          IF        @EQUAL
.
            PACK      KEY5,ANSM,SP70
            CALL      RDSCODE1
GTMARS50    CALL      RDKCODE1
            BRANCH    OVRCD,GTMARS99
.
            MATCH     "M ",TCODE
            GOTO      GTMARS99 IF NOT EQUAL
.
            MATCH     "9",THCSCOD
            GOTO      GTMARS50 IF NOT EQUAL
.
            MOVE      ACODE,PMSTAT
            GOTO      GTMARS99
          ENDIF
.
          MATCH     "D ",HL1AMACO
          IF        @EQUAL
.
            PACK      KEY5,ANSM,SP70
            CALL      RDSCODE1
GTMARS55    CALL      RDKCODE1
            BRANCH    OVRCD,GTMARS99
.
            MATCH     "M ",TCODE
            GOTO      GTMARS99 IF NOT EQUAL
.
            MATCH     "3",THCSCOD
            GOTO      GTMARS55 IF NOT EQUAL
.
            MOVE      ACODE,PMSTAT
            GOTO      GTMARS99
          ENDIF
.
          MATCH     "A ",HL1AMACO
          IF        @EQUAL
.
            PACK      KEY5,ANSM,SP70
            CALL      RDSCODE1
GTMARS60    CALL      RDKCODE1
            BRANCH    OVRCD,GTMARS99
.
            MATCH     "M ",TCODE
            GOTO      GTMARS99 IF NOT EQUAL
.
            MATCH     "1",THCSCOD
            GOTO      GTMARS60 IF NOT EQUAL
.
            MOVE      ACODE,PMSTAT
            GOTO      GTMARS99
          ENDIF
.
GTMARS99  RETURN
.------------------------------------------------------------
. RDCTRL00 - Read control file parameters
.------------------------------------------------------------
.
RDCTRL00  READ      CONTROLF,TEN;*25,PTCNVKCA,*42,PTCNDGAT,*53,CPCONT:
                                *126,CLABPG:
                                *127,CLABPRT,*164,CSPECCO,*165,CIDENT:
                                *166,CMEMB,*167,CSECURA,*188,CCHKRAT:
                                *194,CDIETCD,*196,CGENRUR,*197,CASSOCD:
                                *198,CDIETDF,*201,CAUDA,*211,CAUDK:
                                *213,CAUDM,*217,CAUDQ,*244,CHOSPNUM
.
          READ      CONTROLF,TEN3;*143,CSIZLAB,*186,CMBSOPR,*188,CMABINS:
                                  *194,CVETINS,*216,CUSR1,*217,CUSRDS1:
                                  *229,CUSR2,*230,CUSRDS2,*242,CCLMCHN:
                                  *243,CACCLSS,*244,CHCS,*245,CHOSTYP
.
          READ      CONTROLF,TEN4;*227,CIDLAY,*229,CUSMAN1,*230,CUSMAN2:
                                  *231,CATDMAN,*248,CURDEL
.
          READ      CONTROLF,TEN5;*187,CBOOK,*189,CTHETR,*190,CKMBS,*191,CMUSR1:
                                  *192,CMUSDS1,*204,CMUSR2,*205,CMUSDS2:
                                  *217,CMUSR3,*218,CMUSDS3,*230,CMUSMAN1:
                                  *231,CMUSMAN2,*232,CMUSMAN3,*233,CUSR3:
                                  *234,CUSRDS3,*246,CUSMAN3,*249,CRDRTYP
.
          READ      CONTROLF,TEN8;*17,CUSR4,*18,CUSRDS4,*30,CUSMAN4:
                                  *31,CUSR5,*32,CUSRDS5,*44,CUSMAN5:
                                  *45,CUSR6,*46,CUSRDS6,*58,CUSMAN6:
                                  *59,CUSR7,*60,CUSRDS7,*72,CUSMAN7:
                                  *143,CLOWMBS,*148,CLOWADM,*151,CHIGHMBS:
                                  *156,CHIGHADM,*159,CTOPADM,*206,CFINAN:
                                  *225,CCHGST1,*228,CCHGST2,*246,CMAXAGE
.
          READ      CONTROLF,TEN9;*75,CCNOTES,*208,CPMIAD,*209,CSRESP:
                                  *212,CFEETYP,*214,CWRDSCN,*225,CSALIAS
.
          READ      CONTROLF,TWENTY;*50,PTCNADBF,*52,PTPCLRES,*165,PTCNDFBO:
                                    *193,PTCNDCLM
.
          READ      CONTROLF,TWENTY1;*45,PTCNDRSM,*46,PTCNBAGE,*205,PTCNUKEY:
                                     *221,CNSWLOC,*238,PTCNAGEC,*248,PTCNSOUC
.
          READ      CONTROLF,TWENTY2;*30,STCNIPPM,*31,STCNIPAD,*45,STCNFUND
.
          READ      CONTROLF,TWENTY7;*46,HBWAIT
.
          READ      CONTROLF,THIRTY;*90,HELPRNT
.
          READ      CONTROLF,THIRTY7;*137,HWDSOUR,*241,WTCNUSBC
.
          READ      CONTROLF,FORTY;*44,OPCNAUDB,*61,OPCNAUDS,*112,OPCNCODE
.
          READ      CONTROLF,FORTY2;*19,OPCNFOTM,*20,OPCNTOTM,*101,OPCNSGCL
.
          READ      CONTROLF,FIFTY9;*2,C3BDAYS:
                                    *6,CLUNTNO,*35,CTYPLAB,*141,CPIDCOD:
                                    *171,PTCNSTAU,*172,PTCNNUMM,*174,PTCNNDAT:
                                    *182,PTCNORNO,*192,PTCNURCF,*193,PTCNRQCF:
                                    *194,PTCNDPCF,*195,PTCNRLAY,*196,PTCNUCOD:
                                    *202,PTCNMRPN,*209,PTCNDAYF,*216,PTPRVALS:
                                    *220,PTCNUADT,*226,CCARECL:
                                    *233,PTCNADOC
.
          READ      CONTROLF,SIXTY9;*43,MHCNAUDA,*69,MHCNUSE,*80,MHCNUDSA
.
          READ      CONTROLF,SEVENTY7;*201,PTCNIDHD
.
          READ      CONTROLF,SEVENTY9;*82,PTCNDSCI,*94,PTCNADTT:
                                      *95,PTCNDSTT,*138,PTCNURHA
.
          READ      CONTROLF,EIGHTY;*250,PTCNHDPS
.
          READ      CONTROLF,EIGHTY8;*234,PTCNNCFB,*235,PTCNADCF,*237,PTCNEMPL:
                                     *246,PTCNH7VP
.
          READ      CONTROLF,FIFTY9;*234,CPNMPICK
          READ      CONTROLF,TWENTY1;*55,SRCHDOBS,*138,PTCNNHII
          READ      CONTROLF,FIFTY9;*234,PTCNNMPI
          READ      CONTROLF,NINTY8;*124,PTCNHPCD,*129,PTCNDGST
          READ      CONTROLF,HUND05;*98,PTCNCMYN,PTCNNWCM,*166,PTCNCMXF:
                                    *210,PTCNLCLM
          READ      CONTROLF,HUND10;*115,PTCNUEDI,*243,PTCNCOMF,*248,PTCNEPAY
          READ      CONTROLF,HUND28;*105,PTCNUABF
          READ      CONTROLF,HUND29;*61,PTCNWSIN,*71,PTCNOECW,*72,PTCNOECE
.
RDCTRL99  RETURN
+
.------------------------------------------------------------
. Required by WEBEMCM2
.------------------------------------------------------------
.
ACTMSAV   CALL      AMSV0000
          RETURN
+
.------------------------------------------------------------
. AMSV0000 - Subroutine to save master variables - From PATPRG31
.------------------------------------------------------------
.
AMSV0000  MOVE      PMICRO,SPMICRO
          MOVE      PUSR1,SPUSR1
          MOVE      PUSR2,SPUSR2
          MOVE      PUSR3,SPUSR3
          MOVE      PUSR4,SPUSR4
          MOVE      PUSR5,SPUSR5
          MOVE      PUSR6,SPUSR6
          MOVE      PUYN1,SPUYN1
          MOVE      PUYN2,SPUYN2
          MOVE      PUYN3,SPUYN3
.
          MOVE      PURNO,SPURNO
          MOVE      PTITL,SPTITL
          MOVE      PSNAME,SPSNAME
          MOVE      PTMASNAM,SPTMASNM
          MOVE      PGNAME,SPGNAME
          MOVE      PMPXFNAM,SPMPXFNM
          MOVE      PMPXSNAM,SPMPXSNM
          MOVE      PPSNAME,SPPSNAME
          MOVE      PSMOK,SPSMOK
          MOVE      PSEX,SPSEX
          MOVE      PMSTAT,SPMSTAT
          MOVE      PBDATE,SPBDATE
          MOVE      PSAGE,SPSAGE
          MOVE      PCONT,SPCONT
          MOVE      PREG,SPREG
          MOVE      PTYPE,SPTYPE
          MOVE      POCCUP,SPOCCUP
          MOVE      PMEDI,SPMEDI
          MOVE      PPENNO,SPPENNO
          MOVE      PPNDTE,SPPNDTE
          MOVE      PREPAT,SPREPAT
          MOVE      PCHGDTE,SPCHGDTE
          MOVE      PLOCDOC,SPLOCDOC
          MOVE      PCEASE,SPCEASE
.
          MOVE      PNKNAME,SPNKNAME
          MOVE      PNKADD1,SPNKADD1
          MOVE      PNKADD2,SPNKADD2
          MOVE      PNKSUBR,SPNKSUBR
          MOVE      PNKADD4,SPNKADD4
          MOVE      PNKPOST,SPNKPOST
          MOVE      PNKTELP,SPNKTELP
          MOVE      PNKTELB,SPNKTELB
          MOVE      PNKRELP,SPNKRELP
.
          CALL      PRAV0000                * Person Responsible A/C variables
.
          MOVE      PADD1,SPADD1
          MOVE      PADD2,SPADD2
          MOVE      PSUBRB,SPSUBRB
          MOVE      PADD4,SPADD4
          MOVE      PPOST,SPPOST
          MOVE      PTELEP,SPTELEP
          MOVE      PTELEB,SPTELEB
          MOVE      PTMXCELL,SPCELL
          MOVE      PTMXDOFR,SPDOR
          MOVE      PMPXRHC1,SPREGP
          MOVE      PMPXRH1G,SPGPPC
          MOVE      PMPXR1GC,SPGPPT
          MOVE      PMPXRHC1,SAVEPHCP
          MOVE      PMPXRH1G,SAVEPRAC
          MOVE      PMPXR1GC,SAVEPCTR
          MOVE      PTMXOSMS,SPOSMS
.
          MOVE      PHIGH1,SPHIGH1
          MOVE      PHIGH2,SPHIGH2
          MOVE      PHIGH3,SPHIGH3
          MOVE      PAUTOPY,SPAUTOPY
          MOVE      PDECDTE,SPDECDTE
          MOVE      PYRRES,SPYRRES
.
.-------- Save Community Card Details ---------------------------------
.
          MOVE      PTMXCARD,SPCARD
          MOVE      PTMXCEXP,SPCEXP
          MOVE      PTMXCXMP,SPCXMP
          MOVE      PTMXFMLY,SPFMLY
.
AMSV9999  RETURN
+
.------------------------------------------------------------
.                          WRALI000
.         maintenance of the double soundex surname file
.------------------------------------------------------------
.
WRALI000  MOVE      HLP7NFAM,GSRSNAM
          MOVE      HLP7NGV1,GSRGNAM
          MOVE      HLP7NGV2,PTGSGNM2
          MOVE      PBDATE,GSRDOB            * Date of birth
          MOVE      PSEX,GSRSEX              * Sex
          MOVE      PURNO,GSRURNO
          MOVE      ZEROVISN,GSRBILL
          MOVE      ZERO,GSRSYS
          CALL      SOUNDEX                  * get soundex key for surname
          CALL      SOUNDX2                  * get soundex key for given names
.
          PACK      KEY115,GSRURNO,GSRBILL,GSRSNAM,GSRGNAM,PTGSGNM2,GSRDOB:
                           GSRSEX
          CALL      RDPTGSR1                 * check if its already there
          IF        OVRCD = 1
            CALL      WRPTGSR1
          ENDIF
.
WRALI999  RETURN
+
.------------------------------------------------------------
. PRAV0000  : save person responsible for account variables
.------------------------------------------------------------
.
PRAV0000  MOVE      PKNAME,SPKNAME
          MOVE      PKADD1,SPKADD1
          MOVE      PKADD2,SPKADD2
          MOVE      PKSUBR,SPKSUBR
          MOVE      PKADD4,SPKADD4
          MOVE      PKPOST,SPKPOST
          MOVE      PKTELEP,SPKTELP
          MOVE      PKTELEB,SPKTELB
          MOVE      PKRELP,SPKRELP
          MOVE      PTREMOBL,SPKMOBL
.
PRAV9999  RETURN
+
.---------------------------------------------------------------
. Add Extra Contacts to pmscexaf from hl7fp6af 
.---------------------------------------------------------------
GTXCON00  PACK      KEY82,HLP1RSID,HLP1VRID,HLP1CNT1,SP70
          CALL      RSHLFP61
GTXCON10  CALL      RKHLFP61
          BRANCH    OVRCD,GTXCON99
.
          MATCH     HLP1RSID,HLP6RSID
          GOTO      GTXCON99 IF NOT EQUAL
.
          MATCH     HLP1VRID,HLP6VRID
          GOTO      GTXCON99 IF NOT EQUAL
.
          MATCH     HLP1CNT1,HLP6CNT1
          GOTO      GTXCON99 IF NOT EQUAL
.
          PACK      KEY82,HLP6RSID,HLP6VRID,HLP6CNT1,HLP6CNT2,SP70
          CALL      RDHLP6A1
          IF        OVRCD=1
            CALL      CLHL7P6A
          ENDIF
.
          PACK      KEY82,HLP6RSID,HLP6VRID,HLP6CNT1,HLP6CNT2,SP70
          CALL      RDHLP6B1
          IF        OVRCD=1
            CALL      CLHL7P6B
          ENDIF
.
          CALL      CPPMCE00
.
          MOVE      PURNO,PMCEX001
          MOVE      HLP6RCOD,PMCEX002
.
          CALL      CLPMSCEX
.
          CALL      CONC0000
.
          PACK      KEY14,PMCEX001,PMCEX002,PMCEX003,SP70
          CALL      RAPMCEX1
          COMPARE   ZERO,OVRCD
          GOTO      GTXCON90 IF EQUAL
.
          MOVE      PURNO,PMCEURNO
          MOVE      HLP6RCOD,PMCETYPE
          MOVE      HLP6NPRE,PMCETITL
          MOVE      HLP6NFAM,PMCESNAM
          MOVE      HLP6NGIV,PMCEGNAM
          MOVE      HL6AALN1,PMCEADD1 
          MOVE      HL6AALN2,PMCEADD2
          MOVE      HL6AALN3,PMCEADD3
          MOVE      HL6AALN4,PMCEADD4
          MOVE      HL6AAPOS,PMCEPOST
.
          MATCH     "PHONE",HL6ATSYS
          IF        @EQUAL
            MATCH     SP70,HL6ATUSE
            IF        @EQUAL
              MOVE      HL6ATVAL,PMCETELP
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSY2
          IF        @EQUAL
            MATCH     SP70,HL6ATUS2
            IF        @EQUAL
              MOVE      HL6ATVA2,PMCETELP
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSY3
          IF        @EQUAL
            MATCH     SP70,HL6ATUS3
            IF        @EQUAL
              MOVE      HL6ATVA3,PMCETELP
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSYS
          IF        @EQUAL
            MATCH     "HOME",HL6ATUSE
            IF        @EQUAL
              MOVE      HL6ATVAL,PMCETELP
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSY2
          IF        @EQUAL
            MATCH     "HOME",HL6ATUS2
            IF        @EQUAL
              MOVE      HL6ATVA2,PMCETELP
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSY3
          IF        @EQUAL
            MATCH     "HOME",HL6ATUS3
            IF        @EQUAL
              MOVE      HL6ATVA3,PMCETELP
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSYS
          IF        @EQUAL
            MATCH     "WORK",HL6ATUSE
            IF        @EQUAL
              MOVE      HL6ATVAL,PMCETELB
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSY2
          IF        @EQUAL
            MATCH     "WORK",HL6ATUS2
            IF        @EQUAL
              MOVE      HL6ATVA2,PMCETELB
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSY3
          IF        @EQUAL
            MATCH     "WORK",HL6ATUS3
            IF        @EQUAL
              MOVE      HL6ATVA3,PMCETELB
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSYS
          IF        @EQUAL
            MATCH     "MOBILE",HL6ATUSE
            IF        @EQUAL
              MOVE      HL6ATVAL,PMCETELM
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSY2
          IF        @EQUAL
            MATCH     "MOBILE",HL6ATUS2
            IF        @EQUAL
              MOVE      HL6ATVA2,PMCETELM
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSY3
          IF        @EQUAL
            MATCH     "MOBILE",HL6ATUS3
            IF        @EQUAL
              MOVE      HL6ATVA3,PMCETELM
            ENDIF
          ENDIF
.
          MOVE      HLP6RCO2,PMCERELP
.
          MATCH     "EMAIL",HL6ATSYS
          IF        @EQUAL
            MOVE      HL6ATVAL,PMCEEMAI
          ENDIF
.
          MATCH     "EMAIL",HL6ATSY2
          IF        @EQUAL
            MOVE      HL6ATVA2,PMCEEMAI
          ENDIF
.
          MATCH     "EMAIL",HL6ATSY3
          IF        @EQUAL
            MOVE      HL6ATVA3,PMCEEMAI
          ENDIF
.
          CALL      IBACLOCK
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,PMCECDAT  
          CLOCK     TIME,PMCECTIM 
.
          PACK      KEY14,PMCEX001,PMCEX002,PMCEX003,SP70
          CALL      RAPMCEX1
          IF        OVRCD=1
            CALL      WRPMCEX1
          ENDIF 
.
GTXCON90  GOTO      GTXCON10
.
GTXCON99  RETURN
.
.------------------------------------------------------------
. Add Concession Cards to pmsccdaf from hl7fp2af
.------------------------------------------------------------
GTCONC00  PACK      KEY82,HLP1RSID,HLP1VRID,HLP1CNT1,SP70
          CALL      RSHLFP21
GTCONC10  CALL      RKHLFP21
          BRANCH    OVRCD,GTCONC99
.
          MATCH     HLP1RSID,HLP2RSID
          GOTO      GTCONC99 IF NOT EQUAL
.
          MATCH     HLP1VRID,HLP2VRID
          GOTO      GTCONC99 IF NOT EQUAL
.
          MATCH     HLP1CNT1,HLP2CNT1
          GOTO      GTCONC99 IF NOT EQUAL
.
          CALL      CPMCCD00
.
          SCAN     "dva",HLP2SYST
          IF       @EQUAL
.
            MOVE      PURNO,PMCDURNO
.
            PACK      KEY5,ANSLC,ANSLT,SP70                        
            CALL      RDSCODE1
GTCONC20    CALL      RDKCODE1
            BRANCH    OVRCD,GTCONC90 
.
            MATCH     "ct",TCODE
            GOTO      GTCONC90 IF NOT EQUAL
.
            MATCH     "3",TCINDC1
            GOTO      GTCONC20 IF NOT EQUAL
.
            MOVE      ACODE,PMCDCTYP
.
            MOVE      HLP2IDVA,PMCDCNUM        
            MOVE      HLP2PEND,PMCDEXDT
            
.
            CALL      IBACLOCK
            PACK      KEY8,CCC,CYY,CMM,CDD
            REP       " 0",KEY8
            MOVE      KEY8,PMCDCDAT 
            CLOCK     TIME,PMCDCTIM
.
            PACK     KEY5,ANSD,ANSX,HLP2IDCD,SP70
            CALL     RDCODE1
            IF       OVRCD=0
              MOVE     HLP2IDCD,PMCDDVAC
            ELSE
.
              PACK     KEY5,ANSD,ANSX,SP70
              CALL     RDSCODE1
GTCONC30      CALL     RDKCODE1
              BRANCH   OVRCD,GTCONC90
.
              MATCH    "DX",TCODE
              GOTO     GTCONC90 IF NOT EQUAL
.
              MATCH    "DVG",HLP2IDCD
              IF       @EQUAL
                MATCH    "G",THCSCOD
                IF       @EQUAL
                  MOVE     ACODE,PMCDDVAC
                  GOTO     GTCONC40
                ENDIF
              ENDIF
.
              MATCH    "DVW",HLP2IDCD
              IF       @EQUAL
                MATCH    "W",THCSCOD
                IF       @EQUAL
                  MOVE     ACODE,PMCDDVAC
                  GOTO     GTCONC40
                ENDIF
              ENDIF
.
              MATCH    "DVO",HLP2IDCD
              IF       @EQUAL
                MATCH    "O",THCSCOD
                IF       @EQUAL
                  MOVE     ACODE,PMCDDVAC
                  GOTO     GTCONC40
                ENDIF
              ENDIF
.
              GOTO     GTCONC30
.
            ENDIF
.
GTCONC40    PACK      KEY19,PMCDURNO,PMCDEXDT,PMCDCTYP,SP70
            CALL      RAPMCCD1
            IF        OVRCD=1
              CALL      WRPMCCD1
.
              MOVE      "A",UPDTTYPE
              MOVE      SP70,OLDCCDDT
              MOVE      SP70,OLDCOLOR
              CALL      ADUPDAUD 
            ENDIF            
.

.
            GOTO      GTCONC90
.
          ENDIF
.
          SCAN    "centrelink-customer-reference-number",HLP2SYST
          IF       @EQUAL
.
            MATCH     "PEN",HLP2IDCD
            IF        @EQUAL
.
              MOVE      PURNO,PMCDURNO
.
              PACK      KEY5,ANSLC,ANSLT,SP70
              CALL      RDSCODE1
GTCONC50      CALL      RDKCODE1
              BRANCH    OVRCD,GTCONC90
.
              MATCH     "ct",TCODE
              GOTO      GTCONC90 IF NOT EQUAL
.
              MATCH     "4",TCINDC1
              GOTO      GTCONC50 IF NOT EQUAL
.
              MOVE      ACODE,PMCDCTYP
.
              MOVE      HLP2IDVA,PMCDCNUM
              MOVE      HLP2PEND,PMCDEXDT
.
              PACK      KEY19,PMCDURNO,PMCDEXDT,PMCDCTYP,SP70
              CALL      RAPMCCD1
              IF        OVRCD=1
                CALL      WRPMCCD1
              ENDIF
.
              MOVE      "A",UPDTTYPE
              MOVE      SP70,OLDCCDDT
              MOVE      SP70,OLDCOLOR
              CALL      ADUPDAUD
.
              GOTO      GTCONC90
.
            ENDIF
.
            MATCH     "SEN",HLP2IDCD
            IF        @EQUAL
.
              MOVE      PURNO,PMCDURNO
.
              PACK      KEY5,ANSLC,ANSLT,SP70
              CALL      RDSCODE1
GTCONC70      CALL      RDKCODE1
              BRANCH    OVRCD,GTCONC90
.
              MATCH     "ct",TCODE
              GOTO      GTCONC90 IF NOT EQUAL
.
              MATCH     "5",TCINDC1
              GOTO      GTCONC70 IF NOT EQUAL
.
              MOVE      ACODE,PMCDCTYP
.
              MOVE      HLP2IDVA,PMCDCNUM
              MOVE      HLP2PEND,PMCDEXDT
.
              PACK      KEY19,PMCDURNO,PMCDEXDT,PMCDCTYP,SP70
              CALL      RAPMCCD1
              IF        OVRCD=1
                CALL      WRPMCCD1
              ENDIF
.
              MOVE      "A",UPDTTYPE
              MOVE      SP70,OLDCCDDT
              MOVE      SP70,OLDCOLOR
              CALL      ADUPDAUD
.
              GOTO      GTCONC90
.
            ENDIF
.

.
            GOTO      GTCONC90
.
          ENDIF
.

.
GTCONC90  GOTO      GTCONC10
.
GTCONC99  RETURN
.
.------------------------------------------------------------
. Clear Concession Card Variables 
.------------------------------------------------------------
CPMCCD00  MOVE      SP70,PMCDURNO
          MOVE      SP70,PMCDCTYP 
          MOVE      SP70,PMCDCNUM 
          MOVE      SP70,PMCDEXDT 
          MOVE      SP70,PMCDCDAT 
          MOVE      SP70,PMCDCTIM 
          MOVE      SP70,PMCDCUID 
          MOVE      SP70,PMCDUDAT 
          MOVE      SP70,PMCDUTIM 
          MOVE      SP70,PMCDUUID 
          MOVE      SP70,PMCDDVAC 
          MOVE      SP70,PMCDSPAR 
.
CPMCCD99  RETURN
.
.------------------------------------------------------------
. Add Update Record to Audit File (PATCCHFD)
.------------------------------------------------------------
ADUPDAUD  COMPARE   ONE,AUDTATRB
          GOTO      ADUPDA99 IF EQUAL
.
          CALL      CLPATCCH
          PACK      PTCCURNO,PURNO,SP70
          PACK      PTCCCTYP,PMCDCTYP,SP70       * Card Type (cat ct)
          PACK      PTCCCNUM,PMCDCNUM,SP70       * Card Number
          PACK      PTCCEXDT,PMCDEXDT,SP70       * Card Expiry Date
          PACK      PTCCDVAC,PMCDDVAC,SP70       * DVA card colour
          PACK      PTCCUPDT,UPDTTYPE            * Update Type
          PACK      PTCCUPDR,SP70                * Update Reason
          MOVE      "FHRWEB01",PTCCURID 
          PACK      PTCCPEXD,OLDCCDDT,SP70       * Previous Expiry Date
          PACK      PTCCPCDC,OLDCOLOR,SP70       * Previous DAV card Colour
.
          CALL      IBACLOCK
          PACK      PTCCDATE,CCC,CYY,CMM,CDD        * Date
          REP       " 0",PTCCDATE
          MOVE      CTIMEIS,PTCCTIME

ADUPDA10  PACK      KEY35,PTCCURNO,PTCCEXDT,PTCCCTYP,PTCCDATE,PTCCTIME,SP70
          CALL      RDPTCCH1
          IF        OVRCD=1
            CALL      WRPTCCH1
            GOTO      ADUPDA99
          ELSE
            CALL      IBACLOCK                    * Set new date and time and
            PACK      PTCCDATE,CCC,CYY,CMM,CDD    * try write again
            REP       " 0",PTCCDATE
            CLOCK     TIME,CTIMEIS
            PACK      PTCCTIME,CTIMEIS
            REP       " 0",PTCCTIME
            GOTO      ADUPDA10
          ENDIF
          GOTO        ADUPDA99
.
ADUPDA99  RETURN
.
.------------------------------------------------------------
. Add Aliases to patgsraf from hl7fp7af
.------------------------------------------------------------
GTALIA00  PACK      KEY82,HLP1RSID,HLP1VRID,HLP1CNT1,SP70
          CALL      RSHLFP71
GTALIA10  CALL      RKHLFP71
          BRANCH    OVRCD,GTALIA99
.
          MATCH     HLP1RSID,HLP7RSID
          GOTO      GTALIA99 IF NOT EQUAL
.
          MATCH     HLP1VRID,HLP7VRID
          GOTO      GTALIA99 IF NOT EQUAL
.
          MATCH     HLP1CNT1,HLP7CNT1
          GOTO      GTALIA99 IF NOT EQUAL
.
.         MATCH     "OFFICIAL",HLP7NUSE
.         IF        @EQUAL
.           MOVE      HLP7NPR1,PTITL
.           MOVE      HLP7NFAM,PSNAME
.           MOVE      HLP7NFAM,PTMASNAM
.           MOVE      HLP7NGV1,PGNAME
.           MOVE      HLP7NGV1,PMPXFNAM
.           MOVE      HLP7NGV2,PMPXSNAM
.         ENDIF
.
.         MATCH     "USUAL",HLP7NUSE
.         IF        @EQUAL
.           MOVE      HLP7NFAM,PMPXPFSN
.           MOVE      HLP7NGV1,PMPXPFGN
.         ENDIF
.
.         MATCH     "MAIDEN",HLP7NUSE
.         IF        @EQUAL
.           MOVE      HLP7NFAM,PMPXMAID
.         ENDIF
.
          MATCH     "NICKNAME",HLP7NUSE
          IF        @EQUAL
            CALL      WRALI000
          ENDIF
.
          MATCH     "TEMP",HLP7NUSE
          IF        @EQUAL
            CALL      WRALI000
          ENDIF
.
          MATCH     "ANONYMOUS",HLP7NUSE
          IF        @EQUAL
            CALL      WRALI000
          ENDIF
.
          MATCH     "OLD",HLP7NUSE
          IF        @EQUAL
            CALL      WRALI000
          ENDIF
.
          GOTO      GTALIA10
.
GTALIA99  RETURN
.------------------------------------------------------------
. Update Patient Master
.------------------------------------------------------------
UPDMAS00  CALL      CLPATMAS
          CALL      CLPMSPX2
.
          PACK      SAVKEY79,HLP1STAT,HLP1RSID,HLP1VRID,HLP1CNT1,SP70
.
          PACK      KEY78,HLP1RSID,SP9,ONE,SP3,ONE,SP70
          CALL      RDHLFP11
          IF        OVRCD=1
            MOVE      "1",ERRORIND
            MOVE      "Error: Could not find create record in hl7fp1af.",HLP1PRDS
            GOTO      UPDMAS99
          ENDIF
.
          MATCH     SP70,HLP1URNO
          IF       @EQUAL
            MOVE      "1",ERRORIND
            MOVE      "Error: HLP1URNO is blank.",HLP1PRDS
            GOTO      UPDMAS99
          ENDIF
.
          CALL      CLPATMAS
          CALL      CLPMSPX2
.
          PACK      KEY8,HLP1URNO,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            MOVE      "1",ERRORIND
            MOVE      "Error: Could not read patma1af.",HLP1PRDS
            GOTO      UPDMAS99
          ENDIF 
.
          PACK      KEY8,HLP1URNO,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            MOVE      "1",ERRORIND
            MOVE      "Error: Could not read pmspx2af.",HLP1PRDS
            GOTO      UPDMAS99
          ENDIF
.
          MOVE      SAVKEY79,KEY79
          CALL      RDHLFP14
          IF        OVRCD=1
            MOVE      "1",ERRORIND
            MOVE      "Error: Update SAVKEY79 re-read failed.",HLP1PRDS
            GOTO      UPDMAS99
          ENDIF
.
          MOVE      PURNO,HLP1URNO
.
          CALL      GTPAGE00
          CALL      GTGEND00
          CALL      GTMARS00
          CALL      GTADDR00
          CALL      GTTELC00
          CALL      GTEXTN00
          CALL      GTIDEN00
          CALL      GTDECE00
          CALL      GTCONT00
          CALL      GTPVAR00
          CALL      GTCOMM00
          CALL      GTNAME00
.
          CALL      UPDUR
          IF        EXIT=1
            MOVE      "1",ERRORIND
            MOVE      "Error: Update UR failed.",HLP1PRDS
            GOTO      UPDMAS99
          ENDIF
.
          CALL      UPCONC00
          CALL      UPXCON00
          CALL      GTALIA00
          CALL      WRUPDD00
.
UPDMAS99  RETURN
.
.------------------------------------------------------------
. Update Concession Cards to pmsccdaf from hl7fp2af
.------------------------------------------------------------
UPCONC00  PACK      KEY82,HLP1RSID,HLP1VRID,HLP1CNT1,SP70
          CALL      RSHLFP21
UPCONC10  CALL      RKHLFP21
          BRANCH    OVRCD,UPCONC99
.
          MATCH     HLP1RSID,HLP2RSID
          GOTO      UPCONC99 IF NOT EQUAL
.
          MATCH     HLP1VRID,HLP2VRID
          GOTO      UPCONC99 IF NOT EQUAL
.
          MATCH     HLP1CNT1,HLP2CNT1
          GOTO      UPCONC99 IF NOT EQUAL
.
          CALL      CPMCCD00
.
          SCAN     "dva",HLP2SYST
          IF       @EQUAL
.
            MOVE      PURNO,PMCDURNO
.
            PACK      KEY5,ANSLC,ANSLT,SP70
            CALL      RDSCODE1
UPCONC20    CALL      RDKCODE1
            BRANCH    OVRCD,UPCONC90
.
            MATCH     "ct",TCODE
            GOTO      UPCONC90 IF NOT EQUAL
.
            MATCH     "3",TCINDC1
            GOTO      UPCONC20 IF NOT EQUAL
.
            MOVE      SP70,SAVKEY19
            MOVE      SP70,OLDCCDDT
            MOVE      SP70,OLDCOLOR
.
            PACK      KEY19,PURNO,SP70
            CALL      RSPMCCD1 
UPCONC22    CALL      RKPMCCD1
            BRANCH    OVRCD,UPCONC25 
.
            MATCH     PURNO,PMCDURNO
            GOTO      UPCONC25 IF NOT EQUAL
.
            MATCH     ACODE,PMCDCTYP
            GOTO      UPCONC22 IF NOT EQUAL
.
            PACK      SAVKEY19,PMCDURNO,PMCDEXDT,PMCDCTYP,SP70     
            MOVE      PMCDEXDT,OLDCCDDT
            MOVE      PMCDDVAC,OLDCOLOR
.
UPCONC25    CALL      CPMCCD00
            MOVE      PURNO,PMCDURNO
.
            MOVE      ACODE,PMCDCTYP
.
            MOVE      HLP2IDVA,PMCDCNUM
            MOVE      HLP2PEND,PMCDEXDT

.
            CALL      IBACLOCK
            PACK      KEY8,CCC,CYY,CMM,CDD
            REP       " 0",KEY8
            MOVE      KEY8,PMCDCDAT
            CLOCK     TIME,PMCDCTIM
.
            PACK     KEY5,ANSD,ANSX,HLP2IDCD,SP70
            CALL     RDCODE1
            IF       OVRCD=0
              MOVE     HLP2IDCD,PMCDDVAC
            ELSE
.
              PACK     KEY5,ANSD,ANSX,SP70
              CALL     RDSCODE1
UPCONC30      CALL     RDKCODE1
              BRANCH   OVRCD,UPCONC90
.
              MATCH    "DX",TCODE
              GOTO     UPCONC90 IF NOT EQUAL
.
              MATCH    "DVG",HLP2IDCD
              IF       @EQUAL
                MATCH    "G",THCSCOD
                IF       @EQUAL
                  MOVE     ACODE,PMCDDVAC
                  GOTO     UPCONC40
                ENDIF
              ENDIF
.
              MATCH    "DVW",HLP2IDCD
              IF       @EQUAL
                MATCH    "W",THCSCOD
                IF       @EQUAL
                  MOVE     ACODE,PMCDDVAC
                  GOTO     UPCONC40
                ENDIF
              ENDIF
.
              MATCH    "DVO",HLP2IDCD
              IF       @EQUAL
                MATCH    "O",THCSCOD
                IF       @EQUAL
                  MOVE     ACODE,PMCDDVAC
                  GOTO     UPCONC40
                ENDIF
              ENDIF
.
              GOTO     UPCONC30
.
            ENDIF
.
UPCONC40    MATCH     SP70,SAVKEY19
            IF        !@EQUAL
              MOVE      SAVKEY19,KEY19
              CALL      DEPMCCD1
            ENDIF
.
            PACK      KEY19,PMCDURNO,PMCDEXDT,PMCDCTYP,SP70
            CALL      RAPMCCD1
            IF        OVRCD=1
              CALL      WRPMCCD1
.
              MOVE      "U",UPDTTYPE
              CALL      ADUPDAUD
            ENDIF
.

.
            GOTO      UPCONC90
.
          ENDIF
.
          SCAN    "centrelink-customer-reference-number",HLP2SYST
          IF       @EQUAL
.
            MATCH     "PEN",HLP2IDCD
            IF        @EQUAL
.
              MOVE      PURNO,PMCDURNO
.
              PACK      KEY5,ANSLC,ANSLT,SP70
              CALL      RDSCODE1
UPCONC50      CALL      RDKCODE1
              BRANCH    OVRCD,UPCONC90
.
              MATCH     "ct",TCODE
              GOTO      UPCONC90 IF NOT EQUAL
.
              MATCH     "4",TCINDC1
              GOTO      UPCONC50 IF NOT EQUAL
.
              MOVE      SP70,SAVKEY19
              MOVE      SP70,OLDCCDDT
              MOVE      SP70,OLDCOLOR
.
              PACK      KEY19,PURNO,SP70
              CALL      RSPMCCD1
UPCONC52      CALL      RKPMCCD1
              BRANCH    OVRCD,UPCONC55
.
              MATCH     PURNO,PMCDURNO
              GOTO      UPCONC55 IF NOT EQUAL
.
              MATCH     ACODE,PMCDCTYP
              GOTO      UPCONC52 IF NOT EQUAL
.
              PACK      SAVKEY19,PMCDURNO,PMCDEXDT,PMCDCTYP,SP70
              MOVE      PMCDEXDT,OLDCCDDT
              MOVE      PMCDDVAC,OLDCOLOR
.
UPCONC55      CALL      CPMCCD00
              MOVE      PURNO,PMCDURNO
.
              MOVE      ACODE,PMCDCTYP
.
              MOVE      HLP2IDVA,PMCDCNUM
              MOVE      HLP2PEND,PMCDEXDT
.
              MATCH     SP70,SAVKEY19
              IF        !@EQUAL
                MOVE      SAVKEY19,KEY19
                CALL      DEPMCCD1
              ENDIF
.
              PACK      KEY19,PMCDURNO,PMCDEXDT,PMCDCTYP,SP70
              CALL      RAPMCCD1
              IF        OVRCD=1
                CALL      WRPMCCD1
              ENDIF
.
              MOVE      "U",UPDTTYPE
              CALL      ADUPDAUD
.
              GOTO      UPCONC90
.
            ENDIF
.
            MATCH     "SEN",HLP2IDCD
            IF        @EQUAL
.
              MOVE      PURNO,PMCDURNO
.
              PACK      KEY5,ANSLC,ANSLT,SP70
              CALL      RDSCODE1
UPCONC70      CALL      RDKCODE1
              BRANCH    OVRCD,UPCONC90
.
              MATCH     "ct",TCODE
              GOTO      UPCONC90 IF NOT EQUAL
.
              MATCH     "5",TCINDC1
              GOTO      UPCONC70 IF NOT EQUAL
.
              MOVE      SP70,SAVKEY19
              MOVE      SP70,OLDCCDDT
              MOVE      SP70,OLDCOLOR
.
              PACK      KEY19,PURNO,SP70
              CALL      RSPMCCD1
UPCONC72      CALL      RKPMCCD1
              BRANCH    OVRCD,UPCONC75
.
              MATCH     PURNO,PMCDURNO
              GOTO      UPCONC75 IF NOT EQUAL
.
              MATCH     ACODE,PMCDCTYP
              GOTO      UPCONC72 IF NOT EQUAL
.
              PACK      SAVKEY19,PMCDURNO,PMCDEXDT,PMCDCTYP,SP70
              MOVE      PMCDEXDT,OLDCCDDT
              MOVE      PMCDDVAC,OLDCOLOR
.
UPCONC75      CALL      CPMCCD00
              MOVE      PURNO,PMCDURNO
.
              MOVE      ACODE,PMCDCTYP
.
              MOVE      HLP2IDVA,PMCDCNUM
              MOVE      HLP2PEND,PMCDEXDT
.
              MATCH     SP70,SAVKEY19
              IF        !@EQUAL
                MOVE      SAVKEY19,KEY19
                CALL      DEPMCCD1
              ENDIF
.
              PACK      KEY19,PMCDURNO,PMCDEXDT,PMCDCTYP,SP70
              CALL      RAPMCCD1
              IF        OVRCD=1
                CALL      WRPMCCD1
              ENDIF
.
              MOVE      "U",UPDTTYPE
              CALL      ADUPDAUD
.
              GOTO      UPCONC90
.
            ENDIF
.

.
            GOTO      UPCONC90
.
          ENDIF
.

.
UPCONC90  GOTO      UPCONC10
.
UPCONC99  RETURN
.
.---------------------------------------------------------------
. Update Extra Contacts to pmscexaf from hl7fp6af
.---------------------------------------------------------------
UPXCON00  PACK      KEY82,HLP1RSID,HLP1VRID,HLP1CNT1,SP70
          CALL      RSHLFP61
UPXCON10  CALL      RKHLFP61
          BRANCH    OVRCD,UPXCON99
.
          MATCH     HLP1RSID,HLP6RSID
          GOTO      UPXCON99 IF NOT EQUAL
.
          MATCH     HLP1VRID,HLP6VRID
          GOTO      UPXCON99 IF NOT EQUAL
.
          MATCH     HLP1CNT1,HLP6CNT1
          GOTO      UPXCON99 IF NOT EQUAL
.
          PACK      KEY82,HLP6RSID,HLP6VRID,HLP6CNT1,HLP6CNT2,SP70
          CALL      RDHLP6A1
          IF        OVRCD=1
            CALL      CLHL7P6A
          ENDIF
.
          PACK      KEY82,HLP6RSID,HLP6VRID,HLP6CNT1,HLP6CNT2,SP70
          CALL      RDHLP6B1
          IF        OVRCD=1
            CALL      CLHL7P6B
          ENDIF
.
          CALL      CPPMCE00
.
          MOVE      PURNO,PMCEX001
          MOVE      HLP6RCOD,PMCEX002
.
          PACK      KEY14,PMCEX001,PMCEX002,SP70
          CALL      RSPMCEX1
UPXCON20  CALL      RKPMCEX1
          BRANCH    OVRCD,UPXCON50
.
          MATCH     PMCEX001,PMCEURNO
          GOTO      UPXCON50 IF NOT EQUAL
.
          MATCH     PMCEX002,PMCETYPE
          GOTO      UPXCON50 IF NOT EQUAL
.
          MATCH     HLP6NFAM,PMCESNAM
          IF        @EQUAL
            MATCH     HLP6NGIV,PMCEGNAM 
            GOTO      UPXCON30 IF EQUAL
          ENDIF
.
          GOTO      UPXCON20
.
UPXCON30  MOVE      HLP6NPRE,PMCETITL
          MOVE      HLP6NFAM,PMCESNAM
          MOVE      HLP6NGIV,PMCEGNAM
          MOVE      HL6AALN1,PMCEADD1
          MOVE      HL6AALN2,PMCEADD2
          MOVE      HL6AALN3,PMCEADD3
          MOVE      HL6AALN4,PMCEADD4
          MOVE      HL6AAPOS,PMCEPOST
.
          MATCH     "PHONE",HL6ATSYS
          IF        @EQUAL
            MATCH     SP70,HL6ATUSE
            IF        @EQUAL
              MOVE      HL6ATVAL,PMCETELP
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSY2
          IF        @EQUAL
            MATCH     SP70,HL6ATUS2
            IF        @EQUAL
              MOVE      HL6ATVA2,PMCETELP
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSY3
          IF        @EQUAL
            MATCH     SP70,HL6ATUS3
            IF        @EQUAL
              MOVE      HL6ATVA3,PMCETELP
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSYS
          IF        @EQUAL
            MATCH     "HOME",HL6ATUSE
            IF        @EQUAL
              MOVE      HL6ATVAL,PMCETELP
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSY2
          IF        @EQUAL
            MATCH     "HOME",HL6ATUS2
            IF        @EQUAL
              MOVE      HL6ATVA2,PMCETELP
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSY3
          IF        @EQUAL
            MATCH     "HOME",HL6ATUS3
            IF        @EQUAL
              MOVE      HL6ATVA3,PMCETELP
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSYS
          IF        @EQUAL
            MATCH     "WORK",HL6ATUSE
            IF        @EQUAL
              MOVE      HL6ATVAL,PMCETELB
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSY2
          IF        @EQUAL
            MATCH     "WORK",HL6ATUS2
            IF        @EQUAL
              MOVE      HL6ATVA2,PMCETELB
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSY3
          IF        @EQUAL
            MATCH     "WORK",HL6ATUS3
            IF        @EQUAL
              MOVE      HL6ATVA3,PMCETELB
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSYS
          IF        @EQUAL
            MATCH     "MOBILE",HL6ATUSE
            IF        @EQUAL
              MOVE      HL6ATVAL,PMCETELM
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSY2
          IF        @EQUAL
            MATCH     "MOBILE",HL6ATUS2
            IF        @EQUAL
              MOVE      HL6ATVA2,PMCETELM
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSY3
          IF        @EQUAL
            MATCH     "MOBILE",HL6ATUS3
            IF        @EQUAL
              MOVE      HL6ATVA3,PMCETELM
            ENDIF
          ENDIF
.
          MOVE      HLP6RCO2,PMCERELP
.
          MATCH     "EMAIL",HL6ATSYS
          IF        @EQUAL
            MOVE      HL6ATVAL,PMCEEMAI
          ENDIF
.
          MATCH     "EMAIL",HL6ATSY2
          IF        @EQUAL
            MOVE      HL6ATVA2,PMCEEMAI
          ENDIF
.
          MATCH     "EMAIL",HL6ATSY3
          IF        @EQUAL
            MOVE      HL6ATVA3,PMCEEMAI
          ENDIF
.
          CALL      IBACLOCK
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,PMCEUDAT
          CLOCK     TIME,PMCEUTIM
.
          PACK      KEY14,PMCEURNO,PMCETYPE,PMCECNTR,SP70
          CALL      RAPMCEX1
          IF        OVRCD=0
            CALL      UPPMCEX1
          ENDIF
.
          GOTO      UPXCON90
.
UPXCON50  CALL      CLPMSCEX
.
          CALL      CONC0000
.
          PACK      KEY14,PMCEX001,PMCEX002,PMCEX003,SP70
          CALL      RAPMCEX1
          COMPARE   ZERO,OVRCD
          GOTO      UPXCON90 IF EQUAL
.
          MOVE      PURNO,PMCEURNO
          MOVE      HLP6RCOD,PMCETYPE
          MOVE      PMCEX003,PMCECNTR
          MOVE      HLP6NPRE,PMCETITL
          MOVE      HLP6NFAM,PMCESNAM
          MOVE      HLP6NGIV,PMCEGNAM
          MOVE      HL6AALN1,PMCEADD1
          MOVE      HL6AALN2,PMCEADD2
          MOVE      HL6AALN3,PMCEADD3
          MOVE      HL6AALN4,PMCEADD4
          MOVE      HL6AAPOS,PMCEPOST
.
          MATCH     "PHONE",HL6ATSYS
          IF        @EQUAL
            MATCH     SP70,HL6ATUSE
            IF        @EQUAL
              MOVE      HL6ATVAL,PMCETELP
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSY2
          IF        @EQUAL
            MATCH     SP70,HL6ATUS2
            IF        @EQUAL
              MOVE      HL6ATVA2,PMCETELP
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSY3
          IF        @EQUAL
            MATCH     SP70,HL6ATUS3
            IF        @EQUAL
              MOVE      HL6ATVA3,PMCETELP
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSYS
          IF        @EQUAL
            MATCH     "HOME",HL6ATUSE
            IF        @EQUAL
              MOVE      HL6ATVAL,PMCETELP
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSY2
          IF        @EQUAL
            MATCH     "HOME",HL6ATUS2
            IF        @EQUAL
              MOVE      HL6ATVA2,PMCETELP
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSY3
          IF        @EQUAL
            MATCH     "HOME",HL6ATUS3
            IF        @EQUAL
              MOVE      HL6ATVA3,PMCETELP
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSYS
          IF        @EQUAL
            MATCH     "WORK",HL6ATUSE
            IF        @EQUAL
              MOVE      HL6ATVAL,PMCETELB
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSY2
          IF        @EQUAL
            MATCH     "WORK",HL6ATUS2
            IF        @EQUAL
              MOVE      HL6ATVA2,PMCETELB
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSY3
          IF        @EQUAL
            MATCH     "WORK",HL6ATUS3
            IF        @EQUAL
              MOVE      HL6ATVA3,PMCETELB
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSYS
          IF        @EQUAL
            MATCH     "MOBILE",HL6ATUSE
            IF        @EQUAL
              MOVE      HL6ATVAL,PMCETELM
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSY2
          IF        @EQUAL
            MATCH     "MOBILE",HL6ATUS2
            IF        @EQUAL
              MOVE      HL6ATVA2,PMCETELM
            ENDIF
          ENDIF
.
          MATCH     "PHONE",HL6ATSY3
          IF        @EQUAL
            MATCH     "MOBILE",HL6ATUS3
            IF        @EQUAL
              MOVE      HL6ATVA3,PMCETELM
            ENDIF
          ENDIF
.
          MOVE      HLP6RCO2,PMCERELP
.
          MATCH     "EMAIL",HL6ATSYS
          IF        @EQUAL
            MOVE      HL6ATVAL,PMCEEMAI
          ENDIF
.
          MATCH     "EMAIL",HL6ATSY2
          IF        @EQUAL
            MOVE      HL6ATVA2,PMCEEMAI
          ENDIF
.
          MATCH     "EMAIL",HL6ATSY3
          IF        @EQUAL
            MOVE      HL6ATVA3,PMCEEMAI
          ENDIF
.
          CALL      IBACLOCK
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,PMCECDAT
          CLOCK     TIME,PMCECTIM
.
          PACK      KEY14,PMCEX001,PMCEX002,PMCEX003,SP70
          CALL      RAPMCEX1
          IF        OVRCD=1
            CALL      WRPMCEX1
          ENDIF
.
UPXCON90  GOTO      UPXCON10
.
UPXCON99  RETURN
.
.------------------------------------------------------------
. Write an update demographics record (pmsupdaf)
.------------------------------------------------------------
WRUPDD00  OPEN      PMSUPDA1,"pmsupdaf"
.
          PACK      PMUDURNO,PURNO,SP70
.
          CALL      IBACLOCK
          PACK      PMUDDATE,CCC,CYY,CMM,CDD
          REPLACE   " 0",PMUDDATE
          CLOCK     TIME,PMUDTIME
.
          MOVE      "FHRWEB01  ",PMUDUSER
.
          PACK      KEY8,PMUDURNO,SP70
          CALL      RDPMUPD1
          IF        OVRCD=1
            CALL      IBACLOCK
            PACK      PMUDDATC,CCC,CYY,CMM,CDD
            REPLACE   " 0",PMUDDATC
            CLOCK     TIME,PMUDTIMC
            MOVE      "FHRWEB01  ",PMUDWEBC
            CALL      WRPMUPD1
          ELSE
            CALL      IBACLOCK
            PACK      PMUDDATE,CCC,CYY,CMM,CDD
            REPLACE   " 0",PMUDDATE
            CLOCK     TIME,PMUDTIME
            CALL      UPPMUPD1
          ENDIF
.
          CLOSE     PMSUPDA1
.
WRUPDD99  RETURN
+
.---------------------------------------------------------------
. Clear Parameters (NOT USED REQUIRED FOR STANDARD WEB INCLUDES)
.---------------------------------------------------------------
CLRPAR00  RETURN 
.---------------------------------------------------------------
. Set Parameters   (NOT USED REQUIRED FOR STANDARD WEB INCLUDES)
.---------------------------------------------------------------
SETPAR00  RETURN
.---------------------------------------------------------------
. Process Fields   (NOT USED REQUIRED FOR STANDARD WEB INCLUDES)
.---------------------------------------------------------------
PROFLD00  RETURN
.------------------------------------------------------------
+
          INC       IBAWEBCD
.
          INC       CLPMSVX1
          INC       DXPATCOD
          INC       GCCARD00
          INC       GTIHINUM
          INC       NAMSTRCD
          INC       WEBDITEM
          INC       WEBBGRND
.
          INC       APSMASIO/INC
          INC       EMRCHMAN
          INC       EMRLPCIO/INC
          INC       EMRLOCIO/INC
          INC       EMRSITIO/INC
          INC       EMRVISIO/INC
          INC       EMRCLIIO/INC
          INC       EMRGRCIO/INC
          INC       EMRPROIO/INC                                       *I-50421
          INC       EMRUNKIO/INC
.
 
.
          INC       IBATMDIO/INC
          INC       MEHDLSIO/INC
          INC       NHIETHIO/INC
          INC       NHIMASIO/INC
          INC       PATGO1IO/INC
          INC       PMSHCPIO/INC
          INC       PMSHCGIO/INC
          INC       AAEDE1IO/INC    *****
          INC       PATALRIO/INC
          INC       PMSALNIO/INC
          INC       PMSRELIO/INC
          INC       PMSTLEIO/INC
          INC       PMSCEXTM
          INC       PMSHCPTM
          INC       PMSHCGTM 
          INC       AAESETLB        *****
          INC       OPRNURIO/INC
          INC       PRIITMIO/INC
          INC       PRIDTRIO/INC
          INC       PRIHREIO/INC
          INC       PATITMIO/INC                                       *I-50421
          INC       PATICOIO/INC                                       *I-50421
          INC       PATICDIO/INC                                       *I-50421
          INC       PATNIDIO/INC
          INC       PATVISIO/INC
          INC       PMSVX1IO/INC                                       *I-55214
          INC       PATDO1IO/INC
          INC       PATHSPIO/INC
          INC       PATIN1IO/INC
          INC       PMSCCDIO/INC
          INC       PMSCEXIO/INC
          INC       PMSIHIIO/INC
          INC       PMSMDTIO/INC
          INC       PMSMTXIO/INC
          INC       PMSUPDIO/INC
          INC       PMSPX2IO/INC
          INC       PATFN1IO/INC
          INC       PATMA1IO/INC
          INC       PATMI1IO/INC
          INC       PATRE1IO/INC
          INC       PATWC1IO/INC
          INC       PMSWX1IO/INC 
          INC       PATWMAIO/INC
          INC       PATWR1IO/INC
          INC       PATWVEIO/INC
          INC       PATVADIO/INC
.
          INC       PATATRIO/INC
          INC       MULBIR00
.
          INC       SCRPSTIO/INC
          INC       SCRSBGIO/INC
          INC       SCRSLTIO/INC
          INC       SCRMASIO/INC
.
          INC       HL7FP1IO/INC
          INC       HL7P1AIO/INC
          INC       HL7P1BIO/INC
          INC       HL7P1CIO/INC
          INC       HL7FP2IO/INC
          INC       HL7FP3IO/INC
          INC       HL7P3AIO/INC
          INC       HL7FP4IO/INC
          INC       HL7P4AIO/INC
          INC       HL7FP5IO/INC
          INC       HL7FP6IO/INC
          INC       HL7P6AIO/INC
          INC       HL7P6BIO/INC
          INC       HL7FP7IO/INC
          INC       HL7FP8IO/INC
          INC       HL7FP9IO/INC
          INC       HL7P1DIO/INC
.
          INC       EOCLNKIO/INC
          INC       EOCREFIO/INC
          INC       EMRISMIO/INC
          INC       EMRINCIO/INC
          INC       EMRWFMIO/INC
          INC       EMRVCDIO/INC
          INC       EMRMTXIO/INC
          INC       EMRVPRIO/INC
          INC       VISCMTIO/INC
          INC       VISCODIO/INC
          INC       VISMTXIO/INC
          INC       VISMDTIO/INC
          INC       VISXDCIO/INC
          INC       EMRMANIO/INC
          INC       OBSDETIO/INC                                       *I-54627
          INC       OBSMTXIO/INC
          INC       OBSMDTIO/INC
          INC       EMRDCMIO/INC   
          INC       EMRHISIO/INC 
          INC       EMRICDIO/INC 
          INC       PATHGPIO/INC
          INC       PATCCHIO/INC
.
          INC       BOKRC1IO/INC      
          INC       PATPA1IO/INC
          INC       PATPR1IO/INC
          INC       PATINVIO/INC
          INC       PATLOCIO/INC
          INC       PATGSRIO/INC
          INC       PATURAIO/INC
          INC       PATAM1IO/INC
          INC       PMSCURIO/INC
          INC       PMSDAUIO/INC
.
          INC       PATDOCTM
          INC       PATITMRD
.
          INC       PACADDRS
          INC       PATCOMN2
          INC       PMSCEXCD
          INC       CALCAGE
          INC       CALCYRS
          INC       AGECHK
          INC       UPDUR
          INC       PATDOCCD
          INC       CLPATMAS
          INC       CLPMSCEX
          INC       CLPMSHCP
          INC       CLPMSPX2
          INC       CLEMRVIS                                          *I-153218
          INC       CLPATVIS                                          *I-153218
          INC       CLPMSDAU
.
          INC       CLPATCCH
          INC       CLHL7FP1
          INC       CLHL7P1A
          INC       CLHL7P1B
          INC       CLHL7P1C
          INC       CLHL7FP2
          INC       CLHL7FP3
          INC       CLHL7P3A
          INC       CLHL7FP4
          INC       CLHL7P4A
          INC       CLHL7FP5
          INC       CLHL7FP6
          INC       CLHL7P6A
          INC       CLHL7P6B
          INC       CLHL7FP7
          INC       CLHL7FP8 
          INC       CLHL7FP9
          INC       CLHL7P1D
.
          INC       DGCLICUP
          INC       DEATHAUD
          INC       DAYOFWEK
          INC       SGCHKDIG
          INC       GETALTID
          INC       TFILENAM
.

.******************************************************************************
.* System         : Mental Health                                             *
.*                                                                            *
.* Include Name   : MHAUDDSC.PBL                                              *
.*                                                                            *
.* Function       : Maintain the MEH Discharge file audits.                   *
.*                                                                            *
.* Author         : Justin Coates                                             *
.*                                                                            *
.* Date Written   : 17/09/1991                                                *
.*                                                                            *
.* Index used     : MEHAUDDS,"mehaudds"                                       *
.*                                                                            *
.* Parameters     : MHCNAUDB      Audits being used; 1 = No; 0 = Yes          *
.*                  AUDIFLAG      which type of audit to do                   *
.*                     1 = 'ADD' audit                                        *
.*                     2 = 'BEFORE CHANGE' audit                              *
.*                     3 = 'AFTER CHANGE' audit                               *
.*                     4 = 'DELETE' audit                                     *
.*                     5 = delete 'before change' audit                       *
.*                                                                            *
.* Modifications  :                                                           *
.******************************************************************************
.
MHAUDDSC  BRANCH    MHCNAUDB,AUDDS999       * audits not on
.
          OPEN      MEHAUDS1,"mehauds1"
.
          COMPARE   FIVE,AUDIFLAG
          GOTO      AUDDS700 IF EQUAL       * delete before change audit
.
          COMPARE   THREE,AUDIFLAG
          GOTO      AUDDS200 IF EQUAL       * after change - leave date/time
.
.         get the current date and time
.
          CALL      IBACLOCK                * get date and time
          PACK      MHDSAUDD,CCC,CYY,CMM,CDD
          REP       " 0",MHDSAUDD           * date
          MOVE      CTIMEIS,MHDSAUDT        * time
.
AUDDS200  MOVE      PORT,MHDSAUDP           * port
          MOVE      AUDIFLAG,MHDSAUDR       * copy audit type
          REP       "1A2B3C4D",MHDSAUDR     * get the correct letter
          MOVE      ONE,MHDSAUDS            * set as not printed
          MOVE      PASSCODE,MHDSAUDO       * operator id
.
          PACK      KEY19,MHDSAUDD,MHDSAUDT,MHDSAUDP,MHDSAUDR
          CALL      AWMHDSC                 * write the audit
          GOTO      AUDDS900
.
.         delete the before change audit
.
AUDDS700  PACK      KEY19,MHDSAUDD,MHDSAUDT,MHDSAUDP,ANSB
          CALL      ADMHDSC                 * delete the audit
.
.         Close audit file
.
AUDDS900  CLOSE     MEHAUDS1
.
AUDDS999  RETURN
+

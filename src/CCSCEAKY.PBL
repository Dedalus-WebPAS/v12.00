.---------------------------------------------------------------------------
.   System    :   Clinical Costing System            
.   Include   :   CCSCEAKY
.   Routine   :   HCCEAA00 Casemix Extract Code
.   Return    :           
.-------------------------------------------------------------------------------
HCCEAA00
          MOVE      ZERO,CSCRSIZ
          IF        HTOP<3
            MOVE      "10",HTOP
            MOVE      "24",HBOT
            MOVE      "40",HLEF
            MOVE      "80",HRIG
          ENDIF
HCCEAA04
          CALL      GSCRN000
          BRANCH    EXIT,HCCEAA99
          MOVE      STDCOL00,STDCOL01
          ADD       " 5",STDCOL01
          DISPLAY   *PSTDCOL01:STDROW,*V2LON,*ULON,"Code"               
.
          MOVE      STDCOL01,STDCOL02
          ADD       " 5",STDCOL02
          DISPLAY   *PSTDCOL02:STDROW,*V2LON,*ULON,"Casemix Extract"    
.
          MOVE      STDCOL02,STDCOL03
          ADD       "36",STDCOL03
HCCEAA08
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          MOVE      SP70,CCEAEID 
          PACK      KEY4,CCEAEID,SP70                                           
.                                                                               
.                                                                               
          CALL      RSCCEA1 
HCCEAA10
          CALL      RKCCEA1 
          BRANCH    OVRCD,HCCEAA15
          PACK      KEY4,CCEAEID,SP70                                           
.                                                                               
.                                                                               
          BRANCH    CSEARCH,HCCEAA12
          CALL      HCCEAA60
          BRANCH    OVRCD,HCCEAA10
HCCEAA12
          ADD       ONE,XITEMNO
          ADD       ONE,STDROW
          STORE     KEY4,XITEMNO,ST1,ST2,ST3,ST4,ST5:                           
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          DISPLAY   *PSTDCOL00:STDROW,SP1,*V2LON,XITEMNO,DOT
          DISPLAY   *PSTDCOL01:STDROW,CCEAEID 
          DISPLAY   *PSTDCOL02:STDROW,CCEADES 
          COMPARE   MAXITEM,XITEMNO
          GOTO      HCCEAA10 IF NOT EQUAL
HCCEAA15
.                                                                               
          MOVE      ONE,DITEM
          MOVE      MINITEM,DROW
          ADD       ONE,DROW
          DISPLAY   *PSTDCOL00:DROW,*V2LON,*HON,SP1,DITEM,DOT
          CLIP
          FLUSH     HLEF,HTOP,HRIG,HBOT
.
HCCEAA20
          CALL      HSCRI000
          BRANCH    EXIT,HCCEAA30,HCCEAA35,HCCEAA40,HCCEAA45,HCCEAA04:
                              HCCEAA91,HCCEAA50
          GOTO      HCCEAA92
HCCEAA30
          CALL      RKCCEA1 
          BRANCH    OVRCD,HCCEAA85
          PACK      KEY4,CCEAEID,SP70                                           
.                                                                               
.                                                                               
          CALL      RPCCEA1 
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HCCEAA10
HCCEAA35
          MOVE      ST1,KEY4 
          CALL      RDCCEA1 
          CALL      RPCCEA1 
          BRANCH    OVRCD,HCCEAA85
          PACK      KEY4,CCEAEID,SP70                                           
.                                                                               
.                                                                               
.                                                                               
.                                                                               
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
HCCEAA36
          CALL      RPCCEA1 
          BRANCH    OVRCD,HCCEAA37
          PACK      KEY4,CCEAEID,SP70                                           
.                                                                               
.                                                                               
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HCCEAA36 IF NOT EQUAL
HCCEAA37
          MOVE      ZERO,XITEMNO
          GOTO      HCCEAA10
HCCEAA40
          MOVE      ST1,KEY4 
          CALL      RDCCEA1 
          CALL      RPCCEA1 
          BRANCH    OVRCD,HCCEAA85
          PACK      KEY4,CCEAEID,SP70                                           
.                                                                               
.                                                                               
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HCCEAA08
HCCEAA45
          CALL      RKCCEA1 
          BRANCH    OVRCD,HCCEAA85
          PACK      KEY4,CCEAEID,SP70                                           
.                                                                               
.                                                                               
          SUSPEND
          CLIP      1,1,CRIG,24
.
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      ZERO,XITEMNO
          PACK      KEY4,Z70                                                    
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
          CALL      RSCCEA1 
HCCEAA46
          CALL      RPCCEA1 
          BRANCH    OVRCD,HCCEAA47
          PACK      KEY4,CCEAEID,SP70                                           
.                                                                               
.                                                                               
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HCCEAA46 IF NOT EQUAL
HCCEAA47
          MOVE      ZERO,XITEMNO
          GOTO      HCCEAA10
HCCEAA50  COMPARE   ZERO,CSEARCH
          GOTO      HCCEAA55 IF EQUAL
          MOVE      ZERO,CSEARCH
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          ADD       ONE,STDROW
          UNPACK    SP70,SCHFLD01,SCHFLD02,SCHFLD03,SCHFLD04,SCHFLD05
          UNPACK    SP70,SCHFLD06,SCHFLD07,SCHFLD08,SCHFLD09,SCHFLD10
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          DISPLAY   *PSTDCOL00:STDROW,*V2LON,*HON,"Sch"
          KEYIN     *PSTDCOL01:STDROW,*V2LON,SCHFLD01
          RESET     SCHFLD01
          KEYIN     *PSTDCOL02:STDROW,*V2LON,SCHFLD02
          RESET     SCHFLD02
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HCCEAA08
HCCEAA55  MOVE      ONE,CSEARCH
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HCCEAA08
HCCEAA60  MOVE      ZERO,OVRCD
          MATCH     SP70,SCHFLD01
          GOTO      HCCEAA61 IF EQUAL
          MATCH     SCHFLD01,CCEAEID 
          GOTO      HCCEAA72 IF NOT EQUAL
HCCEAA61
          MATCH     SP70,SCHFLD02
          GOTO      HCCEAA62 IF EQUAL
          MATCH     SCHFLD02,CCEADES 
          GOTO      HCCEAA72 IF NOT EQUAL
HCCEAA62
HCCEAA63
HCCEAA64
HCCEAA65
HCCEAA66
HCCEAA67
HCCEAA68
HCCEAA69
HCCEAA70
          GOTO      HCCEAA75
HCCEAA72  MOVE      ONE,OVRCD
HCCEAA75  RETURN
HCCEAA85
          LOAD      KEY4,XITEMNO,ST1,ST2,ST3,ST4,ST5:                           
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY4,CCEAEID                                                
          CALL      RDCCEA1 
HCCEAA90
.                                                                               
          BEEP
          GOTO      HCCEAA20
HCCEAA91
          MOVE      SP70,CCEADES 
          MOVE      SP70,CCEAHCD 
          MOVE      SP70,CCEAFDD 
          MOVE      SP70,CCEATDD 
          MOVE      SP70,CCEAFAD 
          MOVE      SP70,CCEATAD 
          MOVE      SP70,CCEAINC 
          MOVE      SP70,CCEAVIS 
          MOVE      SP70,CCEADAY 
          MOVE      SP70,CCEAFCM 
          MOVE      SP70,CCEAFYR 
          MOVE      SP70,CCEATCM 
          MOVE      SP70,CCEATYR 
          MOVE      SP70,CCEARUA 
          MOVE      SP70,CCEALV1 
          MOVE      SP70,CCEALV2 
          MOVE      SP70,CCEALV3 
          MOVE      SP70,CCEAUST 
          MOVE      SP70,CCEAIMOD
          MOVE      SP70,CCEACMOD
          MOVE      SP70,CCEAITHE
          MOVE      SP70,CCEACTHE
          MOVE      SP70,CCEASPA 
          MOVE      SP70,KEY4 
          MOVE      SP70,CCEAEID 
          GOTO      HCCEAA96
HCCEAA92
          MOVE      SP70,KEY4 
          MOVE      SP70,CCEAEID 
          LOAD      KEY4,CCITEM,ST1,ST2,ST3,ST4,ST5:                            
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY4,CCEAEID                                                
HCCEAA96
          PUTSCR    CSSCRNUM,HLEF,HTOP,HRIG,HBOT
          CALL      FRESCR00
          MOVE      ZERO,HTOP
          MOVE      ZERO,HLEF
          MOVE      ZERO,HBOT
          MOVE      ZERO,HRIG
HCCEAA99
          RETURN
.---------------------------------------------------------------------------
.   System    :   Clinical Costing System            
.   Include   :   CCSCEAKY
.   Routine   :   KCCEAA00 Keyin Casemix Extract     
.   Parameter :   CKEYTYP 0 = Keyin , 1 = Accept, 2 = Either
.   Return    :   EXIT = 1 null entry, 2 EXITCHAR entered
.-------------------------------------------------------------------------------
KCCEAA00 TOPIC     "CCEAEID "
          MOVE      UNDLN70,CCEAEID 
          KEYIN     *PCCOL:CVERT,*DV,CCEAEID:                                   
                    *PCCOL:CVERT,*V2LON,*JR,*ZF,CCEAEID:                        
                    *PCCOL:CVERT,*DV,CCEAEID 
.
          ENDSET    CCEAEID 
          APPEND    SP70,CCEAEID 
          RESET     CCEAEID 
.
          MATCH     SP70,CCEAEID 
          GOTO      KCCEAA90 IF EQUAL
.
          ENDSET    CCEAEID 
          CMATCH    EXITCHAR,CCEAEID 
          GOTO      KCCEAA95 IF EQUAL
.
          CMATCH    QUEST,CCEAEID 
          GOTO      KCCEAA10 IF NOT EQUAL
.
          MOVE      CCITEM,SCCITEM
          CALL      HCCEAA00
          MOVE      SCCITEM,CCITEM
.
          ENDSET    CCEAEID 
          APPEND    SP70,CCEAEID 
          RESET     CCEAEID 
.
          MATCH     SP70,CCEAEID 
          GOTO      KCCEAA00 IF EQUAL
.
          DISPLAY   *PCCOL:CVERT,*V2LON,CCEAEID                                 
KCCEAA10
          RESET     CCEAEID 
          PACK      KEY4,CCEAEID                                                
          CALL      RACCEA1 
          BRANCH    OVRCD,KCCEAA80
          BRANCH    CKEYTYP,KCCEAA75
          CALL      RDCCEA1 
KCCEAA70
          MOVE      ZERO,EXIT
          GOTO      KCCEAA99
KCCEAA75
          MOVE      "Casemix Extract Already Exist - ",DISPMSG                                       
          CALL      MESSAGE1
          GOTO      KCCEAA00
KCCEAA80
          MOVE      ZERO,EXIT
          BRANCH    CKEYTYP,KCCEAA99,KCCEAA99
          MOVE      "Casemix Extract Does Not Exist - ",DISPMSG                                      
          CALL      MESSAGE1
          GOTO      KCCEAA00
KCCEAA90
          MOVE      ONE,EXIT
          GOTO      KCCEAA99
KCCEAA95
          MOVE      TWO,EXIT
KCCEAA99 TOPIC    PRGID
          RETURN

.------------------------------------------------------------
. Program       : GENWEB01
.
. Function      : Lookup Table HTML/JS Generation
.
. Modifications  :
.------------------------------------------------------------
. V11.05.01 19/12/2024  Peter Vela    TSK 0955314
.           Added FHIR API Valueset generation for Clinical Note
.           Type obscncaf
.           Added FHIR API Valueset generation for Clinical Note
.           Duration obscncaf
.           Added FHIR API Valueset generation for Clinical Note
.           Incident Type obscncaf
.           Added FHIR API Valueset generation for Clinical Note
.           Location obscncaf
.           Added FHIR API Valueset generation for Clinical Note
.           Type of Injury obscncaf
.           Added FHIR API Valueset generation for Clinical Note
.           Cause obscncaf
.           Added FHIR API Valueset generation for all lookups
. V11.02.01 09/02/2022  Thanh T       TSK 0905641
.           Recompiled as OUTHEDFD/OUTMA1FD changes
. V11.01.03 22/06/2021 Ebon Clements   TSK 0907537
.           Removed yellow colour default in lookup maintenance -
.           "FFFF00",WBLPCLOR
. V11.01.02 07/06/2021  Tony Hui       TSK 0907029
.           Cross Browser Support Fix to add id for UpdateString on
.           generation of the HTML code to allow for Standard.js to
.           reference the element. Change applied to ENDPAG00 and ENDPGC00.
. V11.01.01 26/02/2021  Don Nguyen     TSK 0902780
.           Removed redundant ".options" with length test in ENDOUT00
. V10.15.01 16/01/2020  Ebon Clements  TSK 0884970 
.           Added Red class to default state suburb lookup.
.           LookupSuburb() - STRTPC00
. V10.14.03 29/08/2019  Ebon Clements  TSK 0814751 
.           Added remote script to dynamically add an inactive clinic
.           type to the selection list if it's the stored value on file
.           OUTCTY00 
. V10.14.02 07/05/2019  Nicole Torrisi TSK 0868174 
.           Increased AutoPostCode limit to unlimited
. V10.14.01 26/03/2019  Don Nguyen     TSK 0846365 
.           Modified code to write (generated) file contents into a temp file
.           before overwriting the original file upon completion.
.           The following options have been modified:
.             - Lookup, Category, MRT Locations, Outpatient Clinic Types,
.               Outpatient Clinic ID, Common Category Codes,
.               Mental Health Clinic ID and FHIR ValueSets.
.           Fixed FHIR generation code to prevent error on write if FHIR
.           ValueSets directory not present.
. V10.13.02 12.11.2018  B.G.Ackland    TSK 0835482 
.           FHIR Output of alertType H2-H9 remove H1 for AllergyIntolerence 
. V10.13.01 28/08/2018  Tracey Nguyen  TSK 0862028
.           Commented out validation for postcode 8888
. V10.11.05 12/10/2017  Don Nguyen     TSK 0842027 
.           Cross-browser compatibility changes:
.            - Added 'event' keyword to PageLoad()
.            - Call FocusDelay() where applicable
.           28/09/2017  Peter Vela     TSK 0845884
.           Increased AutoPostCode limit to 100
. V10.11.04 28.08.2017  B.G.Ackland    TSK 0835482 
.           FHIR Output of alertType Ignore empty Categories in H2-H9
. V10.11.03 28.08.2017  B.G.Ackland    TSK 0835482 
.           FHIR Output Fix alertType ValueSet
. V10.11.02 28.08.2017  B.G.Ackland    TSK 0835482 
.           FHIR Output Change to Patient Reference ID to strip spaces
.           FHIR Change Extension Naming
. V10.11.01 19.07.2017  B.G.Ackland    TSK 0835482 
.           New FHIR ValueSet Output into <webroot>/fhir/valuesets/
. V10.10.01 07.07.2017  B.G.Ackland    TSK 0835482 
.           New FHIR ValueSet Output into <webroot>/fhir/valuesets/
. V10.08.01 11/08/2016  Ebon Clements  TSK 0819193
.           Show all clinic effective dates by clinic type - MTYP3000
. V10.05.01 06/10/2014  Ebon Clements  CAR 268970
.           Removed OUTCLIFD index 2 open as it was not used
. V10.05.01 16/07/2014  Don Nguyen      CAR 302818
.           Added HOSPFLG2 to separate the output of trailing "}" for different
.           javascript files (MrtMultiHomeLocns & MrtMultiHomeLocnsAll).
. V10.04.02 20/03/2014  Patrick Adair   CAR 296207
.           Corrected MMLLIN00 to cater for first record being inactive
. V10.04.01 17/12/2013  Patrick Adair   CAR 235296
.           Create new MRT Location lists (MRTLOC00 and MULLOC00) with all
.           tracking locations (active and inactive)
. V10.03.11 03/05/2013  Ebon Clements     CAR 261630
.           Removed port number from temp file name
. V10.03.10 04/12/2012  Don Nguyen      CAR 277334
.           Added call to LookupUpdateCleanup() after LookupUpdateParent()
. V10.03.09 03/05/2012  Mike Laming     CAR 26R3795
.           Mods to MAIN1400 & MRTLOC00 to correct single Hospital locations
. V10.03.08 23/03/2012  Jill Parkinson  CAR 262432
.           Added *+ to write of IBPOSTAT   
. V10.03.07 23/03/2012  Jill Parkinson  CAR 262432
.           Added *+ to write of IBPOPCOD   
. V10.03.06 01/02/2012  Peter Vela      CAR 252413
.           Removed duplicates from MENCLI00
. V10.03.05 31/01/2012  Peter Vela      CAR 252413
.           Added Mental Health Clinics Generate to Report Number 2
. V10.03.04 25/01/2012  Peter Vela      CAR 252413
.           Added Mental Health Clinics Option 9
. V10.03.03 15/12/2011  Mike Laming     CAR 257259
.           Added "trim(" to "if (PCFields[0]" in AutoPostCode at STRTPC00
. V10.03.02 15/11/2011  Mike Laming     CAR 240184
.           Changes to IBAPOSTF Post Code table - added State to Keys
. V10.03.01 10/11/2011  Saroeun Soeur   CAR 253905
.           Added PAgeLoad()
. V10.02.04 18/10/2011  Mike Laming     CAR 252975    
.           Mod STRTPC00 to test "suburb" for whiteSpace before outputing Suburb
. V10.02.03 28/09/2011  Peter McMullen  CAR 249261    
.           Sort MRT Location lists (MRTLOC00 and MULLOC00) by description   
. V10.02.02 25/05/2011  Mike Laming   CAR 240724    
.           Mods to MRTLOC00 & MULLOC00 to also create new MrtHomeLocns.js & 
.           MrtMultiHomeLocns.js
. V10.02.01 31/03/2011  Ebon Clements CAR 240635    
.           Changed InitPostCodes functions to have a max of 12000 lines 
. V10.01.01 25/01/2011  Ebon Clements CAR 233050
.           Removed option 9 - Generate contract Id
. V10.00.03 31/08/2010  J.Tan         CAR 229168
.           Mods generating Contract ID
. V10.00.02 18/05/2010  J.Tan         CAR 220995
.           Added generate of Contract ID javascript for Current and New file   
. 10.00.01  23/03/2010  Peter McMullen    CAR 215272
.           fix html anomalies in generated source 
. V9.11.03  23/03/2009  Peter McMullen    CAR 190945
.           Add processing to build an apache group file
. V9.11.02  15/12/2008  Steve Armstrong   CAR 185927
.           Removed isadd and incorporated second index into isbuild command
. V9.11.01  31/10/2008  Peter McMullen CAR 174725
.           convert internal javascript to W3C standards
.------------------------------------------------------------
. V9.09.02  20/12/2007  Ebon Clements CAR 158178
.           Added active/inactive test to medical record location generation
. V9.09.01  29/06/2007  Ebon Clements CAR 143888
.           Added loop counter test to POST0000 because IE7 gets a js error
.           when a function has more than 32769 lines
.------------------------------------------------------------
. V9.08.01  11/01/2007  Ebon Clements CAR 124664
.           Changed LOAD0000 to use index 1 on the clinic file
.------------------------------------------------------------
. V9.05.02  17/03/2006  Ebon Clements CAR 89155
.           Added generate of multi hospital medical record location javascript
. V9.05.01  10/03/2006 Ebon Clements CAR 78533
.           Added generate of multi hospital category codes javascript
.------------------------------------------------------------
. V9.04.05  07/12/2005 Ebon Clements CAR 74360 78510
.           Fixed isadd to gentmpXX
. V9.04.04  10/11/2005 Ebon Clements CAR 74360 78510
.           Added MTYP0000 Generate outpat clinic master by type javascript
. V9.04.03  06/06/2005 Ebon Clements CAR 61334 
.           Added OTCNCFMT - Outpatient clinic id javascript format
. V9.04.02  10/05/2005 Ebon Clements CAR 61563 
.           Removed () from around clinic code in OutpatientClinicId.js
. V9.04.01  10/05/2005 Ebon Clements CAR 60929 
.           Missing version
.------------------------------------------------------------
. V9.03.08  25/02/2005 Jill Habasque CAR 58443 
.           Added DefaultCode to category code selection lists
. V9.03.07  16/06/2004 Pat Dirito     CAR 50666
.           Set PROCAT00 to only generate a specific category requested.
.           Packed keyings with themselves & SP70.
.           16/06/2004 Ebon Clements  CAR 50691
.           Changed select exact match suburb option to perform a post code
.           search if no match is found
. V9.03.06  27/11/2003 Ebon Clements  CAR 45480
.           Changed outpatient javascipt generation for multiple site prefixes
. V9.03.05  29/10/2003 Lina Vo        CAR 44126
.           Changed First Lookup Page to call ENDPGC00 rather than ENDPAG00.  
. V9.03.04  29/10/2003 Ebon Clements  CAR 44536
.           Added exact suburb option to POST0000 postcode generation
. V9.03.03  30/09/2003 Ebon Clements  CAR 43674
.           Close files before opening in OPNOUT00
. V9.03.02  12/09/2003 Lina Vo       CAR 41196
.           Added option 7 to generate Common Codes javascript.
. V9.03.01  17/06/2003 Ebon Clements SRF 37705
.           Added option 6 to generate the clinic id javascript. Changed the
.           clinic id and type javascript to include the site code.
.------------------------------------------------------------
. V9.02.07  01/05/2003  Tonii  CAR 38648
.           Mods to only open outpatient files if Option 5 (Outpatients) 
.           is selected. Added alert if program is not run within Outpatients 
.           module (blank site code), user has option of ending or continuing
.           process at that point.
. V9.02.06  10/09/2002  Jill Habasque SRF 21486
.           Changed to not include inactive category codes                
. V9.02.05  01/07/2002  Ebon Clements SRF 18689
.           Added option to generate the outpatient clinic type javascript
.           This has only been set up for a single outpatient site RCH
. V9.02.04  15/04/2002  Jill Habasque
.           Changed height of postcode box to 220
. V9.02.03  24/03/2002  B.G.Ackland
.           Fixed default Code
. V9.02.02  15/03/2002  Jill Habasque 
.           Fixed output of AutoPostCode.js
. V9.02.01  01/02/2002  Pat Dirito    
.           Added option 4 - MRT Loactions javascript generation     
. V9.02.00  06/04/2001  Ebon Clements    
.           Fixed category codes javascript generation     
.------------------------------------------------------------
. V5.07.07  10/03/2000  Katie Nelson     
.           Added match on active flag for detail lines    
. V5.07.06  09/03/2000  Katie Nelson     
.           Changed to use relative paths                  
. V5.07.05  29/02/2000  Nicole Harrington
.           Changed postcode js to output in double quotes
. V5.07.04  25/02/2000  Nicole Harrington
.           Modified Postcode Javascript
. V5.07.03  09/02/2000  Nicole Harrington
.           Added Option 3 - Postcode javascript generation
. V5.07.02  28.01.2000  B.G.Ackland  
.           New Standards
. V5.07.01  20.12.1999  Katie Nelson
.           Recompiled for IBAWEBDF/IBAWEBCD
. V5.07.00  01.07.1999  Katie Nelson
.           Port from 6.06 to 5.07
.
.------------------------------------------------------------
          INC       STD001FD
          INC       COMCODFD/INC
          INC       IBAPOSFD/INC
          INC       IBASEQFD/INC
          INC       HL7TABFD/INC
          INC       HL7CODFD/INC
          INC       PATCODFD/INC
          INC       MLTCODFD/INC
          INC       MRTLOCFD/INC 
          INC       TFILEVAR/INC
          INC       WEBCONFD/INC
          INC       WEBLDTFD/INC
          INC       WEBLIDFD/INC
          INC       WEBLPGFD/INC
          INC       WEBSGPFD/INC
          INC       OBSCNCFD/INC
          INC       OUTCTYFD/INC
          INC       OUTSITFD/INC
          INC       OUTCLIFD/INC
          INC       OUTCONFD/INC
          INC       OUTHEDFD/INC
          INC       OUTMA1FD/INC
          INC       MRTCONFD/INC
          INC       PATHSPFD/INC
          INC WEBERRFD/INC
.

.         Temporary File Definition
.         -------------------------
.
.         Filename : gentmpxx.dat          (xx = port id)
.
GENTEMP1  IFILE SQL, FIXED=49, KEY="UC1-6,7-12,13-18,19-48"
GENTEMP2  IFILE SQL, FIXED=49, KEY="UC1-6,7-12,19-48,13-18"
.
.NAME     TYPE    LENGTH     PHYSICAL     START     DESCRIPTION
.----     ----    ------     --------     -----     -----------
GENTSITE  DIM     6          6            1         SITE ID
GENTCTYP  DIM     6          6            7         CLINIC TYPE
GENTCLIN  DIM     6          6            13        CLINIC ID
GENTDESC  DIM     30         30           19        CLINIC DESCRIPTION
.                               
.End of Record                            49
.
.         File Variables
.
ERASE     INIT      "iserase "
ISBUILD   INIT      "isbuild "
MOVECMND  INIT      "mv -f "      * Move command (force overwrite) 
TEMPFILE  DIM       8
UKEY      INIT      " 49 UC1-6,7-12,13-18,19-48 UC1-6,7-12,19-48,13-18"
.
CFILEPRE  DIM       3   * Current Open File Prefix for Outpatient Files
CMDLINE   DIM       300
CURRDATE  DIM       8
DIM6      DIM       6
IBCNMHOS  FORM      1
REPORTNO  FORM      2
VAR       DIM       127
LENGTH    FORM      3
LOOPCNTR  FORM      5
NEWFILE   DIM       1
CURFILE   DIM       1
FVSINDIC  DIM       1
FVSLOOK   DIM       20
FVSNAME   DIM       20 
FVSDESC   DIM       20 
FVSLDESC  DIM       50 
FVSLINE   FORM      8  
FVSGENR   FORM      1                            * Generate FHIR Static Files
.
FVSPLOCN  DIM       127                          * FHIR Value Set
FVSPLOCF  FILE      ASCII, FIXED=500             
.
FVSPOUTN  DIM       127                * FHIR ValueSet file path (temp)
FVSPOFIN  DIM       127                * FHIR ValueSet file path (final)
FVSPOUTF  FILE      ASCII, FIXED=500
.
JSCPLOCN  DIM       127                * Active & Inactive Locations (temp)
JSCPLFIN  DIM       127                * Active & Inactive Locations (final)
JSCPLOCF  FILE      ASCII, FIXED=500   * Active & Inactive Locations
.
JSCPOUTN  DIM       127                * Javascript file path (temp)
JSCPOFIN  DIM       127                * Javascript file path (final)
JSCPOUTF  FILE      ASCII, FIXED=500
.
HOSPFLAG  FORM      1
HOSPFLG2  FORM      1
HOMEONLY  FORM      1
.
HTMLOUTN  DIM       127                * Lookup (HTML) file path (temp)
HTMLOFIN  DIM       127                * Lookup (HTML) file path (final)
HTMLOUTF  FILE      ASCII, FIXED=500
.
PCJSNAME  DIM       127
PCJSFILE  FILE      ASCII, FIXED=500
.
CHECKBOX  FORM      1
KEY8A     DIM       8
LASTGRP   DIM       10
LIDSTRCD  DIM       8
LIDENDCD  DIM       8
CATSTRCD  DIM       2
CATENDCD  DIM       2
EXACTMCH  DIM       1
CODEDATE  DIM       8
SELCAT    DIM       2
DEFTCODE  DIM       4
DEFTSUBR  DIM       45
DEFTSTAT  DIM       3
DEFAULTC  DIM       3
DEFAULTD  DIM       40
PRFXDONE  FORM      1
PRINORDR  FORM      1
SITEFLAG  FORM      1
SAVECLIN  DIM       6
SAVEHOSP  DIM       3
SAV2HOSP  DIM       3
SAVESITE  DIM       6
SAVETYPE  DIM       6
SAVKEY20  DIM       20
SITECODE  DIM       6
CATW2     INIT      "w2"
.
PRGID     INIT      "GENWEB01"
PRGNAM    INIT      "Lookup Table HTML/JS Generation"
VERSION   INIT      "V12.00.00"
.------------------------------------------------------------
. Start of Program
.------------------------------------------------------------
MAIN0000  CALL      INIT0000              * Initialise
          DISPLAY   *P1:3,*EF," 1. Lookup":
                        *P1:4," 2. Category":
                        *P1:5," 3. Post Codes":
                        *P1:6," 4. MRT Locations":
                        *P1:7," 5. Outpatient Clinic Types":
                        *P1:8," 6. Outpatient Clinic ID":
                        *P1:9," 7. Common Category Codes":
                        *P1:10," 8. Generate Apache Group File":
                        *P1:11," 9. Generate Mental Health Clinic ID":
                        *P1:12,"10. FHIR ValueSets"
          KEYIN     *P1:15,*EL,"Option : ",REPORTNO
.
          BRANCH    REPORTNO,MAIN1000,MAIN1200,MAIN1300,MAIN1400,MAIN1500:
                             MAIN1600,MAIN1700,MAIN1800,MAIN1900,MAIN2000
          GOTO      MAIN9999
.
MAIN1000  CALL      PROC0000       * Process
          GOTO      MAIN9999
.
MAIN1200  CALL      PROCAT00       * Generate Category Code Javascript  
          IF        IBCNMHOS=1
            CALL      MULCAT00     * Multi Hospital Category Code Javascript
          ENDIF
          GOTO      MAIN9999
.
MAIN1300  CALL      POST0000       * Generate Post Code Javascript  
          GOTO      MAIN9999
.
MAIN1400  MOVE      ZERO,HOMEONLY
          IF        IBCNMHOS=1
            CALL      MULLOC00     * Multi Hospital MRT Locations Javascript
          ELSE
            CALL      MRTLOC00     * Generate MRT Locations Javascript        
          ENDIF
.
          MOVE      ONE,HOMEONLY
          IF        IBCNMHOS=1
            CALL      MULLOC00     * Multi Hospital Home Locations Javascript
          ELSE
            CALL      MRTLOC00     * Generate MRT Home Locations Javascript
          ENDIF
          GOTO      MAIN9999
.
MAIN1500  CALL      OUTCTY00       * Generate Outpatient Clinic type Javascript
          CALL      MTYP0000       * Generate Outpat Clinic Master Javascript 2
          GOTO      MAIN9999
.
MAIN1600  CALL      OUTMAS00       * Generate Outpat Clinic Master Javascript 1
          CALL      MTYP0000       * Generate Outpat Clinic Master Javascript 2
          GOTO      MAIN9999
.
MAIN1700  CALL      COMCAT00       * Generate Common Category Code Javascript  
          GOTO      MAIN9999
.
MAIN1800  CALL      APACHE00       * Generate Apache Group file
          GOTO      MAIN9999
.
MAIN1900  CALL      MENCLI00       * Generate Mental Health Clinics JS
          GOTO      MAIN9999
.
MAIN2000  CALL      MENFVS00       * Generate Additional FHIR ValueSets
          GOTO      MAIN9999
.
MAIN9999  CHAIN     PGM
          STOP
.------------------------------------------------------------
. Initialisation
.------------------------------------------------------------

INIT0000  CALL      DISPHEAD                  * display heading
.
          OPEN      WEBSGPA2,"websgpaf"
          OPEN      WEBLIDA1,"weblidaf"
          OPEN      WEBLPGA1,"weblpgaf" 
          OPEN      WEBLDTA1,"webldtaf" 
          OPEN      WEBLDTA2,"webldtaf" 
          OPEN      WEBLDTA3,"webldtaf" 
          OPEN      COMCODA1,"comcodaf" 
          OPEN      COMCODA2,"comcodaf" 
          OPEN      COMCODA3,"comcodaf" 
          OPEN      PATCODE1,"patcodes" 
          OPEN      PATCODE2,"patcodes" 
          OPEN      PATCODE3,"patcodes" 
          OPEN      MLTCODA1,"mltcodaf" 
          OPEN      MLTCODA2,"mltcodaf" 
          OPEN      IBAPOST1,"ibapostf" 
          OPEN      MRTLOCA3,"mrtlocaf"
          OPEN      OBSCNCA1,"obscncaf"
          OPEN      OBSCNCA2,"obscncaf"
          OPEN      OUTSITA1,"outsitaf"
          OPEN      OUTSITA3,"outsitaf"
          OPEN      PATHSPA1,"pathspaf"
          OPEN      HL7TABA1,"hl7tabaf"
          OPEN      HL7CODA1,"hl7codaf"
.
          MOVE      "out",CFILEPRE
          CALL      OPNOUT00             * Open Outpatient Files
.
          OPEN      CONTROLF,"controlf" 
          MOVE      "   91",AUDTSECT
          READ      CONTROLF,AUDTSECT;*99,CWEBRDIR,CWEBRCFG,CWEBROOT
          READ      CONTROLF,THIRTY2;*116,OTCNCFMT
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,HUND01;*56,CWEBGFIL
          READ      CONTROLF,SIXTY;*105,MRCNHMTY

.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
.
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,TEMPFILE
.
          RETURN
.------------------------------------------------------------
. Process
.------------------------------------------------------------
PROC0000  KEYIN    *P1:17,"Start Lookup Code : ",LIDSTRCD
          KEYIN    *P1:18,"End   Lookup Code : ",LIDENDCD
          PACK     KEY8,LIDSTRCD,SP70
          CALL     RDWBLI1
          IF       OVRCD=0
            CALL     RPWBLI1
          ENDIF
PROC1000  CALL     RKWBLI1
          BRANCH   OVRCD,PROC9999
          MATCH    WBLILKID,LIDENDCD
          GOTO     PROC1100 IF EQUAL
          GOTO     PROC9999 IF LESS
.
PROC1100  PACK     KEY11,WBLILKID,SP70
          CALL     RSWBLP1
PROC2000  CALL     RKWBLP1
          BRANCH   OVRCD,PROC1000
          MATCH    WBLILKID,WBLPLKID 
          GOTO     PROC1000 IF NOT EQUAL
.
          MATCH    "0",WBLPPSEQ
          IF       @EQUAL
            CALL     PAGDES00     * Output in Description Sequence
          ELSE
            CALL     PAGCOD00     * Output in Code Sequence
          ENDIF
.
          GOTO     PROC2000
.
PROC9999  RETURN
.------------------------------------------------------------
. Output Page in Description Sequence
.------------------------------------------------------------
PAGDES00  CALL     MAKPAG00    * Create Output File
          PACK     KEY64,WBLPLKID,WBLPPGNO,SP70
          CALL     RSWBLD2
PAGDES10  CALL     RKWBLD2
          BRANCH   OVRCD,PAGDES90
          MATCH    WBLPLKID,WBLDLKID
          GOTO     PAGDES90 IF NOT EQUAL
          MATCH    WBLPPGNO,WBLDPAGE
          GOTO     PAGDES90 IF NOT EQUAL
          MATCH    "0",WBLDACTV            * Is it active
          GOTO     PAGDES10 IF EQUAL        * no - go to next
.
          CALL     DETLIN00   * Output Detail Line
.
          GOTO     PAGDES10   * Next
.
PAGDES90  MATCH    "000",WBLPPGNO
          IF       @EQUAL
            CALL     ENDPGC00              * No Back button
          ELSE
            CALL     ENDPAG00
          ENDIF
          CALL     OVWRPG00    * Overwrite original Lookup Page
.
PAGDES99  RETURN
.------------------------------------------------------------
. Output Page in Description Sequence
.------------------------------------------------------------
PAGCOD00  CALL     MAKPAG00    * Create Output File
          PACK     KEY24,WBLPLKID,WBLPPGNO,SP70
          CALL     RSWBLD3
PAGCOD10  CALL     RKWBLD3
          BRANCH   OVRCD,PAGCOD90
          MATCH    WBLPLKID,WBLDLKID
          GOTO     PAGCOD90 IF NOT EQUAL
          MATCH    WBLPPGNO,WBLDPAGE
          GOTO     PAGCOD90 IF NOT EQUAL
          MATCH    "0",WBLDACTV            * Is it active
          GOTO     PAGCOD10 IF EQUAL        * no - go to next
.
          CALL     DETLIN00   * Output Detail Line
.
          GOTO     PAGCOD10   * Next
.
PAGCOD90  MATCH    "000",WBLPPGNO
          IF       @EQUAL
            CALL     ENDPGC00              * No Back button
          ELSE
            CALL     ENDPAG00
          ENDIF
          CALL     OVWRPG00   * Overwrite original Lookup Page
.
PAGCOD99  RETURN
+
.------------------------------------------------------------
. Make Page Heading 
.------------------------------------------------------------
MAKPAG00  MOVE     ZERO,CHECKBOX
          CLEAR    HTMLOUTN
          STRIP    CWEBROOT
          APPEND   CWEBROOT,HTMLOUTN
          APPEND   "lookups/Lookup_",HTMLOUTN
          MOVE     WBLILKID,KEY8
          REP      " 0",KEY8
          APPEND   KEY8,HTMLOUTN
          APPEND   "_",HTMLOUTN
          APPEND   WBLPPGNO,HTMLOUTN
          APPEND   ".html.tmp",HTMLOUTN
          RESET    HTMLOUTN
.
          PREP     HTMLOUTF,HTMLOUTN
          WRITE    HTMLOUTF,SEQ;"<html>"
          WRITE    HTMLOUTF,SEQ;"<head>"
          WRITE    HTMLOUTF,SEQ;"  <title>",WBLPHEAD,"</title>"
          WRITE    HTMLOUTF,SEQ;"  <link rel=#"stylesheet#"":
                            " href=#"../html/standard.css#" type=#"text/css#">"
          WRITE    HTMLOUTF,SEQ;"  <link rel=#"stylesheet#"":
                            " href=#"../html/custom.css#" type=#"text/css#">"
          WRITE    HTMLOUTF,SEQ;"  <script type=#"text/javaScript#" ":
                                "src=#"../js/Standard.js#"></script>"
          WRITE    HTMLOUTF,SEQ;"  <script type=#"text/javaScript#" ":
                                "src=#"../js/Custom.js#"></script>"
          WRITE    HTMLOUTF,SEQ;"</head>"
          WRITE    HTMLOUTF,SEQ;"<body onload=#"PageLoad(event);#">"
          WRITE    HTMLOUTF,SEQ;"<div id=#"PageHeadingSection#">"
.
          MATCH    SP70,WBLPCLOR
          IF       @EQUAL
            WRITE    HTMLOUTF,SEQ;"<span class=#"DFrameTitleBar#">"
          ELSE
            WRITE    HTMLOUTF,SEQ;"<span class=#"DFrameTitleBar#" ":
                                  "style=#"background-color:##",WBLPCLOR,";#">"
          ENDIF
.
          WRITE    HTMLOUTF,SEQ;"<img border=#"0#" align=#"right#" ":
                                "src=#"../images/ExitIcon.gif#" ":
                                " onclick=#"DFrameExit();#">"
          WRITE    HTMLOUTF,SEQ;"<script type=#"text/javascript#">":
                                "document.write(self.document.title);</script>"
          WRITE    HTMLOUTF,SEQ;"</span>"
          WRITE    HTMLOUTF,SEQ;"</div>"
          WRITE    HTMLOUTF,SEQ;"<div id=#"PageBodySection#">"
          WRITE    HTMLOUTF,SEQ;"<table align=#"center#" width=#"100%#" border=#"0#">"

MAKPAG99  RETURN
+
.------------------------------------------------------------
. End Page 
.------------------------------------------------------------
ENDPAG00  IF       CHECKBOX=1
            WRITE    HTMLOUTF,SEQ;"<tr><td colspan=#"4#" align=#"center#">"
            WRITE    HTMLOUTF,SEQ;"<input name=#"UpdateString#" "
            WRITE    HTMLOUTF,SEQ;"id=#"UpdateString#" type=#"text#" "
            WRITE    HTMLOUTF,SEQ;"size=#"40#" /></td></tr>"
          ENDIF
          WRITE    HTMLOUTF,SEQ;"<tr><td colspan=#"4#" align=#"center#">"
          IF       CHECKBOX=1
            WRITE    HTMLOUTF,SEQ;"<input type=#"button#" value=#"Update#" ":
                          " onclick=#"LookupUpdateStr();#" class=#"button#" />"
          ENDIF
          WRITE    HTMLOUTF,SEQ;"<input type=#"button#" value=#"Close#" ":
                                "onclick=#"DFrameExit();#" class=#"button#" />"
.
          WRITE    HTMLOUTF,SEQ;"<input type=#"button#" value=#"Back#" ":
                              "onclick=#"history.go(-1);#" class=#"button#" />"
.
          WRITE    HTMLOUTF,SEQ;"</td></tr>"
          WRITE    HTMLOUTF,SEQ;"</table>"
          WRITE    HTMLOUTF,SEQ;"</div>"
          WRITE    HTMLOUTF,SEQ;"<script type=#"text/javascript#">"
          WRITE    HTMLOUTF,SEQ;"function psize() {"
          WRITE    HTMLOUTF,SEQ;"  var pb = document.getElementById('PageBodySection'); "
          WRITE    HTMLOUTF,SEQ;"  var ph = document.getElementById('PageHeadingSection'); "
          WRITE    HTMLOUTF,SEQ;"  var h;" 
          WRITE    HTMLOUTF,SEQ;"  h = document.body.clientHeight - ph.clientHeight;       "
          WRITE    HTMLOUTF,SEQ;"  pb.style.height = h + 'px'; "
          WRITE    HTMLOUTF,SEQ;"}"
          WRITE    HTMLOUTF,SEQ;"psize();"
          WRITE    HTMLOUTF,SEQ;"</script>"
          WRITE    HTMLOUTF,SEQ;"</body>"
          WRITE    HTMLOUTF,SEQ;"</html>"
          CLOSE    HTMLOUTF
ENDPAG99  RETURN
+
.------------------------------------------------------------
. End Page - No Back button on first Lookup Page.
.------------------------------------------------------------
ENDPGC00  IF       CHECKBOX=1
            WRITE    HTMLOUTF,SEQ;"<tr><td colspan=#"4#" align=#"center#">"
            WRITE    HTMLOUTF,SEQ;"<input name=#"UpdateString#" "
            WRITE    HTMLOUTF,SEQ;"id=#"UpdateString#" type=#"text#" " 
            WRITE    HTMLOUTF,SEQ;"size=#"40#" /></td></tr>"
          ENDIF
          WRITE    HTMLOUTF,SEQ;"<tr><td colspan=#"4#" align=#"center#">"
          IF       CHECKBOX=1
            WRITE    HTMLOUTF,SEQ;"<input type=#"button#" value=#"Update#" ":
                          " onclick=#"LookupUpdateStr();#" class=#"button#" />"
          ENDIF
          WRITE    HTMLOUTF,SEQ;"<input type=#"button#" value=#"Close#" ":
                                "onclick=#"DFrameExit();#" class=#"button#" />"
.
          WRITE    HTMLOUTF,SEQ;"</td></tr>"
          WRITE    HTMLOUTF,SEQ;"</table>"
          WRITE    HTMLOUTF,SEQ;"</div>"
          WRITE    HTMLOUTF,SEQ;"<script type=#"text/javascript#">"
          WRITE    HTMLOUTF,SEQ;"function psize() {"
          WRITE    HTMLOUTF,SEQ;"  var pb = document.getElementById('PageBodySection'); "
          WRITE    HTMLOUTF,SEQ;"  var ph = document.getElementById('PageHeadingSection'); "
          WRITE    HTMLOUTF,SEQ;"  var h;" 
          WRITE    HTMLOUTF,SEQ;"  h = document.body.clientHeight - ph.clientHeight;       "
          WRITE    HTMLOUTF,SEQ;"  pb.style.height = h + 'px'; "
          WRITE    HTMLOUTF,SEQ;"}"
          WRITE    HTMLOUTF,SEQ;"psize();"
          WRITE    HTMLOUTF,SEQ;"</script>"
          WRITE    HTMLOUTF,SEQ;"</body>"
          WRITE    HTMLOUTF,SEQ;"</html>"
          CLOSE    HTMLOUTF
ENDPGC99  RETURN
+
.-------------------------------------------------------------------------------
. Overwrite the Lookup Page with the newly generated (temp) file
.-------------------------------------------------------------------------------
OVWRPG00  CLEAR     HTMLOFIN
          STRIP     CWEBROOT
          APPEND    CWEBROOT,HTMLOFIN
          APPEND    "lookups/Lookup_",HTMLOFIN
          MOVE      WBLILKID,KEY8
          REP       " 0",KEY8
          APPEND    KEY8,HTMLOFIN
          APPEND    "_",HTMLOFIN
          APPEND    WBLPPGNO,HTMLOFIN
          APPEND    ".html",HTMLOFIN
          RESET     HTMLOFIN
.
          CLEAR     CMDLINE
          PACK      CMDLINE,MOVECMND,HTMLOUTN,SP1,HTMLOFIN,SP70
          EXECUTE   CMDLINE,TASKID   * overwrite original file with temp file
.
OVWRPG99  RETURN
+
.------------------------------------------------------------
. Output Detail Line
.------------------------------------------------------------
DETLIN00  MOVE      WBLDTYPE,F1
          BRANCH    F1,DETLIN10,DETLIN20
.
. Page Link
.
          CLEAR     KEY24
          APPEND    "Lookup_",KEY24
          MOVE      WBLILKID,KEY8
          REP       " 0",KEY8
          APPEND    KEY8,KEY24
          APPEND    "_",KEY24
          APPEND    WBLDLKPG,KEY24
          APPEND    ".html",KEY24
          RESET     KEY24

          WRITE     HTMLOUTF,SEQ;"<tr><td>":
                                 "<img src=#"../images/SelectLink.gif#" ":
.                              "border=#"0#" align=#"absmiddle#" hspace=#"4#"":
                               " onclick='location.href=#"",KEY24,"#"' />"
          WRITE     HTMLOUTF,SEQ;WBLDDESC,"</td></tr>"
          GOTO      DETLIN99
.
. Select Item
.
DETLIN10  STRIP     WBLDDESC
          MOVELPTR  WBLDDESC,LENGTH
          SFORMAT   VAR,LENGTH
          MOVE      WBLDDESC,VAR
.
          WRITE     HTMLOUTF,SEQ;"<tr><td>":
                              "<img src=#"../images/SelectItem.gif#" ":
.                             "border=#"0#" align=#"absmiddle#" hspace=#"4#" ":
                             " onclick='LookupUpdateParent(#"":
                                 WBLDCODE,"#",#"",VAR,"#");":
                             "LookupUpdateCleanup();' />"
          WRITE     HTMLOUTF,SEQ;VAR,"</td></tr>"
          SFORMAT   VAR,127
          GOTO      DETLIN99
.
. For a Detail Line that is available as a checkbox ie Type=2
.
DETLIN20  STRIP     WBLDDESC
          MOVELPTR  WBLDDESC,LENGTH
          SFORMAT   VAR,LENGTH
          MOVE      WBLDDESC,VAR
.
          MOVE      ONE,CHECKBOX
          MOVE      WBLDUQID,KEY3
          REP       " 0",KEY3
          WRITE     HTMLOUTF,SEQ;"<tr><td>":
                             "<img src=#"../images/SelectItem.gif#" ":
.                            "border=#"0#" align=#"absmiddle#" hspace=#"4#" ":
                             "onclick='LookupUpdateParent(#"":
                                 WBLDCODE,"#",#"",VAR,"#");":
                             "LookupUpdateCleanup();' />":
                              "<input name=#"checkbox#"",KEY3:
                                 " type=#"checkbox#" value=#"",VAR,"#"":
                                 " onclick=#"LookupCheckItem(this)#" />"
          WRITE     HTMLOUTF,SEQ;VAR,"</td></tr>"
          SFORMAT   VAR,127
          GOTO      DETLIN99
.
DETLIN99  RETURN
+
.------------------------------------------------------------
. FHIR Additional ValueSets
.  - alertType.vs Nested Value Set For Alert Codes H2-H9
.------------------------------------------------------------
MENFVS00  CALL     ALTFVS00
          CALL     HL7FVS00
          CALL     CNCFVS00
          CALL     CNDRVS00
          CALL     CNITVS00
          CALL     CNLOVS00
          CALL     CNTYVS00
          CALL     CNCAVS00
          CALL     LOOKVS00
          CALL     LOLTVS00
MENFVS99  RETURN
+
.------------------------------------------------------------
. HL7 FHIR ValueSets
.------------------------------------------------------------
HL7FVS00  MOVE     SP70,DEFAULTC
          PACK     KEY4,SP70
          CALL     RSHLTA1
HL7FVS10  CALL     RKHLTA1
          BRANCH   OVRCD,HL7FVS99
          CLEAR    FVSNAME
          APPEND   "HL7-Table-",FVSNAME
          APPEND   HLTATID,FVSNAME
          RESET    FVSNAME
          MOVE     HLTADES,FVSDESC
          MOVE     HLTADES,FVSLDESC
.
          CALL     MAKFVS00    * Create Output File for FHIR ValueSet
          BRANCH   FVSGENR,HL7FVS99    * FHIR Directory Not Available
.
          MOVE     ZERO,FVSLINE
.
          PACK     KEY14,HLTATID,SP70
          CALL     RAHLCO1
HL7FVS20  CALL     RKHLCO1
          BRANCH   OVRCD,HL7FVS30
          MATCH    HLTATID,HLCOTID
          GOTO     HL7FVS30 IF NOT EQUAL
          IF       FVSLINE>0
            WRITE    FVSPOUTF,SEQ;", ";
          ENDIF
          WRITE    FVSPOUTF,SEQ;*+,"{ #"code#" : #"",HLCOTID,HLCOCOD,"#",  ":
                                   "  #"display#" : #"",HLCODES,"#" } ";
          ADD      ONE,FVSLINE
          GOTO     HL7FVS20
.
HL7FVS30  CALL     ENDFVS00   
          CALL     OVWRFV00   * Overwrite original FHIR ValueSet file with temp
          GOTO     HL7FVS10
.
HL7FVS99  RETURN
+
.------------------------------------------------------------
. FHIR Additional ValueSets
.  - alertType.vs Nested Value Set For Alert Codes H2-H9
.------------------------------------------------------------
ALTFVS00  MOVE     "H2",CATSTRCD
          MOVE     "H9",CATENDCD
          MOVE     SP70,DEFAULTC
          MOVE     SP70,DEFAULTD
.
          MOVE     "alertType",FVSNAME
          MOVE     "Alert Category",FVSDESC
          MOVE     "Alert Category",FVSLDESC
.
          CALL     MAKFVS00    * Create Output File for FHIR ValueSet
          BRANCH   FVSGENR,ALTFVS99    * FHIR Directory Not Available
.
          PACK     KEY5,SP3,CATSTRCD,SP70
          CALL     RDCODE3
          IF       OVRCD=0
            CALL     RDPCODE3
          ENDIF
ALTFVS10  CALL     RDKCODE3
          BRANCH   OVRCD,ALTFVS90
          MATCH    SP70,ACODE
          GOTO     ALTFVS90 IF NOT EQUAL
          MATCH    TCODE,CATENDCD
          GOTO     ALTFVS20 IF EQUAL
          GOTO     ALTFVS90 IF LESS
.
ALTFVS20  MOVE     TCODE,SELCAT
          PACK     KEY25,SELCAT,Z70   * Make sure there are associated codes
          PACK     PTCDKEY2,SELCAT,Z70
          CALL     RDSCODE2
          CALL     RDPCODE2
          BRANCH   OVRCD,ALTFVS10
          MATCH    TCODE,SELCAT
          GOTO     ALTFVS10 IF NOT EQUAL
          MATCH    SP70,ACODE         * no codes in category so ignore
          GOTO     ALTFVS10 IF EQUAL
          PACK     KEY5,SELCAT,SP70   * Make sure there are associated codes
          CALL     RDCODE1
.
          IF       FVSLINE>0
            WRITE    FVSPOUTF,SEQ;", ";
          ENDIF
          WRITE    FVSPOUTF,SEQ;*+,"{ #"code#" : #"Category-",TCODE,"#",  ":
                                "  #"display#" : #"",PTCDLDES,"#", ":
                                "  #"contains#": [  ";
.
          MOVE     ZERO,FVSLINE
          MOVE     TCODE,SELCAT
          CALL     FVSDES00     * Output in Description Sequence
          WRITE    FVSPOUTF,SEQ;*+,"] }";
          MOVE     ONE,FVSLINE
.
          GOTO     ALTFVS10
.
ALTFVS90  CALL     ENDFVS00   
          CALL     OVWRFV00   * Overwrite original FHIR ValueSet file with temp
.
ALTFVS99  RETURN
+
.------------------------------------------------------------
. Output Page in Description Sequence
.------------------------------------------------------------
FVSDES00  PACK     KEY25,SELCAT,SP70
          PACK     PTCDKEY2,SELCAT,SP70
          CALL     RDSCODE2
FVSDES10  CALL     RDKCODE2
          BRANCH   OVRCD,FVSDES99
          MATCH    TCODE,SELCAT
          GOTO     FVSDES99 IF NOT EQUAL
          MATCH    SP70,ACODE
          GOTO     FVSDES10 IF EQUAL
          MATCH    ANSI,PTCOACTV           * dont include inactive codes
          GOTO     FVSDES10 IF EQUAL
          REP      "' ",TDESC
          REP      "#" ",TDESC
          BRANCH   FVSGENR,FVSDES10
          CALL     FVSLIN00   * Output Detail Line for FHIR Value Set
          GOTO     FVSDES10   * Next
.
FVSDES99  RETURN
+
.------------------------------------------------------------
. Process Category/Codes Request
.------------------------------------------------------------
PROCAT00  KEYIN    *P1:17,"Start Category : ",CATSTRCD
          KEYIN    *P1:18,"End   Category : ",CATENDCD
.
          PACK     CATSTRCD,CATSTRCD,SP70
          PACK     CATENDCD,CATENDCD,SP70
.
          PACK     KEY5,SP3,CATSTRCD,SP70
          CALL     RDCODE3
          IF       OVRCD=0
            CALL     RDPCODE3
          ENDIF
PROCAT10  CALL     RDKCODE3
          BRANCH   OVRCD,PROCAT99
          MATCH    SP70,ACODE
          GOTO     PROCAT99 IF NOT EQUAL
          MATCH    TCODE,CATENDCD
          GOTO     PROCAT20 IF EQUAL
          GOTO     PROCAT99 IF LESS
.
PROCAT20  MOVE     TCODE,SELCAT
          CALL     CATDES00     * Output in Description Sequence
.
          MATCH    "CG",SELCAT
          IF       @EQUAL
            CALL     MENCLI00
          ENDIF
.
          GOTO     PROCAT10
.
PROCAT99  RETURN
+
.------------------------------------------------------------
. Output Page in Description Sequence
.------------------------------------------------------------
CATDES00  CLEAR    WBLILKID
          APPEND   "CodeCT",WBLILKID
          APPEND   SELCAT,WBLILKID
          RESET    WBLILKID
          REP      " _",WBLILKID
          MOVE     "000",WBLPPGNO
          MOVE     TDESC,WBLPTITL
          MOVE     TDESC,WBLPHEAD
          MOVE     SP70,WBLPCLOR
.
          CALL     MAKPAG00    * Create Output File for Lookup
          CALL     MAKJSC00    * Create Output File for Javascript
.
          MOVE     SP70,FVSNAME
          MOVE     SP70,FVSDESC
          MOVE     SP70,FVSLDESC
.
          CALL     MAKFVS00    * Create Output File for FHIR ValueSet
.
          MOVE     SP70,DEFAULTC
          MOVE     SP70,DEFAULTD
          PACK     KEY25,SELCAT,SP70
          PACK     PTCDKEY2,SELCAT,SP70
          CALL     RDSCODE2
CATDES10  CALL     RDKCODE2
          BRANCH   OVRCD,CATDES90
          MATCH    TCODE,SELCAT
          GOTO     CATDES90 IF NOT EQUAL
          MATCH    SP70,ACODE
          GOTO     CATDES10 IF EQUAL
          MATCH    "1",PTCDDEFT
          IF       @EQUAL
            MOVE     ACODE,DEFAULTC
            MOVE     PTCDLDES,DEFAULTD
          ENDIF
          
.
          MATCH    ANSI,PTCOACTV           * dont include inactive codes
          GOTO     CATDES10 IF EQUAL
.
          REP      "' ",TDESC
          REP      "#" ",TDESC
          MOVE     ONE,WBLDTYPE
          MOVE     ACODE,WBLDCODE
          MOVE     TDESC,WBLDDESC
.
          CALL     DETLIN00   * Output Detail Line for Lookup
          CALL     JSCLIN00   * Output Detail Line for Javascript
.
          BRANCH   FVSGENR,CATDES10
          CALL     FVSLIN00   * Output Detail Line for FHIR Value Set
          GOTO     CATDES10   * Next
.
CATDES90  MOVE     ZERO,CHECKBOX
          CALL     ENDPGC00   * End Lookup Page
          CALL     OVWRPG00   * Overwrite original Lookup Page
.
          CALL     ENDJSC00   * End Javascript Page
          CALL     OVWRJS00   * Overwrite original Javascript Page
.
          BRANCH   FVSGENR,CATDES99  * FHIR Directory Not Available
          CALL     ENDFVS00   * End FHIR ValueSet page
          CALL     OVWRFV00   * Overwrite original FHIR ValueSet file with temp
.
CATDES99  RETURN
+
.------------------------------------------------------------
. Javascript Detail Line
.------------------------------------------------------------
JSCLIN00  PACK      KEY10,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5:
                          TCINDC6,TCINDC7,TCINDC8,TCINDC9,TCINDC10
          WRITE    JSCPOUTF,SEQ;"ListItem.options[ListItem.options.length]="
          WRITE    JSCPOUTF,SEQ;" new Option(#"",TDESC,"#",#"",ACODE,KEY10:
                                "#");"
JSCLIN99  RETURN
+
.------------------------------------------------------------
. FHIR ValueSet Detail Line
.------------------------------------------------------------
FVSLIN00  PACK      KEY10,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5:
                          TCINDC6,TCINDC7,TCINDC8,TCINDC9,TCINDC10
          ADD      ONE,FVSLINE
          IF       FVSLINE>1
            WRITE    FVSPOUTF,SEQ;", ";
          ENDIF
          STRIP    ACODE
          STRIP    PTCDLDES
          WRITE    FVSPOUTF,SEQ;*+,"{ #"code#" : #"",ACODE,"#",  ":
                                "  #"display#" : #"",PTCDLDES,"#" } ";
FVSLIN99  RETURN
+
.------------------------------------------------------------
. Make Javascript 
.------------------------------------------------------------
MAKFVS00  MOVE     ZERO,FVSGENR
          MATCH    SP70,FVSNAME
          IF       @EQUAL
            CLEAR    FVSNAME
            APPEND   "Category-",FVSNAME
            MOVE     SELCAT,KEY2
            REP      " -",KEY2
            APPEND   KEY2,FVSNAME 
            RESET    FVSNAME
            MOVE     TDESC,FVSDESC
            MOVE     PTCDLDES,FVSLDESC
          ENDIF
.
          MOVE     ZERO,CHECKBOX
          MOVE     ZERO,FVSLINE
          STRIP    FVSNAME
          STRIP    FVSDESC
          STRIP    FVSLDESC
          CLEAR    FVSPOUTN
          STRIP    CWEBROOT
          APPEND   CWEBROOT,FVSPOUTN
          APPEND   "fhir/valuesets/",FVSPOUTN
          APPEND   FVSNAME,FVSPOUTN
          APPEND   ".vs.tmp",FVSPOUTN
          RESET    FVSPOUTN
.
          PACK     KEY8,CCC,CYY,CMM,CDD
          REP      " 0",KEY8
          UNPACK   KEY8,CCENT,CYEAR,CMON,CDAY
          CALL     PACDATE
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          PREP     FVSPOUTF,FVSPOUTN
          TRAPCLR  IO
          MOVE     OVRCD,FVSGENR    * Generate only if file can be created
          BRANCH   FVSGENR,MAKFVS99
.
          STRIP    PTCDLDES
          STRIP    TDESC
          STRIP    TDESC
          WRITE    FVSPOUTF,SEQ;*+,"{ #"resourceType#" : #"ValueSet#", ":
                                  "   #"url#": #"%BASEURL/ValueSet/",FVSNAME,"#",":
                                  "   #"id#": #"",FVSNAME,"#", ":
                                  "   #"status#": #"active#", ":
                                  "   #"title#": #"",FVSDESC,"#", ":
                                  "   #"description#": #"",FVSLDESC,"#", ":
                                  "   #"date#": #"",CCENT,CYEAR,"-",CMON,"-",CDAY,"#", ":
                                  "   #"expansion#": { ":
                                  "   #"contains#": [  ";
          MOVE     SP70,FVSDESC
          MOVE     SP70,FVSLDESC
MAKFVS99  RETURN
+
.------------------------------------------------------------
. End Page - FHIR ValueSet
.------------------------------------------------------------
ENDFVS00  WRITE    FVSPOUTF,SEQ;*+," ] }";
          MATCH    SP70,DEFAULTC
          IF       !@EQUAL
            WRITE    FVSPOUTF,SEQ;*+,", #"extension#": [":
                        " { #"url#":#"%BASEURL/extension/dxc-hc-defaultvalue#"":
                        " ,#"valueCoding#": {":
                        " #"code#": #"",DEFAULTC,"#",":
                        " #"display#":#"",DEFAULTD,"#"} } ]";
          ENDIF
          WRITE    FVSPOUTF,SEQ;*+," }";
          CLOSE    FVSPOUTF
ENDFVS99  RETURN
+
.-------------------------------------------------------------------------------
. Overwrite the original FHIR ValueSet file with the newly generated file
.-------------------------------------------------------------------------------
OVWRFV00  CLEAR     FVSPOFIN
          STRIP     CWEBROOT
          APPEND    CWEBROOT,FVSPOFIN
          APPEND    "fhir/valuesets/",FVSPOFIN
          APPEND    FVSNAME,FVSPOFIN
          APPEND    ".vs",FVSPOFIN
          RESET     FVSPOFIN
.
          CLEAR     CMDLINE
          PACK      CMDLINE,MOVECMND,FVSPOUTN,SP1,FVSPOFIN,SP70
          EXECUTE   CMDLINE,TASKID   * overwrite original file with temp file
.
OVWRFV99  RETURN
+
.------------------------------------------------------------
. Make Javascript 
.------------------------------------------------------------
MAKJSC00  MOVE     ZERO,CHECKBOX
          CLEAR    JSCPOUTN
          STRIP    CWEBROOT
          APPEND   CWEBROOT,JSCPOUTN
          APPEND   "js/IBA_Category_",JSCPOUTN
          MOVE     SELCAT,KEY2
          REP      " _",KEY2
          APPEND   KEY2,JSCPOUTN
          APPEND   ".js.tmp",JSCPOUTN
          RESET    JSCPOUTN
.
          PACK     KEY8,CCC,CYY,CMM,CDD
          REP      " 0",KEY8
          UNPACK   KEY8,CCENT,CYEAR,CMON,CDAY
          CALL     PACDATE
          PREP     JSCPOUTF,JSCPOUTN
          WRITE    JSCPOUTF,SEQ;"//==========================================="
          WRITE    JSCPOUTF,SEQ;"// Javascript options for Category ",SELCAT:
                                SP1,TDESC
          WRITE    JSCPOUTF,SEQ;"// Generated on ",CPCDATE
          WRITE    JSCPOUTF,SEQ;"//==========================================="
          WRITE    JSCPOUTF,SEQ;"//==========================================="
          MOVE     SELCAT,KEY2
          REP      " _",KEY2
          WRITE    JSCPOUTF,SEQ;"function SetCategory",KEY2:
                                "(ListItem,SelectedCode,DefaultCode) {"

MAKJSC99  RETURN
+
.------------------------------------------------------------
. End Page - Javascript
.------------------------------------------------------------
ENDJSC00  WRITE    JSCPOUTF,SEQ;"if (DefaultCode!=#"undefined#") {"
          WRITE    JSCPOUTF,SEQ;"  if (!isWhitespace(DefaultCode)){"
          WRITE    JSCPOUTF,SEQ;"  SelectedCode=#"",DEFAULTC,"#" } }"
          WRITE    JSCPOUTF,SEQ;"if (isWhitespace(SelectedCode)) {"
          WRITE    JSCPOUTF,SEQ;"  return }"
          WRITE    JSCPOUTF,SEQ;"for (var i =0 ; i < ListItem.length; i++) {"
          WRITE    JSCPOUTF,SEQ;"   if (ListItem.options[i].value.substr(0,3)":
                               "==SelectedCode) {"
          WRITE    JSCPOUTF,SEQ;"         ListItem.selectedIndex=i } };"
          WRITE    JSCPOUTF,SEQ;"}"
          WRITE    JSCPOUTF,SEQ;"// End of Javascript"
          CLOSE    JSCPOUTF
ENDJSC99  RETURN
+
.-------------------------------------------------------------------------------
. Overwrite the Locations files with the newly generated temp files
.-------------------------------------------------------------------------------
OVWRJS00  CLEAR     JSCPOFIN
          STRIP     CWEBROOT
          APPEND    CWEBROOT,JSCPOFIN
          APPEND    "js/IBA_Category_",JSCPOFIN
          MOVE      SELCAT,KEY2
          REP       " _",KEY2
          APPEND    KEY2,JSCPOFIN
          APPEND    ".js",JSCPOFIN
          RESET     JSCPOFIN
.
          CLEAR     CMDLINE
          PACK      CMDLINE,MOVECMND,JSCPOUTN,SP1,JSCPOFIN,SP70
          EXECUTE   CMDLINE,TASKID   * overwrite original file with temp file
.
OVWRJS99  RETURN
+
.------------------------------------------------------------
. Process Common Category/Codes Request
.------------------------------------------------------------
COMCAT00  KEYIN    *P1:17,"Start Category : ",CATSTRCD
          KEYIN    *P1:18,"End   Category : ",CATENDCD
          PACK     KEY5,SP3,CATSTRCD,SP70
          CALL     RDCMCOD3
          IF       OVRCD=0
            CALL     RPCMCOD3
          ENDIF
COMCAT10  CALL     RKCMCOD3
          BRANCH   OVRCD,COMCAT99
          MATCH    SP70,CMCDACOD
          GOTO     COMCAT99 IF NOT EQUAL
          MATCH    CMCDTCOD,CATENDCD
          GOTO     COMCAT20 IF EQUAL
          GOTO     COMCAT99 IF LESS
.
COMCAT20  MOVE     CMCDTCOD,SELCAT
          CALL     COMDES00     * Output in Description Sequence
          GOTO     COMCAT10
.
COMCAT99  RETURN
+
.------------------------------------------------------------
. Output Page in Description Sequence for Common Codes
.------------------------------------------------------------
COMDES00  CLEAR    WBLILKID
          APPEND   "CommCT",WBLILKID
          APPEND   SELCAT,WBLILKID
          RESET    WBLILKID
          REP      " _",WBLILKID
          MOVE     "000",WBLPPGNO
          MOVE     CMCDDESC,WBLPTITL
          MOVE     CMCDDESC,WBLPHEAD
          MOVE     SP70,WBLPCLOR
.
          CALL     MAKPAG00    * Create Output File for Lookup
          CALL     CMMJSC00    * Create Output File for Javascript
.
          MOVE     SP70,DEFAULTC
          PACK     KEY25,SELCAT,SP70
          CALL     RSCMCOD2
COMDES10  CALL     RKCMCOD2
          BRANCH   OVRCD,COMDES90
          MATCH    CMCDTCOD,SELCAT
          GOTO     COMDES90 IF NOT EQUAL
          MATCH    SP70,CMCDACOD
          GOTO     COMDES10 IF EQUAL
          MATCH    "1",CMCDDEFT
          IF       @EQUAL
            MOVE     CMCDACOD,DEFAULTC
          ENDIF
.
          CALL      IBACLOCK
          PACK     CODEDATE,CCC,CYY,CMM,CDD
          REP      " 0",CODEDATE
          MATCH    SP70,CMCDFMDT           * dont include inactive codes
          GOTO     COMDES20 IF EQUAL
          MATCH    CMCDFMDT,CODEDATE
          GOTO     COMDES10 IF LESS
.
          MATCH    SP70,CMCDTODT           * dont include inactive codes
          GOTO     COMDES20 IF EQUAL
          MATCH    CODEDATE,CMCDTODT
          GOTO     COMDES10 IF LESS
.
COMDES20  REP      "' ",CMCDDESC
          REP      "#" ",CMCDDESC
          MOVE     ONE,WBLDTYPE
          MOVE     CMCDACOD,WBLDCODE
          MOVE     CMCDDESC,WBLDDESC
.
          CALL     DETLIN00   * Output Detail Line for Lookup
          CALL     CMJSCL00   * Output Detail Line for Javascript
.
          GOTO     COMDES10   * Next
.
COMDES90  MOVE     ZERO,CHECKBOX
          CALL     ENDPGC00   * End Lookup Page
          CALL     OVWRPG00   * Overwrite original Lookup Page
.
          CALL     ENDJSC00   * End Javascript Page
          CALL     OVWRCJ00   * Overwrite original Javascript Page
.
COMDES99  RETURN
+
.------------------------------------------------------------
. Javascript Detail Line for Common Codes
.------------------------------------------------------------
CMJSCL00  PACK      KEY10,CMCDSI01,CMCDSI02,CMCDSI03,CMCDSI04,CMCDSI05:
                          CMCDSI06,CMCDSI07,CMCDSI08,CMCDSI09,CMCDSI10
          WRITE    JSCPOUTF,SEQ;"ListItem.options[ListItem.options.length]="
          WRITE    JSCPOUTF,SEQ;" new Option(#"",CMCDDESC,"#",#"",CMCDACOD:
                                KEY10,"#");"
CMJSCL99  RETURN
+
.------------------------------------------------------------
. Make Javascript 
.------------------------------------------------------------
CMMJSC00  MOVE     ZERO,CHECKBOX
          CLEAR    JSCPOUTN
          STRIP    CWEBROOT
          APPEND   CWEBROOT,JSCPOUTN
          APPEND   "js/IBA_CommonCategory_",JSCPOUTN
          MOVE     SELCAT,KEY2
          REP      " _",KEY2
          APPEND   KEY2,JSCPOUTN
          APPEND   ".js.tmp",JSCPOUTN
          RESET    JSCPOUTN
.
          PACK     KEY8,CCC,CYY,CMM,CDD
          REP      " 0",KEY8
          UNPACK   KEY8,CCENT,CYEAR,CMON,CDAY
          CALL     PACDATE
          PREP     JSCPOUTF,JSCPOUTN
          WRITE    JSCPOUTF,SEQ;"//==========================================="
          WRITE    JSCPOUTF,SEQ;"// Javascript options for Common Category ":
                                SELCAT,SP1,CMCDDESC
          WRITE    JSCPOUTF,SEQ;"// Generated on ",CPCDATE
          WRITE    JSCPOUTF,SEQ;"//==========================================="
          WRITE    JSCPOUTF,SEQ;"//==========================================="
          MOVE     SELCAT,KEY2
          REP      " _",KEY2
          WRITE    JSCPOUTF,SEQ;"function SetCategory",KEY2:
                                "(ListItem,SelectedCode) {"

CMMJSC99  RETURN
+
.-------------------------------------------------------------------------------
. Overwrite the Locations files with the newly generated temp files
.-------------------------------------------------------------------------------
OVWRCJ00  CLEAR    JSCPOFIN
          STRIP    CWEBROOT
          APPEND   CWEBROOT,JSCPOFIN
          APPEND   "js/IBA_CommonCategory_",JSCPOFIN
          MOVE     SELCAT,KEY2
          REP      " _",KEY2
          APPEND   KEY2,JSCPOFIN
          APPEND   ".js",JSCPOFIN
          RESET    JSCPOFIN
.
          CLEAR     CMDLINE
          PACK      CMDLINE,MOVECMND,JSCPOUTN,SP1,JSCPOFIN,SP70
          EXECUTE   CMDLINE,TASKID   * overwrite original file with temp file
.
OVWRCJ99  RETURN
+
.-------------------------------------------------------------------------------
. Output Page MRT Tracking Locations in Description Sequence (single Hospital)
.-------------------------------------------------------------------------------
MRTLOC00  CALL     MRTJSC00    * Create Output File for Javascripts
          READ     CONTROLF,SIXTY;*105,MRCNHMTY
.
          PACK     KEY37,SP70
          CALL     RSMRLOC3
MRTLOC10  CALL     RKMRLOC3
          BRANCH   OVRCD,MRTLOC90
.
          MATCH    SP3,MRLOHOSP
          GOTO     MRTLOC10 IF NOT EQUAL
.
.         BRANCH   MRLOSTAT,MRTLOC10        * Inactive
.
          IF       HOMEONLY = 1
            MATCH    MRCNHMTY,MRLOTYPE      * check if a Home Location type
            GOTO     MRTLOC10 IF NOT EQUAL
          ENDIF          
.
          CALL     MRTLIN00   * Output Detail Line for Javascript
          GOTO     MRTLOC10   * Next
.
MRTLOC90  MOVE     ZERO,CHECKBOX
          CALL     MRTEND00   * End MRT Javascript Pages
.
MRTLOC99  RETURN
+
.-------------------------------------------------------------------------------
. Create MRT Tracking Locations javascripts (Single Hospital)
. creates two files,
.    JSCPOUTF with active locations only
.    JSCPLOCF with all locations - active and inactive
.------------------------------------------------------------------------------
MRTJSC00  MOVE     ZERO,CHECKBOX
          CLEAR    JSCPOUTN
          STRIP    CWEBROOT
          APPEND   CWEBROOT,JSCPOUTN
.
          CLEAR    JSCPLOCN
          STRIP    CWEBROOT
          APPEND   CWEBROOT,JSCPLOCN
.
          IF       HOMEONLY = 1
            APPEND   "js/MrtHomeLocns.js",JSCPOUTN
            APPEND   "js/MrtHomeLocnsAll.js",JSCPLOCN
          ELSE
            APPEND   "js/MrtLocations.js",JSCPOUTN
            APPEND   "js/MrtLocationsAll.js",JSCPLOCN
          ENDIF
.
          RESET    JSCPOUTN
          RESET    JSCPLOCN
.
          PACK     KEY8,CCC,CYY,CMM,CDD
          REP      " 0",KEY8
          UNPACK   KEY8,CCENT,CYEAR,CMON,CDAY
          CALL     PACDATE
.
          PREP     JSCPOUTF,JSCPOUTN
          WRITE    JSCPOUTF,SEQ;"//===========================================":
                                "==================="
.
          PREP     JSCPLOCF,JSCPLOCN
          WRITE    JSCPLOCF,SEQ;"//======================================":
                                "========================"
.
          IF       HOMEONLY = 1
            WRITE    JSCPOUTF,SEQ;"// Javascript options Medical Records ": 
                                  "Tracking Home Locations" 
            WRITE    JSCPOUTF,SEQ;"// Active Home Locations only"
.
            WRITE    JSCPLOCF,SEQ;"// Javascript options Medical Records ": 
                                  "Tracking Home Locations" 
            WRITE    JSCPLOCF,SEQ;"// All Home Locations (active and inactive)"
          ELSE
            WRITE    JSCPOUTF,SEQ;"// Javascript options Medical Records ": 
                                  "Tracking Locations" 
            WRITE    JSCPOUTF,SEQ;"// Active Locations only"
.
            WRITE    JSCPLOCF,SEQ;"// Javascript options Medical Records ": 
                                  "Tracking Locations" 
            WRITE    JSCPLOCF,SEQ;"// All Locations (active and inactive)" 
          ENDIF
.
          WRITE    JSCPOUTF,SEQ;"// Generated by GENWEB01 on ",CPCDATE
          WRITE    JSCPOUTF,SEQ;"//===========================================":
                                "==================="
          WRITE    JSCPOUTF,SEQ;"//===========================================":
                                "==================="
.
          WRITE    JSCPLOCF,SEQ;"// Generated by GENWEB01 on ",CPCDATE
          WRITE    JSCPLOCF,SEQ;"//======================================":
                                "========================"
.
          IF       HOMEONLY = 1
            WRITE    JSCPOUTF,SEQ;"function MrtHomeLocns":
                                  "(ListItem,SelectedCode) {"
.
            WRITE    JSCPLOCF,SEQ;"function MrtHomeLocnsAll":
                                  "(ListItem,SelectedCode) {"
          ELSE
            WRITE    JSCPOUTF,SEQ;"function MrtLocations":
                                  "(ListItem,SelectedCode) {"
.
            WRITE    JSCPLOCF,SEQ;"function MrtLocationsAll":
                                  "(ListItem,SelectedCode) {"
          ENDIF
.
MRTJSC99  RETURN
+
.-------------------------------------------------------------------------------
. Create MRT Tracking Locations Javascript Detail Lines
.-------------------------------------------------------------------------------
MRTLIN00  BRANCH   MRLOSTAT,MRTLIN50             * Inactive
.
          WRITE    JSCPOUTF,SEQ;"ListItem.options[ListItem.options.length]="
          WRITE    JSCPOUTF,SEQ;" new Option(#"",MRLODESC,"#",#"",MRLOCODE:
                                "#");"
.
MRTLIN50  WRITE    JSCPLOCF,SEQ;"ListItem.options[ListItem.options.length]="
          WRITE    JSCPLOCF,SEQ;" new Option(#"",MRLODESC,"#",#"",MRLOCODE:
                                "#");"
.
MRTLIN99  RETURN
+
.-------------------------------------------------------------------------------
. Finalise MRT Tracking Locations Javascripts
.-------------------------------------------------------------------------------
MRTEND00  WRITE    JSCPOUTF,SEQ;"for (var i = 0 ; i < ListItem.length; i++) {"
          WRITE    JSCPOUTF,SEQ;"   if (ListItem.options[i].value":
                               " == SelectedCode) {"
          WRITE    JSCPOUTF,SEQ;"         ListItem.selectedIndex = i } };"
          WRITE    JSCPOUTF,SEQ;"}"
          WRITE    JSCPOUTF,SEQ;"// End of Javascript"
          CLOSE    JSCPOUTF
.
          WRITE    JSCPLOCF,SEQ;"for (var i = 0 ; i < ListItem.length; i++) {"
          WRITE    JSCPLOCF,SEQ;"   if (ListItem.options[i].value":
                               " == SelectedCode) {"
          WRITE    JSCPLOCF,SEQ;"         ListItem.selectedIndex = i } };"
          WRITE    JSCPLOCF,SEQ;"}"
          WRITE    JSCPLOCF,SEQ;"// End of Javascript"
          CLOSE    JSCPLOCF
.
MRTEND99  RETURN
+
.------------------------------------------------------------
. Create post code javascript
.------------------------------------------------------------
POST0000  KEYIN     *P1:17,"Default Post Code : ",DEFTCODE
          KEYIN     *P1:18,"Default Suburb    : ",DEFTSUBR
          KEYIN     *P1:19,"Default State     : ",DEFTSTAT
.
          CALL      AUTO0000             * Auto select post codes
.
          PACK      DEFTCODE,DEFTCODE,SP70
          STRIP     DEFTSUBR
          STRIP     DEFTSTAT
.
          CALL      STRTPC00             * Create javascript functions
.
          MOVE      ZERO,LOOPCNTR        * IE7 doesn't like js functions with
.                                        * more that 32769 lines
          PACK      KEY56,SP70                                        *C-240184
          CALL      RSIBPOS1
POST1000  CALL      RKIBPOS1
          BRANCH    OVRCD,POST9000

          CALL      INPC0000             * InitPostCodes function line
.
          ADD       ONE,LOOPCNTR
.
          IF        LOOPCNTR=12000
            WRITE     PCJSFILE,SEQ;"InitPostCodesA() "
            WRITE     PCJSFILE,SEQ;"}"
            WRITE     PCJSFILE,SEQ;"function InitPostCodesA() {"
          ENDIF
.
          IF        LOOPCNTR=24000
            WRITE     PCJSFILE,SEQ;"InitPostCodesB() "
            WRITE     PCJSFILE,SEQ;"}"
            WRITE     PCJSFILE,SEQ;"function InitPostCodesB() {"
          ENDIF
.
          IF        LOOPCNTR=36000
            WRITE     PCJSFILE,SEQ;"InitPostCodesC() "
            WRITE     PCJSFILE,SEQ;"}"
            WRITE     PCJSFILE,SEQ;"function InitPostCodesC() {"
          ENDIF
.
          GOTO      POST1000
.
POST9000  WRITE     PCJSFILE,SEQ;"}"
          WRITE     PCJSFILE,SEQ;"// End of Postcode Javascript"
.
POST9999  RETURN
.------------------------------------------------------------
.  Postcode javascript functions
.------------------------------------------------------------
STRTPC00  CLEAR     PCJSNAME
          STRIP     CWEBROOT
          APPEND    CWEBROOT,PCJSNAME
          APPEND   "js/AutoPostCode.js",PCJSNAME
          RESET     PCJSNAME
          PREP      PCJSFILE,PCJSNAME
.
          CALL      IBACLOCK
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          UNPACK    KEY8,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
.
          WRITE     PCJSFILE,SEQ;"//-------------------------------------------"
          WRITE     PCJSFILE,SEQ;"// Automatic Post Codes                      "
          WRITE     PCJSFILE,SEQ;"// Generated on ",CPCDATE
          WRITE     PCJSFILE,SEQ;"// This file is generated by GENWEB01        "
          WRITE     PCJSFILE,SEQ;"//     ** Do not edit this file! **          "
          WRITE     PCJSFILE,SEQ;"//-------------------------------------------"
          WRITE     PCJSFILE,SEQ;"var PC = new Array();"
          WRITE     PCJSFILE,SEQ;"var SelectPC = new Array();"
          WRITE     PCJSFILE,SEQ;"var state;"
          WRITE     PCJSFILE,SEQ;"var suburb;"
          WRITE     PCJSFILE,SEQ;"var postcode;"
          WRITE     PCJSFILE,SEQ;"var defaultstate=#"",DEFTSTAT,"#";"
.
          MATCH     ANSY,EXACTMCH
          IF        @EQUAL
            WRITE     PCJSFILE,SEQ;"var exactmatch=#"Yes#";"
          ELSE
            WRITE     PCJSFILE,SEQ;"var exactmatch=#"No#";"
          ENDIF
.
          WRITE     PCJSFILE,SEQ;"//"
          WRITE     PCJSFILE,SEQ;""
          WRITE     PCJSFILE,SEQ;"function LookupPostCode(AddressLine) "
          WRITE     PCJSFILE,SEQ;"{"
          WRITE     PCJSFILE,SEQ;"  if(AddressLine==#"#")"
          WRITE     PCJSFILE,SEQ;"  {"
          WRITE     PCJSFILE,SEQ;"    alert(#"Enter a Suburb#");"
.         WRITE     PCJSFILE,SEQ;"    suburb.focus();"
          WRITE     PCJSFILE,SEQ;"    FocusDelay(suburb);"
          WRITE     PCJSFILE,SEQ;"    return; "
          WRITE     PCJSFILE,SEQ;"  }"
          WRITE     PCJSFILE,SEQ;"  SelectPC.length = 0;"
          WRITE     PCJSFILE,SEQ;"  //"
          WRITE     PCJSFILE,SEQ;"  //Remove trailing spaces from Address Line"
          WRITE     PCJSFILE,SEQ;"  //"
          WRITE     PCJSFILE,SEQ;"  AddressLine=AddressLine.split(/\s/);"
          WRITE     PCJSFILE,SEQ;"  var theaddress=#"#";"
          WRITE     PCJSFILE,SEQ;"  for (var inc=0; inc<AddressLine.length;":
                                  " inc++) "
          WRITE     PCJSFILE,SEQ;"  {"
          WRITE     PCJSFILE,SEQ;"    theaddress=theaddress + AddressLine[inc];"
          WRITE     PCJSFILE,SEQ;"    if (inc<(AddressLine.length-1))"
          WRITE     PCJSFILE,SEQ;"    {"
          WRITE     PCJSFILE,SEQ;"      theaddress=theaddress + #" #";"
          WRITE     PCJSFILE,SEQ;"    }"
          WRITE     PCJSFILE,SEQ;"  }"
          WRITE     PCJSFILE,SEQ;"  AddressLine=theaddress;"
.
          WRITE     PCJSFILE,SEQ;"  var expression = ":
                                 "#",#" + AddressLine;"
          WRITE     PCJSFILE,SEQ;"  var pattern = ":
                                 "new RegExp(expression.toUpperCase());"
.
          WRITE     PCJSFILE,SEQ;"  var exact_expression = ":
                                 "#",#" + AddressLine + #",#";"
          WRITE     PCJSFILE,SEQ;"  var exact_pattern = ":
                                 "new RegExp(exact_expression.toUpperCase());"
.
          WRITE     PCJSFILE,SEQ;"  if (exactmatch==#"Yes#")"
          WRITE     PCJSFILE,SEQ;"  {"
          WRITE     PCJSFILE,SEQ;"    for (var i=0; i<PC.length; i++)"
          WRITE     PCJSFILE,SEQ;"    {"
          WRITE     PCJSFILE,SEQ;"      if (PC[i].match(exact_pattern)) "
          WRITE     PCJSFILE,SEQ;"      {"
          WRITE     PCJSFILE,SEQ;"        SelectPC[SelectPC.length] = PC[i];"
          WRITE     PCJSFILE,SEQ;"      }"
          WRITE     PCJSFILE,SEQ;"    }"
          WRITE     PCJSFILE,SEQ;"  }"
.
          WRITE     PCJSFILE,SEQ;"  if (SelectPC.length==0) "
          WRITE     PCJSFILE,SEQ;"  {"
          WRITE     PCJSFILE,SEQ;"    for (var i=0; i<PC.length; i++) "
          WRITE     PCJSFILE,SEQ;"    {"
          WRITE     PCJSFILE,SEQ;"      if (PC[i].match(pattern))"
          WRITE     PCJSFILE,SEQ;"      {"
          WRITE     PCJSFILE,SEQ;"        SelectPC[SelectPC.length] = PC[i];"
          WRITE     PCJSFILE,SEQ;"      }"
          WRITE     PCJSFILE,SEQ;"    }"
          WRITE     PCJSFILE,SEQ;"  }"
.
          WRITE     PCJSFILE,SEQ;"  SetPostCodeHeading();"
          WRITE     PCJSFILE,SEQ;"  for (var i=0; i < SelectPC.length; i++)"
          WRITE     PCJSFILE,SEQ;"  {"
          WRITE     PCJSFILE,SEQ;"    PCFields=SelectPC[i].split(#",#");"
          WRITE     PCJSFILE,SEQ;"    SelectPostCode += #"<tr>":
                                 "<td align=center>#" +"
          WRITE     PCJSFILE,SEQ;"                       ":
                                 "#"<a href=javascript:parent.UpdateFields":
                                 "(#" + i + #");>#" +"
.
          WRITE     PCJSFILE,SEQ;"                       ":
                                 "PCFields[0]  + #"</a></td>#";"
          WRITE     PCJSFILE,SEQ;"    if (defaultstate==PCFields[2])"
          WRITE     PCJSFILE,SEQ;"    {"
          WRITE     PCJSFILE,SEQ;"     SelectPostCode += ":
                                 "#"<td class=\#"Red\#">#"":
                                 " + PCFields[1] + #"</td>#" +"
          WRITE     PCJSFILE,SEQ;"                       ":
                                 "#"<td class=\#"Red\#">#"":
                                 " + PCFields[2] + #"</td></tr>#";"
          WRITE     PCJSFILE,SEQ;"    } "
          WRITE     PCJSFILE,SEQ;"    else "
          WRITE     PCJSFILE,SEQ;"    {  "
          WRITE     PCJSFILE,SEQ;"     SelectPostCode += ":
                                 "#"<td>#" + PCFields[1] + #"</td>#" +"
          WRITE     PCJSFILE,SEQ;"                       ":
                                 "#"<td>#" + PCFields[2] + #"</td></tr>#";"
          WRITE     PCJSFILE,SEQ;"     }"
          WRITE     PCJSFILE,SEQ;"  }"
.
          WRITE     PCJSFILE,SEQ;"  if (SelectPC.length==0)"
          WRITE     PCJSFILE,SEQ;"  {"
          WRITE     PCJSFILE,SEQ;"    alert(#"Postcode not found for #" + ":
                                 "AddressLine);"
          WRITE     PCJSFILE,SEQ;"    suburb.select();"
          WRITE     PCJSFILE,SEQ;"    return;"
          WRITE     PCJSFILE,SEQ;"  }"
          WRITE     PCJSFILE,SEQ;"  if (SelectPC.length==1) {"
          WRITE     PCJSFILE,SEQ;"    UpdateFields(0);"
          WRITE     PCJSFILE,SEQ;"    return;"
          WRITE     PCJSFILE,SEQ;"  }"
          WRITE     PCJSFILE,SEQ;"  ShowPostCodes();"
          WRITE     PCJSFILE,SEQ;"}"
          WRITE     PCJSFILE,SEQ;""
          WRITE     PCJSFILE,SEQ;"function ShowPostCodes() "
          WRITE     PCJSFILE,SEQ;"{"
          WRITE     PCJSFILE,SEQ;"  var PopUpScreen = ":
                                 "document.getElementById('PopUpScreen');"
          WRITE     PCJSFILE,SEQ;"  var PopUpFrame = ":
                                 "document.getElementById('PopUpFrame');"
          WRITE     PCJSFILE,SEQ;"  var top = ":
                                 "document.body.scrollTop + 50;"
          WRITE     PCJSFILE,SEQ;"  SelectPostCode += #"</table></div>#""
          WRITE     PCJSFILE,SEQ;"  PopUpFrame.src=#"":
                                 "javascript:parent.SelectPostCode#";"
          WRITE     PCJSFILE,SEQ;"  PopUpScreen.style.top=":
                                 "top + 'px';"
          WRITE     PCJSFILE,SEQ;"  PopUpScreen.style.right   = '50px';"
          WRITE     PCJSFILE,SEQ;"  PopUpScreen.style.scroll  = 'auto';"
          WRITE     PCJSFILE,SEQ;"  PopUpScreen.style.width   = '300px';"
          WRITE     PCJSFILE,SEQ;"  PopUpScreen.style.height  = '220px'"
          WRITE     PCJSFILE,SEQ;"  PopUpScreen.style.display = #"#";"
          WRITE     PCJSFILE,SEQ;"}"
          WRITE     PCJSFILE,SEQ;""
          WRITE     PCJSFILE,SEQ;"function SetPostCodeHeading() {"
          WRITE     PCJSFILE,SEQ;"  SelectPostCode=#"<link rel=\#"":
                                 "stylesheet\#" #" +"
          WRITE     PCJSFILE,SEQ;"                 ":
                                 "#"href=\#"../html/standard.css\#" #" +"
          WRITE     PCJSFILE,SEQ;"                 ":
                                 "#"type=\#"text/css\#">#" +"
          WRITE     PCJSFILE,SEQ;"                 ":
                                 "#"<link rel=\#"stylesheet\#" #" +"
          WRITE     PCJSFILE,SEQ;"                 ":
                                 "#"href=\#"../html/custom.css\#" #" +"
          WRITE     PCJSFILE,SEQ;"                 #"type=\#"text/css\#">#" +"
          WRITE     PCJSFILE,SEQ;"                 ":
                                 "#"<script language=\#"javascript\#"":
                                 " src=\#"../js/Standard.js\#">#" +"
          WRITE     PCJSFILE,SEQ;"                 #"</script>#" +"
          WRITE     PCJSFILE,SEQ;"                 ":
                                 "#"<script language=\#"javascript\#"":
                                 " src=\#"../js/Custom.js\#">#" +"
          WRITE     PCJSFILE,SEQ;"                 #"</script>#" +"
          WRITE     PCJSFILE,SEQ;"                 #"</head>#" +"
          WRITE     PCJSFILE,SEQ;"                 #"<body onload='PageLoad(event);'>#" +"
          WRITE     PCJSFILE,SEQ;"                 ":
                                 "#"<span class=\#"DFrameTitleBar\#">#" +"
          WRITE     PCJSFILE,SEQ;"                 ":
                                "#"<img border=\#"0\#" align=\#"right\#" #" +"
          WRITE     PCJSFILE,SEQ;"                 ":
                                 "#"src=\#"../images/ExitIcon.gif\#" ":
                                 "onclick=\#"DFrameExit();\#">#" +"
          WRITE     PCJSFILE,SEQ;"                 ":
                                 "#"Post Code Search</span>#" +"
          WRITE     PCJSFILE,SEQ;"                 ":
                                 "#"<div style=\#"height:188px;":
                                 "overflow:auto;\#">#" +"
          WRITE     PCJSFILE,SEQ;"                 ":
                                 "#"<table cellpadding=\#"2\#" ":
                                 "cellspacing=\#"0\#" border=\#"0\#">#" +"
          WRITE     PCJSFILE,SEQ;"                 #"<tr>#" +"
          WRITE     PCJSFILE,SEQ;"                 ":
                               "#"<td class=\#"HeadingCell\#" align=\#"center\#" ":
                                 "width=\#"100\#">Post Code</td>#" +"
          WRITE     PCJSFILE,SEQ;"                 ":
                              "#"<td class=\#"HeadingCell\#" width=\#"200\#">":
                                 "Suburb</td>#" +"
          WRITE     PCJSFILE,SEQ;"                 ":
                               "#"<td class=\#"HeadingCell\#" width=\#"50\#">":
                                 "State</td></tr>#";"
          WRITE     PCJSFILE,SEQ;"}"
          WRITE     PCJSFILE,SEQ;""
          WRITE     PCJSFILE,SEQ;"function LookupSuburb(Postcode) "
          WRITE     PCJSFILE,SEQ;"{"
          WRITE     PCJSFILE,SEQ;"  if(Postcode==#"#") "
          WRITE     PCJSFILE,SEQ;"  {"
          WRITE     PCJSFILE,SEQ;"    alert(#"Enter a Postcode#");"
.         WRITE     PCJSFILE,SEQ;"    postcode.focus();"
          WRITE     PCJSFILE,SEQ;"    FocusDelay(postcode);"
          WRITE     PCJSFILE,SEQ;"    return;"
          WRITE     PCJSFILE,SEQ;"  }"
          WRITE     PCJSFILE,SEQ;"  SelectPC.length = 0;"
          WRITE     PCJSFILE,SEQ;"  Postcode = Postcode.replace(/'/,#" #");"
          WRITE     PCJSFILE,SEQ;"  var expression = #"^#" + Postcode;"
          WRITE     PCJSFILE,SEQ;"  var pattern = new RegExp":
                                 "(expression.toUpperCase());"
          WRITE     PCJSFILE,SEQ;"  for(var i =0; i<PC.length; i++)"
          WRITE     PCJSFILE,SEQ;"  {"
          WRITE     PCJSFILE,SEQ;"    if ( PC[i].match(pattern) ) "
          WRITE     PCJSFILE,SEQ;"      SelectPC[SelectPC.length] = PC[i]; "
          WRITE     PCJSFILE,SEQ;"  }"
          WRITE     PCJSFILE,SEQ;""
          WRITE     PCJSFILE,SEQ;"  SetPostCodeHeading();"
          WRITE     PCJSFILE,SEQ;"  for(var i =0; i < SelectPC.length; i++)  "
          WRITE     PCJSFILE,SEQ;"  {"
          WRITE     PCJSFILE,SEQ;"    PCFields=SelectPC[i].split(#",#");"
          WRITE     PCJSFILE,SEQ;"    SelectPostCode += ":
                                 " #"<tr><td align=center>#" +"
          WRITE     PCJSFILE,SEQ;"                    ":
                                 "#"<a href=javascript:parent.UpdateFields":
                                 "#(#" + i + #");>#" +"
          WRITE     PCJSFILE,SEQ;"                    ":
                                 "PCFields[0]  + #"</a></td>#";"
          WRITE     PCJSFILE,SEQ;"    if (defaultstate==PCFields[2])"
          WRITE     PCJSFILE,SEQ;"    {"
          WRITE     PCJSFILE,SEQ;"     SelectPostCode += ":
                                 "#"<td class=\#"Red\#">#"":
                                 " + PCFields[1] + #"</td>#" +"
          WRITE     PCJSFILE,SEQ;"                       ":
                                 "#"<td class=\#"Red\#">#"":
                                 " + PCFields[2] + #"</td></tr>#";"
          WRITE     PCJSFILE,SEQ;"    } "
          WRITE     PCJSFILE,SEQ;"    else "
          WRITE     PCJSFILE,SEQ;"    {  "
          WRITE     PCJSFILE,SEQ;"     SelectPostCode += ":
                                 "#"<td>#" + PCFields[1] + #"</td>#" +"
          WRITE     PCJSFILE,SEQ;"                       ":
                                 "#"<td>#" + PCFields[2] + #"</td></tr>#";"
          WRITE     PCJSFILE,SEQ;"     }"
          WRITE     PCJSFILE,SEQ;"  }"
          WRITE     PCJSFILE,SEQ;"  if(SelectPC.length==0) "
          WRITE     PCJSFILE,SEQ;"  {"
          WRITE     PCJSFILE,SEQ;"    alert(#"Suburb not found for #" + ":
                                 "Postcode);"
.         WRITE     PCJSFILE,SEQ;"    postcode.focus();"
          WRITE     PCJSFILE,SEQ;"    FocusDelay(postcode);"
          WRITE     PCJSFILE,SEQ;"    return;"
          WRITE     PCJSFILE,SEQ;"  }"
          WRITE     PCJSFILE,SEQ;"  if(SelectPC.length==1)"
          WRITE     PCJSFILE,SEQ;"  {"
          WRITE     PCJSFILE,SEQ;"    UpdateFields(0);"
          WRITE     PCJSFILE,SEQ;"   return;"
          WRITE     PCJSFILE,SEQ;"  }"
          WRITE     PCJSFILE,SEQ;"  ShowPostCodes();"
          WRITE     PCJSFILE,SEQ;"}"
          WRITE     PCJSFILE,SEQ;""
          WRITE     PCJSFILE,SEQ;"function UpdateFields(selected) "
          WRITE     PCJSFILE,SEQ;"{"
          WRITE     PCJSFILE,SEQ;"  document.getElementById('PopUpScreen')":
                                 ".style.display=#"none#";"
          WRITE     PCJSFILE,SEQ;"  if (AddressPostCodeFormat==0)"
          WRITE     PCJSFILE,SEQ;"  {"
          WRITE     PCJSFILE,SEQ;"    PCFields=SelectPC[selected].split(#",#");"
          WRITE     PCJSFILE,SEQ;"    postcode.value=PCFields[0];"
.                                                                     *C-252975
          WRITE     PCJSFILE,SEQ;"// T0862028 - start"
          WRITE     PCJSFILE,SEQ;"//  if (trim(PCFields[0])==#"8888#") {"
          WRITE     PCJSFILE,SEQ;"//     if (isWhitespace(suburb.value)) {"
          WRITE     PCJSFILE,SEQ;"//        suburb.value=PCFields[1];   }"
          WRITE     PCJSFILE,SEQ;"//  } else { "
          WRITE     PCJSFILE,SEQ;"//      suburb.value=PCFields[1]; }"
          WRITE     PCJSFILE,SEQ;"    suburb.value=PCFields[1]; "
          WRITE     PCJSFILE,SEQ;"// T0862028 - end"
          WRITE     PCJSFILE,SEQ;"    state.value=PCFields[2];"
          WRITE     PCJSFILE,SEQ;"    postcode.focus();"
          WRITE     PCJSFILE,SEQ;"    return;"
          WRITE     PCJSFILE,SEQ;"  }"
          WRITE     PCJSFILE,SEQ;"  if (AddressPostCodeFormat==1)"
          WRITE     PCJSFILE,SEQ;"  {"
          WRITE     PCJSFILE,SEQ;"    PCFields=SelectPC[selected].split(#",#");"
          WRITE     PCJSFILE,SEQ;"    postcode.value=PCFields[0];"
          WRITE     PCJSFILE,SEQ;"    suburb.value=PCFields[1] + #", ":
                                 "#" + PCFields[2];"
          WRITE     PCJSFILE,SEQ;"    postcode.focus();"
          WRITE     PCJSFILE,SEQ;"    return;"
          WRITE     PCJSFILE,SEQ;"  }"
          WRITE     PCJSFILE,SEQ;"  if (AddressPostCodeFormat==2)"
          WRITE     PCJSFILE,SEQ;"  {"
          WRITE     PCJSFILE,SEQ;"    PCFields=SelectPC[selected].split(#",#");"
          WRITE     PCJSFILE,SEQ;"    postcode.value=PCFields[0];"
          WRITE     PCJSFILE,SEQ;"    suburb.value=PCFields[1]"
          WRITE     PCJSFILE,SEQ;"    postcode.focus();"
          WRITE     PCJSFILE,SEQ;"    return;"
          WRITE     PCJSFILE,SEQ;"  }"
          WRITE     PCJSFILE,SEQ;"}"
          WRITE     PCJSFILE,SEQ;""
          WRITE     PCJSFILE,SEQ;"function ClearFields()"
          WRITE     PCJSFILE,SEQ;"{"
          WRITE     PCJSFILE,SEQ;"  suburb.value=#"#";"
          WRITE     PCJSFILE,SEQ;"  postcode.value=#"#";"
          WRITE     PCJSFILE,SEQ;"  state.value=#"#";"
          WRITE     PCJSFILE,SEQ;"}"
          WRITE     PCJSFILE,SEQ;""
          WRITE     PCJSFILE,SEQ;"function DefPost() "
          WRITE     PCJSFILE,SEQ;"{"
          WRITE     PCJSFILE,SEQ;"  suburb.value=#"ASHBURTON#";"
          WRITE     PCJSFILE,SEQ;"  postcode.value=#"3147#";"
          WRITE     PCJSFILE,SEQ;"  state.value=#"VIC#";"
          WRITE     PCJSFILE,SEQ;"}"
          WRITE     PCJSFILE,SEQ;""
...
          WRITE     PCJSFILE,SEQ;"function InitPostCodes() "
          WRITE     PCJSFILE,SEQ;"{"
          SFORMAT   VAR,127
.
STRTPC99  RETURN
.------------------------------------------------------------
. InitPostCode function detail line
.------------------------------------------------------------
INPC0000  STRIP     IBPOPCOD
          STRIP     IBPOSUBR
          STRIP     IBPOSTAT
.
          MOVELPTR  IBPOSUBR,LENGTH
          SFORMAT   VAR,LENGTH
          MOVE      IBPOSUBR,VAR
.
          WRITE     PCJSFILE,SEQ;"PC[PC.length]=#"":
                                 *+,IBPOPCOD,",",VAR,",",*-,IBPOSTAT,"#""
.
          SFORMAT   VAR,127
.
INPC9999  RETURN
..------------------------------------------------------------
. Open Outpatient Files
.------------------------------------------------------------
OPNOUT00  PACK      CFNAME,CFILEPRE,FILCLIA1  * Get the name of the CLIA1 file
          CLOSE     OUTCLIA1
          OPEN      OUTCLIA1,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILCLIA5  * Get the name of the CLIA5 file
          CLOSE     OUTCLIA5
          OPEN      OUTCLIA5,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILCTYA1  * Get the name of the CTYA1 file
          CLOSE     OUTCTYA1
          OPEN      OUTCTYA1,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILCTYA2  * Get the name of the CTYA2 file
          CLOSE     OUTCTYA2
          OPEN      OUTCTYA2,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILHEDA1  * Get the name of the HEDA1 file1
          CLOSE     OUTHEDA1
          OPEN      OUTHEDA1,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILMA1A1  * Get the name of the MA1A1 file1
          CLOSE     OUTMA1A1
          OPEN      OUTMA1A1,CFNAME           * Open the file
.
OPNOUT99  RETURN
+
.------------------------------------------------------------
. Process outpatient clinic types 
.------------------------------------------------------------
OUTCTY00  CALL      MAKOUT00                * Create Output File for Javascript
.
          MOVE      ZERO,PRFXDONE           * This site prefix done = No
          PACK      KEY9,SP70
          CALL      RDSSITA3
OUTCTY10  CALL      RDKSITA3
          BRANCH    OVRCD,OUTCTY90
.
          MATCH     OSTFILE,CFILEPRE        * Same as Current File Prefix
          IF        !@EQUAL
            MOVE      OSTFILE,CFILEPRE      * Save Current File Prefix
            CALL      OPNOUT00              * Open Files
            MOVE      ZERO,PRFXDONE         * This site prefix done = No
          ENDIF
.
          BRANCH    PRFXDONE,OUTCTY10       * Skip if this site prefix is done 
.
          MOVE     ONE,PRFXDONE             * Set this prefix processed to yes
          MOVE     ZERO,SITEFLAG            * Set site code processing to no
          MOVE     SP70,SAVESITE
          PACK     KEY42,SP70
          CALL     RDSCTYA2
OUTCTY50  CALL     RDKCTYA2
          BRANCH   OVRCD,OUTCTY80
.
          MATCH    "1",OCTACT
          GOTO     OUTCTY50 IF EQUAL 
.
          CALL     JSCOUT00   * Output Detail Line for Javascript
.
          GOTO     OUTCTY50   * Next
.
OUTCTY80  IF        SITEFLAG=1
            WRITE    JSCPOUTF,SEQ;"}"       * Close function as site code
          ENDIF                             * processing was set to yes
.
          GOTO     OUTCTY10
.
OUTCTY90  CALL     ENDOUT00   * End Javascript Page
          CALL     OVWROT00   * Overwrite original Outpatient Clinic Types js
.
OUTCTY99  RETURN
+
.------------------------------------------------------------
. Make Javascript
.------------------------------------------------------------
MAKOUT00  CLEAR    JSCPOUTN
          STRIP    CWEBROOT
          APPEND   CWEBROOT,JSCPOUTN
          APPEND   "js/OutpatientSelect",JSCPOUTN
          APPEND   ".js.tmp",JSCPOUTN
          RESET    JSCPOUTN
.
          PACK     KEY8,CCC,CYY,CMM,CDD
          REP      " 0",KEY8
          UNPACK   KEY8,CCENT,CYEAR,CMON,CDAY
          CALL     PACDATE
          PREP     JSCPOUTF,JSCPOUTN
          WRITE    JSCPOUTF,SEQ;"//==========================================="
          WRITE    JSCPOUTF,SEQ;"// Javascript options for Outpatient Clinic  "
          WRITE    JSCPOUTF,SEQ;"// types for a single site code              "
          WRITE    JSCPOUTF,SEQ;"// Generated on ",CPCDATE
          WRITE    JSCPOUTF,SEQ;"//==========================================="
          WRITE    JSCPOUTF,SEQ;"//==========================================="
          MOVE     SELCAT,KEY2
          REP      " _",KEY2
          WRITE    JSCPOUTF,SEQ;"function SetClinicType":
                                "(ListItem,SelectedCode,Site) {"

MAKOUT99  RETURN
+
.------------------------------------------------------------
. Javascript Detail Line
.------------------------------------------------------------
JSCOUT00  MATCH     SP70,SAVESITE
          GOTO      JSCOUT10 IF NOT EQUAL
.
          WRITE    JSCPOUTF,SEQ;"if (#"",OCTSITE,"#" == Site) { "
          MOVE     OCTSITE,SAVESITE
          MOVE     ONE,SITEFLAG             * Set site code processing to no
          GOTO     JSCOUT50
.
JSCOUT10  MATCH    SAVESITE,OCTSITE
          GOTO     JSCOUT50 IF EQUAL
.
          WRITE    JSCPOUTF,SEQ;"} "
          WRITE    JSCPOUTF,SEQ;"if (#"",OCTSITE,"#" == Site) { "
.
          MOVE     OCTSITE,SAVESITE

JSCOUT50  WRITE    JSCPOUTF,SEQ;"   ListItem.options[ListItem.options.length]="
          WRITE    JSCPOUTF,SEQ;"   new Option(#"",OCTDESC,"#",#"",OCTCTYP:
                                "#");"
JSCOUT99  RETURN
+
.------------------------------------------------------------
. Javascript  Line
.------------------------------------------------------------
ENDOUT00  WRITE    JSCPOUTF,SEQ;"for (var i =0 ; i < ListItem.length; i++) {"
          WRITE    JSCPOUTF,SEQ;"   if (ListItem.options[i].value.substr(0,6)":
                               "==SelectedCode) {"
          WRITE    JSCPOUTF,SEQ;"         ListItem.selectedIndex=i } };"
.
          WRITE     JSCPOUTF,SEQ;"// Validate and add inactive clinic type":
                    " to selection list"
          WRITE     JSCPOUTF,SEQ;"if(ListItem.selectedIndex!=0) { return; }"
          WRITE     JSCPOUTF,SEQ;"if(isWhitespace(Site) || ":
                                 "isWhitespace(SelectedCode)) { return; }"
          WRITE     JSCPOUTF,SEQ;"var serverURL = #"":
                                 "../cgi-bin/patweb80.pbl?reportno=49":
                                 "&returnfm=1#" + "
          WRITE     JSCPOUTF,SEQ;"#"&checksit=#" + Site.replace(/ /g,#"+#") + "
          WRITE     JSCPOUTF,SEQ;"#"&valdcode=#" + ":
                                 "SelectedCode.replace(/ /g,#"+#");"
          WRITE     JSCPOUTF,SEQ;"var returnValue = RSExecute(serverURL); "
          WRITE     JSCPOUTF,SEQ;"if(returnValue.status==0) { "
          WRITE     JSCPOUTF,SEQ;"  ReturnValue=returnValue.return_value":
                                 ".split(#"|#"); "
          WRITE     JSCPOUTF,SEQ;"  if(isWhitespace(ReturnValue[0])) ":
                                 "{ return; }"
          WRITE     JSCPOUTF,SEQ;"  ListItem.options[ListItem.options":
                                 ".length]= "
          WRITE     JSCPOUTF,SEQ;"  new Option(ReturnValue[0],SelectedCode);"
          WRITE     JSCPOUTF,SEQ;"  ListItem.options.selectedIndex=":
                                 "ListItem.length - 1; "
          WRITE     JSCPOUTF,SEQ;"}"
.
          WRITE    JSCPOUTF,SEQ;"}"
          WRITE    JSCPOUTF,SEQ;"// End of Javascript"
          CLOSE    JSCPOUTF
.
ENDOUT99  RETURN
+
.-------------------------------------------------------------------------------
. Overwrite the Outpatient Clinic Types file with the newly generated temp file
.-------------------------------------------------------------------------------
OVWROT00  CLEAR    JSCPOFIN
          STRIP    CWEBROOT
          APPEND   CWEBROOT,JSCPOFIN
          APPEND   "js/OutpatientSelect",JSCPOFIN
          APPEND   ".js",JSCPOFIN
          RESET    JSCPOFIN
.
          CLEAR     CMDLINE
          PACK      CMDLINE,MOVECMND,JSCPOUTN,SP1,JSCPOFIN,SP70
          EXECUTE   CMDLINE,TASKID   * overwrite original file with temp file
.
OVWROT99  RETURN
+
.------------------------------------------------------------
. Check outpatient site for clinic type javascript
.------------------------------------------------------------
CHKSIT00  MOVE      ZERO,EXIT
          DISPLAY   *P1:9,"Site Code :"
.
          KEYIN     *P13:9,*EL,SITECODE
.
          PACK      KEY6,SITECODE,SP70
          CALL      RDSITA1
          BRANCH    OVRCD,CHKSIT90
.
          DISPLAY   *P20:9,OSTDESC
.
          GOTO      CHKSIT99
.
CHKSIT90  MOVE      ONE,EXIT
.
CHKSIT99  RETURN
+
.------------------------------------------------------------
. Process outpatient clinic types
.------------------------------------------------------------
OUTMAS00  CALL      MAKMAS00    * Create Output File for Javascript
.
          MOVE      ZERO,PRINORDR            * Print order - Code order
.
          MATCH     "1",OTCNCFMT
          IF        @EQUAL
            MOVE      ONE,PRINORDR            * Print order - Desc order
          ENDIF
.
          MATCH     "2",OTCNCFMT
          IF        @EQUAL
            MOVE      ONE,PRINORDR            * Print order - Desc order
          ENDIF
.
          MOVE      ZERO,PRFXDONE           * This site prefix done = No
          PACK      KEY9,SP70
          CALL      RDSSITA3
OUTMAS10  CALL      RDKSITA3
          BRANCH    OVRCD,OUTMAS90
.
          MATCH     OSTFILE,CFILEPRE        * Same as Current File Prefix
          IF        !@EQUAL
            MOVE      OSTFILE,CFILEPRE      * Save Current File Prefix
            CALL      OPNOUT00              * Open Files
            MOVE      ZERO,PRFXDONE         * This site prefix done = No
          ENDIF
.
          BRANCH    PRFXDONE,OUTMAS10       * Skip if this site prefix is done
.
          MOVE     ONE,PRFXDONE             * Set this prefix processed to yes
          MOVE     ZERO,SITEFLAG
          MOVE     SP70,SAVESITE
.
          IF       PRINORDR=0
            PACK     KEY20,SP70
            CALL     RDSCLIA1
          ELSE
            PACK     KEY50,SP70
            CALL     RDSCLIA5
          ENDIF
.
OUTMAS50  IF       PRINORDR=0
            CALL     RDKCLIA1
          ELSE
            CALL     RDKCLIA5
          ENDIF
          BRANCH   OVRCD,OUTMAS80
.
          MATCH    "1",OTCLIACT
          GOTO     OUTMAS50 IF EQUAL
.
          CALL     JSCMAS00   * Output Detail Line for Javascript
.
          GOTO     OUTMAS50   * Next
.
OUTMAS80  IF        SITEFLAG=1
            WRITE    JSCPOUTF,SEQ;"}"
          ENDIF
.
          GOTO     OUTMAS10
.
OUTMAS90  CALL     ENDMAS00   * End Javascript Page
          CALL     OVWRMA00   * Overwrite Outpatient Clinics Javascript
.
OUTMAS99  RETURN
+
.------------------------------------------------------------
. Make Javascript
.------------------------------------------------------------
MAKMAS00  CLEAR    JSCPOUTN
          STRIP    CWEBROOT
          APPEND   CWEBROOT,JSCPOUTN
          APPEND   "js/OutpatientClinicId",JSCPOUTN
          APPEND   ".js.tmp",JSCPOUTN
          RESET    JSCPOUTN
.
          PACK     KEY8,CCC,CYY,CMM,CDD
          REP      " 0",KEY8
          UNPACK   KEY8,CCENT,CYEAR,CMON,CDAY
          CALL     PACDATE
          PREP     JSCPOUTF,JSCPOUTN
          WRITE    JSCPOUTF,SEQ;"//==========================================="
          WRITE    JSCPOUTF,SEQ;"// Javascript options for Outpatient Clinic  "
          WRITE    JSCPOUTF,SEQ;"// IDS for a single site code                "
          WRITE    JSCPOUTF,SEQ;"// Generated on ",CPCDATE
          WRITE    JSCPOUTF,SEQ;"//==========================================="
          WRITE    JSCPOUTF,SEQ;"//==========================================="
          MOVE     SELCAT,KEY2
          REP      " _",KEY2
          WRITE    JSCPOUTF,SEQ;"function SetClinicId":
                                "(ListItem,SelectedCode,Site) {"

MAKMAS99  RETURN
+
.------------------------------------------------------------
. Javascript Detail Line
.------------------------------------------------------------
JSCMAS00  MATCH     SP70,SAVESITE
          GOTO      JSCMAS10 IF NOT EQUAL
.
          WRITE    JSCPOUTF,SEQ;"if (#"",OCASITE,"#" == Site) { "
          MOVE     OCASITE,SAVESITE
          MOVE     ONE,SITEFLAG
          GOTO     JSCMAS50
.
JSCMAS10  MATCH    SAVESITE,OCASITE
          GOTO     JSCMAS50 IF EQUAL
.
          WRITE    JSCPOUTF,SEQ;"} "
          WRITE    JSCPOUTF,SEQ;"if (#"",OCASITE,"#" == Site) { "
.
          MOVE     OCASITE,SAVESITE
.
JSCMAS50  MOVE     OCACLIN,DIM6
          SQUEEZE  DIM6
          STRIP    OCADESC
.
          WRITE    JSCPOUTF,SEQ;"   ListItem.options[ListItem.options.length]="
.
          MATCH    "2",OTCNCFMT         * Description
          IF       @EQUAL
            WRITE    JSCPOUTF,SEQ;"   new Option(#"",*+,OCADESC,"":
                                "#",#"",OCACLIN,"#");"
            GOTO     JSCMAS99
          ENDIF
.
          MATCH    "1",OTCNCFMT        * Description - Code
          IF       @EQUAL
            WRITE    JSCPOUTF,SEQ;"   new Option(#"",*+,OCADESC," - ":
                                "",DIM6,"#",#"",OCACLIN,"#");"
            GOTO     JSCMAS99
          ENDIF
.                                      * Code - Description
.
          WRITE    JSCPOUTF,SEQ;"   new Option(#"",*+,DIM6," - ":
                                "",OCADESC,"#",#"",OCACLIN,"#");"
.
JSCMAS99  RETURN
+
.------------------------------------------------------------
. Javascript  Line
.------------------------------------------------------------
ENDMAS00  WRITE    JSCPOUTF,SEQ;"for (var i =0 ; i < ListItem.length; i++) {"
          WRITE    JSCPOUTF,SEQ;"   if (ListItem.options[i].value.substr(0,6)":
                               "==SelectedCode) {"
          WRITE    JSCPOUTF,SEQ;"         ListItem.selectedIndex=i } };"
          WRITE    JSCPOUTF,SEQ;"}"
          WRITE    JSCPOUTF,SEQ;"// End of Javascript"
          CLOSE    JSCPOUTF
ENDMAS99  RETURN
+
.-------------------------------------------------------------------------------
. Overwrite the Outpatient Clinics file with the newly generated temp file
.-------------------------------------------------------------------------------
OVWRMA00  CLEAR    JSCPOFIN
          STRIP    CWEBROOT
          APPEND   CWEBROOT,JSCPOFIN
          APPEND   "js/OutpatientClinicId",JSCPOFIN
          APPEND   ".js",JSCPOFIN
          RESET    JSCPOFIN
.
          CLEAR     CMDLINE
          PACK      CMDLINE,MOVECMND,JSCPOUTN,SP1,JSCPOFIN,SP70
          EXECUTE   CMDLINE,TASKID   * overwrite original file with temp file
.
OVWRMA99  RETURN
+
.------------------------------------------------------------
. Process outpatient clinic master javascript grouped by
. site and clinic type
.------------------------------------------------------------
MTYP0000  CALL      MAKM0000    * Create Output File for Javascript
.
          MOVE      ZERO,PRINORDR           * Print order - Code order
.
          MATCH     "1",OTCNCFMT
          IF        @EQUAL
            MOVE      ONE,PRINORDR          * Print order - Desc order
          ENDIF
.
          MATCH     "2",OTCNCFMT
          IF        @EQUAL
            MOVE      ONE,PRINORDR          * Print order - Desc order
          ENDIF
.
          MOVE      ZERO,PRFXDONE           * This site prefix done = No
          PACK      KEY9,SP70
          CALL      RDSSITA3
MTYP1000  CALL      RDKSITA3
          BRANCH    OVRCD,MTYP9000
.
          MATCH     OSTFILE,CFILEPRE        * Same as Current File Prefix
          IF        !@EQUAL
            MOVE      OSTFILE,CFILEPRE      * Save Current File Prefix
            CALL      OPNOUT00              * Open Files
            MOVE      ZERO,PRFXDONE         * This site prefix done = No
          ENDIF
.
          BRANCH    PRFXDONE,MTYP1000       * Skip if this site prefix is done
.
          MOVE     ONE,PRFXDONE             * Set this prefix processed to yes
          MOVE     ZERO,SITEFLAG
          MOVE     SP70,SAVESITE
          MOVE     SP70,SAVETYPE
.
          IF       PRINORDR=0
            PACK     KEY20,SP70
            CALL     RDSCLIA1
          ELSE
            PACK     KEY50,SP70
            CALL     RDSCLIA5
          ENDIF
.
MTYP2000  IF       PRINORDR=0
            CALL     RDKCLIA1
          ELSE
            CALL     RDKCLIA5
          ENDIF
          BRANCH   OVRCD,MTYP3000
.
          MATCH    "1",OTCLIACT
          GOTO     MTYP2000 IF EQUAL
.
          CALL     JSCM0000           * Output Detail Line for Javascript
.
          GOTO     MTYP2000           * Next
.
MTYP3000  IF        SITEFLAG=1
            WRITE    JSCPOUTF,SEQ;"}"
          ENDIF
.
          WRITE    JSCPOUTF,SEQ;" "
          WRITE    JSCPOUTF,SEQ;"// By Type //"
          WRITE    JSCPOUTF,SEQ;" "
.
          CALL     CREA0000                 * Create tempfile
          CALL     LOAD0000                 * Load tempfile 
.
          MOVE     ONE,PRFXDONE             * Set this prefix processed to yes
          MOVE     ZERO,SITEFLAG
          MOVE     SP70,SAVESITE
          MOVE     SP70,SAVETYPE
.
          IF       PRINORDR=0
            PACK     KEY48,SP70
            CALL     RSTEMP1
          ELSE
            PACK     KEY48,SP70
            CALL     RSTEMP2
          ENDIF
.
MTYP5000  IF       PRINORDR=0
            CALL     RKTEMP1
          ELSE
            CALL     RKTEMP2
          ENDIF
          BRANCH   OVRCD,MTYP6000
.
          CALL     JSCT0000           * Output Detail Line for Javascript
.
          GOTO     MTYP5000           * Next
.
MTYP6000  IF        SITEFLAG=1
            WRITE    JSCPOUTF,SEQ;"}"
          ENDIF
.
          GOTO     MTYP1000
.
MTYP9000  CALL     ENDM0000           * End Javascript Page
          CALL     OVWROM00           * Overwrite OP Clinic Types javascript
          CALL     KILL0000           * Remove existing file
.
MTYP9999  RETURN
+
.------------------------------------------------------------
.* Create a new temporary file                                *
.------------------------------------------------------------
CREA0000  CALL      KILL0000                     * remove existing file
.
          CLEAR     CMDLINE
          PACK      CMDLINE,ISBUILD,TEMPFILE,UKEY
          EXECUTE   CMDLINE,TASKID               * create temporary index file
.
          OPEN      GENTEMP1,TEMPFILE            * open temp index file
          OPEN      GENTEMP2,TEMPFILE            * open temp index file
.
CREA9999  RETURN
+
.------------------------------------------------------------
. Close and erase the temporary file
.------------------------------------------------------------
KILL0000  CLOSE     GENTEMP1                     * close file 
          CLOSE     GENTEMP2                     * close file 
.
          CLEAR     CMDLINE
          PACK      CMDLINE,ERASE,TEMPFILE       * set file erase command
          EXECUTE   CMDLINE,TASKID               * erase temp file
.
KILL9999 RETURN
+
.------------------------------------------------------------
.* Load temporary file from outhedaf
.------------------------------------------------------------
LOAD0000  CALL      IBACLOCK
.
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE

          PACK      KEY28,SP70
          CALL      RSOTHED1
LOAD1000  CALL      RKOTHED1
          BRANCH    OVRCD,LOAD9999
.
          PACK      KEY18,OTHESITE,OTHECLIN,OTHEWDAY,OTHESTRT,SP70
          CALL      RDMASA1
          BRANCH    OVRCD,LOAD1000
.
          BRANCH    OMASTAT,LOAD1000
.
          PACK      GENTSITE,OTHESITE,SP70
          PACK      GENTCTYP,OTHECTYP,SP70
          PACK      GENTCLIN,OTHECLIN,SP70
.
          MATCH     SP70,OTHEDTCC
          IF        !@EQUAL
            MATCH     CURRDATE,OTHEDTCC
            GOTO      LOAD1000 IF LESS
          ENDIF
.
          MATCH     SP70,OTHESITE
          GOTO      LOAD1000 IF EQUAL
.
          MATCH     SP70,OTHECTYP
          GOTO      LOAD1000 IF EQUAL
.
          MATCH     SP70,OTHECLIN
          GOTO      LOAD1000 IF EQUAL
.
          MOVE      SP70,OCADESC                 * Get Clinic Name
          PACK      KEY20,OTHESITE,OTHECLIN,Z70
          CALL      RDSCLIA1
LOAD1500  CALL      RDPCLIA1
          BRANCH    OVRCD,LOAD1000               * Get Clinic Name
.
          MATCH     OTHESITE,OCASITE
          GOTO      LOAD1000 IF NOT EQUAL
.
          MATCH     OTHECLIN,OCACLIN
          GOTO      LOAD1000 IF NOT EQUAL
.
          MATCH     "1",OTCLIACT                 * Active
          GOTO      LOAD1000 IF EQUAL
.
LOAD2000  MOVE      OCADESC,GENTDESC
.
          PACK      KEY48,GENTSITE,GENTCTYP,GENTCLIN,GENTDESC,SP70
          CALL      RATEMP1
          IF        OVRCD=1
            CALL      WRTEMP1
          ENDIF
.
          GOTO      LOAD1500
.
LOAD9999  RETURN
+
.------------------------------------------------------------
. Make Javascript
.------------------------------------------------------------
MAKM0000  CLEAR    JSCPOUTN
          STRIP    CWEBROOT
          APPEND   CWEBROOT,JSCPOUTN
          APPEND   "js/OutpatientTypeClinic",JSCPOUTN
          APPEND   ".js.tmp",JSCPOUTN
          RESET    JSCPOUTN
.
          PACK     KEY8,CCC,CYY,CMM,CDD
          REP      " 0",KEY8
          UNPACK   KEY8,CCENT,CYEAR,CMON,CDAY
          CALL     PACDATE
          PREP     JSCPOUTF,JSCPOUTN
          WRITE    JSCPOUTF,SEQ;"//==========================================="
          WRITE    JSCPOUTF,SEQ;"// Javascript options for Outpatient Clinic  "
          WRITE    JSCPOUTF,SEQ;"// IDS for a single site code and clinic type"
          WRITE    JSCPOUTF,SEQ;"// Generated on ",CPCDATE
          WRITE    JSCPOUTF,SEQ;"//==========================================="
          WRITE    JSCPOUTF,SEQ;"//==========================================="
          MOVE     SELCAT,KEY2
          REP      " _",KEY2
          WRITE    JSCPOUTF,SEQ;"function SetTypeClinic":
                                "(ListItem,SelectedCode,Site,ClinicType) {"

MAKM9999  RETURN
+
.------------------------------------------------------------
. Javascript Detail Line for all clinics option (no clinic type)
.------------------------------------------------------------
JSCM0000  MATCH     SP70,SAVESITE
          GOTO      JSCM1000 IF NOT EQUAL
.
          WRITE    JSCPOUTF,SEQ;"if (#"",OCASITE,"#" == Site ":
                                "&& isWhitespace(ClinicType)) { "
          MOVE     OCASITE,SAVESITE
          MOVE     ONE,SITEFLAG
          GOTO     JSCM5000
.
JSCM1000  MATCH    SAVESITE,OCASITE
          GOTO     JSCM5000 IF EQUAL
.
          WRITE    JSCPOUTF,SEQ;"} "
          WRITE    JSCPOUTF,SEQ;"if (#"",OCASITE,"#" == Site ":
                                "&& isWhitespace(ClinicType)) { "
.
          MOVE     OCASITE,SAVESITE
.
JSCM5000  MOVE     OCACLIN,DIM6
          SQUEEZE  DIM6
          STRIP    OCADESC
.
          WRITE    JSCPOUTF,SEQ;"   ListItem.options[ListItem.options.length]="
.
          MATCH    "2",OTCNCFMT         * Description
          IF       @EQUAL
            WRITE    JSCPOUTF,SEQ;"   new Option(#"",*+,OCADESC,"":
                                "#",#"",OCACLIN,"#");"
            GOTO     JSCM9999
          ENDIF
.
          MATCH    "1",OTCNCFMT        * Description - Code
          IF       @EQUAL
            WRITE    JSCPOUTF,SEQ;"   new Option(#"",*+,OCADESC," - ":
                                "",DIM6,"#",#"",OCACLIN,"#");"
            GOTO     JSCM9999
          ENDIF
.                                      * Code - Description
.
          WRITE    JSCPOUTF,SEQ;"   new Option(#"",*+,DIM6," - ":
                                "",OCADESC,"#",#"",OCACLIN,"#");"
.
JSCM9999  RETURN
+
.------------------------------------------------------------
. Javascript Detail Line for all clinics by type option
.------------------------------------------------------------
JSCT0000  MATCH     SP70,SAVESITE
          GOTO      JSCT1000 IF NOT EQUAL
.
          MATCH     SP70,SAVETYPE
          GOTO      JSCT1000 IF NOT EQUAL
.
          WRITE    JSCPOUTF,SEQ;"if (#"",GENTSITE,"#" == Site ":
                                "&& #"",GENTCTYP,"#" == ClinicType) { "
          MOVE     GENTSITE,SAVESITE
          MOVE     GENTCTYP,SAVETYPE
          MOVE     ONE,SITEFLAG
          GOTO     JSCT5000
.
JSCT1000  MATCH    SAVESITE,GENTSITE
          GOTO     JSCT3000 IF NOT EQUAL
.
          MATCH    SAVETYPE,GENTCTYP
          GOTO     JSCT3000 IF NOT EQUAL
.
          GOTO     JSCT5000
.
JSCT3000  WRITE    JSCPOUTF,SEQ;"} "
          WRITE    JSCPOUTF,SEQ;"if (#"",GENTSITE,"#" == Site ":
                                "&& #"",GENTCTYP,"#" == ClinicType) { "
.
          MOVE     GENTSITE,SAVESITE
          MOVE     GENTCTYP,SAVETYPE
.
JSCT5000  MOVE     GENTCLIN,DIM6
          SQUEEZE  DIM6
          STRIP    GENTDESC
.
          WRITE    JSCPOUTF,SEQ;"   ListItem.options[ListItem.options.length]="
.
          MATCH    "2",OTCNCFMT         * Description
          IF       @EQUAL
            WRITE    JSCPOUTF,SEQ;"   new Option(#"",*+,GENTDESC,"":
                                "#",#"",GENTCLIN,"#");"
            GOTO     JSCT9999
          ENDIF
.
          MATCH    "1",OTCNCFMT        * Description - Code
          IF       @EQUAL
            WRITE    JSCPOUTF,SEQ;"   new Option(#"",*+,GENTDESC," - ":
                                "",DIM6,"#",#"",GENTCLIN,"#");"
            GOTO     JSCT9999
          ENDIF
.                                      * Code - Description
.
          WRITE    JSCPOUTF,SEQ;"   new Option(#"",*+,DIM6," - ":
                                "",GENTDESC,"#",#"",GENTCLIN,"#");"
.
JSCT9999  RETURN
+
.------------------------------------------------------------
. Javascript  Line
.------------------------------------------------------------
ENDM0000  WRITE    JSCPOUTF,SEQ;"for (var i =0 ; i < ListItem.length; i++) {"
          WRITE    JSCPOUTF,SEQ;"   if (ListItem.options[i].value.substr(0,6)":
                               "==SelectedCode) {"
          WRITE    JSCPOUTF,SEQ;"         ListItem.selectedIndex=i } };"
          WRITE    JSCPOUTF,SEQ;"}"
          WRITE    JSCPOUTF,SEQ;"// End of Javascript"
          CLOSE    JSCPOUTF
.
EMDM9999  RETURN
+
.-------------------------------------------------------------------------------
. Overwrite the Outpatient Clinic Types file with the newly generated temp file
.-------------------------------------------------------------------------------
OVWROM00  CLEAR    JSCPOFIN
          STRIP    CWEBROOT
          APPEND   CWEBROOT,JSCPOFIN
          APPEND   "js/OutpatientTypeClinic",JSCPOFIN
          APPEND   ".js",JSCPOFIN
          RESET    JSCPOFIN
.
          CLEAR     CMDLINE
          PACK      CMDLINE,MOVECMND,JSCPOUTN,SP1,JSCPOFIN,SP70
          EXECUTE   CMDLINE,TASKID   * overwrite original file with temp file
.
OVWROM99  RETURN
+
.********************************************************************
.*                          AUTO0000                                *
.*  Keyin directories                                               *
.********************************************************************
AUTO0000  MOVE      ANSN,EXACTMCH
          KEYIN     *P1:20,*EL,"Auto Select Exact Match Suburbs (Y/N) ? ":
                    EXACTMCH;
.
          REP       "yYnN",EXACTMCH
          CMATCH    "Y",EXACTMCH
          GOTO      AUTO9999 IF EQUAL
.
          CMATCH    "N",EXACTMCH
          GOTO      AUTO9999 IF EQUAL
          BEEP
          GOTO      AUTO0000
.
AUTO9999  RETURN
.
.------------------------------------------------------------
.*        IO ROUTINES FOR TEMPORARY FILE                                    *
.------------------------------------------------------------
RATEMP1   RESET     KEY48
          MOVE      ZERO,OVRCD
          READ      GENTEMP1,KEY48;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
RSTEMP1   READ      GENTEMP1,KEY48;;
          RETURN
.
RKTEMP1   MOVE      ZERO,OVRCD
          READKS    GENTEMP1;GENTSITE,GENTCTYP,GENTCLIN,GENTDESC
          GOTO      OVERCOND IF OVER
          RETURN
.
WRTEMP1   WRITE     GENTEMP1,KEY48;GENTSITE,GENTCTYP,GENTCLIN,GENTDESC
          RETURN
.
RSTEMP2   READ      GENTEMP2,KEY48;;
          RETURN
.
RKTEMP2   MOVE      ZERO,OVRCD
          READKS    GENTEMP2;GENTSITE,GENTCTYP,GENTCLIN,GENTDESC
          GOTO      OVERCOND IF OVER
          RETURN
.
.------------------------------------------------------------
. Process Multi Hospital Category/Codes Request
. CATSTRCD - Start category
. CATENDCD - End Category
.------------------------------------------------------------
MULCAT00  PACK     KEY5,SP3,CATSTRCD,SP70
          CALL     RDCODE3
          IF       OVRCD=0
            CALL     RDPCODE3
          ENDIF
MULCAT10  CALL     RDKCODE3
          BRANCH   OVRCD,MULCAT99
          MATCH    SP70,ACODE
          GOTO     MULCAT99 IF NOT EQUAL
          MATCH    TCODE,CATENDCD
          GOTO     MULCAT20 IF EQUAL
          GOTO     MULCAT99 IF LESS
.
MULCAT20  MOVE     TCODE,SELCAT
          CALL     MULCDS00     * Output in Description Sequence
          GOTO     MULCAT10
.
MULCAT99  RETURN
.
.------------------------------------------------------------
. Output Multi Hospital Page in Description Sequence
.------------------------------------------------------------
MULCDS00  CLEAR    WBLILKID
          APPEND   "CodeCT",WBLILKID
          APPEND   SELCAT,WBLILKID
          RESET    WBLILKID
          REP      " _",WBLILKID
          MOVE     "000",WBLPPGNO
          MOVE     TDESC,WBLPTITL
          MOVE     TDESC,WBLPHEAD
          MOVE     SP70,WBLPCLOR
.
          CALL     JSCMUL00    * Create Output File for Javascript
.
          MOVE     SP70,DEFAULTC
          MOVE     SP70,DEFAULTD
.
          PACK     KEY3,SP70
          CALL     RSPTHSP1
MULCDS10  CALL     RKPTHSP1
          BRANCH   OVRCD,MULCDS90
.
          MOVE     ZERO,HOSPFLAG
          MOVE     SP70,SAVEHOSP
.
          PACK     KEY25,SELCAT,SP70
          PACK     PTCDKEY2,SELCAT,SP70
          CALL     RDSCODE2
MULCDS30  CALL     RDKCODE2
          BRANCH   OVRCD,MULCDS80
.
          MATCH    TCODE,SELCAT
          GOTO     MULCDS80 IF NOT EQUAL
.
          MATCH    SP70,ACODE
          GOTO     MULCDS30 IF EQUAL
.
          MATCH    "1",PTCDDEFT
          IF       @EQUAL
            MOVE     ACODE,DEFAULTC
            MOVE     PTCDLDES,DEFAULTD
          ENDIF
.
          MATCH    ANSI,PTCOACTV           * dont include inactive codes
          GOTO     MULCDS30 IF EQUAL
.
          IF       IBCNMHOS=1
            MATCH    "1",PTCDHOSS
            IF       @EQUAL
              PACK     KEY8,PTHSHOSP,TCODE,ACODE,SP70
              CALL     RDMLCOD1
              BRANCH   OVRCD,MULCDS30
            ENDIF
          ENDIF
.
          REP      "' ",TDESC
          REP      "#" ",TDESC
          MOVE     ONE,WBLDTYPE
          MOVE     ACODE,WBLDCODE
          MOVE     TDESC,WBLDDESC
.
          CALL     MULDET00   * Output Detail Line for Javascript
.
          GOTO     MULCDS30   * Next
.
MULCDS80  IF        HOSPFLAG=1
            WRITE    JSCPOUTF,SEQ;"}"       * Close function as hosp code
          ENDIF                             * processing was set to yes
.
          GOTO     MULCDS10
.
MULCDS90  CALL     EMULJS00   * End Javascript Page
          CALL     OVWRMJ00   * Overwrite original Multi Hospital Javascript
.
MULCDS99  RETURN
+
.------------------------------------------------------------
. Make Javascript
.------------------------------------------------------------
JSCMUL00  CLEAR    JSCPOUTN
          STRIP    CWEBROOT
          APPEND   CWEBROOT,JSCPOUTN
          APPEND   "js/IBA_MultiCategory_",JSCPOUTN
          MOVE     SELCAT,KEY2
          REP      " _",KEY2
          APPEND   KEY2,JSCPOUTN
          APPEND   ".js.tmp",JSCPOUTN
          RESET    JSCPOUTN
.
          PACK     KEY8,CCC,CYY,CMM,CDD
          REP      " 0",KEY8
          UNPACK   KEY8,CCENT,CYEAR,CMON,CDAY
          CALL     PACDATE
          PREP     JSCPOUTF,JSCPOUTN
          WRITE    JSCPOUTF,SEQ;"//==========================================="
          WRITE    JSCPOUTF,SEQ;"// Multi Hospital Javascript options         "
          WRITE    JSCPOUTF,SEQ;"// for Category ",SELCAT,SP1,TDESC
          WRITE    JSCPOUTF,SEQ;"// Generated on ",CPCDATE
          WRITE    JSCPOUTF,SEQ;"//==========================================="
          WRITE    JSCPOUTF,SEQ;"//==========================================="
          MOVE     SELCAT,KEY2
          REP      " _",KEY2
          WRITE    JSCPOUTF,SEQ;"function SetMultiCategory",KEY2:
                                "(ListItem,SelectedCode,DefaultCode,HospCode) {"

JSCMUL99  RETURN
+
.------------------------------------------------------------
. Javascript Detail Line
.------------------------------------------------------------
MULDET00  MATCH     SP70,SAVEHOSP
          GOTO      MULDET50 IF NOT EQUAL
.
          WRITE    JSCPOUTF,SEQ;"if (#"",PTHSHOSP,"#" == HospCode) { "
          MOVE     PTHSHOSP,SAVEHOSP
          MOVE     ONE,HOSPFLAG             * Set site code processing to no
          GOTO     MULDET50
.
MULDET50  PACK      KEY10,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5:
                          TCINDC6,TCINDC7,TCINDC8,TCINDC9,TCINDC10
          WRITE    JSCPOUTF,SEQ;"   ListItem.options[ListItem.options.length]="
          WRITE    JSCPOUTF,SEQ;"    new Option(#"",TDESC,"#",#"",ACODE,KEY10:
                                "#");"
.
MULDET99  RETURN
+
.------------------------------------------------------------
. End Javascript
.------------------------------------------------------------
EMULJS00  WRITE     JSCPOUTF,SEQ;"if (DefaultCode!=#"undefined#") {"
          WRITE     JSCPOUTF,SEQ;"  if (!isWhitespace(DefaultCode)){"
          WRITE     JSCPOUTF,SEQ;"  SelectedCode=#"",DEFAULTC,"#" } }"
          WRITE     JSCPOUTF,SEQ;"if (isWhitespace(SelectedCode)) {"
          WRITE     JSCPOUTF,SEQ;"  return }"
          WRITE     JSCPOUTF,SEQ;"for (var i =0 ; i < ListItem.length; i++) {"
          WRITE     JSCPOUTF,SEQ;"   if (ListItem.options[i].value.substr(0,3)":
                                 "==SelectedCode) {"
          WRITE     JSCPOUTF,SEQ;"         ListItem.selectedIndex=i } };"
          WRITE     JSCPOUTF,SEQ;"}"
          WRITE     JSCPOUTF,SEQ;"// End of Javascript"
          CLOSE     JSCPOUTF
EMULJS99  RETURN
+
.-------------------------------------------------------------------------------
. Overwrite the Multi Hospital Javascript Page with the newly generated file
.-------------------------------------------------------------------------------
OVWRMJ00  CLEAR     JSCPOFIN
          STRIP     CWEBROOT
          APPEND    CWEBROOT,JSCPOFIN
          APPEND    "js/IBA_MultiCategory_",JSCPOFIN
          MOVE      SELCAT,KEY2
          REP       " _",KEY2
          APPEND    KEY2,JSCPOFIN
          APPEND    ".js",JSCPOFIN
          RESET     JSCPOFIN
.
          CLEAR     CMDLINE
          PACK      CMDLINE,MOVECMND,JSCPOUTN,SP1,JSCPOFIN,SP70
          EXECUTE   CMDLINE,TASKID   * overwrite original file with temp file
.
OVWRMJ99  RETURN
+
.-------------------------------------------------------------------------------
. Output Page Multi Hospital MRT Tracking Locations in Description Sequence
.-------------------------------------------------------------------------------
MULLOC00  CALL     MMLJSC00    * Create Output Files for Javascripts
          READ     CONTROLF,SIXTY;*105,MRCNHMTY
.
          PACK     KEY3,SP70
          CALL     RSPTHSP1
MULLOC10  CALL     RKPTHSP1
          BRANCH   OVRCD,MULLOC90
.         
          MOVE     ZERO,HOSPFLAG
          MOVE     ZERO,HOSPFLG2
          MOVE     SP70,SAVEHOSP
          MOVE     SP70,SAV2HOSP
.
          PACK     KEY37,SP70 
          CALL     RSMRLOC3
MULLOC30  CALL     RKMRLOC3
          BRANCH   OVRCD,MULLOC80
.
.         BRANCH   MRLOSTAT,MULLOC30        * Inactive
.
          MATCH    PTHSHOSP,MRLOHOSP
          GOTO     MULLOC30 IF NOT EQUAL
.
          IF       HOMEONLY = 1
            MATCH    MRCNHMTY,MRLOTYPE      * check if a Home Location type
            GOTO     MULLOC30 IF NOT EQUAL
          ENDIF          
.
          CALL     MMLLIN00   * Output Detail Line for Javascripts
          GOTO     MULLOC30   * Next
.
MULLOC80  IF        HOSPFLAG=1 
            WRITE    JSCPOUTF,SEQ;"}"       * Close function as hosp code
          ENDIF                             * processing was set to yes
.
          IF        HOSPFLG2=1
            WRITE    JSCPLOCF,SEQ;"}"
          ENDIF
.           
          GOTO     MULLOC10
.
MULLOC90  MOVE     ZERO,CHECKBOX
          CALL     MMLEND00       * End MRT Javascript Pages
.
          CALL     OVWRLC00       * Overwrite original MRT Locations file
.
MULLOC99  RETURN
+
.-------------------------------------------------------------------------------
. Create Multi Hospital MRT Tracking Locations javascripts
. creates two files,
.    JSCPOUTF with active locations only 
.    JSCPLOCF with all locations - active and inactive
.-------------------------------------------------------------------------------
MMLJSC00  MOVE     ZERO,CHECKBOX
          STRIP    CWEBROOT
.
          CLEAR    JSCPOUTN
          CLEAR    JSCPLOCN
.
          APPEND   CWEBROOT,JSCPOUTN
          APPEND   CWEBROOT,JSCPLOCN
.
          IF       HOMEONLY = 1
            APPEND   "js/MrtMultiHomeLocns.js.tmp",JSCPOUTN
            APPEND   "js/MrtMultiHomeLocnsAll.js.tmp",JSCPLOCN
          ELSE
            APPEND   "js/MrtMultiLocations.js.tmp",JSCPOUTN
            APPEND   "js/MrtMultiLocationsAll.js.tmp",JSCPLOCN
          ENDIF
.
          RESET    JSCPOUTN
          RESET    JSCPLOCN
.
          PACK     KEY8,CCC,CYY,CMM,CDD
          REP      " 0",KEY8
          UNPACK   KEY8,CCENT,CYEAR,CMON,CDAY
          CALL     PACDATE
.
          PREP     JSCPOUTF,JSCPOUTN
          WRITE    JSCPOUTF,SEQ;"//===========================================":
                                "==================="
.
          PREP     JSCPLOCF,JSCPLOCN
          WRITE    JSCPLOCF,SEQ;"//======================================":
                                "========================"
.
          IF       HOMEONLY = 1
            WRITE    JSCPOUTF,SEQ;"// Javascript options Multi Hospital":
                                  " Medical Records Tracking Home Locns"
            WRITE    JSCPOUTF,SEQ;"// Active Home Locations only"
.
            WRITE    JSCPLOCF,SEQ;"// Javascript options Multi Hospital":
                                  " Medical Records Tracking Home Locns"
            WRITE    JSCPLOCF,SEQ;"// All Home Locations (active and inactive)"
          ELSE
            WRITE    JSCPOUTF,SEQ;"// Javascript options Multi Hospital":
                                  " Medical Records Tracking Locations"
            WRITE    JSCPOUTF,SEQ;"// Active Locations only"
.
            WRITE    JSCPLOCF,SEQ;"// Javascript options Multi Hospital":
                                  " Medical Records Tracking Locations"
            WRITE    JSCPLOCF,SEQ;"// All Locations (active and inactive)"
          ENDIF
.
          WRITE    JSCPOUTF,SEQ;"// Generated on ",CPCDATE
          WRITE    JSCPOUTF,SEQ;"//===========================================":
                                "==================="
          WRITE    JSCPOUTF,SEQ;"//===========================================":
                                "==================="
.
          WRITE    JSCPLOCF,SEQ;"// Generated on ",CPCDATE
          WRITE    JSCPLOCF,SEQ;"//======================================":
                                "========================"
.
          IF       HOMEONLY = 1
            WRITE    JSCPOUTF,SEQ;"function MrtMultiHomeLocns":
                                  "(ListItem,SelectedCode,HospCode) {"
.
            WRITE    JSCPLOCF,SEQ;"function MrtMultiHomeLocnsAll":
                                  "(ListItem,SelectedCode,HospCode) {"
          ELSE
            WRITE    JSCPOUTF,SEQ;"function MrtMultiLocations":
                                  "(ListItem,SelectedCode,HospCode) {"
.
            WRITE    JSCPLOCF,SEQ;"function MrtMultiLocationsAll":
                                  "(ListItem,SelectedCode,HospCode) {"
          ENDIF
.
MMLJSC99  RETURN
+
.-------------------------------------------------------------------------------
. Create Multi Hospital MRT Tracking Locations Javascript Detail Lines
.-------------------------------------------------------------------------------
MMLLIN00  MATCH     SP70,SAV2HOSP
          GOTO      MMLLIN20 IF NOT EQUAL
.
MMLLIN10  WRITE     JSCPLOCF,SEQ;"if (#"",PTHSHOSP,"#" == HospCode) { "
          MOVE      PTHSHOSP,SAV2HOSP
          MOVE      ONE,HOSPFLG2             * Set hosp processing to yes
.
MMLLIN20  WRITE     JSCPLOCF,SEQ;"   ListItem.options[ListItem.options.length]="
          WRITE     JSCPLOCF,SEQ;"   new Option(#"",MRLODESC,"#",#"",MRLOCODE:
                                "#");"
.
          BRANCH    MRLOSTAT,MMLLIN99        * Inactive
.
          MATCH     SP70,SAVEHOSP
          GOTO      MMLLIN30 IF NOT EQUAL
.
          WRITE     JSCPOUTF,SEQ;"if (#"",PTHSHOSP,"#" == HospCode) { "
          MOVE      PTHSHOSP,SAVEHOSP
          MOVE      ONE,HOSPFLAG             * Set hosp processing to yes
.
MMLLIN30  WRITE     JSCPOUTF,SEQ;"   ListItem.options[ListItem.options.length]="
          WRITE     JSCPOUTF,SEQ;"   new Option(#"",MRLODESC,"#",#"",MRLOCODE:
                                "#");"
.
MMLLIN99  RETURN
+
.-------------------------------------------------------------------------------
. Finalise Multi Hospital MRT Tracking Locations Javascripts
.-------------------------------------------------------------------------------
MMLEND00  WRITE    JSCPOUTF,SEQ;"for (var i = 0 ; i < ListItem.length; i++) {"
          WRITE    JSCPOUTF,SEQ;"   if (ListItem.options[i].value":
                               " == SelectedCode) {"
          WRITE    JSCPOUTF,SEQ;"         ListItem.selectedIndex= i } };"
          WRITE    JSCPOUTF,SEQ;"}"
          WRITE    JSCPOUTF,SEQ;"// End of Javascript"
          CLOSE    JSCPOUTF
.
          WRITE    JSCPLOCF,SEQ;"for (var i = 0 ; i < ListItem.length; i++) {"
          WRITE    JSCPLOCF,SEQ;"   if (ListItem.options[i].value":
                               " == SelectedCode) {"
          WRITE    JSCPLOCF,SEQ;"         ListItem.selectedIndex= i } };"
          WRITE    JSCPLOCF,SEQ;"}"
          WRITE    JSCPLOCF,SEQ;"// End of Javascript"
          CLOSE    JSCPLOCF
.
MMLEND99  RETURN
+
.-------------------------------------------------------------------------------
. Overwrite the Locations files with the newly generated (temp) files
.-------------------------------------------------------------------------------
OVWRLC00  STRIP     CWEBROOT
          CLEAR     JSCPOFIN
          CLEAR     JSCPLFIN
.
          APPEND    CWEBROOT,JSCPOFIN
          APPEND    CWEBROOT,JSCPLFIN
.
          IF        HOMEONLY = 1
            APPEND    "js/MrtMultiHomeLocns.js",JSCPOFIN
            APPEND    "js/MrtMultiHomeLocnsAll.js",JSCPLFIN
          ELSE
            APPEND    "js/MrtMultiLocations.js",JSCPOFIN
            APPEND    "js/MrtMultiLocationsAll.js",JSCPLFIN
          ENDIF
.
          RESET     JSCPOFIN
          RESET     JSCPLFIN
.
          CLEAR     CMDLINE
          PACK      CMDLINE,MOVECMND,JSCPOUTN,SP1,JSCPOFIN,SP70
          EXECUTE   CMDLINE,TASKID   * overwrite original file with temp file
.
          CLEAR     CMDLINE
          PACK      CMDLINE,MOVECMND,JSCPLOCN,SP1,JSCPLFIN,SP70
          EXECUTE   CMDLINE,TASKID   * overwrite original file with temp file
.
OVWRLC99  RETURN
+
.------------------------------------------------------------
. Javascript Detail Line
.------------------------------------------------------------
APACHE00  MATCH     SP70,CWEBGFIL 
          GOTO      APACHE99 IF EQUAL                 * exit if no group file 
.
          PACK      KEY4,CWEBGFIL                     * if group file all zero then
          MATCH     "0000",KEY4                       * parameter has never been set.
          GOTO      APACHE99 IF EQUAL
.
          PREP      PCJSFILE,CWEBGFIL
.
          PACK      LASTGRP,SP10 
          PACK      KEY20,SP10,Z70     * start past blank groups 
          CALL      RSWBSGP2  
APACHE10  CALL      RKWBSGP2 
          BRANCH    OVRCD,APACHE90
.            
          MATCH     LASTGRP,WBSGGRPC
          GOTO      APACHE20 IF EQUAL
          MATCH     LASTGRP,SP10
          IF        @EQUAL
            WRITE    PCJSFILE,SEQ;"## Generated by WEBPAS, do not edit"
          ELSE
            WRITE    PCJSFILE,SEQ;" "                 * end previous line
          ENDIF
          MOVE      WBSGGRPC,LASTGRP
          STRIP     WBSGGRPC
          WRITE     PCJSFILE,SEQ;*+,WBSGGRPC,":";        * start group
          CALL      ALLGRP00                          * add the 'allgroups' memebers 
.
APACHE20  STRIP     WBSGUSID
          WRITE     PCJSFILE,SEQ;" ",*+,WBSGUSID;
          GOTO      APACHE10
.
APACHE90  WRITE     PCJSFILE,SEQ;" "                  * end final line        
          CLOSE     PCJSFILE
APACHE99  RETURN
.
ALLGRP00  PACK      SAVKEY20,WBSGGRPC,WBSGUSID        * save key from before call
          PACK      KEY20,SP70
          CALL      RSWBSGP2
ALLGRP10  CALL      RKWBSGP2
          BRANCH    OVRCD,ALLGRP90
          MATCH     WBSGGRPC,SP10                     
          GOTO      ALLGRP90 IF NOT EQUAL 
          STRIP     WBSGUSID  
          WRITE     PCJSFILE,SEQ;" ",*+,WBSGUSID;
          GOTO      ALLGRP10           
ALLGRP90  MOVE      SAVKEY20,KEY20
          CALL      RDWBSGP2                          * reposition to where we were 
ALLGRP99  RETURN
.
.------------------------------------------------------------
. Generate Mental Health Clinics JS
.------------------------------------------------------------
MENCLI00  CALL      MAKMCL00                 * Create Output File for Javascript
.
          MOVE      SP70,SAVECLIN
          MOVE      ZERO,PRFXDONE           * This site prefix done = No
          PACK      KEY9,SP70
          CALL      RDSSITA3
MENCLI10  CALL      RDKSITA3
          BRANCH    OVRCD,MENCLI90
.
          MATCH     OSTFILE,CFILEPRE        * Same as Current File Prefix
          IF        !@EQUAL
            MOVE      OSTFILE,CFILEPRE      * Save Current File Prefix
            CALL      OPNOUT00              * Open Files
            MOVE      ZERO,PRFXDONE         * This site prefix done = No
          ENDIF
.
          BRANCH    PRFXDONE,MENCLI10       * Skip if this site prefix is done
.
          MOVE     ONE,PRFXDONE             * Set this prefix processed to yes
          MOVE     ZERO,SITEFLAG
          MOVE     SP70,SAVESITE
.
          CALL     IBACLOCK
          PACK     CURRDATE,CCC,CYY,CMM,CDD
          REP      " 0",CURRDATE
.
          PACK     KEY28,SP70
          CALL     RSOTHED1          
MENCLI50  CALL     RKOTHED1
          BRANCH   OVRCD,MENCLI80
.
          MATCH    SAVECLIN,OTHECLIN
          GOTO     MENCLI50 IF EQUAL
.
          PACK     KEY18,OTHESITE,OTHECLIN,OTHEWDAY,OTHESTRT,SP70
          CALL     RDMASA1
          BRANCH   OVRCD,MENCLI50
.
          BRANCH   OMASTAT,MENCLI50
.
          MATCH    SP70,OTHEDTCC
          IF       !@EQUAL
            MATCH    CURRDATE,OTHEDTCC
            GOTO     MENCLI50 IF LESS
          ENDIF
.
          MATCH    SP70,OTHESITE
          GOTO     MENCLI50 IF EQUAL
.
          MATCH    SP70,OTHECTYP
          GOTO     MENCLI50 IF EQUAL
.
          MATCH    SP70,OTHECLIN
          GOTO     MENCLI50 IF EQUAL
.
          MOVE     SP70,OCADESC                 * Get Clinic Name
          PACK     KEY20,OTHESITE,OTHECLIN,Z70
          CALL     RDSCLIA1
          CALL     RDPCLIA1
          BRANCH   OVRCD,MENCLI50               * Get Clinic Name
.
          MATCH    OTHESITE,OCASITE
          GOTO     MENCLI50 IF NOT EQUAL
.
          MATCH    OTHECLIN,OCACLIN
          GOTO     MENCLI50 IF NOT EQUAL
.
          MATCH    "1",OTCLIACT                 * Active
          GOTO     MENCLI50 IF EQUAL
.
          PACK     KEY12,OTHESITE,OTHECTYP,SP70
          CALL     RDCTYA1
          BRANCH   OVRCD,MENCLI50
.
          MATCH    SP70,OCTGRP
          GOTO     MENCLI50 IF EQUAL
.
          PACK     KEY5,ANSC,ANSG,OCTGRP,SP70
          CALL     RDCODE1
          BRANCH   OVRCD,MENCLI50
.
          MATCH    ANSP,TCINDC10
          GOTO     MENCLI50 IF NOT EQUAL 
.
          CALL     JSCMCL00                 * Output Detail Line for Javascript
.
          MOVE     OTHECLIN,SAVECLIN
.
          GOTO     MENCLI50   * Next
.
MENCLI80  IF        SITEFLAG=1
            WRITE    JSCPOUTF,SEQ;"}"
          ENDIF
.
          GOTO     MENCLI10
.
MENCLI90  CALL     ENDMCL00   * End Javascript Page
          CALL     OVWRMC00   * Overwrite original Javascript Page
.
MENCLI99  RETURN
+
.------------------------------------------------------------
. Make Javascript
.------------------------------------------------------------
MAKMCL00  CLEAR    JSCPOUTN
          STRIP    CWEBROOT
          APPEND   CWEBROOT,JSCPOUTN
          APPEND   "js/MentalHealthClinicId",JSCPOUTN
          APPEND   ".js.tmp",JSCPOUTN
          RESET    JSCPOUTN
.
          PACK     KEY8,CCC,CYY,CMM,CDD
          REP      " 0",KEY8
          UNPACK   KEY8,CCENT,CYEAR,CMON,CDAY
          CALL     PACDATE
          PREP     JSCPOUTF,JSCPOUTN
          WRITE    JSCPOUTF,SEQ;"//==========================================="
          WRITE    JSCPOUTF,SEQ;"// Javascript options for Mental Hl  Clinic  "
          WRITE    JSCPOUTF,SEQ;"// IDS for a single site code                "
          WRITE    JSCPOUTF,SEQ;"// Generated on ",CPCDATE
          WRITE    JSCPOUTF,SEQ;"//==========================================="
          WRITE    JSCPOUTF,SEQ;"//==========================================="
          MOVE     SELCAT,KEY2
          REP      " _",KEY2
          WRITE    JSCPOUTF,SEQ;"function SetMentalHealthClinicId":
                                "(ListItem,SelectedCode,Site) {"

MAKMCL99  RETURN
+
.------------------------------------------------------------
. Javascript Detail Line
.------------------------------------------------------------
JSCMCL00  MATCH     SP70,SAVESITE
          GOTO      JSCMCL10 IF NOT EQUAL
.
          WRITE    JSCPOUTF,SEQ;"if (#"",OCASITE,"#" == Site) { "
          MOVE     OCASITE,SAVESITE
          MOVE     ONE,SITEFLAG
          GOTO     JSCMCL50
.
JSCMCL10  MATCH    SAVESITE,OCASITE
          GOTO     JSCMCL50 IF EQUAL
.
          WRITE    JSCPOUTF,SEQ;"} "
          WRITE    JSCPOUTF,SEQ;"if (#"",OCASITE,"#" == Site) { "
.
          MOVE     OCASITE,SAVESITE
.
JSCMCL50  MOVE     OCACLIN,DIM6
          SQUEEZE  DIM6
          STRIP    OCADESC
.
          WRITE    JSCPOUTF,SEQ;"   ListItem.options[ListItem.options.length]="
.
          MATCH    "2",OTCNCFMT         * Description
          IF       @EQUAL
            WRITE    JSCPOUTF,SEQ;"   new Option(#"",*+,OCADESC,"":
                                "#",#"",OCACLIN,"#");"
            GOTO     JSCMCL99
          ENDIF
.
          MATCH    "1",OTCNCFMT        * Description - Code
          IF       @EQUAL
            WRITE    JSCPOUTF,SEQ;"   new Option(#"",*+,OCADESC," - ":
                                "",DIM6,"#",#"",OCACLIN,"#");"
            GOTO     JSCMCL99
          ENDIF
.                                      * Code - Description
.
          WRITE    JSCPOUTF,SEQ;"   new Option(#"",*+,DIM6," - ":
                                "",OCADESC,"#",#"",OCACLIN,"#");"
.
JSCMCL99  RETURN
+
.------------------------------------------------------------
. Javascript  Line
.------------------------------------------------------------
ENDMCL00  WRITE    JSCPOUTF,SEQ;"for (var i =0 ; i < ListItem.length; i++) {"
          WRITE    JSCPOUTF,SEQ;"   if (ListItem.options[i].value.substr(0,6)":
                               "==SelectedCode) {"
          WRITE    JSCPOUTF,SEQ;"         ListItem.selectedIndex=i } };"
          WRITE    JSCPOUTF,SEQ;"}"
          WRITE    JSCPOUTF,SEQ;"// End of Javascript"
          CLOSE    JSCPOUTF
ENDMCL99  RETURN
+
.-------------------------------------------------------------------------------
. Overwrite the Mental Health Clinic Javascript with the newly generated file
.-------------------------------------------------------------------------------
OVWRMC00  CLEAR     JSCPOFIN
          STRIP     CWEBROOT
          APPEND    CWEBROOT,JSCPOFIN
          APPEND    "js/MentalHealthClinicId",JSCPOFIN
          APPEND    ".js",JSCPOFIN
          RESET     JSCPOFIN
.
          CLEAR     CMDLINE
          PACK      CMDLINE,MOVECMND,JSCPOUTN,SP1,JSCPOFIN,SP70
          EXECUTE   CMDLINE,TASKID   * overwrite original file with temp file
.
OVWRMC99  RETURN
+
.------------------------------------------------------------
. Clinical Note Type FHIR ValueSets
.------------------------------------------------------------
CNCFVS00  MOVE     SP70,DEFAULTC
.
          MOVE     "webPAS-Note-Type",FVSNAME
          MOVE     "webPAS Note Type",FVSDESC
          MOVE     "webPAS Note Type",FVSLDESC
.
          CALL     MAKFVS00            * Create Output File for FHIR ValueSet
          BRANCH   FVSGENR,CNCFVS99    * FHIR Directory Not Available
.
          MOVE     ZERO,FVSLINE
.
          PACK     KEY3,SP70
          CALL     RSOBCC1
CNCFVS10  CALL     RKOBCC1
          BRANCH   OVRCD,CNCFVS90
.
          IF       FVSLINE>0
            WRITE    FVSPOUTF,SEQ;", ";
          ENDIF
          WRITE    FVSPOUTF,SEQ;*+,"{ #"code#" : #"",OBCCTYP,"#",  ":
                                   "  #"display#" : #"",OBCCDES,"#" ";
.
          MATCH    SP70,OBCCSLV
          GOTO     CNCFVS50 IF NOT EQUAL
.
          MATCH    SP70,OBCCDHL
          GOTO     CNCFVS50 IF NOT EQUAL
.
          GOTO     CNCFVS80
.
CNCFVS50  WRITE    FVSPOUTF,SEQ;*+,",#"extension#": ["; 
.
          MATCH    SP70,OBCCSLV
          IF       !@EQUAL & !@EOS
.
            WRITE     FVSPOUTF,SEQ;*+," { #"url#":#"%BASEURL/extension/dxc-hc-notetype-security-level#"":
                        " ,#"valueString#":#"",OBCCSLV,"#"}";
.
          ENDIF 
.
          MATCH    SP70,OBCCDHL
          IF       !@EQUAL & !@EOS
            MATCH    SP70,OBCCSLV
            IF       !@EQUAL & !@EOS
              WRITE    FVSPOUTF,SEQ;*+," , ";
            ENDIF
.
            WRITE     FVSPOUTF,SEQ;*+,"       {  #"url#" : #"%BASEURL/extension/dxc-hc-defaulthighlightlevel#",";
            WRITE     FVSPOUTF,SEQ;*+,"           #"valueCodeableConcept#" : {";
            WRITE     FVSPOUTF,SEQ;*+,"                #"coding#": [ {";
            WRITE     FVSPOUTF,SEQ;*+,"                  #"system#": #"%BASEURL/ValueSet/Category-w2#", ";
            WRITE     FVSPOUTF,SEQ;*+,"                  #"code#": #"",OBCCDHL,"#" ";
.
            PACK      KEY5,CATW2,OBCCDHL,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              WRITE     FVSPOUTF,SEQ;*+,"                  ,#"display#": #"",TDESC,"#"";
            ENDIF
.
            WRITE     FVSPOUTF,SEQ;*+,"                 } ]";
            WRITE     FVSPOUTF,SEQ;*+,"            }";
            WRITE     FVSPOUTF,SEQ;*+,"        }";
.
          ENDIF
.
          WRITE    FVSPOUTF,SEQ;*+,"]"; 
.
CNCFVS80  WRITE    FVSPOUTF,SEQ;*+,"} ";
          ADD      ONE,FVSLINE
.
          GOTO     CNCFVS10
.
CNCFVS90  CALL     ENDFVS00
          CALL     OVWRFV00   * Overwrite original FHIR ValueSet file with temp
.
CNCFVS99  RETURN
+
.------------------------------------------------------------
. Clinical Note Duration FHIR ValueSets
.------------------------------------------------------------
CNDRVS00  MOVE     SP70,DEFAULTC
.
          MOVE     "webPAS-Note-Duration",FVSNAME
          MOVE     "webPAS Note Duration",FVSDESC
          MOVE     "webPAS Note Duration",FVSLDESC
.
          CALL     MAKFVS00            * Create Output File for FHIR ValueSet
          BRANCH   FVSGENR,CNDRVS99    * FHIR Directory Not Available
.
          WRITE    FVSPOUTF,SEQ;*+,"{ #"code#" : #"10 min#",  ":
                                   "  #"display#" : #"10 min#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"20 min#",  ":
                                   "  #"display#" : #"20 min#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"30 min#",  ":
                                   "  #"display#" : #"30 min#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"40 min#",  ":
                                   "  #"display#" : #"40 min#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"50 min#",  ":
                                   "  #"display#" : #"50 min#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"60 min#",  ":
                                   "  #"display#" : #"60 min#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"70 min#",  ":
                                   "  #"display#" : #"70 min#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"80 min#",  ":
                                   "  #"display#" : #"80 min#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"90 min#",  ":
                                   "  #"display#" : #"90 min#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
.
CNDRVS90  CALL     ENDFVS00
          CALL     OVWRFV00   * Overwrite original FHIR ValueSet file with temp
.
CNDRVS99  RETURN
+
.------------------------------------------------------------
. Clinical Note Incident Type FHIR ValueSets
.------------------------------------------------------------
CNITVS00  MOVE     SP70,DEFAULTC
.
          MOVE     "webPAS-Note-Incident",FVSNAME
          MOVE     "webPAS Note Incident",FVSDESC
          MOVE     "webPAS Note Incident",FVSLDESC
.
          CALL     MAKFVS00            * Create Output File for FHIR ValueSet
          BRANCH   FVSGENR,CNITVS99    * FHIR Directory Not Available
.
          WRITE    FVSPOUTF,SEQ;*+,"{ #"code#" : #"Assault#",  ":
                                   "  #"display#" : #"Assault#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Fall#",  ":
                                   "  #"display#" : #"Fall#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Faulty Equipment#",  ":
                                   "  #"display#" : #"Faulty Equipment#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Hot Water Burn#",  ":
                                   "  #"display#" : #"Hot Water Burn#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Incorrect Procedure#",  ":
                                   "  #"display#" : #"Incorrect Procedure#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Incorrect Medicine Administered#",  ":
                                   "  #"display#" : #"Incorrect Medicine Administered#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Incorrect Medicine Prescribed#",  ":
                                   "  #"display#" : #"Incorrect Medicine Prescribed#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Incorrect IV Fluid#",  ":
                                   "  #"display#" : #"Incorrect IV Fluid#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Needle Stick#",  ":
                                   "  #"display#" : #"Needle Stick#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Reaction to Soln/Tape#",  ":
                                   "  #"display#" : #"Reaction to Soln/Tape#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Self Harm#",  ":
                                   "  #"display#" : #"Self Harm#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Wound Dehisced#",  ":
                                   "  #"display#" : #"Wound Dehisced#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Other See Notes#",  ":
                                   "  #"display#" : #"Other See Notes#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
.
CNITVS90  CALL     ENDFVS00
          CALL     OVWRFV00   * Overwrite original FHIR ValueSet file with temp
.
CNITVS99  RETURN
+
.------------------------------------------------------------
. Clinical Note Location FHIR ValueSets
.------------------------------------------------------------
CNLOVS00  MOVE     SP70,DEFAULTC
.
          MOVE     "webPAS-Note-Location",FVSNAME
          MOVE     "webPAS Note Location",FVSDESC
          MOVE     "webPAS Note Location",FVSLDESC
.
          CALL     MAKFVS00            * Create Output File for FHIR ValueSet
          BRANCH   FVSGENR,CNLOVS99    * FHIR Directory Not Available
.
          WRITE    FVSPOUTF,SEQ;*+,"{ #"code#" : #"Car Park#",  ":
                                   "  #"display#" : #"Car Park#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Corridor#",  ":
                                   "  #"display#" : #"Corridor#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Emergency Room#",  ":
                                   "  #"display#" : #"Emergency Room#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Front Entrance#",  ":
                                   "  #"display#" : #"Front Entrance#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Hospital Garden#",  ":
                                   "  #"display#" : #"Hospital Garden#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Outpatients#",  ":
                                   "  #"display#" : #"Outpatients#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Patients Room#",  ":
                                   "  #"display#" : #"Patients Room#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Theatre#",  ":
                                   "  #"display#" : #"Theatre#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Ward#",  ":
                                   "  #"display#" : #"Ward#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Other See Notes#",  ":
                                   "  #"display#" : #"Other See Notes#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
.
CNLOVS90  CALL     ENDFVS00
          CALL     OVWRFV00   * Overwrite original FHIR ValueSet file with temp
.
CNLOVS99  RETURN
+
.------------------------------------------------------------
. Clinical Note Type of Injury  FHIR ValueSets
.------------------------------------------------------------
CNTYVS00  MOVE     SP70,DEFAULTC
.
          MOVE     "webPAS-Note-Cause",FVSNAME
          MOVE     "webPAS Note Cause",FVSDESC
          MOVE     "webPAS Note Cause",FVSLDESC
.
          CALL     MAKFVS00            * Create Output File for FHIR ValueSet
          BRANCH   FVSGENR,CNTYVS99    * FHIR Directory Not Available
.
          WRITE    FVSPOUTF,SEQ;*+,"{ #"code#" : #"Bed Rails Down#",  ":
                                   "  #"display#" : #"Bed Rails Down#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Doctor Error#",  ":
                                   "  #"display#" : #"Doctor Error#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Gang Warfare#",  ":
                                   "  #"display#" : #"Gang Warfare#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Family Dispute#",  ":
                                   "  #"display#" : #"Family Dispute#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Hot Water Thermostat#",  ":
                                   "  #"display#" : #"Hot Water Thermostat#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Nurse Error#",  ":
                                   "  #"display#" : #"Nurse Error#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Patient Confused#",  ":
                                   "  #"display#" : #"Patient Confused#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Wet Floors#",  ":
                                   "  #"display#" : #"Wet Floors#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Burns#",  ":
                                   "  #"display#" : #"Burns#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
.
CNTYVS90  CALL     ENDFVS00
          CALL     OVWRFV00   * Overwrite original FHIR ValueSet file with temp
.
CNTYVS99  RETURN
+
.------------------------------------------------------------
. Clinical Note Cause FHIR ValueSets
.------------------------------------------------------------
CNCAVS00  MOVE     SP70,DEFAULTC
.
          MOVE     "webPAS-Note-Injury",FVSNAME
          MOVE     "webPAS Note Injury",FVSDESC
          MOVE     "webPAS Note Injury",FVSLDESC
.
          CALL     MAKFVS00            * Create Output File for FHIR ValueSet
          BRANCH   FVSGENR,CNCAVS99    * FHIR Directory Not Available
.
          WRITE    FVSPOUTF,SEQ;*+,"{ #"code#" : #"Abrasions#",  ":
                                   "  #"display#" : #"Abrasions#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Bruising#",  ":
                                   "  #"display#" : #"Bruising#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Burns#",  ":
                                   "  #"display#" : #"Burns#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Fracture#",  ":
                                   "  #"display#" : #"Fracture#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Minor Reaction#",  ":
                                   "  #"display#" : #"Minor Reaction#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Major Reaction#",  ":
                                   "  #"display#" : #"Major Reaction#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"Other See Notes#",  ":
                                   "  #"display#" : #"Other See Notes#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
.
CNCAVS90  CALL     ENDFVS00
          CALL     OVWRFV00   * Overwrite original FHIR ValueSet file with temp
.
CNCAVS99  RETURN
+
.------------------------------------------------------------
. Lookups FHIR ValueSets
.------------------------------------------------------------
LOOKVS00  PACK     KEY8,SP70
          CALL     RSWBLI1
LOOKVS10  CALL     RKWBLI1
          BRANCH   OVRCD,LOOKVS99
.
.
          PACK     KEY11,WBLILKID,SP70
          CALL     RSWBLP1
LOOKVS20  CALL     RKWBLP1
          BRANCH   OVRCD,LOOKVS10
.
          MATCH    WBLILKID,WBLPLKID
          GOTO     LOOKVS10 IF NOT EQUAL
.
          MOVE     SP70,DEFAULTC
.
          CLEAR    FVSLOOK
          APPEND   "Lookup_",FVSLOOK
          MOVE     WBLILKID,KEY8A
          APPEND   KEY8A,FVSLOOK
          RESET    FVSLOOK
          STRIP    FVSLOOK
          ENDSET   FVSLOOK
          APPEND   "_",FVSLOOK
          APPEND   WBLPPGNO,FVSLOOK
          RESET    FVSLOOK
.
          MOVE     FVSLOOK,FVSNAME
          MOVE     FVSLOOK,FVSDESC
          MOVE     FVSLOOK,FVSLDESC
.
          CALL     MAKFVS00            * Create Output File for FHIR ValueSet
          BRANCH   FVSGENR,LOOKVS99    * FHIR Directory Not Available
.
          MOVE     ZERO,FVSLINE
.
.
.
          PACK     KEY64,WBLPLKID,WBLPPGNO,SP70
          CALL     RSWBLD2
LOOKVS50  CALL     RKWBLD2
          BRANCH   OVRCD,LOOKVS90          
.
          MATCH    WBLPLKID,WBLDLKID
          GOTO     LOOKVS90 IF NOT EQUAL
          MATCH    WBLPPGNO,WBLDPAGE
          GOTO     LOOKVS90 IF NOT EQUAL
          MATCH    "0",WBLDACTV            * Is it active
          GOTO     LOOKVS50 IF EQUAL        * no - go to next
.
.
          IF       FVSLINE>0
            WRITE    FVSPOUTF,SEQ;", ";
          ENDIF
          WRITE    FVSPOUTF,SEQ;*+,"{ #"code#" : #"",WBLDCODE,"#",  ":
                                   "  #"display#" : #"",WBLDDESC,"#" ";
.
          WRITE    FVSPOUTF,SEQ;*+,",#"extension#": [";
.
          WRITE     FVSPOUTF,SEQ;*+," { #"url#":#"%BASEURL/extension/dxc-hc-uniqueid#"":
                        " ,#"valueString#":#"",WBLDUQID,"#"}";
.
          MATCH    SP70,WBLDTYPE
          IF       !@EQUAL & !@EOS
.
            WRITE    FVSPOUTF,SEQ;*+," , ";
.
            WRITE     FVSPOUTF,SEQ;*+,"       {  #"url#" : #"%BASEURL/extension/dxc-hc-linktype#",";
            WRITE     FVSPOUTF,SEQ;*+,"           #"valueCodeableConcept#" : {";
            WRITE     FVSPOUTF,SEQ;*+,"                #"coding#": [ {";
            WRITE     FVSPOUTF,SEQ;*+,"                  #"system#": #"%BASEURL/ValueSet/Lookup-Link-Type#", ";
            WRITE     FVSPOUTF,SEQ;*+,"                  #"code#": #"",WBLDTYPE,"#" ";
.
            MATCH     "0",WBLDTYPE
            IF        @EQUAL
              WRITE     FVSPOUTF,SEQ;*+,"                  ,#"display#": #"Link#"";
            ENDIF
.
            MATCH     "1",WBLDTYPE
            IF        @EQUAL
              WRITE     FVSPOUTF,SEQ;*+,"                  ,#"display#": #"Detail Line#"";
            ENDIF             
.
            MATCH     "2",WBLDTYPE
            IF        @EQUAL
              WRITE     FVSPOUTF,SEQ;*+,"                  ,#"display#": #"Checkbox Line#"";
            ENDIF
.
            WRITE     FVSPOUTF,SEQ;*+,"                 } ]";
            WRITE     FVSPOUTF,SEQ;*+,"            }";
            WRITE     FVSPOUTF,SEQ;*+,"        }";
.
          ENDIF
.
          MATCH    SP70,WBLDLKPG
          IF       !@EQUAL & !@EOS
.
            WRITE    FVSPOUTF,SEQ;*+," , ";
.
            WRITE     FVSPOUTF,SEQ;*+," { #"url#":#"%BASEURL/extension/dxc-hc-linkpage#"":
                          " ,#"valueString#":#"",WBLDLKPG,"#"}";
.
          ENDIF
.
          MATCH    SP70,WBLDACTV
          IF       !@EQUAL & !@EOS
.
            WRITE    FVSPOUTF,SEQ;*+," , ";
.
            MATCH     "1",WBLDACTV
            IF        @EQUAL
              WRITE     FVSPOUTF,SEQ;*+," { #"url#":#"%BASEURL/extension/dxc-hc-lookupactive#"":
                            " ,#"valueBoolean#":#"true#"}";
            ELSE
              WRITE     FVSPOUTF,SEQ;*+," { #"url#":#"%BASEURL/extension/dxc-hc-lookupactive#"":
                            " ,#"valueBoolean#":#"false#"}";
            ENDIF
.
          ENDIF
.
.
.**** INSERT CODE HERE ****
.
          WRITE    FVSPOUTF,SEQ;*+,"]";
.
          WRITE    FVSPOUTF,SEQ;*+,"} ";
          ADD      ONE,FVSLINE
.
          GOTO     LOOKVS50
.
.
LOOKVS90  CALL     ENDFVS00
          CALL     OVWRFV00   * Overwrite original FHIR ValueSet file with temp
          GOTO     LOOKVS20
.
LOOKVS99  RETURN
+
.------------------------------------------------------------
. Lookups Link Type FHIR API ValueSet
.------------------------------------------------------------
LOLTVS00  MOVE     SP70,DEFAULTC
.
          MOVE     "Lookup-Link-Type",FVSNAME
          MOVE     "Lookup Link Type",FVSDESC
          MOVE     "Lookup Link Type",FVSLDESC
.
          CALL     MAKFVS00            * Create Output File for FHIR ValueSet
          BRANCH   FVSGENR,LOLTVS99    * FHIR Directory Not Available
.
          WRITE    FVSPOUTF,SEQ;*+,"{ #"code#" : #"0#",  ":
                                   "  #"display#" : #"Link#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"1#",  ":
                                   "  #"display#" : #"Detail Line#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
          WRITE    FVSPOUTF,SEQ;*+,",{ #"code#" : #"2#",  ":
                                   "  #"display#" : #"Checkbox Line#" ";
          WRITE    FVSPOUTF,SEQ;*+,"} ";
.
LOLTVS90  CALL     ENDFVS00
          CALL     OVWRFV00   * Overwrite original FHIR ValueSet file with temp
.
LOLTVS99  RETURN
+
.------------------------------------------------------------
          INC       WEBSGPIO/INC
          INC       WEBLDTIO/INC
          INC       WEBLIDIO/INC
          INC       WEBLPGIO/INC
          INC       MRTLOCIO/INC
          INC       COMCODIO/INC
          INC       PATCODIO/INC
          INC       MLTCODIO/INC
          INC       IBAPOSIO/INC
          INC       IBASEQIO/INC
          INC       WEBERRIO/INC
          INC       OBSCNCIO/INC
          INC       OUTCTYIO/INC
          INC       OUTSITIO/INC
          INC       OUTCLIIO/INC
          INC       OUTHEDIO/INC
          INC       OUTMA1IO/INC
          INC       PATHSPIO/INC
          INC       HL7TABIO/INC
          INC       HL7CODIO/INC
          INC       STD001IO
          INC       TFILENAM


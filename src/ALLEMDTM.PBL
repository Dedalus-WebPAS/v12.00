. *----------------------------------------------------------------------
. * Include Name  :   ALLEMDTM.PBL
. *
. * Function      :   CGI variables for ALLEMDTM - allemcaf.dat
. *
. * Includes Needed : 
. *                   
. * Modifications   :
. *       V9.12.01  28/09/2009  Mike Laming   CAR 173274
. *                 Fixed List Encounters variables at MDROW000
. *       V9.11.01  16/10/2008 Peter Vela CAR 179155
. *                 Fixed redirect in NEXTMD00 and PREVMD00
. *       V9.08.01  23/03/2007 Jill Habasque  
. *                 Created include
. *----------------------------------------------------------------------
.
.------------------------------------------------------------------------
.   Clear Parameters for Allied Health EMD Table
.------------------------------------------------------------------------
.
CPALEM00  MOVE      Z70,ALEMD001
          MOVE      Z70,ALEMD002
          MOVE      Z70,ALEMD003
          MOVE      Z70,ALEMD004
          MOVE      Z70,ALEMD005
          MOVE      Z70,ALEMD006
          MOVE      Z70,ALEMD007
          MOVE      Z70,ALEMD008
          MOVE      Z70,ALEMD009
          MOVE      Z70,ALEMD010
          MOVE      Z70,ALEMD011
.
CPALEM99  RETURN
.
.------------------------------------------------------------
. Add fields for allied health EMD Table
.------------------------------------------------------------
ALEM0000  BRANCH    FLDITMNO,ALEM0100,ALEM0200,ALEM0300,ALEM0400,ALEM0500:
                             ALEM0600,ALEM0700,ALEM0800,ALEM0900,ALEM1000:
                             ALEM1100,ALEM1200,ALEM1300,ALEM1400,ALEM1500:
                             ALEM1600,ALEM1700,ALEM1800,ALEM1900,ALEM2000
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      ALEM9999
.
.
ALEM0100  WRITE     HTMLFILE;ALEMVISN;
          GOTO      ALEM9999
.
ALEM0200  WRITE     HTMLFILE;ALEMENCT;
          GOTO      ALEM9999
.
ALEM0300  WRITE     HTMLFILE;ALEMMCNT;
          GOTO      ALEM9999
.
ALEM0400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,ALEM0410
.
          WRITE     HTMLFILE;ALEMCODE;
          GOTO      ALEM9999
.
ALEM0410  PACK      KEY20,ALEMCODE,SP70
          CALL      RDALMED1
          BRANCH    OVRCD,ALEM9999
.
          WRITE     HTMLFILE;ALMEDESC;
          GOTO      ALEM9999
.
ALEM0500  WRITE     HTMLFILE;ALEMQANT;
          GOTO      ALEM9999
.
ALEM0600  MOVE      "UN",CATEGORY
          MOVE      ALEMUNIT,CODE
          CALL      CODITM00
          GOTO      ALEM9999
.
ALEM0700  WRITE     HTMLFILE;ALEMDURA;
          GOTO      ALEM9999
.
ALEM0800  MOVE      "UI",CATEGORY
          MOVE      ALEMDTYP,CODE
          CALL      CODITM00
          GOTO      ALEM9999
.
ALEM0900  MOVE      "MR",CATEGORY
          MOVE      ALEMMEDR,CODE
          CALL      CODITM00
          GOTO      ALEM9999
.
ALEM1000  MOVE      "MZ",CATEGORY
          MOVE      ALEMMEDT,CODE
          CALL      CODITM00
          GOTO      ALEM9999
.
ALEM1100  WRITE     HTMLFILE;ALEMTEXT;
          GOTO      ALEM9999
.
ALEM1200  MATCH     ALEMCDAT,SP70
          GOTO      ALEM9999 IF EQUAL
          UNPACK    ALEMCDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      ALEM9999
.
ALEM1300  WRITE     HTMLFILE;ALEMCTIM; 
          GOTO      ALEM9999
.
ALEM1400  MATCH     SP70,ALEMCUID
          GOTO      ALEM9999 IF EQUAL
          PACK      KEY10,ALEMCUID
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      ALEMCUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      ALEM9999
.
ALEM1500  MATCH     ALEMUDAT,SP70
          GOTO      ALEM9999 IF EQUAL
          UNPACK    ALEMUDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      ALEM9999
.
ALEM1600  WRITE     HTMLFILE;ALEMUTIM;
          GOTO      ALEM9999
.
ALEM1700  MATCH     SP70,ALEMUUID
          GOTO      ALEM9999 IF EQUAL
          PACK      KEY10,ALEMUUID
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      ALEMUUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      ALEM9999
.
ALEM1800  CALL      MDTAB000
          GOTO      ALEM9999
.
ALEM1900  CALL      NEXTMD00
          GOTO      ALEM9999
.
ALEM2000  CALL      PREVMD00
          GOTO      ALEM9999
.
ALEM9999  RETURN
.
.------------------------------------------------------------
. Table of Allied Health Medication Details
.------------------------------------------------------------
MDTAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          CALL      MDHED000                * Display EMD heading
.
          UNPACK    ENCOUTKY,ADMISSNO,ALENENCT
.
          PACK      KEY24,ENCOUTKY,STARTKEY,SP70
          CALL      RSALEMD1
          CALL      RPALEMD1
MDTAB100  CALL      RKALEMD1
          BRANCH    OVRCD,MDTAB999
.
          MATCH     ADMISSNO,ALEMVISN
          GOTO      MDTAB999 IF NOT EQUAL
.
          MATCH     ALENENCT,ALEMENCT
          GOTO      MDTAB999 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO     MDTAB100
          ENDIF
.
          CALL      MDROW000                * Display EMD Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      MDTAB100 IF NOT EQUAL
.
MDTAB999  RETURN
.
.******************************************************************************
.*                      Display Of Header(Medication List)                    *
.******************************************************************************
MDHED000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=12%>":
                               "<b>Medication Code</b></td>":
                               "<td class=HeadingCell width=18%>":
                               "<b>Description</b></td>":
                               "<td class=HeadingCell width=18%>":
                               "<b>Duration</b></td>":
                               "<td class=HeadingCell width=18%>":
                               "<b>Type</b></td>":
                               "<td class=HeadingCell width=18%>":
                               "<b>Route</b></td>":
                             "</tr>"
.
MDHED999  RETURN
.
.------------------------------------------------------------
.  Allied Health Medication Details (TABLE ROW)
.------------------------------------------------------------
MDROW000   PACK      KEY20,ALEMCODE,SP70
           CALL      RDALMED1
           IF        OVRCD=1
             PACK      ALMEDESC,SP70
           ENDIF
.
           PACK      KEY30,ALEMDURA,SP70    * Duration Type (Cat."UI")
           MATCH     SP70,ALEMDTYP
           IF        !@EQUAL
             PACK      KEY5,ANSU,ANSI,ALEMDTYP,SP70
             CALL      RDCODE1
             IF        OVRCD=0
               PACK      KEY30,ALEMDURA,SP1,TDESC,SP70
             ENDIF
           ENDIF
.
           MOVE      SP70,KEY25             * Medication Type (Cat."MZ")
           MATCH     SP70,ALEMMEDT     
           IF        !@EQUAL
             PACK      KEY5,ANSM,ANSZ,ALEMMEDT,SP70
             CALL      RDCODE1
             IF        OVRCD=0
               PACK      KEY25,TDESC,SP70
             ENDIF
           ENDIF
.
           MOVE      SP70,TDESC             * Medication Route (Cat."MR")
           MATCH     SP70,ALEMMEDR
           IF        !@EQUAL
             PACK      KEY5,ANSM,ANSR,ALEMMEDR,SP70
             CALL      RDCODE1
             IF        OVRCD=1
               PACK      TDESC,SP70
             ENDIF
           ENDIF
.
           REP       " +",ENCOUTKY
           REP       " +",ALEMVISN
           REP       " +",ALEMENCT
           REP       " +",ALEMMCNT 
           WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&encoutky=",ENCOUTKY:
                             "&alemd001=",ALEMVISN:
                             "&alemd002=",ALEMENCT:
                             "&alemd003=",ALEMMCNT,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             ALEMCODE,"</td>":
                             "<td>",ALMEDESC,"&nbsp;</td>":
                             "<td>",KEY30,"&nbsp;</td>":
                             "<td>",KEY25,"&nbsp;</td>":
                             "<td>",TDESC,"&nbsp;</td>":
                             "</tr>"
           REP       "+ ",ENCOUTKY
           REP       "+ ",ALEMVISN
           REP       "+ ",ALEMENCT
           REP       "+ ",ALEMMCNT 
.
MDROW999  RETURN
.
.-----------------------------------------------------------
. Link to Next Group
.-----------------------------------------------------------
NEXTMD00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,D3,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",ENCOUTKY
          REP       " +",ALEMMCNT
.
          WRITE     HTMLFILE;"allweb03.pbl":
                                 "?reportno=",F2:
                                 "&template=",D3:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&encoutky=",ENCOUTKY:
                                 "&alemd003=",ALEMMCNT;
.
          REP       "+ ",ENCOUTKY
          REP       "+ ",ALEMMCNT
.
NEXTMD99  RETURN
.
.-------------------------------------------------------------
. Link to Prev Group
.-------------------------------------------------------------
PREVMD00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",ENCOUTKY
          REP       " +",ALEMMCNT
.
          WRITE     HTMLFILE;"allweb03.pbl":
                                "?reportno=",F2:
                                "&template=",FLDPARA:
                                "&startnum=",KEY3:
                                "&norecord=",KEY2:
                                "&encoutky=",ENCOUTKY:
                                "&alemd003=",ALEMMCNT;
.
          REP       "+ ",ENCOUTKY
          REP       "+ ",ALEMMCNT
.
PREVMD99  RETURN
.
.------------------------------------------------------------
.   Set Parameters for allied health EMD table
.------------------------------------------------------------
SPALEM00  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPALEM01,SPALEM02,SPALEM03,SPALEM04,SPALEM05:
                       SPALEM06,SPALEM07,SPALEM08,SPALEM09,SPALEM10:
                       SPALEM11
.
          MOVE      ONE,EXIT
          GOTO      SPALEM99
.
SPALEM01  MOVE      QRYDATA,ALEMD001
          GOTO      SPALEM99
.
SPALEM02  MOVE      QRYDATA,ALEMD002
          GOTO      SPALEM99
.
SPALEM03  MOVE      QRYDATA,ALEMD003
          GOTO      SPALEM99
.
SPALEM04  MOVE      QRYDATA,ALEMD004
          GOTO      SPALEM99
.
SPALEM05  MOVE      QRYDATA,ALEMD005
          GOTO      SPALEM99
.
SPALEM06  MOVE      QRYDATA,ALEMD006
          GOTO      SPALEM99
.
SPALEM07  MOVE      QRYDATA,ALEMD007
          GOTO      SPALEM99
.
SPALEM08  MOVE      QRYDATA,ALEMD008
          GOTO      SPALEM99
.
SPALEM09  MOVE      QRYDATA,ALEMD009
          GOTO      SPALEM99
.
SPALEM10  MOVE      QRYDATA,ALEMD010
          GOTO      SPALEM99
.
SPALEM11  MOVE      QRYDATA,ALEMD011
          GOTO      SPALEM99
.
SPALEM99  RETURN
.------------------------------------------------------------
.  Update allied health EMD table
.------------------------------------------------------------
MVALEM00  MATCH     ALEMD001,Z70
          IF        !@EQUAL
            MOVE      ALEMD001,ALEMVISN
          ENDIF
.
          MATCH     ALEMD002,Z70
          IF        !@EQUAL
            MOVE      ALEMD002,ALEMENCT
          ENDIF
.
          MATCH     ALEMD003,Z70
          IF        !@EQUAL
            MOVE      ALEMD003,ALEMMCNT
          ENDIF
.
          MATCH     ALEMD004,Z70
          IF        !@EQUAL
            MOVE      ALEMD004,ALEMCODE
          ENDIF
.
          MATCH     ALEMD005,Z70
          IF        !@EQUAL
            MOVE      ALEMD005,ALEMQANT
          ENDIF
.
          MATCH     ALEMD006,Z70
          IF        !@EQUAL
            MOVE      ALEMD006,ALEMUNIT
          ENDIF
.
          MATCH     ALEMD007,Z70
          IF        !@EQUAL
            MOVE      ALEMD007,ALEMDURA 
          ENDIF
.
          MATCH     ALEMD008,Z70
          IF        !@EQUAL
            MOVE      ALEMD008,ALEMDTYP
          ENDIF
.
          MATCH     ALEMD009,Z70
          IF        !@EQUAL
            MOVE      ALEMD009,ALEMMEDR
          ENDIF
.
          MATCH     ALEMD010,Z70
          IF        !@EQUAL
            MOVE      ALEMD010,ALEMMEDT
          ENDIF
.
          MATCH     ALEMD011,Z70
          IF        !@EQUAL
            MOVE      ALEMD011,ALEMTEXT
          ENDIF
.
MVALEM99  RETURN

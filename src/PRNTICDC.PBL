.*****************************************************************************
.*                          PRNTICDC                                          *
.*                  Print ICD10 codes on invoices                             *
.*                                                                            *
.* Modifications :                                                            *
.*        V12.00.01 23/05/2025  Ebon Clements   TSK 0955096                   *
.*                  Alphanueric visit number changes                          *
.*        V10.03.01 05/03/2013  Patrick Adair   CAR 281898                    *
.*                  Corrected key patecda1 and patecoa1 from KEY14 to KEY13   *
.*        V10.02.01 28/03/2011  Mike Laming   CAR 240107                      *
.*                  Mods to PATECDaf & PATECOaf variables & Keys - file change*
.*****************************************************************************
          DEFPROC   PRNTICDC
.
          INC       PATECDFD/INC
          INC       PATECOFD/INC
.
PICDCODE  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,HUND14;*238,PTCNPICD
          MATCH     "1",PTCNPICD
          GOTO      PICD9999 IF NOT EQUAL     * Not printing ICD codes
.
          OPEN      PATECDA1,"patecdaf"
          CALL      PECD0000                  * Print ICD Disease codes
.
          OPEN      PATECOA1,"patecoaf"
          CALL      PECO0000                  * Print ICD Procedure codes
.
PICD9000  CLOSE     PATECDA1
          CLOSE     PATECOA1
.
PICD9999  GOTO      ENDICDC
.
.*********************************************************************
.         Print ICD Disease codes
.*********************************************************************
PECD0000  MOVE      ZERO,F1
          MOVE      ZERO,FORM1
          MOVE      SP70,KEY40
          CLEAR     KEY40
.
          PACK      KEY13,AADMNO,SP70
          CALL      RSPTECD1                  * read disease coding
PECD1000  CALL      RKPTECD1
          BRANCH    OVRCD,PECD3000
.
          MATCH     AADMNO,PTEDADMN
          GOTO      PECD3000 IF NOT EQUAL     * Different admission
.
          MATCH     SP70,PTEDCODE
          GOTO      PECD1000 IF EQUAL
          ADD       ONE,F1
.
          APPEND    PTEDCODE,KEY40
          APPEND    SP1,KEY40
.
          COMPARE   FOUR,F1
          GOTO      PECD1000 IF LESS
          MOVE      ZERO,OVRCD
          APPEND    SP70,KEY40
          RESET     KEY40
          GOTO      PECD6000
.
PECD3000  MOVE      ONE,OVRCD
          APPEND    SP70,KEY40
          RESET     KEY40
          MATCH     SP70,KEY40
          GOTO      PECD9999 IF EQUAL
.
PECD6000  COMPARE   MAXLINE,COUNT
          CALL      TAIL IF NOT LESS
.
          IF        FORM1=0
            PRINT     *2,"ICD10 Diseases: ";
            MOVE      ONE,FORM1
          ENDIF
.
          PRINT     *20,KEY40;
          CALL      PEOL0000
          BRANCH    OVRCD,PECD9999
.
          MOVE      ZERO,F1
          MOVE      SP70,KEY40
          CLEAR     KEY40
          GOTO      PECD1000
.
PECD9999  RETURN
+
.*********************************************************************
.         Print ICD Disease codes
.*********************************************************************
PECO0000  MOVE      ZERO,F1
          MOVE      ZERO,FORM1
          MOVE      SP70,KEY40
          CLEAR     KEY40
.
          PACK      KEY13,AADMNO,SP70
          CALL      RSPTECO1                  * read operation coding
PECO1000  CALL      RKPTECO1
          BRANCH    OVRCD,PECO3000
.
          MATCH     AADMNO,PTEOADMN
          GOTO      PECO3000 IF NOT EQUAL     * Different admission
.
          MATCH     SP70,PTEOCODE
          GOTO      PECO1000 IF EQUAL
          ADD       ONE,F1
.
          APPEND    PTEOCODE,KEY40
          APPEND    SP1,KEY40
.
          COMPARE   FOUR,F1
          GOTO      PECO1000 IF LESS
          MOVE      ZERO,OVRCD
          APPEND    SP70,KEY40
          RESET     KEY40
          GOTO      PECO6000
.
PECO3000  APPEND    SP70,KEY40
          RESET     KEY40
          MOVE      ONE,OVRCD
          MATCH     SP70,KEY40
          GOTO      PECO9999 IF EQUAL
.
PECO6000  COMPARE   MAXLINE,COUNT
          CALL      TAIL IF NOT LESS
.
          IF        FORM1=0
            PRINT     *2,"ICD10 Operation: ";
            MOVE      ONE,FORM1
          ENDIF
.
          PRINT     *20,KEY40;
          CALL      PEOL0000
          BRANCH    OVRCD,PECO9999
.
          MOVE      ZERO,F1
          MOVE      SP70,KEY40
          CLEAR     KEY40
          GOTO      PECO1000
.
PECO9999  RETURN
.
          INC       PATECDIO/INC
          INC       PATECOIO/INC
          INC       IBAOVRIO/INC
.
ENDICDC   ENDPROC
.

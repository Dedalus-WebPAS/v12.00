.************************************************************************
.*  Procedure: DGCLICEU  -  Send an Update Allied Health Encounter (A08)*
.*                                                                      *
.*  Author   : Steve Armstrong  10/03/2010                              *
.*                                                                      *
.*  Requires : PATMA1FD (Patient Master & Extension)                    *
.*             PMSPX2FD (Patient Master Extn.2)                         *
.*             ALLENCFD (Allied Health Encounter)                       *
.*                                                                      *
.*  Requirement removed (V9.02.01)                                      *
.*             PATCGPFD (Registered GP/Practice Changes)                *
.*             PATNIDFD (Patient National ID Number)                    *
.*             NHIMASFD (NZ Health Interface)                           *
.*             PMIGTNID.PBL (Get the National ID Number)                *
.*                                                                      *
.*  Mods     :                                                          *
.*                                                                      *
.************************************************************************
.*  V11.04.01 09/01/2024 Thanh T           TSK 0936263                  *
.*            Added OPEN/CLOSE PMSQPXA1 index                           *
.************************************************************************
.*  V10.03.01 17/04/2013  Davin S          CAR 280425                   *
.*            Changed IBCNUCIS - value 1 or greater will write trigger  *
.*  V10.00.01 19/03/2010  Steve Armstrong   CAR 135505                  *
.*            Added setting of H7CITRID & H7CIINCL                      *
.*            09/03/2010  Steve Armstrong   CAR 135505                  *
.*                        Created include.                              *
.*                                                                      *
.************************************************************************
          DEFPROC   DGCLICEU
.
          INC       ALLQUEFD/INC
          INC       HL7CISFD/INC
          INC       PMSQPTFD/INC
.
MESSAGID  DIM       20
.
DGCLI000  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,ZERO;*133,IBCNUCIS
          READ      CONTROLF,HUND06;*222,ALCNA08L
.
          MATCH     "1",IBCNUCIS                 * using HL7 messaging ?
          GOTO      DGCLI999 IF LESS             * no - finished
.
          MATCH     "1",ALCNA08L                 * sending A/H Enc A08 ?
          GOTO      DGCLI999 IF NOT EQUAL        * no - finished
.
.         We are sending HL7 messages, so first open the relevant holding tables
.
          OPEN      HL7CISA1,"hl7cisaf"
          OPEN      PMSQPTA1,"pmsqptaf"
          OPEN      PMSQPXA1,"pmsqpxaf"
          OPEN      ALLQUEA1,"allqueaf"
.
          CALL      DGMESSID                     * get the unique message id
.
.         Write a record to pmsqptaf (holding patient details)
.
          MOVE      MESSAGID,PMQPMESI
          MOVE      SP8,PMQPOURN
          PACK      PMQPSPAR,SP70,SP70
          CALL      WRPMQPT1
.
.         Write a record to allqueaf (holding A/H details)
.
          MOVE      MESSAGID,ALQUMESI
          PACK      ALQUSPAR,SP70,SP70
          CALL      WRALQUE1
.
          MOVE      "A08",H7CIMETP
          MOVE      ALREVISN,H7CIVISN
          MOVE      HL7TRGID,H7CITRID
          MOVE      HL7INCLD,H7CIINCL
          CALL      WRCIS000
.
          CLOSE     HL7CISA1
          CLOSE     PMSQPTA1
          CLOSE     PMSQPXA1
          CLOSE     ALLQUEA1
.
DGCLI999  GOTO      DGCLIEND                        * end procedure
.
.      I/O's go in here
.
          INC       BRHLCOMN
          INC       CLPMSQPX
.
          INC       ALLQUEIO/INC
          INC       HL7CISIO/INC
          INC       IBAOVRIO/INC
          INC       PMSQPTIO/INC
.
DGCLIEND  ENDPROC

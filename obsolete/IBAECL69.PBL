.*******************************************************************************
.* System         : PowerBuilder / TBL NHI Interface                           *
.* Program        : IBAECL69.PBL                                               *
.* Name           : Run NHI01                                                  *
.*******************************************************************************
.* Date           : 21/01/1998                                                 *
.* Author         : Phantom and Deset Storm                                    *
.* Function       : To allow this program to be run from the command line and  *
.*                  for it to then run IBANHI01                                *
.* Modifications  :                                                            *
.*        V5.08.01  08/11/2000  Steve Armstrong                                *
.*                  Mods to remove temp file on completion                     *
.*******************************************************************************
.
.         FD includes needed
.
          INC       STD002FD/PBL
.
.         program variables
.
ACCESSTY  FORM      2                       * access type for NHI01
.                                              01 = update
.                                              02 = register
DUMMY     DIM       100
FILNHIAF  FILE      ASCII, FIXED=256       * tmp save file for forking
URNUMBER  DIM       8                       * UR number to change
.                                              (spaces for register)
.
PRGID     INIT      "IBAECL69"
PRGNAM    INIT      "Powerbuilder Link To TBL To Run IBANHI01"
VERSION   INIT      "V10.09.00"
.
.*********************************************************************
.*                  ML0000                                           *
.*        Mainline Code / Controlling Logic                          *
.*********************************************************************
ML0000    CALL      SETX0000                * set all common variables
.
.         display the program id so that the KEA script knows that we
.         are in the right program and so it will then send the 
.         Access Type and the UR Number
.
          DISPLAY   *P1:1,*EL,*P1:24,PRGID
.
.         get the Access Type - this will be sent by the KEA script
.
          KEYIN     *P1:23,*EOFF,ACCESSTY
.
.         get the U/R Number - this will be sent by the KEA script
.
          KEYIN     *P1:23,*EOFF,URNUMBER
.
.         set up passcode and PGM
.
          MOVE      "1426",PASSCODE
          MOVE      "IBAECL69",PGM
.
.         set up the parameters for NHI01 and FORK to it
.
          PACK      ERROR,ACCESSTY,URNUMBER
          FORK      "IBANHI01",TASKID
.
.         Make sure the temp file used by NHI01 is deleted
.
          MOVE      "PATNZI",KEY6
          PACK      KEY8,KEY6,PORT
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      FILNHIAF,KEY8
          TRAPCLR   IO
          BRANCH    OVRCD,ML9999
.
          CLOSE     FILNHIAF,DELETE
.
ML9999    SHUTDOWN  ""
.
.         I/O includes needed
.
          INC       STD002IO
.

.-----------------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.00.00"
.-------------------------------------------------------
. V9.02.01  09.07.2002  Glenn Saunders
.           Recompile for changes in includes shared with Southland, but with
.           previously different formats - now merged.  Includes effected :-
.           CCSCEAFD, CCSCONFD, CCSEPSFD, CCSHCDFD, CCSHLCFD, CCSIADFD
.-------------------------------------------------------
. V9.02.00  03.06.2002  Glenn Saunders
.           Export to new release i.e. v9.02 from vf.09
.-------------------------------------------------------
. VF.09.B01 23.11.2000 Sandra Barcham
.           Allow for changed ccsepsaf
.-------------------------------------------------------
. VF.01.02  20.10.2000 Sandra Barcham
.           Fix delete by date range
.-------------------------------------------------------
. V6.06.01  15.12.1999 Charles Handaya
.           Fixed DRG Codes
.-------------------------------------------------------
. V6.03.02  30.10.1995 B.G.Ackland
.           Phase 1 WGH Changes
. V6.03.01  02.10.1995 B.G.Ackland
.           Ignore Actual Cost Patient Services During Update
.           New Option to Delete Selected Patient Services
.           Recompiled for Change to CEASTR & CEAPSC
. V6.03.00  02.10.1995 B.G.Ackland
.           Release 6.03
.-------------------------------------------------------
. V6.01.05  02.08.1995 B.G.Ackland
.           Added DRG Cost Variation Calculation
. V6.01.04  23.06.1995 B.G.Ackland
.           Fix Update Patient Service Range
. V6.01.03  28.12.1994 B.G.Ackland
.           Change Episode Counter to a Form 8
. V6.01.02  07.06.1994 B.G.Ackland
.           Change isclear to iserase & rebuild
.-----------------------------------------------------------------
ACTPRIC   FORM      8.2
DOWNFILE  FILE      ASCII, FIXED=200
ENDDAT    DIM       8
ENDPSC    DIM       7
EPSCOUNT  FORM      8
FILENAME  DIM       8
SCRIPTFL  FILE      ASCII, FIXED=80
STRDAT    DIM       8
STRPSC    DIM       7
.-----------------------------------------------------------------
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBACEA12
.   Function      :   Patient Service Transaction Update      
.   Generated  On :   09/07/2002
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       CCSEPSFD/INC
          INC       CCSIADFD/INC
          INC       CEANDMFD/INC
          INC       CEAPSCFD/INC
          INC       CEASTRFD/INC
.=========================
.Local Variable Definition
.-------------------------
FROMDAT   DIM      10 * Scr 01 Fld     4
TODAT     DIM      10 * Scr 01 Fld     5
FROMPSC   DIM      45 * Scr 01 Fld     6
TOPSC     DIM      45 * Scr 01 Fld     7
DOWNNAME  DIM      30 * Scr 03 Fld     4
FLAGMAN   FORM      1 * Scr 03 Fld     5
FLAGIMP   FORM      1 * Scr 03 Fld     6
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBACEA12"
PRGNAM    INIT      "Patient Service Transaction Update      "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      SC00L000
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          MOVE      "   64",AUDTSECT
          MOVE      " 37",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening ccsaudep";
            OPEN      CCSAUDEP,"ccsaudep"
          ENDIF
          MOVE      "   64",AUDTSECT
          MOVE      " 38",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening ccsaudia";
            OPEN      CCSAUDIA,"ccsaudia"
          ENDIF
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA1,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA2,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA3,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA4,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA5,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccsiadaf";
          OPEN      CCSIADA1,"ccsiadaf"
          MOVE      "   64",AUDTSECT
          MOVE      " 39",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening ceaaudps";
            OPEN      CEAAUDPS,"ceaaudps"
          ENDIF
          MOVE      "   64",AUDTSECT
          MOVE      " 40",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening ceaaudst";
            OPEN      CEAAUDST,"ceaaudst"
          ENDIF
          DISPLAY   *P56:24,"Opening ceandmaf";
          OPEN      CEANDMA1,"ceandmaf"
          DISPLAY   *P56:24,"Opening ceapscaf";
          OPEN      CEAPSCA1,"ceapscaf"
          DISPLAY   *P56:24,"Opening ceastraf";
          OPEN      CEASTRA1,"ceastraf"
          DISPLAY   *P56:24,"Opening ceastraf";
          OPEN      CEASTRA2,"ceastraf"
          DISPLAY   *P56:24,"Opening ceastraf";
          OPEN      CEASTRA3,"ceastraf"
          DISPLAY   *P56:24,"Opening ceastraf";
          OPEN      CEASTRA4,"ceastraf"
          DISPLAY   *P56:24,"Opening ceastraf";
          OPEN      CEASTRA5,"ceastraf"
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "00",SCRID
          IF         @EQUAL
            CALL       PS00L000   * Options                            
          ENDIF
          MATCH     "01",SCRID
          IF         @EQUAL
            CALL       PS01L000   * Update Std Cost                    
          ENDIF
          MATCH     "02",SCRID
          IF         @EQUAL
            CALL       PS02L000   * Delete Select Patient Services     
          ENDIF
          MATCH     "03",SCRID
          IF         @EQUAL
            CALL       PS03L000   * Export Manual Data                 
          ENDIF
          RETURN
.--------------------------------
. Screen - Options                            
.--------------------------------
SC00L000
SC00L100
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC00L200
          CALL      CF00L000 * Clear Fields
SC00L300
          CALL      KY00L000 * Enter Key Fields
          BRANCH    EXIT,SC00L999,SC00L999
SC00L400
          CALL      WP00L000 * Load any WP Details
SC00L500
          CALL      LM00L000 * Load any Batch Details
SC00L600
          CALL      DF00L000 * Display Fields
SC00L700
          CALL      SF00L000 * Select Fields
          BRANCH    EXIT,SC00L100,SC00L100,SC00L200
SC00L800
SC00L900
SC00L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Options                            
.-------------------------------------------------------
CF00L000
CF00L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Options                            
.--------------------------------------------------------
KY00L000
          MOVE      ZERO,EXIT
          GOTO      KY00L999
.
KY00L900  MOVE      ONE,EXIT
KY00L999  RETURN
.---------------------------------------------------------
. Load WP files for : Options                            
.---------------------------------------------------------
WP00L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Options                            
.---------------------------------------------------------
LM00L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Options                            
.---------------------------------------------------------
DF00L000
          BRANCH   ACCEPT,DF00L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF00L900
          MATCH    PRGID,SCPSPID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF00L010 IF NOT EQUAL
.
          CALL     PS00L000 * Display Field
          GOTO     DF00L010
DF00L900
DF00L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Options                            
.---------------------------------------------------------
PS00L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS00L999,PS00L999,PS00L999,PS00L999:
                            PS00L999,PS00L999
          GOTO     PS00L999
PS00L999
          RETURN
.---------------------------------------------------------
. Selections for : Options                            
.---------------------------------------------------------
SF00L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF00L001  BRANCH   ACCEPT,SF00L020
.
SF00L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L006,SF00L101,SF00L102,SF00L103:
                            SF00L104,SF00L105
SF00L006  BEEP
          GOTO     SF00L005
SF00L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF00L090
          MATCH    PRGID,SCSLPID
          GOTO     SF00L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF00L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020
          GOTO     SF00L020
SF00L090  MOVE     ZERO,ACCEPT
          GOTO     SF00L001
.
SF00L101
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L102
          CALL      ALLDEL00
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L103
          CALL      SC01L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L104
          CALL      SC02L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L105
          CALL      SC03L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
SF00L990  MOVE      ONE,EXIT * Exit Char Restart
SF00L999  RETURN
.--------------------------------
. Screen - Update Std Cost                    
.--------------------------------
SC01L000
SC01L100
          MOVE      "01",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC01L200
          CALL      CF01L000 * Clear Fields
          CALL      MVACCEPT
SC01L300
          CALL      KY01L000 * Enter Key Fields
          BRANCH    EXIT,SC01L999,SC01L999
SC01L400
          CALL      WP01L000 * Load any WP Details
SC01L500
          CALL      LM01L000 * Load any Batch Details
SC01L600
          CALL      DF01L000 * Display Fields
SC01L700
          CALL      SF01L000 * Select Fields
          BRANCH    EXIT,SC01L100,SC01L100,SC01L200
SC01L800
SC01L900
SC01L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Update Std Cost                    
.-------------------------------------------------------
CF01L000
          MOVE      SP70,FROMDAT 
          MOVE      SP70,TODAT   
          MOVE      SP70,FROMPSC 
          MOVE      SP70,TOPSC   
CF01L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Update Std Cost                    
.--------------------------------------------------------
KY01L000
          MOVE      ZERO,EXIT
          GOTO      KY01L999
.
KY01L900  MOVE      ONE,EXIT
KY01L999  RETURN
.---------------------------------------------------------
. Load WP files for : Update Std Cost                    
.---------------------------------------------------------
WP01L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Update Std Cost                    
.---------------------------------------------------------
LM01L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Update Std Cost                    
.---------------------------------------------------------
DF01L000
          BRANCH   ACCEPT,DF01L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF01L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF01L900
          MATCH    PRGID,SCPSPID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF01L010 IF NOT EQUAL
.
          CALL     PS01L000 * Display Field
          GOTO     DF01L010
DF01L900
DF01L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Update Std Cost                    
.---------------------------------------------------------
PS01L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS01L999,PS01L999,PS01L999,PS01L101:
                            PS01L102,PS01L103,PS01L104
          GOTO     PS01L999
.
PS01L101
          MOVE      FROMDAT,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L102
          MOVE      TODAT,VAR        
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L103
          MOVE      FROMPSC,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L104
          MOVE      TOPSC,VAR        
          CALL      DISPITEM
          GOTO     PS01L999
PS01L999
          RETURN
.---------------------------------------------------------
. Selections for : Update Std Cost                    
.---------------------------------------------------------
SF01L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF01L001  BRANCH   ACCEPT,SF01L020
.
SF01L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L006,SF01L101,SF01L102,SF01L103:
                            SF01L006,SF01L104,SF01L006
SF01L006  BEEP
          GOTO     SF01L005
SF01L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF01L090
          MATCH    PRGID,SCSLPID
          GOTO     SF01L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF01L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L020,SF01L020,SF01L020,SF01L103:
                            SF01L020,SF01L104,SF01L020
          GOTO     SF01L020
SF01L090  MOVE     ZERO,ACCEPT
          GOTO     SF01L001
.
SF01L101
          MOVE      ZERO,EXIT
          GOTO      SF01L999
.
SF01L102
          CALL      UPDS0000
          MOVE      ZERO,EXIT
          GOTO      SF01L999
.
SF01L103
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TODAT   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      RDATE000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF01L103
            ENDIF
            BRANCH    EXIT,SF01L103,SF01L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF01L990 IF EQUAL
          ENDIF
          MOVE      FROMDAT,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TODAT,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF01L001
.
SF01L104
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOPSC   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      ERPSC000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF01L104
            ENDIF
            BRANCH    EXIT,SF01L104,SF01L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF01L990 IF EQUAL
          ENDIF
          MOVE      FROMPSC,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOPSC,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF01L001
SF01L990  MOVE      ONE,EXIT * Exit Char Restart
SF01L999  RETURN
.--------------------------------
. Screen - Delete Select Patient Services     
.--------------------------------
SC02L000
SC02L100
          MOVE      "02",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC02L200
          CALL      CF02L000 * Clear Fields
          CALL      MVACCEPT
SC02L300
          CALL      KY02L000 * Enter Key Fields
          BRANCH    EXIT,SC02L999,SC02L999
SC02L400
          CALL      WP02L000 * Load any WP Details
SC02L500
          CALL      LM02L000 * Load any Batch Details
SC02L600
          CALL      DF02L000 * Display Fields
SC02L700
          CALL      SF02L000 * Select Fields
          BRANCH    EXIT,SC02L100,SC02L100,SC02L200
SC02L800
SC02L900
SC02L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Delete Select Patient Services     
.-------------------------------------------------------
CF02L000
          MOVE      SP70,FROMDAT 
          MOVE      SP70,TODAT   
          MOVE      SP70,FROMPSC 
          MOVE      SP70,TOPSC   
CF02L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Delete Select Patient Services     
.--------------------------------------------------------
KY02L000
          MOVE      ZERO,EXIT
          GOTO      KY02L999
.
KY02L900  MOVE      ONE,EXIT
KY02L999  RETURN
.---------------------------------------------------------
. Load WP files for : Delete Select Patient Services     
.---------------------------------------------------------
WP02L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Delete Select Patient Services     
.---------------------------------------------------------
LM02L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Delete Select Patient Services     
.---------------------------------------------------------
DF02L000
          BRANCH   ACCEPT,DF02L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF02L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF02L900
          MATCH    PRGID,SCPSPID
          GOTO     DF02L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF02L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF02L010 IF NOT EQUAL
.
          CALL     PS02L000 * Display Field
          GOTO     DF02L010
DF02L900
DF02L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Delete Select Patient Services     
.---------------------------------------------------------
PS02L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS02L999,PS02L999,PS02L999,PS02L101:
                            PS02L102,PS02L103,PS02L104
          GOTO     PS02L999
.
PS02L101
          MOVE      FROMDAT,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L102
          MOVE      TODAT,VAR        
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L103
          MOVE      FROMPSC,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L104
          MOVE      TOPSC,VAR        
          CALL      DISPITEM
          GOTO     PS02L999
PS02L999
          RETURN
.---------------------------------------------------------
. Selections for : Delete Select Patient Services     
.---------------------------------------------------------
SF02L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF02L001  BRANCH   ACCEPT,SF02L020
.
SF02L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF02L006,SF02L101,SF02L102,SF02L103:
                            SF02L006,SF02L104,SF02L006
SF02L006  BEEP
          GOTO     SF02L005
SF02L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF02L090
          MATCH    PRGID,SCSLPID
          GOTO     SF02L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF02L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF02L020,SF02L020,SF02L020,SF02L103:
                            SF02L020,SF02L104,SF02L020
          GOTO     SF02L020
SF02L090  MOVE     ZERO,ACCEPT
          GOTO     SF02L001
.
SF02L101
          MOVE      ZERO,EXIT
          GOTO      SF02L999
.
SF02L102
          CALL      DEPS0000
          MOVE      ZERO,EXIT
          GOTO      SF02L999
.
SF02L103
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TODAT   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      RDATE000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L103
            ENDIF
            BRANCH    EXIT,SF02L103,SF02L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF02L990 IF EQUAL
          ENDIF
          MOVE      FROMDAT,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TODAT,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF02L001
.
SF02L104
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOPSC   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      ERPSC000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L104
            ENDIF
            BRANCH    EXIT,SF02L104,SF02L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF02L990 IF EQUAL
          ENDIF
          MOVE      FROMPSC,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOPSC,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF02L001
SF02L990  MOVE      ONE,EXIT * Exit Char Restart
SF02L999  RETURN
.--------------------------------
. Screen - Export Manual Data                 
.--------------------------------
SC03L000
SC03L100
          MOVE      "03",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC03L200
          CALL      CF03L000 * Clear Fields
          CALL      MVACCEPT
SC03L300
          CALL      KY03L000 * Enter Key Fields
          BRANCH    EXIT,SC03L999,SC03L999
SC03L400
          CALL      WP03L000 * Load any WP Details
SC03L500
          CALL      LM03L000 * Load any Batch Details
SC03L600
          CALL      DF03L000 * Display Fields
SC03L700
          CALL      SF03L000 * Select Fields
          BRANCH    EXIT,SC03L100,SC03L100,SC03L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC03L800
SC03L900
SC03L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Export Manual Data                 
.-------------------------------------------------------
CF03L000
          MOVE      SP70,DOWNNAME
          MOVE      ZERO,FLAGMAN 
          MOVE      ZERO,FLAGIMP 
CF03L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Export Manual Data                 
.--------------------------------------------------------
KY03L000
          MOVE      ZERO,EXIT
          GOTO      KY03L999
.
KY03L900  MOVE      ONE,EXIT
KY03L999  RETURN
.---------------------------------------------------------
. Load WP files for : Export Manual Data                 
.---------------------------------------------------------
WP03L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Export Manual Data                 
.---------------------------------------------------------
LM03L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Export Manual Data                 
.---------------------------------------------------------
DF03L000
          BRANCH   ACCEPT,DF03L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF03L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF03L900
          MATCH    PRGID,SCPSPID
          GOTO     DF03L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF03L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF03L010 IF NOT EQUAL
.
          CALL     PS03L000 * Display Field
          GOTO     DF03L010
DF03L900
DF03L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Export Manual Data                 
.---------------------------------------------------------
PS03L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS03L999,PS03L999,PS03L999,PS03L101:
                            PS03L102,PS03L103
          GOTO     PS03L999
.
PS03L101
          MOVE      DOWNNAME,VAR     
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L102
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      FLAGMAN,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L103
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      FLAGIMP,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS03L999
PS03L999
          RETURN
.---------------------------------------------------------
. Selections for : Export Manual Data                 
.---------------------------------------------------------
SF03L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF03L001  BRANCH   ACCEPT,SF03L020
.
SF03L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF03L006,SF03L101,SF03L102,SF03L103:
                            SF03L104,SF03L105
SF03L006  BEEP
          GOTO     SF03L005
SF03L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF03L090
          MATCH    PRGID,SCSLPID
          GOTO     SF03L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF03L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF03L020,SF03L020,SF03L020,SF03L103:
                            SF03L104,SF03L105
          GOTO     SF03L020
SF03L090  MOVE     ZERO,ACCEPT
          GOTO     SF03L001
.
SF03L101
          MOVE      ZERO,EXIT
          GOTO      SF03L999
.
SF03L102
          CALL      EXPT0000
          MOVE      ZERO,EXIT
          GOTO      SF03L999
.
SF03L103
          CALL     SELECTED
          STRIP     DOWNNAME
          SFORMAT   VAR,SCPSLEN
          MOVE      DOWNNAME,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,DOWNNAME
          SFORMAT   VAR,127
          ENDSET    DOWNNAME
          APPEND    SP70,DOWNNAME
          RESET     DOWNNAME
          CMATCH    EXITCHAR,DOWNNAME
          GOTO      SF03L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,DOWNNAME
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF03L103
            ENDIF
          ENDIF
          MOVE      DOWNNAME,VAR     
          CALL      DISPITEM
          GOTO     SF03L001
.
SF03L104
          CALL      DEFAULTY
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,FLAGMAN 
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      FLAGMAN,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF03L001
.
SF03L105
          CALL      DEFAULTY
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,FLAGIMP 
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      FLAGIMP,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF03L001
SF03L990  MOVE      FOUR,EXIT * Exit Char Exit
SF03L999  RETURN
.@@@@@ Function Restart Point @@@@@
.------------------------------------------------------------
. Delete All Service Transactions and Reset Episode Totals
.------------------------------------------------------------
ALLDEL00  MOVE     SP70,DISPMSG        * Clear Line 24 Display Message
          CALL     MESSAGE2            * Save and Clear Line 24
          BEEP
          MOVE     "Make Sure all Casemix Users are off the system. ",DISPMSG
          CALL     MESSAGE1
          BEEP
          BEEP
          MOVE     "This Option will Delete Every Thing. ",DISPMSG
          CALL     MESSAGE1
          BEEP
          BEEP
          MOVE     "You have only ONE Chance to Abort. ",DISPMSG
          CALL     MESSAGE1
          BEEP
          BEEP
          CALL     DELQST              * Delete (Y/N/C) CEXIT 1/2/3
          CALL     MESSAGE3            * Restore Line 24
          BRANCH   CEXIT,ALLDEL10,ALLDEL99,ALLDEL99
.
ALLDEL10  CLOSE    CEASTRA1
          CLOSE    CEASTRA2
          CLOSE    CEASTRA3
          CLOSE    CEASTRA4
          CLOSE    CEASTRA5
          DISPLAY  *P1:24,*EL,*P20:24,"Clearing Patient Transaction Records"
          DISPLAY  *P1:10;
.
          CLEAR    FILENAME
          APPEND   "script",FILENAME
          APPEND   PORT,FILENAME
          RESET    FILENAME
          PREP     SCRIPTFL,FILENAME
          CLEAR    KEY80
          APPEND   "dir=`ldat ceastraf.dat | sed 's/\/ceastraf.dat//g'`",KEY80
          RESET    KEY80
          WRITE    SCRIPTFL,SEQ;KEY80
          WRITE    SCRIPTFL,SEQ;"cd $dir"
          WRITE    SCRIPTFL,SEQ;"iserase ceastraf"
          WRITE    SCRIPTFL,SEQ;"isbuild ceastraf 162 UC1-5,6-9"
          WRITE    SCRIPTFL,SEQ;"isadd ceastraf UC86-93,94-123,1-5,6-9"
          WRITE    SCRIPTFL,SEQ;"isadd ceastraf UC10-11,12-27,1-5,6-9"
          WRITE    SCRIPTFL,SEQ;"isadd ceastraf UC48-50,28-35,1-5,6-9"
          WRITE    SCRIPTFL,SEQ;"isadd ceastraf UC41-47,28-35,1-5,6-9"
          CLOSE    SCRIPTFL
          CLEAR    KEY80
          APPEND   "/bin/sh ",KEY80
          APPEND   FILENAME,KEY80
          APPEND   ".txt",KEY80
          RESET    KEY80
.
          EXECUTE  KEY80,TASKID
          PREP     SCRIPTFL,FILENAME
          CLOSE    SCRIPTFL,DELETE
.
          MOVE     ZERO,EPSCOUNT
          PACK     KEY18,SP70
          CALL     RSCCIA1
ALLDEL20  CALL     RKCCIA1
          BRANCH   OVRCD,ALLDEL99
          CALL     CLREXP00
          CALL     UPCCIA1
          ADD      ONE,EPSCOUNT
          IF       EPSCOUNT%1000=0
            CLOCK    TIME,CTIMEIS
            DISPLAY  *P1:24,*EL,"Records Cleared : ",EPSCOUNT," Time : ",CTIMEIS
          ENDIF
          GOTO     ALLDEL20
.
ALLDEL99  RETURN
.--------------------------------------------
. Move Zero to Summary Totals
.--------------------------------------------
CLREXP00  MOVE      ZERO,CCIAETH1
          MOVE      ZERO,CCIAETH2
          MOVE      ZERO,CCIAETH3
          MOVE      ZERO,CCIAETH4
          MOVE      ZERO,CCIAETH5
.
          MOVE      ZERO,CCIAEA11
          MOVE      ZERO,CCIAEA12
          MOVE      ZERO,CCIAEA13
          MOVE      ZERO,CCIAEA14
          MOVE      ZERO,CCIAEA15
.
          MOVE      ZERO,CCIAEA21
          MOVE      ZERO,CCIAEA22
          MOVE      ZERO,CCIAEA23
          MOVE      ZERO,CCIAEA24
          MOVE      ZERO,CCIAEA25
.
          MOVE      ZERO,CCIAEA31
          MOVE      ZERO,CCIAEA32
          MOVE      ZERO,CCIAEA33
          MOVE      ZERO,CCIAEA34
          MOVE      ZERO,CCIAEA35
.
          MOVE      ZERO,CCIAEAO1
          MOVE      ZERO,CCIAEAO2
          MOVE      ZERO,CCIAEAO3
          MOVE      ZERO,CCIAEAO4
          MOVE      ZERO,CCIAEAO5
.
          MOVE      ZERO,CCIAEM11
          MOVE      ZERO,CCIAEM12
          MOVE      ZERO,CCIAEM13
          MOVE      ZERO,CCIAEM14
          MOVE      ZERO,CCIAEM15
.
          MOVE      ZERO,CCIAEM21
          MOVE      ZERO,CCIAEM22
          MOVE      ZERO,CCIAEM23
          MOVE      ZERO,CCIAEM24
          MOVE      ZERO,CCIAEM25
.
          MOVE      ZERO,CCIAEM31
          MOVE      ZERO,CCIAEM32
          MOVE      ZERO,CCIAEM33
          MOVE      ZERO,CCIAEM34
          MOVE      ZERO,CCIAEM35
.
          MOVE      ZERO,CCIAEMO1
          MOVE      ZERO,CCIAEMO2
          MOVE      ZERO,CCIAEMO3
          MOVE      ZERO,CCIAEMO4
          MOVE      ZERO,CCIAEMO5
.
          RETURN
.----------------------------------------
. Move one to accept to for insert mode
.----------------------------------------
MVACCEPT  MOVE      ONE,ACCEPT
          RETURN
.------------------------------------------------------------
. Update Standard Cost
.------------------------------------------------------------
UPDS0000  PACK       KEY7,STRPSC,SP70
          CALL       RDCEPS1
          IF         OVRCD=0
            CALL       RPCEPS1
          ENDIF
.
UPDS1000  CALL       RKCEPS1
          BRANCH     OVRCD,UPDS9000
          MATCH      CEPSPSC,ENDPSC
          GOTO       UPDS9000 IF LESS
          MATCH      "1",CEPSACT        * Ignore Actual Cost Patient Services
          GOTO       UPDS1000 IF EQUAL
.
          DISPLAY    *P1:24,*EL,"Update in Progress : ",*V2LON,CEPSPSC
.
          PACK       KEY24,CEPSPSC,STRDAT,SP70
          CALL       RSCEST5
UPDS2000  CALL       RKCEST5
          BRANCH     OVRCD,UPDS1000
          MATCH      CEPSPSC,CESTPSC
          GOTO       UPDS1000 IF NOT EQUAL
          MATCH      CESTDAT,ENDPSC
          GOTO       UPDS1000 IF LESS
.
UPDS2100  PACK      KEY18,CESTHCD,CESTEPS,SP70
          CALL      RLCCIA1                * Read & Lock Patient Expense Summary
          BRANCH    OVRCD,UPDS2200,UPDS2300
.
          MULT      SEQ,CESTQTY
          CALL      ADEPS000      * Subtract Old Standard Cost
          MULT      SEQ,CESTQTY
.
          MOVE      CEPSST1,CESTST1
          MOVE      CEPSST2,CESTST2
          MOVE      CEPSST3,CESTST3
          MOVE      CEPSST4,CESTST4
          MOVE      CEPSST5,CESTST5
          MATCH     "1",CEPSDRG   * Check for DRG Variation in Costs
          CALL      VARDRG00 IF EQUAL
.
          CALL      ADEPS000      * Add New Standard Cost
.
          CALL      UPCEST5
.
          CALL      UPCCIA1
          CALL      UUCCIA1
          GOTO      UPDS2000
.
. Missing Episode
.--------------------------------------------
UPDS2200  MOVE      CESTEPS,KEY16
          SQUEEZE   KEY16
          CLEAR     DISPMSG
          APPEND    "Epsiode ",DISPMSG
          APPEND    KEY16,DISPMSG
          APPEND    " Expense Details Missing - ",DISPMSG
          RESET     DISPMSG
          BEEP
          CALL      MESSAGE1
          GOTO      UPDS2000
.
. Locked Record
.--------------------------------------------
UPDS2300  MOVE      CESTEPS,KEY16
          SQUEEZE   KEY16
          CLEAR     DISPMSG
          APPEND    "Epsiode ",DISPMSG
          APPEND    KEY16,DISPMSG
          APPEND    " Expense Details Locked - ",DISPMSG
          RESET     DISPMSG
          BEEP
          CALL      MESSAGE1
          GOTO      UPDS2100
.
UPDS9000  BEEP
          MOVE      "Update Complete - ",DISPMSG
          CALL      MESSAGE1
.
UPDS9999  RETURN
.
.--------------------------------------------
. Add Transaction to Expense Summary Details
.--------------------------------------------
ADEPS000  MOVE     CEPSTYP,F1
          BRANCH   F1,ADEPS100,ADEPS200,ADEPS300,ADEPS400,ADEPS500:
                      ADEPS600,ADEPS700,ADEPS800,ADEPS900
.
ADEPS100  ASSIGN    CCIAETH1+(CESTQTY*CESTST1),CCIAETH1
          ASSIGN    CCIAETH2+(CESTQTY*CESTST2),CCIAETH2
          ASSIGN    CCIAETH3+(CESTQTY*CESTST3),CCIAETH3
          ASSIGN    CCIAETH4+(CESTQTY*CESTST4),CCIAETH4
          ASSIGN    CCIAETH5+(CESTQTY*CESTST5),CCIAETH5
          GOTO      ADEPS999
.
ADEPS200  ASSIGN    CCIAEA11+(CESTQTY*CESTST1),CCIAEA11
          ASSIGN    CCIAEA12+(CESTQTY*CESTST2),CCIAEA12
          ASSIGN    CCIAEA13+(CESTQTY*CESTST3),CCIAEA13
          ASSIGN    CCIAEA14+(CESTQTY*CESTST4),CCIAEA14
          ASSIGN    CCIAEA15+(CESTQTY*CESTST5),CCIAEA15
          GOTO      ADEPS999
.
ADEPS300  ASSIGN    CCIAEA21+(CESTQTY*CESTST1),CCIAEA21
          ASSIGN    CCIAEA22+(CESTQTY*CESTST2),CCIAEA22
          ASSIGN    CCIAEA23+(CESTQTY*CESTST3),CCIAEA23
          ASSIGN    CCIAEA24+(CESTQTY*CESTST4),CCIAEA24
          ASSIGN    CCIAEA25+(CESTQTY*CESTST5),CCIAEA25
          GOTO      ADEPS999
.
ADEPS400  ASSIGN    CCIAEA31+(CESTQTY*CESTST1),CCIAEA31
          ASSIGN    CCIAEA32+(CESTQTY*CESTST2),CCIAEA32
          ASSIGN    CCIAEA33+(CESTQTY*CESTST3),CCIAEA33
          ASSIGN    CCIAEA34+(CESTQTY*CESTST4),CCIAEA34
          ASSIGN    CCIAEA35+(CESTQTY*CESTST5),CCIAEA35
          GOTO      ADEPS999
.
ADEPS500  ASSIGN    CCIAEAO1+(CESTQTY*CESTST1),CCIAEAO1
          ASSIGN    CCIAEAO2+(CESTQTY*CESTST2),CCIAEAO2
          ASSIGN    CCIAEAO3+(CESTQTY*CESTST3),CCIAEAO3
          ASSIGN    CCIAEAO4+(CESTQTY*CESTST4),CCIAEAO4
          ASSIGN    CCIAEAO5+(CESTQTY*CESTST5),CCIAEAO5
          GOTO      ADEPS999
.
ADEPS600  ASSIGN    CCIAEM11+(CESTQTY*CESTST1),CCIAEM11
          ASSIGN    CCIAEM12+(CESTQTY*CESTST2),CCIAEM12
          ASSIGN    CCIAEM13+(CESTQTY*CESTST3),CCIAEM13
          ASSIGN    CCIAEM14+(CESTQTY*CESTST4),CCIAEM14
          ASSIGN    CCIAEM15+(CESTQTY*CESTST5),CCIAEM15
          GOTO      ADEPS999
.
ADEPS700  ASSIGN    CCIAEM21+(CESTQTY*CESTST1),CCIAEM21
          ASSIGN    CCIAEM22+(CESTQTY*CESTST2),CCIAEM22
          ASSIGN    CCIAEM23+(CESTQTY*CESTST3),CCIAEM23
          ASSIGN    CCIAEM24+(CESTQTY*CESTST4),CCIAEM24
          ASSIGN    CCIAEM25+(CESTQTY*CESTST5),CCIAEM25
          GOTO      ADEPS999
.
ADEPS800  ASSIGN    CCIAEM31+(CESTQTY*CESTST1),CCIAEM31
          ASSIGN    CCIAEM32+(CESTQTY*CESTST2),CCIAEM32
          ASSIGN    CCIAEM33+(CESTQTY*CESTST3),CCIAEM33
          ASSIGN    CCIAEM34+(CESTQTY*CESTST4),CCIAEM34
          ASSIGN    CCIAEM35+(CESTQTY*CESTST5),CCIAEM35
          GOTO      ADEPS999
.
ADEPS900  ASSIGN    CCIAEMO1+(CESTQTY*CESTST1),CCIAEMO1
          ASSIGN    CCIAEMO2+(CESTQTY*CESTST2),CCIAEMO2
          ASSIGN    CCIAEMO3+(CESTQTY*CESTST3),CCIAEMO3
          ASSIGN    CCIAEMO4+(CESTQTY*CESTST4),CCIAEMO4
          ASSIGN    CCIAEMO5+(CESTQTY*CESTST5),CCIAEMO5
          GOTO      ADEPS999
.
ADEPS999  RETURN
.------------------------------------------------------------
. Add DRG Variation to Cost
.------------------------------------------------------------
VARDRG00  PACK      KEY18,CESTHCD,CESTEPS,SP70
          CALL      RDCCEP1                * Read EPS for DRG
          BRANCH    OVRCD,VARDRG99
          PACK      KEY4,CCEPDRGC
          CALL      RDCEND1
          BRANCH    OVRCD,VARDRG99
          ASSIGN    CESTST1*CENDFC1,CESTST1
          ASSIGN    CESTST2*CENDFC2,CESTST2
          ASSIGN    CESTST3*CENDFC3,CESTST3
          ASSIGN    CESTST4*CENDFC4,CESTST4
          ASSIGN    CESTST5*CENDFC5,CESTST5
.
VARDRG99  RETURN
.
.------------------------------------------------------------
. Enter Date Range
.------------------------------------------------------------
RDATE000   MOVE     "    4",FLDID
           CALL     GETPOSIT
           MOVE     SP70,CDAY
           MOVE     CMM,CMON
           MOVE     CYY,CYEAR
           MOVE     CCC,CCENT
           CALL     KEYDATE
           BRANCH   OVRCD,RDATE100
           MATCH    SP2,CDAY
           GOTO     RDATE100 IF EQUAL
           PACK     STRDAT,CCENT,CYEAR,CMON,CDAY
           REP      " 0",STRDAT
           CALL     PACDATE
           MOVE     CPCDATE,FROMDAT
           GOTO     RDATE140
RDATE100   MOVE     "Start             ",FROMDAT
           MOVE     SP70,STRDAT
.
RDATE140   MOVE     FROMDAT,VAR
           CALL     DISPITEM
.
RDATE150   MOVE     "    5",FLDID
           CALL     GETPOSIT
           MOVE     SP70,CDAY
           MOVE     CMM,CMON
           MOVE     CYY,CYEAR
           MOVE     CCC,CCENT
           CALL     KEYDATE
           BRANCH   OVRCD,RDATE200
           MATCH    SP2,CDAY
           GOTO     RDATE200 IF EQUAL
           PACK     ENDDAT,CCENT,CYEAR,CMON,CDAY
           REP      " 0",ENDDAT
           CALL     PACDATE
           MOVE     CPCDATE,TODAT
           MATCH    STRDAT,ENDDAT
           GOTO     RDATE999 IF EQUAL
           GOTO     RDATE999 IF NOT LESS
           BEEP
           MOVE     "To Date Must Be > From Date - ",DISPMSG
           CALL     MESSAGE1
           GOTO     RDATE000
.
RDATE200   MOVE     "Finish             ",TODAT
           MOVE     "99999999",ENDDAT
.
RDATE999   MOVE     "    4",FLDID
           CALL     GETPOSIT
           RETURN
.------------------------------------------------------------
. Enter Patient Service Range
.------------------------------------------------------------
ERPSC000   MOVE     "    6",FLDID
           CALL     GETPOSIT
           CALL     KCEPSA00
           BRANCH   EXIT,ERPSC100,ERPSC999
           MOVE     CEPSPSC,STRPSC
           PACK     FROMPSC,CEPSPSC,SP1,CEPSDES
           GOTO     ERPSC140
.
ERPSC100   MOVE     "Start             ",FROMPSC
           MOVE     SP70,STRPSC
.
ERPSC140   MOVE     FROMPSC,VAR
           CALL     DISPITEM
.
ERPSC150   MOVE     "    7",FLDID
           CALL     GETPOSIT
           CALL     KCEPSA00
           BRANCH   EXIT,ERPSC200,ERPSC999
           MOVE     CEPSPSC,ENDPSC
           PACK     TOPSC,CEPSPSC,SP1,CEPSDES
           MATCH    STRPSC,ENDPSC
           GOTO     ERPSC999 IF EQUAL
           GOTO     ERPSC999 IF NOT LESS
           BEEP
           MOVE     "To Pat. Serv. Type Be > From Pat. Serv. - ",DISPMSG
           CALL     MESSAGE1
           GOTO     ERPSC000
.
ERPSC200   MOVE     "Finish             ",TOPSC
           MOVE     "~~~~~~~~",ENDPSC
.
ERPSC999   MOVE     "    6",FLDID
           CALL     GETPOSIT
           RETURN
.------------------------------------------------------------
. Delete Selected Patient Service Transactions
.------------------------------------------------------------
DEPS0000  MOVE     SP70,DISPMSG        * Clear Line 24 Display Message
          CALL     MESSAGE2            * Save and Clear Line 24
          BEEP
          MOVE       "You have only ONE Chance to Abort. ",DISPMSG
          CALL       MESSAGE1
          BEEP
          CALL       DELQST              * Delete (Y/N/C) CEXIT 1/2/3
          CALL       MESSAGE3            * Restore Line 24
          BRANCH     CEXIT,DEPS0100,DEPS9999,DEPS9999
.
DEPS0100  PACK       KEY7,STRPSC,SP70
          CALL       RDCEPS1
          IF         OVRCD=0
            CALL       RPCEPS1
          ENDIF
.
DEPS1000  CALL       RKCEPS1
          BRANCH     OVRCD,DEPS9000
          MATCH      CEPSPSC,ENDPSC
          GOTO       DEPS9000 IF LESS
          DISPLAY    *P1:24,*EL,"Deletion in Progress : ",*V2LON,CEPSPSC
.
          PACK       KEY24,CEPSPSC,STRDAT,SP70
          CALL       RSCEST5
DEPS2000  CALL       RKCEST5
          BRANCH     OVRCD,DEPS1000
          MATCH      CEPSPSC,CESTPSC
          GOTO       DEPS1000 IF NOT EQUAL
          MATCH      CESTDAT,ENDDAT
          GOTO       DEPS1000 IF LESS
.
DEPS2100  PACK      KEY18,CESTHCD,CESTEPS,SP70
          CALL      RLCCIA1                * Read & Lock Patient Expense Summary
          BRANCH    OVRCD,DEPS2200,DEPS2300
          MULT      SEQ,CESTQTY
          CALL      ADEPS000      * Subtract Old Standard Cost
          CALL      UPCCIA1
          CALL      UUCCIA1
.
          PACK      KEY24,CESTPSC,CESTDAT,CESTBAT,CESTLIN,SP70
          CALL      DECEST5
          CALL      RSCEST5
          GOTO      DEPS2000
.
. Missing Episode
.--------------------------------------------
DEPS2200  MOVE      CESTEPS,KEY16
          SQUEEZE   KEY16
          CLEAR     DISPMSG
          APPEND    "Epsiode ",DISPMSG
          APPEND    KEY16,DISPMSG
          APPEND    " Expense Details Missing - ",DISPMSG
          RESET     DISPMSG
          BEEP
          CALL      MESSAGE1
          GOTO      DEPS2000
.
. Locked Record
.--------------------------------------------
DEPS2300  MOVE      CESTEPS,KEY16
          SQUEEZE   KEY16
          CLEAR     DISPMSG
          APPEND    "Epsiode ",DISPMSG
          APPEND    KEY16,DISPMSG
          APPEND    " Expense Details Locked - ",DISPMSG
          RESET     DISPMSG
          BEEP
          CALL      MESSAGE1
          GOTO      DEPS2100
.
DEPS9000  BEEP
          MOVE      "Deletion Complete - ",DISPMSG
          CALL      MESSAGE1
.
DEPS9999  RETURN
.
DEFAULTY    MOVE     ANSY,DEFYESNO
            RETURN
.------------------------------------------------------------
. This Process will Save Data Created by IBACEA10 & IBACEA11
. into a File that may be imported back after a delete all
. option.
.------------------------------------------------------------
EXPT0000  CALL       OPEN0000
          BRANCH     EXIT,EXPT9999
.
. Unload Data Input via Manual Data Entry Program IBACEA10
.-----------------------------------------------------------
          COMPARE    ZERO,FLAGMAN
          GOTO       EXPT1900 IF EQUAL
          MOVE       "IBACEA10",KEY8
          PACK       KEY47,KEY8,SP70
          CALL       RSCEST2
EXPT1000  CALL       RKCEST2
          BRANCH     OVRCD,EXPT1900
          MATCH      "IBACEA10",CESTFIL
          GOTO       EXPT1900 IF NOT EQUAL
          CALL       WRTEMP00
          GOTO       EXPT1000
.
. Unload Data Input via Patient Service Import Program IBACEA11
.--------------------------------------------------------------
EXPT1900  COMPARE    ZERO,FLAGIMP
          GOTO       EXPT1900 IF EQUAL
          MOVE       "IBACEA11",KEY8
          PACK       KEY47,KEY8,SP70
          CALL       RSCEST2
EXPT2000  CALL       RKCEST2
          BRANCH     OVRCD,EXPT2900
          MATCH      "IBACEA11",CESTFIL
          GOTO       EXPT2900 IF NOT EQUAL
          CALL       WRTEMP00
          GOTO       EXPT2000
.
EXPT2900
EXPT9999  RETURN
.------------------------------------------------------------
. Write to Export File
.------------------------------------------------------------
WRTEMP00  MOVE      CESTPSC,KEY7
          CALL      RDCEPS1
          MATCH     "1",CEPSACT
          IF        @EQUAL
            ASSIGN    CESTST1+CESTST2+CESTST3+CESTST4+CESTST5,ACTPRIC
          ELSE
            MOVE      ZERO,ACTPRIC
          ENDIF
          WRITE     DOWNFILE,SEQ;CESTHCD,CESTEPS,CESTDAT:
                    CESTTIM,CESTPSC,CESTSPC,CESTQTY,ACTPRIC,CESTKEY,CESTUD1:
                    CESTUD2,CESTUY1,CESTUY2,CESTITM,CESTDCD
          RETURN
.------------------------------------------------------------
. Open/Create Downlaod File
.------------------------------------------------------------
OPEN0000  STRIP     DOWNNAME
          ENDSET    DOWNNAME
          APPEND    SP70,DOWNNAME
          RESET     DOWNNAME
.
          MATCH     SP70,DOWNNAME
          GOTO      OPEN9000 IF EQUAL
.
          STRIP     DOWNNAME
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      DOWNFILE,DOWNNAME
          TRAPCLR   IO
          BRANCH    OVRCD,OPEN1000
.
OPEN0100  BEEP
          KEYIN     *P1:24,*EL,"Export File Already Exists. Overwrite (":
                    *V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,ANS
          REP       UPPLOW,ANS
          MOVE      ONE,EXIT
          MATCH     "N",ANS
          GOTO      OPEN9999 IF EQUAL
          MATCH     "Y",ANS
          GOTO      OPEN0100 IF NOT EQUAL
          CLOSE     DOWNFILE,DELETE
.
OPEN1000  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          PREP      DOWNFILE,DOWNNAME
          TRAPCLR   IO
          BRANCH    OVRCD,OPEN9100
          MOVE      ZERO,EXIT
          GOTO      OPEN9999
.
OPEN9000  BEEP
          MOVE      "Export Filename MUST be Specified - ",DISPMSG
          CALL      MESSAGE1
          MOVE      ONE,EXIT
          GOTO      OPEN9999
.
OPEN9100  BEEP
          MOVE      "Unable to Create Export File - ",DISPMSG
          CALL      MESSAGE1
          MOVE      ONE,EXIT
          GOTO      OPEN9999
.
OPEN9999  RETURN
.
.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       CCSEPSIO/INC
          INC       CCSIADIO/INC
          INC       CEANDMIO/INC
          INC       CEAPSCIO/INC
          INC       CEAPSCKY    
          INC       CEASTRIO/INC
.
          INC       STDGENCD
.

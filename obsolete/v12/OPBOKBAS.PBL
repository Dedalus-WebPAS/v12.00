.******************************************************************************
.* System         : Theatre System                                            *
.* Include Name   : OPBOKBAS.PBL                                              *
.* Description    : Input Booking/PMI details (Basic)                         *
.******************************************************************************
.* Date           : 02/11/1990                                                *
.* Author         : Paul Marshall                                             *
.******************************************************************************
.* Parameters     : Screen details for the Basic screen                       *
.*                  U/R number (may be zero)                                  *
.*                  Booking number                                            *
.*                  TYPEFLAG the type of booking (=1 has no UR number)        *
.******************************************************************************
.* Returns        : Original surname file record (if it exists)               *
.*                  Original address/telephone data                           *
.*                  PMI details                                               *
.*                  Booking details                                           *
.*                  EXIT = 0   Booking ready to be posted                     *
.*                         1   No posting to be done                          *
.******************************************************************************
.* Function       : If the UR number is zero, then this is a new patient. The *
.*                  program will display a screen of PMI and Booking details. *
.*                  The user will be asked to input all the details.  For an  *
.*                  existing patient, the PMI details will default to the     *
.*                  current values. This routine will NOT post the booking to *
.*                  the files. PMI details will be posted if this is a new    *
.*                  patient.                                                  *
.*                                                                            *
.******************************************************************************
.* Screen         : will need to be redisplayed after booking is posted       *
.******************************************************************************
.* Modifications  :                                                           *
.*        V5.08.B01 29/02/2000  Greg Horvat      SRF 636572                   *
.*                  Changed to default the provisional items before going     *
.*                  into change booking details                               *
.*        V5.07.01  21/06/1999  Andrew Peel  SRF 631685                       *
.*                  Added function to use search parameters as default        *
.*                  values for registering a new booking with a 0 U/R         *
.*        V5.05.02  11/12/1997  Nick SRF 622924                               *
.*                  Added ReKeyin routine for BKREBKDT                        *
.*        V5.05.01  19/09/1997  Steve Armstrong                               *
.*                  Added BKREBKDT - Booking Date                             *
.******************************************************************************
.*                  10/07/1991    Justin Coates  (Vic Health Dept Changes)    *
.*                  Added Keyin of BKRECLSS, BKREATYP, BKREDEPT, BKRETDOC     *
.*                  08/10/1991    Justin Coates  (User Group Changes)         *
.*                  Added abortion of keyins, keyin of BKRECLMT, BKREEBED     *
.*                  BKDICODE, BKDIDES1, BKDIDES2, BKDICOMM                    *
.*                  30/11/1993    Paul Howells         NZHIS                  *
.*                  Don't keyin PMI if selected off Nat database              *
.*                  05/01/1994  Glenn Berry      SRF 440454                   *
.*                  Fixed keyin of address line 4                             *
.*                  07/03/1994    Justin Coates  SRF 440719                   *
.*                  added keyin of BKREDOFR                                   *
.*                  09/10/1995    Paul Howells   suht                         *
.*                  added keyin of PTMXOSDT                                   *
.*                  06/11/1995  Steve Armstrong   SRF 612422                  *
.*                  Mods to revalidate ward/bed if expected date is changed   *
.******************************************************************************
OPBOKBAS  MOVE      SIX,VARNUM              * value for booking screen
          MOVE      ZERO,YESDFLTS
.
          MATCH     ZEROUR,PURNO
          GOTO      OBOKB100 IF EQUAL       * has a zero UR 
.
          COMPARE   ZERO,BKREBOOK
          GOTO      OBOKB050 IF NOT EQUAL   * We have an existing adm no.
.
.         have a patient with PMI details
.
OBOKB050  MOVE      OPDAPROV,PROVITM1
          MOVE      OPDAPRV2,PROVITM2
          MOVE      OPDAPRV3,PROVITM3
.
          CALL      SVDET000                * Move all PMI det. to temp. vars.
          CALL      DVAR0000                * Display variables and screen
          MOVE      ZERO,IMIN               * dont enter PMI details initially
          CALL      ACDET000                * enter booking details (Not PMI)
          BRANCH    EXIT,OBOKB995           * cancel selected
          GOTO      OBOKB300                * change mode
.
.         patient has no UR number
.
OBOKB100  
.
. check if we have selected off national database
.
          IF        (PTCNNHII=1) & (NZIBVNEW=1)
            DISPLAY   *P1:8,*EF;
            CALL      SCREEN00                * Display screen
            CALL      SVDET000
            MOVE      ONE,YESDFLTS
          ELSE
            CALL      DVAR0000                * display screen
          ENDIF
.                                      * Default search details for 0 U/R
          IF        PTCNDEFT<>0
            PACK      PSNAME,SRCHSUR,SP20,SP20
            PACK      PGNAME,SRCHGIV,SP20,SP20
            MOVE      SRCHSEX,PSEX
            MOVE      SRCHAGE,PSAGE
            MOVE      SRCHDOB,PBDATE
            MOVE      ONE,YESDFLTS
          ENDIF
.
.         insert all details (including PMI)
.
          MOVE      ONE,IMIN                * insert all values
          CALL      ACDET000                * Accept initial values
          BRANCH    EXIT,OBOKB995           * avort keyin
.
.         modify details
.
OBOKB300  CALL      SLDET000                * Modify details, Post or Cancel
          BRANCH    EXIT,OBOKB995           * cancel selected
.
          MOVE      PROVITM1,OPDAPROV
          MOVE      PROVITM2,OPDAPRV2
          MOVE      PROVITM3,OPDAPRV3
.
          MOVE      ZERO,EXIT               * valid input
          GOTO      OBOKB999
.
OBOKB995  MOVE      ONE,EXIT
.
OBOKB999  RETURN
+
.*********************************************************************
.*                  ACDET000                                         *
.*        Accepts Initial Values                                     *
.*        Para's  : IMIN = 1      enter all details (inc. PMI)       * 
.*        Returns : EXIT = 1      keyin aborted                      *
.*********************************************************************
ACDET000  MOVE      ZERO,FIELDNO            * no pmi details to enter
          BRANCH    IMIN,ACDET002           * patient has zero UR, get all dets
.
.         have a patient with a UR number and thus PMI details
.
          MOVE      PTMXDOFR,BKREDOFR       * set the default D.O.R.
.
ACDET001  ADD       ONE,FIELDNO             * get next item
.
.         only insert non PMI details originally
.
          CALL      LOADSCN                 * get the 'opscvarn' value
          BRANCH    OPSCVARN,ACDET001,ACDET001,ACDET001,ACDET001,ACDET001:
                             ACDET001,ACDET001,ACDET001,ACDET001,ACDET001:    10
                             ACDET001,ACDET001,ACDET001,ACDET001,ACDET001:
                             ACDET001,ACDET001,ACDET001,ACDET001,ACDET001:    20
                             ACDET001,ACDET001,ACDET001,ACDET001,ACDET001:
                             ACDET001,ACDET001,ACDET001,ACDET001,ACDET001:    30
                             ACDET001,ACDET001,ACDET001,ACDET001,ACDET001:
                             ACDET001,ACDET001,ACDET001,ACDET001,ACDET001:    40
                             ACDET003,ACDET003,ACDET003,ACDET003,ACDET003:
                             ACDET003,ACDET003,ACDET003,ACDET003,ACDET003:    50
                             ACDET003,ACDET003,ACDET003,ACDET003,ACDET003:
                             ACDET003,ACDET003,ACDET003,ACDET003,ACDET003:    60
                             ACDET003,ACDET003,ACDET003,ACDET003,ACDET003:
                             ACDET003,ACDET003,ACDET003,ACDET003,ACDET003:    70
                             ACDET003,ACDET003,ACDET003,ACDET003,ACDET003:
                             ACDET003,ACDET003,ACDET003,ACDET003,ACDET003:    80
                             ACDET003,ACDET003,ACDET003,ACDET003,ACDET001:
                             ACDET003,ACDET003,ACDET003,ACDET001,ACDET003:    90
                             ACDET003
.
.         comes back to here after inserting an item
.
ACDET002  ADD       ONE,FIELDNO             * get next item
          SFORMAT   KEYFIELD,127
.
.         start to insert at this point
.
ACDET003  MOVE      FIELDNO,DPOINT          * point to redisplay to
          CALL      LOADSCN 
          BRANCH    OPSCVARN,ACDET005,ACDET010,ACDET020,ACDET030,ACDET040:
                             ACDET050,ACDET060,ACDET070,ACDET080,ACDET090:   10
                             ACDET100,ACDET110,ACDET120,ACDET130,ACDET140:
                             ACDET150,ACDET160,ACDET170,ACDET180,ACDET190:   20
                             ACDET200,ACDET210,ACDET220,ACDET230,ACDET240:
                             ACDET250,ACDET260,ACDET270,ACDET280,ACDET290:   30
                             ACDET300,ACDET310,ACDET320,ACDET330,ACDET340:
                             ACDET350,ACDET360,ACDET380,ACDET390,ACDET400:   40
                             ACDET410,ACDET420,ACDET430,ACDET440,ACDET450:
                             ACDET460,ACDET470,ACDET480,ACDET490,ACDET495:   50
                             ACDET500,ACDET510,ACDET520,ACDET530,ACDET540:
                             ACDET545,ACDET550,ACDET560,ACDET570,ACDET002:   60
                             ACDET580,ACDET590,ACDET600,ACDET610,ACDET620:
                             ACDET630,ACDET640,ACDET002,ACDET002,ACDET700:   70
                             ACDET710,ACDET720,ACDET730,ACDET740,ACDET750:
                             ACDET760,ACDET770,ACDET780,ACDET790,ACDET800:   80
                             ACDET810,ACDET820,ACDET830,ACDET840,ACDET850:
                             ACDET860,ACDET870,ACDET880,ACDET890,ACDET999:   90
                             ACDET910,ACDET920
.
          MOVE      ZERO,EXIT          * valid input
          GOTO      ACDET999           * finished insert
.
ACDET005  CALL      PTITLE00           * Call external routine to keyin
          BRANCH    EXIT,ACDET999      * abort keyin
          GOTO      ACDET002
.
ACDET010  CALL      SURNAM00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET020  CALL      GIVNAM00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET030  CALL      PRVNAM00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET040  CALL      FADDRS00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET050  CALL      SADDRS00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET060  CALL      SUBURB00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET070  CALL      POSTCD00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET080  CALL      PRTELE00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET090  CALL      BSTELE00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET100  CALL      GENDER00           * Call external routine to keyin
          BRANCH    EXIT,ACDET999      * abort keyin
          GOTO      ACDET002
.
ACDET110  CALL      MARSTA00           * Call external routine to keyin
          BRANCH    EXIT,ACDET999      * abort keyin
          GOTO      ACDET002
.
ACDET120  CALL      DATBIR00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET130  CALL      COUNTR00           * Call external routine to keyin
          BRANCH    EXIT,ACDET999      * abort keyin
          GOTO      ACDET002
.
ACDET140  CALL      RELIGN00           * Call external routine to keyin
          BRANCH    EXIT,ACDET999      * abort keyin
          GOTO      ACDET002
.
ACDET150  CALL      RESTAT00           * Call external routine to keyin
          BRANCH    EXIT,ACDET999      * abort keyin
          GOTO      ACDET002
.
ACDET160  CALL      OCCUPN00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET170  CALL      MEDCAR00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET180  CALL      PENSNO00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET190  CALL      PENEXP00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET200  CALL      REPATN00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET210  CALL      LOCDOC00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET220  CALL      HLFUND00           * Call external routine to keyin
          BRANCH    EXIT,ACDET999      * abort keyin
          GOTO      ACDET002
.
ACDET230  CALL      FUNDTL00           * Call external routine to keyin
          BRANCH    EXIT,ACDET999      * abort keyin
          GOTO      ACDET002
.
ACDET240  CALL      FUNDNO00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET250  CALL      FIUSER00           * Call external routine to keyin
          BRANCH    EXIT,ACDET999      * abort keyin
          GOTO      ACDET002
.
ACDET260  CALL      SEUSER00           * Call external routine to keyin
          BRANCH    EXIT,ACDET999      * abort keyin
          GOTO      ACDET002
.
ACDET270  CALL      THUSER00           * Call external routine to keyin
          BRANCH    EXIT,ACDET999      * abort keyin
          GOTO      ACDET002
.
ACDET280  CALL      FOUSER00           * Call external routine to keyin
          BRANCH    EXIT,ACDET999      * abort keyin
          GOTO      ACDET002
.
ACDET290  CALL      FFUSER00           * Call external routine to keyin
          BRANCH    EXIT,ACDET999      * abort keyin
          GOTO      ACDET002
.
ACDET300  CALL      SIUSER00           * Call external routine to keyin
          BRANCH    EXIT,ACDET999      * abort keyin
          GOTO      ACDET002
.
ACDET310  CALL      YEARES00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET320  CALL      NOKNAM00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET330  CALL      NOKOAD00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET340  CALL      NOKTAD00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET350  CALL      NOKSUB00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET360  CALL      NOKPOS00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET380  CALL      NOKTEP00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET390  CALL      NOKTEB00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET400  CALL      NOKREL00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET410  CALL      ATTDOC00           * Call external routine to keyin
          BRANCH    EXIT,ACDET999      * abort keyin
          GOTO      ACDET002
.
ACDET420  CALL      REFDOC00                * referring doctor - BKRESDOC
          BRANCH    EXIT,ACDET999      * abort keyin
          GOTO      ACDET002
.
ACDET430  CALL      DUEDAT00           * Call external routine to keyin
          BRANCH    EXIT,ACDET999
          MATCH     SP3,BKREWARD       * ward blank ?
          IF        !@EQUAL
            CALL      CHKWD000         * no - date has changed, ward active ?
            BRANCH    EXIT,ACDET430:   * no
                           ACDET002    * yes - ward only input
            CALL      CHKBD000         * bed active for new date ?
            BRANCH    EXIT,ACDET430    * no
          ENDIF
          GOTO      ACDET002
.
ACDET440  CALL      DUETIM00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET450  CALL      PASDAT00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET460  CALL      PASTIM00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET470  CALL      FUNMEM00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET480  CALL      PRVINP00           * Call external routine to keyin
          GOTO      ACDET002
.
ACDET490  CALL      KPREAC00           * Call external routine to keyin
          BRANCH    EXIT,ACDET999      * abort keyin
          GOTO      ACDET002
.
ACDET495  CALL      EXPWRD00           * Call external routine to keyin
          BRANCH    EXIT,ACDET999      * abort keyin
          GOTO      ACDET002
.
ACDET500  CALL      EXPDUR00
          GOTO      ACDET002
.
ACDET510  CALL      ANAECO00
          BRANCH    EXIT,ACDET999      * abort keyin
          GOTO      ACDET002
.
ACDET520  CALL      OPTYPE00
          BRANCH    EXIT,ACDET999      * abort keyin
          GOTO      ACDET002
.
ACDET530  CALL      TRANSC00
          BRANCH    EXIT,ACDET999      * abort keyin
          GOTO      ACDET002
.
ACDET540  CALL      OPDA1U00
          BRANCH    EXIT,ACDET999      * abort keyin
          GOTO      ACDET002
.
ACDET545  
          CALL      OSTTIM00
          GOTO      ACDET002
.
ACDET550  CALL      OPDA2U00
          BRANCH    EXIT,ACDET999      * abort keyin
          GOTO      ACDET002
.
ACDET560  CALL      OPDA3U00
          BRANCH    EXIT,ACDET999      * abort keyin
          GOTO      ACDET002
.
ACDET570  CALL      OPDA4U00
          BRANCH    EXIT,ACDET999      * abort keyin
          GOTO      ACDET002
.
ACDET580  CALL      PR1ITM00
          BRANCH    EXIT,ACDET999      * abort keyin
          MOVE      OPDAPROV,PROVITM1
          GOTO      ACDET002
.
ACDET590  CALL      PR2ITM00
          BRANCH    EXIT,ACDET999      * abort keyin
          MOVE      OPDAPRV2,PROVITM2
          GOTO      ACDET002
.
ACDET600  CALL      PR3ITM00
          BRANCH    EXIT,ACDET999      * abort keyin
          MOVE      OPDAPRV3,PROVITM3
          GOTO      ACDET002
.
ACDET610  CALL      OP1DSC00
          GOTO      ACDET002
.
ACDET620  CALL      OP2DSC00
          GOTO      ACDET002
.
ACDET630  CALL      OP3DSC00
          GOTO      ACDET002
.
ACDET640  CALL      OPCOMM00
          GOTO      ACDET002
.
ACDET700  CALL      KBKCLS00                * patient category - BKRECLSS
          BRANCH    EXIT,ACDET999           * abort keyin
          GOTO      ACDET002
.
ACDET710  CALL      KBKATP00                * admission type - BKREATYP
          BRANCH    EXIT,ACDET999           * abort keyin
          GOTO      ACDET002
.
ACDET720  CALL      KBKDPT00                * department - BKREDEPT
          BRANCH    EXIT,ACDET999           * abort keyin
          GOTO      ACDET002
.
ACDET730  CALL      ASSDOC00                * associated doctor - BKRETDOC
          BRANCH    EXIT,ACDET999           * abort keyin
          GOTO      ACDET002
.
ACDET740  CALL      KBKCLT00                * claim type - BKRECLMT
          BRANCH    EXIT,ACDET999           * abort keyin
          GOTO      ACDET002
.
ACDET750  CALL      KBKDIA00                * diagnois code - BKDICODE
          BRANCH    EXIT,ACDET999           * abort keyin
          GOTO      ACDET002
.
ACDET760  CALL      KBKDS100                * diagnois description - BKDIDES1
          GOTO      ACDET002
.
ACDET770  CALL      KBKDS200                * diagnois description - BKDIDES2
          GOTO      ACDET002
.
ACDET780  CALL      KBKEBD00                * expected bed - BKREEBED
          BRANCH    EXIT,ACDET999           * abort keyin
          GOTO      ACDET002
.
ACDET790  CALL      KBKCMM00                * booking comments - BKDICOMM
          GOTO      ACDET002
.
ACDET800  CALL      KREFGP00                * Referring GP - BKRERFGP
          GOTO      ACDET002
.
ACDET810  CALL      KGPCOD00                * GP Practice code - BKREGPPC
          GOTO      ACDET002
.
ACDET820  CALL      GPFANO00                * GPFH approval # - BKREGPFA
          GOTO      ACDET002
.
ACDET830  CALL      RESIDS00                * Resident status - BKRETYPE
          BRANCH    EXIT,ACDET999           * abort keyin
          GOTO      ACDET002
.
ACDET840  CALL      ELADMT00                * Elective Admission type - BKREEATY
          BRANCH    EXIT,ACDET999           * abort keyin
          GOTO      ACDET002
.
ACDET850  IF        IMIN<>0
            CALL      EADDRS00                * 4th Address line
          ENDIF                               * if get all dets keyin this field
          GOTO      ACDET002
.
ACDET860  CALL      KECRAP00                * ECR Approval # - BKREECRA
          GOTO      ACDET002
.
ACDET870  CALL      KBDOFR00                * District of Residence - BKREDOFR
          GOTO      ACDET002
.
ACDET880  CALL      KGPNPR00                * GP Code - no practice - BKRERFGP
          GOTO      ACDET002
.
ACDET890  CALL      KPOSDT00               * Date arrived from Overseas-PTMXOSDT
          GOTO      ACDET002
.
ACDET910  CALL      EXPLOS00               * expected length of stay - BKREELOS
          GOTO      ACDET002
.
ACDET920  CALL      REBKDT00               * Booking Date - BKREBKDT
          GOTO      ACDET002
.
ACDET999  RETURN
+
.***************************************************************************
.*                             SLDET000                                    *
.*                       Modify Input Values                               *
.***************************************************************************
SLDET000  MOVE      ZERO,FIELDNO
          MOVE      NINES,DPOINT            * set to display all
.
SLDET002  CALL      MAINQST
          COMPARE   ZERO,CCITEM 
          GOTO      SLDET900 IF EQUAL       * post selected
          GOTO      SLDET991 IF LESS        * cancel
.
          MOVE      CCITEM,FIELDNO          * get the item entered
          CALL      LOADSCN                 * determine the actual field
          BRANCH    OPSCVARN,SLDET005,SLDET010,SLDET020,SLDET030,SLDET040:
                             SLDET050,SLDET060,SLDET070,SLDET080,SLDET090:    10
                             SLDET100,SLDET110,SLDET120,SLDET130,SLDET140:
                             SLDET150,SLDET160,SLDET170,SLDET180,SLDET190:    20
                             SLDET200,SLDET210,SLDET220,SLDET230,SLDET240:
                             SLDET250,SLDET260,SLDET270,SLDET280,SLDET290:    30
                             SLDET300,SLDET310,SLDET320,SLDET330,SLDET340:
                             SLDET350,SLDET360,SLDET380,SLDET390,SLDET400:    40
                             SLDET410,SLDET420,SLDET430,SLDET440,SLDET450:
                             SLDET460,SLDET470,SLDET480,SLDET490,SLDET495:    50
                             SLDET500,SLDET510,SLDET520,SLDET530,SLDET540:
                             SLDET545,SLDET550,SLDET560,SLDET570,SLDET003:    60
                             SLDET580,SLDET590,SLDET600,SLDET610,SLDET620:
                             SLDET630,SLDET640,SLDET003,SLDET003,SLDET700:    70
                             SLDET710,SLDET720,SLDET730,SLDET740,SLDET750:
                             SLDET760,SLDET770,SLDET780,SLDET790,SLDET800:    80
                             SLDET810,SLDET820,SLDET830,SLDET840,SLDET850:
                             SLDET860,SLDET870,SLDET880,SLDET890,SLDET999:    90
                             SLDET910,SLDET920
.
SLDET003  BEEP
          GOTO      SLDET000
.
SLDET005  CALL      PTITLE00           * Call external routine to keyin
          BRANCH    EXIT,SLDET991      * abort keyin
          GOTO      SLDET002
.
SLDET010  CALL      SURNAM00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET020  CALL      GIVNAM00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET030  CALL      PRVNAM00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET040  CALL      FADDRS00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET050  CALL      SADDRS00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET060  CALL      SUBURB00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET070  CALL      POSTCD00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET080  CALL      PRTELE00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET090  CALL      BSTELE00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET100  CALL      GENDER00           * Call external routine to keyin
          BRANCH    EXIT,SLDET991      * abort keyin
          GOTO      SLDET002
.
SLDET110  CALL      MARSTA00           * Call external routine to keyin
          BRANCH    EXIT,SLDET991      * abort keyin
          GOTO      SLDET002
.
SLDET120  CALL      DATBIR00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET130  CALL      COUNTR00           * Call external routine to keyin
          BRANCH    EXIT,SLDET991      * abort keyin
          GOTO      SLDET002
.
SLDET140  CALL      RELIGN00           * Call external routine to keyin
          BRANCH    EXIT,SLDET991      * abort keyin
          GOTO      SLDET002
.
SLDET150  CALL      RESTAT00           * Call external routine to keyin
          BRANCH    EXIT,SLDET991      * abort keyin
          GOTO      SLDET002
.
SLDET160  CALL      OCCUPN00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET170  CALL      MEDCAR00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET180  CALL      PENSNO00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET190  CALL      PENEXP00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET200  CALL      REPATN00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET210  CALL      LOCDOC00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET220  CALL      HLFUND00           * Call external routine to keyin
          BRANCH    EXIT,SLDET991      * abort keyin
          GOTO      SLDET002
.
SLDET230  CALL      FUNDTL00           * Call external routine to keyin
          BRANCH    EXIT,SLDET991      * abort keyin
          GOTO      SLDET002
.
SLDET240  CALL      FUNDNO00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET250  CALL      FIUSER00           * Call external routine to keyin
          BRANCH    EXIT,SLDET991      * abort keyin
          GOTO      SLDET002
.
SLDET260  CALL      SEUSER00           * Call external routine to keyin
          BRANCH    EXIT,SLDET991      * abort keyin
          GOTO      SLDET002
.
SLDET270  CALL      THUSER00           * Call external routine to keyin
          BRANCH    EXIT,SLDET991      * abort keyin
          GOTO      SLDET002
.
SLDET280  CALL      FOUSER00           * Call external routine to keyin
          BRANCH    EXIT,SLDET991      * abort keyin
          GOTO      SLDET002
.
SLDET290  CALL      FFUSER00           * Call external routine to keyin
          BRANCH    EXIT,SLDET991      * abort keyin
          GOTO      SLDET002
.
SLDET300  CALL      SIUSER00           * Call external routine to keyin
          BRANCH    EXIT,SLDET991      * abort keyin
          GOTO      SLDET002
.
SLDET310  CALL      YEARES00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET320  CALL      NOKNAM00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET330  CALL      NOKOAD00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET340  CALL      NOKTAD00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET350  CALL      NOKSUB00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET360  CALL      NOKPOS00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET380  CALL      NOKTEP00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET390  CALL      NOKTEB00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET400  CALL      NOKREL00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET410  CALL      ATTDOC00           * Call external routine to keyin
          BRANCH    EXIT,SLDET991      * abort keyin
          GOTO      SLDET002
.
SLDET420  CALL      REFDOC00                * referring doctor - BKRESDOC
          BRANCH    EXIT,SLDET991      * abort keyin
          GOTO      SLDET002
.
SLDET430  CALL      DUEDAT00           * Call external routine to keyin
          BRANCH    EXIT,SLDET991
          MATCH     SP3,BKREWARD       * ward blank ?
          IF        !@EQUAL
            CALL      CHKWD000         * no - date has changed, ward active ?
            BRANCH    EXIT,SLDET430:   * no
                           SLDET002    * yes - ward only input
            CALL      CHKBD000         * bed active for new date ?
            BRANCH    EXIT,SLDET430    * no
          ENDIF
          GOTO      SLDET002
.
SLDET440  CALL      DUETIM00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET450  CALL      PASDAT00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET460  CALL      PASTIM00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET470  CALL      FUNMEM00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET480  CALL      PRVINP00           * Call external routine to keyin
          GOTO      SLDET002
.
SLDET490  CALL      KPREAC00           * Call external routine to keyin
          BRANCH    EXIT,SLDET991      * abort keyin
          GOTO      SLDET002
.
SLDET495  CALL      EXPWRD00           * Call external routine to keyin
          BRANCH    EXIT,SLDET991      * abort keyin
          GOTO      SLDET002
.
SLDET500  CALL      EXPDUR00
          GOTO      SLDET002
.
SLDET510  CALL      ANAECO00
          BRANCH    EXIT,SLDET991      * abort keyin
          GOTO      SLDET002
.
SLDET520  CALL      OPTYPE00
          BRANCH    EXIT,SLDET991      * abort keyin
          GOTO      SLDET002
.
SLDET530  CALL      TRANSC00
          BRANCH    EXIT,SLDET991      * abort keyin
          GOTO      SLDET002
.
SLDET540  CALL      OPDA1U00
          BRANCH    EXIT,SLDET991      * abort keyin
          GOTO      SLDET002
.
SLDET545  
          CALL      OSTTIM00
          GOTO      SLDET002
.
SLDET550  CALL      OPDA2U00
          BRANCH    EXIT,SLDET991      * abort keyin
          GOTO      SLDET002
.
SLDET560  CALL      OPDA3U00
          BRANCH    EXIT,SLDET991      * abort keyin
          GOTO      SLDET002
.
SLDET570  CALL      OPDA4U00
          BRANCH    EXIT,SLDET991      * abort keyin
          GOTO      SLDET002
.
SLDET580  CALL      PR1ITM00
          BRANCH    EXIT,SLDET991      * abort keyin
          MOVE      OPDAPROV,PROVITM1
          GOTO      SLDET002
.
SLDET590  CALL      PR2ITM00
          BRANCH    EXIT,SLDET991      * abort keyin
          MOVE      OPDAPRV2,PROVITM2
          GOTO      SLDET002
.
SLDET600  CALL      PR3ITM00
          BRANCH    EXIT,SLDET991      * abort keyin
          MOVE      OPDAPRV3,PROVITM3
          GOTO      SLDET002
.
SLDET610  CALL      OP1DSC00
          GOTO      SLDET002
.
SLDET620  CALL      OP2DSC00
          GOTO      SLDET002
.
SLDET630  CALL      OP3DSC00
          GOTO      SLDET002
.
SLDET640  CALL      OPCOMM00
          GOTO      SLDET002
.
SLDET700  CALL      KBKCLS00                * patient category - BKRECLSS
          BRANCH    EXIT,SLDET991           * abort keyin
          GOTO      SLDET002
.
SLDET710  CALL      KBKATP00                * admission type - BKREATYP
          BRANCH    EXIT,SLDET991           * abort keyin
          GOTO      SLDET002
.
SLDET720  CALL      KBKDPT00                * department - BKREDEPT
          BRANCH    EXIT,SLDET991           * abort keyin
          GOTO      SLDET002
.
SLDET730  CALL      ASSDOC00                * assocaited doctor - BKRETDOC
          BRANCH    EXIT,SLDET991           * abort keyin
          GOTO      SLDET002
.
SLDET740  CALL      KBKCLT00                * claim type - BKRECLMT
          BRANCH    EXIT,SLDET991           * abort keyin
          GOTO      SLDET002
.
SLDET750  CALL      KBKDIA00                * diagnois code - BKDICODE
          BRANCH    EXIT,SLDET991           * abort keyin
          GOTO      SLDET002
.
SLDET760  CALL      KBKDS100                * diagnois description - BKDIDES1
          GOTO      SLDET002
.
SLDET770  CALL      KBKDS200                * diagnois description - BKDIDES2
          GOTO      SLDET002
.
SLDET780  CALL      KBKEBD00                * expected bed - BKREEBED
          BRANCH    EXIT,SLDET991           * abort keyin
          GOTO      SLDET002
.
SLDET790  CALL      KBKCMM00                * booking comments - BKDICOMM
          GOTO      SLDET002
.
SLDET800  CALL      KREFGP00                * Referring GP - BKRERFGP
          GOTO      SLDET002
.
SLDET810  CALL      KGPCOD00                * GP Practice code - BKREGPPC
          GOTO      SLDET002
.
SLDET820  CALL      GPFANO00                * GPFH Approval # - BKREGPFH
          GOTO      SLDET002
.
SLDET830  CALL      RESIDS00                * Resident status - BKRERESI
          BRANCH    EXIT,SLDET991           * abort keyin
          GOTO      SLDET002
.
SLDET840  CALL      ELADMT00                * Elective Admis type - BKREEATY
          BRANCH    EXIT,SLDET991           * abort keyin
          GOTO      SLDET002
.
SLDET850  IF        IMIN<>0
            CALL      EADDRS00                * 4th Address line
          ENDIF                               * if get all dets keyin this field
          GOTO      SLDET002
.
SLDET860  CALL      KECRAP00                * ECR Approval # - BKREECRA
          GOTO      SLDET002
.
SLDET870  CALL      KBDOFR00                * District of Residence - BKREDOFR
          GOTO      SLDET002
.
SLDET880  CALL      KGPNPR00                * GP Code - no practice - BKRERFGP
          GOTO      SLDET002
.
SLDET890  CALL      KPOSDT00               * Date arrived from Overseas-PTMXOSDT
          GOTO      SLDET002
.
SLDET910  CALL      EXPLOS00               * Expected length of stay - BKREELOS
          GOTO      SLDET002
.
SLDET920  CALL      REBKDT00               * Booking Date - BKREBKDT
          GOTO      SLDET002
.
.         set exit flags 
.
SLDET900  MOVE      ZERO,EXIT               * POST selected
          GOTO      SLDET999
.
SLDET991  MOVE      ONE,EXIT                * CANCEL selected
.
SLDET999  RETURN
+
.**************************************************************************
.*                  OPUPDBAS                                              *
.*        update routine for basic details                                *
.**************************************************************************
OPUPDBAS  MOVE      SIX,VARNUM              * value for booking screen
          MOVE      "99",DPOINT             * set to display all
.
          MOVE      OPDAPROV,PROVITM1
          MOVE      OPDAPRV2,PROVITM2
          MOVE      OPDAPRV3,PROVITM3
.
          CALL      SVDET000                * Move all PMI det. to temp. vars.
          CALL      DVAR0000                * Display variables and screen
          MOVE      ZERO,IMIN               * dont enter PMI details initially
.
.         modify details
.
          CALL      SLDET000                * Modify details, Post or Cancel
          BRANCH    EXIT,UBOKB999           * cancel selected
.
          MOVE      PROVITM1,OPDAPROV
          MOVE      PROVITM2,OPDAPRV2
          MOVE      PROVITM3,OPDAPRV3
.
UBOK9000  MOVE      ZERO,EXIT
UBOKB999  RETURN
..............................................................................

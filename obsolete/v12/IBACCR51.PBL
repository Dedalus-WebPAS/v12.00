.---------------------------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.00.00"
.-------------------------------------------------------
. V9.02.00  04.07.2002  Glenn Saunders
.           Export to new release i.e. v9.02 from r5.09
.---------------------------------------------------------------------------
. V5.09.01  08/08/2001  Davin
.           Recompiled for change to CCSEPSFD
.---------------------------------------------------------------------------
. V5.04.02  28.07.1996 B.G.Ackland
.           New Fields for Southern Health
. V5.04.01  11.02.1996 B.G.Ackland
.           Extend Episode file.
. V6.00.06  16.12.1993 B.G.Ackland
.           Day Case Change
. V6.00.05  13.07.1993 B.G.Ackland
.           Extend Episode file.
.---------------------------------------------------------------------------
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBACCR51
.   Function      :   Casemix Data Exporting                  
.   Generated  On :   08/07/2002
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       CCR51TFD    
          INC       CCSCEAFD/INC
          INC       CCSCEBFD/INC
          INC       CCSCECFD/INC
          INC       CCSCEDFD/INC
          INC       CCSCEEFD/INC
          INC       CCSCEFFD/INC
          INC       CCSCEGFD/INC
          INC       CCSCMAFD/INC
          INC       CCSCONFD/INC
          INC       CCSEPSFD/INC
          INC       CCSHCDFD/INC
          INC       CCSREPDF    
          INC       CCSSTADF    
          INC       CCSSTYFD/INC
          INC       CCSXHDFD/INC
.=========================
.Local Variable Definition
.-------------------------
EXPORTLV  FORM      1 * Scr 00 Fld     5
DOWNNAME  DIM      40 * Scr 00 Fld     6
EXPORTNO  FORM      3 * Scr 00 Fld     7
LEVDESC   DIM      35 * Scr 00 Fld     8
EXTRLEVL  FORM      1 * Scr 00 Fld     9
FROMDD    DIM      10 * Scr 00 Fld    21
TODD      DIM      10 * Scr 00 Fld    22
FROMAD    DIM      10 * Scr 00 Fld    23
TOAD      DIM      10 * Scr 00 Fld    24
VISITDES  DIM      15 * Scr 00 Fld    25
EXTDESC   DIM      35 * Scr 00 Fld    26
FROMCMOD  DIM      35 * Scr 00 Fld    28
TOCMOD    DIM      35 * Scr 00 Fld    29
INTVDES   DIM      15 * Scr 00 Fld    31
REPTSEQ   FORM      2 * Scr 00 Fld    32
SEQDESC   DIM      30 * Scr 00 Fld    33
CLV1DES   DIM      35 * Scr 00 Fld    40
CLV2DES   DIM      35 * Scr 00 Fld    41
CLV3DES   DIM      35 * Scr 00 Fld    42
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBACCR51"
PRGNAM    INIT      "Casemix Data Exporting                  "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      SC00L000
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          MOVE      "   64",AUDTSECT
          MOVE      " 37",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening ccsaudep";
            OPEN      CCSAUDEP,"ccsaudep"
          ENDIF
          DISPLAY   *P56:24,"Opening ccsceaaf";
          OPEN      CCSCEAA1,"ccsceaaf"
          DISPLAY   *P56:24,"Opening ccscmaaf";
          OPEN      CCSCMAA1,"ccscmaaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA1,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA2,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA3,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA4,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA5,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccshcdaf";
          OPEN      CCSHCDA1,"ccshcdaf"
          DISPLAY   *P56:24,"Opening ccshcdaf";
          OPEN      CCSHCDA2,"ccshcdaf"
          DISPLAY   *P56:24,"Opening ccsstyaf";
          OPEN      CCSSTYA1,"ccsstyaf"
          DISPLAY   *P56:24,"Opening ccsxhdaf";
          OPEN      CCSXHDA1,"ccsxhdaf"
          DISPLAY   *P56:24,"Opening ccsxhdaf";
          OPEN      CCSXHDA2,"ccsxhdaf"
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "00",SCRID
          IF         @EQUAL
            CALL       PS00L000   * Options                            
          ENDIF
          RETURN
.--------------------------------
. Screen - Options                            
.--------------------------------
SC00L000
SC00L100
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC00L200
          CALL      CF00L000 * Clear Fields
          CALL      MVACCEPT
SC00L300
          CALL      KY00L000 * Enter Key Fields
          BRANCH    EXIT,SC00L999,SC00L999
SC00L400
          CALL      WP00L000 * Load any WP Details
SC00L500
          CALL      LM00L000 * Load any Batch Details
SC00L600
          CALL      DF00L000 * Display Fields
SC00L700
          CALL      SF00L000 * Select Fields
          BRANCH    EXIT,SC00L100,SC00L100,SC00L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC00L800
SC00L900
SC00L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Options                            
.-------------------------------------------------------
CF00L000
          MOVE      SP70,CCEAEID 
          MOVE      ZERO,EXPORTLV
          MOVE      SP70,DOWNNAME
          MOVE      ZERO,EXPORTNO
          MOVE      SP70,LEVDESC 
          MOVE      ZERO,EXTRLEVL
          MOVE      SP70,CCEADES 
          MOVE      SP70,CCEAINC 
          MOVE      SP70,CCEAVIS 
          MOVE      SP70,CCEADAY 
          MOVE      SP70,CCEALV1 
          MOVE      SP70,CCEALV2 
          MOVE      SP70,CCEALV3 
          MOVE      SP70,CCEAFCM 
          MOVE      SP70,CCEAFYR 
          MOVE      SP70,CCEATCM 
          MOVE      SP70,CCEATYR 
          MOVE      SP70,FROMDD  
          MOVE      SP70,TODD    
          MOVE      SP70,FROMAD  
          MOVE      SP70,TOAD    
          MOVE      SP70,VISITDES
          MOVE      SP70,EXTDESC 
          MOVE      SP70,CCHCDES 
          MOVE      SP70,FROMCMOD
          MOVE      SP70,TOCMOD  
          MOVE      ZERO,CCCONINT
          MOVE      SP70,INTVDES 
          MOVE      ZERO,REPTSEQ 
          MOVE      SP70,SEQDESC 
          MOVE      SP70,CLV1DES 
          MOVE      SP70,CLV2DES 
          MOVE      SP70,CLV3DES 
CF00L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Options                            
.--------------------------------------------------------
KY00L000
          MOVE      ZERO,EXIT
          GOTO      KY00L999
.
KY00L900  MOVE      ONE,EXIT
KY00L999  RETURN
.---------------------------------------------------------
. Load WP files for : Options                            
.---------------------------------------------------------
WP00L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Options                            
.---------------------------------------------------------
LM00L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Options                            
.---------------------------------------------------------
DF00L000
          BRANCH   ACCEPT,DF00L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF00L900
          MATCH    PRGID,SCPSPID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF00L010 IF NOT EQUAL
.
          CALL     PS00L000 * Display Field
          GOTO     DF00L010
DF00L900
DF00L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Options                            
.---------------------------------------------------------
PS00L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS00L999,PS00L999,PS00L999,PS00L101:
                            PS00L102,PS00L103,PS00L104,PS00L105:
                            PS00L106,PS00L107,PS00L108,PS00L109:
                            PS00L110,PS00L111,PS00L112,PS00L113:
                            PS00L114,PS00L115,PS00L116,PS00L117:
                            PS00L118,PS00L119,PS00L120,PS00L121:
                            PS00L122,PS00L123,PS00L124,PS00L125:
                            PS00L126,PS00L127,PS00L128,PS00L129:
                            PS00L130,PS00L999,PS00L999,PS00L999:
                           PS00L999,PS00L999,PS00L999,PS00L131:
                            PS00L132,PS00L133
          GOTO     PS00L999
.
PS00L101
          MOVE      CCEAEID,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L102
          MOVE      EXPORTLV,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L103
          MOVE      DOWNNAME,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L104
          MOVE      EXPORTNO,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L105
          MOVE      LEVDESC,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L106
          MOVE      EXTRLEVL,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L107
          MOVE      CCEADES,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L108
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      CCEAINC,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L109
          MOVE      CCEAVIS,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L110
          MOVE      CCEADAY,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L111
          MOVE      CCEALV1,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L112
          MOVE      CCEALV2,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L113
          MOVE      CCEALV3,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L114
          MOVE      CCEAFCM,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L115
          MOVE      CCEAFYR,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L116
          MOVE      CCEATCM,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L117
          MOVE      CCEATYR,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L118
          MOVE      FROMDD,VAR       
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L119
          MOVE      TODD,VAR         
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L120
          MOVE      FROMAD,VAR       
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L121
          MOVE      TOAD,VAR         
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L122
          MOVE      VISITDES,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L123
          MOVE      EXTDESC,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L124
          MOVE      CCHCDES,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L125
          MOVE      FROMCMOD,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L126
          MOVE      TOCMOD,VAR       
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L127
          MOVE      CCCONINT,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L128
          MOVE      INTVDES,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L129
          MOVE      REPTSEQ,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L130
          MOVE      SEQDESC,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L131
          MOVE      CLV1DES,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L132
          MOVE      CLV2DES,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L133
          MOVE      CLV3DES,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
PS00L999
          RETURN
.---------------------------------------------------------
. Selections for : Options                            
.---------------------------------------------------------
SF00L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF00L001  BRANCH   ACCEPT,SF00L020
.
SF00L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L006,SF00L101,SF00L102,SF00L103:
                            SF00L104,SF00L105,SF00L106,SF00L006:
                            SF00L107,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L108,SF00L006,SF00L109:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                           SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006
SF00L006  BEEP
          GOTO     SF00L005
SF00L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF00L090
          MATCH    PRGID,SCSLPID
          GOTO     SF00L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF00L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L020,SF00L020,SF00L020,SF00L103:
                            SF00L104,SF00L105,SF00L106,SF00L020:
                            SF00L107,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L108,SF00L020,SF00L109:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                           SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020
          GOTO     SF00L020
SF00L090  MOVE     ZERO,ACCEPT
          GOTO     SF00L001
.
SF00L101
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L102
            MOVE      ZERO,HLEF
            CALL      GETSCR00
          CALL      REPT0000
          MOVE      EXIT,SECTOR
          IF        SECTOR=0
            CALL      FRESCR00
            GOTO      SF00L999
          ENDIF
          IF        SECTOR=1
            CALL      FRESCR00
            MOVE      ZERO,EXIT
            GOTO      SF00L001
          ENDIF
          IF        SECTOR=2
            CALL      FRESCR00
            MOVE      ONE,EXIT
            GOTO      SF00L999
          ENDIF
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      PUTSCR00
          IF        SECTOR=4
            CALL      DF00L000
          ENDIF
          GOTO      SF00L001
.
SF00L103
.
.
          MOVE      "   10",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CCEADES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   11",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CCEAINC 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   12",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CCEAVIS 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   15",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CCEALV2 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   16",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CCEALV3 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   22",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TODD    
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   23",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,FROMAD  
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   24",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOAD    
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   25",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,VISITDES
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   27",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CCHCDES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   28",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,FROMCMOD
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   29",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOCMOD  
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   40",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CLV1DES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   41",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CLV2DES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   42",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CLV3DES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      EEID0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L103
            ENDIF
            BRANCH    EXIT,SF00L103,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      CCEAEID,VAR      
          CALL      DISPITEM
.
.
          MOVE      "   10",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      CCEADES,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   11",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      NO,YESNO
            MOVE      ZERO,FORM2
            MOVE      CCEAINC,FORM2    
            LOAD      YESNO,FORM2,YES
            MOVE      YESNO,VAR
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   12",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      CCEAVIS,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   15",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      CCEALV2,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   16",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      CCEALV3,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   22",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TODD,VAR         
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   23",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      FROMAD,VAR       
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   24",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOAD,VAR         
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   25",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      VISITDES,VAR     
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   27",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      CCHCDES,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   28",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      FROMCMOD,VAR     
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   29",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOCMOD,VAR       
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   40",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      CLV1DES,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   41",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      CLV2DES,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   42",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      CLV3DES,VAR      
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L104
.
.
          MOVE      "    8",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,LEVDESC 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL      DEFAULTN
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      ELEVL000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L104
            ENDIF
            BRANCH    EXIT,SF00L104,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      EXPORTLV,VAR     
          CALL      DISPITEM
.
.
          MOVE      "    8",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      LEVDESC,VAR      
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L105
          CALL     SELECTED
          STRIP     DOWNNAME
          SFORMAT   VAR,SCPSLEN
          MOVE      DOWNNAME,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,DOWNNAME
          SFORMAT   VAR,127
          ENDSET    DOWNNAME
          APPEND    SP70,DOWNNAME
          RESET     DOWNNAME
          CMATCH    EXITCHAR,DOWNNAME
          GOTO      SF00L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,DOWNNAME
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L105
            ENDIF
          ENDIF
          MOVE      DOWNNAME,VAR     
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L106
          CALL     SELECTED
          MOVE      SP70,VAR
          CALL      DISPITEM
          KEYIN     *PCCOL:CVERT,*V2LON,*NOMASK,*RV,EXPORTNO
          IF        SCPSMAN=1
            COMPARE   ZERO,EXPORTNO
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L106
            ENDIF
          ENDIF
          MOVE      EXPORTNO,VAR     
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L107
.
.
          MOVE      "   26",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,EXTDESC 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      EXTLV000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L107
            ENDIF
            BRANCH    EXIT,SF00L107,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      EXTRLEVL,VAR     
          CALL      DISPITEM
.
.
          MOVE      "   26",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      EXTDESC,VAR      
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L108
.
.
          MOVE      "   31",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,INTVDES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      ECINT000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L108
            ENDIF
            BRANCH    EXIT,SF00L108,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      CCCONINT,VAR     
          CALL      DISPITEM
.
.
          MOVE      "   31",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      INTVDES,VAR      
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L109
.
.
          MOVE      "   33",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SEQDESC 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KRSEQ000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L109
            ENDIF
            BRANCH    EXIT,SF00L109,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      REPTSEQ,VAR      
          CALL      DISPITEM
.
.
          MOVE      "   33",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SEQDESC,VAR      
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
SF00L990  MOVE      FOUR,EXIT * Exit Char Exit
SF00L999  RETURN
.@@@@@ Function Restart Point @@@@@
.----------------------------------------
. Move one to accept to for insert mode
.----------------------------------------
MVACCEPT  MOVE      ONE,ACCEPT
          RETURN
DEFAULTN    MOVE     ANSN,DEFYESNO
            RETURN
.------------------------------------------------------------
. Print Report
.------------------------------------------------------------
REPT0000  CALL      OPEN0000
          BRANCH    EXIT,REPT9900
          DISPLAY  *P1:10,*EF
          MOVE      DOWNNAME,KEY80
          STRIP     KEY80
          ENDSET    KEY80
          APPEND    ".txt",KEY80
          RESET     KEY80
          DISPLAY  *P1:15,*EL,"Extracting Casemix Analysis File"
          DISPLAY  *P1:16,*EL,*V2LON,KEY80
.
          BRANCH    EXTRLEVL,REPT1000,REPT2000,REPT3000
.
REPT1000  CALL      LV1EX000
          GOTO      REPT5000
.
REPT2000  CALL      LV2EX000
          GOTO      REPT5000
.
REPT3000  CALL      LV3EX000
          GOTO      REPT5000
.
REPT5000  CALL      TRAN0000  * Transfer Files Now
          GOTO      REPT9990
.
REPT9900  MOVE      THREE,EXIT            * Restore Screen
          GOTO      REPT9999
.
REPT9990  MOVE      ZERO,EXIT            * Exit
          GOTO      REPT9999
REPT9999  RETURN
.--------------------------------------------------------------------------
. Execute Transfer Script eg softerm
.--------------------------------------------------------------------------
TRAN0000  MOVE     YES,DEFYESNO
          DISPLAY  *P1:24,*EL,"Execute Transfer Now (":
                              *V2LON,"Y",*HOFF,"/":
                              *V2LON,"N",*HOFF,") ? "
          MOVE     "24",CVERT
          MOVE     "30",CCOL
          CALL     YORN0000
          COMPARE  ZERO,FYESNO,
          GOTO     TRAN9999 IF EQUAL   *  No Transfer
          KEYIN    *P1:24,*EL,"Transfer to Execute : ",KEY40
          ENDSET   KEY40
          APPEND   SP70,KEY40
          RESET    KEY40
          MATCH    SP70,KEY40
          GOTO     TRAN0000 IF EQUAL
          DISPLAY  *P67:24,*EL,"Ok (",*V2LON,"Y",*HOFF,"/":
                              *V2LON,"N",*HOFF,") ? "
          MOVE     "24",CVERT
          MOVE     "78",CCOL
          CALL     YORN0000
          COMPARE  ZERO,FYESNO,
          GOTO     TRAN0000 IF EQUAL   *  Not ok
.
          MOVE     ZERO,HLEF
          CALL     GETSCR00
          STRIP    KEY40
          EXECUTE  KEY40,TASKID
.
          CALL     PUTSCR00
.
          DISPLAY  *P1:24,*EL,"Transfer Ok (":
                              *V2LON,"Y",*HOFF,"/":
                              *V2LON,"N",*HOFF,") ? "
          MOVE     "24",CVERT
          MOVE     "21",CCOL
          CALL     YORN0000
          COMPARE  ZERO,FYESNO,
          GOTO     TRAN0000 IF EQUAL   *  Not ok
.
          DISPLAY  *P1:24,*EL,"Delete Files (":
                              *V2LON,"Y",*HOFF,"/":
                              *V2LON,"N",*HOFF,") ? "
          MOVE     "24",CVERT
          MOVE     "22",CCOL
          CALL     YORN0000
          COMPARE  ZERO,FYESNO,
          GOTO     TRAN9999 IF EQUAL   *  Not ok
.
          PREP     DOWNFILE,DOWNNAME
          CLOSE    DOWNFILE,DELETE
.
TRAN9999  RETURN
.------------------------------------------------------------
. Open/Create Downlaod File
.------------------------------------------------------------
OPEN0000  STRIP     DOWNNAME
          ENDSET    DOWNNAME
          APPEND    SP70,DOWNNAME
          RESET     DOWNNAME
.
          MATCH     SP70,DOWNNAME
          GOTO      OPEN9000 IF EQUAL
.
          STRIP     DOWNNAME
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      DOWNFILE,DOWNNAME
          TRAPCLR   IO
          BRANCH    OVRCD,OPEN1000
.
OPEN0100  BEEP
          KEYIN     *P1:24,*EL,"Export File Already Exists. Overwrite (":
                    *V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,ANS
          REP       UPPLOW,ANS
          MOVE      ONE,EXIT
          MATCH     "N",ANS
          GOTO      OPEN9999 IF EQUAL
          MATCH     "Y",ANS
          GOTO      OPEN0100 IF NOT EQUAL
          CLOSE     DOWNFILE,DELETE
.
OPEN1000  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          PREP      DOWNFILE,DOWNNAME
          TRAPCLR   IO
          BRANCH    OVRCD,OPEN9100
          MOVE      ZERO,EXIT
          GOTO      OPEN9999
.
OPEN9000  BEEP
          MOVE      "Export Filename MUST be Specified - ",DISPMSG
          CALL      MESSAGE1
          MOVE      ONE,EXIT
          GOTO      OPEN9999
.
OPEN9100  BEEP
          MOVE      "Unable to Create Export File - ",DISPMSG
          CALL      MESSAGE1
          MOVE      ONE,EXIT
          GOTO      OPEN9999
.
OPEN9999  RETURN
.
CLSTMP00  DISPLAY  *P1:10;
          CLOSE    CCSTMPA1,DELETE
          RETURN
.
OPNTMP00  DISPLAY  *P1:10;
          CLEAR    FILENAME
          APPEND   "CCR51A",FILENAME
          APPEND   PORT,FILENAME
          RESET    FILENAME
          REP      " 0",FILENAME
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSTMPA1,FILENAME
          TRAPCLR  IO
          IF       OVRCD=0
            CLOSE    CCSTMPA1,DELETE
          ENDIF
.
          CLEAR    COMMAND
          APPEND   ISBUILD,COMMAND
          APPEND   FILENAME,COMMAND
          APPEND   " 41 U1-10,11-20,21-30,31-40",COMMAND
          RESET    COMMAND
          EXECUTE  COMMAND,TASKID
          OPEN     CCSTMPA1,FILENAME
.
          RETURN
.------------------------------------------------------------
. Write Export File
.------------------------------------------------------------
WR01E000  MOVE      SP70,LEV1DESC
          PACK      KEY13,CCEALV1,CCEBLV1
          CALL      RDCCXH1
          IF        OVRCD=0
            MOVE      CCXHDES,LEV1DESC
          ENDIF
          WRITE     DOWNFILE,SEQ;QUOTE,CCEBLV1,QUOTE,COMMA:
                    QUOTE,LEV1DESC,QUOTE,COMMA:
                    CCEBNEP,COMMA:
                    CCEBLTO,COMMA:
                    CCEBFTC,COMMA:
                    CCEBTTC
.
WR01E999  RETURN
.------------------------------------------------------------
. Print Line
.------------------------------------------------------------
WR02E000  MOVE      SP70,LEV1DESC
          MOVE      SP70,LEV2DESC
          PACK      KEY13,CCEALV1,CCEDLV1
          CALL      RDCCXH1
          IF        OVRCD=0
            MOVE      CCXHDES,LEV1DESC
          ENDIF
          PACK      KEY13,CCEALV2,CCEDLV2
          CALL      RDCCXH1
          IF        OVRCD=0
            MOVE      CCXHDES,LEV2DESC
          ENDIF
          WRITE     DOWNFILE,SEQ;QUOTE,CCEDLV1,QUOTE,COMMA:
                    QUOTE,LEV1DESC,QUOTE,COMMA:
                    QUOTE,CCEDLV2,QUOTE,COMMA:
                    QUOTE,LEV2DESC,QUOTE,COMMA:
                    CCEDNEP,COMMA:
                    CCEDLTO,COMMA:
                    CCEDFTC,COMMA:
                    CCEDTTC
.
WR02E999  RETURN
.------------------------------------------------------------
. Print Line
.------------------------------------------------------------
WR03E000  MOVE      SP70,LEV1DESC
          MOVE      SP70,LEV2DESC
          MOVE      SP70,LEV3DESC
          PACK      KEY13,CCEALV1,CCEELV1
          CALL      RDCCXH1
          IF        OVRCD=0
            MOVE      CCXHDES,LEV1DESC
          ENDIF
          PACK      KEY13,CCEALV2,CCEELV2
          CALL      RDCCXH1
          IF        OVRCD=0
            MOVE      CCXHDES,LEV2DESC
          ENDIF
          PACK      KEY13,CCEALV3,CCEELV3
          CALL      RDCCXH1
          IF        OVRCD=0
            MOVE      CCXHDES,LEV3DESC
          ENDIF
          WRITE     DOWNFILE,SEQ;QUOTE,CCEELV1,QUOTE,COMMA:
                    QUOTE,LEV1DESC,QUOTE,COMMA:
                    QUOTE,CCEELV2,QUOTE,COMMA:
                    QUOTE,LEV2DESC,QUOTE,COMMA:
                    QUOTE,CCEELV3,QUOTE,COMMA:
                    QUOTE,LEV3DESC,QUOTE,COMMA:
                    CCEENEP,COMMA:
                    CCEELTO,COMMA:
                    CCEEFTC,COMMA:
                    CCEETTC
.
WR03E999  RETURN
.------------------------------------------------------------
. Print Line
.------------------------------------------------------------
WR04E000  MOVE      SP70,LEV1DESC
          MOVE      SP70,LEV2DESC
          MOVE      SP70,LEV3DESC
          PACK      KEY13,CCEALV1,CCECLV1
          CALL      RDCCXH1
          IF        OVRCD=0
            MOVE      CCXHDES,LEV1DESC
          ENDIF
          PACK      KEY13,CCEALV2,CCECLV2
          CALL      RDCCXH1
          IF        OVRCD=0
            MOVE      CCXHDES,LEV2DESC
          ENDIF
          PACK      KEY13,CCEALV3,CCECLV3
          CALL      RDCCXH1
          IF        OVRCD=0
            MOVE      CCXHDES,LEV3DESC
          ENDIF
          PACK      KEY18,CCECHCD,CCECEPS
          CALL      RDCCEP1
.
          WRITE     DOWNFILE,SEQ;QUOTE,CCECLV1,QUOTE,COMMA:
                    QUOTE,LEV1DESC,QUOTE,COMMA:
                    QUOTE,CCECLV2,QUOTE,COMMA:
                    QUOTE,LEV2DESC,QUOTE,COMMA:
                    QUOTE,CCECLV3,QUOTE,COMMA:
                    QUOTE,LEV3DESC,QUOTE,COMMA:
                    QUOTE,CCECHCD,QUOTE,COMMA:
                    QUOTE,CCECEPS,QUOTE,COMMA:
                    CCEPSEX,COMMA:
                    CCEPAGEY,COMMA:
                    CCEPADAT,COMMA:
                    CCEPDDAT,COMMA:
                    CCECLOS,COMMA:
                    CCECFTC,COMMA:
                    CCECTTC
.
WR04E999  RETURN
.----------------------------------------------------------------------
. Clear Total Other Record
.----------------------------------------------------------------------
CLROTH00  MOVE      CCEENEP,OTHNEP
          MOVE      CCEELTO,OTHLTO
          MOVE      CCEEFTC,OTHFTC
          MOVE      CCEETTC,OTHTTC
          RETURN
.----------------------------------------------------------------------
. Accumulate Total Other Record
.----------------------------------------------------------------------
TOTOTH00  BRANCH    EXTRLEVL,TOTOTH10,TOTOTH20,TOTOTH30
.
TOTOTH10  ADD       CCEBNEP,OTHNEP
          ADD       CCEBLTO,OTHLTO
          ADD       CCEBFTC,OTHFTC
          ADD       CCEBTTC,OTHTTC
          GOTO      TOTOTH99
.
TOTOTH20  ADD       CCEDNEP,OTHNEP
          ADD       CCEDLTO,OTHLTO
          ADD       CCEDFTC,OTHFTC
          ADD       CCEDTTC,OTHTTC
          GOTO      TOTOTH99
.
TOTOTH30  ADD       CCEENEP,OTHNEP
          ADD       CCEELTO,OTHLTO
          ADD       CCEEFTC,OTHFTC
          ADD       CCEETTC,OTHTTC
          GOTO      TOTOTH99
.
TOTOTH99  RETURN
.----------------------------------------------------------------------
. Write Total Other Record
.----------------------------------------------------------------------
WRTOTH00  MOVE      "Other                   ",LEV1DESC
          MOVE      "Other                   ",LEV2DESC
          MOVE      "Other                   ",LEV3DESC
          IF         (OTHNEP+OTHLTO+OTHFTC=0)
            GOTO       WRTOTH99
          ENDIF
.
          BRANCH    EXPORTLV,WRTOTH10,WRTOTH20,WRTOTH30,WRTOTH40
.
WRTOTH10  WRITE     DOWNFILE,SEQ;QUOTE,"9999999999",QUOTE,COMMA:
                    QUOTE,LEV1DESC,QUOTE,COMMA:
                    OTHNEP,COMMA:
                    OTHLTO,COMMA:
                    OTHFTC,COMMA:
                    OTHTTC
          GOTO      WRTOTH99
.
WRTOTH20  WRITE     DOWNFILE,SEQ;QUOTE,"9999999999",QUOTE,COMMA:
                    QUOTE,LEV1DESC,QUOTE,COMMA:
                    QUOTE,"9999999999",QUOTE,COMMA:
                    QUOTE,LEV2DESC,QUOTE,COMMA:
                    OTHNEP,COMMA:
                    OTHLTO,COMMA:
                    OTHFTC,COMMA:
                    OTHTTC
          GOTO      WRTOTH99
.
WRTOTH30  WRITE     DOWNFILE,SEQ;QUOTE,"9999999999",QUOTE,COMMA:
                    QUOTE,LEV1DESC,QUOTE,COMMA:
                    QUOTE,"9999999999",QUOTE,COMMA:
                    QUOTE,LEV2DESC,QUOTE,COMMA:
                    QUOTE,"9999999999",QUOTE,COMMA:
                    QUOTE,LEV3DESC,QUOTE,COMMA:
                    OTHNEP,COMMA:
                    OTHLTO,COMMA:
                    OTHFTC,COMMA:
                    OTHTTC
          GOTO      WRTOTH99
.
WRTOTH40
          WRITE     DOWNFILE,SEQ;QUOTE,"9999999999",QUOTE,COMMA:
                    QUOTE,LEV1DESC,QUOTE,COMMA:
                    QUOTE,"9999999999",QUOTE,COMMA:
                    QUOTE,LEV2DESC,QUOTE,COMMA:
                    QUOTE,"9999999999",QUOTE,COMMA:
                    QUOTE,LEV3DESC,QUOTE,COMMA:
                    QUOTE,"99",QUOTE,COMMA:
                    QUOTE,"9999999999",QUOTE,COMMA:
                    " ",COMMA:
                    "999",COMMA:
                    "99999999",COMMA:
                    "99999999",COMMA:
                    OTHLTO,COMMA:
                    OTHFTC,COMMA:
                    OTHTTC
.
          GOTO      WRTOTH99
.
WRTOTH99  RETURN
.------------------------------------------------------------
. Extract Level 1
.------------------------------------------------------------
LV1EX000  CALL      CLROTH00
          BRANCH    REPTSEQ,LV1EX200,LV1EX200,LV1EX200,LV1EX200
          DISPLAY   *P1:24,*EL,"Creating File       : ";
          MOVE      ZERO,SECTOR
          PACK      KEY10,SP70
          CALL      RSCCEB1
LV1EX100  CALL      RKCCEB1
          BRANCH    OVRCD,LV1EX900
          ADD       ONE,SECTOR
          IF        (SECTOR%50=0)
            DISPLAY   *P23:24,SECTOR
          ENDIF
          IF        EXPORTNO>0
            IF        SECTOR>EXPORTNO
              CALL      TOTOTH00
              GOTO      LV1EX100
            ENDIF
          ENDIF
.
          CALL      LV1WR000
.
          GOTO      LV1EX100
.
. Alternative Sequence
.----------------------
LV1EX200  CALL      OPNTMP00
          DISPLAY   *P1:24,*EL,"Sorting Details     : ";
          PACK      KEY10,SP70
          CALL      RSCCEB1
LV1EX300  CALL      RKCCEB1
          BRANCH    OVRCD,LV1EX400
.
          BRANCH    REPTSEQ,LV1EX310,LV1EX320,LV1EX330,LV1EX340
.
LV1EX310  MOVE      CCEBNEP,F10
          PACK      KEY10,F10
          GOTO      LV1EX390
.
LV1EX320  ASSIGN    CCEBLTO,F10
          PACK      KEY10,F10
          GOTO      LV1EX390
.
LV1EX330  ASSIGN    CCEBFTC,F10
          PACK      KEY10,F10
          GOTO      LV1EX390
.
LV1EX340  MOVE      CCEBTTC,F10
          PACK      KEY10,F10
          GOTO      LV1EX390
.
LV1EX390  PACK      KEY40,KEY10,CCEBLV1,SP70
          UNPACK    KEY40,CCTMSEQ,CCTMLV1,CCTMLV2,CCTMLV3
          CALL      RDCCTM1
          IF        OVRCD=1
            CALL      WRCCTM1
          ENDIF
          GOTO      LV1EX300
.
LV1EX400  PACK      KEY40,Z70
          MOVE      ZERO,SECTOR
          DISPLAY   *P1:24,*EL,"Creating File       : ";
          CALL      CLROTH00
          CALL      RSCCTM1
LV1EX500  CALL      RPCCTM1
          BRANCH    OVRCD,LV1EX600
          ADD       ONE,SECTOR
          IF        (SECTOR%50=0)
            DISPLAY   *P23:24,SECTOR
          ENDIF
.
          PACK      KEY10,CCTMLV1
          CALL      RDCCEB1
.
          IF        EXPORTNO>0
            IF        SECTOR>EXPORTNO
              CALL      TOTOTH00
              GOTO      LV1EX500
            ENDIF
          ENDIF
.
          CALL      LV1WR000
.
          GOTO      LV1EX500
.
LV1EX600  CALL      CLSTMP00
.
LV1EX900  CALL      WRTOTH00
          MOVE      ZERO,EXIT
.
LV1EX999  RETURN
.------------------------------------------------------------
. Extract Level 2
.------------------------------------------------------------
LV2EX000  CALL      CLROTH00
          BRANCH    REPTSEQ,LV2EX200,LV2EX200,LV2EX200,LV2EX200
          DISPLAY   *P1:24,*EL,"Creating File       : ";
          MOVE      ZERO,SECTOR
          PACK      KEY20,SP70
          CALL      RSCCED1
LV2EX100  CALL      RKCCED1
          BRANCH    OVRCD,LV2EX900
          ADD       ONE,SECTOR
          IF        (SECTOR%50=0)
            DISPLAY   *P23:24,SECTOR
          ENDIF
          IF        EXPORTNO>0
            IF        SECTOR>EXPORTNO
              CALL      TOTOTH00
              GOTO      LV2EX100
            ENDIF
          ENDIF
.
          CALL      LV2WR000
          GOTO      LV2EX100
.
. Alternative Sequence
.----------------------
LV2EX200  CALL      OPNTMP00
          DISPLAY   *P1:24,*EL,"Sorting Details     : ";
          PACK      KEY20,SP70
          CALL      RSCCED1
LV2EX300  CALL      RKCCED1
          BRANCH    OVRCD,LV2EX400
          BRANCH    REPTSEQ,LV2EX310,LV2EX320,LV2EX330,LV2EX340
.
LV2EX310  MOVE      CCEDNEP,F10
          PACK      KEY10,F10
          GOTO      LV2EX390
.
LV2EX320  ASSIGN    CCEDLTO,F10
          PACK      KEY10,F10
          GOTO      LV2EX390
.
LV2EX330  ASSIGN    CCEDFTC,F10
          PACK      KEY10,F10
          GOTO      LV2EX390
.
LV2EX340  MOVE      CCEDTTC,F10
          PACK      KEY10,F10
          GOTO      LV2EX390
.
LV2EX390  PACK      KEY40,KEY10,CCEDLV1,CCEDLV2,SP70
          UNPACK    KEY40,CCTMSEQ,CCTMLV1,CCTMLV2,CCTMLV3
          CALL      RDCCTM1
          IF        OVRCD=1
            CALL      WRCCTM1
          ENDIF
          GOTO      LV2EX300
.
LV2EX400  PACK      KEY20,Z70
          MOVE      ZERO,SECTOR
          DISPLAY   *P1:24,*EL,"Creating File       : ";
          CALL      CLROTH00
          CALL      RSCCTM1
LV2EX500  CALL      RPCCTM1
          BRANCH    OVRCD,LV2EX600
          ADD       ONE,SECTOR
          IF        (SECTOR%50=0)
            DISPLAY   *P23:24,SECTOR
          ENDIF
.
          PACK      KEY20,CCTMLV1,CCTMLV2
          CALL      RDCCED1
.
          IF        EXPORTNO>0
            IF        SECTOR>EXPORTNO
              CALL      TOTOTH00
              GOTO      LV2EX500
            ENDIF
          ENDIF
.
          CALL      LV2WR000
.
          GOTO      LV2EX500
.
LV2EX600  CALL      CLSTMP00
.
LV2EX900  CALL      WRTOTH00
          MOVE      ZERO,EXIT
LV2EX999  RETURN
.------------------------------------------------------------
. Extract Level 3
.------------------------------------------------------------
LV3EX000  CALL      CLROTH00
          BRANCH    REPTSEQ,LV3EX200,LV3EX200,LV3EX200,LV3EX200
          DISPLAY   *P1:24,*EL,"Creating File       : ";
          MOVE      ZERO,SECTOR
          PACK      KEY20,SP70
          CALL      RSCCEE1
LV3EX100  CALL      RKCCEE1
          BRANCH    OVRCD,LV3EX900
          ADD       ONE,SECTOR
          IF        (SECTOR%50=0)
            DISPLAY   *P23:24,SECTOR
          ENDIF
          IF        EXPORTNO>0
            IF        SECTOR>EXPORTNO
              CALL      TOTOTH00
              GOTO      LV3EX100
            ENDIF
          ENDIF
.
          CALL      LV3WR000
          GOTO      LV3EX100
.
. Alternative Sequence
.----------------------
LV3EX200  CALL      OPNTMP00
          DISPLAY   *P1:24,*EL,"Sorting Details     : ";
          PACK      KEY20,SP70
          CALL      RSCCEE1
LV3EX300  CALL      RKCCEE1
          BRANCH    OVRCD,LV3EX400
          BRANCH    REPTSEQ,LV3EX310,LV3EX320,LV3EX330,LV3EX340
.
LV3EX310  MOVE      CCEENEP,F10
          PACK      KEY10,F10
          GOTO      LV3EX390
.
LV3EX320  ASSIGN    CCEELTO,F10
          PACK      KEY10,F10
          GOTO      LV3EX390
.
LV3EX330  ASSIGN    CCEEFTC,F10
          PACK      KEY10,F10
          GOTO      LV3EX390
.
LV3EX340  MOVE      CCEETTC,F10
          PACK      KEY10,F10
          GOTO      LV3EX390
.
LV3EX390  PACK      KEY40,KEY10,CCEELV1,CCEELV2,CCEELV3,SP70
          UNPACK    KEY40,CCTMSEQ,CCTMLV1,CCTMLV2,CCTMLV3
          CALL      RDCCTM1
          IF        OVRCD=1
            CALL      WRCCTM1
          ENDIF
          GOTO      LV3EX300
.
LV3EX400  PACK      KEY20,Z70
          MOVE      ZERO,SECTOR
          DISPLAY   *P1:24,*EL,"Creating File       : ";
          CALL      CLROTH00
          CALL      RSCCTM1
LV3EX500  CALL      RPCCTM1
          BRANCH    OVRCD,LV3EX600
          ADD       ONE,SECTOR
          IF        (SECTOR%50=0)
            DISPLAY   *P23:24,SECTOR
          ENDIF
.
          PACK      KEY30,CCTMLV1,CCTMLV2,CCTMLV3
          CALL      RDCCEE1
.
          IF        EXPORTNO>0
            IF        SECTOR>EXPORTNO
              CALL      TOTOTH00
              GOTO      LV3EX500
            ENDIF
          ENDIF
.
          CALL      LV3WR000
.
          GOTO      LV3EX500
.
LV3EX600  CALL      CLSTMP00
.
LV3EX900  CALL      WRTOTH00
          MOVE      ZERO,EXIT
LV3EX999  RETURN
.
.------------------------------------------------------------
. Write Export File Extract Sequence by Level 1
.------------------------------------------------------------
LV1WR000  BRANCH    EXPORTLV,LV1WR100,LV1WR200,LV1WR300,LV1WR400
.
LV1WR100  CALL      WR01E000
          GOTO      LV1WR999
.
LV1WR200  PACK      KEY20,CCEBLV1,SP70
          CALL      RSCCED1
LV1WR210  CALL      RKCCED1
          BRANCH    OVRCD,LV1WR999
          MATCH     CCEDLV1,CCEBLV1
          GOTO      LV1WR999 IF NOT EQUAL
          CALL      WR02E000
          GOTO      LV1WR210
.
LV1WR300  PACK      KEY30,CCEBLV1,SP70
          CALL      RSCCEE1
LV1WR310  CALL      RKCCEE1
          BRANCH    OVRCD,LV1WR999
          MATCH     CCEELV1,CCEBLV1
          GOTO      LV1WR999 IF NOT EQUAL
          CALL      WR03E000
          GOTO      LV1WR310
.
LV1WR400  PACK      KEY48,CCEBLV1,SP70
          CALL      RSCCEC2
LV1WR410  CALL      RKCCEC2
          BRANCH    OVRCD,LV1WR999
          MATCH     CCECLV1,CCEBLV1
          GOTO      LV1WR999 IF NOT EQUAL
          MATCH     "1",CCECEXC
          GOTO      LV1WR410 IF EQUAL
          CALL      WR04E000
          GOTO      LV1WR410
.
LV1WR999  RETURN
.------------------------------------------------------------
. Write Export File Extract Sequence by Level 2
.------------------------------------------------------------
LV2WR000  BRANCH    EXPORTLV,LV2WR999,LV2WR200,LV2WR300,LV2WR400
.
LV2WR200  CALL      WR02E000
          GOTO      LV2WR999
.
LV2WR300  PACK      KEY30,CCEDLV1,CCEDLV2,SP70
          PACK      KEY20,CCEDLV1,CCEDLV2,SP70
          CALL      RSCCEE1
LV2WR310  CALL      RKCCEE1
          BRANCH    OVRCD,LV2WR999
          MATCH     CCEDLV1,CCEELV1
          GOTO      LV2WR999 IF NOT EQUAL
          MATCH     CCEDLV2,CCEELV2
          GOTO      LV2WR999 IF NOT EQUAL
          CALL      WR03E000
          GOTO      LV2WR310
.
LV2WR400  PACK      KEY48,CCEDLV1,CCEDLV2,SP70
          CALL      RSCCEC2
LV2WR410  CALL      RKCCEC2
          BRANCH    OVRCD,LV2WR999
          MATCH     CCECLV1,CCEDLV1
          GOTO      LV2WR999 IF NOT EQUAL
          MATCH     CCECLV2,CCEDLV2
          GOTO      LV2WR999 IF NOT EQUAL
          MATCH     "1",CCECEXC
          GOTO      LV2WR410 IF EQUAL
          CALL      WR04E000
          GOTO      LV2WR410
.
LV2WR999  RETURN
.------------------------------------------------------------
. Write Export File Extract Sequence by Level 2
.------------------------------------------------------------
LV3WR000  BRANCH    EXPORTLV,LV3WR999,LV3WR999,LV3WR300,LV3WR400
.
LV3WR300  CALL      WR03E000
          GOTO      LV3WR999
.
LV3WR400  PACK      KEY48,CCEELV1,CCEELV2,CCEELV3,SP70
          CALL      RSCCEC2
LV3WR410  CALL      RKCCEC2
          BRANCH    OVRCD,LV3WR999
          MATCH     CCECLV1,CCEELV1
          GOTO      LV3WR999 IF NOT EQUAL
          MATCH     CCECLV2,CCEELV2
          GOTO      LV3WR999 IF NOT EQUAL
          MATCH     CCECLV3,CCEELV3
          GOTO      LV3WR999 IF NOT EQUAL
.
          MATCH     "1",CCECEXC
          GOTO      LV3WR410 IF EQUAL
          CALL      WR04E000
          GOTO      LV3WR410
.
LV3WR999  RETURN
.----------------------------------------------------------------------
. Enter Casemix Extract ID
.----------------------------------------------------------------------
EEID0000  MOVE      ZERO,CKEYTYP
          CALL      CCSCOPCL         * Close Files
          CALL      KCCEAA00
          BRANCH    EXIT,EEID9999,EEID9999
          CALL      GETCME00
          CALL      CCSCOPOP         * Open Files
EEID9999  RETURN
.======================================================================
. Determine Display Values for a Valid Casemix Extract Code
.======================================================================
GETCME00  MATCH     SP70,CCEAFDD
          IF        @EQUAL
            MOVE      "Start     ",FROMDD
          ELSE
            UNPACK    CCEAFDD,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
            MOVE      CPCDATE,FROMDD
          ENDIF
.
          MATCH     "99999999",CCEATDD
          IF        @EQUAL
            MOVE      "Finish    ",TODD
          ELSE
            UNPACK    CCEATDD,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
            MOVE      CPCDATE,TODD
          ENDIF
.
          MATCH     SP70,CCEAFAD
          IF        @EQUAL
            MOVE      "Start     ",FROMAD
          ELSE
            UNPACK    CCEAFAD,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
            MOVE      CPCDATE,FROMAD
          ENDIF
.
          MATCH     "99999999",CCEATAD
          IF        @EQUAL
            MOVE      "Finish    ",TOAD
          ELSE
            UNPACK    CCEATAD,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
            MOVE      CPCDATE,TOAD
          ENDIF
.
          MOVE     CCEAVIS,F1
          BRANCH   F1,GETCME10,GETCME20,GETCME30
          MOVE     "All        ",VISITDES
          GOTO     GETCME40
GETCME10  MOVE     "A & E      ",VISITDES
          GOTO     GETCME40
GETCME20  MOVE     "Outpatients ",VISITDES
          GOTO     GETCME40
GETCME30  MOVE     "Inpatients",VISITDES
          GOTO     GETCME40
.
GETCME40  MOVE     SP70,CLV1DES
          MOVE     "Not Applicable",CLV2DES
          MOVE     "Not Applicable",CLV3DES
.
          MOVE     CCEALV1,KEY3
          CALL     RDCCST1
          MOVE     CCSTDES,CLV1DES
.
          MATCH    SP70,CCEALV2
          IF       !@EQUAL
            MOVE     CCEALV2,KEY3
            CALL     RDCCST1
            MOVE     CCSTDES,CLV2DES
          ENDIF
.
          MATCH    SP70,CCEALV3
          IF       !@EQUAL
            MOVE     CCEALV3,KEY3
            CALL     RDCCST1
            MOVE     CCSTDES,CLV3DES
          ENDIF
.
          MATCH    SP70,CCEAFCM
          IF       @EQUAL
            MOVE     "Actual Costs",FROMCMOD
          ELSE
            MOVE     CCEAFCM,KEY4
            CALL     RDCCMA1
            MOVE     CCMADES,FROMCMOD
          ENDIF
.
          MATCH    SP70,CCEATCM
          IF       @EQUAL
            MOVE     "Actual Costs",TOCMOD
          ELSE
            MOVE     CCEATCM,KEY4
            CALL     RDCCMA1
            MOVE     CCMADES,TOCMOD
          ENDIF
.
          MOVE     CCEAHCD,KEY2
          CALL     RDCCHC1
.
          RETURN
.------------------------------------------------------------
. Enter Level
.------------------------------------------------------------
ELEVL000  MOVE      "17",HTOP
          MOVE      "40",HLEF
          MOVE      "23",HBOT
          MOVE      "80",HRIG
          CALL      GETSCR00
          BOXCLR    HLEF,HTOP,HRIG,HBOT
          BOX       16,HLEF,HTOP,HRIG,HBOT
          DISPLAY   *P41:18,"    ",*V2LON,*ULON,"Casemix Level",*HOFF:
                    *P41:19,*V2LON," 1. ",*HOFF,CLV1DES:
                    *P41:20,*V2LON," 2. ",*HOFF,CLV2DES:
                    *P41:21,*V2LON," 3. ",*HOFF,CLV3DES:
                    *P41:22,*V2LON," 4. ",*HOFF,"Patient Episode"
.
ELEVL100  KEYIN     *PCCOL:CVERT,*V2LON,EXPORTLV
          IF        EXPORTLV<EXTRLEVL
            BEEP
            MOVE      "Export Level must be >= Extract Level - ",DISPMSG
            CALL      MESSAGE1
            GOTO      ELEVL100
          ENDIF
.
          BRANCH    EXPORTLV,ELEVL110,ELEVL120,ELEVL130,ELEVL140
          BEEP
          GOTO      ELEVL100
.
ELEVL110
          MOVE      CLV1DES,LEVDESC
          GOTO      ELEVL999
.
ELEVL120
          MATCH     SP70,CCEALV2
          IF        @EQUAL
            BEEP
            MOVE      "Extract Not Valid for this level - ",DISPMSG
            CALL      MESSAGE1
            GOTO      ELEVL100
          ENDIF
          MOVE      CLV2DES,LEVDESC
          GOTO      ELEVL999
.
ELEVL130
          MATCH     SP70,CCEALV3
          IF        @EQUAL
            BEEP
            MOVE      "Extract Not Valid for this level - ",DISPMSG
            CALL      MESSAGE1
            GOTO      ELEVL100
          ENDIF
          MOVE      CLV3DES,LEVDESC
          GOTO      ELEVL999
.
ELEVL140  MOVE      "Patient Episodes    ",LEVDESC
          GOTO      ELEVL999
.
ELEVL999  CALL      PUTSCR00
          RETURN
.
.------------------------------------------------------------
. Enter Level
.------------------------------------------------------------
EXTLV000  MOVE      "18",HTOP
          MOVE      "40",HLEF
          MOVE      "23",HBOT
          MOVE      "80",HRIG
          CALL      GETSCR00
          BOXCLR    HLEF,HTOP,HRIG,HBOT
          BOX       16,HLEF,HTOP,HRIG,HBOT
          DISPLAY   *P41:19,"    ",*V2LON,*ULON,"Casemix Level",*HOFF:
                    *P41:20,*V2LON," 1. ",*HOFF,CLV1DES:
                    *P41:21,*V2LON," 2. ",*HOFF,CLV2DES:
                    *P41:22,*V2LON," 3. ",*HOFF,CLV3DES
.
EXTLV100  KEYIN     *PCCOL:CVERT,*V2LON,EXTRLEVL
          BRANCH    EXTRLEVL,EXTLV110,EXTLV120,EXTLV130
          BEEP
          GOTO      EXTLV100
.
EXTLV110
          MOVE      CLV1DES,EXTDESC
          GOTO      EXTLV999
.
EXTLV120
          MATCH     SP70,CCEALV2
          IF        @EQUAL
            BEEP
            MOVE      "Extract Not Valid for this level - ",DISPMSG
            CALL      MESSAGE1
            GOTO      EXTLV100
          ENDIF
          MOVE      CLV2DES,EXTDESC
          GOTO      EXTLV999
.
EXTLV130
          MATCH     SP70,CCEALV3
          IF        @EQUAL
            BEEP
            MOVE      "Extract Not Valid for this level - ",DISPMSG
            CALL      MESSAGE1
            GOTO      EXTLV100
          ENDIF
          MOVE      CLV3DES,EXTDESC
          GOTO      EXTLV999
.
EXTLV999  CALL      PUTSCR00
          RETURN
.
.
ECINT000  MOVE      SP70,DISPMSG
          CALL      MESSAGE2
          DISPLAY   *P1:24,"C.I.: ":
                    *V2LON,"0",*HOFF,". 0, ":
                    *V2LON,"1",*HOFF,". 70%, ":
                    *V2LON,"2",*HOFF,". 80%, ":
                    *V2LON,"3",*HOFF,". 90%, ":
                    *V2LON,"4",*HOFF,". 95%, ":
                    *V2LON,"5",*HOFF,". 98%, ":
                    *V2LON,"6",*HOFF,". 99%, ":
                    *V2LON,"7",*HOFF,". 99.8%, ":
                    *V2LON,"8",*HOFF,". 99.9%"
ECINT200  MOVE      ZERO,CCCONINT
          KEYIN     *PCCOL:CVERT,*V2LON,*RV,CCCONINT
          MOVE      "Include All",INTVDES
          COMPARE   ZERO,CCCONINT
          GOTO      ECINT999 IF EQUAL
          BRANCH    CCCONINT,ECINT210,ECINT220,ECINT230,ECINT240:
                             ECINT250,ECINT260,ECINT270,ECINT280
          BEEP
          GOTO      ECINT200
ECINT210  MOVE      "70 %       ",INTVDES
          GOTO      ECINT999
ECINT220  MOVE      "80 %       ",INTVDES
          GOTO      ECINT999
ECINT230  MOVE      "90 %       ",INTVDES
          GOTO      ECINT999
ECINT240  MOVE      "95 %       ",INTVDES
          GOTO      ECINT999
ECINT250  MOVE      "98 %       ",INTVDES
          GOTO      ECINT999
ECINT260  MOVE      "99 %       ",INTVDES
          GOTO      ECINT999
ECINT270  MOVE      "99.8 %       ",INTVDES
          GOTO      ECINT999
ECINT280  MOVE      "99.9 %       ",INTVDES
          GOTO      ECINT999
ECINT999  CALL      MESSAGE3
          RETURN
.------------------------------------------------------------
. Enter Sequence
.------------------------------------------------------------
KRSEQ000  MOVE      SP70,DISPMSG
          CALL      MESSAGE2
          DISPLAY   *P1:24,*EL,"Sequence : ":
                    *V2LON,"0",*HOFF,".Code, ":
                    *V2LON,"1",*HOFF,".Episodes, ":
                    *V2LON,"2",*HOFF,".Bed Days, ":
                    *V2LON,"3",*HOFF,".Cost (1), ":
                    *V2LON,"4",*HOFF,".Cost (2)"
KRSEQ100  KEYIN     *PCCOL:CVERT,*V2LON,REPTSEQ
          MOVE      "By Casemix Code ",SEQDESC
          COMPARE   ZERO,REPTSEQ
          GOTO      KRSEQ999 IF EQUAL
          BRANCH    REPTSEQ,KRSEQ110,KRSEQ120,KRSEQ130,KRSEQ140
          BEEP
          GOTO      KRSEQ100
.
KRSEQ110  MOVE      "By Number of Episodes",SEQDESC
          GOTO      KRSEQ999
.
KRSEQ120  MOVE      "By Number of Bed Days",SEQDESC
          GOTO      KRSEQ999
.
KRSEQ130  MOVE      "By Total Cost (1)",SEQDESC
          GOTO      KRSEQ999
.
KRSEQ140  MOVE      "By Total Cost (2)",SEQDESC
          GOTO      KRSEQ999
.
KRSEQ999  CALL      MESSAGE3
          RETURN
.
.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       CCR51TIO    
          INC       CCSCEAIO/INC
          INC       CCSCEAKY    
          INC       CCSCEBIO/INC
          INC       CCSCECIO/INC
          INC       CCSCEDIO/INC
          INC       CCSCEEIO/INC
          INC       CCSCMAIO/INC
          INC       CCSCONIO/INC
          INC       CCSCOPCD    
          INC       CCSEPSIO/INC
          INC       CCSHCDIO/INC
          INC       CCSSTACD    
          INC       CCSSTYIO/INC
          INC       CCSXHDIO/INC
          INC       CCSXHDKY    
.
          INC       STDGENCD
.

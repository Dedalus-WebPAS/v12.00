.-------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.00.00"
.-------------------------------------------------------
. V9.02.00  03.05.2002  Glenn Saunders
.           Export to new release i.e. v9.02 from vf.09
.-------------------------------------------------------
. VF.09.01  08.05.2003  CAR 38932   Mike Laming
.           Add "X" Screen Selection & Recompile
. VF.09.B01 30.11.2000 Charles Handaya
.           Created a new program
.-------------------------------------------------------
. Start Copying from FMSSTDDF
.
FMLCF4    FORM      4        * form 4 for FMSLMCKY
.--------------------------------------
. Variables for Period Validation
.--------------------------------------
CURYEAR   DIM       4
PERDESC   DIM       15
PEREDAT   DIM       8
PERSDAT   DIM       8
PERLOCK   FORM      1
ERRMSG    DIM       40
MAXPER    FORM      2
PERCNT    FORM      2
WORKDATE  DIM       8
.
BANKNAME  DIM       35
CREDNAME  DIM       35
DEBTNAME  DIM       35
DISCNAME  DIM       35
PAYMNAME  DIM       35
AGSTNAME  DIM       35
CGSTNAME  DIM       35
.
. End Copying from FMSSTDDF
.
ENDDATE   DIM       8
FILENAMA  DIM       8
FRDATESR  DIM       8
SAVEBASC  DIM       3
SRCHDATE  DIM       8
STARTDTE  DIM       8
TODATESR  DIM       8
XCHARD2   DIM       2
.-------------------------------------------------------
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBAAPS35
.   Function      :   BAS Code Transaction Maintenance        
.   Generated  On :   11/11/2003
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       APSMASFD/INC
          INC       FMSAMAFD/INC
          INC       FMSBASFD/INC
          INC       FMSCSAFD/INC
          INC       FMSDISFD/INC
          INC       FMSLMAFD/INC
          INC       FMSLMCFD/INC
          INC       FMSRESFD/INC
          INC       FMSTRNFD/INC
          INC       IBABASFD/INC
          INC       IBACONFD/INC
.=========================
.Local Variable Definition
.-------------------------
KFPERIOD  DIM       2 * Scr 00 Fld     9
DPERYEAR  DIM      45 * Scr 00 Fld    11
.
.    Multi Item Key Fields Scr 00 Fld    12
.-------------------------------------------------------
FMBS2NAM  INIT      "FMBS2"
FMBS2END  FORM      1   * End Display
FMBS2SNO  FORM      5   * Number of Items on the Screen
FMBS2MKY  DIM       127 * Match Key 
FMBS2EKY  DIM       127 * End Key
FMBS2SKY  DIM       127 * Start Key
FMBS2IDX  INIT      " 132 UC1-5"
FMBS2FL1  IFILE     SQL, FIXED=132, KEY="U1-5"
FMBS2FNM  DIM       8  * Filename
FMBS2CNT  FORM      3  * Number of Items on Screen
TTYPDESC  DIM      12 * Scr 00 Fld    17
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBAAPS35"
PRGNAM    INIT      "BAS Code Transaction Maintenance        "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          MOVE      PORT,PARENTID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      RCON0000
          CALL      SC00L000
          CLOSE     FMBS2FL1,DELETE
.
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          MOVE      "   51",AUDTSECT
          MOVE      " 48",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening apsaudma";
            OPEN      APSAUDMA,"apsaudma"
          ENDIF
          DISPLAY   *P56:24,"Opening apsmasaf";
          OPEN      APSMASA1,"apsmasaf"
          DISPLAY   *P56:24,"Opening apsmasaf";
          OPEN      APSMASA2,"apsmasaf"
          DISPLAY   *P56:24,"Opening apsmasaf";
          OPEN      APSMASA3,"apsmasaf"
          DISPLAY   *P56:24,"Opening fmsamaaf";
          OPEN      FMSAMAA1,"fmsamaaf"
          DISPLAY   *P56:24,"Opening fmsamaaf";
          OPEN      FMSAMAA2,"fmsamaaf"
          DISPLAY   *P56:24,"Opening fmsamaaf";
          OPEN      FMSAMAA3,"fmsamaaf"
          DISPLAY   *P56:24,"Opening fmsamaaf";
          OPEN      FMSAMAA4,"fmsamaaf"
          MOVE      "   51",AUDTSECT
          MOVE      " 43",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening fmsaudam";
            OPEN      FMSAUDAM,"fmsaudam"
          ENDIF
          MOVE      "   51",AUDTSECT
          MOVE      " 46",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening fmsaudla";
            OPEN      FMSAUDLA,"fmsaudla"
          ENDIF
          DISPLAY   *P56:24,"Opening fmscsaaf";
          OPEN      FMSCSAA1,"fmscsaaf"
          DISPLAY   *P56:24,"Opening fmsdisaf";
          OPEN      FMSDISA1,"fmsdisaf"
          DISPLAY   *P56:24,"Opening fmslmaaf";
          OPEN      FMSLMAA1,"fmslmaaf"
          DISPLAY   *P56:24,"Opening fmslmcaf";
          OPEN      FMSLMCA1,"fmslmcaf"
          DISPLAY   *P56:24,"Opening fmsresaf";
          OPEN      FMSRESA1,"fmsresaf"
          DISPLAY   *P56:24,"Opening ibabasaf";
          OPEN      IBABASA1,"ibabasaf"
          DISPLAY   *P56:24,"Opening ibabasaf";
          OPEN      IBABASA2,"ibabasaf"
.--------------------------------------------------------
. Initialise Batch Screen Posting Date                       
.--------------------------------------------------------
          MOVE     ZERO,FMBS2SNO
          MOVE     "00   12",KEY7
          PACK     KEY15,PRGID,KEY7,SP70
          PACK     KEY20,PRGID,KEY7,SP70
          CALL     RSSCPS2
          CALL     RKSCPS2
          IF       OVRCD=0
            PACK     KEY20,SCPSPID,SCPSSID,SCPSITM
            MATCH    KEY15,KEY20
            IF       @EQUAL
              MOVE     SCPSNOR,FMBS2SNO
            ENDIF
          ENDIF
          PACK      FMBS2FNM,ANST,FMBS2NAM,PORT
          REP       " 0",FMBS2FNM
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      FMBS2FL1,FMBS2FNM
          TRAPCLR   IO
          IF        OVRCD=0
            CLOSE     FMBS2FL1,DELETE
          ENDIF
          PACK      KEY80,SGENISB,FMBS2FNM,FMBS2IDX
          DISPLAY   *P1:3;
          DISPLAY   *P56:24,"Create & Open ",FMBS2FNM;
          EXECUTE   KEY80,TASKID
          OPEN      FMBS2FL1,FMBS2FNM
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "00",SCRID
          IF         @EQUAL
            CALL       PS00L000   * Main Screen                        
          ENDIF
          MATCH     "01",SCRID
          IF         @EQUAL
            CALL       PS01L000   * Details Screen                     
          ENDIF
          RETURN
.--------------------------------
. Screen - Main Screen                        
.--------------------------------
SC00L000
SC00L100
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC00L200
          CALL      CF00L000 * Clear Fields
SC00L300
          CALL      KY00L000 * Enter Key Fields
          BRANCH    EXIT,SC00L999,SC00L999
SC00L400
          CALL      WP00L000 * Load any WP Details
SC00L500
          CALL      LM00L000 * Load any Batch Details
SC00L600
          CALL      DF00L000 * Display Fields
SC00L700
          CALL      SF00L000 * Select Fields
          BRANCH    EXIT,SC00L100,SC00L100,SC00L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC00L800
SC00L900
SC00L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Main Screen                        
.-------------------------------------------------------
CF00L000
          MOVE      SP70,FMLALEDG
          MOVE      SP70,FMLADESC
          MOVE      SP70,IBBABASC
          MOVE      SP70,IBBADESC
          MOVE      SP70,KFPERIOD
          MOVE      SP70,FMLCYEAR
          MOVE      SP70,DPERYEAR
          MOVE      SP70,FMBSPDAT
          MOVE      SP70,FMBSBAT 
          MOVE      SP70,FMBSUNIQ
          MOVE      SP70,FMTRDOCR
          MOVE      SP70,FMTRTYPE
          MOVE      SP70,TTYPDESC
          MOVE      SP70,FMBSBASC
          MOVE      ZERO,FMTRAMT 
CF00L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Main Screen                        
.--------------------------------------------------------
KY00L000
.
KY00L110
.
.
          MOVE      "    6",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,FMLADESC
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      KFMLAA00
          BRANCH    EXIT,KY00L900,KY00L900
          MOVE      ZERO,ACCEPT
          MOVE      FMLALEDG,VAR     
          CALL      DISPITEM
.
.
          MOVE      "    6",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      FMLADESC,VAR     
            CALL      DISPITEM
          ENDIF
.
KY00L120
.
.
          MOVE      "    8",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,IBBADESC
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      EBAS0000
          BRANCH    EXIT,KY00L110,KY00L900
          MOVE      ZERO,ACCEPT
          MOVE      IBBABASC,VAR     
          CALL      DISPITEM
.
.
          MOVE      "    8",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      IBBADESC,VAR     
            CALL      DISPITEM
          ENDIF
.
KY00L130
.
.
          MOVE      "   10",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,FMLCYEAR
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          MOVE      "    9",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      EPER0000
          BRANCH    EXIT,KY00L120,KY00L900
          MOVE      ZERO,ACCEPT
          MOVE      KFPERIOD,VAR     
          CALL      DISPITEM
.
.
          MOVE      "   10",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      FMLCYEAR,VAR     
            CALL      DISPITEM
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      KY00L999
.
KY00L900  MOVE      ONE,EXIT
KY00L999  RETURN
.---------------------------------------------------------
. Load WP files for : Main Screen                        
.---------------------------------------------------------
WP00L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Main Screen                        
.---------------------------------------------------------
LM00L000
.---------------------------------------------------------
. Load for :    12 Posting Date                       
.---------------------------------------------------------
          UNPACK    SP70,FMBSLEDG,FMBSBASC,FMBSPDAT,FMBSBAT,FMBSUNIQ
          PACK      KEY23,FMLALEDG,IBBABASC,SP70
          MOVE      KEY23,FMBS2EKY
          STRIP     FMBS2SKY
          SETLPTR   FMBS2EKY,5
          MOVE      FMBS2EKY,FMBS2SKY
          CALL      RDFMBS2 
          IF        OVRCD=0
            CALL      RPFMBS2 
          ENDIF
          RETURN
.--------------------------------------------------------
. Display Current Page of Multi Items
.--------------------------------------------------------
DP00L000
          MOVE     ZERO,FMBS2CNT
          MOVE     ZERO,FMBS2END
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DP00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DP00L600
          MATCH    PRGID,SCPSPID
          GOTO     DP00L600 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DP00L600 IF NOT EQUAL
          MATCH    NAMSSFFI,SCPSMTY
          GOTO     DP00L010 IF NOT EQUAL
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,DP00L010,DP00L010,DP00L010,DP00L010:
                           DP00L010,DP00L010,DP00L010,DP00L010:
                            DP00L010,DP00L010,DP00L010,DP00L101:
                            DP00L102,DP00L103,DP00L104,DP00L105:
                            DP00L106,DP00L107,DP00L108,DP00L010:
                            DP00L010,DP00L010,DP00L010,DP00L010:
                            DP00L010
          GOTO      DP00L010
.
DP00L101
          PACK      FMBS2MKY,SP70,SP70
          CALL      UPTFMBS2
          IF        FMBS2END=0
            CALL      RKFMBS2 
            IF        OVRCD=0
              PACK      FMBS2MKY,FMBSLEDG,FMBSBASC,FMBSPDAT,FMBSBAT,FMBSUNIQ                                    
              MATCH     FMBS2EKY,FMBS2MKY
              IF        @EQUAL
                MOVE      ZERO,FMBS2END
                ADD       ONE,FMBS2CNT
                CALL      UPTFMBS2
          CALL      SDAT0000
                UNPACK    FMBSPDAT,CCENT,CYEAR,CMON,CDAY          
                CALL      PACDATE
                MOVE      CPCDATE,VAR
                CALL      DISPITEM
          CALL      DTYD0000
              ELSE
                MOVE      ONE,FMBS2END
              ENDIF
            ELSE
              MOVE      ONE,FMBS2END
            ENDIF
          ENDIF
          IF        FMBS2END=1
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP00L010
.
DP00L102
          IF        FMBS2END=0
            MOVE      FMBSBAT,VAR      
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP00L010
.
DP00L103
          IF        FMBS2END=0
            MOVE      FMBSUNIQ,VAR     
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP00L010
.
DP00L104
          IF        FMBS2END=0
            MOVE      FMTRDOCR,VAR     
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP00L010
.
DP00L105
          IF        FMBS2END=0
            MOVE      FMTRTYPE,VAR     
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP00L010
.
DP00L106
          IF        FMBS2END=0
            MOVE      TTYPDESC,VAR     
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP00L010
.
DP00L107
          IF        FMBS2END=0
            MOVE      FMBSBASC,VAR     
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP00L010
.
DP00L108
          IF        FMBS2END=0
            MOVE      FMTRAMT,VAR      
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP00L010
DP00L600
          MATCH    "FMBS2",NAMSSFFI
          GOTO     DP00L605 IF NOT EQUAL
          GOTO     DP00L999
DP00L605
DP00L999
          RETURN
.--------------------------------------------------------
. Display First Page of Multi Items
.--------------------------------------------------------
FP00L000
.
          MATCH    "FMBS2",NAMSSFFI
          GOTO     FP00L105 IF NOT EQUAL
          PACK     KEY23,FMBS2SKY,SP70
          CALL     RDFMBS2  * Start
          IF       OVRCD=0
            CALL     RPFMBS2  * Start
          ENDIF
          CALL     DP00L000
          GOTO     FP00L999
FP00L105
FP00L999  RETURN
.--------------------------------------------------------
. Display Last Page of Multi Items
.--------------------------------------------------------
LP00L000
.
          MATCH    "FMBS2",NAMSSFFI
          GOTO     LP00L105 IF NOT EQUAL
          PACK     KEY23,FMBS2SKY,Z70
          CALL     RSFMBS2  * End
          IF       OVRCD=1
            CALL     RPFMBS2 
          ENDIF
          MOVE     ZERO,SECTOR
          WHILE    SECTOR<FMBS2SNO
            CALL     RPFMBS2 
            IF       OVRCD=1
              MOVE     FMBS2SNO,SECTOR
            ENDIF
            PACK     FMBS2MKY,FMBSLEDG,FMBSBASC,FMBSPDAT,FMBSBAT,FMBSUNIQ                                    
            MATCH    FMBS2EKY,FMBS2MKY
            IF       !@EQUAL
              MOVE     FMBS2SNO,SECTOR
            ENDIF
            ADD      ONE,SECTOR
          DO
          CALL     DP00L000
          GOTO     LP00L999
LP00L105
LP00L999  RETURN
.--------------------------------------------------------
. Display Previous Page  
.--------------------------------------------------------
PP00L000
.
          MATCH    "FMBS2",NAMSSFFI
          GOTO     PP00L120 IF NOT EQUAL
          MOVE     ZERO,SECTOR
PP00L105
          CALL      RFTFMBS2
          BRANCH   OVRCD,PP00L115
          MOVE      FMBS2MKY,KEY23 
          CALL      RSFMBS2 
PP00L110
          MOVE     ZERO,SECTOR
          WHILE    SECTOR<=FMBS2SNO
            CALL     RPFMBS2 
            IF       OVRCD=1
              MOVE     FMBS2SNO,SECTOR
            ENDIF
            PACK     FMBS2MKY,FMBSLEDG,FMBSBASC,FMBSPDAT,FMBSBAT,FMBSUNIQ                                    
            MATCH    FMBS2EKY,FMBS2MKY
            IF       !@EQUAL
              MOVE     FMBS2SNO,SECTOR
            ENDIF
            ADD      ONE,SECTOR
          DO
          CALL     DP00L000
          GOTO     PP00L999
PP00L115
          BEEP
          MOVE     ZERO,SECTOR
          WHILE    SECTOR<FMBS2SNO
            CALL     RKFMBS2 
            IF       OVRCD=1
              MOVE     FMBS2SNO,SECTOR
            ENDIF
            PACK     FMBS2MKY,FMBSLEDG,FMBSBASC,FMBSPDAT,FMBSBAT,FMBSUNIQ                                    
            MATCH    FMBS2EKY,FMBS2MKY
            IF       !@EQUAL
              MOVE     FMBS2SNO,SECTOR
            ENDIF
            ADD      ONE,SECTOR
          DO
          GOTO     PP00L999
PP00L120
PP00L999  RETURN
.--------------------------------------------------------
. Display Next Page of Multi Items
.--------------------------------------------------------
NP00L000
          MATCH    "FMBS2",NAMSSFFI
          GOTO     NP00L115 IF NOT EQUAL
NP00L105
          CALL     RKFMBS2 
          BRANCH   OVRCD,NP00L110
          PACK     FMBS2MKY,FMBSLEDG,FMBSBASC,FMBSPDAT,FMBSBAT,FMBSUNIQ                                    
          MATCH    FMBS2EKY,FMBS2MKY
          GOTO     NP00L110 IF NOT EQUAL
          CALL     RPFMBS2 
          CALL     DP00L000
          GOTO     NP00L999
NP00L110
          CALL     RPFMBS2 
          BEEP
          GOTO     NP00L999
NP00L115
NP00L999  RETURN
.--------------------------------------------------------
. Clear Page of Multi Items from Temp File
.--------------------------------------------------------
CT00L000
CT00L105
CT00L999  RETURN
.---------------------------------------------------------
. Batch IO for Screen : Main Screen                        
.---------------------------------------------------------
.---------------------------------------------------------
. Batch IO for :    12 Posting Date                       
.---------------------------------------------------------
UPTFMBS2
          PACK      KEY5,SCPSROW,SCPSCOL
          READ      FMBS2FL1,KEY5;ANS
          IF        @OVER
            WRITE     FMBS2FL1,KEY5;SCPSROW,SCPSCOL,FMBS2MKY
          ELSE
            UPDATE    FMBS2FL1;SCPSROW,SCPSCOL,FMBS2MKY
          ENDIF
          RETURN
RDTFMBS2
          MOVE      ZERO,OVRCD
          PACK      KEY5,SCPSROW,SCPSCOL
          READ      FMBS2FL1,KEY5;SCPSROW,SCPSCOL,FMBS2MKY
          GOTO      OVERCOND IF OVER
          RETURN
RFTFMBS2
          MOVE      ZERO,OVRCD
          PACK      KEY5,SP70
          READ      FMBS2FL1,KEY5;;
          READKS    FMBS2FL1;SCPSROW,SCPSCOL,FMBS2MKY
          GOTO      OVERCOND IF OVER
          MATCH     SP70,FMBS2MKY
          GOTO      OVERCOND IF EQUAL
          RETURN
.---------------------------------------------------------
. Display Fields for : Main Screen                        
.---------------------------------------------------------
DF00L000
          BRANCH   ACCEPT,DF00L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF00L900
          MATCH    PRGID,SCPSPID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF00L010 IF NOT EQUAL
.
          CALL     PS00L000 * Display Field
          GOTO     DF00L010
DF00L900
          MOVE      "FMBS2",NAMSSFFI
          MOVE      "   12",ITMSSFFI
          CALL      FP00L000
DF00L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Main Screen                        
.---------------------------------------------------------
PS00L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS00L999,PS00L999,PS00L999,PS00L999:
                           PS00L999,PS00L101,PS00L999,PS00L102:
                            PS00L999,PS00L103,PS00L104,PS00L999:
                            PS00L999,PS00L999,PS00L999,PS00L999:
                            PS00L999,PS00L999,PS00L999,PS00L999:
                            PS00L999,PS00L999,PS00L999,PS00L999:
                            PS00L999
          GOTO     PS00L999
.
PS00L101
          MOVE      FMLADESC,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L102
          MOVE      IBBADESC,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L103
          MOVE      FMLCYEAR,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L104
          MOVE      DPERYEAR,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
PS00L999
          RETURN
.---------------------------------------------------------
. Selections for : Main Screen                        
.---------------------------------------------------------
SF00L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF00L001  BRANCH   ACCEPT,SF00L020
.
SF00L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L006,SF00L101,SF00L102,SF00L006:
                           SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L103:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L104:
                            SF00L105,SF00L006,SF00L006,SF00L106:
                            SF00L107
SF00L006  BEEP
          GOTO     SF00L005
SF00L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF00L090
          MATCH    PRGID,SCSLPID
          GOTO     SF00L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF00L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L020,SF00L020,SF00L020,SF00L020:
                           SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L103:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020
          GOTO     SF00L020
SF00L090  MOVE     ZERO,ACCEPT
          MOVE      "FMBS2",NAMSSFFI
          MOVE      "   12",ITMSSFFI
          CALL      FP00L000
          GOTO     SF00L001
.
SF00L101
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L102
          CALL      DTSR0000
          GOTO      SF00L001
.
SF00L103
          CALL      SELECTED
          BRANCH    EXIT,SF00L001
          COMPARE   ONE,ACCEPT
          GOTO      SF00L001 IF EQUAL
          CALL      RDTFMBS2
          IF        OVRCD=1
            BEEP
            GOTO      SF00L001
          ENDIF
          MATCH     SP70,FMBS2MKY
          IF        @EQUAL
            BEEP
            GOTO      SF00L001
          ENDIF
          MOVE      FMBS2MKY,KEY23 
          MOVE      ZERO,HLEF
          CALL      GETSCR00
          CALL      GDAT0000
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      PUTSCR00
          CALL      RFTFMBS2
          IF        OVRCD=1
            CALL      FP00L000
          ELSE
            MOVE      FMBS2MKY,KEY23 
            CALL      RSFMBS2 
            CALL      RPFMBS2 
            CALL      DP00L000
          ENDIF
          GOTO     SF00L001
.
SF00L104
          MOVE      "FMBS2",NAMSSFFI
          MOVE      "   12",ITMSSFFI
          CALL      NP00L000
          GOTO     SF00L001
.
SF00L105
          MOVE      "FMBS2",NAMSSFFI
          MOVE      "   12",ITMSSFFI
          CALL      PP00L000
          GOTO     SF00L001
.
SF00L106
          MOVE      "FMBS2",NAMSSFFI
          MOVE      "   12",ITMSSFFI
          CALL      FP00L000
          GOTO     SF00L001
.
SF00L107
          MOVE      "FMBS2",NAMSSFFI
          MOVE      "   12",ITMSSFFI
          CALL      LP00L000
          GOTO     SF00L001
SF00L990  MOVE      FOUR,EXIT * Exit Char Exit
SF00L999  RETURN
.--------------------------------
. Screen - Details Screen                     
.--------------------------------
SC01L000
SC01L100
          MOVE      "01",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          MOVE      "  1",CLEF
          MOVE      " 80",CRIG
          MOVE      " 7",CTOP
          MOVE      "24",CBOT
          CALL      VBACK000 * Display Background
          MOVE      ZERO,CLEF
          MOVE      ZERO,CTOP
          MOVE      ZERO,CRIG
          MOVE      ZERO,CBOT
.
SC01L200
          CALL      CF01L000 * Clear Fields
SC01L300
          CALL      KY01L000 * Enter Key Fields
          BRANCH    EXIT,SC01L999,SC01L999
SC01L400
          CALL      WP01L000 * Load any WP Details
SC01L500
          CALL      LM01L000 * Load any Batch Details
SC01L600
          CALL      DF01L000 * Display Fields
SC01L700
          CALL      SF01L000 * Select Fields
          BRANCH    EXIT,SC01L100,SC01L100,SC01L200
SC01L800
SC01L900
SC01L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Details Screen                     
.-------------------------------------------------------
CF01L000  COMPARE   ZERO,ACCEPT
              GOTO      CF01L999 IF EQUAL
          MOVE      SP70,FMBSBAT 
          MOVE      SP70,FMBSUNIQ
          MOVE      SP70,FMBSPDAT
          MOVE      SP70,FMTRTDAT
          MOVE      SP70,TTYPDESC
          MOVE      SP70,FMTRDOCR
          MOVE      SP70,FMTRDESC
          MOVE      SP70,FMTRRESP
          MOVE      SP70,FMRSDESC
          MOVE      SP70,FMTRDISS
          MOVE      SP70,FMDSDESC
          MOVE      SP70,FMTRORD 
          MOVE      SP70,FMTRCRED
          MOVE      SP70,APMACN1 
          MOVE      ZERO,FMTRAMT 
          MOVE      SP70,FMBSBASC
          MOVE      SP70,IBBADESC
CF01L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Details Screen                     
.--------------------------------------------------------
KY01L000
          MOVE      ZERO,EXIT
          GOTO      KY01L999
.
KY01L900  MOVE      ONE,EXIT
KY01L999  RETURN
.---------------------------------------------------------
. Load WP files for : Details Screen                     
.---------------------------------------------------------
WP01L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Details Screen                     
.---------------------------------------------------------
LM01L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Details Screen                     
.---------------------------------------------------------
DF01L000
          BRANCH   ACCEPT,DF01L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF01L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF01L900
          MATCH    PRGID,SCPSPID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF01L010 IF NOT EQUAL
.
          CALL     PS01L000 * Display Field
          GOTO     DF01L010
DF01L900
DF01L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Details Screen                     
.---------------------------------------------------------
PS01L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS01L999,PS01L999,PS01L999,PS01L999:
                           PS01L101,PS01L102,PS01L103,PS01L104:
                            PS01L105,PS01L106,PS01L107,PS01L108:
                            PS01L109,PS01L110,PS01L111,PS01L112:
                            PS01L113,PS01L114,PS01L115,PS01L116:
                            PS01L117
          GOTO     PS01L999
.
PS01L101
          MOVE      FMBSBAT,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L102
          MOVE      FMBSUNIQ,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L103
          UNPACK    FMBSPDAT,CCENT,CYEAR,CMON,CDAY          
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L104
          UNPACK    FMTRTDAT,CCENT,CYEAR,CMON,CDAY          
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L105
          MOVE      TTYPDESC,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L106
          MOVE      FMTRDOCR,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L107
          MOVE      FMTRDESC,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L108
          MOVE      FMTRRESP,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L109
          MOVE      FMRSDESC,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L110
          MOVE      FMTRDISS,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L111
          MOVE      FMDSDESC,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L112
          MOVE      FMTRORD,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L113
          MOVE      FMTRCRED,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L114
          MOVE      APMACN1,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L115
          MOVE      FMTRAMT,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L116
          MOVE      FMBSBASC,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L117
          MOVE      IBBADESC,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
PS01L999
          RETURN
.---------------------------------------------------------
. Selections for : Details Screen                     
.---------------------------------------------------------
SF01L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF01L001  BRANCH   ACCEPT,SF01L020
.
SF01L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L006,SF01L101,SF01L102,SF01L006:
                           SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L103:
                            SF01L006
SF01L006  BEEP
          GOTO     SF01L005
SF01L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF01L090
          MATCH    PRGID,SCSLPID
          GOTO     SF01L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF01L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L020,SF01L020,SF01L020,SF01L020:
                           SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L103:
                            SF01L020
          GOTO     SF01L020
SF01L090  MOVE     ZERO,ACCEPT
          GOTO     SF01L001
.
SF01L101
          MOVE      ZERO,EXIT
          GOTO      SF01L999
.
SF01L102
          CALL      POST0000
          MOVE      ZERO,EXIT
          GOTO      SF01L999
.
SF01L103
.
.
          MOVE      "   21",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,IBBADESC
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      ETBA0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF01L103
            ENDIF
            BRANCH    EXIT,SF01L103,SF01L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF01L990 IF EQUAL
          ENDIF
          MOVE      FMBSBASC,VAR     
          CALL      DISPITEM
.
.
          MOVE      "   21",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      IBBADESC,VAR     
            CALL      DISPITEM
          ENDIF
          GOTO     SF01L001
SF01L990  MOVE      ONE,EXIT * Exit Char Restart
SF01L999  RETURN
.@@@@@ Function Restart Point @@@@@
.----------------------------------------------------------------------
. Read Control File
.----------------------------------------------------------------------
RCON0000  READ      CONTROLF,ZERO;*107,IBCNUBAS,IBCNBSFY
.
RCON9999  RETURN
.
.--------------------------------------------------------
. Search Good Data being displayed
.--------------------------------------------------------
.
. search posting date range
.
SDAT0000  MATCH     FMBSPDAT,TODATESR
          GOTO      SDAT9900 IF LESS
.
          MATCH     FRDATESR,FMBSPDAT
          GOTO      SDAT0100 IF LESS
          GOTO      SDAT2000
.
SDAT0100  CALL      RKFMBS2
          BRANCH    OVRCD,SDAT9900
.
          MATCH     FMLALEDG,FMBSLEDG
          GOTO      SDAT9900 IF NOT EQUAL
.
          MATCH     IBBABASC,FMBSBASC
          GOTO      SDAT9900 IF NOT EQUAL
.
          GOTO      SDAT0000
.
. Account Type 1, 2, 3, 4, and 5 only
.
SDAT2000  PACK      KEY10,FMBSBAT,FMBSUNIQ,SP70
          CALL      RDFMTR1
          BRANCH    OVRCD,SDAT9900
.
          PACK      KEY14,FMTRLEDG,FMTRACCT,SP70
          CALL      RDFMAM1
          BRANCH    OVRCD,SDAT9900
.
          MOVE      "5",DIM1
          MATCH     FMAMTYPE,DIM1
          GOTO      SDAT0100 IF LESS
          GOTO      SDAT9999
.
SDAT9900  MOVE      ONE,OVRCD
          MOVE      ONE,FMBS2END
          GOTO      SDAT9999
.
SDAT9999  RETURN
.
.----------------------------------------------------------------------
. Display Transaction Type Description
.----------------------------------------------------------------------
DTYD0000  MOVE      "Invalid Type",TTYPDESC
.
          MATCH     "IN",FMTRTYPE
          GOTO      DTYD0100 IF EQUAL
.
          MATCH     "PY",FMTRTYPE
          GOTO      DTYD0200 IF EQUAL
.
          MATCH     "JA",FMTRTYPE
          GOTO      DTYD0300 IF EQUAL
.
          MATCH     "JC",FMTRTYPE
          GOTO      DTYD0400 IF EQUAL
.
          MATCH     "CS",FMTRTYPE
          GOTO      DTYD0500 IF EQUAL
.
          MATCH     "CR",FMTRTYPE
          GOTO      DTYD0600 IF EQUAL
.
          MATCH     "RF",FMTRTYPE
          GOTO      DTYD0700 IF EQUAL
.
          MATCH     "RI",FMTRTYPE
          GOTO      DTYD0800 IF EQUAL
.
          MATCH     "CC",FMTRTYPE
          GOTO      DTYD0900 IF EQUAL
.
          GOTO      DTYD9999
.
DTYD0100  MOVE      "Invoice     ",TTYPDESC
          GOTO      DTYD9999
.
DTYD0200  MOVE      "Payment     ",TTYPDESC
          MULT      SEQ,FMTRAMT
          GOTO      DTYD9999
.
DTYD0300  MOVE      "Journal Dr. ",TTYPDESC
          GOTO      DTYD9999
.
DTYD0400  MOVE      "Journal Cr. ",TTYPDESC
          MULT      SEQ,FMTRAMT
          GOTO      DTYD9999
.
DTYD0500  MOVE      "Cash Receipt",TTYPDESC
          MULT      SEQ,FMTRAMT
          GOTO      DTYD9999
.
DTYD0600  MOVE      "Credit      ",TTYPDESC
          MULT      SEQ,FMTRAMT
          GOTO      DTYD9999
.
DTYD0700  MOVE      "Refund      ",TTYPDESC
          GOTO      DTYD9999
.
DTYD0800  MOVE      "Reinst. Inv.",TTYPDESC
          GOTO      DTYD9999
.
DTYD0900  MOVE      "Cancel Cheq.",TTYPDESC
          GOTO      DTYD9999
.
DTYD9999  RETURN
.
.----------------------------------------------------------------------
. Date Search
.----------------------------------------------------------------------
DTSR0000  MOVE      "22",CVERT
          PACK      DISPMSG,SP70,SP70
          CALL      GTMS0000
.
          DISPLAY   *P1:CVERT,"Date Search : ",*EL;
          MOVE      "15",CCOL
.
DTSR0100  UNPACK    STARTDTE,CCENT,CYEAR,CMON,CDAY
          CALL      KEYDATE
          BRANCH    OVRCD,DTSR9900
.
          PACK      SRCHDATE,CCENT,CYEAR,CMON,CDAY
          REP       " 0",SRCHDATE
.
          MATCH     STARTDTE,SRCHDATE
          GOTO      DTSR9000 IF LESS
.
          MATCH     SRCHDATE,ENDDATE
          GOTO      DTSR9000 IF LESS
.
          MOVE      SRCHDATE,FRDATESR
          GOTO      DTSR9900
.
DTSR9000  MOVE      "Date must in Date Period Range - ",DISPMSG
          CALL      MESSAGE1
          GOTO      DTSR0100
.
DTSR9900  CALL      REMS0000
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          CALL      FP00L000
          GOTO      DTSR9999
.
DTSR9999  RETURN
.----------------------------------------------------------------------
. Get Message Line
.----------------------------------------------------------------------
GTMS0000  GETVAR    LINE24A,ATTR24A,1,CVERT
          RESET     DISPMSG
          STRIP     DISPMSG
          ENDSET    DISPMSG
          APPEND    SP1,DISPMSG
          RESET     DISPMSG
          DISPLAY   *P1:CVERT,*EL,*+,DISPMSG;
.
GTMS9999  RETURN
.------------------------------------------------------------
. Restore Message Line after GTMS0000
.------------------------------------------------------------
REMS0000  PUTVAR    LINE24A,ATTR24A,1,CVERT
          RETURN
.
.----------------------------------------------------------------------
. Enter BAS Code
.----------------------------------------------------------------------
EBAS0000  CALL      KIBBAA00
          BRANCH    EXIT,EBAS0100,EBAS9999
.
          GOTO      EBAS9999
.
EBAS0100  MOVE      ZERO,EXIT
          GOTO      EBAS9999
.
EBAS9999  RETURN
.
.----------------------------------------------------------------------
. Enter Financial Period and Year as well
.----------------------------------------------------------------------
EPER0000  UNPACK    SP70,KFPERIOD,FMLCYEAR,DPERYEAR
.
          MOVE      "   11",FLDID
          CALL      GETPOSIT
          PACK      VAR,SP70,SP70
          CALL      DISPITEM
.
          MOVE      "   10",FLDID
          CALL      GETPOSIT
          PACK      VAR,SP70,SP70
          CALL      DISPITEM
.
          MOVE      "    9",FLDID
          CALL      GETPOSIT
          PACK      VAR,SP70,SP70
          CALL      DISPITEM
.
. Financial Period
.
          CALL      KPER0000
          BRANCH    EXIT,EPER9999,EPER9999
.
          MOVE      DIM2,KFPERIOD
.
. Financial Year
.
          MOVE      "   10",FLDID
          CALL      GETPOSIT
.
EPER1000  MOVE      ZERO,CKEYTYP
          PACK      FMLCLEDG,FMLALEDG,SP70
          CALL      KFMLCA00
          BRANCH    EXIT,EPER1800,EPER9999
.
EPER1100  MATCH     IBCNBSFY,FMLCYEAR
          GOTO      EPER9000 IF LESS
.
          CALL      DFYE0000
          BRANCH    EXIT,EPER0000
.
          MOVE      STARTDTE,FRDATESR
          MOVE      ENDDATE,TODATESR
.
          MOVE      "    9",FLDID
          CALL      GETPOSIT
.
. Get Data
.
          CALL      OPEN0000
          BRANCH    EXIT,EPER9999
          GOTO      EPER9999
.
EPER1800  PACK      FMLCYEAR,FMLACYRR,SP70
          REP       " 0",FMLCYEAR
          GOTO      EPER1100
.
EPER9000  CLEAR     DISPMSG
          APPEND    "BAS Financial Year must not < ",DISPMSG
          APPEND    IBCNBSFY,DISPMSG
          APPEND    " - ",DISPMSG
          CALL      MESSAGE1
          GOTO      EPER1000
.
EPER9999  RETURN
.----------------------------------------------------------------------
. Keyin Financial Period
.----------------------------------------------------------------------
KPER0000  MOVE      SP70,DIM2
          KEYIN     *PCCOL:CVERT,*DV,DIM2:
                    *PCCOL:CVERT,*V2LON,*JR,*RV,DIM2
.
          ENDSET    DIM2
          APPEND    SP70,DIM2
          RESET     DIM2
.
          MATCH     SP70,DIM2
          GOTO      KPER9900 IF EQUAL
.
          PACK      XCHARD2,SP1,EXITCHAR,SP70
          MATCH     XCHARD2,DIM2
          GOTO      KPER9950 IF EQUAL
.
          TYPE      DIM2
          GOTO      KPER0000 IF NOT EQUAL
.
          MOVE      DIM2,FORM2
          CALL      VPER0000
          BRANCH    EXIT,KPER0000
.
          MOVE      FORM2,DIM2
          REP       " 0",DIM2
.
          MOVE      ZERO,EXIT
          GOTO      KPER9999
.
KPER9900  MOVE      ONE,EXIT
          GOTO      KPER9999
.
KPER9950  MOVE      TWO,EXIT
          GOTO      KPER9999
.
KPER9999  RETURN
.----------------------------------------------------------------------
. Validate Financial Period
.----------------------------------------------------------------------
VPER0000  MOVE      ZERO,EXIT
          MOVE      "12",F2
          ADD       FMLAPERS,F2
          COMPARE   FORM2,ZERO
          GOTO      VPER9900 IF NOT LESS
          COMPARE   FORM2,F2
          GOTO      VPER9900 IF LESS
.
          GOTO      VPER9999
.
VPER9900  MOVE      ONE,EXIT
          GOTO      VPER9999
.
VPER9999  RETURN
.----------------------------------------------------------------------
. Display Financial Period/Year description
. Return  :  EFINDATE - end of Financial Date (99/99/9999)
.            EXIT : 0 - found, 1 - Not found
.----------------------------------------------------------------------
DFYE0000  MOVE      ZERO,EXIT
.
          PACK      KEY6,FMLALEDG,FMLCYEAR
          CALL      RDFMLC1
          BRANCH    OVRCD,DFYE9000
.
          MOVE      KFPERIOD,FORM2
          LOAD      ENDDATE,FORM2,FMLC01TO,FMLC02TO,FMLC03TO,FMLC04TO,FMLC05TO:
                               FMLC06TO,FMLC07TO,FMLC08TO,FMLC09TO,FMLC10TO:
                               FMLC11TO,FMLC12TO,FMLC13TO
          LOAD      STARTDTE,FORM2,FMLC01FR,FMLC02FR,FMLC03FR,FMLC04FR,FMLC05FR:
                               FMLC06FR,FMLC07FR,FMLC08FR,FMLC09FR,FMLC10FR:
                               FMLC11FR,FMLC12FR,FMLC13FR
          CLEAR     DPERYEAR
          APPEND    "Start Date: ",DPERYEAR
          UNPACK    STARTDTE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          APPEND    CPCDATE,DPERYEAR
          APPEND    SP3,DPERYEAR
          APPEND    "End Date: ",DPERYEAR
          UNPACK    ENDDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          APPEND    CPCDATE,DPERYEAR
          RESET     DPERYEAR
.
          GOTO      DFYE9999
.
DFYE9000  MOVE      ONE,EXIT
.
DFYE9999  RETURN
.----------------------------------------------------------------------
. open Accrual Finance Transactions file and BAS Accrual Transaction File
.----------------------------------------------------------------------
OPEN0000  MOVE      ZERO,EXIT
.
          CLEAR     FILENAMA
          APPEND    "fmst",FILENAMA               * open file (if possible)
          APPEND    FMLCYEAR,FILENAMA
          RESET     FILENAMA
          REP       " 0",FILENAMA
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      FMSTRNA1,FILENAMA            * open current year files
          TRAP      OVERCOND IF IO
          OPEN      FMSTRNA2,FILENAMA            * open current year files
          TRAPCLR   IO
          BRANCH    OVRCD,OPEN9900               * data not found ?
.
. open BAS Accrual Transactions file
.
          PACK      FILENAMA,SP70,SP70
          CLEAR     FILENAMA
          APPEND    "fmsg",FILENAMA               * open file (if possible)
          APPEND    FMLCYEAR,FILENAMA
          RESET     FILENAMA
          REP       " 0",FILENAMA
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      FMSBASA1,FILENAMA            * open current year files
          TRAP      OVERCOND IF IO
          OPEN      FMSBASA2,FILENAMA            * open current year files
          TRAPCLR   IO
          BRANCH    OVRCD,OPEN9900               * data not found ?
.
          GOTO      OPEN9999
.
OPEN9900  MOVE      ONE,EXIT
          MOVE      "No transactions exists for this year - ",DISPMSG
          CALL      MESSAGE1
          GOTO      OPEN9999
.
OPEN9999  RETURN
.
.----------------------------------------------------------------------
. Get BAS Transaction data and Accrual Financial Transaction data
. File checked Validations
.----------------------------------------------------------------------
GDAT0000  MOVE      FMBS2MKY,KEY23
          CALL      RDFMBS2
          IF        OVRCD=1
            MOVE      "BAS Accrual Transaction Detail Not Found - ",DISPMSG
            CALL      MESSAGE1
            GOTO      GDAT9999
          ENDIF
          PACK      KEY10,FMBSBAT,FMBSUNIQ,SP70
          CALL      RDFMTR1
          BRANCH    OVRCD,GDAT9999
.
. Transaction Type Description
.
          CALL      DTYD0000
.
. BAS Code
.
          PACK      KEY3,FMBSBASC,SP70
          CALL      RDIBBA1
.
. Creditor
.
          PACK      KEY5,FMTRCRED,SP70
          CALL      RDAPMA1
.
. Dissection
.
          PACK      KEY5,FMTRDISS,SP70
          CALL      RDFMDS1
.
. Responsibility
.
          PACK      KEY4,FMTRRESP,SP70
          CALL      RDFMRS1
.
          CALL      SC01L000
.
GDAT9999  RETURN
.
.----------------------------------------------------------------------
. Save Transaction Data
.----------------------------------------------------------------------
POST0000  MOVE      FMBSBASC,SAVEBASC
.
          PACK      KEY10,FMBSBAT,FMBSUNIQ
          CALL      RDFMBS1
          IF        OVRCD=0
            MOVE      SAVEBASC,FMBSBASC
            CALL      UPFMBS1
          ENDIF
          GOTO      POST9999
.
POST9999  RETURN
.
.----------------------------------------------------------------------
. Enter Transaction BAS Code
.----------------------------------------------------------------------
ETBA0000  CALL      KIBBAA00
          BRANCH    EXIT,ETBA9000,ETBA9999
.
ETBA9000  MOVE      IBBABASC,FMBSBASC
          GOTO      ETBA9999
.
ETBA9999  RETURN
.
.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       APSMASIO/INC
          INC       FMSAMAIO/INC
          INC       FMSBASIO/INC
          INC       FMSCSAIO/INC
          INC       FMSDISIO/INC
          INC       FMSLMAIO/INC
          INC       FMSLMAKY    
          INC       FMSLMCIO/INC
          INC       FMSLMCKY    
          INC       FMSRESIO/INC
          INC       FMSTRNIO/INC
          INC       IBABASIO/INC
          INC       IBABASKY    
.
          INC       STDGENCD
.

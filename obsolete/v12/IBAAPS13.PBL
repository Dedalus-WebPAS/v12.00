.-------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.00.00"
.-------------------------------------------------------
. V9.02.00  03.05.2002  Glenn Saunders
.           Export to new release i.e. v9.02 from vf.09
.-------------------------------------------------------
. VF.01.01  30.10.2000 Sandra Barcham
.           Recompiled for IBACODIO & IBAPRNIO
.-------------------------------------------------------
. VF.00.02  05.01.2000 Charles Handaya
.           Recompiled for APSMASIO change
.           17.11.1999 Sandra Barcham
.           Allow Cancelled direct debits
.           srf 635048
. VF.00.01  02.09.1999 Sandra Barcham
.           Add in Creditor Keyword Search
.           srf 631485
.-------------------------------------------------------
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBAAPS13
.   Function      :   Modify Invoices                         
.   Generated  On :   13/12/2005
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       APSBCHDF    
          INC       APSBMFFD/INC
          INC       APSIMSFD/INC
          INC       APSINPFD/INC
          INC       APSMASFD/INC
          INC       APSMXRFD/INC
          INC       APSNSCFD/INC
          INC       APSPPDFD/INC
          INC       APSTMPDF    
          INC       FMSAMAFD/INC
          INC       FMSCAFFD/INC
          INC       FMSCSAFD/INC
          INC       FMSLMAFD/INC
          INC       FMSLMCDF    
          INC       FMSLMCFD/INC
          INC       FMSTDSFD/INC
          INC       IBAPRNFD/INC
.=========================
.Local Variable Definition
.-------------------------
FLAGGST   FORM      1 * Scr 01 Fld     5
SAVDOC    DIM      15 * Scr 01 Fld    28
SAVBCH    DIM       5 * Scr 01 Fld    29
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBAAPS13"
PRGNAM    INIT      "Modify Invoices                         "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          MOVE      PORT,PARENTID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      SC01L000
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          MOVE      "   51",AUDTSECT
          MOVE      " 48",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening apsaudma";
            OPEN      APSAUDMA,"apsaudma"
          ENDIF
          DISPLAY   *P56:24,"Opening apsbmfaf";
          OPEN      APSBMFA1,"apsbmfaf"
          DISPLAY   *P56:24,"Opening apsbmfaf";
          OPEN      APSBMFA2,"apsbmfaf"
          DISPLAY   *P56:24,"Opening apsbmfaf";
          OPEN      APSBMFA3,"apsbmfaf"
          DISPLAY   *P56:24,"Opening apsimsaf";
          OPEN      APSIMSA1,"apsimsaf"
          DISPLAY   *P56:24,"Opening apsimsaf";
          OPEN      APSIMSA2,"apsimsaf"
          DISPLAY   *P56:24,"Opening apsimsaf";
          OPEN      APSIMSA3,"apsimsaf"
          DISPLAY   *P56:24,"Opening apsimsaf";
          OPEN      APSIMSA4,"apsimsaf"
          DISPLAY   *P56:24,"Opening apsimsaf";
          OPEN      APSIMSA5,"apsimsaf"
          DISPLAY   *P56:24,"Opening apsimsaf";
          OPEN      APSIMSA6,"apsimsaf"
          DISPLAY   *P56:24,"Opening apsinpaf";
          OPEN      APSINPA1,"apsinpaf"
          DISPLAY   *P56:24,"Opening apsinpaf";
          OPEN      APSINPA2,"apsinpaf"
          DISPLAY   *P56:24,"Opening apsmasaf";
          OPEN      APSMASA1,"apsmasaf"
          DISPLAY   *P56:24,"Opening apsmasaf";
          OPEN      APSMASA2,"apsmasaf"
          DISPLAY   *P56:24,"Opening apsmasaf";
          OPEN      APSMASA3,"apsmasaf"
          DISPLAY   *P56:24,"Opening apsmxraf";
          OPEN      APSMXRA1,"apsmxraf"
          DISPLAY   *P56:24,"Opening apsmxraf";
          OPEN      APSMXRA2,"apsmxraf"
          DISPLAY   *P56:24,"Opening apsnscaf";
          OPEN      APSNSCA1,"apsnscaf"
          DISPLAY   *P56:24,"Opening apsnscaf";
          OPEN      APSNSCA2,"apsnscaf"
          DISPLAY   *P56:24,"Opening apsppdaf";
          OPEN      APSPPDA1,"apsppdaf"
          DISPLAY   *P56:24,"Opening fmsamaaf";
          OPEN      FMSAMAA1,"fmsamaaf"
          DISPLAY   *P56:24,"Opening fmsamaaf";
          OPEN      FMSAMAA2,"fmsamaaf"
          DISPLAY   *P56:24,"Opening fmsamaaf";
          OPEN      FMSAMAA3,"fmsamaaf"
          DISPLAY   *P56:24,"Opening fmsamaaf";
          OPEN      FMSAMAA4,"fmsamaaf"
          MOVE      "   51",AUDTSECT
          MOVE      " 43",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening fmsaudam";
            OPEN      FMSAUDAM,"fmsaudam"
          ENDIF
          MOVE      "   51",AUDTSECT
          MOVE      " 46",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening fmsaudla";
            OPEN      FMSAUDLA,"fmsaudla"
          ENDIF
          DISPLAY   *P56:24,"Opening fmscafaf";
          OPEN      FMSCAFA1,"fmscafaf"
          DISPLAY   *P56:24,"Opening fmscafaf";
          OPEN      FMSCAFA2,"fmscafaf"
          DISPLAY   *P56:24,"Opening fmscsaaf";
          OPEN      FMSCSAA1,"fmscsaaf"
          DISPLAY   *P56:24,"Opening fmslmaaf";
          OPEN      FMSLMAA1,"fmslmaaf"
          DISPLAY   *P56:24,"Opening fmslmcaf";
          OPEN      FMSLMCA1,"fmslmcaf"
          DISPLAY   *P56:24,"Opening  fmstdsaf           ";
          OPEN      FMSTDSA1,"fmstdsaf"          
          DISPLAY   *P56:24,"Opening  ihapassf           ";
          OPEN      IHAPASS1,"ihapassf"          
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "01",SCRID
          IF         @EQUAL
            CALL       PS01L000   * Invoice Header                     
          ENDIF
          RETURN
.--------------------------------
. Screen - Invoice Header                     
.--------------------------------
SC01L000
SC01L100
          MOVE      "01",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC01L200
          CALL      CF01L000 * Clear Fields
SC01L300
          CALL      KY01L000 * Enter Key Fields
          BRANCH    EXIT,SC01L999,SC01L999
SC01L400
          CALL      WP01L000 * Load any WP Details
SC01L500
          CALL      LM01L000 * Load any Batch Details
SC01L600
          CALL      DF01L000 * Display Fields
SC01L700
          CALL      SF01L000 * Select Fields
          BRANCH    EXIT,SC01L100,SC01L100,SC01L200
SC01L800
SC01L900
SC01L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Invoice Header                     
.-------------------------------------------------------
CF01L000  COMPARE   ZERO,ACCEPT
              GOTO      CF01L999 IF EQUAL
          MOVE      ZERO,FLAGGST 
          MOVE      SP70,APIMCRD 
          MOVE      SP70,APMACN1 
          MOVE      SP70,APMACN2 
          MOVE      SP70,APMACA1 
          MOVE      SP70,APMACA2 
          MOVE      SP70,APMACA3 
          MOVE      SP70,APMACPC 
          MOVE      SP70,APMACTEL
          MOVE      SP70,APMACFAX
          MOVE      SP70,APMACON 
          MOVE      SP70,APIMREF 
          MOVE      SP70,APIMIDT 
          MOVE      SP70,APIMPDT 
          MOVE      SP70,APIMTDT 
          MOVE      SP70,APIMTER 
          MOVE      SP70,APPPDES 
          MOVE      ZERO,APIMTOT 
          MOVE      ZERO,APIMDIS 
          MOVE      ZERO,APIMGST 
          MOVE      SP70,APIMCM1 
          MOVE      SP70,APIMCM2 
          MOVE      SP70,SAVDOC  
          MOVE      SP70,SAVBCH  
          MOVE      SP70,APIMICM 
CF01L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Invoice Header                     
.--------------------------------------------------------
KY01L000
.
KY01L110
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,APMACN1 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    8",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,APMACN2 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    9",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,APMACA1 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   10",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,APMACA2 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   11",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,APMACA3 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   12",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,APMACPC 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   13",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,APMACTEL
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   14",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,APMACFAX
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   16",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,APMACON 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          MOVE      "    6",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      KAPMA000
          BRANCH    EXIT,KY01L900,KY01L900
          MOVE      ZERO,ACCEPT
          MOVE      APIMCRD,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      APMACN1,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    8",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      APMACN2,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    9",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      APMACA1,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   10",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      APMACA2,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   11",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      APMACA3,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   12",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      APMACPC,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   13",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      APMACTEL,VAR     
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   14",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      APMACFAX,VAR     
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   16",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      APMACON,VAR      
            CALL      DISPITEM
          ENDIF
.
KY01L120
          MOVE      "   17",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "2",CKEYTYP
          CALL      KAPIM000
          BRANCH    EXIT,KY01L110,KY01L900
          MOVE      OVRCD,ACCEPT
          MOVE      APIMREF,VAR      
          CALL      DISPITEM
.
KY01L130
          MOVE      "   28",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      KDOCR000
          BRANCH    EXIT,KY01L120,KY01L900
          MOVE      ZERO,ACCEPT
          MOVE      SAVDOC,VAR       
          CALL      DISPITEM
.
KY01L140
.
.
          MOVE      "   18",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,APIMIDT 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   21",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,APIMTER 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   23",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,APIMTOT 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   24",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,APIMDIS 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   25",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,APIMGST 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          MOVE      "   29",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      KBTCH000
          BRANCH    EXIT,KY01L130,KY01L900
          MOVE      ZERO,ACCEPT
          MOVE      SAVBCH,VAR       
          CALL      DISPITEM
.
.
          MOVE      "   18",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            UNPACK    APIMIDT,CCENT,CYEAR,CMON,CDAY           
            CALL      PACDATE
            MOVE      CPCDATE,VAR
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   21",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      APIMTER,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   23",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      APIMTOT,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   24",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      APIMDIS,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   25",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      APIMGST,VAR      
            CALL      DISPITEM
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      KY01L999
.
KY01L900  MOVE      ONE,EXIT
KY01L999  RETURN
.---------------------------------------------------------
. Load WP files for : Invoice Header                     
.---------------------------------------------------------
WP01L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Invoice Header                     
.---------------------------------------------------------
LM01L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Invoice Header                     
.---------------------------------------------------------
DF01L000
          BRANCH   ACCEPT,DF01L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF01L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF01L900
          MATCH    PRGID,SCPSPID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF01L010 IF NOT EQUAL
.
          CALL     PS01L000 * Display Field
          GOTO     DF01L010
DF01L900
DF01L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Invoice Header                     
.---------------------------------------------------------
PS01L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS01L999,PS01L999,PS01L999,PS01L999:
                            PS01L101,PS01L999,PS01L102,PS01L103:
                            PS01L104,PS01L105,PS01L106,PS01L107:
                            PS01L108,PS01L109,PS01L999,PS01L110:
                            PS01L999,PS01L111,PS01L112,PS01L113:
                            PS01L114,PS01L115,PS01L116,PS01L117:
                            PS01L118,PS01L119,PS01L120,PS01L999:
                            PS01L999,PS01L999,PS01L999,PS01L999:
                           PS01L999,PS01L999,PS01L999,PS01L999:
                           PS01L121
          GOTO     PS01L999
.
PS01L101
          MOVE      FLAGGST,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L102
          MOVE      APMACN1,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L103
          MOVE      APMACN2,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L104
          MOVE      APMACA1,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L105
          MOVE      APMACA2,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L106
          MOVE      APMACA3,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L107
          MOVE      APMACPC,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L108
          MOVE      APMACTEL,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L109
          MOVE      APMACFAX,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L110
          MOVE      APMACON,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L111
          UNPACK    APIMIDT,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L112
          UNPACK    APIMPDT,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L113
          UNPACK    APIMTDT,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L114
          MOVE      APIMTER,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L115
          MOVE      APPPDES,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L116
          MOVE      APIMTOT,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L117
          MOVE      APIMDIS,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L118
          MOVE      APIMGST,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L119
          MOVE      APIMCM1,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L120
          MOVE      APIMCM2,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L121
          MOVE      APIMICM,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
PS01L999
          RETURN
.---------------------------------------------------------
. Selections for : Invoice Header                     
.---------------------------------------------------------
SF01L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF01L001  BRANCH   ACCEPT,SF01L020
.
SF01L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L006,SF01L101,SF01L006,SF01L102:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L103,SF01L104:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L105,SF01L106,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                           SF01L006,SF01L006,SF01L006,SF01L006:
                           SF01L107
SF01L006  BEEP
          GOTO     SF01L005
SF01L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF01L090
          MATCH    PRGID,SCSLPID
          GOTO     SF01L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF01L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L103,SF01L104:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L105,SF01L106,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                           SF01L020,SF01L020,SF01L020,SF01L020:
                           SF01L107
          GOTO     SF01L020
SF01L090  MOVE     ZERO,ACCEPT
          GOTO     SF01L001
.
SF01L101
          MOVE      ONE,EXIT
          GOTO      SF01L999
.
SF01L102
          CALL      WAPIM000
          MOVE      ONE,EXIT
          GOTO      SF01L999
.
SF01L103
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      EPYDT000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF01L103
            ENDIF
            BRANCH    EXIT,SF01L103,SF01L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF01L990 IF EQUAL
          ENDIF
          UNPACK    APIMPDT,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     SF01L001
.
SF01L104
          CALL     SELECTED
          CALL      KEYDATE
          PACK      APIMTDT,CCENT,CYEAR,CMON,CDAY           
          UNPACK    APIMTDT,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     SF01L001
.
SF01L105
          CALL     SELECTED
          STRIP     APIMCM1 
          SFORMAT   VAR,SCPSLEN
          MOVE      APIMCM1,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,APIMCM1 
          SFORMAT   VAR,127
          ENDSET    APIMCM1 
          APPEND    SP70,APIMCM1 
          RESET     APIMCM1 
          CMATCH    EXITCHAR,APIMCM1 
          GOTO      SF01L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,APIMCM1 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF01L105
            ENDIF
          ENDIF
          MOVE      APIMCM1,VAR      
          CALL      DISPITEM
          GOTO     SF01L001
.
SF01L106
          CALL     SELECTED
          STRIP     APIMCM2 
          SFORMAT   VAR,SCPSLEN
          MOVE      APIMCM2,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,APIMCM2 
          SFORMAT   VAR,127
          ENDSET    APIMCM2 
          APPEND    SP70,APIMCM2 
          RESET     APIMCM2 
          CMATCH    EXITCHAR,APIMCM2 
          GOTO      SF01L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,APIMCM2 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF01L106
            ENDIF
          ENDIF
          MOVE      APIMCM2,VAR      
          CALL      DISPITEM
          GOTO     SF01L001
.
SF01L107
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KICM0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF01L107
            ENDIF
            BRANCH    EXIT,SF01L107,SF01L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF01L990 IF EQUAL
          ENDIF
          MOVE      APIMICM,VAR      
          CALL      DISPITEM
          GOTO     SF01L001
SF01L990  MOVE      ONE,EXIT * Exit Char Restart
SF01L999  RETURN
.@@@@@ Function Restart Point @@@@@
.----------------------------------------------------------------------
.     INVOICE ENTRY
.     -------------
. Save Header Details and Input Details
.----------------------------------------------------------------------
WAPIM000
          CALL     UPAPIM3
.
WAPIM999  RETURN
.-------------------------------------------------------------------------
. Enter Creditor Code
. Code to Default to Last Entered Commented Out as per S.A.H.B. 18/05/92
.-------------------------------------------------------------------------
KAPMA000
.          ENDSET   APMACRD
.          APPEND   SP70,APMACRD
.          RESET    APMACRD
.          MATCH    SP70,APMACRD
.          IF       @EQUAL
            OPEN     APSMXRA1,"apsmxraf"
            OPEN     APSMXRA2,"apsmxraf"
            CALL     KAPMAA00
            CLOSE    APSMXRA1
            CLOSE    APSMXRA2
            LOAD     ACCEPT,EXIT,ZERO,ZERO  * clear accept if quiting screen
            BRANCH   EXIT,KAPMA999,KAPMA999
            IF       APMAHIN=1
              MOVE     "Creditor On Hold for Invoice Input - ",DISPMSG
              CALL     MESSAGE1
              MOVE     SP70,APMACRD
              GOTO     KAPMA000
            ENDIF
            MOVE     APMACRD,APIMCRD
.          ELSE
.            MOVE     APMACRD,APIMCRD
.            MOVE     APIMCRD,KEY5
.            CALL     RDAPMA1
.            IF       OVRCD=1
.              MOVE     SP70,APIMCRD
.              GOTO     KAPMA000
.            ENDIF
.            MOVE     ZERO,EXIT
.          ENDIF
.
KAPMA999  RETURN
.----------------------------------------------------------------------
. Enter Invoice Reference
.----------------------------------------------------------------------
KAPIM000
          MOVE      ZERO,PAIDOUT
          MOVE      APMACRD,APIMCRD
          UNPACK    SP70,SAVREF,SAVDOC,SAVBCH
.
          CALL      KAPIMY00
          BRANCH    EXIT,KAPIM900,KAPIM900
.
          MOVE      APIMREF,SAVREF
.
.---- see if invoice exists ----
.
          PACK      KEY40,APIMCRD,APIMREF,SP70
          PACK      KEY20,APIMCRD,APIMREF,SP70
          CALL      RSAPIM3
          CALL      RKAPIM3
          BRANCH    OVRCD,KAPIM200
          PACK      KEY40,APIMCRD,APIMREF,APIMDOC,APIMBCH,SP70
          MATCH     KEY20,KEY40
          GOTO      KAPIM200 IF NOT EQUAL
.
.---- see if more than 1 doc ref for this invoice ----
.
          MOVE      APIMDOC,SAVDOC
          MOVE      APIMBCH,SAVBCH
          CALL      RKAPIM3
          BRANCH    OVRCD,KAPIM100
          PACK      KEY20,APIMCRD,APIMREF,SP70
          MATCH     KEY20,KEY40
          GOTO      KAPIM100 IF NOT EQUAL
          MOVE      SP70,SAVBCH
          MOVE      SP70,SAVDOC
.
KAPIM100
          MOVE      ZERO,APIMOUT
          UNPACK    KEY40,APIMCRD,APIMREF,APIMDOC,APIMBCH
          CALL      RDAPIM3                      * get back original record
.
          GOTO      KAPIM999
.
KAPIM200
          CLEAR     DISPMSG
          APPEND    "Invoice Doesn't Exist For This Creditor - ",DISPMSG
          CALL      MESSAGE1
          GOTO      KAPIM000
.
. Exit No Entry
.
KAPIM900  MOVE     ONE,EXIT
          MOVE     SP70,APMACRD
.
KAPIM999  RETURN
.
.----------------------------------------------------------------------
. Enter Date to Pay Invoice APIMPDT
.----------------------------------------------------------------------
EPYDT000
          MATCH     "0",APIMOUT
          IF        @EQUAL
            BEEP
            CLEAR     DISPMSG
            APPEND    "Item is Not Outstanding - ",DISPMSG
            RESET     DISPMSG
            CALL      MESSAGE1
            GOTO      EPYDT800
          ENDIF
.
          UNPACK    APIMPDT,CCENT,CYEAR,CMON,CDAY
          CALL      KEYDATE
          BRANCH    OVRCD,EPYDT000
          BRANCH    CQUEST,EPYDT000
.
          PACK      APIMPDT,CCENT,CYEAR,CMON,CDAY
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",APIMPDT
          REP       " 0",KEY8
.
          MATCH     APIMPDT,KEY8
          IF        !@LESS
            MOVE      "Date in the Past. ",DISPMSG
            CALL      MESSAGE4   * Message Continue (Y/N) EXIT=1 No
            BRANCH    EXIT,EPYDT000
            GOTO      EPYDT800
          ENDIF
.
          UNPACK    APIMPDT,KEY4,KEY2
          MOVE      KEY4,TSTCCYY1
          MOVE      KEY2,TSTMM1
.
          UNPACK    KEY8,KEY4,KEY2
          MOVE      KEY4,TSTCCYY2
          MOVE      KEY2,TSTMM2
          IF        TSTCCYY1-TSTCCYY2>1
            MOVE      "Date Over 1 Year. ",DISPMSG
            CALL      MESSAGE4   * Message Continue (Y/N) EXIT=1 No
            BRANCH    EXIT,EPYDT000
            GOTO      EPYDT800
          ENDIF
          IF        TSTCCYY2=TSTCCYY1
            IF        TSTMM1-TSTMM2>6
              MOVE      "Date Over 6 Months. ",DISPMSG
              CALL      MESSAGE4   * Message Continue (Y/N) EXIT=1 No
              BRANCH    EXIT,EPYDT000
              GOTO      EPYDT800
            ENDIF
          ELSE
            IF        TSTMM1-TSTMM2+12>6
              MOVE      "Date Over 6 Months. ",DISPMSG
              CALL      MESSAGE4   * Message Continue (Y/N) EXIT=1 No
              BRANCH    EXIT,EPYDT000
              GOTO      EPYDT800
            ENDIF
          ENDIF
EPYDT800
          MOVE      ZERO,EXIT
          GOTO      EPYDT999
.
EPYDT900  MOVE      TWO,EXIT
EPYDT999
          RETURN
.----------------------------------------------------------------------
. Enter Document Reference
.----------------------------------------------------------------------
KDOCR000
          MATCH     SP70,SAVDOC
          GOTO      KDOCR900 IF NOT EQUAL        * already selected
.
          MOVE      ZERO,EXIT
          UNPACK    SP70,SAVBCH
          MOVE      SAVREF,APIMDOC
          KEYIN     *PCCOL:CVERT,*V2LON,*RV,APIMDOC
          PACK      APIMDOC,APIMDOC,SP70
.
          MATCH     "?",APIMDOC
          GOTO      KDOCR010 IF NOT EQUAL
.
          CALL      HAPIMZ000
          MATCH     SP70,APIMDOC                 * nothing entered
          GOTO      KDOCR950 IF EQUAL
.
KDOCR010  PACK      SAVDOC,APIMDOC,SP70
          MATCH     EXITCHAR,SAVDOC
          GOTO      KDOCR950 IF EQUAL
          MATCH     SP70,SAVDOC
          GOTO      KDOCR950 IF EQUAL
.
.---- see if document exists ----
.
          MOVE      SAVDOC,APIMDOC
          PACK      KEY40,APMACRD,SAVREF,SAVDOC,SP70
          PACK      KEY35,APMACRD,SAVREF,SAVDOC,SP70
          CALL      RSAPIM3
          CALL      RKAPIM3
          BRANCH    OVRCD,KDOCR200
          PACK      KEY40,APIMCRD,APIMREF,APIMDOC,APIMBCH,SP70
          MATCH     KEY35,KEY40
          GOTO      KDOCR200 IF NOT EQUAL
.
.---- see if more than 1 batch for this reference ----
.
          MOVE      APIMBCH,SAVBCH
          CALL      RKAPIM3
          BRANCH    OVRCD,KDOCR100
          PACK      KEY35,APIMCRD,APIMREF,APIMDOC,SP70
          MATCH     KEY35,KEY40
          GOTO      KDOCR100 IF NOT EQUAL
          MOVE      SP70,SAVBCH
.
KDOCR100
          UNPACK    KEY40,APIMCRD,APIMREF,APIMDOC,APIMBCH
          CALL      RDAPIM3                      * get back original record
.
          GOTO      KDOCR999
.
KDOCR200
          CLEAR     DISPMSG
          APPEND    "Reference Doesn't Exist For This Invoice - ",DISPMSG
          CALL      MESSAGE1
          MOVE      SP70,SAVDOC
          GOTO      KDOCR000
.
. Exit No Entry
.
KDOCR900  MOVE     ZERO,EXIT
          GOTO     KDOCR999
.
KDOCR950  MOVE     ONE,EXIT
          MOVE     SP70,SAVREF
          GOTO     KDOCR999
.
KDOCR999  RETURN
.
.----------------------------------------------------------------------
. Enter Batch Reference
.----------------------------------------------------------------------
KBTCH000
          MATCH     SP70,SAVBCH
          GOTO      KBTCH900 IF NOT EQUAL        * already selected
.
          CALL      KAPBMA00                     * keyin batch no.
          BRANCH    EXIT,KBTCH950,KBTCH950
.
.---- see if Batch exists ----
.
          MOVE      APBMBCH,SAVBCH
          PACK      KEY40,APMACRD,SAVREF,SAVDOC,SAVBCH,SP70
          CALL      RDAPIM3
          BRANCH    OVRCD,KBTCH200
.
          GOTO      KBTCH900
.
KBTCH200
          CLEAR     DISPMSG
          APPEND    "Batch Doesn't Exist For This Document - ",DISPMSG
          CALL      MESSAGE1
          MOVE      SP70,SAVBCH
          GOTO      KBTCH000
.
.
KBTCH900
          PACK      KEY40,APMACRD,SAVREF,SAVDOC,SAVBCH,SP70
          UNPACK    KEY40,APIMCRD,APIMREF,APIMDOC,APIMBCH
          CALL      RDAPIM3                      * get record
.
          MOVE      APIMTER,KEY2
          CALL      RDAPPP1
          IF        OVRCD=1
            MOVE      ZERO,OVRCD
            MOVE      SP70,APPPDES
          ENDIF
.
          MOVE     ZERO,EXIT
          GOTO     KBTCH999
.
KBTCH950  MOVE     ONE,EXIT
          MOVE     SP70,SAVDOC
          GOTO     KBTCH999
.
KBTCH999  RETURN
.
.--------------------------------------------------
. Keyin Invoice Description
.--------------------------------------------------
KICM0000  IF        ACCEPT=1
            MOVE      SP70,APIMICM
          ENDIF
KICM0005
          KEYIN     *PCCOL:CVERT,*RV,*V2LON,APIMICM
          MOVE      ZERO,EXIT
.
          ENDSET    APIMICM
          APPEND    SP70,APIMICM
          RESET     APIMICM
.
          MATCH     SP70,APIMICM
          GOTO      KICM0099 IF EQUAL
.
          CMATCH    QUEST,APIMICM
          GOTO      KICM0010 IF NOT EQUAL
.
          MOVE      CCITEM,SCCITEM
          CALL      HFMTDA00
          MOVE      SCCITEM,CCITEM
.
          MOVE      FMTDCODE,APIMICM
          ENDSET    APIMICM
          APPEND    SP70,APIMICM
          RESET     APIMICM
.
          MATCH     SP70,APIMICM
          GOTO      KICM0005 IF EQUAL
.
          DISPLAY   *PCCOL:CVERT,*V2LON,APIMICM
KICM0010
          MOVE      ZERO,EXIT
          PACK      KEY4,APIMICM
          CALL      RDFMTD1
          BRANCH    OVRCD,KICM0099
          MOVE      FMTDDESC,APIMICM
          GOTO      KICM0005
.
KICM0099  RETURN
.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       APSBMFIO/INC
          INC       APSBMFKY    
          INC       APSCKIKY    
          INC       APSIMSIO/INC
          INC       APSIMSKY    
          INC       APSINPIO/INC
          INC       APSMASIO/INC
          INC       APSMASKY    
          INC       APSMXRIO/INC
          INC       APSNSCIO/INC
          INC       APSPPDIO/INC
          INC       FMSAMAIO/INC
          INC       FMSCAFIO/INC
          INC       FMSCSAIO/INC
          INC       FMSLMAIO/INC
          INC       FMSLMCIO/INC
          INC       FMSLMCKY    
          INC       FMSTDSIO/INC
          INC       FMSTDSKY    
          INC       IBAPRINT    
          INC       IBAPRNIO/INC
.
          INC       STDGENCD
.

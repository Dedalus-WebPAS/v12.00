.---------------------------------------------------------------------------
.   System    :   Patient System                     
.   Include   :   PATORBKY
.   Routine   :   HPTOB100 Overnight Revenue Breaskdown
.   Return    :           
.     V9.02.01   31/10/2001  Tonii
.                Mods as to not display details if acode is empty
.-------------------------------------------------------------------------------
HPTOB100
          MOVE      ZERO,CSCRSIZ
          IF        HTOP<3
            MOVE      "10",HTOP
            MOVE      "22",HBOT
            MOVE      "10",HLEF
            MOVE      "70",HRIG
          ENDIF
HPTOB104
          CALL      GSCRN000
          BRANCH    EXIT,HPTOB199
          MOVE      STDCOL00,STDCOL01
          ADD       " 5",STDCOL01
HPTOB108
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          MOVE      SP70,PTOBCSCD
          MOVE      CODEFH,TCODE
          MOVE      Z3,ACODE
          PACK      KEY5,TCODE,ACODE
          PACK      SAVKEY80,TCODE,ACODE
          SETLPTR   SAVKEY80,12                                                 
          CALL      RDSCODE1
.         CALL      RSPTOVB1
HPTOB110
          CALL      RDKCODE1
          BRANCH    OVRCD,HPTOB115
          MATCH     SP3,ACODE
          GOTO      HPTOB110 IF EQUAL
.
          PACK      KEY5,TCODE,ACODE
          MATCH     SAVKEY80,KEY5
          GOTO      HPTOB115 IF EQUAL
.
          MATCH     TCODE,CODEFI
          GOTO      HPTOB115 IF NOT EQUAL                                       
          BRANCH    CSEARCH,HPTOB112
          CALL      HPTOB160
          BRANCH    OVRCD,HPTOB110
HPTOB112
          ADD       ONE,XITEMNO
          ADD       ONE,STDROW
          STORE     KEY5,XITEMNO,ST1,ST2,ST3,ST4,ST5:                          
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          DISPLAY   *PSTDCOL00:STDROW,SP1,*V2LON,XITEMNO,DOT:
                    SP2,ACODE,SP6,TDESC
          COMPARE   MAXITEM,XITEMNO
          GOTO      HPTOB110 IF NOT EQUAL
HPTOB115
          UNPACK    SAVKEY80,PTOBCODE,PTOBFUND,PTOBTBLT,PTOBCSCD,PTOBBRCD       
          MOVE      ONE,DITEM
          MOVE      MINITEM,DROW
          ADD       ONE,DROW
          DISPLAY   *PSTDCOL00:DROW,*V2LON,*HON,SP1,DITEM,DOT
          CLIP
          FLUSH     HLEF,HTOP,HRIG,HBOT
.
HPTOB120
          CALL      HSCRI000
          BRANCH    EXIT,HPTOB130,HPTOB135,HPTOB140,HPTOB145,HPTOB104:
                              HPTOB191,HPTOB150
          GOTO      HPTOB192
HPTOB130
          CALL      RDKCODE1
          BRANCH    OVRCD,HPTOB185
          PACK      KEY5,TCODE,ACODE
          MATCH     SAVKEY80,KEY5
          GOTO      HPTOB185 IF EQUAL                                       
          CALL      RDPCODE1
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HPTOB110
HPTOB135
          MOVE      ST1,KEY5 
          CALL      RDCODE1 
          CALL      RDPCODE1 
          BRANCH    OVRCD,HPTOB185
          PACK      KEY5,TCODE,ACODE
          MATCH     CODEFI,TCODE
          GOTO      HPTOB185 IF NOT EQUAL
.
          MATCH     SAVKEY80,KEY5                                               
          GOTO      HPTOB185 IF EQUAL                                       
          MATCH     SP70,PTOBCSCD                                               
          GOTO      HPTOB185 IF EQUAL                                           
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
HPTOB136
          CALL      RDPCODE1
          BRANCH    OVRCD,HPTOB137
          PACK      KEY5,TCODE,ACODE
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HPTOB136 IF NOT EQUAL
HPTOB137
          MOVE      ZERO,XITEMNO
          GOTO      HPTOB110
HPTOB140
          MOVE      ST1,KEY24
          CALL      RDCODE1 
          CALL      RDPCODE1
          BRANCH    OVRCD,HPTOB185
          PACK      KEY5,TCODE,ACODE
          MATCH     SAVKEY80,KEY5                                               
          GOTO      HPTOB185 IF NOT EQUAL                                       
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HPTOB108
HPTOB145
          CALL      RDKCODE1
          BRANCH    OVRCD,HPTOB185
          PACK      KEY5,TCODE,ACODE
          MATCH     SAVKEY80,KEY5                                               
          GOTO      HPTOB185 IF NOT EQUAL                                       
          SUSPEND
          CLIP      1,1,CRIG,24
.
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      ZERO,XITEMNO
          PACK      KEY24,SAVKEY80,Z70                                          
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
          CALL      RSPTOVB1
HPTOB146
          CALL      RDPCODE1
          BRANCH    OVRCD,HPTOB147
          PACK      KEY5,TCODE,ACODE
          MATCH     SAVKEY80,KEY5                                               
          GOTO      HPTOB147 IF NOT EQUAL                                       
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HPTOB146 IF NOT EQUAL
HPTOB147
          MOVE      ZERO,XITEMNO
          GOTO      HPTOB110
HPTOB150  COMPARE   ZERO,CSEARCH
          GOTO      HPTOB155 IF EQUAL
          MOVE      ZERO,CSEARCH
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          ADD       ONE,STDROW
          UNPACK    SP70,SCHFLD01,SCHFLD02,SCHFLD03,SCHFLD04,SCHFLD05
          UNPACK    SP70,SCHFLD06,SCHFLD07,SCHFLD08,SCHFLD09,SCHFLD10
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          DISPLAY   *PSTDCOL00:STDROW,*V2LON,*HON,"Sch"
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HPTOB108
HPTOB155  MOVE      ONE,CSEARCH
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HPTOB108
HPTOB160  MOVE      ZERO,OVRCD
HPTOB161
HPTOB162
HPTOB163
HPTOB164
HPTOB165
HPTOB166
HPTOB167
HPTOB168
HPTOB169
HPTOB170
          GOTO      HPTOB175
HPTOB172  MOVE      ONE,OVRCD
HPTOB175  RETURN
HPTOB185
          LOAD      KEY5,XITEMNO,ST1,ST2,ST3,ST4,ST5:                          
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY5,TCODE,ACODE
          CALL      RDCODE1 
HPTOB190
          UNPACK    SAVKEY80,TCODE,ACODE
          BEEP
          GOTO      HPTOB120
HPTOB191
          MOVE      ZERO,PTOBAMNT
          MOVE      SP70,KEY24
          MOVE      SP70,PTOBCSCD
          GOTO      HPTOB196
HPTOB192
          MOVE      SP70,KEY24
          MOVE      SP70,PTOBCSCD
          LOAD      KEY5,CCITEM,ST1,ST2,ST3,ST4,ST5:                           
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY5,TCODE,ACODE
HPTOB196
          PUTSCR    CSSCRNUM,HLEF,HTOP,HRIG,HBOT
          CALL      FRESCR00
          MOVE      ZERO,HTOP
          MOVE      ZERO,HLEF
          MOVE      ZERO,HBOT
          MOVE      ZERO,HRIG
HPTOB199
          RETURN
.---------------------------------------------------------------------------
.   System    :   Patient System                     
.   Include   :   PATOVBKY
.   Routine   :   KPTOB100 Keyin Overnight Rev. Brkdown
.   Parameter :   CKEYTYP 0 = Keyin , 1 = Accept, 2 = Either, Default CKYIDEF3
.   Return    :   EXIT = 1 null entry, 2 EXITCHAR entered
.-------------------------------------------------------------------------------
KPTOB100  TOPIC     "PTOBBRCD"
          MATCH     SP3,CKYIDEF3                 * Default value
          GOTO      KPTOB105 IF NOT EQUAL
.
          MOVE      UNDLN70,PTOBBRCD
          KEYIN     *PCCOL:CVERT,*DV,PTOBBRCD:
                    *PCCOL:CVERT,*V2LON,PTOBBRCD:                               
                    *PCCOL:CVERT,*DV,PTOBBRCD
          GOTO      KPTOB108
.
KPTOB105  MOVE      CKYIDEF3,PTOBBRCD
          KEYIN     *PCCOL:CVERT,*DV,PTOBBRCD:
                    *PCCOL:CVERT,*V2LON,*RV,PTOBBRCD:
                    *PCCOL:CVERT,*DV,PTOBBRCD
.
KPTOB108  ENDSET    PTOBBRCD
          APPEND    SP70,PTOBBRCD
          RESET     PTOBBRCD
.
          PACK      KEY5,CODEFI,PTOBBRCD
.
          MATCH     SP70,PTOBBRCD
          GOTO      KPTOB190 IF EQUAL
.
          CMATCH    EXITCHAR,PTOBBRCD
          GOTO      KPTOB195 IF EQUAL
.
          CMATCH    QUEST,PTOBBRCD
          GOTO      KPTOB110 IF NOT EQUAL
.
          MOVE      CCITEM,SCCITEM
          CALL      HPTOB100
          MOVE      SCCITEM,CCITEM
.
          ENDSET    TDESC
          APPEND    SP70,TDESC     
          RESET     TDESC
.
          MATCH     SP70,TDESC
          GOTO      KPTOB100 IF EQUAL
.
KPTOB110  UNPACK    KEY5,DIM2
          MATCH     CODEFI,DIM2
          GOTO      KPTOB185 IF NOT EQUAL
.
          CALL      RDCODE1
          BRANCH    OVRCD,KPTOB180
          BRANCH    CKEYTYP,KPTOB175
.
KPTOB170  MOVE      ZERO,EXIT
          GOTO      KPTOB199
KPTOB175
          MOVE      "Overnight Rev. Brkdown Already Exist - ",DISPMSG                                  
          CALL      MESSAGE1
          GOTO      KPTOB100
KPTOB180
          MOVE      ZERO,EXIT
          BRANCH    CKEYTYP,KPTOB199,KPTOB199
          MOVE      "Overnight Rev. Brkdown Does Not Exist - ",DISPMSG                                 
          CALL      MESSAGE1
          GOTO      KPTOB100
KPTOB185
          MOVE      ZERO,EXIT
          BRANCH    CKEYTYP,KPTOB199,KPTOB199
          MOVE      "Code must be from category 'FI' - ",DISPMSG

          CALL      MESSAGE1
          GOTO      KPTOB100
KPTOB190
          MOVE      ONE,EXIT
          GOTO      KPTOB199
KPTOB195
          MOVE      TWO,EXIT
KPTOB199 TOPIC    PRGID
          RETURN

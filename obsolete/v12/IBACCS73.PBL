.---------------------------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.00.00"
.-------------------------------------------------------
. V10.03.01 08.03.2013 Sandra Barcham    281021
.           Stopped unpacking into SP70
.-------------------------------------------------------
. V9.02.00  04.07.2002  Glenn Saunders
.           Export to new release i.e. v9.02 from r5.09
.---------------------------------------------------------------------------
. V5.09.01  07/08/2001  Davin
.           Added CCEPV8A which was added to CCSEPSFD
.---------------------------------------------------------------------------
. V5.08.03  06.09.2000  Sandra Barcham
.           Changed length of stay calculation variables to 6
.           srf 647177
. V5.08.02  16/08/2000  Caleb Sharman
.           Changed Health Fund variables to be 8 chars
. V5.08.01  23.08.2000 Sandra Barcham
.           Clear CCEPV5A which was added to CCSEPSFD
.---------------------------------------------------------------------------
. V5.04.02  28.07.1996 B.G.Ackland
.           New Fields for Southern Health
. V5.04.01  11.02.1996 B.G.Ackland
.           Extend Episode file.
. V6.00.06  01.11.1993 B.G.Ackland
.           Change "Procedure" to Patient Service
. V6.00.05  13.07.1993 B.G.Ackland
.           Extend Episode file.
.---------------------------------------------------------------------------
PATMASOP  FORM      1
PATTRNOP  FORM      1
PATMISOP  FORM      1
PATDOCOP  FORM      1
PATDSCOP  FORM      1
AAEDEAOP  FORM      1
OUTSITOP  FORM      1
OUTBOBOP  FORM      1
PATVISOP  FORM      1
AAEDISOP  FORM      1
PATECOOP  FORM      1
PATECDOP  FORM      1
CCIDPTOP  FORM      1
.---------------------------------------------------------------------------
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBACCS73
.   Function      :   Load Patient Service Details            
.   Generated  On :   08/03/2013
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       CCSCALFD/INC
          INC       CCSCCIDF    
          INC       CCSEPSFD/INC
          INC       CCSGPFFD/INC
          INC       CCSHLCFD/INC
          INC       CCSPERFD/INC
          INC       CCSPFKFD/INC
          INC       CCSPKYFD/INC
          INC       CCSPSDFD/INC
          INC       CCSUPDFD/INC
          INC       PMS502FD    
.=========================
.Local Variable Definition
.-------------------------
UTILNAME  DIM      40 * Scr 01 Fld     1
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBACCS73"
PRGNAM    INIT      "Load Patient Service Details            "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          MOVE      PORT,PARENTID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      SC00L000
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          MOVE      "   64",AUDTSECT
          MOVE      " 37",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening ccsaudep";
            OPEN      CCSAUDEP,"ccsaudep"
          ENDIF
          DISPLAY   *P56:24,"Opening ccscalaf";
          OPEN      CCSCALA1,"ccscalaf"
          DISPLAY   *P56:24,"Opening ccscalaf";
          OPEN      CCSCALA2,"ccscalaf"
          DISPLAY   *P56:24,"Opening ccscalaf";
          OPEN      CCSCALA3,"ccscalaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA1,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA2,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA3,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA4,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA5,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccsgpfaf";
          OPEN      CCSGPFA1,"ccsgpfaf"
          DISPLAY   *P56:24,"Opening ccshlcaf";
          OPEN      CCSHLCA1,"ccshlcaf"
          DISPLAY   *P56:24,"Opening ccsperaf";
          OPEN      CCSPERA1,"ccsperaf"
          DISPLAY   *P56:24,"Opening ccspfkaf";
          OPEN      CCSPFKA1,"ccspfkaf"
          DISPLAY   *P56:24,"Opening ccspkyaf";
          OPEN      CCSPKYA1,"ccspkyaf"
          DISPLAY   *P56:24,"Opening ccspkyaf";
          OPEN      CCSPKYA2,"ccspkyaf"
          DISPLAY   *P56:24,"Opening ccspsdaf";
          OPEN      CCSPSDA1,"ccspsdaf"
          DISPLAY   *P56:24,"Opening ccspsdaf";
          OPEN      CCSPSDA2,"ccspsdaf"
          DISPLAY   *P56:24,"Opening ccspsdaf";
          OPEN      CCSPSDA3,"ccspsdaf"
          DISPLAY   *P56:24,"Opening ccsupdaf";
          OPEN      CCSUPDA1,"ccsupdaf"
          DISPLAY   *P56:24,"Opening ccsupdaf";
          OPEN      CCSUPDA2,"ccsupdaf"
          DISPLAY   *P56:24,"Opening ccsupdaf";
          OPEN      CCSUPDA3,"ccsupdaf"
          DISPLAY   *P56:24,"Opening ccsupdaf";
          OPEN      CCSUPDA4,"ccsupdaf"
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "00",SCRID
          IF         @EQUAL
            CALL       PS00L000   * Load Patient Service Volumes       
          ENDIF
          MATCH     "01",SCRID
          IF         @EQUAL
            CALL       PS01L000   * Load Patient Services File         
          ENDIF
          MATCH     "02",SCRID
          IF         @EQUAL
            CALL       PS02L000   * Modify Errors                      
          ENDIF
          RETURN
.--------------------------------
. Screen - Load Patient Service Volumes       
.--------------------------------
SC00L000
SC00L100
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC00L200
          CALL      CF00L000 * Clear Fields
SC00L300
          CALL      KY00L000 * Enter Key Fields
          BRANCH    EXIT,SC00L999,SC00L999
SC00L400
          CALL      WP00L000 * Load any WP Details
SC00L500
          CALL      LM00L000 * Load any Batch Details
SC00L600
          CALL      DF00L000 * Display Fields
SC00L700
          CALL      SF00L000 * Select Fields
          BRANCH    EXIT,SC00L100,SC00L100,SC00L200
SC00L800
SC00L900
SC00L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Load Patient Service Volumes       
.-------------------------------------------------------
CF00L000
CF00L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Load Patient Service Volumes       
.--------------------------------------------------------
KY00L000
          MOVE      ZERO,EXIT
          GOTO      KY00L999
.
KY00L900  MOVE      ONE,EXIT
KY00L999  RETURN
.---------------------------------------------------------
. Load WP files for : Load Patient Service Volumes       
.---------------------------------------------------------
WP00L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Load Patient Service Volumes       
.---------------------------------------------------------
LM00L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Load Patient Service Volumes       
.---------------------------------------------------------
DF00L000
          BRANCH   ACCEPT,DF00L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF00L900
          MATCH    PRGID,SCPSPID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF00L010 IF NOT EQUAL
.
          CALL     PS00L000 * Display Field
          GOTO     DF00L010
DF00L900
DF00L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Load Patient Service Volumes       
.---------------------------------------------------------
PS00L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS00L999,PS00L999,PS00L999,PS00L999:
                            PS00L999,PS00L999,PS00L999,PS00L999
          GOTO     PS00L999
PS00L999
          RETURN
.---------------------------------------------------------
. Selections for : Load Patient Service Volumes       
.---------------------------------------------------------
SF00L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF00L001  BRANCH   ACCEPT,SF00L020
.
SF00L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L006,SF00L101,SF00L102,SF00L103:
                            SF00L104,SF00L105,SF00L106,SF00L107
SF00L006  BEEP
          GOTO     SF00L005
SF00L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF00L090
          MATCH    PRGID,SCSLPID
          GOTO     SF00L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF00L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020
          GOTO     SF00L020
SF00L090  MOVE     ZERO,ACCEPT
          GOTO     SF00L001
.
SF00L101
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L102
          CALL      SC01L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L103
          CALL      PERR0000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L104
          CALL      PPRO0000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L105
          CALL      SC02L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L106
          CALL      ELOD0000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L107
          CALL      DELR0000
          MOVE      ONE,EXIT
          GOTO      SF00L999
SF00L990  MOVE      ONE,EXIT * Exit Char Restart
SF00L999  RETURN
.--------------------------------
. Screen - Load Patient Services File         
.--------------------------------
SC01L000
SC01L100
          MOVE      "01",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "   10",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC01L200
          CALL      CF01L000 * Clear Fields
          CALL      MVACCEPT
SC01L300
          CALL      KY01L000 * Enter Key Fields
          BRANCH    EXIT,SC01L999,SC01L999
SC01L400
          CALL      WP01L000 * Load any WP Details
SC01L500
          CALL      LM01L000 * Load any Batch Details
SC01L600
          CALL      DF01L000 * Display Fields
SC01L700
          CALL      SF01L000 * Select Fields
          BRANCH    EXIT,SC01L100,SC01L100,SC01L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC01L800
SC01L900
SC01L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Load Patient Services File         
.-------------------------------------------------------
CF01L000
          MOVE      SP70,UTILNAME
CF01L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Load Patient Services File         
.--------------------------------------------------------
KY01L000
          MOVE      ZERO,EXIT
          GOTO      KY01L999
.
KY01L900  MOVE      ONE,EXIT
KY01L999  RETURN
.---------------------------------------------------------
. Load WP files for : Load Patient Services File         
.---------------------------------------------------------
WP01L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Load Patient Services File         
.---------------------------------------------------------
LM01L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Load Patient Services File         
.---------------------------------------------------------
DF01L000
          BRANCH   ACCEPT,DF01L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF01L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF01L900
          MATCH    PRGID,SCPSPID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF01L010 IF NOT EQUAL
.
          CALL     PS01L000 * Display Field
          GOTO     DF01L010
DF01L900
DF01L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Load Patient Services File         
.---------------------------------------------------------
PS01L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS01L101,PS01L999,PS01L999,PS01L999:
                           PS01L999,PS01L999,PS01L999,PS01L999:
                           PS01L999,PS01L999,PS01L999,PS01L999
          GOTO     PS01L999
.
PS01L101
          MOVE      UTILNAME,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
PS01L999
          RETURN
.---------------------------------------------------------
. Selections for : Load Patient Services File         
.---------------------------------------------------------
SF01L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF01L001  BRANCH   ACCEPT,SF01L020
.
SF01L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L101,SF01L006,SF01L006,SF01L006:
                           SF01L006,SF01L006,SF01L006,SF01L006:
                           SF01L006,SF01L006,SF01L102,SF01L103
SF01L006  BEEP
          GOTO     SF01L005
SF01L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF01L090
          MATCH    PRGID,SCSLPID
          GOTO     SF01L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF01L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L101,SF01L020,SF01L020,SF01L020:
                           SF01L020,SF01L020,SF01L020,SF01L020:
                           SF01L020,SF01L020,SF01L020,SF01L020
          GOTO     SF01L020
SF01L090  MOVE     ZERO,ACCEPT
          GOTO     SF01L001
.
SF01L101
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KUTL0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF01L101
            ENDIF
            BRANCH    EXIT,SF01L101,SF01L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF01L990 IF EQUAL
          ENDIF
          MOVE      UTILNAME,VAR     
          CALL      DISPITEM
          GOTO     SF01L001
.
SF01L102
          MOVE      ZERO,EXIT
          GOTO      SF01L999
.
SF01L103
          CALL      LOAD0000
          MOVE      ZERO,EXIT
          GOTO      SF01L999
SF01L990  MOVE      FOUR,EXIT * Exit Char Exit
SF01L999  RETURN
.--------------------------------
. Screen - Modify Errors                      
.--------------------------------
SC02L000
SC02L100
          MOVE      "02",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "   16",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC02L200
          CALL      CF02L000 * Clear Fields
SC02L300
          CALL      KY02L000 * Enter Key Fields
          BRANCH    EXIT,SC02L999,SC02L999
SC02L400
          CALL      WP02L000 * Load any WP Details
SC02L500
          CALL      LM02L000 * Load any Batch Details
SC02L600
          CALL      DF02L000 * Display Fields
SC02L700
          CALL      SF02L000 * Select Fields
          BRANCH    EXIT,SC02L100,SC02L100,SC02L200
SC02L800
SC02L900
SC02L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Modify Errors                      
.-------------------------------------------------------
CF02L000
          MOVE      SP70,CCPERUN 
          MOVE      SP70,CCPEREC 
          MOVE      SP70,CCPEFKY 
          MOVE      SP70,CCPEENC 
          MOVE      SP70,CCPEURN 
          MOVE      SP70,CCPEDAT 
          MOVE      SP70,CCPETIM 
          MOVE      ZERO,CCPEQTY 
          MOVE      ZERO,CCPECHG 
          MOVE      SP70,CCPECL1 
          MOVE      SP70,CCPECL2 
          MOVE      SP70,CCPECL3 
          MOVE      SP70,CCPECL4 
          MOVE      SP70,CCPECL5 
CF02L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Modify Errors                      
.--------------------------------------------------------
KY02L000
.
KY02L110
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      ERUNN000
          BRANCH    EXIT,KY02L900,KY02L900
          MOVE      ZERO,ACCEPT
          MOVE      CCPERUN,VAR      
          CALL      DISPITEM
.
KY02L120
          MOVE      "    2",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      ERECN000
          BRANCH    EXIT,KY02L110,KY02L900
          MOVE      ZERO,ACCEPT
          MOVE      CCPEREC,VAR      
          CALL      DISPITEM
          MOVE      ZERO,EXIT
          GOTO      KY02L999
.
KY02L900  MOVE      ONE,EXIT
KY02L999  RETURN
.---------------------------------------------------------
. Load WP files for : Modify Errors                      
.---------------------------------------------------------
WP02L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Modify Errors                      
.---------------------------------------------------------
LM02L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Modify Errors                      
.---------------------------------------------------------
DF02L000
          BRANCH   ACCEPT,DF02L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF02L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF02L900
          MATCH    PRGID,SCPSPID
          GOTO     DF02L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF02L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF02L010 IF NOT EQUAL
.
          CALL     PS02L000 * Display Field
          GOTO     DF02L010
DF02L900
DF02L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Modify Errors                      
.---------------------------------------------------------
PS02L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS02L999,PS02L999,PS02L101,PS02L102:
                            PS02L103,PS02L104,PS02L105,PS02L106:
                            PS02L107,PS02L108,PS02L109,PS02L110:
                            PS02L111,PS02L112,PS02L113,PS02L999:
                            PS02L999,PS02L999,PS02L999
          GOTO     PS02L999
.
PS02L101
          MOVE      CCPEDES,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L102
          MOVE      CCPEFKY,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L103
          MOVE      CCPEENC,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L104
          MOVE      CCPEURN,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L105
          UNPACK    CCPEDAT,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L106
          MOVE      CCPETIM,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L107
          MOVE      CCPEQTY,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L108
          MOVE      CCPECHG,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L109
          MOVE      CCPECL1,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L110
          MOVE      CCPECL2,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L111
          MOVE      CCPECL3,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L112
          MOVE      CCPECL4,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L113
          MOVE      CCPECL5,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
PS02L999
          RETURN
.---------------------------------------------------------
. Selections for : Modify Errors                      
.---------------------------------------------------------
SF02L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF02L001  BRANCH   ACCEPT,SF02L020
.
SF02L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF02L006,SF02L006,SF02L006,SF02L101:
                            SF02L102,SF02L103,SF02L104,SF02L105:
                            SF02L106,SF02L107,SF02L108,SF02L109:
                            SF02L110,SF02L111,SF02L112,SF02L006:
                            SF02L113,SF02L114,SF02L115
SF02L006  BEEP
          GOTO     SF02L005
SF02L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF02L090
          MATCH    PRGID,SCSLPID
          GOTO     SF02L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF02L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF02L020,SF02L020,SF02L020,SF02L101:
                            SF02L102,SF02L103,SF02L104,SF02L105:
                            SF02L106,SF02L107,SF02L108,SF02L109:
                            SF02L110,SF02L111,SF02L112,SF02L020:
                            SF02L020,SF02L020,SF02L020
          GOTO     SF02L020
SF02L090  MOVE     ZERO,ACCEPT
          GOTO     SF02L001
.
SF02L101
          CALL     SELECTED
          STRIP     CCPEFKY 
          SFORMAT   VAR,SCPSLEN
          MOVE      CCPEFKY,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,CCPEFKY 
          SFORMAT   VAR,127
          ENDSET    CCPEFKY 
          APPEND    SP70,CCPEFKY 
          RESET     CCPEFKY 
          CMATCH    EXITCHAR,CCPEFKY 
          GOTO      SF02L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,CCPEFKY 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L101
            ENDIF
          ENDIF
          MOVE      CCPEFKY,VAR      
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L102
          CALL     SELECTED
          STRIP     CCPEENC 
          SFORMAT   VAR,SCPSLEN
          MOVE      CCPEENC,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,CCPEENC 
          SFORMAT   VAR,127
          ENDSET    CCPEENC 
          APPEND    SP70,CCPEENC 
          RESET     CCPEENC 
          CMATCH    EXITCHAR,CCPEENC 
          GOTO      SF02L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,CCPEENC 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L102
            ENDIF
          ENDIF
          MOVE      CCPEENC,VAR      
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L103
          CALL     SELECTED
          STRIP     CCPEURN 
          SFORMAT   VAR,SCPSLEN
          MOVE      CCPEURN,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,CCPEURN 
          SFORMAT   VAR,127
          ENDSET    CCPEURN 
          APPEND    SP70,CCPEURN 
          RESET     CCPEURN 
          CMATCH    EXITCHAR,CCPEURN 
          GOTO      SF02L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,CCPEURN 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L103
            ENDIF
          ENDIF
          MOVE      CCPEURN,VAR      
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L104
          CALL     SELECTED
          CALL      KEYDATE
          PACK      CCPEDAT,CCENT,CYEAR,CMON,CDAY           
          UNPACK    CCPEDAT,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L105
          CALL     SELECTED
          STRIP     CCPETIM 
          SFORMAT   VAR,SCPSLEN
          MOVE      CCPETIM,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,CCPETIM 
          SFORMAT   VAR,127
          ENDSET    CCPETIM 
          APPEND    SP70,CCPETIM 
          RESET     CCPETIM 
          CMATCH    EXITCHAR,CCPETIM 
          GOTO      SF02L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,CCPETIM 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L105
            ENDIF
          ENDIF
          MOVE      CCPETIM,VAR      
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L106
          CALL     SELECTED
          MOVE      SP70,VAR
          CALL      DISPITEM
          KEYIN     *PCCOL:CVERT,*V2LON,*NOMASK,*RV,CCPEQTY 
          IF        SCPSMAN=1
            COMPARE   ZERO,CCPEQTY 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L106
            ENDIF
          ENDIF
          MOVE      CCPEQTY,VAR      
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L107
          CALL     SELECTED
          MOVE      SP70,VAR
          CALL      DISPITEM
          KEYIN     *PCCOL:CVERT,*V2LON,*NOMASK,*RV,CCPECHG 
          IF        SCPSMAN=1
            COMPARE   ZERO,CCPECHG 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L107
            ENDIF
          ENDIF
          MOVE      CCPECHG,VAR      
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L108
          CALL     SELECTED
          STRIP     CCPECL1 
          SFORMAT   VAR,SCPSLEN
          MOVE      CCPECL1,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,CCPECL1 
          SFORMAT   VAR,127
          ENDSET    CCPECL1 
          APPEND    SP70,CCPECL1 
          RESET     CCPECL1 
          CMATCH    EXITCHAR,CCPECL1 
          GOTO      SF02L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,CCPECL1 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L108
            ENDIF
          ENDIF
          MOVE      CCPECL1,VAR      
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L109
          CALL     SELECTED
          STRIP     CCPECL2 
          SFORMAT   VAR,SCPSLEN
          MOVE      CCPECL2,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,CCPECL2 
          SFORMAT   VAR,127
          ENDSET    CCPECL2 
          APPEND    SP70,CCPECL2 
          RESET     CCPECL2 
          CMATCH    EXITCHAR,CCPECL2 
          GOTO      SF02L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,CCPECL2 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L109
            ENDIF
          ENDIF
          MOVE      CCPECL2,VAR      
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L110
          CALL     SELECTED
          STRIP     CCPECL3 
          SFORMAT   VAR,SCPSLEN
          MOVE      CCPECL3,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,CCPECL3 
          SFORMAT   VAR,127
          ENDSET    CCPECL3 
          APPEND    SP70,CCPECL3 
          RESET     CCPECL3 
          CMATCH    EXITCHAR,CCPECL3 
          GOTO      SF02L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,CCPECL3 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L110
            ENDIF
          ENDIF
          MOVE      CCPECL3,VAR      
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L111
          CALL     SELECTED
          STRIP     CCPECL4 
          SFORMAT   VAR,SCPSLEN
          MOVE      CCPECL4,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,CCPECL4 
          SFORMAT   VAR,127
          ENDSET    CCPECL4 
          APPEND    SP70,CCPECL4 
          RESET     CCPECL4 
          CMATCH    EXITCHAR,CCPECL4 
          GOTO      SF02L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,CCPECL4 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L111
            ENDIF
          ENDIF
          MOVE      CCPECL4,VAR      
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L112
          CALL     SELECTED
          STRIP     CCPECL5 
          SFORMAT   VAR,SCPSLEN
          MOVE      CCPECL5,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,CCPECL5 
          SFORMAT   VAR,127
          ENDSET    CCPECL5 
          APPEND    SP70,CCPECL5 
          RESET     CCPECL5 
          CMATCH    EXITCHAR,CCPECL5 
          GOTO      SF02L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,CCPECL5 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L112
            ENDIF
          ENDIF
          MOVE      CCPECL5,VAR      
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L113
          MOVE      ONE,EXIT
          GOTO      SF02L999
.
SF02L114
          CALL      POST0000
          MOVE      ONE,EXIT
          GOTO      SF02L999
.
SF02L115
          CALL      DERR0000
          MOVE      ONE,EXIT
          GOTO      SF02L999
SF02L990  MOVE      ONE,EXIT * Exit Char Restart
SF02L999  RETURN
.@@@@@ Function Restart Point @@@@@
.------------------------------------------------------------
. Print Error Report
.------------------------------------------------------------
PERR0000  MOVE      ZERO,CPAGENO
          MOVE      "99",CLNO
          CLOCK     TIME,CTIMEIS
          CALL      KERRUN00
          BRANCH    EXIT,PERR9999
          PACK      KEY12,RUNNUMB,SP70
          CALL      RSCCPE1
PERR1000  CALL      RKCCPE1
          BRANCH    OVRCD,PERR9000
          MATCH     RUNNUMB,CCPERUN
          GOTO      PERR9000 IF NOT EQUAL
.
          ADD       TWO,CLNO
          COMPARE   "55",CLNO
          CALL      ERRHED00 IF NOT LESS
          UNPACK    CCPEDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     CCPEREC,SP1,CCPEDES,SP1,CPCDATE,*N:
                    *10,CCPEFKY,SP1,CCPEENC,SP1,CCPEURN,*66,CCPEQTY
          GOTO      PERR1000
.
PERR9000  CALL      UND80
          PRINT     *35,"** End of Report **"
.
PERR9999  RETURN
.------------------------------------------------------------
. Print Error Report Heading
.------------------------------------------------------------
ERRHED00  CALL      HEAD80
          PRINT     "Run Number : ",RUNNUMB
          CALL      UND80
          PRINT     "Error No. Error Message                             ":
                    "         Date"
          PRINT     "          Feeder Key           Encounter        U/R ":
                    "                    Quantity"
          CALL      UND80
          MOVE      "5",CLNO
          RETURN
.------------------------------------------------------------
. Keyin Error Run Number
.------------------------------------------------------------
KERRUN00  KEYIN     *P1:24,*EL,"Enter Run Number (0. Exit) : ",*V2LON,F4
          DISPLAY   *P1:24,*EL,"Enter Run Number (0. Exit) : ",*V2LON,F4
          IF        F4=0
            MOVE      ONE,EXIT
            GOTO      KERRUN99
          ENDIF
          MOVE      F4,RUNNUMB
          PACK      KEY12,RUNNUMB,SP70
          CALL      RSCCPE1
          CALL      RKCCPE1
          BRANCH    OVRCD,KERRUN10
          MATCH     RUNNUMB,CCPERUN
          GOTO      KERRUN10 IF NOT EQUAL
          MOVE      ZERO,EXIT
          GOTO      KERRUN99
.
KERRUN10  DISPLAY   *P1:24,*EL,*B,"No Errors for Run : ",*V2LON,F4:
                    *HOFF," - ";
          CALL      HITENTER
          GOTO      KERRUN00
.
KERRUN99  RETURN
.------------------------------------------------------------
. Delete Patient Service Run
.------------------------------------------------------------
PPRO0000  CALL      RANGE000
          BRANCH    EXIT,PPRO9999
.
          MOVE      "99",CLNO
          MOVE      ZERO,CPAGENO
          CLOCK     TIME,CTIMEIS
          PACK      KEY12,RUNNUMB,FROMREC,SP70       * Delete Errors
          CALL      RDCCUP1
          IF        OVRCD=0
            CALL      RPCCUP1
          ENDIF
.
PPRO1000  CALL      RKCCUP1
          BRANCH    OVRCD,PPRO9000
          MATCH     RUNNUMB,CCUPRUN
          GOTO      PPRO9000 IF NOT EQUAL
          MOVE      CCUPREC,RECORDF8
          IF        RECORDF8>TOREC
            GOTO      PPRO9000
          ENDIF
          IF        (RECORDF8%100=0)
            DISPLAY   *P1:24,"Printing Record : ",RECORDF8
          ENDIF
          ADD       ONE,CLNO
          COMPARE   "55",CLNO
          CALL      PROHED00 IF NOT LESS
          UNPACK    CCUPDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     CCUPREC,SP1,CCUPHCD,"/",CCUPDPT,"/",CCUPPCD,SP1,CCUPENC:
                    SP1,CCUPURN,SP1,CPCDATE,SP1,CCUPQTY,SP1,CCUPCHG,SP1:
                    CCUPCL1,SP1,CCUPCL2,SP1,CCUPCL3,SP1,CCUPCL4,SP1,CCUPCL5
          GOTO      PPRO1000
PPRO9000  CALL      UND132
          PRINT     *50,"*** End of Report ***"
PPRO9999  RETURN
.
PROHED00  CALL      HEAD132
          PRINT     "Run No. : ",RUNNUMB," Record From : ",FROMREC," to ",TOREC
          CALL      UND132
          PRINT     "Rec. No. Hosp/Dept/Pat. Serv. Encounter        U/R":
                    "          Date      Quantity          Charge ":
                    "User Defined Classes"
          CALL      UND132
          MOVE      "7",CLNO
          RETURN
.------------------------------------------------------------
. Keyin Run Number and Record Number Range
.------------------------------------------------------------
RANGE000  KEYIN     *P1:20,*EF,"Run No. (0. Exit)  : ",*V2LON,F4
          DISPLAY   *P1:20,*EL,"Run No. (0. Exit)  : ",*V2LON,F4
          IF        F4=0
            MOVE      ONE,EXIT
            GOTO      RANGE999
          ENDIF
          MOVE      F4,RUNNUMB
          PACK      KEY12,RUNNUMB,SP70       * Delete Errors
          CALL      RSCCUP1
          CALL      RKCCUP1
          BRANCH    OVRCD,RANGE900
          MATCH     CCUPRUN,RUNNUMB
          GOTO      RANGE900 IF NOT EQUAL
RANGE100  KEYIN     *P1:21,*EL,"From Record Number : ",*V2LON,FROMREC,*HOFF:
                    *P1:22,*EL,"To   Record Number : ",*V2LON,TOREC
          IF        TOREC=0
            MOVE      "99999999",TOREC
          ENDIF
          DISPLAY   *P1:21,*EL,"From Record Number   : ",*V2LON,FROMREC,*HOFF:
                    *P1:22,*EL,"To   Record Number   : ",*V2LON,TOREC
          MOVE      ZERO,EXIT
          GOTO      RANGE999
.
RANGE900  DISPLAY   *P1:24,*EL,*B,"No Records On File for That Run - ";
          CALL      HITENTER
          GOTO      RANGE000
.
RANGE999  RETURN
.------------------------------------------------------------
. Error Load      (this Calls KERRUN00 routine in PERR)
.------------------------------------------------------------
ELOD0000  CALL      KERRUN00
          BRANCH    EXIT,ELOD9999
.
          PACK      KEY12,RUNNUMB,Z70
          CALL      RSCCUP1
          CALL      RPCCUP1
          BRANCH    OVRCD,ELOD0100
          MATCH     RUNNUMB,CCUPRUN
          GOTO      ELOD0100 IF NOT EQUAL
          MOVE      CCUPREC,RECORDF8
          GOTO      ELOD0200
.
ELOD0100  MOVE      ZERO,RECORDF8
.
ELOD0200  MOVE      CCPKHCD,CCUPHCD            * Hospital
          MOVE      CCPKDPT,CCUPDPT            * Department
          DISPLAY   *P1:19,*EF
          HLINE     *G37,19,1,80
          DISPLAY   *P1:20,"Run No.: ":
                    *P1:21,"Record : ":
                    *P1:22,"Errors : "
          HLINE     *G37,23,1,80
          DISPLAY   *P16:20,*V2LON,RUNNUMB
.
          DISPLAY   *P1:24,*EL,"Re-Loading Errors"
.
          MOVE      ZERO,COUNTER
          MOVE      ZERO,ERRORNO
          PACK      KEY12,RUNNUMB,SP70
          CALL      RSCCPE1
ELOD1000  CALL      RKCCPE1
          BRANCH    OVRCD,ELOD9999
          MATCH     RUNNUMB,CCPERUN
          GOTO      ELOD9999 IF NOT EQUAL
          ADD       ONE,COUNTER
          DISPLAY   *P16:21,*V2LON,COUNTER
.
          MOVE      CCPEFKY,CCPUFKY
          MOVE      CCPEDAT,CCPUDAT
          MOVE      CCPUFKY,KEY20
          CALL      RDCCPF1                * Check Feeder Key
          BRANCH    OVRCD,ELOD9000
.
          REP       " 0",CCPUDAT
          PACK      KEY14,CCPUDAT,SP70
          CALL      RSCCCA3                * Check Calendar
          CALL      RKCCCA3                * Check Calendar
          BRANCH    OVRCD,ELOD9000
.
          PACK      KEY38,CCPUFKY,SP70
          CALL      RSCCPK1                * Check Feeder Key
          CALL      RKCCPK1                * Check Feeder Key
          BRANCH    OVRCD,ELOD9000
          MATCH     CCPKFKY,CCPUFKY
          GOTO      ELOD9000 IF NOT EQUAL
.
          MOVE      CCPEENC,CCPUENC
          MOVE      CCPEURN,CCPUURN
          MOVE      CCPETIM,CCPUTIM
          MOVE      CCPEQTY,CCPUQTY
          MOVE      CCPECHG,CCPUCHG
          MOVE      CCPECL1,CCPUCL1
          MOVE      CCPECL2,CCPUCL2
          MOVE      CCPECL3,CCPUCL3
          MOVE      CCPECL4,CCPUCL4
          MOVE      CCPECL5,CCPUCL5
          MOVE      CCPESPA,CCPUSPA
.
          CALL      LOADU000               * Load Patient Service
          PACK      KEY12,CCPERUN,CCPEREC
          CALL      DECCPE1
          CALL      RSCCPE1
.
          GOTO      ELOD1000
.
ELOD9000  ADD       ONE,ERRORNO
          DISPLAY   *P16:22,*V2LON,ERRORNO
          GOTO      ELOD1000
.
ELOD9999  RETURN
.------------------------------------------------------------
. Delete Patient Service Run
.------------------------------------------------------------
DELR0000  CALL      KEYRUN00
          BRANCH    EXIT,DELR9999
.
          CALL      DELT0000
.
DELR9999  RETURN
.------------------------------------------------------------
. Delete Run
.------------------------------------------------------------
DELT0000  PACK      KEY12,RUNNUMB,SP70       * Delete Errors
          MOVE      ZERO,ERRORNO
          CALL      RSCCPE1
DELT1000  CALL      RKCCPE1
          BRANCH    OVRCD,DELT1900
          MATCH     RUNNUMB,CCPERUN
          GOTO      DELT1900 IF NOT EQUAL
          PACK      KEY12,CCPERUN,CCPEREC
          ADD       ONE,ERRORNO
          IF        (ERRORNO%100=0)
            DISPLAY   *P1:24,*EL,"Deleting Errors : ",ERRORNO
          ENDIF
          CALL      DECCPE1
          CALL      RSCCPE1
          GOTO      DELT1000
.
DELT1900  PACK      KEY12,RUNNUMB,SP70       * Delete Errors
          MOVE      ZERO,ERRORNO
          CALL      RSCCUP1
DELT2000  CALL      RKCCUP1
          BRANCH    OVRCD,DELT2900
          MATCH     RUNNUMB,CCUPRUN
          GOTO      DELT2900 IF NOT EQUAL
          ADD       ONE,ERRORNO
          IF        (ERRORNO%100=0)
            DISPLAY   *P1:24,*EL,"Deleting Pat. Serv. : ",ERRORNO
          ENDIF
          PACK      KEY12,CCUPRUN,CCUPREC
          CALL      DECCUP1
          CALL      RSCCUP1
.
          PACK      KEY14,CCUPDAT,SP70
          CALL      RSCCCA3
          CALL      RKCCCA3
.
          PACK      KEY24,CCUPHCD,CCUPDPT,CCCAYEAR,CCCAPER,CCUPPCD
          CALL      RDCCPS1
          IF        OVRCD=0
            SUB       CCUPQTY,CCPSQTY
            SUB       CCUPCHG,CCPSCHG
            CALL      UPCCPS1
          ENDIF
          GOTO      DELT2000
DELT2900
DELT9999  RETURN
.------------------------------------------------------------
. Keyin Error Run Number
.------------------------------------------------------------
KEYRUN00  KEYIN     *P1:24,*EL,"Enter Run Number (0. Exit) : ",*V2LON,F4
          DISPLAY   *P1:24,*EL,"Enter Run Number (0. Exit) : ",*V2LON,F4
          IF        F4=0
            MOVE      ONE,EXIT
            GOTO      KEYRUN99
          ENDIF
          MOVE      ZERO,EXIT
          MOVE      F4,RUNNUMB
KEYRUN10  KEYIN     *P60:24,*EL,"Ok (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",ANS
          REP       UPPLOW,ANS
          MATCH     ANSN,ANS
          GOTO      KEYRUN00 IF EQUAL
          MATCH     ANSY,ANS
          GOTO      KEYRUN10 IF NOT EQUAL
KEYRUN99  RETURN
.----------------------------------------
. Move one to accept to for insert mode
.----------------------------------------
MVACCEPT  MOVE      ONE,ACCEPT
          RETURN
KUTL0000  STRIP     UTILNAME
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,UTILNAME
          ENDSET    UTILNAME
          APPEND    SP70,UTILNAME
          RESET     UTILNAME
          CMATCH    EXITCHAR,UTILNAME
          GOTO      KUTL9000 IF EQUAL
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      CCIUTLXX,UTILNAME
          TRAPCLR   IO
          IF        OVRCD=1
            BEEP
            MOVE    "File Not Found - ",DISPMSG
            CALL    MESSAGE1
            GOTO    KUTL0000
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      KUTL9999
KUTL9000  MOVE      TWO,EXIT
KUTL9999  RETURN
.----------------------------------------
. Load Interface file CCIUTL
. Scan and Load Details
.----------------------------------------
LOAD0000  CALL     CLREPS00
          CALL     SCANU000    * Scan Utilisation
          DISPLAY  *P1:19,*EF
          HLINE    *G37,19,1,80
          DISPLAY  *P1:20,"Run Number          : ",*V2LON,RUNNUMB,*HOFF:
                   *P1:21,"Input File Records  : ",*V2LON,COUNTER,*HOFF:
                   *P40:21,"Error File Records  : ",*V2LON,ERRORNO,*HOFF:
                   *P1:22,"No. Records Created : ",*V2LON,RECORDF8
          HLINE    *G37,23,1,80
          DISPLAY  *P1:24,"Load Complete - ";
          CALL     HITENTER
.
LOAD9999  RETURN
.-----------------------------------------
. Scan Utilisation
.-----------------------------------------
SCANU000  DISPLAY   *P1:19,*EF
          HLINE     *G37,19,1,80
          DISPLAY   *P1:20,"Run No.: ":
                    *P1:21,"Record : ":
                    *P1:22,"Errors : "
          HLINE     *G37,23,1,80
          DISPLAY   *P1:24,*EL,"Loading Utilisation File"
.
          CALL      GETRUN00     * Determine Next Run Number
          DISPLAY   *P16:20,*V2LON,RUNNUMB
.
          MOVE      ZERO,COUNTER
          MOVE      ZERO,ERRORFLG
.
SCANU100  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF FORMAT
          READ      CCIUTLXX,SEQ;CCPUFKY,CCPUENC,CCPUURN,CCPUDAT,CCPUTIM:
                                 CCPUQTY,CCPUCHG,CCPUCL1,CCPUCL2,CCPUCL3:
                                 CCPUCL4,CCPUCL5,CCPUSPA
          GOTO      SCANU999 IF OVER
          ADD       ONE,COUNTER
          TRAPCLR   FORMAT
          BRANCH    OVRCD,SCANU900         * Invalid Format
.
          IF        (COUNTER%100.0)=0
            DISPLAY   *P16:21,*V2LON,COUNTER
          ENDIF
.
          MOVE      CCPUFKY,KEY20
          CALL      RDCCPF1                * Check Feeder Key
          BRANCH    OVRCD,SCANU910
.
          REP       " 0",CCPUDAT
          PACK      KEY14,CCPUDAT,SP70
          CALL      RSCCCA3                * Check Calendar
          CALL      RKCCCA3                * Check Calendar
          BRANCH    OVRCD,SCANU920
          MATCH     SP70,CCCAPER
          IF        @EQUAL
            CALL      RKCCCA3                * Check Calendar
            BRANCH    OVRCD,SCANU920
          ENDIF
.
          PACK      KEY38,CCPUFKY,SP70
          CALL      RSCCPK1                * Check Feeder Key
          CALL      RKCCPK1                * Check Feeder Key
          BRANCH    OVRCD,SCANU940
          MATCH     CCPKFKY,CCPUFKY
          GOTO      SCANU940 IF NOT EQUAL
.
          COMPARE   ONE,CCCASTAT           * Locked  1=Yes
          GOTO      SCANU930 IF EQUAL
.
SCANU200  CALL      LOADU000               * Load Patient Service
.
          GOTO      SCANU100
.
SCANU900  CLEAR     DISPMSG
          APPEND    "Invalid Record Format. Record : ",DISPMSG
          APPEND    COUNTER,DISPMSG
          RESET     DISPMSG
          IF        COUNTER=1|COUNTER=2
            BEEP
            CALL      MESSAGE1
            CALL      DELT0000
            GOTO      SCANU999
          ENDIF
          CALL      ERROR000
          GOTO      SCANU100
.
SCANU910  CLEAR     DISPMSG
          APPEND    "Invalid Patient Service Feeder Key : ",DISPMSG
          APPEND    CCPUFKY,DISPMSG
          RESET     DISPMSG
          CALL      ERROR000
          GOTO      SCANU100
.
SCANU920  CLEAR     DISPMSG
          APPEND    "Invalid Fiscal Period/Year Date : ",DISPMSG
          UNPACK    CCPUDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          APPEND    CPCDATE,DISPMSG
          RESET     DISPMSG
          CALL      ERROR000
          GOTO      SCANU100
.
SCANU930  CLEAR     DISPMSG
          APPEND    "WARNING : Fiscal Period/Year Locked : ",DISPMSG
          APPEND    CCCAPER,DISPMSG
          APPEND    "/",DISPMSG
          APPEND    CCCAYEAR,DISPMSG
          RESET     DISPMSG
.
          ADD       THREE,CLNO
          COMPARE   "55",CLNO
          CALL      HEAD0000 IF NOT LESS
          PRINT     COUNTER,*17,DISPMSG
          PRINT     CCPUFKY,SP1,CCPUENC,SP1,CCPUURN,SP1,CCPUDAT,SP1,CCPUTIM,SP1:
                    CCPUQTY
          GOTO      SCANU200
.
SCANU940  CLEAR     DISPMSG
          APPEND    "NO Patient Service for Feeder Key : ",DISPMSG
          APPEND    CCPUFKY,DISPMSG
          RESET     DISPMSG
          CALL      ERROR000
          GOTO      SCANU100
.
SCANU999  RETURN
.------------------------------------------------------------
. Write Record to Error File
.------------------------------------------------------------
ERROR000  BRANCH    ERRORFLG,ERROR100
          MOVE      ZERO,CPAGENO
          MOVE      ZERO,ERRORNO
          MOVE      ONE,ERRORFLG
          MOVE      "99",CLNO
          CLOCK     TIME,CTIMEIS
.
ERROR100  ADD       ONE,ERRORNO
          DISPLAY   *P16:22,*V2LON,ERRORNO
          MOVE      RUNNUMB,CCPERUN
          MOVE      ERRORNO,CCPEREC
          MOVE      DISPMSG,CCPEDES
          MOVE      CCPUFKY,CCPEFKY
          MOVE      CCPUENC,CCPEENC
          MOVE      CCPUURN,CCPEURN
          MOVE      CCPUDAT,CCPEDAT
          MOVE      CCPUTIM,CCPETIM
          MOVE      CCPUQTY,CCPEQTY
          MOVE      CCPUCHG,CCPECHG
          MOVE      CCPUCL1,CCPECL1
          MOVE      CCPUCL2,CCPECL2
          MOVE      CCPUCL3,CCPECL3
          MOVE      CCPUCL4,CCPECL4
          MOVE      CCPUCL5,CCPECL5
          MOVE      CCPUSPA,CCPESPA
          PACK      KEY12,CCPERUN,CCPEREC
          CALL      RACCPE1
          IF        OVRCD=0
            GOTO      ERROR100
          ELSE
            CALL      WRCCPE1
          ENDIF
ERROR999  RETURN
.------------------------------------------------------------
. Error Report Heading
.------------------------------------------------------------
HEAD0000  CALL      HEAD80
          CALL      UND80
          PRINT     "Record Number   Error Message"
          CALL      UND80
          RETURN
.------------------------------------------------------------
. Load Utilisation Details
.------------------------------------------------------------
LOADU000  PACK      KEY38,CCPUFKY,SP70
          CALL      RSCCPK1
LOADU200  CALL      RKCCPK1
          BRANCH    OVRCD,LOADU999         * No More Related Patient Service
          MATCH     CCPKFKY,CCPUFKY        * No More Related Patient Service
          GOTO      LOADU999 IF NOT EQUAL
.
          CALL      SUMPR000               * Update Patient Service Summary
.
          CALL      WRTUS000               * Write Patient Service Usage Record
.
          CALL      GENPR000               * Determine Synthetic Patient Service
.
          GOTO      LOADU200               * Next Record
.
LOADU999  RETURN
.------------------------------------------------------------
. Check for Generated Patient Service
.------------------------------------------------------------
GENPR000  PACK      KEY36,CCPKHCD,CCPKDPT,CCPKPCD,SP70
          PACK      KEY18,CCPKHCD,CCPKDPT,CCPKPCD,SP70
          CALL      RSCCGP1
GENPR100  CALL      RKCCGP1
          BRANCH    OVRCD,GENPR999
          PACK      KEY36,CCGPHCD,CCGPDPT,CCGPPCD,SP70
          MATCH     KEY18,KEY36
          GOTO      GENPR999 IF NOT EQUAL
.
          CALL      SUMGP000                * Update Summary
.
          CALL      WRTGP000                * Write Transactions
.
          GOTO      GENPR100
.
GENPR999  RETURN
.------------------------------------------------------------
. Write Patient Service Usage Record
.------------------------------------------------------------
WRTUS000  ADD       ONE,RECORDF8
          MOVE      RECORDF8,CCUPREC
          MOVE      RUNNUMB,CCUPRUN
          PACK      KEY12,CCUPRUN,CCUPREC
          CALL      RACCUP1
          COMPARE   ZERO,OVRCD
          GOTO      WRTUS000 IF EQUAL
.
          MOVE      CCPKHCD,CCUPHCD            * Hospital
          MOVE      CCPKDPT,CCUPDPT            * Department
          MOVE      CCPKPCD,CCUPPCD            * Patient Service
          MOVE      CCPUENC,CCUPENC            * Encounter
          MOVE      CCPUURN,CCUPURN            * UR Number
          MOVE      CCPUDAT,CCUPDAT            * Date CCYYMMDD
          MOVE      CCPUTIM,CCUPTIM            * Time HH:MM
          MOVE      CCPUQTY,CCUPQTY            * Quantity
          MOVE      CCPUCHG,CCUPCHG            * Charge
          MOVE      CCPUCL1,CCUPCL1            * Clinical Dept      (NZ)
          MOVE      CCPUCL2,CCUPCL2            * Patient Category   (NZ)
          MOVE      CCPUCL3,CCUPCL3            * Service Code       (NZ)
          MOVE      CCPUCL4,CCUPCL4            *
          MOVE      CCPUCL5,CCUPCL5            *
          MOVE      SP70,CCUPSPA               * Spare
.
          CALL      WRCCUP1
.
. Check for Episode Record
.
          PACK      KEY18,CCUPHCD,CCUPENC,SP70
          CALL      RACCEP1
          IF        OVRCD=1
            UNPACK    KEY18,CCEPHCD,CCEPEPS
            MOVE      CCUPURN,CCEPURN
            PACK      CCEPSDT,CCC,CYY,CMM,CDD
            REP       " 0",CCEPSDT
            CALL      WRCCEP1
          ENDIF
          RETURN
.------------------------------------------------------------
. Write or Update Patient Service Summary Record with Quantity
.------------------------------------------------------------
SUMPR000  PACK      KEY24,CCPKHCD,CCPKDPT,CCCAYEAR,CCCAPER,CCPKPCD
          CALL      RDCCPS1
          IF        OVRCD=0
            ADD       CCPUQTY,CCPSQTY
            ADD       CCPUCHG,CCPSCHG
            CALL      UPCCPS1
          ELSE
            UNPACK    KEY24,CCPSHCD,CCPSDPT,CCPSYEAR,CCPSPER,CCPSPCD
            MOVE      CCPUQTY,CCPSQTY
            MOVE      CCPUCHG,CCPSCHG
            MOVE      ZERO,CCPSBQT
            MOVE      ZERO,CCPSCST
            MOVE      ZERO,CCPSBCT
            MOVE      ZERO,CCPSFBU
            MOVE      ZERO,CCPSSCT
            MOVE      SP70,CCPSSPA
            CALL      WRCCPS1
          ENDIF
          RETURN
.------------------------------------------------------------
. Determine Next Run Number for Patient Service Usage File
.------------------------------------------------------------
GETRUN00  PACK      KEY12,Z70
          CALL      RSCCUP1
          CALL      RPCCUP1
          IF        OVRCD=1
            MOVE      ZERO,F4
          ELSE
            MOVE      CCUPRUN,F4
          ENDIF
GETRUN10  ADD       ONE,F4
          MOVE      F4,RUNNUMB
          PACK      KEY12,RUNNUMB,SP70
          CALL      RSCCUP1
          CALL      RKCCUP1
          BRANCH    OVRCD,GETRUN99        * Just to make sure
          MATCH     RUNNUMB,CCUPRUN
          GOTO      GETRUN10 IF EQUAL     * Just to make sure
GETRUN99  MOVE      ZERO,RECORDF8
          RETURN
.------------------------------------------------------------
. Write Patient Service Usage Record for Synthetic Patient Service
.------------------------------------------------------------
WRTGP000  ADD       ONE,RECORDF8
          MOVE      RECORDF8,CCUPREC
          MOVE      RUNNUMB,CCUPRUN
          PACK      KEY12,CCUPRUN,CCUPREC
          CALL      RACCUP1
          COMPARE   ZERO,OVRCD
          GOTO      WRTGP000 IF EQUAL
.
          MOVE      CCGPGHCD,CCUPHCD           * Hospital
          MOVE      CCGPGDPT,CCUPDPT           * Department
          MOVE      CCGPGPCD,CCUPPCD           * Patient Service
          MOVE      CCGPGQTY,CCUPQTY           * Quantity
          MOVE      CCGPGCH,CCUPCHG            * Charge
.
          MOVE      CCPUENC,CCUPENC            * Encounter
          MOVE      CCPUURN,CCUPURN            * U/R Number
          MOVE      CCPUDAT,CCUPDAT            * Date CCYYMMDD
          MOVE      CCPUTIM,CCUPTIM            * Time HH:MM
          MOVE      CCPUCL1,CCUPCL1            * Clinical Dept      (NZ)
          MOVE      CCPUCL2,CCUPCL2            * Patient Category   (NZ)
          MOVE      CCPUCL3,CCUPCL3            * Service Code       (NZ)
          MOVE      CCPUCL4,CCUPCL4            *
          MOVE      CCPUCL5,CCUPCL5            *
          MOVE      SP70,CCUPSPA               * Spare
          CALL      WRCCUP1
.
. Check for Episode Record
.
          PACK      KEY18,CCUPHCD,CCUPENC,SP70
          CALL      RACCEP1
          IF        OVRCD=1
            UNPACK    KEY18,CCEPHCD,CCEPEPS
            MOVE      CCUPURN,CCEPURN
            PACK      CCEPSDT,CCC,CYY,CMM,CDD
            REP       " 0",CCEPSDT
            CALL      WRCCEP1
          ENDIF
          RETURN
.-------------------------------------------------------------------------------
. Write or Update Patient Service Summary Record
. with Quantity for Generated Patient Service
.-------------------------------------------------------------------------------
SUMGP000  PACK      KEY24,CCGPGHCD,CCGPGDPT,CCCAYEAR,CCCAPER,CCGPGPCD
          CALL      RDCCPS1
          IF        OVRCD=0
            ADD       CCGPGQTY,CCPSQTY
            ADD       CCGPGCH,CCPSCHG
            CALL      UPCCPS1
          ELSE
            UNPACK    KEY24,CCPSHCD,CCPSDPT,CCPSYEAR,CCPSPER,CCPSPCD
            MOVE      CCGPGQTY,CCPSQTY
            MOVE      CCGPGCH,CCPSCHG
            MOVE      ZERO,CCPSBQT
            MOVE      ZERO,CCPSCST
            MOVE      ZERO,CCPSBCT
            MOVE      ZERO,CCPSFBU
            MOVE      ZERO,CCPSSCT
            MOVE      SP70,CCPSSPA
            CALL      WRCCPS1
          ENDIF
          RETURN
.------------------------------
. Clear Episode Record Details
.------------------------------
CLREPS00
          MOVE      SP70,CCEPSUR
          MOVE      SP70,CCEPGIV
          MOVE      SP70,CCEPCOM
          MOVE      SP70,CCEPURN
          MOVE      SP70,CCEPSDT
          MOVE      SP70,CCEPLTD
          MOVE      ZERO,CCEPLOS
          MOVE      SP70,CCEPINPT
          MOVE      SP70,CCEPDAY
          MOVE      ZERO,CCEPVIST
          MOVE      SP70,CCEPSEX
          MOVE      SP70,CCEPDOB
          MOVE      SP70,CCEPAGEY
          MOVE      SP70,CCEPAGEM
          MOVE      SP70,CCEPAGED
          MOVE      SP70,CCEPCOB
          MOVE      SP70,CCEPREL
          MOVE      SP70,CCEPDDAT
          MOVE      SP70,CCEPDWAR
          MOVE      SP70,CCEPDSTA
          MOVE      SP70,CCEPDDES
          MOVE      SP70,CCEPDMBS
          MOVE      SP70,CCEPDDPT
          MOVE      SP70,CCEPDSER
          MOVE      SP70,CCEPMDCC
          MOVE      SP70,CCEPDRGC
          MOVE      SP70,CCEPADAT
          MOVE      SP70,CCEPAWAR
          MOVE      SP70,CCEPASRC
          MOVE      SP70,CCEPACLS
          MOVE      SP70,CCEPACAR
          MOVE      SP70,CCEPADPT
          MOVE      SP70,CCEPASER
          MOVE      SP70,CCEPARDC
          MOVE      SP70,CCEPATDC
          MOVE      SP70,CCEPAADC
          MOVE      SP70,CCEPDADC
          MOVE      SP70,CCEPAHFD
          MOVE      SP70,CCEPAHTB
          MOVE      SP70,CCEPAMBS
          MOVE      SP70,CCEPOPCL
          MOVE      SP70,CCEPPDIA
          MOVE      SP70,CCEPSDIA
          MOVE      SP70,CCEPPOPP
          MOVE      SP70,CCEPSOPP
          MOVE      ZERO,CCEPVW5
          MOVE      ZERO,CCEPV5A
          MOVE      ZERO,CCEPV8A
          MOVE      SP70,CCEPSPA
          RETURN
.------------------------------------------------------------
. Keyin Error Run Number
.------------------------------------------------------------
ERUNN000  KEYIN     *PCCOL:CVERT,*V2LON,*MASK,F4
          IF        F4=0
            MOVE      ONE,EXIT
            GOTO      ERUNN999
          ENDIF
          MOVE      F4,CCPERUN
          MOVE      F4,RUNNUMB
          PACK      KEY12,RUNNUMB,SP70
          CALL      RSCCPE1
          CALL      RKCCPE1
          BRANCH    OVRCD,ERUNN010
          MATCH     RUNNUMB,CCPERUN
          GOTO      ERUNN010 IF NOT EQUAL
          MOVE      ZERO,EXIT
          GOTO      ERUNN999
.
ERUNN010  MOVE      "No Errors for Run : ",DISPMSG
          BEEP
          CALL      MESSAGE1
          GOTO      ERUNN000
.
ERUNN999  RETURN
.------------------------------------------------------------
. Keyin Error Run Number
.------------------------------------------------------------
ERECN000  KEYIN     *PCCOL:CVERT,*V2LON,*MASK,F8
          IF        F8=0
            MOVE      ONE,EXIT
            GOTO      ERECN999
          ENDIF
.
          PACK      KEY12,CCPERUN,F8,SP70
          CALL      RDCCPE1
          IF        OVRCD=1
            MOVE      "Error Number Not Found - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      ERECN000
          ENDIF
.
ERECN999  RETURN
.
.------------------------------------------------------------
. Save Error Modification
.------------------------------------------------------------
POST0000  PACK     KEY12,CCPERUN,CCPEREC
          CALL     RACCPE1
          IF       OVRCD=0
            CALL     UPCCPE1
          ELSE
            CALL     WRCCPE1
          ENDIF
          RETURN
.
.------------------------------------------------------------
. Save Error Modification
.------------------------------------------------------------
DERR0000  PACK     KEY12,CCPERUN,CCPEREC
          CALL     RACCPE1
          IF       OVRCD=0
            CALL     DECCPE1
          ENDIF
          RETURN
.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       CCSCALIO/INC
          INC       CCSEPSIO/INC
          INC       CCSGPFIO/INC
          INC       CCSHLCIO/INC
          INC       CCSPERIO/INC
          INC       CCSPFKIO/INC
          INC       CCSPKYIO/INC
          INC       CCSPSDIO/INC
          INC       CCSUPDIO/INC
          INC       PMS502IO    
.
          INC       STDGENCD
.

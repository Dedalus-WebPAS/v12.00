.*****************************************************************************
.*    Program      : F06MHHON                                                *
.*    Description  : Conversion of mehhonaf to new file layout               *
.*                                                                           *
.*    Author       : Patrick Adair     CAR 271541                            *
.*    Date         : 17/03/2015                                              *
.*    Modifications:                                                         *
.*          Created from current FIXSKEL using Automated Shell script        *
.*****************************************************************************
.
.
          INC       STD001FD
.
FINDFILE  FILE      ASCII, FIXED=256
REPORTF1  FILE      ASCII, FIXED=256
.
.
.Data File Definition
.--------------------
OLDFILE1   IFILE    SQL, FIXED=369, KEY="U1-8,9-16"                             
.
.Name     Type      Length Physical Start Description
.----     ----      ------ -------- ----- -----------
.MHHNVISN  DIM       8      8        1     Visit Number                       
.MHHNUNIQ  DIM       8      8        9     Unique Count                       
.MHHNHOTY  DIM       3      3        17    HONOS Type (Cat hs)                
.MHHNACTV  DIM       1      1        20    Active 1=Yes                       
.MHHNSENT  DIM       1      1        21    Sent (1=Yes)                       
.MHHNHDAT  DIM       8      8        22    HONOS Date (CCYYMMDD)              
.MHHNSSET  DIM       3      3        30    Service Setting (Cat ss)           
.MHHNREAS  DIM       3      3        33    Reason for Collection (Cat hp)     
.MHHNRHCP  DIM       10     10       36    Responsible HCP (pmshcpaf)         
.MHHNCAST  DIM       10     10       46    Case Team (allcasaf)               
.MHHNPHCP  DIM       10     10       56    Performing HCP (pmshcpaf)          
.MHHNWEBC  DIM       10     10       66    WEB User Created (websecaf)        
.MHHNCDTE  DIM       8      8        76    Date Created (CCYYMMDD)            
.MHHNCTIM  DIM       8      8        84    Time Created (HH:MM:SS)            
.MHHNCOMP  DIM       1      1        92    Completed (1=Yes)                  
.MHHNWEBF  DIM       10     10       93    Web User Completed (websecaf)      
.MHHNDATF  DIM       8      8        103   Date Completed (CCYYMMDD)          
.MHHNTIMF  DIM       8      8        111   Time Completed (HH:MM:SS)          
.MHHNWEBU  DIM       10     10       119   Web User ID Updated (websecaf)     
.MHHNDATU  DIM       8      8        129   Date Updated (CCYYMMDD)            
.MHHNTIMU  DIM       8      8        137   Time Updated (HH:MM:SS)            
.MHHNFOCU  DIM       3      3        145   Focus of Care (Cat hf)             
.MHHNCULS  DIM       3      3        148   Cultural Support (Cat hc)          
.MHHNNGOS  DIM       1      1        151   NGO Support (1=Yes)                
.MHHNNGOA  DIM       1      1        152   NGO Support Accommodation (1=Yes)  
.MHHNNGOW  DIM       1      1        153   NGO Comm Support Worker (1=Yes)    
.MHHNVOCA  DIM       1      1        154   Vocational Assistance (1=Yes)      
.MHHNNSNG  DIM       1      1        155   Non Specific NGO Service (1=Yes)   
.MHHNCOLS  DIM       3      3        156   Collection Status (Cat ht)         
.MHHNMODA  DIM       3      3        159   Mode of Administration (Cat hm)    
.MHHNADQ1  DIM       1      1        162   Adult Q1                           
.MHHNADQ2  DIM       1      1        163   Adult Q2                           
.MHHNADQ3  DIM       1      1        164   Adult Q3                           
.MHHNADQ4  DIM       1      1        165   Adult Q4                           
.MHHNADQ5  DIM       1      1        166   Adult Q5                           
.MHHNADQ6  DIM       1      1        167   Adult Q6                           
.MHHNADQ7  DIM       1      1        168   Adult Q7                           
.MHHNADQ8  DIM       1      1        169   Adult Q8                           
.MHHNAQ8A  DIM       1      1        170   Adult Q8A                          
.MHHNFREE  DIM       35     35       171   8A Free Text                       
.MHHNADQ9  DIM       1      1        206   Adult Q9                           
.MHHNAQ10  DIM       1      1        207   Adult Q10                          
.MHHNAQ11  DIM       1      1        208   Adult Q11                          
.MHHNAQ12  DIM       1      1        209   Adult Q12                          
.MHHNCYQ1  DIM       1      1        210   Child and Youth Q1                 
.MHHNCYQ2  DIM       1      1        211   Child and Youth Q2                 
.MHHNCYQ3  DIM       1      1        212   Child and Youth Q3                 
.MHHNCYQ4  DIM       1      1        213   Child and Youth Q4                 
.MHHNCYQ5  DIM       1      1        214   Child and Youth Q5                 
.MHHNCYQ6  DIM       1      1        215   Child and Youth Q6                 
.MHHNCYQ7  DIM       1      1        216   Child and Youth Q7                 
.MHHNCYQ8  DIM       1      1        217   Child and Youth Q8                 
.MHHNCYQ9  DIM       1      1        218   Child and Youth Q9                 
.MHHNCQ10  DIM       1      1        219   Child and Youth Q10                
.MHHNCQ11  DIM       1      1        220   Child and Youth Q11                
.MHHNCQ12  DIM       1      1        221   Child and Youth Q12                
.MHHNCQ13  DIM       1      1        222   Child and Youth Q13                
.MHHNCQ14  DIM       1      1        223   Child and Youth Q14                
.MHHNCQ15  DIM       1      1        224   Child and Youth Q15                
.MHHNLDQ1  DIM       1      1        225   Learning Disabilities Q1           
.MHHNLDQ2  DIM       1      1        226   Learning Disabilities Q2           
.MHHNLDQ3  DIM       1      1        227   Learning Disabilities Q3           
.MHHNLDQ4  DIM       1      1        228   Learning Disabilities Q4           
.MHHNLDQ5  DIM       1      1        229   Learning Disabilities Q5           
.MHHNLDQ6  DIM       1      1        230   Learning Disabilities Q6           
.MHHNLDQ7  DIM       1      1        231   Learning Disabilities Q7           
.MHHNLDQ8  DIM       1      1        232   Learning Disabilities Q8           
.MHHNLDQ9  DIM       1      1        233   Learning Disabilities Q9           
.MHHNLQ10  DIM       1      1        234   Learning Disabilities Q10          
.MHHNLQ11  DIM       1      1        235   Learning Disabilities Q11          
.MHHNLQ12  DIM       1      1        236   Learning Disabilities Q12          
.MHHNLQ13  DIM       1      1        237   Learning Disabilities Q13          
.MHHNLQ14  DIM       1      1        238   Learning Disabilities Q14          
.MHHNLQ15  DIM       1      1        239   Learning Disabilities Q15          
.MHHNLQ16  DIM       1      1        240   Learning Disabilities Q16          
.MHHNLQ17  DIM       1      1        241   Learning Disabilities Q17          
.MHHNLQ18  DIM       1      1        242   Learning Disabilities Q18          
.MHHNSCQ1  DIM       1      1        243   Secure Q1                          
.MHHNSCQ2  DIM       1      1        244   Secure Q2                          
.MHHNSCQ3  DIM       1      1        245   Secure Q3                          
.MHHNSCQ4  DIM       1      1        246   Secure Q4                          
.MHHNSCQ5  DIM       1      1        247   Secure Q5                          
.MHHNSCQ6  DIM       1      1        248   Secure Q6                          
.MHHNSCQ7  DIM       1      1        249   Secure Q7                          
.MHHNHVER  DIM       3      3        250   Honos Version (cat hv)             
.MHHNLD3A  DIM       3      3        253   LD Question 3A (Cat hl)            
.MHHNRDAT  DIM       8      8        256   Review Date (CCYYMMDD)             
.MHHNRFMV  DIM       2      2        264   ADOM Mandated / Voluntary
.                                         M = Mandated
.                                         V = Voluntary
.MHHNDAYS  DIM       2      2        266   ADOM Number of Days covered (7-28)
.MHHNCEPS  DIM       2      2        268   ADOM Co-existing Problems (Yes/No)
.                                         1 = Yes
.                                         0 = No
.MHHNAM01  DIM       2      2        270   ADOM Q1
.MHHNAM02  DIM       2      2        272   ADOM Q2
.MHHNAM03  DIM       2      2        274   ADOM Q3
.MHHNAM04  DIM       2      2        276   ADOM Q4
.MHHNAM05  DIM       2      2        278   ADOM Q5
.MHHNAM06  DIM       2      2        280   ADOM Q6
.MHHNAM7A  DIM       2      2        282   ADOM Q7a
.MHHNAM7B  DIM       2      2        284   ADOM Q7b
.MHHNAM7C  DIM       2      2        286   ADOM Q7c
.MHHNAM7D  DIM       2      2        288   ADOM Q7d
.MHHNAM7E  DIM       2      2        290   ADOM Q7e
.MHHNAM7F  DIM       2      2        292   ADOM Q7f
.MHHNAM08  DIM       2      2        294   ADOM Q8
.MHHNAM9A  DIM       1      1        296   ADOM Q9a
.MHHNAM9B  DIM       1      1        297   ADOM Q9b
.MHHNAM9C  DIM       1      1        298   ADOM Q9c
.MHHNAM10  DIM       2      2        299   ADOM Q10
.MHHNAM11  DIM       1      1        301   ADOM Q11
.MHHNAM12  DIM       2      2        302   ADOM Q12
.MHHNAM13  DIM       2      2        304   ADOM Q13
.MHHNAM14  DIM       2      2        306   ADOM Q14
.MHHNAM15  DIM       2      2        308   ADOM Q15
.MHHNAM16  DIM       2      2        310   ADOM Q16
.MHHNAM17  DIM       2      2        312   ADOM Q17
.MHHNAM18  DIM       2      2        314   ADOM Q18
.MHHNAM19  DIM       2      2        316   ADOM Q19
.MHHNAM20  DIM       2      2        318   ADOM Q20
.MHHNURNO  DIM       8      8        320   U/R Number
OLD1SPAR  DIM       41     41       328   Spare                              
.
.End of Record                      369  
.
.
.Data File Definition
.--------------------
MEHHONA1   IFILE    SQL, FIXED=398, KEY="U1-8,9-16"                             
MEHHONA2   IFILE    SQL, FIXED=398, KEY="U256-263,1-8,9-16"                     
MEHHONA3   IFILE    SQL, FIXED=398, KEY="U1-8,22-29,9-16"                       
MEHHONA4   IFILE    SQL, FIXED=398, KEY="U320-327,1-8,9-16"
.
.Name     Type      Length Physical Start Description
.----     ----      ------ -------- ----- -----------
MHHNVISN  DIM       8      8        1     Visit Number                       
MHHNUNIQ  DIM       8      8        9     Unique Count                       
MHHNHOTY  DIM       3      3        17    HONOS Type (Cat hs)                
MHHNACTV  DIM       1      1        20    Active 1=Yes                       
MHHNSENT  DIM       1      1        21    Sent (1=Yes)                       
MHHNHDAT  DIM       8      8        22    HONOS Date (CCYYMMDD)              
MHHNSSET  DIM       3      3        30    Service Setting (Cat ss)           
MHHNREAS  DIM       3      3        33    Reason for Collection (Cat hp)     
MHHNRHCP  DIM       10     10       36    Responsible HCP (pmshcpaf)         
MHHNCAST  DIM       10     10       46    Case Team (allcasaf)               
MHHNPHCP  DIM       10     10       56    Performing HCP (pmshcpaf)          
MHHNWEBC  DIM       10     10       66    WEB User Created (websecaf)        
MHHNCDTE  DIM       8      8        76    Date Created (CCYYMMDD)            
MHHNCTIM  DIM       8      8        84    Time Created (HH:MM:SS)            
MHHNCOMP  DIM       1      1        92    Completed (1=Yes)                  
MHHNWEBF  DIM       10     10       93    Web User Completed (websecaf)      
MHHNDATF  DIM       8      8        103   Date Completed (CCYYMMDD)          
MHHNTIMF  DIM       8      8        111   Time Completed (HH:MM:SS)          
MHHNWEBU  DIM       10     10       119   Web User ID Updated (websecaf)     
MHHNDATU  DIM       8      8        129   Date Updated (CCYYMMDD)            
MHHNTIMU  DIM       8      8        137   Time Updated (HH:MM:SS)            
MHHNFOCU  DIM       3      3        145   Focus of Care (Cat hf)             
MHHNCULS  DIM       3      3        148   Cultural Support (Cat hc)          
MHHNNGOS  DIM       1      1        151   NGO Support (1=Yes)                
MHHNNGOA  DIM       1      1        152   NGO Support Accommodation (1=Yes)  
MHHNNGOW  DIM       1      1        153   NGO Comm Support Worker (1=Yes)    
MHHNVOCA  DIM       1      1        154   Vocational Assistance (1=Yes)      
MHHNNSNG  DIM       1      1        155   Non Specific NGO Service (1=Yes)   
MHHNCOLS  DIM       3      3        156   Collection Status (Cat ht)         
MHHNMODA  DIM       3      3        159   Mode of Administration (Cat hm)    
MHHNADQ1  DIM       1      1        162   Adult Q1                           
MHHNADQ2  DIM       1      1        163   Adult Q2                           
MHHNADQ3  DIM       1      1        164   Adult Q3                           
MHHNADQ4  DIM       1      1        165   Adult Q4                           
MHHNADQ5  DIM       1      1        166   Adult Q5                           
MHHNADQ6  DIM       1      1        167   Adult Q6                           
MHHNADQ7  DIM       1      1        168   Adult Q7                           
MHHNADQ8  DIM       1      1        169   Adult Q8                           
MHHNAQ8A  DIM       1      1        170   Adult Q8A                          
MHHNFREE  DIM       35     35       171   8A Free Text                       
MHHNADQ9  DIM       1      1        206   Adult Q9                           
MHHNAQ10  DIM       1      1        207   Adult Q10                          
MHHNAQ11  DIM       1      1        208   Adult Q11                          
MHHNAQ12  DIM       1      1        209   Adult Q12                          
MHHNCYQ1  DIM       1      1        210   Child and Youth Q1                 
MHHNCYQ2  DIM       1      1        211   Child and Youth Q2                 
MHHNCYQ3  DIM       1      1        212   Child and Youth Q3                 
MHHNCYQ4  DIM       1      1        213   Child and Youth Q4                 
MHHNCYQ5  DIM       1      1        214   Child and Youth Q5                 
MHHNCYQ6  DIM       1      1        215   Child and Youth Q6                 
MHHNCYQ7  DIM       1      1        216   Child and Youth Q7                 
MHHNCYQ8  DIM       1      1        217   Child and Youth Q8                 
MHHNCYQ9  DIM       1      1        218   Child and Youth Q9                 
MHHNCQ10  DIM       1      1        219   Child and Youth Q10                
MHHNCQ11  DIM       1      1        220   Child and Youth Q11                
MHHNCQ12  DIM       1      1        221   Child and Youth Q12                
MHHNCQ13  DIM       1      1        222   Child and Youth Q13                
MHHNCQ14  DIM       1      1        223   Child and Youth Q14                
MHHNCQ15  DIM       1      1        224   Child and Youth Q15                
MHHNLDQ1  DIM       1      1        225   Learning Disabilities Q1           
MHHNLDQ2  DIM       1      1        226   Learning Disabilities Q2           
MHHNLDQ3  DIM       1      1        227   Learning Disabilities Q3           
MHHNLDQ4  DIM       1      1        228   Learning Disabilities Q4           
MHHNLDQ5  DIM       1      1        229   Learning Disabilities Q5           
MHHNLDQ6  DIM       1      1        230   Learning Disabilities Q6           
MHHNLDQ7  DIM       1      1        231   Learning Disabilities Q7           
MHHNLDQ8  DIM       1      1        232   Learning Disabilities Q8           
MHHNLDQ9  DIM       1      1        233   Learning Disabilities Q9           
MHHNLQ10  DIM       1      1        234   Learning Disabilities Q10          
MHHNLQ11  DIM       1      1        235   Learning Disabilities Q11          
MHHNLQ12  DIM       1      1        236   Learning Disabilities Q12          
MHHNLQ13  DIM       1      1        237   Learning Disabilities Q13          
MHHNLQ14  DIM       1      1        238   Learning Disabilities Q14          
MHHNLQ15  DIM       1      1        239   Learning Disabilities Q15          
MHHNLQ16  DIM       1      1        240   Learning Disabilities Q16          
MHHNLQ17  DIM       1      1        241   Learning Disabilities Q17          
MHHNLQ18  DIM       1      1        242   Learning Disabilities Q18          
MHHNSCQ1  DIM       1      1        243   Secure Q1                          
MHHNSCQ2  DIM       1      1        244   Secure Q2                          
MHHNSCQ3  DIM       1      1        245   Secure Q3                          
MHHNSCQ4  DIM       1      1        246   Secure Q4                          
MHHNSCQ5  DIM       1      1        247   Secure Q5                          
MHHNSCQ6  DIM       1      1        248   Secure Q6                          
MHHNSCQ7  DIM       1      1        249   Secure Q7                          
MHHNHVER  DIM       3      3        250   Honos Version (cat hv)             
MHHNLD3A  DIM       3      3        253   LD Question 3A (Cat hl)            
MHHNRDAT  DIM       8      8        256   Review Date (CCYYMMDD)             
MHHNRFMV  DIM       2      2        264   ADOM Mandated / Voluntary
.                                         M = Mandated
.                                         V = Voluntary
MHHNDAYS  DIM       2      2        266   ADOM Number of Days covered (7-28)
MHHNCEPS  DIM       2      2        268   ADOM Co-existing Problems (Yes/No)
.                                         1 = Yes
.                                         0 = No
MHHNAM01  DIM       2      2        270   ADOM Q1
MHHNAM02  DIM       2      2        272   ADOM Q2
MHHNAM03  DIM       2      2        274   ADOM Q3
MHHNAM04  DIM       2      2        276   ADOM Q4
MHHNAM05  DIM       2      2        278   ADOM Q5
MHHNAM06  DIM       2      2        280   ADOM Q6
MHHNAM7A  DIM       2      2        282   ADOM Q7a
MHHNAM7B  DIM       2      2        284   ADOM Q7b
MHHNAM7C  DIM       2      2        286   ADOM Q7c
MHHNAM7D  DIM       2      2        288   ADOM Q7d
MHHNAM7E  DIM       2      2        290   ADOM Q7e
MHHNAM7F  DIM       2      2        292   ADOM Q7f
MHHNAM08  DIM       2      2        294   ADOM Q8
MHHNAM9A  DIM       1      1        296   ADOM Q9a
MHHNAM9B  DIM       1      1        297   ADOM Q9b
MHHNAM9C  DIM       1      1        298   ADOM Q9c
MHHNAM10  DIM       2      2        299   ADOM Q10
MHHNAM11  DIM       1      1        301   ADOM Q11
MHHNAM12  DIM       2      2        302   ADOM Q12
MHHNAM13  DIM       2      2        304   ADOM Q13
MHHNAM14  DIM       2      2        306   ADOM Q14
MHHNAM15  DIM       2      2        308   ADOM Q15
MHHNAM16  DIM       2      2        310   ADOM Q16
MHHNAM17  DIM       2      2        312   ADOM Q17
MHHNAM18  DIM       2      2        314   ADOM Q18
MHHNAM19  DIM       2      2        316   ADOM Q19
MHHNAM20  DIM       2      2        318   ADOM Q20
MHHNURNO  DIM       8      8        320   U/R Number
MHHNDELF  DIM       1      1        328   Delete Flag
.                                         0 or blank = not deleted
.                                         1 = deleted
MHHNDUID  DIM       10     10       329   User who deleted assessment
MHHNDDTE  DIM       8      8        339   Date assessment deleted
MHHNDTME  DIM       8      8        347   Time assessment deleted
MHHNDRES  DIM       3      3        355   Reason for delete
MHHNSPAR  DIM       40     40       358   Spare
.
.End of Record                      398  
.
.
. LOCAL VARIABLES
. ---------------
CMDLINE   DIM       200
DEFPATH   DIM       60
DIM60     DIM       60
DISNUM    FORM      4
INPFILE   DIM       8
NEWFILE   DIM       60
NEWPATH   DIM       60
OLDPATH   DIM       60
RECNUM    FORM      8
SAVEFLG   FORM      1
.
.
. PROGRAM CONSTANTS
. -----------------
SP60      INIT    "                                                            "
.
.
PRGNAM    INIT      "CONVERSION MEHHONFD"
PRGID     INIT      "F06MHHON"
VERSION   INIT      "V12.00.00"
+
.*****************************************************************************
.*                             MAIN0000                                      *
.*                         Program Mainline                                  *
.*****************************************************************************
.
MAIN0000  CALL      INIT0000                      * init and open files
          BRANCH    EXIT,MAIN9999                 * init failure
.
          CALL      OPTN0000                      * get option
          BRANCH    COPTION,MAIN1000              * run c-isam fixit
          GOTO      MAIN9999                      * exit selected
.
MAIN1000  CALL      KDIR0000                      * Keyin directory
          BRANCH    EXIT,MAIN9999
.
          CALL      CONTQST                       * Ok to continue ?
          BRANCH    CEXIT,MAIN5000:               * yes
                          MAIN0000:               * no
                          MAIN9999                * cancel
.
.         Running c-isam fix
.
MAIN5000  CALL      PREP0000                      * preparing files
          BRANCH    EXIT,MAIN9999
.
          CALL      READ0000                      * read old records and write
          CALL      ENDP0000                      * save/zip saved file
.
MAIN9999  CHAIN     PGM
+
.********************************************************************
.*                          INIT0000                                *
.*  Display heading and check that the files needed exist&open them *
.********************************************************************
.
INIT0000  CALL      DISPHEAD
          MOVE      ZERO,RECNUM
          MOVE      ZERO,DISNUM
.         
INIT9999  RETURN
+
.*****************************************************************************
.*                                OPTN0000             Called by: MAIN0000   *
.*                        Get user options or exit                           *
.*    Returns:  EXIT    = FALSE (0)  Ok to proceed                           *
.*                        TRUE  (1)  Exit option selected                    *
.*              COPTION - option selected                                    *
.*****************************************************************************
.
OPTN0000  DISPLAY   *P1:3,*EF,*P1:4,*V2LON,ZERO,*HOFF,". Exit":
                    *P1:5,*V2LON,ONE,*HOFF,". Run Fixit (c-isam only)"
.
OPTN0500  KEYIN     *P1:7,*EL,"Select Option : ":
                    *P17:7,*V2LON,COPTION
.
          COMPARE   ZERO,COPTION                 * exit selected ?
          GOTO      OPTN9500 IF EQUAL            * yes
.
          BRANCH    COPTION,OPTN9000             * run c-isam fixit
.
          BEEP
          GOTO      OPTN0500
.
OPTN9000  MOVE      ZERO,EXIT
          GOTO      OPTN9999
.
OPTN9500  MOVE      ONE,EXIT
.
OPTN9999  RETURN
+
.********************************************************************
.*                          KDIR0000                                *
.*  Keyin directories                                               *
.********************************************************************
.
KDIR0000  MOVE      ONE,SAVEFLG        * Default to keep file
          KEYIN     *P1:10,*EL,"Do you want to save the original file (Y/N) ? ":
                    ANS;
          REP       "yYnN",ANS
          CMATCH    "Y",ANS
          GOTO      KDIR1000 IF EQUAL
          MOVE      ZERO,SAVEFLG       * not to keep file
          CMATCH    "N",ANS
          GOTO      KDIR1000 IF EQUAL
          BEEP
          GOTO      KDIR0000
.
KDIR1000  CALL      DEFT0000                * Get the default path
          BRANCH    EXIT,KDIR9999
          MOVE      SP60,OLDPATH
.
          DISPLAY   *P1:24,*EL,"The directory path must end with a slash (/) ";
.
          MOVE      DEFPATH,OLDPATH
          BRANCH    SAVEFLG,KDIR2000
.
.         Keyin the path for the original file
.
          KEYIN     *P1:12,*EL,"Keyin path for temporarily saving original ":
                    "file: ":
                    *P10:13,*EL,*DV,*RV,OLDPATH:
                    *P10:13,OLDPATH;
          GOTO      KDIR3000
.
KDIR2000  KEYIN     *P1:12,*EL,"Keyin path for saving original file: ":
                    *P10:13,*EL,*DV,*RV,OLDPATH:
                    *P10:13,OLDPATH;
.
KDIR3000  ENDSET    OLDPATH
          APPEND    SP60,OLDPATH
          RESET     OLDPATH
.
          MATCH     SP60,OLDPATH
          IF        @EQUAL
            PACK      OLDPATH,DEFPATH      * use the default
            DISPLAY   *P10:13,*EL,*V2LON,OLDPATH;
          ENDIF
.
          SQUEEZE   OLDPATH
          CMATCH    EXITCHAR,OLDPATH
          GOTO      KDIR9000 IF EQUAL
.
          PACK      DIM60,OLDPATH,SP60
          CALL      VALD0000         * check if it's a valid directory
          BRANCH    EXIT,KDIR1000
.
.         Keyin the path for the new file
.
KDIR5000  MOVE      SP60,NEWPATH
          MOVE      DEFPATH,NEWPATH
          KEYIN     *P1:15,*EL,"Keyin path for the new file: ":
                    *P10:16,*EL,*DV,*RV,NEWPATH:
                    *P10:16,NEWPATH;
          ENDSET    NEWPATH
          APPEND    SP60,NEWPATH
          RESET     NEWPATH
.
          MATCH     SP60,NEWPATH
          IF        @EQUAL
            PACK      NEWPATH,DEFPATH      * use the default
            DISPLAY   *P10:16,*V2LON,NEWPATH;
          ENDIF
.
          SQUEEZE   NEWPATH
          CMATCH    EXITCHAR,NEWPATH
          GOTO      KDIR9000 IF EQUAL
.
          PACK      DIM60,NEWPATH,SP60
          CALL      VALD0000         * check if it's a valid directory
          BRANCH    EXIT,KDIR5000
          GOTO      KDIR9999
.
KDIR9000  MOVE      ONE,EXIT
.
KDIR9999  DISPLAY   *P1:24,*EL;
          RETURN
+
.********************************************************************
.*                          PREP0000                                *
.*  Preparing files                                                 *
.********************************************************************
.
PREP0000  MOVE      "mehhonaf",INPFILE
          CALL      CHEK0000             * check file exists or has been changed
          BRANCH    EXIT,PREP9000
.
          CLOSE     OLDFILE1
          DISPLAY   *P1:24,*EL,"Copying files ... Please wait !! ";
.
.         Copy old file to the keyin directory
.
          PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          APPEND    "cp `ldat mehhonaf.dat` ",CMDLINE
          APPEND    OLDPATH,CMDLINE
          APPEND    "smhhonaf.dat",CMDLINE
          APPEND    SP60,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CMATCH    "0",TASKID
          IF        !@EQUAL
            GOTO      PREP8000
          ENDIF
.
          PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          APPEND    "cp `ldat mehhonaf.idx` ",CMDLINE
          APPEND    OLDPATH,CMDLINE
          APPEND    "smhhonaf.idx",CMDLINE
          APPEND    SP60,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CMATCH    "0",TASKID
          IF        !@EQUAL
            GOTO      PREP8000
          ENDIF
.
.         Remove the original files
.
          PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          APPEND    "iserase ",CMDLINE
          APPEND    DEFPATH,CMDLINE
          APPEND    "mehhonaf",CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CMATCH    "0",TASKID
          IF        !@EQUAL
            DISPLAY   *P1:24,*EL,*B,"Unable to remove the original file.  ";
            CALL      HITENTER
            GOTO      PREP9000
          ENDIF
.
.         Opening old file after being copied
.
          MOVE      SP60,DIM60
          CLEAR     DIM60
          APPEND    OLDPATH,DIM60
          APPEND    "smhhonaf",DIM60
          APPEND    SP60,DIM60
          RESET     DIM60
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      OLDFILE1,DIM60
          TRAPCLR   IO
          IF        OVRCD = 1
            DISPLAY   *P1:24,*EL,*B,"Unable to open saved original file.  ";
            CALL      HITENTER
            GOTO      PREP9000
          ENDIF
.
.         Create the new file
.
          DISPLAY   *P1:24,*EL,"Creating new files ... Please wait !! ";
          PACK      NEWFILE,SP60
          CLEAR     NEWFILE
          APPEND    NEWPATH,NEWFILE
          APPEND    "mehhonaf",NEWFILE
          APPEND    SP60,NEWFILE
          RESET     NEWFILE
          SQUEEZE   NEWFILE
.
PREP1000  PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          APPEND    "isbuild ",CMDLINE
          APPEND    NEWFILE,CMDLINE
          APPEND    " 398 UC1-8,9-16",CMDLINE
          APPEND    SP60,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          APPEND    "isadd ",CMDLINE
          APPEND    NEWFILE,CMDLINE
          APPEND    " UC256-263,1-8,9-16",CMDLINE
          APPEND    SP60,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          APPEND    "isadd ",CMDLINE
          APPEND    NEWFILE,CMDLINE
          APPEND    " UC1-8,22-29,9-16",CMDLINE
          APPEND    SP60,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          APPEND    "isadd ",CMDLINE
          APPEND    NEWFILE,CMDLINE
          APPEND    " UC320-327,1-8,9-16",CMDLINE
          APPEND    SP60,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          OPEN      MEHHONA1,NEWFILE
.
          CLEAR     DIM60
          APPEND    NEWPATH,DIM60
          APPEND    "urreport.txt",DIM60
          RESET     DIM60
          PREP      REPORTF1,DIM60
.
          DISPLAY   *P1:24,*EL;
          MOVE      ZERO,EXIT
          CALL      IBACLOCK
          REP       " 0",CDATE
          DISPLAY   *P1:18,"Started : ",CDATE,SP1,CTIMEIS:
                    *P1:20,"Record : "
          GOTO      PREP9999
.
PREP5000  DISPLAY   *P1:24,*EL,*B,"Old file not found.  ";
          CALL      HITENTER
          GOTO      PREP9000
.
PREP8000  DISPLAY   *P1:24,*EL,*B,"Unable to copy original file.  ":
                    "(Error: ",TASKID,")  ";
          CALL      HITENTER
.
PREP9000  MOVE      ONE,EXIT
.
PREP9999  RETURN
+
.********************************************************************
.*                          CHEK0000                                *
.*  Check if file exists, or has already been converted             *
.********************************************************************
.
CHEK0000  MOVE      ZERO,EXIT
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND GIVING DIM60 IF IO
          OPEN      OLDFILE1,INPFILE
          TRAPCLR   IO
          BRANCH    OVRCD,CHEK2000       * Original file does not exist
          CLOSE     OLDFILE1
          GOTO      CHEK9999
.
CHEK2000  RESET     DIM60
          SCAN      "I * I",DIM60
          DISPLAY   *P1:23,*EF,"File '",INPFILE,"' ";
          IF        @EQUAL
            DISPLAY   "does not exist - ";
          ELSE
            RESET     DIM60
            SCAN      "I * L",DIM60
            IF        @EQUAL
              DISPLAY   "has already been converted - ";
            ELSE
              DISPLAY   "has caused an IO error - ";
            ENDIF
          ENDIF
          DISPLAY   "File will be bypassed"
.
          CALL      HITENTER
          DISPLAY   *P1:23,*EF;
.
CHEK9000  MOVE      ONE,EXIT
.
CHEK9999  RETURN
+
.**********************************************************************
.*                               READ0000                             *
.*             loop thru old file and write each record               *
.**********************************************************************
.
READ0000  DISPLAY   *P1:20,*EL,"Record No. : ";
.
          PACK      KEY16,SP60
          CALL      READSOLD                      * position at start
READ1000  CALL      READKOLD                      * read next record
          BRANCH    OVRCD,READ6000                * no more records
.
          ADD       ONE,RECNUM                    * update record counter
          ADD       ONE,DISNUM                    * Display counter
.
          IF        DISNUM = 5000  | RECNUM = 1
            MOVE      ZERO,DISNUM
            DISPLAY   *P15:20,*V2LON,RECNUM
          ENDIF
.
.  All necessary changes to the files field lengths, date changes
.  or any other sort of modification must be made here
.
          MOVE      ZERO,MHHNDELF
          PACK      MHHNDUID,SP70
          PACK      MHHNDDTE,SP70
          PACK      MHHNDTME,SP70
          PACK      MHHNDRES,SP70
          PACK      MHHNSPAR,SP70
.
          PACK      KEY16,MHHNVISN,MHHNUNIQ,SP70
.                                                 
          CALL      WRMHHON1 
          GOTO      READ1000
.
READ6000  CLOSE     MEHHONA1                      
          CLOSE     OLDFILE1                      
          CLOSE     REPORTF1
.
          CALL      IBACLOCK
          REP       " 0",CDATE
          DISPLAY   *P15:20,*V2LON,RECNUM,*HOFF:
                    *P1:22,"Ended  : ",CDATE,SP1,CTIMEIS:
                    *P1:24;
.
READ9999  RETURN
+
.**********************************************************************
.*                               VALD0000                             *
.*        Check if it a valid directory                               *
.**********************************************************************
.
VALD0000  MOVE      ZERO,EXIT
.
          SQUEEZE   DIM60
          ENDSET    DIM60
          CMATCH    SLASH,DIM60
          IF        !@EQUAL
            DISPLAY   *P1:24,*EL,*B,"Directory path must end with a slash (/) ";
            CALL      HITENTER
            GOTO      VALD9000
          ENDIF
          RESET     DIM60
.
          PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          APPEND    "cd ",CMDLINE
          APPEND    DIM60,CMDLINE
          APPEND    SP60,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID      * check if exists
.
          CMATCH    "0",TASKID
          IF        !@EQUAL
            DISPLAY   *P1:24,*EL,*B,"Directory does not exist ";
            CALL      HITENTER
            GOTO      VALD9000
          ENDIF
          GOTO      VALD9999
.
VALD9000  MOVE      ONE,EXIT            * Not valid
.
VALD9999  RETURN
+
.**********************************************************************
.*                               ENDP0000                             *
.*        Remove or zip save file                                     *
.**********************************************************************
.
ENDP0000  MOVE      SP60,DIM60
          CLEAR     DIM60
          APPEND    OLDPATH,DIM60        * set up the saved file with path
          APPEND    "smhhonaf*",DIM60
          APPEND    SP60,DIM60
          RESET     DIM60
          SQUEEZE   DIM60
.
          PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          IF        SAVEFLG = 1
            APPEND    "gzip -f ",CMDLINE
            APPEND    DIM60,CMDLINE
            APPEND    SP60,CMDLINE
            RESET     CMDLINE
            DISPLAY   *P1:24,*EL,"Compressing original file.. ":
                      "Please wait !!  ";
          ELSE
            APPEND    "rm ",CMDLINE
            APPEND    DIM60,CMDLINE
            APPEND    SP60,CMDLINE
            RESET     CMDLINE
            DISPLAY   *P1:24,*EL,"Removing original file.. Please wait !!  ";
          ENDIF
          EXECUTE   CMDLINE,TASKID      * check if exists
.
          CMATCH    "0",TASKID
          IF        !@EQUAL
            DISPLAY   *P1:24,*EL,*B,"Saved file not zipped or removed.  ";
            CALL      HITENTER
            GOTO      ENDP9999
          ENDIF
.
          CALL      IBACLOCK
          REP       " 0",CDATE
          DISPLAY   *P1:24,*EL,*B,"Finished processing  ",CDATE,SP1,CTIMEIS:
                    ".  ";
          CALL      HITENTER
.
ENDP9999  RETURN
+
.**********************************************************************
.*        DEFT0000 -  Get the default directory                       *
.**********************************************************************
.
DEFT0000  EXECUTE   "ldat mehhonaf.dat > temp.txt",TASKID
.
          PACK      DEFPATH,SP30,SP30
          CLOSE     FINDFILE
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      FINDFILE,"temp"
          TRAPCLR   IO
          BRANCH    OVRCD,DEFT3000
.
          READ      FINDFILE,SEQ;DEFPATH
          GOTO      DEFT3000 IF OVER
.
          ENDSET    DEFPATH
DEFT1000  CMATCH    "/",DEFPATH
          GOTO      DEFT2000 IF EQUAL
.
          BUMP      DEFPATH,-1
          GOTO      DEFT1000 IF NOT EOS
          GOTO      DEFT3000
.
DEFT2000  LENSET    DEFPATH
          RESET     DEFPATH
.
          PACK      DEFPATH,DEFPATH,SP30,SP30,SP30,SP30
          STRIP     DEFPATH
          ENDSET    DEFPATH
          RESET     DEFPATH
          CLOSE     FINDFILE
          MOVE      ZERO,EXIT
          GOTO      DEFT9999
.
DEFT3000  DISPLAY   *P1:24,*EL,*B,"Error finding 'mehhonaf'.  ";
          CALL      HITENTER
          CLOSE     FINDFILE
          MOVE      ONE,EXIT
.
DEFT9999  RETURN
+
.*****************************************************************************
.*        I/O Routines                                                       *
.*****************************************************************************
.
. MEHHONIO    
. --------
. Filename     : mehhonaf.dat
.
READSOLD  RESET     KEY16                                                       
          READ      OLDFILE1,KEY16;;                                            
          RETURN
.
READKOLD  MOVE      ZERO,OVRCD
          READKS    OLDFILE1;MHHNVISN,MHHNUNIQ,MHHNHOTY,MHHNACTV,MHHNSENT:
                        MHHNHDAT,MHHNSSET,MHHNREAS,MHHNRHCP,MHHNCAST,MHHNPHCP:
                        MHHNWEBC,MHHNCDTE,MHHNCTIM,MHHNCOMP,MHHNWEBF,MHHNDATF:
                        MHHNTIMF,MHHNWEBU,MHHNDATU,MHHNTIMU,MHHNFOCU,MHHNCULS:
                        MHHNNGOS,MHHNNGOA,MHHNNGOW,MHHNVOCA,MHHNNSNG,MHHNCOLS:
                        MHHNMODA,MHHNADQ1,MHHNADQ2,MHHNADQ3,MHHNADQ4,MHHNADQ5:
                        MHHNADQ6,MHHNADQ7,MHHNADQ8,MHHNAQ8A,MHHNFREE,MHHNADQ9:
                        MHHNAQ10,MHHNAQ11,MHHNAQ12,MHHNCYQ1,MHHNCYQ2,MHHNCYQ3:
                        MHHNCYQ4,MHHNCYQ5,MHHNCYQ6,MHHNCYQ7,MHHNCYQ8,MHHNCYQ9:
                        MHHNCQ10,MHHNCQ11,MHHNCQ12,MHHNCQ13,MHHNCQ14,MHHNCQ15:
                        MHHNLDQ1,MHHNLDQ2,MHHNLDQ3,MHHNLDQ4,MHHNLDQ5,MHHNLDQ6:
                        MHHNLDQ7,MHHNLDQ8,MHHNLDQ9,MHHNLQ10,MHHNLQ11,MHHNLQ12:
                        MHHNLQ13,MHHNLQ14,MHHNLQ15,MHHNLQ16,MHHNLQ17,MHHNLQ18:
                        MHHNSCQ1,MHHNSCQ2,MHHNSCQ3,MHHNSCQ4,MHHNSCQ5,MHHNSCQ6:
                        MHHNSCQ7,MHHNHVER,MHHNLD3A,MHHNRDAT,MHHNRFMV,MHHNDAYS:
                        MHHNCEPS,MHHNAM01,MHHNAM02,MHHNAM03,MHHNAM04,MHHNAM05:
                        MHHNAM06,MHHNAM7A,MHHNAM7B,MHHNAM7C,MHHNAM7D,MHHNAM7E:
                        MHHNAM7F,MHHNAM08,MHHNAM9A,MHHNAM9B,MHHNAM9C,MHHNAM10:
                        MHHNAM11,MHHNAM12,MHHNAM13,MHHNAM14,MHHNAM15,MHHNAM16:
                        MHHNAM17,MHHNAM18,MHHNAM19,MHHNAM20,MHHNURNO,OLD1SPAR
          GOTO      OVERCOND IF OVER
          RETURN
.
.
. MEHHONIO    
. --------
. Filename     : mehhonaf.dat
.
WRMHHON1  RESET     KEY16                                                       
          WRITE     MEHHONA1,KEY16;MHHNVISN,MHHNUNIQ,MHHNHOTY,MHHNACTV,MHHNSENT:
                        MHHNHDAT,MHHNSSET,MHHNREAS,MHHNRHCP,MHHNCAST,MHHNPHCP:  
                        MHHNWEBC,MHHNCDTE,MHHNCTIM,MHHNCOMP,MHHNWEBF,MHHNDATF:  
                        MHHNTIMF,MHHNWEBU,MHHNDATU,MHHNTIMU,MHHNFOCU,MHHNCULS:  
                        MHHNNGOS,MHHNNGOA,MHHNNGOW,MHHNVOCA,MHHNNSNG,MHHNCOLS:  
                        MHHNMODA,MHHNADQ1,MHHNADQ2,MHHNADQ3,MHHNADQ4,MHHNADQ5:  
                        MHHNADQ6,MHHNADQ7,MHHNADQ8,MHHNAQ8A,MHHNFREE,MHHNADQ9:  
                        MHHNAQ10,MHHNAQ11,MHHNAQ12,MHHNCYQ1,MHHNCYQ2,MHHNCYQ3:  
                        MHHNCYQ4,MHHNCYQ5,MHHNCYQ6,MHHNCYQ7,MHHNCYQ8,MHHNCYQ9:  
                        MHHNCQ10,MHHNCQ11,MHHNCQ12,MHHNCQ13,MHHNCQ14,MHHNCQ15:  
                        MHHNLDQ1,MHHNLDQ2,MHHNLDQ3,MHHNLDQ4,MHHNLDQ5,MHHNLDQ6:  
                        MHHNLDQ7,MHHNLDQ8,MHHNLDQ9,MHHNLQ10,MHHNLQ11,MHHNLQ12:  
                        MHHNLQ13,MHHNLQ14,MHHNLQ15,MHHNLQ16,MHHNLQ17,MHHNLQ18:  
                        MHHNSCQ1,MHHNSCQ2,MHHNSCQ3,MHHNSCQ4,MHHNSCQ5,MHHNSCQ6:  
                        MHHNSCQ7,MHHNHVER,MHHNLD3A,MHHNRDAT,MHHNRFMV,MHHNDAYS:
                        MHHNCEPS,MHHNAM01,MHHNAM02,MHHNAM03,MHHNAM04,MHHNAM05:
                        MHHNAM06,MHHNAM7A,MHHNAM7B,MHHNAM7C,MHHNAM7D,MHHNAM7E:
                        MHHNAM7F,MHHNAM08,MHHNAM9A,MHHNAM9B,MHHNAM9C,MHHNAM10:
                        MHHNAM11,MHHNAM12,MHHNAM13,MHHNAM14,MHHNAM15,MHHNAM16:
                        MHHNAM17,MHHNAM18,MHHNAM19,MHHNAM20,MHHNURNO,MHHNDELF:
                        MHHNDUID,MHHNDDTE,MHHNDTME,MHHNDRES,MHHNSPAR
          RETURN
.
...............................................................................
.
          INC       STD001IO

.-----------------------------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.00.00"
.-------------------------------------------------------
. V9.02.00  04.07.2002  Glenn Saunders
.           Export to new release i.e. v9.02 from r5.09
.-----------------------------------------------------------------------------
. V6.00.02  14.03.1996 B.G.Ackland
.           Split Cost Models
. V6.00.01  16.12.1993 B.G.Ackland
.           Day Case Only
.-----------------------------------------------------------------------------
FLGSPL1   FORM      1
FLGSPL2   FORM      1
.
CSTFDR    FORM      12.2
CSTFID    FORM      12.2
CSTVDR    FORM      12.2
CSTVID    FORM      12.2
.
INCFDR    FORM      12.2
INCFID    FORM      12.2
INCVDR    FORM      12.2
INCVID    FORM      12.2
.
COUNTER   FORM      6
FILENAME  DIM       8
COMMAND   DIM       80
ISBUILD   INIT      "isbuild "
.
CCSTMPA1  IFILE    SQL, FIXED=21, KEY="U1-10,11-20"
.
CCTMSEQ   DIM       10     10       1     * Sequence
CCTMLV1   DIM       10     10       11    * Casemix Code
.
.End of Record                      21
.
TOTALEXT  FORM      8
F12P4     FORM      12.4
.-----------------------------------------
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBACCR69
.   Function      :   Casemix Extract Consolidation           
.   Generated  On :   08/07/2002
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       CCSCEAFD/INC
          INC       CCSCEBFD/INC
          INC       CCSCECFD/INC
          INC       CCSCEDFD/INC
          INC       CCSCEEFD/INC
          INC       CCSCEFFD/INC
          INC       CCSCEGFD/INC
          INC       CCSHCDFD/INC
          INC       CCSRBDFD/INC
          INC       CCSSTYFD/INC
          INC       CCSXHDFD/INC
.=========================
.Local Variable Definition
.-------------------------
NOCODLV1  FORM      3 * Scr 00 Fld     5
NOCODLV2  FORM      3 * Scr 00 Fld     6
NOCODLV3  FORM      3 * Scr 00 Fld     7
DAYCDESC  DIM      25 * Scr 00 Fld     9
FROMDD    DIM      10 * Scr 00 Fld    21
TODD      DIM      10 * Scr 00 Fld    22
FROMAD    DIM      10 * Scr 00 Fld    23
TOAD      DIM      10 * Scr 00 Fld    24
VISITDES  DIM      15 * Scr 00 Fld    25
FROMCMOD  DIM      35 * Scr 00 Fld    28
TOCMOD    DIM      35 * Scr 00 Fld    29
REPTSEQ   FORM      2 * Scr 00 Fld    32
SEQDESC   DIM      30 * Scr 00 Fld    33
CLV1DES   DIM      35 * Scr 00 Fld    40
CLV2DES   DIM      35 * Scr 00 Fld    41
CLV3DES   DIM      35 * Scr 00 Fld    42
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBACCR69"
PRGNAM    INIT      "Casemix Extract Consolidation           "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      SC00L000
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          DISPLAY   *P56:24,"Opening ccsceaaf";
          OPEN      CCSCEAA1,"ccsceaaf"
          DISPLAY   *P56:24,"Opening ccshcdaf";
          OPEN      CCSHCDA1,"ccshcdaf"
          DISPLAY   *P56:24,"Opening ccshcdaf";
          OPEN      CCSHCDA2,"ccshcdaf"
          DISPLAY   *P56:24,"Opening ccsstyaf";
          OPEN      CCSSTYA1,"ccsstyaf"
          DISPLAY   *P56:24,"Opening ccsxhdaf";
          OPEN      CCSXHDA1,"ccsxhdaf"
          DISPLAY   *P56:24,"Opening ccsxhdaf";
          OPEN      CCSXHDA2,"ccsxhdaf"
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "00",SCRID
          IF         @EQUAL
            CALL       PS00L000   * Options                            
          ENDIF
          RETURN
.--------------------------------
. Screen - Options                            
.--------------------------------
SC00L000
SC00L100
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC00L200
          CALL      CF00L000 * Clear Fields
          CALL      MVACCEPT
SC00L300
          CALL      KY00L000 * Enter Key Fields
          BRANCH    EXIT,SC00L999,SC00L999
SC00L400
          CALL      WP00L000 * Load any WP Details
SC00L500
          CALL      LM00L000 * Load any Batch Details
SC00L600
          CALL      DF00L000 * Display Fields
SC00L700
          CALL      SF00L000 * Select Fields
          BRANCH    EXIT,SC00L100,SC00L100,SC00L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC00L800
SC00L900
SC00L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Options                            
.-------------------------------------------------------
CF00L000
          MOVE      SP70,CCEAEID 
          MOVE      ZERO,NOCODLV1
          MOVE      ZERO,NOCODLV2
          MOVE      ZERO,NOCODLV3
          MOVE      SP70,DAYCDESC
          MOVE      SP70,CCEADES 
          MOVE      SP70,CCEAINC 
          MOVE      SP70,CCEAVIS 
          MOVE      SP70,CCEADAY 
          MOVE      SP70,CCEALV1 
          MOVE      SP70,CCEALV2 
          MOVE      SP70,CCEALV3 
          MOVE      SP70,CCEAFCM 
          MOVE      SP70,CCEAFYR 
          MOVE      SP70,CCEATCM 
          MOVE      SP70,CCEATYR 
          MOVE      SP70,FROMDD  
          MOVE      SP70,TODD    
          MOVE      SP70,FROMAD  
          MOVE      SP70,TOAD    
          MOVE      SP70,VISITDES
          MOVE      SP70,CCHCDES 
          MOVE      SP70,FROMCMOD
          MOVE      SP70,TOCMOD  
          MOVE      ZERO,REPTSEQ 
          MOVE      SP70,SEQDESC 
          MOVE      SP70,CLV1DES 
          MOVE      SP70,CLV2DES 
          MOVE      SP70,CLV3DES 
CF00L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Options                            
.--------------------------------------------------------
KY00L000
.
KY00L110
.
.
          MOVE      "   10",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CCEADES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   11",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CCEAINC 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   12",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CCEAVIS 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   14",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CCEALV1 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   15",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CCEALV2 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   16",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CCEALV3 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   22",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TODD    
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   23",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,FROMAD  
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   24",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOAD    
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   25",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,VISITDES
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   27",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CCHCDES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   28",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,FROMCMOD
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   29",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOCMOD  
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   40",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CLV1DES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   41",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CLV2DES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   42",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CLV3DES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL      MVACCEPT
          MOVE      "    4",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "2",CKEYTYP
          CALL      EEID0000
          BRANCH    EXIT,KY00L900,KY00L900
          MOVE      OVRCD,ACCEPT
          MOVE      CCEAEID,VAR      
          CALL      DISPITEM
.
.
          MOVE      "   10",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      CCEADES,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   11",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      NO,YESNO
            MOVE      ZERO,FORM2
            MOVE      CCEAINC,FORM2    
            LOAD      YESNO,FORM2,YES
            MOVE      YESNO,VAR
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   12",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      CCEAVIS,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   14",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      CCEALV1,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   15",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      CCEALV2,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   16",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      CCEALV3,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   22",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TODD,VAR         
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   23",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      FROMAD,VAR       
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   24",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOAD,VAR         
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   25",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      VISITDES,VAR     
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   27",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      CCHCDES,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   28",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      FROMCMOD,VAR     
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   29",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOCMOD,VAR       
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   40",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      CLV1DES,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   41",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      CLV2DES,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   42",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      CLV3DES,VAR      
            CALL      DISPITEM
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      KY00L999
.
KY00L900  MOVE      ONE,EXIT
KY00L999  RETURN
.---------------------------------------------------------
. Load WP files for : Options                            
.---------------------------------------------------------
WP00L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Options                            
.---------------------------------------------------------
LM00L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Options                            
.---------------------------------------------------------
DF00L000
          BRANCH   ACCEPT,DF00L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF00L900
          MATCH    PRGID,SCPSPID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF00L010 IF NOT EQUAL
.
          CALL     PS00L000 * Display Field
          GOTO     DF00L010
DF00L900
DF00L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Options                            
.---------------------------------------------------------
PS00L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS00L999,PS00L999,PS00L999,PS00L999:
                            PS00L101,PS00L102,PS00L103,PS00L999:
                           PS00L104,PS00L105,PS00L106,PS00L107:
                            PS00L108,PS00L109,PS00L110,PS00L111:
                            PS00L112,PS00L113,PS00L114,PS00L115:
                            PS00L116,PS00L117,PS00L118,PS00L119:
                            PS00L120,PS00L999,PS00L121,PS00L122:
                            PS00L123,PS00L999,PS00L999,PS00L124:
                            PS00L125,PS00L999,PS00L999,PS00L999:
                           PS00L999,PS00L999,PS00L999,PS00L126:
                            PS00L127,PS00L128
          GOTO     PS00L999
.
PS00L101
          MOVE      NOCODLV1,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L102
          MOVE      NOCODLV2,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L103
          MOVE      NOCODLV3,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L104
          MOVE      DAYCDESC,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L105
          MOVE      CCEADES,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L106
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      CCEAINC,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L107
          MOVE      CCEAVIS,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L108
          MOVE      CCEADAY,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L109
          MOVE      CCEALV1,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L110
          MOVE      CCEALV2,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L111
          MOVE      CCEALV3,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L112
          MOVE      CCEAFCM,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L113
          MOVE      CCEAFYR,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L114
          MOVE      CCEATCM,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L115
          MOVE      CCEATYR,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L116
          MOVE      FROMDD,VAR       
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L117
          MOVE      TODD,VAR         
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L118
          MOVE      FROMAD,VAR       
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L119
          MOVE      TOAD,VAR         
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L120
          MOVE      VISITDES,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L121
          MOVE      CCHCDES,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L122
          MOVE      FROMCMOD,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L123
          MOVE      TOCMOD,VAR       
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L124
          MOVE      REPTSEQ,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L125
          MOVE      SEQDESC,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L126
          MOVE      CLV1DES,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L127
          MOVE      CLV2DES,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L128
          MOVE      CLV3DES,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
PS00L999
          RETURN
.---------------------------------------------------------
. Selections for : Options                            
.---------------------------------------------------------
SF00L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF00L001  BRANCH   ACCEPT,SF00L020
.
SF00L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L006,SF00L101,SF00L102,SF00L006:
                            SF00L103,SF00L104,SF00L105,SF00L006:
                           SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L106:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                           SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006
SF00L006  BEEP
          GOTO     SF00L005
SF00L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF00L090
          MATCH    PRGID,SCSLPID
          GOTO     SF00L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF00L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L103,SF00L104,SF00L105,SF00L020:
                           SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L106:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                           SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020
          GOTO     SF00L020
SF00L090  MOVE     ZERO,ACCEPT
          GOTO     SF00L001
.
SF00L101
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L102
            MOVE      ZERO,HLEF
            CALL      GETSCR00
          CALL      PROC0000
          MOVE      EXIT,SECTOR
          IF        SECTOR=0
            CALL      FRESCR00
            GOTO      SF00L999
          ENDIF
          IF        SECTOR=1
            CALL      FRESCR00
            MOVE      ZERO,EXIT
            GOTO      SF00L001
          ENDIF
          IF        SECTOR=2
            CALL      FRESCR00
            MOVE      ONE,EXIT
            GOTO      SF00L999
          ENDIF
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      PUTSCR00
          IF        SECTOR=4
            CALL      DF00L000
          ENDIF
          GOTO      SF00L001
.
SF00L103
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      ELV10000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L103
            ENDIF
            BRANCH    EXIT,SF00L103,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      NOCODLV1,VAR     
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L104
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      ELV20000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L104
            ENDIF
            BRANCH    EXIT,SF00L104,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      NOCODLV2,VAR     
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L105
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      ELV30000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L105
            ENDIF
            BRANCH    EXIT,SF00L105,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      NOCODLV3,VAR     
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L106
.
.
          MOVE      "   33",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SEQDESC 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KRSEQ000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L106
            ENDIF
            BRANCH    EXIT,SF00L106,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      REPTSEQ,VAR      
          CALL      DISPITEM
.
.
          MOVE      "   33",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SEQDESC,VAR      
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
SF00L990  MOVE      FOUR,EXIT * Exit Char Exit
SF00L999  RETURN
.@@@@@ Function Restart Point @@@@@
.----------------------------------------
. Move one to accept to for insert mode
.----------------------------------------
MVACCEPT  MOVE      ONE,ACCEPT
          RETURN
.------------------------------------------------------------
. Process Consolidation
.------------------------------------------------------------
PROC0000  MOVE      ZERO,CPAGENO          * Reset Page No.
          CLOCK     TIME,CTIMEIS          * Get Current Time
          MOVE      "99",CLNO             * Initialize Last Line Number
.
          MOVE      ZERO,FLGSPL1          * Flag Split Model Extract False
          MOVE      ZERO,FLGSPL2          * Flag Split Model Extract False
          MATCH     SP70,CCEASCM1
          IF        !@EQUAL
             MATCH    "1",CCEAUST
             IF       !@EQUAL
               MOVE      ONE,FLGSPL1       * Flag Split Model Extract True
               MATCH     SP70,CCEASCM2
               IF        !@EQUAL
                 MOVE      ONE,FLGSPL2     * Flag Split Model Extract True
               ENDIF
             ENDIF
          ENDIF
.
          COMPARE   ZERO,NOCODLV1
          GOTO      PROC1000 IF EQUAL
          CALL      L1CON000              * Consolidate Level 1
          CALL      SUMM0000              * Summarize Extract Again
.
PROC1000  COMPARE   ZERO,NOCODLV2
          GOTO      PROC2000 IF EQUAL
          CALL      L2CON000              * Consolidate Level 2
          CALL      SUMM0000              * Summarize Extract Again
.
PROC2000  COMPARE   ZERO,NOCODLV3
          GOTO      PROC3000 IF EQUAL
          CALL      L3CON000              * Consolidate Level 3
          CALL      SUMM0000              * Summarize Extract Again
.
PROC3000  MATCH     "0",CCEAUST
          GOTO      PROC9999 IF EQUAL   * Update Stats Y or N 0=N
.
          CALL      STAT0000              * Calculate Statistics
.
PROC9999  RETURN
.--------------------------------------------------------
. Level 1 Procesing
.--------------------------------------------------------
L1CON000  CALL      OPNTMP00              * Create Temp File for Sorting
.
          DISPLAY   *P1:24,*EL,"Consolidating Level 1 : ";
          MOVE      ZERO,SECTOR
          PACK      KEY10,SP70
          CALL      RDCCEB1
          IF        OVRCD=0
            CALL      RPCCEB1
          ENDIF
L1CON100  CALL      RKCCEB1
          BRANCH    OVRCD,L1CON199
.
          ADD       ONE,SECTOR
          IF        (SECTOR%100=0)
            DISPLAY   *P33:24,*V2LON,SECTOR
          ENDIF
.
          MATCH     Z70,CCEBLV1             * Ignore Current Other Key Z70
          GOTO      L1CON100 IF EQUAL
.
          IF        FLGSPL1=1
            ASSIGN    CCEBFTC+CCEBFMN+CCEBFMX+CCEBFSV,CCEBFTC
          ENDIF
          IF        FLGSPL1=2
            ASSIGN    CCEBTTC+CCEBTMN+CCEBTMX+CCEBTSV,CCEBTTC
          ENDIF
          LOAD      F10,REPTSEQ,CCEBNEP,CCEBLTO,CCEBFTC,CCEBTTC
          MOVE      F10,KEY10
.
          PACK      KEY20,KEY10,CCEBLV1
          UNPACK    KEY20,CCTMSEQ,CCTMLV1
          CALL      RDCCTM1
          IF        OVRCD=1
            CALL      WRCCTM1
          ENDIF
          GOTO      L1CON100
.
L1CON199  PACK      KEY20,Z70
          MOVE      ZERO,COUNTER
          CALL      RSCCTM1
L1CON200  CALL      RPCCTM1
          BRANCH    OVRCD,L1CON299
          ADD       ONE,COUNTER
          IF        COUNTER<=NOCODLV1
            GOTO      L1CON200
          ENDIF
          ADD       ONE,SECTOR
          IF        (SECTOR%100=0)
            DISPLAY   *P33:24,*V2LON,SECTOR
          ENDIF
.
. Change all Episode Record in Extract to Other Key = Z70
.
L1CON210  PACK      KEY48,CCTMLV1,SP70
          CALL      RSCCEC2
          CALL      RKCCEC2
          BRANCH    OVRCD,L1CON200
          MATCH     CCTMLV1,CCECLV1
          GOTO      L1CON200 IF NOT EQUAL
          MOVE      Z70,CCECLV1
          CALL      UPCCEC2
          GOTO      L1CON210
.
L1CON299  CALL      CLSTMP00
.
L1CON999  RETURN
.---------------------------------------------------------
. Close & Delete Temp File
.---------------------------------------------------------
CLSTMP00  DISPLAY  *P1:10;
          CLOSE    CCSTMPA1,DELETE
          RETURN
.---------------------------------------------------------
. Create Temp File
.---------------------------------------------------------
OPNTMP00  DISPLAY  *P1:10;
          CLEAR    FILENAME
          APPEND   "CIA69A",FILENAME
          APPEND   PORT,FILENAME
          RESET    FILENAME
          REP      " 0",FILENAME
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSTMPA1,FILENAME
          TRAPCLR  IO
          IF       OVRCD=0
            CLOSE    CCSTMPA1,DELETE
          ENDIF
.
          CLEAR    COMMAND
          APPEND   ISBUILD,COMMAND
          APPEND   FILENAME,COMMAND
          APPEND   " 21 U1-10,11-20",COMMAND
          RESET    COMMAND
          EXECUTE  COMMAND,TASKID
          OPEN     CCSTMPA1,FILENAME
.
          RETURN
.--------------------------------------------------
. Calculate Summary Costs
.--------------------------------------------------
SUMM0000  DISPLAY   *P1:24,*EL,"Casemix Extract Level Summary : "
          PACK      KEY18,SP70
.
          CALL      CREAT000      * Clear Summary Details Re Create Files
.
          MOVE      ZERO,SECTOR
          CALL      RSCCEC1
SUMM1000  CALL      RKCCEC1
          BRANCH    OVRCD,SUMM9000
          ADD       ONE,SECTOR
          IF        (SECTOR%100=0)
            DISPLAY   *P33:24,*V2LON,SECTOR
          ENDIF
.
          MATCH     "1",CCECEXC         * Excluded from Summary
          GOTO      SUMM1000 IF EQUAL
.
          IF        FLGSPL1=1
            CALL      GETCST00
          ENDIF
          IF        FLGSPL2=1
            CALL      GETINC00
          ENDIF
.
          CALL      UPDEB000
.
          MATCH     SP70,CCEALV2
          GOTO      SUMM1000 IF EQUAL
          CALL      UPDED000
.
          MATCH     SP70,CCEALV3
          GOTO      SUMM1000 IF EQUAL
          CALL      UPDEE000
          GOTO      SUMM1000
SUMM9000
SUMM9999  RETURN
.------------------------------------------------------------
. Get Cost Amount
.------------------------------------------------------------
GETCST00  PACK      KEY21,CCECHCD,CCECEPS,CCEASCM1
          CALL      RDCCRB1
          IF        OVRCD=1
            MOVE      ZERO,CCRBFDR
            MOVE      ZERO,CCRBFID
            MOVE      ZERO,CCRBVDR
            MOVE      ZERO,CCRBVID
          ENDIF
          MOVE      CCRBFDR,CSTFDR
          MOVE      CCRBFID,CSTFID
          MOVE      CCRBVDR,CSTVDR
          MOVE      CCRBVID,CSTVID
          ASSIGN    CCRBFDR+CCRBFID+CCRBVDR+CCRBVID,CCECFTC
          RETURN
.------------------------------------------------------------
. Get Income Amount
.------------------------------------------------------------
GETINC00  PACK      KEY21,CCECHCD,CCECEPS,CCEASCM2
          CALL      RDCCRB1
          IF        OVRCD=1
            MOVE      ZERO,CCRBFDR
            MOVE      ZERO,CCRBFID
            MOVE      ZERO,CCRBVDR
            MOVE      ZERO,CCRBVID
          ENDIF
          MOVE      CCRBFDR,INCFDR
          MOVE      CCRBFID,INCFID
          MOVE      CCRBVDR,INCVDR
          MOVE      CCRBVID,INCVID
          ASSIGN    CCRBFDR+CCRBFID+CCRBVDR+CCRBVID,CCECTTC
          RETURN
.------------------------------------------------------------
. Update Casemix Level 1
.------------------------------------------------------------
UPDEB000  PACK      KEY10,CCECLV1
          CALL      RDCCEB1
          IF        OVRCD=1
            CALL      CLREB000
            MOVE      CCECLV1,CCEBLV1
            CALL      WRCCEB1
            CALL      RDCCEB1
          ENDIF
          ADD       ONE,CCEBNEP    * Increase Number of Episodes
          ADD       CCECLOS,CCEBLTO
.
          IF        FLGSPL1=0
            ADD       CCECFTC,CCEBFTC
          ELSE
            ADD       CSTFDR,CCEBFTC
            ADD       CSTFID,CCEBFMN
            ADD       CSTVDR,CCEBFMX
            ADD       CSTVID,CCEBFSV
          ENDIF
          IF        FLGSPL2=0
            ADD       CCECTTC,CCEBTTC
          ELSE
            ADD       INCFDR,CCEBTTC
            ADD       INCFID,CCEBTMN
            ADD       INCVDR,CCEBTMX
            ADD       INCVID,CCEBTSV
          ENDIF
          CALL      UPCCEB1
          RETURN
.------------------------------------------------------------
. Update Casemix Level 2
.------------------------------------------------------------
UPDED000  PACK      KEY20,CCECLV1,CCECLV2,SP70
          MATCH     SP70,KEY20
          GOTO      UPDED999 IF EQUAL
          CALL      RDCCED1
          IF        OVRCD=1
            CALL      CLRED000
            UNPACK    KEY20,CCEDLV1,CCEDLV2
            CALL      WRCCED1
            CALL      RDCCED1
          ENDIF
          ADD       ONE,CCEDNEP    * Increase Number of Episodes
          ADD       CCECLOS,CCEDLTO
.
          IF        FLGSPL1=0
            ADD       CCECFTC,CCEDFTC
          ELSE
            ADD       CSTFDR,CCEDFTC
            ADD       CSTFID,CCEDFMN
            ADD       CSTVDR,CCEDFMX
            ADD       CSTVID,CCEDFSV
          ENDIF
          IF        FLGSPL2=0
            ADD       CCECTTC,CCEDTTC
          ELSE
            ADD       INCFDR,CCEDTTC
            ADD       INCFID,CCEDTMN
            ADD       INCVDR,CCEDTMX
            ADD       INCVID,CCEDTSV
          ENDIF
          CALL      UPCCED1
UPDED999  RETURN
.------------------------------------------------------------
. Update Casemix Level 3
.------------------------------------------------------------
UPDEE000  PACK      KEY30,CCECLV1,CCECLV2,CCECLV3,SP70
          MATCH     SP70,KEY30
          GOTO      UPDEE999 IF EQUAL
          CALL      RDCCEE1
          IF        OVRCD=1
            CALL      CLREE000
            UNPACK    KEY30,CCEELV1,CCEELV2,CCEELV3
            CALL      WRCCEE1
            CALL      RDCCEE1
          ENDIF
          ADD       ONE,CCEENEP    * Increase Number of Episodes
          ADD       CCECLOS,CCEELTO
.
          IF        FLGSPL1=0
            ADD       CCECFTC,CCEEFTC
          ELSE
            ADD       CSTFDR,CCEEFTC
            ADD       CSTFID,CCEEFMN
            ADD       CSTVDR,CCEEFMX
            ADD       CSTVID,CCEEFSV
          ENDIF
          IF        FLGSPL2=0
            ADD       CCECTTC,CCEETTC
          ELSE
            ADD       INCFDR,CCEETTC
            ADD       INCFID,CCEETMN
            ADD       INCVDR,CCEETMX
            ADD       INCVID,CCEETSV
          ENDIF
.
          CALL      UPCCEE1
.
UPDEE999  RETURN
.------------------------------------------------------------
. Clear Summary File Details
.------------------------------------------------------------
CLREB000  MOVE      ZERO,CCEBNEP
          MOVE      ZERO,CCEBFTC
          MOVE      ZERO,CCEBFMN
          MOVE      ZERO,CCEBFMX
          MOVE      ZERO,CCEBFSV
          MOVE      ZERO,CCEBTTC
          MOVE      ZERO,CCEBTMN
          MOVE      ZERO,CCEBTMX
          MOVE      ZERO,CCEBTSV
          MOVE      ZERO,CCEBLMN
          MOVE      ZERO,CCEBLMX
          MOVE      ZERO,CCEBLSV
          MOVE      ZERO,CCEBLTO
          RETURN
.
CLRED000  MOVE      ZERO,CCEDNEP
          MOVE      ZERO,CCEDFTC
          MOVE      ZERO,CCEDFMN
          MOVE      ZERO,CCEDFMX
          MOVE      ZERO,CCEDFSV
          MOVE      ZERO,CCEDTTC
          MOVE      ZERO,CCEDTMN
          MOVE      ZERO,CCEDTMX
          MOVE      ZERO,CCEDTSV
          MOVE      ZERO,CCEDLMN
          MOVE      ZERO,CCEDLMX
          MOVE      ZERO,CCEDLSV
          MOVE      ZERO,CCEDLTO
          RETURN
.
CLREE000  MOVE      ZERO,CCEENEP
          MOVE      ZERO,CCEEFTC
          MOVE      ZERO,CCEEFMN
          MOVE      ZERO,CCEEFMX
          MOVE      ZERO,CCEEFSV
          MOVE      ZERO,CCEETTC
          MOVE      ZERO,CCEETMN
          MOVE      ZERO,CCEETMX
          MOVE      ZERO,CCEETSV
          MOVE      ZERO,CCEELMN
          MOVE      ZERO,CCEELMX
          MOVE      ZERO,CCEELSV
          MOVE      ZERO,CCEELTO
          RETURN
.------------------------------------------------------------
. Calculate Statistics
.------------------------------------------------------------
STAT0000  MATCH     "1",CCEAUST
          GOTO      STAT9999 IF EQUAL
          PACK      KEY10,SP70
          DISPLAY   *P1:24,*EL,"Calculating Statistics : "
          MOVE      ZERO,TOTALEXT
.
          CALL      STEB0000  * Level 1 Min , Max  & Variance Calculation
          CALL      STED0000  * Level 2 Min , Max  & Variance Calculation
          CALL      STEE0000  * Level 3 Min , Max  & Variance Calculation
.
STAT9999  RETURN
.------------------------------------------------------------
. Update Variance Casemix Level 1
.------------------------------------------------------------
STEB0000  PACK      KEY10,SP70
          CALL      RDCCEB1
          IF        OVRCD=0
            CALL      RPCCEB1
          ENDIF
.
STEB1000  CALL      RKCCEB1
          BRANCH    OVRCD,STEB9999
.
          ADD       ONE,TOTALEXT
          IF        (TOTALEXT%100=0)
            DISPLAY   *P26:24,*V2LON,TOTALEXT,"/1"
          ENDIF
.
          MOVE      "999999999999",CCEBFMN
          MOVE      ZERO,CCEBFMX
          MOVE      ZERO,CCEBFSV
          MOVE      "999999999999",CCEBTMN
          MOVE      ZERO,CCEBTMX
          MOVE      ZERO,CCEBTSV
          MOVE      "999999999999",CCEBLMN
          MOVE      ZERO,CCEBLMX
          MOVE      ZERO,CCEBLSV
.
          PACK      KEY48,CCEBLV1,SP70
          CALL      RSCCEC2
STEB1100  CALL      RKCCEC2
          BRANCH    OVRCD,STEB1900
          MATCH     CCEBLV1,CCECLV1
          GOTO      STEB1900 IF NOT EQUAL
.
          MATCH     "1",CCECEXC  * Excluded
          GOTO      STEB1100 IF EQUAL
.
          CALL      CHKEB000
.
          ASSIGN    CCECFTC-(CCEBFTC/CCEBNEP),F12P4
          ASSIGN    CCEBFSV+(F12P4*F12P4),CCEBFSV
.
          ASSIGN    CCECTTC-(CCEBTTC/CCEBNEP),F12P4
          ASSIGN    CCEBTSV+(F12P4*F12P4),CCEBTSV
.
          ASSIGN    CCECLOS-(CCEBLTO/CCEBNEP),F12P4
          ASSIGN    CCEBLSV+(F12P4*F12P4),CCEBLSV
.
          GOTO      STEB1100
.
STEB1900  IF        CCEBNEP>1
            ASSIGN    CCEBFSV/(CCEBNEP-1),CCEBFSV
            ASSIGN    CCEBTSV/(CCEBNEP-1),CCEBTSV
            ASSIGN    CCEBLSV/(CCEBNEP-1),CCEBLSV
          ENDIF
          CALL      UPCCEB1
          GOTO      STEB1000
.
STEB9999  RETURN
.------------------------------------------------------------
. Update Variance Casemix Level 2
.------------------------------------------------------------
STED0000  PACK      KEY20,SP70
          CALL      RDCCED1
          IF        OVRCD=0
            CALL      RPCCED1
          ENDIF
STED1000  CALL      RKCCED1
          BRANCH    OVRCD,STED9999
.
          ADD       ONE,TOTALEXT
          IF        (TOTALEXT%100=0)
            DISPLAY   *P26:24,*V2LON,TOTALEXT,"/2"
          ENDIF
.
          MOVE      "999999999999",CCEDFMN
          MOVE      ZERO,CCEDFMX
          MOVE      ZERO,CCEDFSV
          MOVE      "999999999999",CCEDTMN
          MOVE      ZERO,CCEDTMX
          MOVE      ZERO,CCEDTSV
          MOVE      "999999999999",CCEDLMN
          MOVE      ZERO,CCEDLMX
          MOVE      ZERO,CCEDLSV
.
          PACK      KEY48,CCEDLV1,CCEDLV2,SP70
          PACK      KEY20,CCEDLV1,CCEDLV2,SP70
          CALL      RSCCEC2
STED1100  CALL      RKCCEC2
          BRANCH    OVRCD,STED1900
          PACK      KEY48,CCECLV1,CCECLV2,SP70
          MATCH     KEY20,KEY48
          GOTO      STED1900 IF NOT EQUAL
.
          MATCH     "1",CCECEXC  * Excluded
          GOTO      STED1100 IF EQUAL
.
          CALL      CHKED000
.
          ASSIGN    CCECFTC-(CCEDFTC/CCEDNEP),F12P4
          ASSIGN    CCEDFSV+(F12P4*F12P4),CCEDFSV
.
          ASSIGN    CCECTTC-(CCEDTTC/CCEDNEP),F12P4
          ASSIGN    CCEDTSV+(F12P4*F12P4),CCEDTSV
.
          ASSIGN    CCECLOS-(CCEDLTO/CCEDNEP),F12P4
          ASSIGN    CCEDLSV+(F12P4*F12P4),CCEDLSV
.
          GOTO      STED1100
.
STED1900  IF        CCEDNEP>1
            ASSIGN    CCEDFSV/(CCEDNEP-1),CCEDFSV
            ASSIGN    CCEDTSV/(CCEDNEP-1),CCEDTSV
            ASSIGN    CCEDLSV/(CCEDNEP-1),CCEDLSV
          ENDIF
          CALL      UPCCED1
          GOTO      STED1000
.
STED9999  RETURN
.
.------------------------------------------------------------
. Update Variance Casemix Level 3
.------------------------------------------------------------
STEE0000  PACK      KEY30,SP70
          CALL      RDCCEE1
          IF        OVRCD=0
            CALL      RPCCEE1
          ENDIF
.
STEE1000  CALL      RKCCEE1
          BRANCH    OVRCD,STEE9999
.
          ADD       ONE,TOTALEXT
          IF        (TOTALEXT%100=0)
            DISPLAY   *P26:24,*V2LON,TOTALEXT,"/3"
          ENDIF
.
          MOVE      "999999999999",CCEEFMN
          MOVE      ZERO,CCEEFMX
          MOVE      ZERO,CCEEFSV
          MOVE      "999999999999",CCEETMN
          MOVE      ZERO,CCEETMX
          MOVE      ZERO,CCEETSV
          MOVE      "999999999999",CCEELMN
          MOVE      ZERO,CCEELMX
          MOVE      ZERO,CCEELSV
.
          PACK      KEY48,CCEELV1,CCEELV2,CCEELV3,SP70
          PACK      KEY30,CCEELV1,CCEELV2,CCEELV3,SP70
          CALL      RSCCEC2
STEE1100  CALL      RKCCEC2
          BRANCH    OVRCD,STEE1900
          PACK      KEY48,CCECLV1,CCECLV2,CCECLV3,SP70
          MATCH     KEY30,KEY48
          GOTO      STEE1900 IF NOT EQUAL
.
          MATCH     "1",CCECEXC  * Excluded
          GOTO      STEE1100 IF EQUAL
.
          CALL      CHKEE000
.
          ASSIGN    CCECFTC-(CCEEFTC/CCEENEP),F12P4
          ASSIGN    CCEEFSV+(F12P4*F12P4),CCEEFSV
.
          ASSIGN    CCECTTC-(CCEETTC/CCEENEP),F12P4
          ASSIGN    CCEETSV+(F12P4*F12P4),CCEETSV
.
          ASSIGN    CCECLOS-(CCEELTO/CCEENEP),F12P4
          ASSIGN    CCEELSV+(F12P4*F12P4),CCEELSV
.
          GOTO      STEE1100
.
STEE1900  IF        CCEENEP>1
            ASSIGN    CCEEFSV/(CCEENEP-1),CCEEFSV
            ASSIGN    CCEETSV/(CCEENEP-1),CCEETSV
            ASSIGN    CCEELSV/(CCEENEP-1),CCEELSV
          ENDIF
          CALL      UPCCEE1
          GOTO      STEE1000
.
STEE9999  RETURN
.------------------------------------------------------------
. Check Level 1 Min & Max
.------------------------------------------------------------
CHKEB000  IF        CCECFTC>CCEBFMX
            MOVE      CCECFTC,CCEBFMX
          ENDIF
          IF        CCECFTC<CCEBFMN
            MOVE      CCECFTC,CCEBFMN
          ENDIF
.
          IF        CCECTTC>CCEBTMX
            MOVE      CCECTTC,CCEBTMX
          ENDIF
          IF        CCECTTC<CCEBTMN
            MOVE      CCECTTC,CCEBTMN
          ENDIF
.
          IF        CCECLOS>CCEBLMX
            MOVE      CCECLOS,CCEBLMX
          ENDIF
          IF        CCECLOS<CCEBLMN
            MOVE      CCECLOS,CCEBLMN
          ENDIF
          RETURN
.------------------------------------------------------------
. Check Min & Max for Level 2
.------------------------------------------------------------
CHKED000  IF        CCECFTC>CCEDFMX
            MOVE      CCECFTC,CCEDFMX
          ENDIF
          IF        CCECFTC<CCEDFMN
            MOVE      CCECFTC,CCEDFMN
          ENDIF
.
          IF        CCECTTC>CCEDTMX
            MOVE      CCECTTC,CCEDTMX
          ENDIF
          IF        CCECTTC<CCEDTMN
            MOVE      CCECTTC,CCEDTMN
          ENDIF
.
          IF        CCECLOS>CCEDLMX
            MOVE      CCECLOS,CCEDLMX
          ENDIF
          IF        CCECLOS<CCEDLMN
            MOVE      CCECLOS,CCEDLMN
          ENDIF
          RETURN
.------------------------------------------------------------
. Check Level 3 Min & Max
.------------------------------------------------------------
CHKEE000  IF        CCECFTC>CCEEFMX
            MOVE      CCECFTC,CCEEFMX
          ENDIF
          IF        CCECFTC<CCEEFMN
            MOVE      CCECFTC,CCEEFMN
          ENDIF
.
          IF        CCECTTC>CCEETMX
            MOVE      CCECTTC,CCEETMX
          ENDIF
          IF        CCECTTC<CCEETMN
            MOVE      CCECTTC,CCEETMN
          ENDIF
.
          IF        CCECLOS>CCEELMX
            MOVE      CCECLOS,CCEELMX
          ENDIF
          IF        CCECLOS<CCEELMN
            MOVE      CCECLOS,CCEELMN
          ENDIF
          RETURN
.
.---------------------------------------------------------------------------
. Create and Open Files
.---------------------------------------------------------------------------
CREAT000  DISPLAY  *P1:3;
          CLOSE    CCSCEBA1,DELETE
          MOVE     "cceb",KEY4
          PACK     FILENAME,KEY4,CCEAEID
          PACK     COMMAND,SGENISB,FILENAME,CCEBIDX
          EXECUTE  COMMAND,TASKID
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCEBA1,FILENAME
          TRAPCLR  IO
          IF       OVRCD=1
            BEEP
            MOVE     "Unable to Create Casemix Extract Files - ",DISPMSG
            CALL     MESSAGE1
            GOTO     CREAT900
          ENDIF
.
          CLOSE    CCSCEDA1,DELETE
          MOVE     "cced",KEY4
          PACK     FILENAME,KEY4,CCEAEID
          PACK     COMMAND,SGENISB,FILENAME,CCEDIDX
          EXECUTE  COMMAND,TASKID
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCEDA1,FILENAME
          TRAPCLR  IO
          IF       OVRCD=1
            BEEP
            MOVE     "Unable to Create Casemix Extract Files - ",DISPMSG
            CALL     MESSAGE1
            GOTO     CREAT900
          ENDIF
.
          CLOSE    CCSCEEA1,DELETE
          MOVE     "ccee",KEY4
          PACK     FILENAME,KEY4,CCEAEID
          PACK     COMMAND,SGENISB,FILENAME,CCEEIDX
          EXECUTE  COMMAND,TASKID
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCEEA1,FILENAME
          TRAPCLR  IO
          IF       OVRCD=1
            BEEP
            MOVE     "Unable to Create Casemix Extract Files - ",DISPMSG
            CALL     MESSAGE1
            GOTO     CREAT900
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      CREAT999
.
CREAT900  MOVE      ONE,EXIT
.
CREAT999  RETURN
.--------------------------------------------------------
. Level 2 Procesing
.--------------------------------------------------------
L2CON000  DISPLAY   *P1:24,*EL,"Consolidating Level 2 : ";
          MOVE      ZERO,SECTOR
          PACK      KEY10,SP70
          CALL      RSCCEB1
L2CON100  CALL      RKCCEB1
          BRANCH    OVRCD,L2CON999
.
          ADD       ONE,SECTOR
          IF        (SECTOR%100=0)
            DISPLAY   *P33:24,*V2LON,SECTOR
          ENDIF
.
          CALL      L2SRT000       * Sort Level 2 by Consolidation Sequence
.
. Scan by Consolidation Sequence
.
          PACK      KEY20,Z70
          MOVE      ZERO,COUNTER
          CALL      RSCCTM1
L2CON200  CALL      RPCCTM1
          BRANCH    OVRCD,L2CON299
          ADD       ONE,COUNTER
          IF        COUNTER<=NOCODLV2
            GOTO      L2CON200
          ENDIF
.
. Change all Episode Record in Extract to Other Key = Z70
.
L2CON210  PACK      KEY48,CCEBLV1,CCTMLV1,SP70
          CALL      RSCCEC2
          CALL      RKCCEC2
          BRANCH    OVRCD,L2CON200
          MATCH     CCEBLV1,CCECLV1
          GOTO      L2CON200 IF NOT EQUAL
          MATCH     CCTMLV1,CCECLV2
          GOTO      L2CON200 IF NOT EQUAL
          MOVE      Z70,CCECLV2
          CALL      UPCCEC2
          GOTO      L2CON210
.
L2CON299  CALL      CLSTMP00
          GOTO      L2CON100
.
L2CON999  RETURN
.-------------------------------------------------------
. Sort Level 2 CCED into Temp File
.-------------------------------------------------------
L2SRT000  CALL      OPNTMP00              * Create Temp File for Sorting
          PACK      KEY20,CCEBLV1,SP70
          CALL      RDCCED1
          IF        OVRCD=0
            CALL      RPCCED1
          ENDIF
L2SRT100  CALL      RKCCED1
          BRANCH    OVRCD,L2SRT999
          MATCH     CCEDLV1,CCEBLV1
          GOTO      L2SRT999 IF NOT EQUAL
.
          MATCH     Z70,CCEDLV2           * Ignore Current Other Key Z70
          GOTO      L2SRT100 IF EQUAL
.
          IF        FLGSPL1=1
            ASSIGN    CCEDFTC+CCEDFMN+CCEDFMX+CCEDFSV,CCEDFTC
          ENDIF
          IF        FLGSPL1=2
            ASSIGN    CCEDTTC+CCEDTMN+CCEDTMX+CCEDTSV,CCEDTTC
          ENDIF
          LOAD      F10,REPTSEQ,CCEDNEP,CCEDLTO,CCEDFTC,CCEDTTC
          MOVE      F10,KEY10
.
          PACK      KEY20,KEY10,CCEDLV2
          UNPACK    KEY20,CCTMSEQ,CCTMLV1
          CALL      RDCCTM1
          IF        OVRCD=1
            CALL      WRCCTM1
          ENDIF
          GOTO      L2SRT100
.
L2SRT999  RETURN
.--------------------------------------------------------
. Level 3 Procesing
.--------------------------------------------------------
L3CON000  DISPLAY   *P1:24,*EL,"Consolidating Level 2 : ";
          PACK      KEY20,SP70
          MOVE      ZERO,SECTOR
          CALL      RSCCED1
L3CON100  CALL      RKCCED1
          BRANCH    OVRCD,L3CON999
.
          ADD       ONE,SECTOR
          IF        (SECTOR%100=0)
            DISPLAY   *P33:24,*V2LON,SECTOR
          ENDIF
.
          CALL      L3SRT000       * Sort Level 2 by Consolidation Sequence
.
. Scan by Consolidation Sequence
.
          PACK      KEY20,Z70
          MOVE      ZERO,COUNTER
          CALL      RSCCTM1
L3CON200  CALL      RPCCTM1
          BRANCH    OVRCD,L3CON299
          ADD       ONE,COUNTER
          IF        COUNTER<=NOCODLV3
            GOTO      L3CON200
          ENDIF
.
. Change all Episode Record in Extract to Other Key = Z70
.
L3CON210  PACK      KEY48,CCEDLV1,CCEDLV2,CCTMLV1,SP70
          CALL      RSCCEC2
          CALL      RKCCEC2
          BRANCH    OVRCD,L3CON200
          MATCH     CCEDLV1,CCECLV1
          GOTO      L3CON200 IF NOT EQUAL
          MATCH     CCEDLV2,CCECLV2
          GOTO      L3CON200 IF NOT EQUAL
          MATCH     CCTMLV1,CCECLV3
          GOTO      L3CON200 IF NOT EQUAL
          MOVE      Z70,CCECLV3
          CALL      UPCCEC2
          GOTO      L3CON210
.
L3CON299  CALL      CLSTMP00
          GOTO      L3CON100
.
L3CON999  RETURN
.-------------------------------------------------------
. Sort Level 2 CCED into Temp File
.-------------------------------------------------------
L3SRT000  CALL      OPNTMP00              * Create Temp File for Sorting
          PACK      KEY30,CCEDLV1,CCEDLV2,SP70
          CALL      RDCCEE1
          IF        OVRCD=0
            CALL      RPCCEE1
          ENDIF
L3SRT100  CALL      RKCCEE1
          BRANCH    OVRCD,L3SRT999
          MATCH     CCEELV1,CCEDLV1
          GOTO      L3SRT999 IF NOT EQUAL
          MATCH     CCEELV2,CCEDLV2
          GOTO      L3SRT999 IF NOT EQUAL
.
          MATCH     Z70,CCEELV2           * Ignore Current Other Key Z70
          GOTO      L3SRT100 IF EQUAL
.
          IF        FLGSPL1=1
            ASSIGN    CCEEFTC+CCEEFMN+CCEEFMX+CCEEFSV,CCEEFTC
          ENDIF
          IF        FLGSPL1=2
            ASSIGN    CCEETTC+CCEETMN+CCEETMX+CCEETSV,CCEETTC
          ENDIF
          LOAD      F10,REPTSEQ,CCEENEP,CCEELTO,CCEEFTC,CCEETTC
          MOVE      F10,KEY10
.
          PACK      KEY20,KEY10,CCEELV3
          UNPACK    KEY20,CCTMSEQ,CCTMLV1
          CALL      RDCCTM1
          IF        OVRCD=1
            CALL      WRCCTM1
          ENDIF
          GOTO      L3SRT100
.
L3SRT999  RETURN
.
.----------------------------------------------------------------------
. Enter Casemix Extract ID
.----------------------------------------------------------------------
EEID0000  MOVE      ZERO,CKEYTYP
          CALL      CCSCOPCL         * Close Files
          CALL      KCCEAA00
          BRANCH    EXIT,EEID9999,EEID9999
          CALL      GETCME00
          CALL      CCSCOPOP         * Open Files
          MOVE      ZERO,NOCODLV1
          MOVE      ZERO,NOCODLV2
          MOVE      ZERO,NOCODLV3
          MOVE      ZERO,EXIT
          MOVE      ONE,OVRCD
EEID9999  RETURN
.======================================================================
. Determine Display Values for a Valid Casemix Extract Code
.======================================================================
GETCME00  MATCH     SP70,CCEAFDD
          IF        @EQUAL
            MOVE      "Start     ",FROMDD
          ELSE
            UNPACK    CCEAFDD,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
            MOVE      CPCDATE,FROMDD
          ENDIF
.
          MATCH     "99999999",CCEATDD
          IF        @EQUAL
            MOVE      "Finish    ",TODD
          ELSE
            UNPACK    CCEATDD,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
            MOVE      CPCDATE,TODD
          ENDIF
.
          MATCH     SP70,CCEAFAD
          IF        @EQUAL
            MOVE      "Start     ",FROMAD
          ELSE
            UNPACK    CCEAFAD,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
            MOVE      CPCDATE,FROMAD
          ENDIF
.
          MATCH     "99999999",CCEATAD
          IF        @EQUAL
            MOVE      "Finish    ",TOAD
          ELSE
            UNPACK    CCEATAD,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
            MOVE      CPCDATE,TOAD
          ENDIF
.
          MOVE     CCEAVIS,F1
          BRANCH   F1,GETCME10,GETCME20,GETCME30
          MOVE     "All        ",VISITDES
          GOTO     GETCME40
GETCME10  MOVE     "A & E      ",VISITDES
          GOTO     GETCME40
GETCME20  MOVE     "Outpatients ",VISITDES
          GOTO     GETCME40
GETCME30  MOVE     "Inpatients",VISITDES
          GOTO     GETCME40
.
GETCME40  MOVE     SP70,CLV1DES
          MOVE     SP70,CLV2DES
          MOVE     SP70,CLV3DES
.
          MOVE     CCEALV1,KEY3
          CALL     RDCCST1
          MOVE     CCSTDES,CLV1DES
.
          MATCH    SP70,CCEALV2
          IF       !@EQUAL
            MOVE     CCEALV2,KEY3
            CALL     RDCCST1
            MOVE     CCSTDES,CLV2DES
          ENDIF
.
          MATCH    SP70,CCEALV3
          IF       !@EQUAL
            MOVE     CCEALV3,KEY3
            CALL     RDCCST1
            MOVE     CCSTDES,CLV3DES
          ENDIF
.
          MOVE     CCEAHCD,KEY2
          CALL     RDCCHC1
.
          RETURN
ELV10000  IF     ACCEPT=1
            MOVE   ZERO,NOCODLV1
          ENDIF
          MATCH     SP70,CCEALV1
          GOTO      ELV19999 IF EQUAL
          KEYIN     *PCCOL:CVERT,*V2LON,*RV,NOCODLV1
ELV19999  RETURN
ELV20000  IF     ACCEPT=1
            MOVE   ZERO,NOCODLV2
          ENDIF
          MATCH     SP70,CCEALV2
          GOTO      ELV29999 IF EQUAL
          KEYIN     *PCCOL:CVERT,*V2LON,*RV,NOCODLV2
ELV29999  RETURN
ELV30000  IF     ACCEPT=1
            MOVE   ZERO,NOCODLV3
          ENDIF
          MATCH     SP70,CCEALV3
          GOTO      ELV39999 IF EQUAL
          KEYIN     *PCCOL:CVERT,*V2LON,*RV,NOCODLV3
ELV39999  RETURN
.------------------------------------------------------------
. Enter Sequence
.------------------------------------------------------------
KRSEQ000  MOVE      SP70,DISPMSG
          CALL      MESSAGE2
          IF        ACCEPT=1
            MOVE      ONE,REPTSEQ
          ENDIF
          DISPLAY   *P1:24,*EL,"Sequence : ":
                    *V2LON,"1",*HOFF,".No. of Episodes, ":
                    *V2LON,"2",*HOFF,".Total Bed Days, ":
                    *V2LON,"3",*HOFF,".Total Cost(1), ":
                    *V2LON,"4",*HOFF,".Total Cost(2)"
KRSEQ100  KEYIN     *PCCOL:CVERT,*V2LON,*RV,REPTSEQ
          BRANCH    REPTSEQ,KRSEQ110,KRSEQ120,KRSEQ130,KRSEQ140
          BEEP
          GOTO      KRSEQ100
.
KRSEQ110  MOVE      "By Number of Episodes",SEQDESC
          GOTO      KRSEQ999
.
KRSEQ120  MOVE      "By Total Bed Days",SEQDESC
          GOTO      KRSEQ999
.
KRSEQ130  MOVE      "By Total Cost(1)",SEQDESC
          GOTO      KRSEQ999
.
KRSEQ140  MOVE      "By Total Cost(2)",SEQDESC
          GOTO      KRSEQ999
.
KRSEQ999  CALL      MESSAGE3
          RETURN
.
.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       CCSCEAIO/INC
          INC       CCSCEAKY    
          INC       CCSCEBIO/INC
          INC       CCSCECIO/INC
          INC       CCSCEDIO/INC
          INC       CCSCEEIO/INC
          INC       CCSCOPCD    
          INC       CCSHCDIO/INC
          INC       CCSRBDIO/INC
          INC       CCSSTYIO/INC
          INC       CCSXHDIO/INC
          INC       CCSXHDKY    
          INC       CIALOSCD    
.
          INC       STDGENCD
.

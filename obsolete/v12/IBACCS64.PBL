.------------------------------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.00.00"
.-------------------------------------------------------
. V9.02.00  04.07.2002  Glenn Saunders
.           Export to new release i.e. v9.02 from r5.09
.------------------------------------------------------------------------------
. V5.04.02  01.11.1993 B.G.Ackland
.           Change "Procedure" to Patient Service
.------------------------------------------------------------------------------
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBACCS64
.   Function      :   Patient Service Detail Listing          
.   Generated  On :   04/07/2002
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       CCSCALFD/INC
          INC       CCSDPTFD/INC
          INC       CCSHCDFD/INC
          INC       CCSPDPFD/INC
          INC       CCSPSDFD/INC
          INC       CCSTMPDF    
          INC       CCSUPDFD/INC
.=========================
.Local Variable Definition
.-------------------------
FROMPERD  DIM      20 * Scr 01 Fld     6
TOPERD    DIM      20 * Scr 01 Fld     7
FROMDEPT  DIM      43 * Scr 01 Fld     8
TODEPT    DIM      43 * Scr 01 Fld     9
PRINTZER  FORM      1 * Scr 01 Fld    10
SPROCED   DIM       8 * Scr 01 Fld    11
FROMENC   DIM      16 * Scr 02 Fld     1
TOENC     DIM      16 * Scr 02 Fld     2
FROMUR    DIM      10 * Scr 03 Fld     1
TOUR      DIM      10 * Scr 03 Fld     2
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBACCS64"
PRGNAM    INIT      "Patient Service Detail Listing          "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      SC00L000
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          DISPLAY   *P56:24,"Opening ccscalaf";
          OPEN      CCSCALA1,"ccscalaf"
          DISPLAY   *P56:24,"Opening ccscalaf";
          OPEN      CCSCALA2,"ccscalaf"
          DISPLAY   *P56:24,"Opening ccscalaf";
          OPEN      CCSCALA3,"ccscalaf"
          DISPLAY   *P56:24,"Opening ccsdptaf";
          OPEN      CCSDPTA1,"ccsdptaf"
          DISPLAY   *P56:24,"Opening ccsdptaf";
          OPEN      CCSDPTA2,"ccsdptaf"
          DISPLAY   *P56:24,"Opening ccsdptaf";
          OPEN      CCSDPTA3,"ccsdptaf"
          DISPLAY   *P56:24,"Opening ccsdptaf";
          OPEN      CCSDPTA4,"ccsdptaf"
          DISPLAY   *P56:24,"Opening ccshcdaf";
          OPEN      CCSHCDA1,"ccshcdaf"
          DISPLAY   *P56:24,"Opening ccshcdaf";
          OPEN      CCSHCDA2,"ccshcdaf"
          DISPLAY   *P56:24,"Opening ccspdpaf";
          OPEN      CCSPDPA1,"ccspdpaf"
          DISPLAY   *P56:24,"Opening ccspdpaf";
          OPEN      CCSPDPA2,"ccspdpaf"
          DISPLAY   *P56:24,"Opening ccspdpaf";
          OPEN      CCSPDPA3,"ccspdpaf"
          DISPLAY   *P56:24,"Opening ccspdpaf";
          OPEN      CCSPDPA4,"ccspdpaf"
          DISPLAY   *P56:24,"Opening ccspsdaf";
          OPEN      CCSPSDA1,"ccspsdaf"
          DISPLAY   *P56:24,"Opening ccspsdaf";
          OPEN      CCSPSDA2,"ccspsdaf"
          DISPLAY   *P56:24,"Opening ccspsdaf";
          OPEN      CCSPSDA3,"ccspsdaf"
          DISPLAY   *P56:24,"Opening ccsupdaf";
          OPEN      CCSUPDA1,"ccsupdaf"
          DISPLAY   *P56:24,"Opening ccsupdaf";
          OPEN      CCSUPDA2,"ccsupdaf"
          DISPLAY   *P56:24,"Opening ccsupdaf";
          OPEN      CCSUPDA3,"ccsupdaf"
          DISPLAY   *P56:24,"Opening ccsupdaf";
          OPEN      CCSUPDA4,"ccsupdaf"
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "00",SCRID
          IF         @EQUAL
            CALL       PS00L000   * Report Options                     
          ENDIF
          MATCH     "01",SCRID
          IF         @EQUAL
            CALL       PS01L000   * Report by Department               
          ENDIF
          MATCH     "02",SCRID
          IF         @EQUAL
            CALL       PS02L000   * Report by Encounter Code           
          ENDIF
          MATCH     "03",SCRID
          IF         @EQUAL
            CALL       PS03L000   * Report by U/R Code                 
          ENDIF
          RETURN
.--------------------------------
. Screen - Report Options                     
.--------------------------------
SC00L000
SC00L100
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC00L200
          CALL      CF00L000 * Clear Fields
SC00L300
          CALL      KY00L000 * Enter Key Fields
          BRANCH    EXIT,SC00L999,SC00L999
SC00L400
          CALL      WP00L000 * Load any WP Details
SC00L500
          CALL      LM00L000 * Load any Batch Details
SC00L600
          CALL      DF00L000 * Display Fields
SC00L700
          CALL      SF00L000 * Select Fields
          BRANCH    EXIT,SC00L100,SC00L100,SC00L200
SC00L800
SC00L900
SC00L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Report Options                     
.-------------------------------------------------------
CF00L000
CF00L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Report Options                     
.--------------------------------------------------------
KY00L000
          MOVE      ZERO,EXIT
          GOTO      KY00L999
.
KY00L900  MOVE      ONE,EXIT
KY00L999  RETURN
.---------------------------------------------------------
. Load WP files for : Report Options                     
.---------------------------------------------------------
WP00L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Report Options                     
.---------------------------------------------------------
LM00L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Report Options                     
.---------------------------------------------------------
DF00L000
          BRANCH   ACCEPT,DF00L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF00L900
          MATCH    PRGID,SCPSPID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF00L010 IF NOT EQUAL
.
          CALL     PS00L000 * Display Field
          GOTO     DF00L010
DF00L900
DF00L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Report Options                     
.---------------------------------------------------------
PS00L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS00L999,PS00L999,PS00L999,PS00L999:
                            PS00L999
          GOTO     PS00L999
PS00L999
          RETURN
.---------------------------------------------------------
. Selections for : Report Options                     
.---------------------------------------------------------
SF00L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF00L001  BRANCH   ACCEPT,SF00L020
.
SF00L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L006,SF00L101,SF00L102,SF00L103:
                            SF00L104
SF00L006  BEEP
          GOTO     SF00L005
SF00L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF00L090
          MATCH    PRGID,SCSLPID
          GOTO     SF00L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF00L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020
          GOTO     SF00L020
SF00L090  MOVE     ZERO,ACCEPT
          GOTO     SF00L001
.
SF00L101
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L102
          CALL      SC01L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L103
          CALL      SC02L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L104
          CALL      SC03L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
SF00L990  MOVE      ONE,EXIT * Exit Char Restart
SF00L999  RETURN
.--------------------------------
. Screen - Report by Department               
.--------------------------------
SC01L000
SC01L100
          MOVE      "01",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "   12",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC01L200
          CALL      CF01L000 * Clear Fields
SC01L300
          CALL      KY01L000 * Enter Key Fields
          BRANCH    EXIT,SC01L999,SC01L999
SC01L400
          CALL      WP01L000 * Load any WP Details
SC01L500
          CALL      LM01L000 * Load any Batch Details
SC01L600
          CALL      DF01L000 * Display Fields
SC01L700
          CALL      SF01L000 * Select Fields
          BRANCH    EXIT,SC01L100,SC01L100,SC01L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC01L800
SC01L900
SC01L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Report by Department               
.-------------------------------------------------------
CF01L000
          MOVE      SP70,CCHCHCD 
          MOVE      SP70,CCCAYEAR
          MOVE      SP70,CCHCDES 
          MOVE      SP70,FROMPERD
          MOVE      SP70,TOPERD  
          MOVE      SP70,FROMDEPT
          MOVE      SP70,TODEPT  
          MOVE      ZERO,PRINTZER
          MOVE      SP70,SPROCED 
          MOVE      SP70,CCPDDES 
CF01L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Report by Department               
.--------------------------------------------------------
KY01L000
.
KY01L110
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CCHCDES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          MOVE      "    2",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      KCCHCA00
          BRANCH    EXIT,KY01L900,KY01L900
          MOVE      ZERO,ACCEPT
          MOVE      CCHCHCD,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      CCHCDES,VAR      
            CALL      DISPITEM
          ENDIF
.
KY01L120
          MOVE      "    3",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      KCCCAB00
          BRANCH    EXIT,KY01L110,KY01L900
          MOVE      ZERO,ACCEPT
          CALL      MVACCEPT
          MOVE      CCCAYEAR,VAR     
          CALL      DISPITEM
          MOVE      ZERO,EXIT
          GOTO      KY01L999
.
KY01L900  MOVE      ONE,EXIT
KY01L999  RETURN
.---------------------------------------------------------
. Load WP files for : Report by Department               
.---------------------------------------------------------
WP01L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Report by Department               
.---------------------------------------------------------
LM01L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Report by Department               
.---------------------------------------------------------
DF01L000
          BRANCH   ACCEPT,DF01L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF01L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF01L900
          MATCH    PRGID,SCPSPID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF01L010 IF NOT EQUAL
.
          CALL     PS01L000 * Display Field
          GOTO     DF01L010
DF01L900
DF01L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Report by Department               
.---------------------------------------------------------
PS01L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS01L999,PS01L999,PS01L999,PS01L999:
                           PS01L101,PS01L102,PS01L103,PS01L104:
                            PS01L105,PS01L106,PS01L107,PS01L999:
                            PS01L999,PS01L999,PS01L108
          GOTO     PS01L999
.
PS01L101
          MOVE      CCHCDES,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L102
          MOVE      FROMPERD,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L103
          MOVE      TOPERD,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L104
          MOVE      FROMDEPT,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L105
          MOVE      TODEPT,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L106
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      PRINTZER,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L107
          MOVE      SPROCED,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L108
          MOVE      CCPDDES,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
PS01L999
          RETURN
.---------------------------------------------------------
. Selections for : Report by Department               
.---------------------------------------------------------
SF01L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF01L001  BRANCH   ACCEPT,SF01L020
.
SF01L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L006,SF01L006,SF01L006,SF01L006:
                           SF01L006,SF01L101,SF01L006,SF01L102:
                            SF01L006,SF01L103,SF01L104,SF01L006:
                            SF01L105,SF01L106,SF01L006
SF01L006  BEEP
          GOTO     SF01L005
SF01L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF01L090
          MATCH    PRGID,SCSLPID
          GOTO     SF01L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF01L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L020,SF01L020,SF01L020,SF01L020:
                           SF01L020,SF01L101,SF01L020,SF01L102:
                            SF01L020,SF01L103,SF01L104,SF01L020:
                            SF01L020,SF01L020,SF01L020
          GOTO     SF01L020
SF01L090  MOVE     ZERO,ACCEPT
          GOTO     SF01L001
.
SF01L101
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOPERD  
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      EPERD000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF01L101
            ENDIF
            BRANCH    EXIT,SF01L101,SF01L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF01L990 IF EQUAL
          ENDIF
          MOVE      FROMPERD,VAR     
          CALL      DISPITEM
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOPERD,VAR       
            CALL      DISPITEM
          ENDIF
          GOTO     SF01L001
.
SF01L102
.
.
          MOVE      "    9",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TODEPT  
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      EDEPT000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF01L102
            ENDIF
            BRANCH    EXIT,SF01L102,SF01L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF01L990 IF EQUAL
          ENDIF
          MOVE      FROMDEPT,VAR     
          CALL      DISPITEM
.
.
          MOVE      "    9",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TODEPT,VAR       
            CALL      DISPITEM
          ENDIF
          GOTO     SF01L001
.
SF01L103
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,PRINTZER
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      PRINTZER,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF01L001
.
SF01L104
.
.
          MOVE      "   15",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CCPDDES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      SPROC000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF01L104
            ENDIF
            BRANCH    EXIT,SF01L104,SF01L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF01L990 IF EQUAL
          ENDIF
          MOVE      SPROCED,VAR      
          CALL      DISPITEM
.
.
          MOVE      "   15",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      CCPDDES,VAR      
            CALL      DISPITEM
          ENDIF
          GOTO     SF01L001
.
SF01L105
          MOVE      ZERO,EXIT
          GOTO      SF01L999
.
SF01L106
          CALL      REPT0000
          MOVE      ZERO,EXIT
          GOTO      SF01L999
SF01L990  MOVE      FOUR,EXIT * Exit Char Exit
SF01L999  RETURN
.--------------------------------
. Screen - Report by Encounter Code           
.--------------------------------
SC02L000
SC02L100
          MOVE      "02",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "   12",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC02L200
          CALL      CF02L000 * Clear Fields
          CALL      MVACCEPT
SC02L300
          CALL      KY02L000 * Enter Key Fields
          BRANCH    EXIT,SC02L999,SC02L999
SC02L400
          CALL      WP02L000 * Load any WP Details
SC02L500
          CALL      LM02L000 * Load any Batch Details
SC02L600
          CALL      DF02L000 * Display Fields
SC02L700
          CALL      SF02L000 * Select Fields
          BRANCH    EXIT,SC02L100,SC02L100,SC02L200
SC02L800
SC02L900
SC02L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Report by Encounter Code           
.-------------------------------------------------------
CF02L000
          MOVE      SP70,FROMENC 
          MOVE      SP70,TOENC   
          MOVE      SP70,CCHCHCD 
          MOVE      SP70,CCHCDES 
CF02L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Report by Encounter Code           
.--------------------------------------------------------
KY02L000
          MOVE      ZERO,EXIT
          GOTO      KY02L999
.
KY02L900  MOVE      ONE,EXIT
KY02L999  RETURN
.---------------------------------------------------------
. Load WP files for : Report by Encounter Code           
.---------------------------------------------------------
WP02L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Report by Encounter Code           
.---------------------------------------------------------
LM02L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Report by Encounter Code           
.---------------------------------------------------------
DF02L000
          BRANCH   ACCEPT,DF02L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF02L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF02L900
          MATCH    PRGID,SCPSPID
          GOTO     DF02L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF02L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF02L010 IF NOT EQUAL
.
          CALL     PS02L000 * Display Field
          GOTO     DF02L010
DF02L900
DF02L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Report by Encounter Code           
.---------------------------------------------------------
PS02L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS02L101,PS02L102,PS02L103,PS02L104:
                            PS02L999,PS02L999,PS02L999,PS02L999:
                           PS02L999,PS02L999,PS02L999,PS02L999:
                            PS02L999,PS02L999
          GOTO     PS02L999
.
PS02L101
          MOVE      FROMENC,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L102
          MOVE      TOENC,VAR        
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L103
          MOVE      CCHCHCD,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L104
          MOVE      CCHCDES,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
PS02L999
          RETURN
.---------------------------------------------------------
. Selections for : Report by Encounter Code           
.---------------------------------------------------------
SF02L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF02L001  BRANCH   ACCEPT,SF02L020
.
SF02L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF02L101,SF02L102,SF02L103,SF02L006:
                            SF02L006,SF02L006,SF02L006,SF02L006:
                           SF02L006,SF02L006,SF02L006,SF02L006:
                            SF02L104,SF02L105
SF02L006  BEEP
          GOTO     SF02L005
SF02L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF02L090
          MATCH    PRGID,SCSLPID
          GOTO     SF02L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF02L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF02L101,SF02L102,SF02L103,SF02L020:
                            SF02L020,SF02L020,SF02L020,SF02L020:
                           SF02L020,SF02L020,SF02L020,SF02L020:
                            SF02L020,SF02L020
          GOTO     SF02L020
SF02L090  MOVE     ZERO,ACCEPT
          GOTO     SF02L001
.
SF02L101
          CALL     SELECTED
          STRIP     FROMENC 
          SFORMAT   VAR,SCPSLEN
          MOVE      FROMENC,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,FROMENC 
          SFORMAT   VAR,127
          ENDSET    FROMENC 
          APPEND    SP70,FROMENC 
          RESET     FROMENC 
          CMATCH    EXITCHAR,FROMENC 
          GOTO      SF02L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,FROMENC 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L101
            ENDIF
          ENDIF
          MOVE      FROMENC,VAR      
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L102
          CALL     SELECTED
          STRIP     TOENC   
          SFORMAT   VAR,SCPSLEN
          MOVE      TOENC,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,TOENC   
          SFORMAT   VAR,127
          ENDSET    TOENC   
          APPEND    SP70,TOENC   
          RESET     TOENC   
          CMATCH    EXITCHAR,TOENC   
          GOTO      SF02L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,TOENC   
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L102
            ENDIF
          ENDIF
          MOVE      TOENC,VAR        
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L103
.
.
          MOVE      "    4",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CCHCDES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KCCHCA00
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L103
            ENDIF
            BRANCH    EXIT,SF02L103,SF02L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF02L990 IF EQUAL
          ENDIF
          CALL      MVACCEPT
          MOVE      CCHCHCD,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    4",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      CCHCDES,VAR      
            CALL      DISPITEM
          ENDIF
          GOTO     SF02L001
.
SF02L104
          MOVE      ZERO,EXIT
          GOTO      SF02L999
.
SF02L105
          CALL      EREP0000
          MOVE      ZERO,EXIT
          GOTO      SF02L999
SF02L990  MOVE      ONE,EXIT * Exit Char Restart
SF02L999  RETURN
.--------------------------------
. Screen - Report by U/R Code                 
.--------------------------------
SC03L000
SC03L100
          MOVE      "03",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "   12",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC03L200
          CALL      CF03L000 * Clear Fields
          CALL      MVACCEPT
SC03L300
          CALL      KY03L000 * Enter Key Fields
          BRANCH    EXIT,SC03L999,SC03L999
SC03L400
          CALL      WP03L000 * Load any WP Details
SC03L500
          CALL      LM03L000 * Load any Batch Details
SC03L600
          CALL      DF03L000 * Display Fields
SC03L700
          CALL      SF03L000 * Select Fields
          BRANCH    EXIT,SC03L100,SC03L100,SC03L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC03L800
SC03L900
SC03L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Report by U/R Code                 
.-------------------------------------------------------
CF03L000
          MOVE      SP70,FROMUR  
          MOVE      SP70,TOUR    
CF03L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Report by U/R Code                 
.--------------------------------------------------------
KY03L000
          MOVE      ZERO,EXIT
          GOTO      KY03L999
.
KY03L900  MOVE      ONE,EXIT
KY03L999  RETURN
.---------------------------------------------------------
. Load WP files for : Report by U/R Code                 
.---------------------------------------------------------
WP03L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Report by U/R Code                 
.---------------------------------------------------------
LM03L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Report by U/R Code                 
.---------------------------------------------------------
DF03L000
          BRANCH   ACCEPT,DF03L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF03L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF03L900
          MATCH    PRGID,SCPSPID
          GOTO     DF03L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF03L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF03L010 IF NOT EQUAL
.
          CALL     PS03L000 * Display Field
          GOTO     DF03L010
DF03L900
DF03L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Report by U/R Code                 
.---------------------------------------------------------
PS03L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS03L101,PS03L102,PS03L999,PS03L999:
                           PS03L999,PS03L999,PS03L999,PS03L999:
                           PS03L999,PS03L999,PS03L999,PS03L999:
                            PS03L999,PS03L999
          GOTO     PS03L999
.
PS03L101
          MOVE      FROMUR,VAR       
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L102
          MOVE      TOUR,VAR         
          CALL      DISPITEM
          GOTO     PS03L999
PS03L999
          RETURN
.---------------------------------------------------------
. Selections for : Report by U/R Code                 
.---------------------------------------------------------
SF03L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF03L001  BRANCH   ACCEPT,SF03L020
.
SF03L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF03L101,SF03L102,SF03L006,SF03L006:
                           SF03L006,SF03L006,SF03L006,SF03L006:
                           SF03L006,SF03L006,SF03L006,SF03L006:
                            SF03L103,SF03L104
SF03L006  BEEP
          GOTO     SF03L005
SF03L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF03L090
          MATCH    PRGID,SCSLPID
          GOTO     SF03L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF03L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF03L101,SF03L102,SF03L020,SF03L020:
                           SF03L020,SF03L020,SF03L020,SF03L020:
                           SF03L020,SF03L020,SF03L020,SF03L020:
                            SF03L020,SF03L020
          GOTO     SF03L020
SF03L090  MOVE     ZERO,ACCEPT
          GOTO     SF03L001
.
SF03L101
          CALL     SELECTED
          STRIP     FROMUR  
          SFORMAT   VAR,SCPSLEN
          MOVE      FROMUR,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,FROMUR  
          SFORMAT   VAR,127
          ENDSET    FROMUR  
          APPEND    SP70,FROMUR  
          RESET     FROMUR  
          CMATCH    EXITCHAR,FROMUR  
          GOTO      SF03L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,FROMUR  
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF03L101
            ENDIF
          ENDIF
          MOVE      FROMUR,VAR       
          CALL      DISPITEM
          GOTO     SF03L001
.
SF03L102
          CALL     SELECTED
          STRIP     TOUR    
          SFORMAT   VAR,SCPSLEN
          MOVE      TOUR,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,TOUR    
          SFORMAT   VAR,127
          ENDSET    TOUR    
          APPEND    SP70,TOUR    
          RESET     TOUR    
          CMATCH    EXITCHAR,TOUR    
          GOTO      SF03L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,TOUR    
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF03L102
            ENDIF
          ENDIF
          MOVE      TOUR,VAR         
          CALL      DISPITEM
          GOTO     SF03L001
.
SF03L103
          MOVE      ZERO,EXIT
          GOTO      SF03L999
.
SF03L104
          CALL      UREP0000
          MOVE      ZERO,EXIT
          GOTO      SF03L999
SF03L990  MOVE      FOUR,EXIT * Exit Char Exit
SF03L999  RETURN
.@@@@@ Function Restart Point @@@@@
.----------------------------------------
. Move one to accept to for insert mode
.----------------------------------------
MVACCEPT  MOVE      ONE,ACCEPT
          RETURN
EPERD000   MOVE     "    6",FLDID
           CALL     GETPOSIT
           CALL     KCCCAA00
           BRANCH   EXIT,EPERD100,EPERD999
           MOVE     CCCAPER,FPERIOD
           PACK     FROMPERD,CCCAPER,SP1,CCCADES
           GOTO     EPERD150
EPERD100   MOVE     "Start             ",FROMPERD
           MOVE     SP70,FPERIOD
.
EPERD150   MOVE     "    7",FLDID
           CALL     GETPOSIT
           CALL     KCCCAA00
           BRANCH   EXIT,EPERD200,EPERD999
           PACK     TOPERD,CCCAPER,SP1,CCCADES
           MOVE     CCCAPER,LPERIOD
           MATCH    FPERIOD,LPERIOD
           GOTO     EPERD999 IF EQUAL
           GOTO     EPERD999 IF NOT LESS
           BEEP
           MOVE     "To Period Must Be Greater Than From Period - ",DISPMSG
           CALL     MESSAGE1
           GOTO     EPERD000
EPERD200   MOVE     "Finish             ",TOPERD
           MOVE     "ZZ",LPERIOD
.
EPERD999   MOVE     "    6",FLDID
           CALL     GETPOSIT
           RETURN
EDEPT000   MOVE     "    8",FLDID
           CALL     GETPOSIT
           MOVE     CCHCHCD,CCDPHCD
           CALL     KCCDPA00
           BRANCH   EXIT,EDEPT100,EDEPT999
           MOVE     CCDPDPT,FDEPART
           PACK     FROMDEPT,CCDPDPT,SP1,CCDPDES
           GOTO     EDEPT150
EDEPT100   MOVE     "Start             ",FROMDEPT
           MOVE     SP70,FDEPART
.
EDEPT150   MOVE     "    9",FLDID
           CALL     GETPOSIT
           MOVE     CCHCHCD,CCDPHCD
           CALL     KCCDPA00
           BRANCH   EXIT,EDEPT200,EDEPT999
           PACK     TODEPT,CCDPDPT,SP1,CCDPDES
           MOVE     CCDPDPT,LDEPART
           MATCH    FDEPART,LDEPART
           GOTO     EDEPT999 IF EQUAL
           GOTO     EDEPT999 IF NOT LESS
           BEEP
           MOVE     "To Department Must Be > From Department - ",DISPMSG
           CALL     MESSAGE1
           GOTO     EDEPT000
EDEPT200   MOVE     "Finish             ",TODEPT
           MOVE     "ZZZZZZZZ",LDEPART
.
EDEPT999   MOVE     "    8",FLDID
           CALL     GETPOSIT
           RETURN
.----------------------------------------
. patient Service Detailed Usage Analysis
.----------------------------------------
SPROC000  MATCH     FDEPART,LDEPART
          GOTO      SPROC900 IF NOT EQUAL
          MOVE      CCHCHCD,CCPDHCD
          MOVE      FDEPART,CCPDDPT
          CALL      KCCPDA00
          BRANCH    EXIT,SPROC990,SPROC999
          MOVE      CCPDPCD,SPROCED
          MOVE      ZERO,EXIT
          GOTO      SPROC999
.
SPROC900  IF        ACCEPT=0
            BEEP
            MOVE      "More than one Department in Range. - ",DISPMSG
            CALL      MESSAGE1
          ENDIF
SPROC990  MOVE      "N/A    ",SPROCED
          MOVE      SP70,CCPDDES
          MOVE      ZERO,EXIT
SPROC999  RETURN
.
.----------------------------------------
. Patient Service Detailed Usage Analysis
.----------------------------------------
REPT0000  MOVE      "Printing : ",DISPMSG
          CALL      MESSAGE2
          MOVE      ZERO,CPAGENO
          MOVE      ZERO,TOTALQTY
          CLOCK     TIME,CTIMEIS
          MOVE      "99",CLNO
.
          MATCH     SP70,FPERIOD
          IF        @EQUAL
            MOVE      SP70,FROMDATE
          ELSE
            PACK      KEY6,CCCAYEAR,FPERIOD
            CALL      RDCCCA1
            MOVE      CCCAFDT,FROMDATE
          ENDIF
.
          MATCH     Z70,LPERIOD
          IF        @EQUAL
            MOVE      Z70,ENDDATE
          ELSE
            PACK      KEY6,CCCAYEAR,LPERIOD
            CALL      RDCCCA1
            MOVE      CCCATDT,ENDDATE
          ENDIF
.
          PACK      KEY10,CCHCHCD,FDEPART
          CALL      RDCCDP1
          IF        OVRCD=0
            CALL      RPCCDP1
          ENDIF
.
REPT1000  CALL      RKCCDP1
          BRANCH    OVRCD,REPT9000
          MATCH     CCHCHCD,CCDPHCD
          GOTO      REPT9000 IF NOT EQUAL
          MATCH     CCDPDPT,LDEPART
          GOTO      REPT9000 IF LESS
.
          MATCH     "1",CCDPDTY
          GOTO      REPT1000 IF EQUAL
.
          DISPLAY   *P12:24,CCDPDPT
.
REPT2000  PACK      KEY10,CCDPHCD,CCDPDPT,SP70
          PACK      KEY18,CCDPHCD,CCDPDPT,SP70
          CALL      RSCCPD1
REPT2100  CALL      RKCCPD1
          BRANCH    OVRCD,REPT1000
          PACK      KEY18,CCPDHCD,CCPDDPT,CCPDPCD
          MATCH     KEY10,KEY18
          GOTO      REPT1000 IF NOT EQUAL
          MATCH     SP70,SPROCED
          GOTO      REPT2110 IF EQUAL
          MATCH     SPROCED,CCPDPCD
          GOTO      REPT2100 IF NOT EQUAL
.
REPT2110  MOVE      ZERO,TOTALQTY
          MOVE      ONE,KEYFLAG
          PACK      KEY22,CCDPHCD,CCDPDPT,CCPDPCD,CCCAYEAR,SP70
          PACK      KEY24,CCDPHCD,CCDPDPT,CCPDPCD,CCCAYEAR,SP70
          CALL      RSCCPS2
REPT2200  CALL      RKCCPS2
          BRANCH    OVRCD,REPT2300
          PACK      KEY24,CCPSHCD,CCPSDPT,CCPSPCD,CCPSYEAR,CCPSPER,SP70
          MATCH     KEY22,KEY24
          GOTO      REPT2300 IF NOT EQUAL
          MATCH     CCPSPER,LPERIOD
          GOTO      REPT2300 IF LESS
          MATCH     FPERIOD,CCPSPER
          GOTO      REPT2200 IF LESS
          MOVE      ZERO,KEYFLAG
          ADD       CCPSQTY,TOTALQTY
          GOTO      REPT2200
.
REPT2300  IF        PRINTZER=0
            BRANCH    KEYFLAG,REPT2100
            IF        TOTALQTY=0
              GOTO      REPT2100
            ENDIF
          ENDIF
          MOVE      CCFED1,FTOTAL1
          MOVE      TOTALQTY,F12P2
          FEDIT     F12P2,FTOTAL1
.
          CALL      HEAD0000  *  Page on each Patient Service
.
          CALL      PDET0000  *  Print Details
.
          GOTO      REPT2100  *  Next
.
REPT9000  CALL      UND80
          PRINT     *25,"*** End of Report ***"
          CALL      MESSAGE3
          MOVE      "Report Completed - ",DISPMSG
          CALL      MESSAGE1
          RETURN
.------------------------------------------------------------
. Heading
.------------------------------------------------------------
HEAD0000  CALL      HEAD80
          MOVE      "9",CLNO
          IF        CPAGENO=1
            PRINT     "First Department : ",FROMDEPT
            PRINT     "Last  Department : ",TODEPT
            ADD       "2",CLNO
          ENDIF
          PRINT     "Hospital         : ",CCHCHCD,SP7,CCHCDES:
                    "  Year : ",CCCAYEAR
          PRINT     "Department       : ",CCDPDPT,SP1,CCDPDES:
                    "Period : ",FPERIOD," to ",LPERIOD
          PRINT     "Patient Service  : ",CCPDPCD,SP1,CCPDDES
          PRINT     "Summary Total    : ",FTOTAL1
          CALL      UND80
          PRINT     "Run No. Record    Encounter        U/R         ":
                    " Date     Period        Quantity"
          CALL      UND80
.
HEAD9999  RETURN
.------------------------------------
. Print Details
.------------------------------------
PDET0000  PACK      KEY31,CCPDHCD,CCPDDPT,CCPDPCD,FROMDATE,SP70
          PACK      KEY18,CCPDHCD,CCPDDPT,CCPDPCD,FROMDATE,SP70
          MOVE      ZERO,TOTALQTY
          CALL      RSCCUP3
PDET1000  CALL      RKCCUP3
          BRANCH    OVRCD,PDET9000
          PACK      KEY31,CCUPHCD,CCUPDPT,CCUPPCD,SP70
          MATCH     KEY18,KEY31
          GOTO      PDET9000 IF NOT EQUAL
          MATCH     CCUPDAT,ENDDATE
          GOTO      PDET9000 IF LESS
.
          ADD       ONE,CLNO
          COMPARE   "55",CLNO
          CALL      HEAD0000 IF NOT LESS
          REP       " 0",CCUPDAT
          PACK      KEY14,CCUPDAT,SP70
          CALL      RSCCCA3
          CALL      RKCCCA3
          IF        OVRCD=1
            MOVE      SP70,CCCAYEAR
            MOVE      SP70,CCCAPER
          ENDIF
          UNPACK    CCUPDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     SP1,CCUPRUN,SP3,CCUPREC,SP2,CCUPENC,SP1,CCUPURN,SP1:
                    CPCDATE,SP1,CCCAPER,"/",CCCAYEAR,SP6,CCUPQTY
          ADD       CCUPQTY,TOTALQTY
          GOTO      PDET1000
.
PDET9000  MOVE      TOTALQTY,F12P2
          PRINT     *65,"---------------",*N,*50,"Detail Total",*65,F12P2
          RETURN
.
.----------------------------------------
. Patient Service Detailed Usage Analysis
.----------------------------------------
EREP0000  MOVE      "Printing : ",DISPMSG
          CALL      MESSAGE2
          MOVE      ZERO,CPAGENO
          CLOCK     TIME,CTIMEIS
          MOVE      "99",CLNO
.
          PACK      KEY31,CCHCHCD,FROMENC,SP70
          CALL      RSCCUP2
          CALL      RKCCUP2
          BRANCH    OVRCD,EREP9000
          MOVE      CCUPENC,LASTPRT
          PACK      KEY31,CCHCHCD,FROMENC,SP70
          CALL      RSCCUP2
.
EREP1000  CALL      RKCCUP2
          BRANCH    OVRCD,EREP9000
          MATCH     CCUPHCD,CCHCHCD
          GOTO      EREP9000 IF NOT EQUAL
          MATCH     CCUPENC,TOENC
          GOTO      EREP9000 IF LESS
          MATCH     CCUPENC,LASTPRT
          IF        !@EQUAL
            MOVE      CCUPENC,LASTPRT
            CALL      EHED0000
          ENDIF
.
          ADD       ONE,CLNO
          COMPARE   "55",CLNO
          CALL      EHED0000 IF NOT LESS
          REP       " 0",CCUPDAT
          PACK      KEY14,CCUPDAT,SP70
          CALL      RSCCCA3
          CALL      RKCCCA3
          IF        OVRCD=1
            MOVE      SP70,CCCAYEAR
            MOVE      SP70,CCCAPER
          ENDIF
.
          PACK      KEY18,CCUPHCD,CCUPDPT,CCUPPCD
          CALL      RDCCPD1
.
          UNPACK    CCUPDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     CCUPHCD,"/",CCUPDPT,"/",CCUPPCD,SP1,CCPDDES,SP1:
                    CCUPRUN,SP1,CCUPREC,SP2,CCUPURN,SP1:
                    CPCDATE,SP1,CCCAPER,"/",CCCAYEAR,SP1,CCUPQTY,SP1:
                    CCUPCL1,SP1,CCUPCL2,SP1,CCUPCL3,SP1,CCUPCL4
          GOTO      EREP1000
.
EREP9000  CALL      UND132
          PRINT     *45,"*** End of Report ***"
          CALL      MESSAGE3
          MOVE      "Report Completed - ",DISPMSG
          CALL      MESSAGE1
          RETURN
.------------------------------------------------------------
. EHEDing
.------------------------------------------------------------
EHED0000  CALL      HEAD132
          MOVE      "8",CLNO
          IF        CPAGENO=1
            PRINT     "First Encounter  : ",FROMENC
            PRINT     "Last  Encounter  : ",TOENC
            ADD       "2",CLNO
          ENDIF
          PRINT     "Encounter        : ",CCUPENC
          CALL      UND132
          PRINT     "Hospital/Department/Patient Service            ":
                    "           Run   Record   U/R         Date     ":
                    " Period  Quantity User Classes"
          CALL      UND132
EHED9999  RETURN
.
.----------------------------------------
. Patient Service Detailed Usage Analysis
.----------------------------------------
UREP0000  MOVE      "Printing : ",DISPMSG
          CALL      MESSAGE2
          MOVE      ZERO,CPAGENO
          CLOCK     TIME,CTIMEIS
          MOVE      "99",CLNO
.
          PACK      KEY23,FROMUR,SP70
          CALL      RSCCUP4
          CALL      RKCCUP4
          BRANCH    OVRCD,UREP9000
          MOVE      CCUPURN,LASTPRT
          PACK      KEY23,FROMUR,SP70
          CALL      RSCCUP4
UREP1000  CALL      RKCCUP4
          BRANCH    OVRCD,UREP9000
          MATCH     CCUPURN,TOUR
          GOTO      UREP9000 IF LESS
          MATCH     CCUPURN,LASTPRT
          IF        !@EQUAL
            MOVE      CCUPURN,LASTPRT
            CALL      UHED0000
          ENDIF
.
          ADD       ONE,CLNO
          COMPARE   "55",CLNO
          CALL      UHED0000 IF NOT LESS
          REP       " 0",CCUPDAT
          PACK      KEY14,CCUPDAT,SP70
          CALL      RSCCCA3
          CALL      RKCCCA3
          IF        OVRCD=1
            MOVE      SP70,CCCAYEAR
            MOVE      SP70,CCCAPER
          ENDIF
.
          PACK      KEY18,CCUPHCD,CCUPDPT,CCUPPCD
          CALL      RDCCPD1
.
          UNPACK    CCUPDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     CCUPHCD,"/",CCUPDPT,"/",CCUPPCD,SP1,CCPDDES,SP1:
                    CCUPRUN,SP1,CCUPREC,SP2,CCUPENC,SP1:
                    CPCDATE,SP1,CCCAPER,"/",CCCAYEAR,SP1,CCUPQTY,SP1:
                    CCUPCL1,SP1,CCUPCL2,SP1,CCUPCL3
          GOTO      UREP1000
.
UREP9000  CALL      UND132
          PRINT     *45,"*** End of Report ***"
          CALL      MESSAGE3
          MOVE      "Report Completed - ",DISPMSG
          CALL      MESSAGE1
          RETURN
.------------------------------------------------------------
. UHEDing
.------------------------------------------------------------
UHED0000  CALL      HEAD132
          MOVE      "8",CLNO
          IF        CPAGENO=1
            PRINT     "First U/R Code   : ",FROMUR
            PRINT     "Last  U/R Code   : ",TOUR
            ADD       "2",CLNO
          ENDIF
          PRINT     "U/R Code         : ",CCUPURN
          CALL      UND132
          PRINT     "Hospital/Department/Patient Service            ":
                    "           Run   Record   Encounter         Date     ":
                    " Period  Quantity User Classes"
          CALL      UND132
UHED9999  RETURN
.
.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       CCSCALIO/INC
          INC       CCSCALKY    
          INC       CCSDPTIO/INC
          INC       CCSDPTKY    
          INC       CCSHCDIO/INC
          INC       CCSHCDKY    
          INC       CCSPDPIO/INC
          INC       CCSPDPKY    
          INC       CCSPSDIO/INC
          INC       CCSUPDIO/INC
.
          INC       STDGENCD
.

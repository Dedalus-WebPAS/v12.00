.----------------------------------------------------------------------
.    File          : DEBCRDCD.PBL
.    
.    Function      : Include to Print Debtors Credit Notes
.
.    Modifications : 
.-------------------------------------------------------
. V9.11.01  10.10.2008 J.Tan         CAR 180356
.           Fixed MAXCLNO for CFDBILAY=8 (PRCRD0000) to 25 (from 36)
. V9.09.01  25.10.2007 Sandra Barcham    109997
.           Allow printing of partial quantities for layout 12
.-------------------------------------------------------
. V9.05.01  24.03.2006 Peter Vela      61299
.           Increased field no size from DIM3 to DIM5   
. V9.05.B01 23.12.2005 Sandra Barcham  77705
.           Print entire quantity
.----------------------------------------------------------------------
.    Operation     : The calling program should have already performed a
.                    SELPRINT to select the printer being used. The line up
.                    print routines does not require any parameters - 
.                                 CALL     CRDPL000
.                                
.                    For the Credit Note Print Routines the following files
.                    should have been read 
.                                 DBFH - Debtors Transaction Header
.                                 DBDB - Debtors Masterfile
.                                 DBTE - Debtors Terms. If Not Recorded
.                                        then ensure that DBTEDES is Blank
.                    The following files need to be open
.                                 debdbtaf
.                                 debfthaf
.                                 debfdtaf
.                                 debfnoaf
.                                 debitmaf
.                    The following includes are required
.
.                          DEBCRDDF.PBL
.                          DEBCONFD.INC
.                          DEBDBTFD.INC
.                          DEBFTHFD.INC
.                          DEBFDTFD.INC
.                          DEBFNOFD.INC
.
.                          DEBFADCD.PBL
.                          DEBDBTIO.INC
.                          DEBFTHIO.INC
.                          DEBFDTIO.INC
.                          DEBFNOIO.INC
.
.----------------------------------------------------------------------
. Print Credit Note
.----------------------------------------------------------------------
PRCRD000  READ      CONTROLF,EIGHTY1;*43,CFDBBLIN,CFDBBLST,CFDBETEL:
                                      CFDBECON,*243,CFDBILAY,CFDBSLAY
          MOVE      ONE,TMPLTFLG
          LOAD      MAXCLNO,CFDBILAY,TWENTY8,TWENTY9,THIRTY,ZERO,TWENTY1:
                                     ZERO,ZERO,TWENTY5,TWENTY2,ZERO:
                                     THIRTY3,TWENTY2
          LOAD      CRFWDROW,CFDBILAY,TWO,TWO,TWO,TWO,TWO:
                                      TWO,TWO,TWO,TWO,TWO:
                                      TWO,TWO
          LOAD      MAXLENGT,CFDBILAY,SIXTY6,SEVENTY,SIXTY6,ZERO,SIXTY6:
                                     ZERO,ZERO,SIXTY6,SIXTY6,ZERO:
                                     SIXTY6,SIXTY6
          BRANCH    CFDBILAY,PRCRD010,PRCRD020,PRCRD030,PRCRD040,PRCRD050:
                             PRCRD060,PRCRD070,PRCRD080,PRCRD090,PRCRD100:
                             PRCRD110,PRCRD120
.
PRCRD010  CALL      CRSTD000     * Standard
          GOTO      PRCRD999
.
PRCRD020  CALL      CREPW000     * Epworth
          GOTO      PRCRD999
.
PRCRD030  CALL      CRMOD000     * Modbury
          GOTO      PRCRD999
.
PRCRD040  CALL      CRSTH000     * Southland
          GOTO      PRCRD999
.
PRCRD050  CALL      CRWGH000     * West Gippsland
          GOTO      PRCRD999
.
PRCRD060  CALL      CRCHC000     * Coast Health Care
          GOTO      PRCRD999
.
PRCRD070  CALL      CRHWK000     * Hawkes Bay
          GOTO      PRCRD999
.
PRCRD080  CALL      CRHSH000     * Holy Spirit
          GOTO      PRCRD999
.
PRCRD090  CALL      CRWWH000     * West Wimmera
          GOTO      PRCRD999
.
PRCRD100  CALL      CRHUT000     * Hutt Valley
          GOTO      PRCRD999
.
PRCRD110  CALL      CRBHS000     * Ballarat Health Services
          GOTO      PRCRD999
.
PRCRD120  CALL      CR132000     * Standard 132 Columns
          GOTO      PRCRD999
.
PRCRD999  RETURN
.----------------------------------------------------------------------
. Print Credit Note Print Linup
.----------------------------------------------------------------------
CRDPL000  READ      CONTROLF,EIGHTY1;*43,CFDBBLIN,CFDBBLST,CFDBETEL:
                                      CFDBECON,*243,CFDBILAY,CFDBSLAY
          MOVE      ONE,TMPLTFLG
          LOAD      MAXCLNO,CFDBILAY,TWENTY2,THIRTY4,TWENTY9,ZERO,TWENTY:
                                     ZERO,ZERO,THIRTY6,TWENTY1,ZERO:
                                     THIRTY4,TWENTY2
          LOAD      CRFWDROW,CFDBILAY,TWO,TWO,TWO,TWO,TWO:
                                      TWO,TWO,TWO,TWO,TWO:
                                      TWO,TWO
          LOAD      MAXLENGT,CFDBILAY,SIXTY6,SEVENTY,SIXTY6,ZERO,SIXTY6:
                                     ZERO,ZERO,SIXTY6,SIXTY6,ZERO:
                                     SIXTY6,SIXTY6
          BRANCH    CFDBILAY,CRDPL010,CRDPL020,CRDPL030,CRDPL040,CRDPL050:
                             CRDPL060,CRDPL070,CRDPL080,CRDPL090,CRDPL100:
                             CRDPL110,CRDPL120
.
CRDPL010  CALL      CLSTD000     * Standard
          GOTO      CRDPL900
.
CRDPL020  CALL      CLEPW000     * Epworth   
          GOTO      CRDPL900
.
CRDPL030  CALL      CLMOD000     * Modbury  
          GOTO      CRDPL900
.
CRDPL040  CALL      CLSTH000     * Southland
          GOTO      CRDPL999
.
CRDPL050  CALL      CLWGH000     * West Gippsland
          GOTO      CRDPL900
.
CRDPL060  CALL      CLCHC000     * Coast Health Care
          GOTO      CRDPL999
.
CRDPL070  CALL      CLHWK000     * Hawkes Bay
          GOTO      CRDPL999
.
CRDPL080  CALL      CLHSH000     * Holy Spirit
          GOTO      CRDPL900
.
CRDPL090  CALL      CLWWH000     * West Wimmera
          GOTO      CRDPL900
.
CRDPL100  CALL      CLHUT000     * Hutt Valley
          GOTO      CRDPL999
.
CRDPL110  CALL      CLBHS000     * Ballarat Health Services
          GOTO      CRDPL900
.
CRDPL120  CALL      CL132000     * Standard 132 Columns
          GOTO      CRDPL900
.
CRDPL900  PACK      DBFHUR1,SP70
          PACK      DBFHUR2,SP70
          GOTO      CRDPL999
.
CRDPL999  RETURN
.------------------------------------------------------------------------------
. Standard Credit Note Layout
.------------------------------------------------------------------------------
CLSTD000  CALL      OPNPRINT
.
          CALL      STMPL000        * Set up for Templating
          IF        TMPLTFLG=0
            CALL      XSET0000      * Set Variables value for lineup
            MOVE      ZERO,HEADTAIL   * Flagged to Header
            CALL      XCRD0000      * Print Tax Credit Note Header
            PRINT     *N;
.
            PRINT     CPCDATE,*12,DIM7:
                      *20,DBITUNT,*25,DIM10A,*37,DIM14A:
                      *52,DIM14B,*68,TOTDIM13
            PRINT     *12,KEY28
            MOVE      FOUR,CURRROW
            MOVE      MAXCLNO,F3
            CALL      XPOS0000
.
            PRINT     *N,*1,"CREDIT TOTAL",*35,DIM14:
                      *49,DIM14TAX,*67,DIM14GRN
.
            IF        TMPLTFLG=0
              MOVE      ONE,HEADTAIL  * Flagged to Tail
              CALL      XCRD0000    * Print Tax Credit Note Tail
              PRINT     " "
            ENDIF
            GOTO      CLSTD900
          ENDIF
.
          PRINT     *N,*N,*N,*N,*N,*N,*N:
                    *N,*2,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*2,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*2,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*2,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*2,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*N,*N:
                    *2,"000000",*71,"000000":
                    *N,*N,*N,*71,"00/00/0000":
                    *N,*N,*N,*N,*N:
.
                    "99/99/9999",*12,"XXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *40,"99999.99",SP1,"XXXX",SP1,"99999999.9999":
                    "99,999,999.99":
.
                    *N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*50,"CREDIT TOTAL",*71,"0000000.00":
                    *N,*N,*71,"0000000.00":
                    *N,*N,*N,*N:
                    *N,*71,"0000000.00":
                    *N,*N,*2,"00/00/0000",*13,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*N,*N,*13,"000000",*25,"000000":
                    *N,*N,*N,*N,*N
CLSTD900  CALL      CLSPRINT
.
          CALL      LINOK000
          COMPARE   ZERO,FYESNO
          GOTO      CLSTD000 IF EQUAL
.
CLSTD999  RETURN
.------------------------------------------------------------
. Line Up OK Question Routine. Returns FYESNO  0=No 1=Yes
.------------------------------------------------------------
LINOK000 DISPLAY    *P1:24,*EL,"Line-Up Print OK (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? "
         MOVE       "26",CCOL
         MOVE       "24",CVERT
         CALL       YORN0000
         RETURN
.------------------------------------------------------------------------------
. Lineup print for Credit Notes (MODBURY)
.------------------------------------------------------------------------------
CLMOD000  CALL      OPNPRINT
.
          CALL      STMPL000        * Set up for Templating
          IF        TMPLTFLG=0
            CALL      XSET0000      * Set Variables value for lineup
            MOVE      ZERO,HEADTAIL   * Flagged to Header
            CALL      XCRD0000      * Print Tax Credit Note Header
            PRINT     *N;
.
            PRINT     CPCDATE,*12,QTYDIM8:
                      *25,DIM10A,*37,DIM14A:
                      *52,DIM14B,*68,TOTDIM13
            PRINT     *12,DBFDITM,*21,KEY20
            MOVE      FOUR,CURRROW
            MOVE      MAXCLNO,F3
            CALL      XPOS0000
.
            PRINT     *N,*1,"CREDIT TOTAL",*35,DIM14:
                      *49,DIM14TAX,*67,DIM14GRN
.
            IF        TMPLTFLG=0
              MOVE      ONE,HEADTAIL  * Flagged to Tail
              CALL      XCRD0000    * Print Tax Credit Note Tail
              PRINT     " "
            ENDIF
            GOTO      CLMOD900
          ENDIF
.
         PRINT      *N,*N,*N,*N,*N,*N,*N:
                    *N,*3,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*3,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*3,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*3,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*3,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*N,*N,*N:
                    *2,"XXXXXXXX",*72,"9999999999":
                    *N,*N,*N,*72,"99/99/9999":
                    *N,*N,*N,*N,*N:
.
                    "99/99/9999",*12,"XXXXXXXX",*21,"XXXXXXXXXXXXXXXXXXXX":
                    *44,"99999.99",SP1,"99999999.9999"," 9,999,999.99":
.
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*71,"00000000.00":
                    *N,*N,*N,*N,*N,*N,*N,*1,"99/99/9999":
                    *15,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*N,*71,"00000000.00":
                    *N,*24,"9999999999"
CLMOD900 CALL       CLSPRINT
.
         CALL       LINOK000
         COMPARE    ZERO,FYESNO
         GOTO       CLMOD000 IF EQUAL
.
CLMOD999 RETURN
.------------------------------------------------------------------------------
. Lineup print for credit notes Southland
.------------------------------------------------------------------------------
CLSTH000  CALL      OPNPRINT
          PRINT     *N,*N,*N,*N,*N,*N,*N:
                    *N,*5,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*5,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*5,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*5,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*5,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*N,*N:
                    *2,"000000",*71,"000000":
                    *N,*N,*N,*71,"00/00/0000":
                    *N,*N,*N,*N:
                    *N,*2,"XXXXXXXXXX":
                    *12,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *42,"00000.00",*51,"XXXX":
                    *59,"0000000.00",*70,"0000000.00":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*50,"CREDIT TOTAL",*70,"0000000.00":
                    *N,*N,*70,"0000000.00":
                    *N,*N,*N,*N:
                    *N,*70,"0000000.00":
                    *N,*N,*2,"00/00/0000",*13,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*N,*N,*13,"000000",*25,"000000":
                    *N,*N,*N,*N,*N
          CALL      CLSPRINT
.
          CALL      LINOK000
          COMPARE   ZERO,FYESNO
          GOTO      CLSTD000 IF EQUAL
          RETURN
.------------------------------------------------------------------------------
. Lineup print for Credit Notes (WGH)
.------------------------------------------------------------------------------
CLWGH000  CALL      OPNPRINT
.
          CALL      STMPL000        * Set up for Templating
          IF        TMPLTFLG=0
            CALL      XSET0000      * Set Variables value for lineup
            MOVE      ZERO,HEADTAIL   * Flagged to Header
            CALL      XCRD0000      * Print Tax Credit Note Header
            PRINT     *N;
.
            PRINT     CPCDATE,*12,QTYDIM8:
                      *25,DIM10A,*37,DIM14A:
                      *52,DIM14B,*68,TOTDIM13
            PRINT     *12,DBFDITM,*21,KEY20
            MOVE      FOUR,CURRROW
            MOVE      MAXCLNO,F3
            CALL      XPOS0000
.
            PRINT     *N,*1,"CREDIT TOTAL",*34,DIM14:
                      *48,DIM14TAX,*67,DIM14GRN
.
            IF        TMPLTFLG=0
              MOVE      ONE,HEADTAIL  * Flagged to Tail
              CALL      XCRD0000    * Print Tax Credit Note Tail
              PRINT     " "
            ENDIF
            GOTO      CLWGH900
          ENDIF
.
         PRINT      *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*13,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*13,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*13,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*13,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*13,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*N
.
         PRINT      *2,"XXXXXXXX",*54,"99/99/9999":
                    *69,"9999999999":
                    *N,*N,*N,*N,*N,*N,*N:
                    "99/99/9999",*12,"XXXXXXXX",*21,"XXXXXXXXXXXXXXXXXXXX":
                    *44,"99999.99",SP1,"99999999.9999"," 9,999,999.99":
.
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N:
                    *N,*68,"0000000.00":
                    *N,*N,*N,*N,*N,*N:
                    *N,*N,*2,"99/99/9999",*15,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*N,*N,*N,*68,"0000000.00":
                    *N,*N,*N,*N,*3,"XXXXXXXX",*33,"9999999999"
CLWGH900 CALL       CLSPRINT
         CALL       LINOK000
         COMPARE    ZERO,FYESNO
         GOTO       CLWGH000 IF EQUAL
.
CLWGH999 RETURN
.------------------------------------------------------------------------------
. Print credit notes (Standard)
.------------------------------------------------------------------------------
CRSTD000  MOVE      ZERO,TOTCRD
          MOVE      ZERO,TGSTEXCV
          MOVE      ZERO,TGSTAMNT
          MOVE      ZERO,CPAGENO
.
          CALL      STMPL000        * Set up for Templating
          CALL      FORAD000        * Format Name & Address into 5 Lines
          CALL      CHSTD000        * Print Heading
.
         PACK       KEY24,DBFHDEB,DBFHDTY,DBFHDOC,SP70
         CALL       RSDBFD1
CRSTD100 CALL       RKDBFD1
         BRANCH     OVRCD,CRSTD900
         MATCH      DBFHDEB,DBFDDEB
         GOTO       CRSTD900 IF NOT EQUAL
         MATCH      DBFHDTY,DBFDDTY
         GOTO       CRSTD900 IF NOT EQUAL
         MATCH      DBFHDOC,DBFDDOC
         GOTO       CRSTD900 IF NOT EQUAL
.
         PACK       KEY8,DBFDITM
         CALL       RDDBIT1        * Read Sales Item Details
.
         UNPACK     DBFDSDAT,CCENT,CYEAR,CMON,CDAY
         CALL       PACDATE
         MOVE       "99999.99",QTYDIM8
         FEDIT      DBFDQTY,QTYDIM8
         IF         DBFDQTY=0
           MOVE       SP70,QTYDIM8
           MOVE       SP70,DBITUNT
         ENDIF
.
         MOVE       "99999999.9999",PRIDIM13
         FEDIT      DBFDPRI,PRIDIM13
         IF         DBFDPRI=0
           MOVE       SP70,PRIDIM13
         ENDIF
.
         MOVE       "99,999,999.99",TOTDIM13
         ASSIGN     DBFDTAX+DBFDTOT,F12P2
         FEDIT      F12P2,TOTDIM13
         IF         F12P2=0
           MOVE       SP70,TOTDIM13
         ENDIF
         ADD        F12P2,TOTCRD
         ADD        DBFDTOT,TGSTEXCV
         ADD        DBFDTAX,TGSTAMNT
.
         MOVE       DBITIDE,KEY28
.
          BRANCH    TMPLTFLG,CRSTD130
.
          MOVE      "9999.99",DIM7
          MOVE      DBFDQTY,F4P2
          FEDIT     F4P2,DIM7
.
          MOVE      "999,999.99",DIM10A
          MOVE      DBFDPRI,F12P2
          FEDIT     F12P2,DIM10A
.
          MOVE      "999,999,999.99",DIM14A
          FEDIT     DBFDTOT,DIM14A
.
          MOVE      "999,999,999.99",DIM14B
          FEDIT     DBFDTAX,DIM14B
.
          PRINT     CPCDATE,*12,DIM7:
                    *20,DBITUNT,*25,DIM10A,*37,DIM14A:
                    *52,DIM14B,*68,TOTDIM13
          ADD       ONE,CLNO
          COMPARE   MAXCLNO,CLNO
          CALL      CFSTD000 IF EQUAL
.
          PRINT     *12,KEY28
.
          GOTO      CRSTD140
.
CRSTD130 PRINT      CPCDATE,*12,KEY28:
                    *40,QTYDIM8,SP1,DBITUNT,SP1,PRIDIM13,TOTDIM13
CRSTD140 ADD        ONE,CLNO
         COMPARE    MAXCLNO,CLNO
         CALL       CFSTD000 IF EQUAL
.
. Print Credit Detail lines
.----------------------------
          MATCH     SP70,DBFDDREF
          IF        !@EQUAL
            PRINT     *12,DBFDDREF
            ADD       ONE,CLNO
            COMPARE   MAXCLNO,CLNO
            CALL      CFSTD000 IF EQUAL
          ENDIF 
.
          PACK      KEY27,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,SP70
          CALL      RSDBFN1
CRSTD150  CALL      RKDBFN1
          BRANCH    OVRCD,CRSTD100
          PACK      KEY24,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,SP70
          PACK      KEY27,DBFNDEB,DBFNDTY,DBFNDOC,DBFNDLN,SP70
          MATCH     KEY24,KEY27
          GOTO      CRSTD100 IF NOT EQUAL
.
          PRINT     *12,DBFNCOM
          ADD       ONE,CLNO
          COMPARE   MAXCLNO,CLNO
          CALL      CFSTD000 IF EQUAL
          GOTO      CRSTD150
.
CRSTD900  ASSIGN    MAXCLNO-TWO,F2
          COMPARE   F2,CLNO
          GOTO      CRSTD990 IF EQUAL
          GOTO      CRSTD980 IF NOT LESS
          PRINT     " "
          ADD       ONE,CLNO
          GOTO      CRSTD900
.
CRSTD980  CALL      CFSTD000
          GOTO      CRSTD900
.
CRSTD990  MOVE      "999,999,999.99",DIM14
          FEDIT     TGSTEXCV,DIM14
          MOVE      "999,999,999.99",DIM14TAX
          FEDIT     TGSTAMNT,DIM14TAX
          MOVE      "999,999,999.99",DIM14GRN
          FEDIT     TOTCRD,DIM14GRN
.
          PRINT     *N,*1,"CREDIT TOTAL",*35,DIM14:
                    *49,DIM14TAX,*67,DIM14GRN
          ADD       TWO,CLNO
.
          IF        TMPLTFLG=0
            MOVE      "999,999,999.99",FTOTINV
            FEDIT     TOTCRD,FTOTINV
.
            MOVE      "999,999,999.99",FTGSTEXC
            FEDIT     TGSTEXCV,FTGSTEXC
.
            MOVE      "999,999,999.99",FTGSTAMN
            FEDIT     TGSTAMNT,FTGSTAMN
.
            MOVE      ONE,HEADTAIL    * Flagged to Tail
            CALL      XCRD0000      * Print Tax Credit Note Tail
            PRINT     " "
            GOTO      CRSTD999
          ENDIF
.
          UNPACK    DBFHDDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     *N,*N,*53,"CREDIT TOTAL",*65,TOTCRD:
                    *N,*N,*65,TOTCRD:
                    *N,*N,*N,*N:
                    *N,*65,TOTCRD:
                    *N,*N,*2,CPCDATE,*13,NADLINE1:
                    *N,*N,*N,*12,DBFHDEB,*22,DBFHDOC:
                    *N,*N,*N,*N,*N
.
CRSTD999  RETURN
.-------------------------------------------------------------------------------
. Carried forward
.-------------------------------------------------------------------------------
CFSTD000  IF        TMPLTFLG=0
            MOVE      CRFWDROW,F3
            MOVE      ONE,CURRROW
            CALL      XPOS0000
            BRANCH    EXIT,CFSTD100
.
            PRINT     *CRFWDCOL,*+,"CARRIED FWD";
.
            MOVE      TAILLENG,F3
            CALL      XPOS0000
            PRINT     *N;
            GOTO      CFSTD900
          ENDIF
.
CFSTD100  PRINT     *N,*N,*N,*N,*N,*N,*N,*N:
                    *70,"CARRIED FWD":
                    *N,*N,*N,*N,*N,*N
CFSTD900  CALL      CHSTD000
.
CFSTD999  RETURN
.------------------------------------------------------------------------------
. Print Header for credit note (Credit Header)
.------------------------------------------------------------------------------
CHSTD000  ADD       ONE,CPAGENO
          MOVE      ZERO,CLNO
.
. Determine whether to use Tax Credit Note Templating
.
          IF        TMPLTFLG=0
            MOVE      ZERO,HEADTAIL   * Flagged to Header
            CALL      XCRD0000      * Print Tax Credit Note Header
            PRINT     *N;
            GOTO      CHSTD999
          ENDIF
.
          PRINT     *N,*N,*N,*N,*N,*N,*N:
                    *N,*2,NADLINE1:
                    *N,*2,NADLINE2:
                    *N,*2,NADLINE3:
                    *N,*2,NADLINE4:
                    *N,*2,NADLINE5:
                    *N,*N:
                    *N,*2,DBFHDEB,*70,DBFHDOC:
                    *N,*N,*N,*71,CPCDATE:
                    *N,*N,*N,*N
.
CHSTD999  RETURN
.------------------------------------------------------------------------------
. Lineup print for Epworth
.------------------------------------------------------------------------------
CLEPW000  CALL      OPNPRINT
.
          CALL      STMPL000        * Set up for Templating
          IF        TMPLTFLG=0
            CALL      XSET0000      * Set Variables value for lineup
            MOVE      ZERO,HEADTAIL   * Flagged to Header
            CALL      XCRD0000      * Print Tax Credit Note Header
            PRINT     *N;
.
            PRINT     CPCDATE,*12,DIM7:
                      *20,DBITUNT,*25,DIM10A,*37,DIM14A:
                      *52,DIM14B,*68,TOTDIM13
            PRINT     *12,KEY28
            MOVE      FOUR,CURRROW
            MOVE      MAXCLNO,F3
            CALL      XPOS0000
.
            PRINT     *N,*1,"CREDIT TOTAL",*35,DIM14:
                      *49,DIM14TAX,*65,DIM14GRN
.
            IF        TMPLTFLG=0
              MOVE      ONE,HEADTAIL  * Flagged to Tail
              CALL      XCRD0000    * Print Tax Credit Note Tail
              PRINT     " "
            ENDIF
            GOTO      CLEPW900
          ENDIF
.
         PRINT      *N,*N,*N,*N:
                    *N,*2,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*2,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*2,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*2,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*2,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*N,*N,*2,"000000",*71,"000000":
                    *N,*N,*N,*71,"00/00/0000":
                    *N,*N,*N,*N,*N:
.
                    "99/99/9999",*12,"XXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *40,"99999.99",SP1,"XXXX","99999999.9999":
                    " 9,999,999.99":
.
                    *N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N:
                    *N,*N,*71,"0000000.00":
                    *N,*N,*N,*N:
                    *N,*71,"0000000.00":
                    *N,*N,*2,"00/00/0000",*13,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*N,*N,*13,"000000",*25,"000000":
                    *N,*N,*N,*N,*N,*N,*N,*N
CLEPW900 CALL       CLSPRINT
         CALL       LINOK000
         COMPARE    ZERO,FYESNO
         GOTO       CLEPW000 IF EQUAL
.
CLEPW999 RETURN
.------------------------------------------------------------------------------
. Print credit notes (Epworth)
.------------------------------------------------------------------------------
CREPW000  MOVE      ZERO,TOTCRD
          MOVE      ZERO,TGSTEXCV
          MOVE      ZERO,TGSTAMNT
          MOVE      ZERO,CPAGENO
.
          CALL      STMPL000        * Set up for Templating
          CALL      FORAD000        * Format Name & Address into 5 Lines
          CALL      CHEPW000        * Print Heading
.
         PACK       KEY24,DBFHDEB,DBFHDTY,DBFHDOC,SP70
         CALL       RSDBFD1
CREPW100 CALL       RKDBFD1
         BRANCH     OVRCD,CREPW900
         MATCH      DBFHDEB,DBFDDEB
         GOTO       CREPW900 IF NOT EQUAL
         MATCH      DBFHDTY,DBFDDTY
         GOTO       CREPW900 IF NOT EQUAL
         MATCH      DBFHDOC,DBFDDOC
         GOTO       CREPW900 IF NOT EQUAL
.
         PACK       KEY8,DBFDITM
         CALL       RDDBIT1        * Read Sales Item Details
.
         UNPACK     DBFDSDAT,CCENT,CYEAR,CMON,CDAY
         CALL       PACDATE
.
          MOVE      "9,999.99",DIM8QTY
          FEDIT     DBFDQTY,DIM8QTY
          IF        DBFDQTY=0
            MOVE      SP70,DIM8QTY
            MOVE      SP70,DBITUNT
          ENDIF
.
          MOVE      "999,999.99",DIM10PRI
          MOVE      DBFDPRI,F12P2
          FEDIT     F12P2,DIM10PRI
          IF        F12P2=0
            MOVE      SP70,DIM10PRI
          ENDIF
.
          MOVE      "999,999.99",DIM10TOT
          FEDIT     DBFDTOT,DIM10TOT
          IF        DBFDTOT=0
            MOVE      SP70,DIM10TOT
          ENDIF
          ADD       DBFDTOT,TGSTEXCV
.
          MOVE      "99,999,999.99",DIM13TAX
          FEDIT     DBFDTAX,DIM13TAX
          IF        DBFDTAX=0
            MOVE      SP70,DIM13TAX
          ENDIF
          ADD       DBFDTAX,TGSTAMNT
.
          ASSIGN    DBFDTAX+DBFDTOT,F12P2
          MOVE      "999,999,999.99",DIM14GRN
          FEDIT     F12P2,DIM14GRN
          IF        F12P2=0
            MOVE      SP70,DIM14GRN
          ENDIF
          ADD       F12P2,TOTCRD
.
          PRINT     CPCDATE,*12,DIM8QTY:
                    *21,DBITUNT,*26,DIM10PRI,*38,DIM10TOT:
                    *49,DIM13TAX,*64,DIM14GRN
          ADD       ONE,CLNO
          COMPARE   MAXCLNO,CLNO
          CALL      CFEPW000 IF EQUAL
.
          MOVE      DBITIDE,KEY28
.
          PRINT     *12,KEY28
.
         ADD        ONE,CLNO
         COMPARE    MAXCLNO,CLNO
         CALL       CFEPW000 IF EQUAL
.
. Print Credit Detail lines
.----------------------------
          MATCH     SP70,DBFDDREF
          IF        !@EQUAL
            PRINT     *12,DBFDDREF
            ADD       ONE,CLNO
            COMPARE   MAXCLNO,CLNO
            CALL      CFEPW000 IF EQUAL
          ENDIF 
.
          PACK      KEY27,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,SP70
          CALL      RSDBFN1
CREPW150  CALL      RKDBFN1
          BRANCH    OVRCD,CREPW100
          PACK      KEY24,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,SP70
          PACK      KEY27,DBFNDEB,DBFNDTY,DBFNDOC,DBFNDLN,SP70
          MATCH     KEY24,KEY27
          GOTO      CREPW100 IF NOT EQUAL
.
          PRINT     *12,DBFNCOM
          ADD       ONE,CLNO
          COMPARE   MAXCLNO,CLNO
          CALL      CFEPW000 IF EQUAL
          GOTO      CREPW150
.
CREPW900  ASSIGN    MAXCLNO-TWO,F2
          COMPARE   F2,CLNO
          GOTO      CREPW990 IF EQUAL
          GOTO      CREPW980 IF NOT LESS
          PRINT     " "
          ADD       ONE,CLNO
          GOTO      CREPW900
.
CREPW980  CALL      CFEPW000
          GOTO      CREPW900
.
CREPW990  MOVE      "999,999,999.99",DIM14
          FEDIT     TGSTEXCV,DIM14
          MOVE      "999,999,999.99",DIM14TAX
          FEDIT     TGSTAMNT,DIM14TAX
          MOVE      "999,999,999.99",DIM14GRN
          FEDIT     TOTCRD,DIM14GRN
.
          PRINT     *N,*1,"CREDIT TOTAL",*35,DIM14:
                    *49,DIM14TAX,*65,DIM14GRN
          ADD       TWO,CLNO
.
          IF        TMPLTFLG=0
            MOVE      "999,999,999.99",FTOTINV
            FEDIT     TOTCRD,FTOTINV
.
            MOVE      "999,999,999.99",FTGSTEXC
            FEDIT     TGSTEXCV,FTGSTEXC
.
            MOVE      "999,999,999.99",FTGSTAMN
            FEDIT     TGSTAMNT,FTGSTAMN
.
            MOVE      ONE,HEADTAIL    * Flagged to Tail
            CALL      XCRD0000      * Print Tax Credit Note Tail
            PRINT     " "
            GOTO      CREPW999
          ENDIF
.
          UNPACK    DBFHDDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      DBFHDOC,F12
          PRINT     *N,*N,*50,"CREDIT TOTAL",*64,TOTCRD:
                    *N,*N,*N,*N:
                    *N,*64,TOTCRD:
                    *N,*N,*2,CPCDATE,*13,NADLINE1:
                    *N,*N,*N,*12,DBFHDEB,*21,F12:
                    *N,*N,*N,*N,*N,*N,*N,*N
.
CREPW999  RETURN
.-------------------------------------------------------------------------------
. Carried forward
.-------------------------------------------------------------------------------
CFEPW000  IF        TMPLTFLG=0
            MOVE      CRFWDROW,F3
            MOVE      ONE,CURRROW
            CALL      XPOS0000
            BRANCH    EXIT,CFEPW100
.
            PRINT     *CRFWDCOL,*+,"CARRIED FWD";
.
            MOVE      TAILLENG,F3
            CALL      XPOS0000
            PRINT     *N;
            GOTO      CFEPW900
          ENDIF
.
CFEPW100  PRINT     *N,*70,"CARRIED FWD":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N
CFEPW900  CALL      CHEPW000
.
CFEPW999  RETURN
.------------------------------------------------------------------------------
. Print Header for credit note (Credit Header)
.------------------------------------------------------------------------------
CHEPW000  ADD       ONE,CPAGENO
          MOVE      ZERO,CLNO
.
. Determine whether to use Tax Credit Note Templating
.
          IF        TMPLTFLG=0
            MOVE      ZERO,HEADTAIL   * Flagged to Header
            CALL      XCRD0000      * Print Tax Credit Note Header
            GOTO      CHEPW999
          ENDIF
.
          MOVE      DBFHDOC,F12
          UNPACK    DBFHDDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     *N,*N,*N,*N:
                    *N,*2,NADLINE1:
                    *N,*2,NADLINE2:
                    *N,*2,NADLINE3:
                    *N,*2,NADLINE4:
                    *N,*2,NADLINE5:
                    *N,*N:
                    *N,*2,DBFHDEB,*69,F12:
                    *N,*N,*N,*71,CPCDATE:
                    *N,*N,*N,*N
.
CHEPW999  RETURN
.------------------------------------------------------------------------------
. Print credit notes (MOD)
.------------------------------------------------------------------------------
CRMOD000  MOVE      ZERO,TOTCRD
          MOVE      ZERO,TGSTEXCV
          MOVE      ZERO,TGSTAMNT
          MOVE      ZERO,CPAGENO
.
          CALL      STMPL000        * Set up for Templating
          CALL      FORAD000        * Format Name & Address into 5 Lines
          CALL      CHMOD000        * Print Heading
.
         PACK       KEY24,DBFHDEB,DBFHDTY,DBFHDOC,SP70
         CALL       RSDBFD1
CRMOD100 CALL       RKDBFD1
         BRANCH     OVRCD,CRMOD900
         MATCH      DBFHDEB,DBFDDEB
         GOTO       CRMOD900 IF NOT EQUAL
         MATCH      DBFHDTY,DBFDDTY
         GOTO       CRMOD900 IF NOT EQUAL
         MATCH      DBFHDOC,DBFDDOC
         GOTO       CRMOD900 IF NOT EQUAL
.
         PACK       KEY8,DBFDITM
         CALL       RDDBIT1        * Read Sales Item Details
.
         UNPACK     DBFDSDAT,CCENT,CYEAR,CMON,CDAY
         CALL       PACDATE
.
          MOVE      "9,999.99",DIM8QTY
          FEDIT     DBFDQTY,DIM8QTY
          IF        DBFDQTY=0
            MOVE      SP70,DIM8QTY
            MOVE      SP70,DBITUNT
          ENDIF
.
          MOVE      "999,999.99",DIM10PRI
          MOVE      DBFDPRI,F12P2
          FEDIT     F12P2,DIM10PRI
          IF        F12P2=0
            MOVE      SP70,DIM10PRI
          ENDIF
.
          MOVE      "999,999.99",DIM10TOT
          FEDIT     DBFDTOT,DIM10TOT
          IF        DBFDTOT=0
            MOVE      SP70,DIM10TOT
          ENDIF
          ADD       DBFDTOT,TGSTEXCV
.
          MOVE      "99,999,999.99",DIM13TAX
          FEDIT     DBFDTAX,DIM13TAX
          IF        DBFDTAX=0
            MOVE      SP70,DIM13TAX
          ENDIF
          ADD       DBFDTAX,TGSTAMNT
.
          ASSIGN    DBFDTAX+DBFDTOT,F12P2
          MOVE      "999,999,999.99",DIM14GRN
          FEDIT     F12P2,DIM14GRN
          IF        F12P2=0
            MOVE      SP70,DIM14GRN
          ENDIF
          ADD       F12P2,TOTCRD
.
          PRINT     CPCDATE,*12,DIM8QTY:
                    *26,DIM10PRI,*39,DIM10TOT:
                    *50,DIM13TAX,*67,DIM14GRN
          ADD       ONE,CLNO
          COMPARE   MAXCLNO,CLNO
          CALL      CFMOD000 IF EQUAL
.
          MOVE      DBITIDE,KEY20
.
          PRINT     *12,DBFDITM,*21,KEY20
.
         ADD        ONE,CLNO
         COMPARE    MAXCLNO,CLNO
         CALL       CFMOD000 IF EQUAL
.
. Print Credit Detail lines
.----------------------------
.
          MATCH     SP70,DBFDDREF
          IF        !@EQUAL
            PRINT     *12,DBFDDREF
            ADD       ONE,CLNO
            COMPARE   MAXCLNO,CLNO
            CALL      CFMOD000 IF EQUAL
          ENDIF 
.
          PACK      KEY27,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,SP70
          CALL      RSDBFN1
CRMOD150  CALL      RKDBFN1
          BRANCH    OVRCD,CRMOD100
          PACK      KEY24,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,SP70
          PACK      KEY27,DBFNDEB,DBFNDTY,DBFNDOC,DBFNDLN,SP70
          MATCH     KEY24,KEY27
          GOTO      CRMOD100 IF NOT EQUAL
.
          PRINT     *12,DBFNCOM
          ADD       ONE,CLNO
          COMPARE   MAXCLNO,CLNO
          CALL      CFMOD000 IF EQUAL
          GOTO      CRMOD150
.
CRMOD900  ASSIGN    MAXCLNO-TWO,F2
          COMPARE   F2,CLNO
          GOTO      CRMOD990 IF EQUAL
          GOTO      CRMOD980 IF NOT LESS
          PRINT     " "
          ADD       ONE,CLNO
          GOTO      CRMOD900
.
CRMOD980  CALL      CFMOD000
          GOTO      CRMOD900
.
CRMOD990  MOVE      "999,999,999.99",DIM14
          FEDIT     TGSTEXCV,DIM14
          MOVE      "999,999,999.99",DIM14TAX
          FEDIT     TGSTAMNT,DIM14TAX
          MOVE      "999,999,999.99",DIM14GRN
          FEDIT     TOTCRD,DIM14GRN
.
          PRINT     *N,*1,"CREDIT TOTAL",*35,DIM14:
                    *49,DIM14TAX,*67,DIM14GRN
          ADD       TWO,CLNO
.
          IF        TMPLTFLG=0
            MOVE      "999,999,999.99",FTOTINV
            FEDIT     TOTCRD,FTOTINV
.
            MOVE      "999,999,999.99",FTGSTEXC
            FEDIT     TGSTEXCV,FTGSTEXC
.
            MOVE      "999,999,999.99",FTGSTAMN
            FEDIT     TGSTAMNT,FTGSTAMN
.
            MOVE      ONE,HEADTAIL    * Flagged to Tail
            CALL      XCRD0000      * Print Tax Credit Note Tail
            PRINT     " "
            GOTO      CRMOD999
          ENDIF
.
          UNPACK    DBFHDDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      DBFHDOC,F12
          PRINT     *N,*64,TOTCRD:
                    *N,*N,*N,*N,*N,*N,*N:
                    *1,CPCDATE,*15,NADLINE1:
                    *N,*N,*64,TOTCRD:
                    *N,*13,DBFHDEB,*22,F12
.
CRMOD999  RETURN
.-------------------------------------------------------------------------------
. Carried forward
.-------------------------------------------------------------------------------
CFMOD000  IF        TMPLTFLG=0
            MOVE      CRFWDROW,F3
            MOVE      ONE,CURRROW
            CALL      XPOS0000
            BRANCH    EXIT,CFMOD100
.
            PRINT     *CRFWDCOL,*+,"CARRIED FWD";
.
            MOVE      TAILLENG,F3
            CALL      XPOS0000
            PRINT     *N;
            GOTO      CFMOD900
          ENDIF
.
CFMOD100  PRINT     *N,*68,"CARRIED FWD",*N,*N
CFMOD900  CALL      CHMOD000
.
CFMOD999  RETURN
.------------------------------------------------------------------------------
. Print Header for credit note (Credit Header)
.------------------------------------------------------------------------------
CHMOD000  ADD       ONE,CPAGENO
          MOVE      ZERO,CLNO
.
. Determine whether to use Tax Credit Note Templating
.
          IF        TMPLTFLG=0
            MOVE      ZERO,HEADTAIL   * Flagged to Header
            CALL      XCRD0000      * Print Tax Credit Note Header
            GOTO      CHMOD999
          ENDIF
.
          MOVE      DBFHDOC,F12
          UNPACK    DBFHDDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     *F,*N,*N,*N,*N,*N,*N,*N:
                    *N,*3,NADLINE1:
                    *N,*3,NADLINE2:
                    *N,*3,NADLINE3:
                    *N,*3,NADLINE4:
                    *N,*3,NADLINE5:
                    *N,*N,*N
          PRINT     *2,DBFHDEB:
                    *69,F12:
                    *N,*N,*N,*2,"CREDIT NOTE":
                    *71,CPCDATE:
                    *N,*N,*N,*N
.
CHMOD999  RETURN
.------------------------------------------------------------------------------
. Print credit notes (Southland)
.------------------------------------------------------------------------------
CRSTH000  MOVE      ZERO,TOTCRD
          MOVE      ZERO,CPAGENO
.
          CALL      FORAD000        * Format Name & Address into 5 Lines
          CALL      CHSTH000        * Print Heading
.
         PACK       KEY24,DBFHDEB,DBFHDTY,DBFHDOC,SP70
         CALL       RSDBFD1
CRSTH100 CALL       RKDBFD1
         BRANCH     OVRCD,CRSTH900
         MATCH      DBFHDEB,DBFDDEB
         GOTO       CRSTH900 IF NOT EQUAL
         MATCH      DBFHDTY,DBFDDTY
         GOTO       CRSTH900 IF NOT EQUAL
         MATCH      DBFHDOC,DBFDDOC
         GOTO       CRSTH900 IF NOT EQUAL
.
         PACK       KEY8,DBFDITM
         CALL       RDDBIT1        * Read Sales Item Details
.
         UNPACK     DBFDSDAT,CCENT,CYEAR,CMON,CDAY
         CALL       PACDATE
         MOVE       "99999.99",QTYDIM8
         FEDIT      DBFDQTY,QTYDIM8
         IF         DBFDQTY=0
           MOVE       SP70,QTYDIM8
           MOVE       SP70,DBITUNT
         ENDIF
.
         MOVE       "99999999.99",PRIDIM11
         MOVE       DBFDPRI,F12P2
         FEDIT      F12P2,PRIDIM11
         IF         DBFDPRI=0
           MOVE       SP70,PRIDIM11
         ENDIF
 
         MOVE       "99,999,999.99",TOTDIM13
         ASSIGN     DBFDTOT,F12P2
         FEDIT      F12P2,TOTDIM13
         IF         F12P2=0
           MOVE       SP70,TOTDIM13
         ENDIF
         ADD        F12P2,TOTCRD
.
         MOVE       DBITIDE,KEY28
         PRINT      CPCDATE,*12,KEY28:
                    *40,QTYDIM8,SP1,DBITUNT,SP1,PRIDIM11,SP2,TOTDIM13
         ADD        ONE,CLNO
         COMPARE    "28",CLNO
         CALL       CFSTH000 IF EQUAL
.
. Print Credit Detail lines
.----------------------------
          MATCH     SP70,DBFDDREF
          IF        !@EQUAL
            PRINT     *12,DBFDDREF
            ADD       ONE,CLNO
            COMPARE   "28",CLNO
            CALL      CFSTH000 IF EQUAL
          ENDIF 
.
          PACK      KEY27,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,SP70
          CALL      RSDBFN1
CRSTH150  CALL      RKDBFN1
          BRANCH    OVRCD,CRSTH200
          PACK      KEY24,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,SP70
          PACK      KEY27,DBFNDEB,DBFNDTY,DBFNDOC,DBFNDLN,SP70
          MATCH     KEY24,KEY27
          GOTO      CRSTH200 IF NOT EQUAL
.
          PRINT     *12,DBFNCOM
          ADD       ONE,CLNO
          COMPARE   "28",CLNO
          CALL      CFSTH000 IF EQUAL
.
          GOTO      CRSTH150
.
CRSTH200  CLEAR     KEY28
          APPEND    "GOODS & SERVICES TAX@",KEY28
          APPEND    DBFDTRT,KEY28
          RESET     KEY28
.
          MOVE      "99999999.99",PRIDIM11
          MOVE      DBFDTAX,F12P2
          FEDIT     F12P2,PRIDIM11
          IF        DBFDPRI=0
            MOVE      SP70,PRIDIM11
          ENDIF
.
          MOVE      "99,999,999.99",TOTDIM13
          ASSIGN    DBFDTAX,F12P2
          FEDIT     F12P2,TOTDIM13
          IF        F12P2=0
            MOVE      SP70,TOTDIM13
          ENDIF
          ADD       F12P2,TOTCRD
          PRINT     CPCDATE,*12,KEY28:
                    *40,"    1.00",SP1,SP4,SP1,PRIDIM11,SP2,TOTDIM13
          ADD       ONE,CLNO
          COMPARE   "28",CLNO
          CALL      CFSTH000 IF EQUAL
          GOTO      CRSTH100
.
CRSTH900  COMPARE   "27",CLNO
          GOTO      CRSTH990 IF EQUAL
          PRINT     " "
          ADD       ONE,CLNO
          GOTO      CRSTH900
.
CRSTH990  UNPACK    DBFHDDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     *N,*N,*53,"CREDIT TOTAL",*65,TOTCRD:
                    *N,*N,*65,TOTCRD:
                    *N,*N,*N,*N:
                    *N,*65,TOTCRD:
                    *N,*N,*2,CPCDATE,*13,NADLINE1:
                    *N,*N,*N,*12,DBFHDEB,*22,DBFHDOC:
                    *N,*N,*N,*N,*N
          RETURN
.-------------------------------------------------------------------------------
. Carried forward
.-------------------------------------------------------------------------------
CFSTH000  PRINT     *N,*N,*N:
                    *70,"CARRIED FWD":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N
          CALL       CHSTH000
          RETURN
.------------------------------------------------------------------------------
. Print Header for credit note (Credit Header)
.------------------------------------------------------------------------------
CHSTH000  ADD       ONE,CPAGENO
          PRINT     *N,*N,*N,*N,*N,*N,*N:
                    *N,*5,NADLINE1:
                    *N,*5,NADLINE2:
                    *N,*5,NADLINE3:
                    *N,*5,NADLINE4:
                    *N,*5,NADLINE5:
                    *N,*N:
                    *N,*2,DBFHDEB,*69,DBFHDOC:   * srf 646116
                    *N,*N,*N,*71,CPCDATE:
                    *N,*N,*N,*N
          MOVE      ZERO,CLNO
          RETURN
.
.------------------------------------------------------------------------------
. Credit Note Layout - Coast Health Care
.------------------------------------------------------------------------------
CLCHC000  CALL      OPNPRINT
          PRINT     *N,*N,*N,*N,*N:
                    *N,*2,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*2,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*2,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*2,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*2,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*2,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*N:
                    *2,"99999999",*71,"XXXXXXXXXX":
                    *N,*N,*N,*71,"99/99/9999":
                    *N,*N,*N,*N:
                    "99/99/9999":
                    *12,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *40,"99999999 XXXX XXXXXXXXXXXXX XXXXXXXXXXXX":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*50,"CREDIT TOTAL",*71,"999999999999.99":
                    *N,*N,*71,"99999999999999.99":
                    *N,*N,*N,*N:
                    *N,*71,"999999999999.99":
                    *N,*N,*2,"99/99/9999",*13,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*N,*N,*12,"99999999",*25,"XXXXXXXXXXX":
                    *N,*N,*N,*N,*N,*N,*N
          CALL      CLSPRINT
.  
          CALL      LINOK000 
          COMPARE   ZERO,FYESNO
          GOTO      CLCHC000 IF EQUAL
          RETURN
.
.------------------------------------------------------------------------------
. Credit Note Layout - Hawkes Bay
.------------------------------------------------------------------------------
CLHWK000  CALL      OPNPRINT
          PRINT     *N,*N,*N,*N,*N:
                    *N,*4,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*4,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*4,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*4,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*4,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*4,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*N:
                    *2,"99999999",*71,"XXXXXXXXXX":
                    *N,*N,*N,*71,"99/99/9999":
                    *N,*N,*N,*N:
                    "99/99/9999":
                    *12,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *40,"99999999 XXXX XXXXXXXXXXXXX XXXXXXXXXXXX":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*50,"CREDIT TOTAL",*71,"999999999999.99":
                    *N,*N,*71,"99999999999999.99":
                    *N,*N,*N,*N:
                    *N,*71,"999999999999.99":
                    *N,*N,*2,"99/99/9999",*13,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*N,*N,*12,"99999999",*25,"XXXXXXXXXXX":
                    *N,*N,*N,*N,*N,*N,*N
          CALL      CLSPRINT
.
          CALL      LINOK000
          COMPARE   ZERO,FYESNO
          GOTO      CLHWK000 IF EQUAL
          RETURN
.
.------------------------------------------------------------------------------
. Print credit notes (WGH)
.------------------------------------------------------------------------------
CRWGH000  MOVE      ZERO,TOTCRD
          MOVE      ZERO,TGSTEXCV
          MOVE      ZERO,TGSTAMNT
          MOVE      ZERO,CPAGENO
.
          CALL      STMPL000        * Set up for Templating
          CALL      FORAD000        * Format Name & Address into 5 Lines
          CALL      CHWGH000        * Print Heading
.
         PACK       KEY24,DBFHDEB,DBFHDTY,DBFHDOC,SP70
         CALL       RSDBFD1
CRWGH100 CALL       RKDBFD1
         BRANCH     OVRCD,CRWGH900
         MATCH      DBFHDEB,DBFDDEB
         GOTO       CRWGH900 IF NOT EQUAL
         MATCH      DBFHDTY,DBFDDTY
         GOTO       CRWGH900 IF NOT EQUAL
         MATCH      DBFHDOC,DBFDDOC
         GOTO       CRWGH900 IF NOT EQUAL
.
         PACK       KEY8,DBFDITM
         CALL       RDDBIT1        * Read Sales Item Details
.
         UNPACK     DBFDSDAT,CCENT,CYEAR,CMON,CDAY
         CALL       PACDATE
.
          MOVE      "9,999.99",DIM8QTY
          FEDIT     DBFDQTY,DIM8QTY
          IF        DBFDQTY=0
            MOVE      SP70,DIM8QTY
            MOVE      SP70,DBITUNT
          ENDIF
.
          MOVE      "999,999.99",DIM10PRI
          MOVE      DBFDPRI,F12P2
          FEDIT     F12P2,DIM10PRI
          IF        F12P2=0
            MOVE      SP70,DIM10PRI
          ENDIF
.
          MOVE      "999,999.99",DIM10TOT
          FEDIT     DBFDTOT,DIM10TOT
          IF        DBFDTOT=0
            MOVE      SP70,DIM10TOT
          ENDIF
          ADD       DBFDTOT,TGSTEXCV
.
          MOVE      "999,999,999.99",DIM14TAX
          FEDIT     DBFDTAX,DIM14TAX
          IF        DBFDTAX=0
            MOVE      SP70,DIM14TAX
          ENDIF
          ADD       DBFDTAX,TGSTAMNT
.
          ASSIGN    DBFDTAX+DBFDTOT,F12P2
          MOVE      "999,999,999.99",DIM14GRN
          FEDIT     F12P2,DIM14GRN
          IF        F12P2=0
            MOVE      SP70,DIM14GRN
          ENDIF
          ADD       F12P2,TOTCRD
.
          PRINT     CPCDATE,*12,DIM8QTY:
                    *26,DIM10PRI,*37,DIM10TOT:
                    *48,DIM14TAX,*67,DIM14GRN
          ADD       ONE,CLNO
          COMPARE   MAXCLNO,CLNO
          CALL      CFWGH000 IF EQUAL
.
          MOVE      DBITIDE,KEY20
.
          PRINT     *12,DBFDITM,*21,KEY20
.
         ADD        ONE,CLNO
         COMPARE    MAXCLNO,CLNO
         CALL       CFWGH000 IF EQUAL
.
. Print Credit Detail lines
.----------------------------
          MATCH     SP70,DBFDDREF
          IF        !@EQUAL
            PRINT     *12,DBFDDREF
            ADD       ONE,CLNO
            COMPARE   MAXCLNO,CLNO
            CALL      CFWGH000 IF EQUAL
          ENDIF 
.
          PACK      KEY27,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,SP70
          CALL      RSDBFN1
CRWGH150  CALL      RKDBFN1
          BRANCH    OVRCD,CRWGH100
          PACK      KEY24,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,SP70
          PACK      KEY27,DBFNDEB,DBFNDTY,DBFNDOC,DBFNDLN,SP70
          MATCH     KEY24,KEY27
          GOTO      CRWGH100 IF NOT EQUAL
.
          PRINT     *12,DBFNCOM
          ADD       ONE,CLNO
          COMPARE   MAXCLNO,CLNO
          CALL      CFWGH000 IF EQUAL
          GOTO      CRWGH150
.
CRWGH900  ASSIGN    MAXCLNO-TWO,F2
          COMPARE   F2,CLNO
          GOTO      CRWGH990 IF EQUAL
          GOTO      CRWGH980 IF NOT LESS
          PRINT     " "
          ADD       ONE,CLNO
          GOTO      CRWGH900
.
CRWGH980  CALL      CFWGH000
          GOTO      CRWGH900
.
CRWGH990  MOVE      "999,999,999.99",DIM14
          FEDIT     TGSTEXCV,DIM14
          MOVE      "999,999,999.99",DIM14TAX
          FEDIT     TGSTAMNT,DIM14TAX
          MOVE      "999,999,999.99",DIM14GRN
          FEDIT     TOTCRD,DIM14GRN
.
          PRINT     *N,*1,"CREDIT TOTAL",*34,DIM14:
                    *48,DIM14TAX,*67,DIM14GRN
          ADD       TWO,CLNO
.
          IF        TMPLTFLG=0
            MOVE      "999,999,999.99",FTOTINV
            FEDIT     TOTCRD,FTOTINV
.
            MOVE      "999,999,999.99",FTGSTEXC
            FEDIT     TGSTEXCV,FTGSTEXC
.
            MOVE      "999,999,999.99",FTGSTAMN
            FEDIT     TGSTAMNT,FTGSTAMN
.
            MOVE      ONE,HEADTAIL    * Flagged to Tail
            CALL      XCRD0000      * Print Tax Credit Note Tail
            PRINT     " "
            GOTO      CRWGH999
          ENDIF
.
          UNPACK    DBFHDDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      DBFHDOC,F12
          PRINT     *N,*64,TOTCRD:
                    *N,*N,*N,*N,*N,*N,*N,*N:
                    *1,CPCDATE,*15,NADLINE1:
                    *N,*N,*N,*N,*15,DBFHUR1,*64,TOTCRD:
                    *N,*N,*N,*N,*3,DBFHDEB,*33,F12
.
CRWGH999  RETURN
.-------------------------------------------------------------------------------
. Carried forward
.-------------------------------------------------------------------------------
CFWGH000  IF        TMPLTFLG=0
            MOVE      CRFWDROW,F3
            MOVE      ONE,CURRROW
            CALL      XPOS0000
            BRANCH    EXIT,CFWGH100
.
            PRINT     *CRFWDCOL,*+,"CARRIED FWD";
.
            MOVE      TAILLENG,F3
            CALL      XPOS0000
            PRINT     *N;
            GOTO      CFWGH900
          ENDIF
.
CFWGH100  PRINT     *N,*71,"CARRIED FWD" 
CFWGH900  CALL      CHWGH000
.
CFWGH999  RETURN
.------------------------------------------------------------------------------
. Print Header for credit note (Credit Header)
.------------------------------------------------------------------------------
CHWGH000  ADD       ONE,CPAGENO
          MOVE      ZERO,CLNO
.
. Determine whether to use Tax Credit Note Templating
.
          IF        TMPLTFLG=0
            MOVE      ZERO,HEADTAIL   * Flagged to Header
            CALL      XCRD0000      * Print Tax Credit Note Header
            GOTO      CHWGH999
          ENDIF
.
          MOVE      DBFHDOC,F12
          UNPACK    DBFHDDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     *F,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*13,NADLINE1:
                    *N,*13,NADLINE2,*54,DBFHUR1:
                    *N,*13,NADLINE3:
                    *N,*13,NADLINE4:
                    *N,*13,NADLINE5:
                    *N,*N
          PRINT     *2,DBFHDEB,*20,"CREDIT NOTE":
                    *54,CPCDATE:
                    *70,F12:
                    *N,*N,*N,*N,*N,*N
.
CHWGH999  RETURN
.------------------------------------------------------------------------------
. Print credit notes (Coast Health Care)
.------------------------------------------------------------------------------
CRCHC000  MOVE      ZERO,TOTCRD
          MOVE      ZERO,CPAGENO
.
          CALL      FORAD000        * Format Name & Address into 5 Lines
          CALL      CHCHC000        * Print Heading
.
         PACK       KEY24,DBFHDEB,DBFHDTY,DBFHDOC,SP70
         CALL       RSDBFD1
CRCHC100 CALL       RKDBFD1
         BRANCH     OVRCD,CRCHC900
         MATCH      DBFHDEB,DBFDDEB
         GOTO       CRCHC900 IF NOT EQUAL
         MATCH      DBFHDTY,DBFDDTY
         GOTO       CRCHC900 IF NOT EQUAL
         MATCH      DBFHDOC,DBFDDOC
         GOTO       CRCHC900 IF NOT EQUAL
.
         PACK       KEY8,DBFDITM
         CALL       RDDBIT1        * Read Sales Item Details
.
         UNPACK     DBFDSDAT,CCENT,CYEAR,CMON,CDAY
         CALL       PACDATE
         MOVE       "99999.99",QTYDIM8
         FEDIT      DBFDQTY,QTYDIM8
         IF         DBFDQTY=0
           MOVE       SP70,QTYDIM8
           MOVE       SP70,DBITUNT
         ENDIF
.
         MOVE       "99999999.9999",PRIDIM13
         FEDIT      DBFDPRI,PRIDIM13
         IF         DBFDPRI=0
           MOVE       SP70,PRIDIM13
         ENDIF
 
         MOVE       "99,999,999.99",TOTDIM13
         ASSIGN     DBFDTAX+DBFDTOT,F12P2
         FEDIT      F12P2,TOTDIM13
         IF         F12P2=0
           MOVE       SP70,TOTDIM13
         ENDIF
         ADD        F12P2,TOTCRD
.
         MOVE       DBITIDE,KEY28
         PRINT      CPCDATE,*12,KEY28:
                    *40,QTYDIM8,SP1,DBITUNT,SP1,PRIDIM13,TOTDIM13
         ADD        ONE,CLNO
         COMPARE    "28",CLNO
         CALL       CFCHC000 IF EQUAL
.
. Print Credit Detail lines
.----------------------------
          MATCH     SP70,DBFDDREF
          IF        !@EQUAL
            PRINT     *12,DBFDDREF
            ADD       ONE,CLNO
            COMPARE   "28",CLNO
            CALL      CFCHC000 IF EQUAL
          ENDIF 
.
          PACK      KEY27,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,SP70
          CALL      RSDBFN1
CRCHC150  CALL      RKDBFN1
          BRANCH    OVRCD,CRCHC100
          PACK      KEY24,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,SP70
          PACK      KEY27,DBFNDEB,DBFNDTY,DBFNDOC,DBFNDLN,SP70
          MATCH     KEY24,KEY27
          GOTO      CRCHC100 IF NOT EQUAL
          PRINT     *12,DBFNCOM
          ADD       ONE,CLNO
          COMPARE   "28",CLNO
          CALL      CFCHC000 IF EQUAL
          GOTO      CRCHC150
.
CRCHC900  COMPARE   "27",CLNO
          GOTO      CRCHC990 IF EQUAL
          PRINT     " "
          ADD       ONE,CLNO
          GOTO      CRCHC900
.
CRCHC990  UNPACK    DBFHDDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      DBFHDOC,F12
          PRINT     *N,*N,*50,"CREDIT TOTAL",*65,TOTCRD:
                    *N,*N,*65,TOTCRD:
                    *N,*N,*N,*N:
                    *N,*65,TOTCRD:
                    *N,*N,*2,CPCDATE,*13,NADLINE1:
                    *N,*N,*N,*12,DBFHDEB,*21,F12:
                    *N,*N,*N,*N,*N,*N,*N
          RETURN
.-------------------------------------------------------------------------------
. Carried forward
.-------------------------------------------------------------------------------
CFCHC000  PRINT     *N,*N,*N,*N,*N,*N,*N,*N:
                    *70,"CARRIED FWD":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N
          CALL       CHCHC000
          RETURN
.------------------------------------------------------------------------------
. Print Header for credit note (Credit Header)
.------------------------------------------------------------------------------
CHCHC000  ADD       ONE,CPAGENO
          MOVE      DBFHDOC,F12
          UNPACK    DBFHDDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     *N,*N,*N,*N,*N:
                    *N,*2,NADLINE1:
                    *N,*2,NADLINE2:
                    *N,*2,NADLINE3:
                    *N,*2,NADLINE4:
                    *N,*2,NADLINE5:
                    *N,*N:
                    *N,*2,DBFHDEB,*67,F12:
                    *N,*N,*N,*71,CPCDATE:
                    *N,*N,*N,*N
          MOVE      ZERO,CLNO
          RETURN
.
.------------------------------------------------------------------------------
. Print credit notes (Hawkes Bay)
.------------------------------------------------------------------------------
CRHWK000  MOVE      ZERO,TOTCRD
          MOVE      ZERO,CPAGENO
.
          CALL      FORAD000        * Format Name & Address into 5 Lines
          CALL      CHHWK000        * Print Heading
.
         PACK       KEY24,DBFHDEB,DBFHDTY,DBFHDOC,SP70
         CALL       RSDBFD1
CRHWK100 CALL       RKDBFD1
         BRANCH     OVRCD,CRHWK900
         MATCH      DBFHDEB,DBFDDEB
         GOTO       CRHWK900 IF NOT EQUAL
         MATCH      DBFHDTY,DBFDDTY
         GOTO       CRHWK900 IF NOT EQUAL
         MATCH      DBFHDOC,DBFDDOC
         GOTO       CRHWK900 IF NOT EQUAL
.
         PACK       KEY8,DBFDITM
         CALL       RDDBIT1        * Read Sales Item Details
.
         UNPACK     DBFDSDAT,CCENT,CYEAR,CMON,CDAY
         CALL       PACDATE
         MOVE       "99999.99",QTYDIM8
         FEDIT      DBFDQTY,QTYDIM8
         IF         DBFDQTY=0
           MOVE       SP70,QTYDIM8
           MOVE       SP70,DBITUNT
         ENDIF
.
         MOVE       "99999999.99",PRIDIM11
         MOVE       DBFDPRI,F12P2
         FEDIT      F12P2,PRIDIM11
         IF         DBFDPRI=0
           MOVE       SP70,PRIDIM11
         ENDIF
 
         MOVE       "99,999,999.99",TOTDIM13
         ASSIGN     DBFDTOT,F12P2
         FEDIT      F12P2,TOTDIM13
         IF         F12P2=0
           MOVE       SP70,TOTDIM13
         ENDIF
         ADD        F12P2,TOTCRD
.
         MOVE       DBITIDE,KEY28
         PRINT      CPCDATE,*12,KEY28:
                    *40,QTYDIM8,SP1,DBITUNT,SP1,PRIDIM11,SP2,TOTDIM13
         ADD        ONE,CLNO
         COMPARE    "28",CLNO
         CALL       CFHWK000 IF EQUAL
.
. Print Credit Detail lines
.----------------------------
          MATCH     SP70,DBFDDREF
          IF        !@EQUAL
            PRINT     *12,DBFDDREF
            ADD       ONE,CLNO
            COMPARE   "28",CLNO
            CALL      CFHWK000 IF EQUAL
          ENDIF 
.
          PACK      KEY27,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,SP70
          CALL      RSDBFN1
CRHWK150  CALL      RKDBFN1
          BRANCH    OVRCD,CRHWK200
          PACK      KEY24,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,SP70
          PACK      KEY27,DBFNDEB,DBFNDTY,DBFNDOC,DBFNDLN,SP70
          MATCH     KEY24,KEY27
          GOTO      CRHWK200 IF NOT EQUAL
.
          PRINT     *12,DBFNCOM
          ADD       ONE,CLNO
          COMPARE   "28",CLNO
          CALL      CFHWK000 IF EQUAL
.
          GOTO      CRHWK150
.
CRHWK200  CLEAR     KEY28
          APPEND    "GOODS & SERVICES TAX@",KEY28
          APPEND    DBFDTRT,KEY28
          RESET     KEY28
.
          MOVE      "99999999.99",PRIDIM11
          MOVE      DBFDTAX,F12P2
          FEDIT     F12P2,PRIDIM11
          IF        DBFDPRI=0
            MOVE      SP70,PRIDIM11
          ENDIF
.
          MOVE      "99,999,999.99",TOTDIM13
          ASSIGN    DBFDTAX,F12P2
          FEDIT     F12P2,TOTDIM13
          IF        F12P2=0
            MOVE      SP70,TOTDIM13
          ENDIF
          ADD       F12P2,TOTCRD
          PRINT     CPCDATE,*12,KEY28:
                    *40,"    1.00",SP1,SP4,SP1,PRIDIM11,SP2,TOTDIM13
          ADD       ONE,CLNO
          COMPARE   "28",CLNO
          CALL      CFHWK000 IF EQUAL
          GOTO      CRHWK100
.
CRHWK900  COMPARE   "27",CLNO
          GOTO      CRHWK990 IF EQUAL
          PRINT     " "
          ADD       ONE,CLNO
          GOTO      CRHWK900
.
CRHWK990  UNPACK    DBFHDDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      DBFHDOC,F12
          PRINT     *N,*N,*50,"CREDIT TOTAL",*65,TOTCRD:
                    *N,*N,*65,TOTCRD:
                    *N,*N,*N,*N:
                    *N,*65,TOTCRD:
                    *N,*N,*2,CPCDATE,*13,NADLINE1:
                    *N,*N,*N,*12,DBFHDEB,*22,F12:
                    *N,*N,*N,*N,*N,*N,*N
          RETURN
.-------------------------------------------------------------------------------
. Carried forward
.-------------------------------------------------------------------------------
CFHWK000  PRINT     *N,*N,*N,*N,*N,*N,*N,*N:
                    *70,"CARRIED FWD":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N
          CALL       CHHWK000
          RETURN
.------------------------------------------------------------------------------
. Print Header for credit note (Credit Header)
.------------------------------------------------------------------------------
CHHWK000  ADD       ONE,CPAGENO
          MOVE      DBFHDOC,F12
          UNPACK    DBFHDDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     *N,*N,*N,*51,CFDBETEL,*N,*N:
                    *N,*4,NADLINE1:
                    *N,*4,NADLINE2:
                    *N,*4,NADLINE3:
                    *N,*4,NADLINE4:
                    *N,*4,NADLINE5:
                    *N,*N:
                    *N,*2,DBFHDEB,*70,F12:
                    *N,*N,*N,*71,CPCDATE:
                    *N,*N,*N,*N
          MOVE      ZERO,CLNO
          RETURN
.
.------------------------------------------------------------------------------
. Credit Note Layout - Holy Spirit
.------------------------------------------------------------------------------
CLHSH000  CALL      OPNPRINT
.
          CALL      STMPL000        * Set up for Templating
          IF        TMPLTFLG=0
            CALL      XSET0000      * Set Variables value for lineup
            MOVE      ZERO,HEADTAIL   * Flagged to Header
            CALL      XCRD0000      * Print Tax Credit Note Header
            PRINT     *N;
.
            PRINT     CPCDATE,*21,F4,*25,DIM10A,*37,DIM14A:
                      *52,DIM14B,*68,TOTDIM13
            PRINT     *22,KEY27
            MOVE      FOUR,CURRROW
            MOVE      MAXCLNO,F3
            CALL      XPOS0000
.
            PRINT     *N,*1,"CREDIT TOTAL",*35,DIM14:
                      *49,DIM14TAX,*65,DIM14GRN
.
            IF        TMPLTFLG=0
              MOVE      ONE,HEADTAIL  * Flagged to Tail
              CALL      XCRD0000    * Print Tax Credit Note Tail
              PRINT     " "
            ENDIF
            GOTO      CLHSH900
          ENDIF
.
         PRINT      *N,*N,*N,*N,*N,*N,*N,*54,"Debtor No. : ","XXXXXXXX",*N,*N:
                    *N,*12,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*12,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*12,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*12,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*12,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*38,"XXXX":
                    *N,*N,*N,*N,*N,*N,*N:
                    *1,"PAGE ","XXX",*12,"XXXXXXXXXX",*65,"99/99/9999":
                    *N,*N,*N,*N:
.
                    "99/99/9999",*22,"XXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *54,"999",*67,"99,999,999.99":
.
                    *N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*67,"9999999999.99"
CLHSH900  CALL      CLSPRINT
.
          CALL      LINOK000
          COMPARE   ZERO,FYESNO
          GOTO      CLHSH000 IF EQUAL
.
CLHSH999  RETURN
.
.------------------------------------------------------------------------------
. Print credit notes (Holy Spirit)
.------------------------------------------------------------------------------
CRHSH000  MOVE      ZERO,TOTCRD
          MOVE      ZERO,TGSTEXCV
          MOVE      ZERO,TGSTAMNT
          MOVE      ZERO,CPAGENO
.
          CALL      STMPL000        * Set up for Templating
          CALL      FORAD000        * Format Name & Address into 5 Lines
          CALL      CHHSH000        * Print Heading
.
         PACK       KEY24,DBFHDEB,DBFHDTY,DBFHDOC,SP70
         CALL       RSDBFD1
CRHSH100 CALL       RKDBFD1
         BRANCH     OVRCD,CRHSH900
         MATCH      DBFHDEB,DBFDDEB
         GOTO       CRHSH900 IF NOT EQUAL
         MATCH      DBFHDTY,DBFDDTY
         GOTO       CRHSH900 IF NOT EQUAL
         MATCH      DBFHDOC,DBFDDOC
         GOTO       CRHSH900 IF NOT EQUAL
.
         PACK       KEY8,DBFDITM
         CALL       RDDBIT1        * Read Sales Item Details
.
         UNPACK     DBFDSDAT,CCENT,CYEAR,CMON,CDAY
         CALL       PACDATE
.
          MOVE      "9,999.99",DIM8QTY
          FEDIT     DBFDQTY,DIM8QTY
          IF        DBFDQTY=0
            MOVE      SP70,DIM8QTY
            MOVE      SP70,DBITUNT
          ENDIF
.
          MOVE      "999,999.99",DIM10PRI
          MOVE      DBFDPRI,F12P2
          FEDIT     F12P2,DIM10PRI
          IF        F12P2=0
            MOVE      SP70,DIM10PRI
          ENDIF
.
          MOVE      "999,999.99",DIM10TOT
          ASSIGN    DBFDTOT*SEQ,F12P2
          FEDIT     F12P2,DIM10TOT
          IF        F12P2=0
            MOVE      SP70,DIM10TOT
          ENDIF
          ADD       F12P2,TGSTEXCV
.
          MOVE      "99,999,999.99",DIM13TAX
          ASSIGN    DBFDTAX*SEQ,F12P2
          FEDIT     F12P2,DIM13TAX
          IF        F12P2=0
            MOVE      SP70,DIM13TAX
          ENDIF
          ADD       F12P2,TGSTAMNT
.
          ASSIGN    (DBFDTAX+DBFDTOT)*SEQ,F12P2
          MOVE      "999,999,999.99",DIM14GRN
          FEDIT     F12P2,DIM14GRN
          IF        F12P2=0
            MOVE      SP70,DIM14GRN
          ENDIF
          ADD       F12P2,TOTCRD
.
         PRINT      CPCDATE,*12,DIM8QTY,*26,DIM10PRI,*39,DIM10TOT:
                    *50,DIM13TAX,*65,DIM14GRN
         ADD        ONE,CLNO
         COMPARE    MAXCLNO,CLNO
         CALL       CFHSH000 IF EQUAL
.
         MOVE       DBITIDE,KEY27
.
         PRINT      *22,KEY27
.
         ADD        ONE,CLNO
         COMPARE    MAXCLNO,CLNO
         CALL       CFHSH000 IF EQUAL
.
. Print Credit Detail lines
.----------------------------
          MATCH     SP70,DBFDDREF
          IF        !@EQUAL
            PRINT     *22,DBFDDREF
            ADD       ONE,CLNO
            COMPARE   MAXCLNO,CLNO
            CALL      CFHSH000 IF EQUAL
          ENDIF 
.
          PACK      KEY27,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,SP70
          CALL      RSDBFN1
CRHSH150  CALL      RKDBFN1
          BRANCH    OVRCD,CRHSH100
          PACK      KEY24,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,SP70
          PACK      KEY27,DBFNDEB,DBFNDTY,DBFNDOC,DBFNDLN,SP70
          MATCH     KEY24,KEY27
          GOTO      CRHSH100 IF NOT EQUAL
.
          PRINT     *22,DBFNCOM
          ADD       ONE,CLNO
          COMPARE   MAXCLNO,CLNO
          CALL      CFHSH000 IF EQUAL
.
          GOTO      CRHSH150
.
CRHSH900  ASSIGN    MAXCLNO-TWO,F2
          COMPARE   F2,CLNO
          GOTO      CRHSH990 IF EQUAL
          GOTO      CRHSH980 IF NOT LESS
          PRINT     " "
          ADD       ONE,CLNO
          GOTO      CRHSH900
.
CRHSH980  CALL      CFHSH000
          GOTO      CRHSH900
.
CRHSH990  MOVE      "999,999,999.99",DIM14
          FEDIT     TGSTEXCV,DIM14
          MOVE      "999,999,999.99",DIM14TAX
          FEDIT     TGSTAMNT,DIM14TAX
          MOVE      "999,999,999.99",DIM14GRN
          FEDIT     TOTCRD,DIM14GRN
.
          PRINT     *N,*1,"CREDIT TOTAL",*35,DIM14:
                    *49,DIM14TAX,*65,DIM14GRN
          ADD       TWO,CLNO
.
          IF        TMPLTFLG=0
            MOVE      "999,999,999.99",FTOTINV
            FEDIT     TOTCRD,FTOTINV
.
            MOVE      "999,999,999.99",FTGSTEXC
            FEDIT     TGSTEXCV,FTGSTEXC
.
            MOVE      "999,999,999.99",FTGSTAMN
            FEDIT     TGSTAMNT,FTGSTAMN
.
            MOVE      ONE,HEADTAIL    * Flagged to Tail
            CALL      XCRD0000      * Print Tax Credit Note Tail
            PRINT     " "
            GOTO      CRHSH999
          ENDIF
.
          UNPACK    DBFHDDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      DBFHDOC,F12
          MOVE       "99,999,999.99",TOTDIM13
          MOVE       TOTCRD,F12P2
          FEDIT      F12P2,TOTDIM13
          IF         F12P2=0
            MOVE       SP70,TOTDIM13
          ENDIF
          PRINT     *N,*N:
                    *N,*N,*67,TOTDIM13
.
CRHSH999  RETURN
.-------------------------------------------------------------------------------
. Carried forward
.-------------------------------------------------------------------------------
CFHSH000  IF        TMPLTFLG=0
            MOVE      CRFWDROW,F3
            MOVE      ONE,CURRROW
            CALL      XPOS0000
            BRANCH    EXIT,CFHSH100
.
            PRINT     *CRFWDCOL,*+,"CARRIED FWD";
.
            MOVE      TAILLENG,F3
            CALL      XPOS0000
            PRINT     *N;
            GOTO      CFHSH900
          ENDIF
.
CFHSH100  PRINT     *N,*N:
                    *N,*69,"CARRIED FWD"
CFHSH900  CALL      CHHSH000
.
CFHSH999  RETURN
.------------------------------------------------------------------------------
. Print Header for credit note (Credit Header)
.------------------------------------------------------------------------------
CHHSH000  ADD       ONE,CPAGENO
          MOVE      ZERO,CLNO
.
. Determine whether to use Tax Credit Note Templating
.
          IF        TMPLTFLG=0
            MOVE      ZERO,HEADTAIL   * Flagged to Header
            CALL      XCRD0000      * Print Tax Credit Note Header
            GOTO      CHHSH999
          ENDIF
.
          MOVE      DBFHDOC,F12
          UNPACK    DBFHDDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     *F,*N,*N,*N,*N,*N,*N,*N,*54,"Debtor No. : ",DBFHDEB,*N,*N:
                    *N,*12,DBDBNA1:
                    *N,*12,DBDBNA2:
                    *N,*12,DBDBAD1:
                    *N,*12,DBDBAD2:
                    *N,*12,DBDBAD3:
                    *N,*38,DBDBPC:
                    *N,*N,*N,*N,*N,*N:
                    *1,"PAGE ",CPAGENO,*11,F12:
                    *65,CPCDATE:
                    *N,*N,*N
.
CHHSH999  RETURN
.------------------------------------------------------------------------------
. Lineup print for Credit notes West Wimmera
.------------------------------------------------------------------------------
CLWWH000 CALL       OPNPRINT
.
          CALL      STMPL000        * Set up for Templating
          IF        TMPLTFLG=0
            CALL      XSET0000      * Set Variables value for lineup
            MOVE      ZERO,HEADTAIL   * Flagged to Header
            CALL      XCRD0000      * Print Tax Credit Note Header
            PRINT     *N;
.
            PRINT     CPCDATE,*12,DIM8QTY:
                      *21,DBITUNT,*26,DIM10PRI,*46,DIM12TOT:
                      *58,DIM10TAX,*68,TOTDIM12
            PRINT     *12,KEY28
            IF        TMPLTFLG=0
              MOVE      FOUR,CURRROW
            ELSE
              MOVE      TWO,CURRROW
            ENDIF
            MOVE      MAXCLNO,F3
            CALL      XPOS0000
.
            IF        TMPLTFLG=0
              PRINT     *N,*1,"CREDIT TOTAL",*46,DIM12:
                        *58,DIM10TAX,*68,TOTDIM12
.
              MOVE      ONE,HEADTAIL  * Flagged to Tail
              CALL      XCRD0000    * Print Tax Credit Note Tail
              PRINT     " "
            ENDIF
            GOTO      CLWWH900
          ENDIF
.
         PRINT      *N,*N,*N,*N,*N,*N,*51,"9999999999",*71,"99/99/9999":
                    *N,*N,*N,*N:
                    *N,*12,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*12,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*12,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*12,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*12,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*N,*N,*N,*N,*2,"99999999":
                    *N,*N,*N,*N:
.
                    "99/99/9999",*12,"XXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *42,"99999.99",SP4,"XXXX",SP2,"9999.99"," 9,999,999.99":
.
                    *N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N:
                    *N,*68,"000000000.00":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*53,"99999999",*70,"9999999999":
                    *N,*13,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*N,*N,*N,*68,"000000000.00"
CLWWH900 CALL      CLSPRINT
.
         CALL      LINOK000
         COMPARE   ZERO,FYESNO
         GOTO      CLWWH000 IF EQUAL
.
CLWWH999 RETURN
.------------------------------------------------------------------------------
. Print Credit notes West Wimmera
.------------------------------------------------------------------------------
CRWWH000  MOVE      ZERO,TOTCRD
          MOVE      ZERO,TGSTEXCV
          MOVE      ZERO,TGSTAMNT
          MOVE      ZERO,CPAGENO
.
          CALL      STMPL000        * Set up for Templating
          CALL      FORAD000        * Format Name & Address into 5 Lines
          CALL      CHWWH000        * Print Heading
.
         PACK       KEY24,DBFHDEB,DBFHDTY,DBFHDOC,SP70
         CALL       RSDBFD1
CRWWH100 CALL       RKDBFD1
         BRANCH     OVRCD,CRWWH900
         MATCH      DBFHDEB,DBFDDEB
         GOTO       CRWWH900 IF NOT EQUAL
         MATCH      DBFHDTY,DBFDDTY
         GOTO       CRWWH900 IF NOT EQUAL
         MATCH      DBFHDOC,DBFDDOC
         GOTO       CRWWH900 IF NOT EQUAL
.
         PACK       KEY8,DBFDITM
         CALL       RDDBIT1        * Read Sales Item Details
.
         UNPACK     DBFDSDAT,CCENT,CYEAR,CMON,CDAY
         CALL       PACDATE
.
         MOVE       "9,999.99",DIM8QTY
         MOVE       "99999.99",QTYDIM8
         FEDIT      DBFDQTY,QTYDIM8
         FEDIT      DBFDQTY,DIM8QTY
         IF         DBFDQTY=0
           MOVE       SP70,QTYDIM8
           MOVE       SP70,DIM8QTY
           MOVE       SP70,DBITUNT
         ENDIF
.
         MOVE       "999,999.99",DIM10PRI
         MOVE       DBFDPRI,F12P2
         FEDIT      F12P2,DIM10PRI
         IF         F12P2=0
           MOVE       SP70,DIM10PRI
         ENDIF
.
         MOVE       "9,999,999.99",DIM12TOT
         FEDIT      DBFDTOT,DIM12TOT
         IF         DBFDTOT=0
           MOVE       SP70,DIM12TOT
         ENDIF
         ADD        DBFDTOT,TGSTEXCV
.
         MOVE       "999,999.99",DIM10TAX
         FEDIT      DBFDTAX,DIM10TAX
         IF         DBFDTAX=0
           MOVE       SP70,DIM10TAX
         ENDIF
         ADD        DBFDTAX,TGSTAMNT
.
         ASSIGN     DBFDTAX+DBFDTOT,F12P2
         MOVE       "9,999,999.99",TOTDIM12
         MOVE       "99,999,999.99",TOTDIM13
         FEDIT      F12P2,TOTDIM13
         FEDIT      F12P2,TOTDIM12
         IF         F12P2=0
           MOVE       SP70,TOTDIM12
           MOVE       SP70,TOTDIM13
         ENDIF
         ADD        F12P2,TOTCRD
         MOVE       DBITIDE,KEY28
.
         IF         TMPLTFLG=0
           PRINT      CPCDATE,*12,DIM8QTY:
                      *21,DBITUNT,*26,DIM10PRI,*46,DIM12TOT:
                      *58,DIM10TAX,*68,TOTDIM12
         ELSE
           MOVE       DBFDPRI,F4P2
           PRINT      CPCDATE,*12,KEY28:
                      *42,QTYDIM8,SP4,DBITUNT,SP2,F4P2,TOTDIM13
         ENDIF
         ADD        ONE,CLNO
         COMPARE    MAXCLNO,CLNO
         CALL       CFWWH000 IF EQUAL
.          
         IF         TMPLTFLG=0
           PRINT      *12,KEY28
           ADD        ONE,CLNO
           COMPARE    MAXCLNO,CLNO
           CALL       CFWWH000 IF EQUAL
         ENDIF
.
. Print Credit Detail lines
.----------------------------
          MATCH     SP70,DBFDDREF
          IF        !@EQUAL
            PRINT     *12,DBFDDREF
            ADD       ONE,CLNO
            COMPARE    MAXCLNO,CLNO
            CALL       CFWWH000 IF EQUAL
          ENDIF 
.
          PACK      KEY27,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,SP70
          CALL      RSDBFN1
CRWWH150  CALL      RKDBFN1
          BRANCH    OVRCD,CRWWH100
          PACK      KEY24,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,SP70
          PACK      KEY27,DBFNDEB,DBFNDTY,DBFNDOC,DBFNDLN,SP70
          MATCH     KEY24,KEY27
          GOTO      CRWWH100 IF NOT EQUAL
.
          PRINT     *12,DBFNCOM
          ADD       ONE,CLNO
          COMPARE   MAXCLNO,CLNO
          CALL      CFWWH000 IF EQUAL
          GOTO      CRWWH150
.
CRWWH900  IF         TMPLTFLG=1
            COMPARE   MAXCLNO,CLNO
            GOTO      CRWWH990 IF EQUAL 
          ELSE
            ASSIGN    MAXCLNO-TWO,F2
            COMPARE   F2,CLNO
            GOTO      CRWWH990 IF EQUAL 
            GOTO      CRWWH980 IF NOT LESS
          ENDIF
.
          PRINT     " "
          ADD       ONE,CLNO
          GOTO      CRWWH900
.
CRWWH980  ASSIGN    MAXCLNO-ONE,F2
          IF        CLNO=F2
            PRINT     " "
          ENDIF
          CALL      CFWWH000
          GOTO      CRWWH900
.
CRWWH990  MOVE      "9,999,999.99",DIM12
          FEDIT     TGSTEXCV,DIM12
.
          MATCH     "************",DIM12
          IF        @EQUAL
            MOVE      TGSTEXCV,F9P2
            MOVE      F9P2,DIM12
          ENDIF
.
          MOVE      "999,999.99",DIM10TAX
          FEDIT     TGSTAMNT,DIM10TAX
.
          MATCH     "**********",DIM10TAX
          IF        @EQUAL
            MOVE      TGSTAMNT,F7P2
            MOVE      F7P2,DIM10TAX
          ENDIF
.
          MOVE      "9,999,999.99",TOTDIM12
          FEDIT     TOTCRD,TOTDIM12
.
          MATCH     "************",TOTDIM12
          IF        @EQUAL
            MOVE      TOTCRD,F9P2
            MOVE      F9P2,TOTDIM12
          ENDIF
.
          IF        TMPLTFLG=0
            PRINT     *N,*1,"CREDIT TOTAL",*46,DIM12:
                      *58,DIM10TAX,*68,TOTDIM12
            ADD       TWO,CLNO
.
            MOVE      "999,999,999.99",FTOTINV
            FEDIT     TOTCRD,FTOTINV
.
            MOVE      "999,999,999.99",FTGSTEXC
            FEDIT     TGSTEXCV,FTGSTEXC
.
            MOVE      "999,999,999.99",FTGSTAMN
            FEDIT     TGSTAMNT,FTGSTAMN
.
            MOVE      ONE,HEADTAIL    * Flagged to Tail
            CALL      XCRD0000      * Print Tax Credit Note Tail
            PRINT     " "
            GOTO      CRWWH999
          ENDIF
.
          UNPACK    DBFHDDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      DBFHDOC,F12
          PRINT     *N,*N,*N,*48,"CREDIT TOTAL",*65,TOTCRD:
                    *N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*53,DBFHDEB,*68,F12:
                    *N,*12,NADLINE1,*N,*N,*N:
                    *N,*N,*65,TOTCRD
.
CRWWH999  RETURN
.-------------------------------------------------------------------------------
. Carried forward
.-------------------------------------------------------------------------------
CFWWH000  IF        TMPLTFLG=0
            MOVE      CRFWDROW,F3
            MOVE      ONE,CURRROW
            CALL      XPOS0000
            BRANCH    EXIT,CFWWH100
.
            PRINT     *CRFWDCOL,*+,"CARRIED FWD";
.
            MOVE      TAILLENG,F3
            CALL      XPOS0000
            PRINT     *N;
            GOTO      CFWWH900
          ENDIF
.
CFWWH100  PRINT     *N,*N,*69,"CARRIED FWD":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N
CFWWH900  CALL      CHWWH000
.
CFWWH999  RETURN
.------------------------------------------------------------------------------
. Print Header for credit note (Credit Header)
.------------------------------------------------------------------------------
CHWWH000  ADD       ONE,CPAGENO
          MOVE      ZERO,CLNO
.
. Determine whether to use Tax Credit Note Templating
.
          IF        TMPLTFLG=0
            MOVE      ZERO,HEADTAIL   * Flagged to Header
            CALL      XCRD0000      * Print Tax Credit Note Header
            GOTO      CHWWH999
          ENDIF
.
          MOVE      DBFHDOC,F12
          UNPACK    DBFHDDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
.
          PRINT     *N,*N,*60,"CREDIT NOTE",*N,*N,*N:
                    *N,*51,F12,*70,CPCDATE:
                    *N,*N,*N,*N:
                    *N,*12,NADLINE1:
                    *N,*12,NADLINE2:
                    *N,*12,NADLINE3:
                    *N,*12,NADLINE4:
                    *N,*12,NADLINE5:
                    *N:
                    *N,*N,*N,*N,*2,DBFHDEB:
                    *N,*N,*N
.
CHWWH999  RETURN
.------------------------------------------------------------------------------
. Credit Note Layout - Hutt Valley Health Care
.------------------------------------------------------------------------------
CLHUT000  CALL      OPNPRINT
          PRINT     *N,*N,*N,*N,*N:
                    *N,*2,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*2,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*2,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*2,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*2,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*2,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*N:
                    *2,"99999999",*71,"XXXXXXXXXX":
                    *N,*N,*N,*71,"99/99/9999":
                    *N,*N,*N,*N:
                    "99/99/9999":
                    *12,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *40,"99999999 XXXX XXXXXXXXXXXXX XXXXXXXXXXXX":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*50,"CREDIT TOTAL",*71,"999999999999.99":
                    *N,*N,*71,"99999999999999.99":
                    *N,*N,*N,*N:
                    *N,*71,"999999999999.99":
                    *N,*N,*2,"99/99/9999",*13,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*N,*N,*12,"99999999",*25,"XXXXXXXXXXX":
                    *N,*N,*N,*N,*N,*N,*N
          CALL      CLSPRINT
.  
          CALL      LINOK000 
          COMPARE   ZERO,FYESNO
          GOTO      CLHUT000 IF EQUAL
          RETURN
.
.------------------------------------------------------------------------------
. Print credit notes (Hutt Valley Health Care)
.------------------------------------------------------------------------------
CRHUT000  MOVE      ZERO,TOTCRD
          MOVE      ZERO,CPAGENO
.
          CALL      FORAD000        * Format Name & Address into 5 Lines
          CALL      CHHUT000        * Print Heading
.
         PACK       KEY24,DBFHDEB,DBFHDTY,DBFHDOC,SP70
         CALL       RSDBFD1
CRHUT100 CALL       RKDBFD1
         BRANCH     OVRCD,CRHUT900
         MATCH      DBFHDEB,DBFDDEB
         GOTO       CRHUT900 IF NOT EQUAL
         MATCH      DBFHDTY,DBFDDTY
         GOTO       CRHUT900 IF NOT EQUAL
         MATCH      DBFHDOC,DBFDDOC
         GOTO       CRHUT900 IF NOT EQUAL
.
         PACK       KEY8,DBFDITM
         CALL       RDDBIT1        * Read Sales Item Details
.
         UNPACK     DBFDSDAT,CCENT,CYEAR,CMON,CDAY
         CALL       PACDATE
         MOVE       "99999.99",QTYDIM8
         FEDIT      DBFDQTY,QTYDIM8
         IF         DBFDQTY=0
           MOVE       SP70,QTYDIM8
           MOVE       SP70,DBITUNT
         ENDIF
.
         MOVE       "99999999.9999",PRIDIM13
         FEDIT      DBFDPRI,PRIDIM13
         IF         DBFDPRI=0
           MOVE       SP70,PRIDIM13
         ENDIF
 
         MOVE       "99,999,999.99",TOTDIM13
         ASSIGN     DBFDTAX+DBFDTOT,F12P2
         FEDIT      F12P2,TOTDIM13
         IF         F12P2=0
           MOVE       SP70,TOTDIM13
         ENDIF
         ADD        F12P2,TOTCRD
.
         MOVE       DBITIDE,KEY28
         PRINT      CPCDATE,*12,KEY28:
                    *40,QTYDIM8,SP1,DBITUNT,PRIDIM13,TOTDIM13
         ADD        ONE,CLNO
         COMPARE    "28",CLNO
         CALL       CFHUT000 IF EQUAL
.
. Print Credit Detail lines
.----------------------------
          MATCH     SP70,DBFDDREF
          IF        !@EQUAL
            PRINT     *12,DBFDDREF
            ADD       ONE,CLNO
            COMPARE   "28",CLNO
            CALL      CFHUT000 IF EQUAL
          ENDIF 
.
          PACK      KEY27,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,SP70
          CALL      RSDBFN1
CRHUT150  CALL      RKDBFN1
          BRANCH    OVRCD,CRHUT100
          PACK      KEY24,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,SP70
          PACK      KEY27,DBFNDEB,DBFNDTY,DBFNDOC,DBFNDLN,SP70
          MATCH     KEY24,KEY27
          GOTO      CRHUT100 IF NOT EQUAL
          PRINT     *12,DBFNCOM
          ADD       ONE,CLNO
          COMPARE   "28",CLNO
          CALL      CFHUT000 IF EQUAL
          GOTO      CRHUT150
.
CRHUT900  COMPARE   "27",CLNO
          GOTO      CRHUT990 IF EQUAL
          PRINT     " "
          ADD       ONE,CLNO
          GOTO      CRHUT900
.
CRHUT990  UNPACK    DBFHDDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      DBFHDOC,F12
          PRINT     *N,*N,*50,"CREDIT TOTAL",*64,TOTCRD:
                    *N,*N,*64,TOTCRD:
                    *N,*N,*N,*N:
                    *N,*64,TOTCRD:
                    *N,*N,*2,CPDATE,*13,NADLINE1:
                    *N,*N,*N,*12,DBFHDEB,*20,F12:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N
          RETURN
.-------------------------------------------------------------------------------
. Carried forward
.-------------------------------------------------------------------------------
CFHUT000  PRINT     *N,*N,*N,*N,*N,*N,*N,*N:
                    *68,"CARRIED FWD":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N
          CALL       CHHUT000
          RETURN
.------------------------------------------------------------------------------
. Print Header for credit note (Credit Header)
.------------------------------------------------------------------------------
CHHUT000  ADD       ONE,CPAGENO
          MOVE      DBFHDOC,F12
          UNPACK    DBFHDDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     *N,*N,*N,*N,*N:
                    *N,*2,NADLINE1:
                    *N,*2,NADLINE2:
                    *N,*2,NADLINE3:
                    *N,*2,NADLINE4:
                    *N,*2,NADLINE5:
                    *N,*N:
                    *N,*2,DBFHDEB,*67,F12:
                    *N,*N,*N,*69,CPCDATE:
                    *N,*N,*N,*N
          MOVE      ZERO,CLNO
          RETURN
.------------------------------------------------------------------------------
. Lineup print for Credit notes Ballarat Health Services
.------------------------------------------------------------------------------
CLBHS000  CALL      OPNPRINT
.
          CALL      STMPL000        * Set up for Templating
          IF        TMPLTFLG=0
            CALL      XSET0000      * Set Variables value for lineup
            MOVE      ZERO,HEADTAIL   * Flagged to Header
            CALL      XCRD0000      * Print Tax Credit Note Header
            PRINT     *N;
.
            MOVE      ZERO,CLNO
            MOVE      "9999999.99",DIM10TOT
            MOVE      "999999.99",DIM9TAX
            MOVE      "999999.99",DIM9GRN
.
            PRINT     CPDATE,*12,DIM8QTY:
                      *21,DBITUNT,*26,DIM10PRI,*37,DBITIDE:
                      *74,DIM10TOT,*85,DIM9TAX,*95,DIM9GRN;
            CALL      RSBHS000      * print on the right side
.
            MOVE      MAXCLNO,F2
            SUB       TWO,MAXCLNO
            PACK      DBDBDEB,X70
            MOVE      ONE,OVRCD
            CALL      RSBHS000      * print on the right side
            MOVE      F2,MAXCLNO
.
            MOVE      "9999999.99",DIM10
.
            PRINT     *N,*74,DIM10:
                      *85,DIM9TAX,*95,DIM9GRN
.
            IF        TMPLTFLG=0
              MOVE      "99999999999.99",FTOTINV
              MOVE      "99999999999.99",FTGSTEXC
              MOVE      "99999999999.99",FTGSTAMN
.
              MOVE      ONE,HEADTAIL  * Flagged to Tail
              CALL      XCRD0000    * Print Tax Credit Note Tail
              PRINT     " "
            ENDIF
            GOTO     CLBHS900
          ENDIF
.
          PRINT     *82,"CREDIT NOTE",*N,*N,*N,*N:
                    *N,*76,"999999999999",*93,"99/99/9999":
                    *N,*N,*N,*N,*N:
                    *N,*15,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*15,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*15,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*15,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*15,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*2,"XXXXXXXX":
                    *N,*N,*N,*N,*N:
.
                    "99/99/99",*12,"9,999.99",*21,"XXXX":
                    *26,"999,999.99",*37,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *74,"9999999.99",*85,"999999.99",*95,"999999.99":
.
                    *110,"XXXXXXXX":
                    *N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N:
                    *124,"99999999":
                    *N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N:
                    *118,"999,999,999.99":
                    *N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N:
                    *N,*N,*74,"9999999.99",*85,"999999.99",*95,"999999.99":
                    *N,*N,*93,"99999999.99":
                    *N,*N
.
CLBHS900  CALL      CLSPRINT
.
          CALL      LINOK000
          COMPARE   ZERO,FYESNO
          GOTO      CLBHS000 IF EQUAL
.
CLBHS999  RETURN
.------------------------------------------------------------------------------
. Print Credit notes Ballarat Health Services
.------------------------------------------------------------------------------
CRBHS000  MOVE      ZERO,TOTCRD
          MOVE      ZERO,TGSTEXCV
          MOVE      ZERO,TGSTAMNT
          MOVE      ZERO,CPAGENO
.
          CALL      STMPL000        * Set up for Templating
          CALL      FORAD000        * Format Name & Address into 5 Lines
          CALL      CHBHS000        * Print Heading
          CALL      CTIBP000        * Calculate Total Invoice before process
.
          PACK      KEY24,DBFHDEB,DBFHDTY,DBFHDOC,SP70
          CALL      RSDBFD1
CRBHS100  CALL      RKDBFD1
          BRANCH    OVRCD,CRBHS900
          MATCH     DBFHDEB,DBFDDEB
          GOTO      CRBHS890 IF NOT EQUAL
          MATCH     DBFHDTY,DBFDDTY
          GOTO      CRBHS890 IF NOT EQUAL
          MATCH     DBFHDOC,DBFDDOC
          GOTO      CRBHS890 IF NOT EQUAL
.
          PACK      KEY8,DBFDITM
          CALL      RDDBIT1        * Read Sales Item Details
.
          UNPACK    DBFDSDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
.
          MOVE      "9,999.99",DIM8QTY
          FEDIT     DBFDQTY,DIM8QTY
          IF        DBFDQTY=0
            MOVE      SP70,DIM8QTY
            MOVE      SP70,DBITUNT
          ENDIF
.
          MOVE      "999,999.99",DIM10PRI
          MOVE      DBFDPRI,F12P2
          FEDIT     F12P2,DIM10PRI
          IF        F12P2=0
            MOVE      SP70,DIM10PRI
          ENDIF
.
          MOVE      "9999999.99",DIM10TOT
          FEDIT     DBFDTOT,DIM10TOT
          IF        DBFDTOT=0
            MOVE      SP70,DIM10TOT
          ENDIF
          ADD       DBFDTOT,TGSTEXCV
.
..          MOVE      "999,999,999.99",DIM14TAX
          MOVE      "999999.99",DIM9TAX
          FEDIT     DBFDTAX,DIM9TAX
          IF        DBFDTAX=0
            MOVE      SP70,DIM9TAX
          ENDIF
          ADD       DBFDTAX,TGSTAMNT
.
          ASSIGN    DBFDTAX+DBFDTOT,F12P2
..          MOVE      "999,999,999.99",DIM14GRN
          MOVE      "999999.99",DIM9GRN
          FEDIT     F12P2,DIM9GRN
          IF        F12P2=0
            MOVE      SP70,DIM9GRN
          ENDIF
          ADD       F12P2,TOTCRD
.
          PRINT     CPDATE,*12,DIM8QTY:
                    *21,DBITUNT,*26,DIM10PRI,*37,DBITIDE:
                    *74,DIM10TOT,*85,DIM9TAX,*95,DIM9GRN;
          ADD       ONE,CLNO
.
          CALL      RSBHS000        * print on the right side
.
          COMPARE   MAXCLNO,CLNO
          CALL      CFBHS000 IF EQUAL
.
. Print Credit Detail lines
.----------------------------
          MATCH     SP70,DBFDDREF
          IF        !@EQUAL
            PRINT     *12,DBFDDREF;
            ADD       ONE,CLNO
.
            CALL      RSBHS000      * print on the right side
.
            COMPARE   MAXCLNO,CLNO
            CALL      CFBHS000 IF EQUAL
          ENDIF 
.
          PACK      KEY27,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,SP70
          CALL      RSDBFN1
CRBHS150  CALL      RKDBFN1
          BRANCH    OVRCD,CRBHS100
          PACK      KEY24,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,SP70
          PACK      KEY27,DBFNDEB,DBFNDTY,DBFNDOC,DBFNDLN,SP70
          MATCH     KEY24,KEY27
          GOTO      CRBHS100 IF NOT EQUAL
.
          PRINT     *12,DBFNCOM;
          ADD       ONE,CLNO
.
          CALL      RSBHS000        * print on the right side
.
          COMPARE   MAXCLNO,CLNO 
          CALL      CFBHS000 IF EQUAL
          GOTO      CRBHS150
.
CRBHS890  MOVE      ONE,OVRCD
.
CRBHS900  ADD       ONE,CLNO
          CALL      RSBHS000        * print on the right side
.
..          MOVE      "999,999,999.99",DIM14
          MOVE      "9999999.99",DIM10
          FEDIT     TGSTEXCV,DIM10
.
          MATCH     "*********",DIM10
          IF        @EQUAL
            MOVE      TGSTEXCV,F7P2
            MOVE      F7P2,DIM10
          ENDIF
.
..          MOVE      "999,999,999.99",DIM14TAX
          MOVE      "999999.99",DIM9TAX
          FEDIT     TGSTAMNT,DIM9TAX
.
          MATCH     "*********",DIM9TAX
          IF        @EQUAL
            MOVE      TGSTAMNT,F6P2
            MOVE      F6P2,DIM9TAX
          ENDIF
.
          MOVE      "99999999999.99",DIM14GRN
          FEDIT     TOTCRD,DIM14GRN
          MOVE      "999999.99",DIM9GRN
          FEDIT     TOTCRD,DIM9GRN
.
          MATCH     "*********",DIM9GRN
          IF        @EQUAL
            MOVE      TOTCRD,F6P2
            MOVE      F6P2,DIM9GRN
          ENDIF
.
          PRINT     *N,*N,*74,DIM10:
                    *85,DIM9TAX,*95,DIM9GRN
          ADD       TWO,CLNO
.
          IF        TMPLTFLG=0
            MOVE      "99999999999.99",FTOTINV
            FEDIT     TOTCRD,FTOTINV
.
            MOVE      "99999999999.99",FTGSTEXC
            FEDIT     TGSTEXCV,FTGSTEXC
.
            MOVE      "99999999999.99",FTGSTAMN
            FEDIT     TGSTAMNT,FTGSTAMN
.
            MOVE      ONE,HEADTAIL    * Flagged to Tail
            CALL      XCRD0000      * Print Tax Credit Note Tail
            PRINT     " "
            GOTO      CRBHS999
          ENDIF
.
          PRINT     *N,*90,DIM14GRN:
                    *N,*N
          GOTO      CRBHS999
.
CRBHS980  CALL      CFBHS000
          GOTO      CRBHS900
.
CRBHS999  RETURN
.-------------------------------------------------------------------------------
. Carried forward
.-------------------------------------------------------------------------------
CFBHS000  IF        TMPLTFLG=0
            MOVE      CRFWDROW,F3
            MOVE      THREE,CURRROW
            CALL      XPOS0000
            BRANCH    EXIT,CFBHS100
.
            PRINT     *CRFWDCOL,*+,"CARRIED FWD";
.
            MOVE      TAILLENG,F3
            CALL      XPOS0000
            PRINT     *N;
            GOTO      CFBHS900
          ENDIF
.
CFBHS100  PRINT     *N,*N,*N,*N,*93,"CARRIED FWD":
                    *N,*N
CFBHS900  CALL      CHBHS000
.
CFBHS999  RETURN
.------------------------------------------------------------------------------
. Print Header for credit note (Credit Header)
.------------------------------------------------------------------------------
CHBHS000  ADD       ONE,CPAGENO
          MOVE      ZERO,CLNO
          UNPACK    DBFHDDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      DBFHDOC,F12
.
. Determine whether to use Tax Credit Note Templating
.
          IF        TMPLTFLG=0
            MOVE      ZERO,HEADTAIL   * Flagged to Header
            CALL      XCRD0000      * Print Tax Credit Note Header
            CALL      RSBHS000      * print on the right side
            GOTO      CHBHS999
          ENDIF
.
          PRINT     *82,"CREDIT NOTE",*N,*N,*N,*N:
                    *N,*76,F12,*93,CPCDATE:
                    *N,*N,*N,*N,*N:
                    *N,*15,NADLINE1:
                    *N,*15,NADLINE2:
                    *N,*15,NADLINE3:
                    *N,*15,NADLINE4:
                    *N,*15,NADLINE5:
                    *N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*2,DBFHDEB:
                    *N,*N
          CALL      RSBHS000      * print on the right side
.
CHBHS999  RETURN
.------------------------------------------------------------------------------
. Print something on the right hand side of Stationery
. Requires : OVERCD = 1 - loop thru until MAXCLNO reach
.                     0 - just find the appropriate position to print
.------------------------------------------------------------------------------
RSBHS000  COMPARE   ZERO,CLNO
          GOTO      RSBHS020 IF EQUAL
.
          COMPARE   THREE,CLNO
          GOTO      RSBHS040 IF EQUAL
.
          COMPARE   TEN3,CLNO
          GOTO      RSBHS060 IF EQUAL
.
          COMPARE   TWENTY3,CLNO
          GOTO      RSBHS080 IF EQUAL
.
          COMPARE   MAXCLNO,CLNO
          GOTO      RSBHS010 IF NOT LESS
.
          PRINT     *133," "
RSBHS010  BRANCH    OVRCD,RSBHS990
          GOTO      RSBHS999
.
RSBHS020  PRINT     *114," ":
                    *N
          ADD       TWO,CLNO
          BRANCH    OVRCD,RSBHS000
          GOTO      RSBHS999
.
RSBHS040  PRINT     *114,DBFHDEB
          BRANCH    OVRCD,RSBHS990
          GOTO      RSBHS999
.
RSBHS060  PRINT     *120,F12
          BRANCH    OVRCD,RSBHS990
          GOTO      RSBHS999
.
RSBHS080  MOVE      "999,999,999.99",PRBALANC
          FEDIT     SVTOTALS,PRBALANC
.
          PRINT     *118,PRBALANC
          BRANCH    OVRCD,RSBHS990
          GOTO      RSBHS999
.
RSBHS990  ADD       ONE,CLNO
.
          COMPARE   MAXCLNO,CLNO
          GOTO      RSBHS999 IF NOT LESS
          GOTO      RSBHS000
.
RSBHS999  RETURN
.------------------------------------------------------------------------------
. Lineup print for Credit notes Standard 132 Column
.------------------------------------------------------------------------------
CL132000 CALL       OPNPRINT
.
          CALL      STMPL000        * Set up for Templating
          CALL      XSET0000      * Set Variables value for lineup
          MOVE      ZERO,HEADTAIL   * Flagged to Header
          CALL      XCRD0000      * Print Tax Credit Note Header
.
          PRINT     CPCDATE,*20,DIM4QTY:
                    *27,KEY28,*83,DIM10PRI,*92,DIM12TOT:
                    *107,DIM10TAX,*121,TOTDIM12
.
          PRINT     *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N
.
          PRINT     *N,*27,"CREDIT TOTAL",*92,DIM12:
                    *107,DIM10TAX,*121,TOTDIM12:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N
.
          MOVE      ONE,HEADTAIL  * Flagged to Tail
          CALL      XCRD0000    * Print Tax Credit Note Tail
          PRINT     " "
.
CL132900 CALL      CLSPRINT
.
         CALL      LINOK000
         COMPARE   ZERO,FYESNO
         GOTO      CL132000 IF EQUAL
.
CL132999 RETURN
.------------------------------------------------------------------------------
. Print Credit notes 132 Column
.------------------------------------------------------------------------------
CR132000  MOVE      ZERO,TOTCRD
          MOVE      ZERO,TGSTEXCV
          MOVE      ZERO,TGSTAMNT
          MOVE      ZERO,CPAGENO
.
          CALL      STMPL000        * Set up for Templating
          CALL      FORAD000        * Format Name & Address into 5 Lines
          CALL      CH132000        * Print Heading
.
         PACK       KEY24,DBFHDEB,DBFHDTY,DBFHDOC,SP70
         CALL       RSDBFD1
CR132100 CALL       RKDBFD1
         BRANCH     OVRCD,CR132900
         MATCH      DBFHDEB,DBFDDEB
         GOTO       CR132900 IF NOT EQUAL
         MATCH      DBFHDTY,DBFDDTY
         GOTO       CR132900 IF NOT EQUAL
         MATCH      DBFHDOC,DBFDDOC
         GOTO       CR132900 IF NOT EQUAL
.
         PACK       KEY8,DBFDITM
         CALL       RDDBIT1        * Read Sales Item Details
.
         UNPACK     DBFDSDAT,CCENT,CYEAR,CMON,CDAY
         CALL       PACDATE
.
         MOVE       DBFDQTY,F4P2
         MOVE       "9999.99",DIM7QTY
         FEDIT      F4P2,DIM7QTY
         IF         DBFDQTY=0
           MOVE       SP70,DIM7QTY
           MOVE       SP70,DBITUNT
         ENDIF
.
         MOVE       "999,999.99",DIM10PRI
         MOVE       DBFDPRI,F12P2
         MULT       SEQ,F12P2
         FEDIT      F12P2,DIM10PRI
         IF         F12P2=0
           MOVE       SP70,DIM10PRI
         ENDIF
.
         MOVE       "9,999,999.99",DIM12TOT
         MULT       SEQ,DBFDTOT
         FEDIT      DBFDTOT,DIM12TOT
         IF         DBFDTOT=0
           MOVE       SP70,DIM12TOT
         ENDIF
         ADD        DBFDTOT,TGSTEXCV
.
         MOVE       "999,999.99",DIM10TAX
         MULT       SEQ,DBFDTAX
         FEDIT      DBFDTAX,DIM10TAX
         IF         DBFDTAX=0
           MOVE       SP70,DIM10TAX
         ENDIF
         ADD        DBFDTAX,TGSTAMNT
.
         ASSIGN     DBFDTAX+DBFDTOT,F12P2
         MOVE       "9,999,999.99",TOTDIM12
         MOVE       "99,999,999.99",TOTDIM13
         FEDIT      F12P2,TOTDIM13
         FEDIT      F12P2,TOTDIM12
         IF         F12P2=0
           MOVE       SP70,TOTDIM12
           MOVE       SP70,TOTDIM13
         ENDIF
         ADD        F12P2,TOTCRD
.
         PRINT      CPCDATE,*17,DIM7QTY:
                    *27,DBITIDE,*83,DIM10PRI,*92,DIM12TOT:
                    *107,DIM10TAX,*121,TOTDIM12
         ADD        ONE,CLNO
         COMPARE    MAXCLNO,CLNO
         CALL       CF132000 IF EQUAL
.          
. Print Credit Detail lines
.----------------------------
          MATCH     SP70,DBFDDREF
          IF        !@EQUAL
            PRINT     *27,DBFDDREF
            ADD       ONE,CLNO
            COMPARE    MAXCLNO,CLNO
            CALL       CF132000 IF EQUAL
          ENDIF 
.
          PACK      KEY27,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,SP70
          CALL      RSDBFN1
CR132150  CALL      RKDBFN1
          BRANCH    OVRCD,CR132100
          PACK      KEY24,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,SP70
          PACK      KEY27,DBFNDEB,DBFNDTY,DBFNDOC,DBFNDLN,SP70
          MATCH     KEY24,KEY27
          GOTO      CR132100 IF NOT EQUAL
.
          PRINT     *27,DBFNCOM
          ADD       ONE,CLNO
          COMPARE   MAXCLNO,CLNO
          CALL      CF132000 IF EQUAL
          GOTO      CR132150
.
CR132900  ASSIGN    MAXCLNO-TWO,F2
          COMPARE   F2,CLNO
          GOTO      CR132990 IF EQUAL 
          GOTO      CR132980 IF NOT LESS
.
          PRINT     " "
          ADD       ONE,CLNO
          GOTO      CR132900
.
CR132980  ASSIGN    MAXCLNO-ONE,F2
          IF        CLNO=F2
            PRINT     " "
          ENDIF
          CALL      CF132000
          GOTO      CR132900
.
CR132990  MOVE      "9,999,999.99",DIM12
          FEDIT     TGSTEXCV,DIM12
.
          MATCH     "************",DIM12
          IF        @EQUAL
            MOVE      TGSTEXCV,F9P2
            MOVE      F9P2,DIM12
          ENDIF
.
          MOVE      "999,999.99",DIM10TAX
          FEDIT     TGSTAMNT,DIM10TAX
.
          MATCH     "**********",DIM10TAX
          IF        @EQUAL
            MOVE      TGSTAMNT,F7P2
            MOVE      F7P2,DIM10TAX
          ENDIF
.
          MOVE      "9,999,999.99",TOTDIM12
          FEDIT     TOTCRD,TOTDIM12
.
          MATCH     "************",TOTDIM12
          IF        @EQUAL
            MOVE      TOTCRD,F9P2
            MOVE      F9P2,TOTDIM12
          ENDIF
.
          PRINT     *N,*27,"CREDIT TOTAL",*92,DIM12:
                    *107,DIM10TAX,*121,TOTDIM12:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N
          ADD       TEN1,CLNO
.
          MOVE      "999,999,999.99",FTOTINV
          FEDIT     TOTCRD,FTOTINV
.
          MOVE      "999,999,999.99",FTGSTEXC
          FEDIT     TGSTEXCV,FTGSTEXC
.
          MOVE      "999,999,999.99",FTGSTAMN
          FEDIT     TGSTAMNT,FTGSTAMN
.
          MOVE      ONE,HEADTAIL    * Flagged to Tail
          CALL      XCRD0000      * Print Tax Credit Note Tail
          PRINT     " "
          GOTO      CR132999
.
CR132999  RETURN
.-------------------------------------------------------------------------------
. Carried forward
.-------------------------------------------------------------------------------
CF132000  PRINT     *N,*N,*122,"CARRIED FWD",*N,*N,*N,*N,*N,*N
          MOVE      ONE,CARRIED
          MOVE      ONE,HEADTAIL
          CALL      XCRD0000
          PRINT     " "
          GOTO      CF132900
.
CF132900  CALL      CH132000
.
CF132999  RETURN
.------------------------------------------------------------------------------
. Print Header for credit note (Credit Header)
.------------------------------------------------------------------------------
CH132000  ADD       ONE,CPAGENO
          MOVE      ZERO,CLNO
.
. Determine whether to use Tax Credit Note Templating
.
          MOVE      ZERO,HEADTAIL   * Flagged to Header
          CALL      XCRD0000      * Print Tax Credit Note Header
          GOTO      CH132999
.
CH132999  RETURN
.------------------------------------------------------------------------------
.------------------------------------------------------------------------------
. Calculate Total Invoice before start printing process
.------------------------------------------------------------------------------
CTIBP000  MOVE      ZERO,SVTOTALS
.
          PACK      KEY24,DBFHDEB,DBFHDTY,DBFHDOC,SP70
          CALL      RSDBFD1
CTIBP100  CALL      RKDBFD1
          BRANCH    OVRCD,CTIBP999
.
          MATCH     DBFHDEB,DBFDDEB
          GOTO      CTIBP999 IF NOT EQUAL
.
          MATCH     DBFHDTY,DBFDDTY
          GOTO      CTIBP999 IF NOT EQUAL
.
          MATCH     DBFHDOC,DBFDDOC
          GOTO      CTIBP999 IF NOT EQUAL
.
          ASSIGN    DBFDTAX+DBFDTOT,F12P2
          ADD       F12P2,SVTOTALS
          GOTO      CTIBP100
.
CTIBP999  RETURN
.------------------------------------------------------------------------------
. Set Template Files
. Checks whether Template being used
. Find appropriate position for carried forward
. Returns  : TMPLTFLG : 0 - do template, 1 - don't template
.            CRFWDROW
.            CRFWDCOL
.------------------------------------------------------------------------------
STMPL000  MOVE      ONE,TMPLTFLG
.
          MATCH     "000000",CFDBCRHD
          GOTO      STMPL050 IF EQUAL
.
          MATCH     SP6,CFDBCRHD
          GOTO      STMPL100 IF NOT EQUAL
.
STMPL050  MATCH     "000000",CFDBCRTL
          GOTO      STMPL999 IF EQUAL
.
          MATCH     SP6,CFDBCRTL
          GOTO      STMPL999 IF EQUAL
.
STMPL100  PACK      KEY6,CFDBCRHD,SP70
          CALL      RDIBTH1               * read header detail file
          BRANCH    OVRCD,STMPL900
.
          MOVE      IBTHLENG,HEADLENG
.
          PACK      KEY6,CFDBCRTL,SP70
          CALL      RDIBTH1               * read header detail file
          BRANCH    OVRCD,STMPL910
.
          MOVE      IBTHLENG,TAILLENG
.
          MOVE      TWO,CRFWDROW
          MOVE      SIXTY6,CRFWDCOL
          PACK      KEY12,CFDBCRTL,SP70
          CALL      RSIBDET1              * read detail file
STMPL200  CALL      RKIBDET1              * read detail file
          BRANCH    OVRCD,STMPL990
.
          MATCH     IBTHSCOD,IBDTSCOD
          GOTO      STMPL990 IF NOT EQUAL
.
          COMPARE   TWO,IBDTINDC
          GOTO      STMPL200 IF NOT EQUAL
.
          UNPACK    IBDTTXFL,D5
          MOVE      "    8",DIM5
          MATCH     DIM5,D5
          IF        @EQUAL
            MOVE      IBDTCOL,CRFWDCOL
            ADD       THREE,CRFWDCOL
            GOTO      STMPL250
          ENDIF
.
          MOVE      "    1",DIM5
          MATCH     DIM5,D5
          IF        @EQUAL
            MOVE      IBDTCOL,CRFWDCOL
            ADD       FOUR,CRFWDCOL
            GOTO      STMPL250
          ENDIF
          GOTO      STMPL200
.
STMPL250  MOVE      IBDTROW,CRFWDROW
          GOTO      STMPL990
.
.------ stationery code not on file ------
.
STMPL900  MOVE     "User Defined Stationery Header Code not on File. - ",DISPMSG
          CALL      MESSAGE1
          BEEP
          GOTO      STMPL999
.
STMPL910  MOVE      "User Defined Stationery Tail Code not on File. - ",DISPMSG
          CALL      MESSAGE1
          BEEP
          GOTO      STMPL999
.
STMPL990  
..          ASSIGN     MAXLENGT-HEADLENG-TAILLENG,MAXCOLNO
..          IF         MAXCOLNO>1
..            MOVE       MAXCOLNO,MAXCLNO
..          ENDIF
          MOVE      ZERO,TMPLTFLG
.
STMPL999  RETURN
.------------------------------------------------------------------------------
. Print Tax Invoice Header for All Sites
. Requires : HEADTAIL : 0 - Head, 1 - Tail
.------------------------------------------------------------------------------
XCRD0000  MOVE      ONE,CURRROW              * Initialise current row counter
.
          IF        HEADTAIL=0
            PACK      KEY6,CFDBCRHD,SP70
            CALL      RDIBTH1               * read header detail file
.
            PACK      KEY12,CFDBCRHD,SP70
          ELSE
            PACK      KEY6,CFDBCRTL,SP70
            CALL      RDIBTH1               * read header detail file
.
            PACK      KEY12,CFDBCRTL,SP70
          ENDIF
          CALL      RSIBDET1
          CALL      RKIBDET1
          BRANCH    OVRCD,XCRD8000
.
          IF        HEADTAIL=0
            MATCH     CFDBCRHD,IBDTSCOD        * Same form ?
            GOTO      XCRD8000 IF NOT EQUAL    * No - pad out rest of form
            GOTO      XCRD0100
          ELSE
            MATCH     CFDBCRTL,IBDTSCOD        * Same form ?
            GOTO      XCRD8000 IF NOT EQUAL    * No - pad out rest of form
            GOTO      XCRD0100
          ENDIF
.
XCRD0100  COMPARE   CURRROW,IBDTROW          * Current row up to required row ?
          GOTO      XCRD0400 IF EQUAL        * Yes - print data
          PRINT     *N;                      * Else print 1 extra line
          ADD       ONE,CURRROW              * Increment counter
          GOTO      XCRD0100                 * Check counter again
.
. ------- Read through the details file -------
.
XCRD0200  CALL      RKIBDET1                 * Read next detail record
          BRANCH    OVRCD,XCRD8000           * No more records - pad out form
.
          BRANCH    HEADTAIL,XCRD0250        * Header or Tail ?
.
          MATCH     CFDBCRHD,IBDTSCOD        * Same form ?
          GOTO      XCRD8000 IF NOT EQUAL    * No - pad out rest of form
          GOTO      XCRD0300
.
XCRD0250  MATCH     CFDBCRTL,IBDTSCOD        * Same form ?
          GOTO      XCRD8000 IF NOT EQUAL    * No - pad out rest of form
.
XCRD0300  COMPARE   CURRROW,IBDTROW          * Are we at the required row ?
          GOTO      XCRD0400 IF EQUAL        * Yes - print data
          PRINT     *N;                      * Else pad out to required row
          ADD       ONE,CURRROW              * One more row printed
          GOTO      XCRD0300                 * Check row count
.
. ------- Print actual data lines -------
.
XCRD0400  BRANCH    IBDTINDC,XCRD0500:       * Text field
                             XCRD0600        * Data field
.
. ------- Print text field -------
.
XCRD0500  RESET     IBDTTXFL,IBDTPLEN
          LENSET    IBDTTXFL
          RESET     IBDTTXFL
          PRINT     *IBDTCOL,*+,IBDTTXFL;    * Print data
          MOVE      IBDTROW,CURRROW          * Row printed is current row
          GOTO      XCRD0200                 * Read next record
.
. ------- Print data field -------
.
XCRD0600  MOVE      IBDTTXFL,DIM5            * Data number 1st 3 chars of field
          MOVE      DIM5,FORM5               * Move to a FORM field for BRANCH
          PACK      VARIABLE,SP30,SP30,SP30,SP30,SP10  * Initialise variable
.
          BRANCH    HEADTAIL,XCRD0650        * Header or Tail ?
.
          BRANCH    FORM5,XCRD1010,XCRD1020,XCRD1030,XCRD1040,XCRD1050:
                          XCRD1060,XCRD1070,XCRD1080,XCRD1090,XCRD1100:   10
                          XCRD1110,XCRD1120,XCRD1130,XCRD1140,XCRD1150:
                          XCRD1160,XCRD1170,XCRD1180,XCRD1190,XCRD1200:   20
                          XCRD1210
          GOTO      XCRD0200                 * ignoring, Read next record
.
XCRD0650  BRANCH    FORM5,XCRD0710,XCRD1010,XCRD1090,XCRD1140,XCRD0720:
                          XCRD1130,XCRD1190,XCRD0730,XCRD0740,XCRD0750:   10
                          XCRD0760,XCRD0770,XCRD0780,XCRD0790,XCRD1210:
                          XCRD0800,XCRD0810
          GOTO      XCRD0200                 * ignoring, Read next record
.
. Tail Items/Fields below
.
XCRD0710  IF        CARRIED=1
            MOVE      " CARRIED FWD",VARIABLE
            MOVE      ZERO,CARRIED
            GOTO      XCRD5000
          ELSE
            MOVE      TOTCRD,VARIABLE          * Total Unformated Cr.Note Amount
          ENDIF
          MOVE      TEN5,PRNTSTRT
          SUB       IBDTPLEN,PRNTSTRT
          GOTO      XCRD5000
.
XCRD0720  MOVE      DBTEDES,VARIABLE         * Terms Code Description
          GOTO      XCRD5000
.
XCRD0730  IF        CARRIED=1
            MOVE      " CARRIED FWD",VARIABLE
            MOVE      ZERO,CARRIED
            GOTO      XCRD5000
          ELSE
            MOVE      FTOTINV,VARIABLE         * Total Formated Cr.Note Amount
          ENDIF
          GOTO      XCRD5000
.
XCRD0740  MOVE      BAL3,VARIABLE            * Formated Stat.Amount Bal.90 days
          GOTO      XCRD5000
.
XCRD0750  MOVE      BAL2,VARIABLE            * Formated Stat.Amount Bal.60 days
          GOTO      XCRD5000
.
XCRD0760  MOVE      BAL1,VARIABLE            * Formated Stat.Amount Bal.30 days
          GOTO      XCRD5000
.
XCRD0770  MOVE      CURR,VARIABLE            * Formated Stat. Current Balance
          GOTO      XCRD5000
.
XCRD0780  MOVE      STAMESS1,VARIABLE        * Statement Message 1
          GOTO      XCRD5000
.
XCRD0790  MOVE      STAMESS2,VARIABLE        * Statement Message 2
          GOTO      XCRD5000
.
XCRD0800  MOVE      FTGSTEXC,VARIABLE        * Formated Total GST Exclusive
          GOTO      XCRD5000
.
XCRD0810  MOVE      FTGSTAMN,VARIABLE        * Formated Total GST Amount
          GOTO      XCRD5000
.
. Header Items/Fields below
.
XCRD1010  MOVE      DBFHDEB,VARIABLE         * Debtor number
          GOTO      XCRD5000
.
XCRD1020  MOVE      DBDBNA1,VARIABLE         * Debtor Name 1
          GOTO      XCRD5000
.
XCRD1030  MOVE      DBDBNA2,VARIABLE         * Debtor Name 2
          GOTO      XCRD5000
.
XCRD1040  MOVE      DBDBAD1,VARIABLE         * Debtor Address Line 1
          GOTO      XCRD5000
.
XCRD1050  MOVE      DBDBAD2,VARIABLE         * Debtor Address Line 2
          GOTO      XCRD5000
.
XCRD1060  MOVE      DBDBAD3,VARIABLE         * Debtor Address Line 3
          GOTO      XCRD5000
.
XCRD1070  MOVE      DBDBAD4,VARIABLE         * Debtor Address Line 4
          GOTO      XCRD5000
.
XCRD1080  MOVE      DBDBPC,VARIABLE          * Debtor Post Code
          GOTO      XCRD5000
.
XCRD1090  MOVE      DBFHDOC,F12              * Invoice number
          MOVE      F12,VARIABLE
          MOVE      TEN2,PRNTSTRT
          SUB       IBDTPLEN,PRNTSTRT
          GOTO      XCRD6000
.
XCRD1100  MOVE      CPAGENO,VARIABLE         * Page number
          MOVE      THREE,PRNTSTRT
          SUB       IBDTPLEN,PRNTSTRT
          GOTO      XCRD6000
.
XCRD1110  MATCH     SP70,DISDATE             * Discharge date
          GOTO      XCRD0200 IF EQUAL
.
          MOVE      DISDATE,VARIABLE
          MOVE      TEN,IBDTPLEN
          GOTO      XCRD5000
.
XCRD1120  MATCH     SP70,ADMDATE             * Admission date
          GOTO      XCRD0200 IF EQUAL
.
          MOVE      ADMDATE,VARIABLE
          MOVE      TEN,IBDTPLEN
          GOTO      XCRD5000
.
XCRD1130  UNPACK    DBFHDDAT,CCENT,CYEAR,CMON,CDAY    * Invoice date
          CALL      PACDATE
          IF        IBDTPLEN = 10
            MOVE      CPCDATE,VARIABLE
          ELSE
            MOVE      CPDATE,VARIABLE
          ENDIF
          GOTO      XCRD5000
.
XCRD1140  MOVE      NADLINE1,VARIABLE        * Debtor Name & Address 1
          GOTO      XCRD5000
.
XCRD1150  MOVE      NADLINE2,VARIABLE        * Debtor Name & Address 2
          GOTO      XCRD5000
.
XCRD1160  MOVE      NADLINE3,VARIABLE        * Debtor Name & Address 3
          GOTO      XCRD5000
.
XCRD1170  MOVE      NADLINE4,VARIABLE        * Debtor Name & Address 4
          GOTO      XCRD5000
.
XCRD1180  MOVE      NADLINE5,VARIABLE        * Debtor Name & Address 5
          GOTO      XCRD5000
.
XCRD1190  MOVE      DBFHUR1,VARIABLE         * User Def.Ref. 1 (Stat. Reference)
          GOTO      XCRD5000
.
XCRD1200  MOVE      DBFHUR2,VARIABLE         * User Def.Ref. 2
          GOTO      XCRD5000
.
XCRD1210  UNPACK    ASATDATE,CCENT,CYEAR,CMON,CDAY    * Statement date
          CALL      PACDATE
          IF        IBDTPLEN = 10
            MOVE      CPCDATE,VARIABLE
          ELSE
            MOVE      CPDATE,VARIABLE
          ENDIF
          GOTO      XCRD5000
.
. ------- Format the variable -------
.
XCRD5000  RESET     VARIABLE,IBDTPLEN
          LENSET    VARIABLE
          RESET     VARIABLE
          PRINT     *IBDTCOL,*+,VARIABLE;
          GOTO      XCRD0200                 * Read next record
.
. ------- Formatting for Form fields and right justified variables -------
.
XCRD6000  COMPARE   ZERO,PRNTSTRT          * Don't bump if printing full length
          GOTO      XCRD7000 IF EQUAL
.
          BUMP      VARIABLE,PRNTSTRT      * bump to starting position
.
. ------- Print the variable -------
.
XCRD7000  PRINT     *IBDTCOL,*+,VARIABLE;
          GOTO      XCRD0200                 * Read next record
.
.------ end of invoice reached ------
.
XCRD8000  MOVE      FALSE,EXIT
.
.------ print new-lines until the end of page is reached ------
.
XCRD9000  COMPARE   IBTHLENG,CURRROW         * test page length
          GOTO      XCRD9999 IF NOT LESS
.
          PRINT     *N;
          ADD       ONE,CURRROW
          GOTO      XCRD9000
.
XCRD9999  MOVE      ZERO,CLNO                * Set column number
          RETURN                             * Finished
.------------------------------------------------------------------------------
. Position Credit Note
. Requires : F3
. Returns  : CURRROW
.            EXIT - 0 Successful, 1 - Error positioning
.------------------------------------------------------------------------------
XPOS0000  MOVE      ZERO,EXIT
          COMPARE   CURRROW,F3               * Current row up to required row ?
          GOTO      XPOS9999 IF EQUAL        * Yes - print data
          GOTO      XPOS9990 IF LESS         * out of the loop
          PRINT     *N;                      * Else print 1 extra line
          ADD       ONE,CURRROW              * Increment counter
          GOTO      XPOS0000                 * Check counter again
.
XPOS9990  MOVE      ONE,EXIT
XPOS9999  RETURN
.------------------------------------------------------------------------------
. Set Variable value for Lineup print
.------------------------------------------------------------------------------
XSET0000  MOVE      "999999999.99",TOTCRD
          MOVE      "999999999.99",SVTOTALS  
          PACK      DBTEDES,X70
          MOVE      "999,999,999.99",FTOTINV
          MOVE      "999,999,999.99",FTGSTEXC
          MOVE      "999,999,999.99",FTGSTAMN
          MOVE      "9,999,999.99",PRTOTBAL
          MOVE      "9,999,999.99",BAL1
          MOVE      "9,999,999.99",BAL2
          MOVE      "9,999,999.99",BAL3
          MOVE      "9,999,999.99",CURR
          PACK      STAMESS1,X70
          PACK      STAMESS2,X70
          PACK      DBFHDEB,X70
          PACK      DBDBNA1,X70
          PACK      DBDBNA2,X70
          PACK      DBDBAD1,X70
          PACK      DBDBAD2,X70
          PACK      DBDBAD3,X70
          PACK      DBDBAD4,X70
          PACK      DBDBPC,X70
          MOVE      "999999999999",DBFHDOC
          MOVE      "999",CPAGENO
          MOVE      "99/99/9999",ADMDATE
          MOVE      "99/99/9999",DISDATE
          MOVE      "99999999",DBFHDDAT
          PACK      NADLINE1,X70
          PACK      NADLINE2,X70
          PACK      NADLINE3,X70
          PACK      NADLINE4,X70
          PACK      NADLINE5,X70
          PACK      DBFHUR1,X70
          PACK      DBFHUR2,X70
          MOVE      "99999999",ASATDATE
.
          PACK      DBITUNT,X70
          PACK      DBFDITM,X70
          PACK      DBITIDE,X70
          PACK      DIM6,X70
          MOVE      "9999.99",DIM7
          MOVE      "99999.99",QTYDIM8
          MOVE      "9999",DIM4QTY
          MOVE      "9,999.99",DIM8QTY
          MOVE      "999,999.99",DIM10TOT
          MOVE      "9,999,999.99",DIM12TOT
          MOVE      "999,999.99",DIM10PRI
          MOVE      "99,999.99",DIM9GRN
          MOVE      "999,999,999.99",DIM14GRN
          MOVE      "99,999.99",DIM9TAX
          MOVE      "999,999.99",DIM10TAX
          MOVE      "99,999,999.99",DIM13TAX
          MOVE      "999,999,999.99",DIM14TAX
          MOVE      "999,999.99",DIM10
          MOVE      "999,999.99",DIM10A
          MOVE      "999,999,999.99",DIM14
          MOVE      "999,999,999.99",DIM14A
          MOVE      "999,999,999.99",DIM14B
          MOVE      "99999999.9999",PRIDIM13
          MOVE      "9,999,999.99",TOTDIM12
          MOVE      "99,999,999.99",TOTDIM13
          MOVE      "999,999,999.99",FTGSTEXC
          MOVE      "999,999,999.99",FTGSTAMN
          PACK      KEY20,X70
          PACK      KEY27,X70
          PACK      KEY28,X70
          MOVE      "9999",F4
          MOVE      "999",F3
.
XSET9999  RETURN
.

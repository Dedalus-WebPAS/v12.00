.*****************************************************************************
.*    Program      : F50PMVX1                                                *
.*    Description  : Conversion pmsvx1af to new File layout                  *
.*                                                                           *
.*    Author       :  Bronko Sosic                                           *
.*    Date         :  02/04/2001                                             *
.*    Modifications:                                                         *
.*    V9.09.01  - 03/12/2007 Jill Habasque  CAR 154130                       *
.*                Added move of pvidate to pmvxvsdt                          *
.*    v9.02.03  - 17/06/2003 Ebon Clements  CAR                              *
.*                Added oracle option to program                             *
.*    v9.02.02  - 07/04/2003  Jill Habasque SRF 38036                        *
.*                Added new fields                                           *
.*    v9.02.01  - 29.10.2001 - Glenn Saunders                                *
.*                Change PMVXCSNR to be defaulted to 0 not spaces.           *
.*****************************************************************************
.
          INC       STD001FD
          INC       PATMI1FD/INC
          INC       PATVISFD/INC
          INC       PMSVX1FD/INC
          INC       PATMA1FD/INC
.
FINDFILE  FILE      ASCII, FIXED=719
.
CMDLINE   DIM       100
DIM60     DIM       60
.
RECNUM    FORM      8
NEWFILE   DIM       60
NEWPATH   DIM       60
OLDPATH   DIM       60
DEFPATH   DIM       60
SP50      INIT    "                                                  "
SP60      INIT    "                                                            "
ORACLEFL  FORM      1
.
PRGNAM    INIT      "Conversion PMSVX1FD"
PRGID     INIT      "F50PMVX1"
VERSION   INIT      "V12.00.00"
.
. Start of Program
.
MAIN0000  CALL      INIT0000                      * init and open files
          BRANCH    EXIT,MAIN9999                 * init failure
.
MAIN0100  CALL      OPTN0000                      * select options
          BRANCH    EXIT,MAIN9999                 * EXIT = 1 if 0 chosen in menu
          BRANCH    COPTION,MAIN0200,MAIN0500     * proceed with clean up
          GOTO      MAIN9999
.
MAIN0200  CALL      KDIR0000                      * Keyin directory
          BRANCH    EXIT,MAIN9999
.
MAIN0500  CALL      CONTQST                       * Ok to continue ?
          BRANCH    CEXIT,MAIN1000,MAIN0000,MAIN9999 * Yes, no, cancel
.
MAIN1000  CALL      PREP0000                      * preparing files
          BRANCH    EXIT,MAIN9999
.
. Loop thru old file and write records to new file
.
          CALL      READ0000                      * read master records 
          CALL      ENDP0000                      * save/compress saved file
.
MAIN9999  CHAIN     PGM
+
.********************************************************************
.*                          INIT0000                                *
.*  Display heading and check that the files needed exist&open them *
.********************************************************************
INIT0000  CALL      DISPHEAD
          MOVE      ZERO,RECNUM
          MOVE      ZERO,ORACLEFL
          
INIT9999  RETURN
+
.****************************************************************************
.*                                OPTN0000             Called by: ML0000    *
.*                        get user options or exit                          *
.*                                                                          *
.*    Returns:  EXIT    = FALSE (0)  Run clean up                           *
.*                        TRUE  (1)  Exit option selected                   *
.****************************************************************************
.
OPTN0000  DISPLAY   *P1:3,*EF,*P1:4,*V2LON,ZERO,*HOFF,". Exit":
                    *P1:5,*V2LON,ONE,*HOFF,". Run Fix Program CISAM ":
                    *P1:6,*V2LON,TWO,*HOFF,". Run Fix Program ORACLE"
.
OPTN0500  KEYIN     *P1:8,*EL,"Select Option : ",*DV,UNDLN1:
                    *P17:8,*V2LON,COPTION
.
          COMPARE   ZERO,COPTION                 * exit selected ?
          GOTO      OPTN9500 IF EQUAL            * yes
.
          BRANCH    COPTION,OPTN9000,OPTN9100    * run clean-up
.
          BEEP
          GOTO      OPTN0500
.
OPTN9000  MOVE      ZERO,EXIT
          MOVE      ZERO,ORACLEFL
          GOTO      OPTN9999
.
OPTN9100  MOVE      ZERO,EXIT
          MOVE      ONE,ORACLEFL
          GOTO      OPTN9999
.
OPTN9500  MOVE      ONE,EXIT
.
OPTN9999  RETURN
+
.********************************************************************
.*                          KDIR0000                                *
.*  Keyin directories                                               *
.********************************************************************
KDIR0000  CALL      DEFT0000
.
.         Keyin the path for the new file
.
KDIR5000  MOVE      SP60,NEWPATH
          MOVE      DEFPATH,NEWPATH
          KEYIN     *P1:15,*EL,"Keyin path for the new PMI extension file: ":
                    *P10:16,*EL,*DV,*RV,NEWPATH:
                    *P10:16,NEWPATH;
          ENDSET    NEWPATH
          APPEND    SP60,NEWPATH
          RESET     NEWPATH
.
          MATCH     SP60,NEWPATH
          IF        @EQUAL
            PACK      NEWPATH,DEFPATH      * use the default
            DISPLAY   *P10:16,*V2LON,NEWPATH;
          ENDIF
.
          SQUEEZE   NEWPATH
          CMATCH    EXITCHAR,NEWPATH
          GOTO      KDIR9000 IF EQUAL
.
          PACK      DIM60,NEWPATH,SP60
          CALL      VALD0000         * check if it's a valid directory
          BRANCH    EXIT,KDIR5000
          GOTO      KDIR9999
.
KDIR9000  MOVE      ONE,EXIT
KDIR9999  DISPLAY   *P1:24,*EL;
          RETURN
+
.********************************************************************
.*                          PREP0000                                *
.*  Preparing files                                                 *
.********************************************************************
PREP0000  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PATMI1A1,"patmi1af"
          TRAPCLR   IO
          BRANCH    OVRCD,PREP5000       * Original file does not exist
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PATVISA1,"patvisaf"
          TRAPCLR   IO
          BRANCH    OVRCD,PREP6000       * Original file does not exist
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PATMA1A1,"patma1af"
          TRAPCLR   IO
          BRANCH    OVRCD,PREP7000       * Original file does not exist
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PATMX1A1,"patmx1af"
          TRAPCLR   IO
          BRANCH    OVRCD,PREP8000       * Original file does not exist
.
          COMPARE   ONE,ORACLEFL 
          GOTO      PREP0500 IF NOT EQUAL 
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PMSVX1A1,"pmsvx1af"
          TRAPCLR   IO
          BRANCH    OVRCD,PREP8500       * Original file does not exist
.
          GOTO      PREP4000              * Don't build files for oracle fixits
.
PREP0500  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PMSVX1A1,"pmsvx1af"
          TRAPCLR   IO
          IF        OVRCD<>1
            DISPLAY   *P1:24,*EL,*B,"Extension file exists!";
            CALL      HITENTER                                                 
            GOTO      PREP9000
          ENDIF
.
. Create the new file
.
          DISPLAY   *P1:24,*EL,"Creating new PMI extension file ... ":
                    "Please wait !! ";
          PACK      NEWFILE,SP60
          CLEAR     NEWFILE
          APPEND    NEWPATH,NEWFILE
          APPEND    "pmsvx1af",NEWFILE
          APPEND    SP60,NEWFILE
          RESET     NEWFILE
          SQUEEZE   NEWFILE
.
PREP1000  PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          APPEND    "isbuild ",CMDLINE
          APPEND    NEWFILE,CMDLINE
          APPEND    " 719 UC1-8",CMDLINE
          APPEND    SP60,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CLEAR     CMDLINE
          APPEND    "isadd ",CMDLINE
          APPEND    NEWFILE,CMDLINE
          APPEND    " UC9-16,1-8",CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          OPEN      PMSVX1A1,NEWFILE
.
. set the flag to say we want to continue
.
PREP4000  DISPLAY   *P1:24,*EL;
          MOVE      ZERO,EXIT
          CALL      IBACLOCK
          REP       " 0",CDATE
          DISPLAY   *P1:18,"Started : ",CDATE,SP1,CTIMEIS:
                    *P1:20,"Record : "
          GOTO      PREP9999
.
PREP5000  DISPLAY   *P1:24,*EL,*B,"Master file not found.  ";
          CALL      HITENTER
          GOTO      PREP9000
.
PREP6000  DISPLAY   *P1:24,*EL,*B,"Master Visit file not found.  ";
          CALL      HITENTER
          GOTO      PREP9000
.
PREP7000  DISPLAY   *P1:24,*EL,*B,"Patient Master file not found.  ";
          CALL      HITENTER
          GOTO      PREP9000
.
PREP8000  DISPLAY   *P1:24,*EL,*B,"Patient Master Extn file not found.  ";
          CALL      HITENTER
          GOTO      PREP9000
.
PREP8500  DISPLAY   *P1:24,*EL,*B,"Patient Master Extn file not found.  ";
          CALL      HITENTER
          GOTO      PREP9000
.
PREP9000  MOVE      ONE,EXIT
PREP9999  RETURN
+
.**********************************************************************
.*                               READ0000                             *
.*             loop thru old file                                     *
.**********************************************************************
READ0000  DISPLAY   *P1:20,*EL,"Record No. : ";
          PACK      KEY8,SP60
          CALL      RDSVISA1                      * position at start
READ1000  CALL      RDKVISA1                      * read next record
          BRANCH    OVRCD,READ6000                * no more records
.
          PACK      KEY8,PVIBILL,SP70
          CALL      RAPMVX11
          COMPARE   ZERO,OVRCD
          GOTO      READ1000 IF EQUAL
.
          ADD       ONE,RECNUM                    * update record counter
.
          PACK      KEY8,PVIURNO,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            MOVE     SP70,PPOST
          ENDIF
.
          BRANCH    PVITYPE,READ2000,READ2000,READ3000,READ2000,READ2000:
                            READ2000,READ2000,READ2000,READ2000,READ2000
.
READ2000  MOVE      PVIBILL,PMVXVISN * Visit Number
          MOVE      PVIDATE,PMVXVSDT  * Visit Date      
          MOVE      SP70,PMVXDOCA     * Attending Doctor
          MOVE      SP70,PMVXDOCT     * treating Doctor
          MOVE      "0",PMVXCSNR      * Consent relese info
          MOVE      PPOST,PMVXPOST    * Post Code
          MOVE      SP70,PMVXPIND     * Privacy Indicator (Cat PV)
          MOVE      SP70,PMVXVLOC     * Valuables Location
          MOVE      SP70,PMVXCFSG     * Claim Form Signed (0=NO,1=YES)
          MOVE      SP70,PMVXINGP     * Inform Registered GP (0=NO,1=YES)
          MOVE      SP70,PMVXCPTH     * Critical Pathway (Cat PW)
          MOVE      SP70,PMVXHCP1     * Notify HCP1 (0=NO,1=YES)
          MOVE      SP70,PMVXHCP2     * Notify HCP2 (0=NO,1=YES)
          MOVE      SP70,PMVXHCP3     * Notify HCP3 (0=NO,1=YES)
          MOVE      SP70,PMVXHCP4     * Notify HCP4 (0=NO,1=YES)
          MOVE      SP70,PMVXRHC1     * Referring HCP 1 (pmshcpaf)
          MOVE      SP70,PMVXRH1G     * Referring HCP 1 Group (pmshcgaf)
          MOVE      SP70,PMVXRH1C     * Referring HCP 1 Grp Count (pmshclaf
          MOVE      SP70,PMVXRHC2     * Referring HCP 2 (pmshcpaf)
          MOVE      SP70,PMVXRH2G     * Referring HCP 2 Group (pmshcgaf)
          MOVE      SP70,PMVXRH2C     * Referring HCP 2 Grp Count (pmshclaf
          MOVE      SP70,PMVXRHC3     * Referring HCP 3 (pmshcpaf)
          MOVE      SP70,PMVXRH3G     * Referring HCP 3 Group (pmshcgaf)
          MOVE      SP70,PMVXRH3C     * Referring HCP 3 Grp Count (pmshclaf
          MOVE      SP70,PMVXRHC4     * Referring HCP 4 (pmshcpaf)
          MOVE      SP70,PMVXRH4G     * Referring HCP 4 Group (pmshcgaf)
          MOVE      SP70,PMVXRH4C     * Referring HCP 4 Grp Count (pmshclaf)
          MOVE      SP70,PMVXABRG     * Aboriginality (PRS/2) (Cat VA)
          MOVE      SP70,PMVXCADM     * Admission Criterion (PRS/2) (Cat VB)
          MOVE      SP70,PMVXIRAD     * Intent to Readmit (PRS/2) (Cat VR)
          MOVE      SP70,PMVXIDUS     * Intend Stay Duration (PRS/2)(Cat VI)
          MOVE      SP70,PMVXCRAV     * Carer Availability (PRS/2) (Cat VK)
          MOVE      SP70,PMVXRCCT     * Crit. Care Xfer Reason (PRS/2) (VJ)
          MOVE      SP70,PMVXAPWD     * Admitting Point Ward (patwr1af)
          MOVE      SP70,PMVXAPBD     * Admitting Point Bed (patwr1af)
          MOVE      SP70,PMVXPOWD     * Post-Op Ward (patwr1af)
          MOVE      SP70,PMVXPOBD     * Post-Op Bed (patwr1af)
          MOVE      SP70,PMVXPSTY     * Parent Staying (0=NO,1=YES)
          MOVE      SP70,PMVXVALW     * Visitor Allowed (0=NO,1=YES)
          MOVE      SP70,PMVXPALW     * Phone Calls Allowed? (0=NO,1=YES)
          MOVE      SP70,PMVXINDC     * Intended Day Case (0=NO,1=YES)
          MOVE      SP70,PMVXMDAV     * Mode of Arrival (Cat VM)
          MOVE      SP70,PMVXFRMS     * Forms (Cat VF)
          MOVE      SP70,PMVXCSNG     * Coder Snags (Cat VN)
          MOVE      ZERO,PMVXPWGT     * Patient Weight
          MOVE      ZERO,PMVXPHGT     * Patient Height
          MOVE      SP70,PMVXDHWR     * Date Height/Weight Record. ccyymmdd
          MOVE      SP70,PMVXEDC1     * Extra Doctor Code 1 (pmshcpaf)
          MOVE      SP70,PMVXEDC2     * Extra Doctor Code 2 (pmshcpaf)
          MOVE      SP70,PMVXEDC3     * Extra Doctor Code 3 (pmshcpaf)
          MOVE      SP70,PMVXHOME     * Homeless Person (0=NO,1=YES)
          MOVE      SP70,PMVXUDF1     * User Defined Free Format 1
          MOVE      SP70,PMVXUDF2     * User Defined Free Format 2
          MOVE      SP70,PMVXUDF3     * User Defined Free Format 3
          MOVE      SP70,PMVXUDF4     * User Defined Free Format 4
          MOVE      SP70,PMVXUDT1     * User Def. Date/Time 1 ccyymmddhh:mm
          MOVE      SP70,PMVXUDT2     * User Def. Date/Time 2 ccyymmddhh:mm
          MOVE      SP70,PMVXUDT3     * User Def. Date/Time 3 ccyymmddhh:mm
          MOVE      SP70,PMVXUDT4     * User Def. Date/Time 4 ccyymmddhh:mm
          MOVE      SP70,PMVXUDT5     * User Def. Date/Time 5 ccyymmddhh:mm
          MOVE      SP70,PMVXUDT6     * User Def. Date/time 6 ccyymmddhh:mm
          MOVE      SP70,PMVXCDTE     * Date record created (ccyymmdd)
          MOVE      SP70,PMVXCTIM     * Time record created (hh:mm:ss)
          MOVE      SP70,PMVXWEBC     * WEB User Id rec. creator (websecaf)
          MOVE      SP70,PMVXLUPD     * Last Update Date (ccyymmdd)
          MOVE      SP70,PMVXLUPT     * Last Update Time (hh:mm:ss)
          MOVE      SP70,PMVXWEBU     * WEB User Id rec. update (websecaf)
          MOVE      SP70,PMVXMHLS     * Mental health Legal Status        
          MOVE      SP70,PMVXPICD     * Provisional ICD10 Code
          MOVE      SP70,PMVXRMOR     * RMO Responsible Cat MO
          MOVE      SP70,PMVXASUT     * Admission Service Unit Type Cat KA
          MOVE      SP70,PMVXELPS     * Elective Patient Status Cat KC
          MOVE      SP70,PMVXEMPL     * Employment Status Cat KD
          MOVE      SP70,PMVXFINP     * Which Financial Program Cat KE
          MOVE      SP70,PMVXOCCP     * Occupation Cat KF
          MOVE      SP70,PMVXPALC     * Involvement in Palliat Care Cat KG
          MOVE      SP70,PMVXPPAL     * Prev Non-Admitt Palliat Care Cat KH
          MOVE      SP70,PMVXPPPT     * Public/Private Patients Cat KI 
          MOVE      SP70,PMVXPSOS     * Pension Status on Separation Cat KJ
          MOVE      SP70,PMVXPYSP     * Payment Status on Seraration Cat KK
          MOVE      SP70,PMVXQLDB     * Banding/Type of Episode for QLDHDP
          MOVE      SP70,PMVXREAD     * Re-Admission in 28 Days Cat KM
          MOVE      SP70,PMVXUDIN     * Unplanned Readmission Cat KO
          MOVE      SP70,PMVXUREA     * Discharge Intention Cat KN
          MOVE      SP70,PMVXUSAC     * Usual Accommodation Cat KP
          MOVE      SP70,PMVXUVTH     * Unplanned Visit to Theatre Cat KB
          MOVE      SP70,PMVXSPAR     * Spare Variable
.
          PACK      KEY8,PMVXVISN,SP70
          CALL      WRPMVX11
          GOTO      READ5000
.
READ3000  PACK      KEY8,DPVIBILL,SP70
          CALL      RDMISS1
          BRANCH    OVRCD,READ1000

          MOVE      PVIBILL,PMVXVISN  * Visit Number
          MOVE      PVIDATE,PMVXVSDT  * Visit Date      
          MOVE      SP70,PMVXDOCA     * Attending Doctor
          MOVE      SP70,PMVXDOCT     * treating Doctor
          MOVE      "0",PMVXCSNR      * Consent relese info
          MOVE      PPOST,PMVXPOST    * Post Code
          MOVE      SP70,PMVXPIND     * Privacy Indicator (Cat PV)
          MOVE      SP70,PMVXVLOC     * Valuables Location
          MOVE      SP70,PMVXCFSG     * Claim Form Signed (0=NO,1=YES)
          MOVE      SP70,PMVXINGP     * Inform Registered GP (0=NO,1=YES)
          MOVE      SP70,PMVXCPTH     * Critical Pathway (Cat PW)
          MOVE      SP70,PMVXHCP1     * Notify HCP1 (0=NO,1=YES)
          MOVE      SP70,PMVXHCP2     * Notify HCP2 (0=NO,1=YES)
          MOVE      SP70,PMVXHCP3     * Notify HCP3 (0=NO,1=YES)
          MOVE      SP70,PMVXHCP4     * Notify HCP4 (0=NO,1=YES)
          MOVE      SP70,PMVXRHC1     * Referring HCP 1 (pmshcpaf)
          MOVE      SP70,PMVXRH1G     * Referring HCP 1 Group (pmshcgaf)
          MOVE      SP70,PMVXRH1C     * Referring HCP 1 Grp Count (pmshclaf
          MOVE      SP70,PMVXRHC2     * Referring HCP 2 (pmshcpaf)
          MOVE      SP70,PMVXRH2G     * Referring HCP 2 Group (pmshcgaf)
          MOVE      SP70,PMVXRH2C     * Referring HCP 2 Grp Count (pmshclaf
          MOVE      SP70,PMVXRHC3     * Referring HCP 3 (pmshcpaf)
          MOVE      SP70,PMVXRH3G     * Referring HCP 3 Group (pmshcgaf)
          MOVE      SP70,PMVXRH3C     * Referring HCP 3 Grp Count (pmshclaf
          MOVE      SP70,PMVXRHC4     * Referring HCP 4 (pmshcpaf)
          MOVE      SP70,PMVXRH4G     * Referring HCP 4 Group (pmshcgaf)
          MOVE      SP70,PMVXRH4C     * Referring HCP 4 Grp Count (pmshclaf)
          MOVE      SP70,PMVXABRG     * Aboriginality (PRS/2) (Cat VA)
          MOVE      SP70,PMVXCADM     * Admission Criterion (PRS/2) (Cat VB)
          MOVE      SP70,PMVXIRAD     * Intent to Readmit (PRS/2) (Cat VR)
          MOVE      SP70,PMVXIDUS     * Intend Stay Duration (PRS/2)(Cat VI)
          MOVE      SP70,PMVXCRAV     * Carer Availability (PRS/2) (Cat VK)
          MOVE      SP70,PMVXRCCT     * Crit. Care Xfer Reason (PRS/2) (VJ)
          MOVE      SP70,PMVXAPWD     * Admitting Point Ward (patwr1af)
          MOVE      SP70,PMVXAPBD     * Admitting Point Bed (patwr1af)
          MOVE      SP70,PMVXPOWD     * Post-Op Ward (patwr1af)
          MOVE      SP70,PMVXPOBD     * Post-Op Bed (patwr1af)
          MOVE      SP70,PMVXPSTY     * Parent Staying (0=NO,1=YES)
          MOVE      SP70,PMVXVALW     * Visitor Allowed (0=NO,1=YES)
          MOVE      SP70,PMVXPALW     * Phone Calls Allowed? (0=NO,1=YES)
          MOVE      SP70,PMVXINDC     * Intended Day Case (0=NO,1=YES)
          MOVE      SP70,PMVXMDAV     * Mode of Arrival (Cat VM)
          MOVE      SP70,PMVXFRMS     * Forms (Cat VF)
          MOVE      SP70,PMVXCSNG     * Coder Snags (Cat VN)
          MOVE      ABWGHT,PMVXPWGT   * Patient Weight
          MOVE      ZERO,PMVXPHGT     * Patient Height
          MOVE      SP70,PMVXDHWR     * Date Height/Weight Record. ccyymmdd
          MOVE      SP70,PMVXEDC1     * Extra Doctor Code 1 (pmshcpaf)
          MOVE      SP70,PMVXEDC2     * Extra Doctor Code 2 (pmshcpaf)
          MOVE      SP70,PMVXEDC3     * Extra Doctor Code 3 (pmshcpaf)
          MOVE      SP70,PMVXHOME     * Homeless Person (0=NO,1=YES)
          MOVE      SP70,PMVXUDF1     * User Defined Free Format 1
          MOVE      SP70,PMVXUDF2     * User Defined Free Format 2
          MOVE      SP70,PMVXUDF3     * User Defined Free Format 3
          MOVE      SP70,PMVXUDF4     * User Defined Free Format 4
          MOVE      SP70,PMVXUDT1     * User Def. Date/Time 1 ccyymmddhh:mm
          MOVE      SP70,PMVXUDT2     * User Def. Date/Time 2 ccyymmddhh:mm
          MOVE      SP70,PMVXUDT3     * User Def. Date/Time 3 ccyymmddhh:mm
          MOVE      SP70,PMVXUDT4     * User Def. Date/Time 4 ccyymmddhh:mm
          MOVE      SP70,PMVXUDT5     * User Def. Date/Time 5 ccyymmddhh:mm
          MOVE      SP70,PMVXUDT6     * User Def. Date/time 6 ccyymmddhh:mm
          MOVE      SP70,PMVXCDTE     * Date record created (ccyymmdd)
          MOVE      SP70,PMVXCTIM     * Time record created (hh:mm:ss)
          MOVE      SP70,PMVXWEBC     * WEB User Id rec. creator (websecaf)
          MOVE      SP70,PMVXLUPD     * Last Update Date (ccyymmdd)
          MOVE      SP70,PMVXLUPT     * Last Update Time (hh:mm:ss)
          MOVE      SP70,PMVXWEBU     * WEB User Id rec. update (websecaf)
          MOVE      SP70,PMVXMHLS     * Mental health Legal Status        
          MOVE      SP70,PMVXPICD     * Provisional ICD10 Code
          MOVE      SP70,PMVXRMOR     * RMO Responsible Cat MO
          MOVE      SP70,PMVXASUT     * Admission Service Unit Type Cat KA
          MOVE      SP70,PMVXELPS     * Elective Patient Status Cat KC
          MOVE      SP70,PMVXEMPL     * Employment Status Cat KD
          MOVE      SP70,PMVXFINP     * Which Financial Program Cat KE
          MOVE      SP70,PMVXOCCP     * Occupation Cat KF
          MOVE      SP70,PMVXPALC     * Involvement in Palliat Care Cat KG
          MOVE      SP70,PMVXPPAL     * Prev Non-Admitt Palliat Care Cat KH
          MOVE      SP70,PMVXPPPT     * Public/Private Patients Cat KI
          MOVE      SP70,PMVXPSOS     * Pension Status on Separation Cat KJ
          MOVE      SP70,PMVXPYSP     * Payment Status on Seraration Cat KK
          MOVE      SP70,PMVXQLDB     * Banding/Type of Episode for QLDHDP
          MOVE      SP70,PMVXREAD     * Re-Admission in 28 Days Cat KM
          MOVE      SP70,PMVXUDIN     * Unplanned Readmission Cat KO
          MOVE      SP70,PMVXUREA     * Discharge Intention Cat KN
          MOVE      SP70,PMVXUSAC     * Usual Accommodation Cat KP
          MOVE      SP70,PMVXUVTH     * Unplanned Visit to Theatre Cat KB
          MOVE      SP70,PMVXSPAR     * Spare Variable
.
          PACK      KEY8,PMVXVISN,SP70
          CALL      WRPMVX11
.
READ5000  IF        (RECNUM%1000) = 0
            DISPLAY   *P15:20,*V2LON,RECNUM
          ENDIF
.
          GOTO      READ1000                      * get next record
.
READ6000  CALL      IBACLOCK
          REP       " 0",CDATE
          DISPLAY   *P1:22,"Ended  : ",CDATE,SP1,CTIMEIS
.
READ9999  RETURN
+
.**********************************************************************
.*                               VALD0000                             *
.*        Check if it a valid directory                               *
.**********************************************************************
VALD0000  MOVE      ZERO,EXIT
          SQUEEZE   DIM60
          ENDSET    DIM60
          CMATCH    SLASH,DIM60
          IF        !@EQUAL
            DISPLAY   *P1:24,*EL,*B,"Directory path must end with a slash (/) ";
            CALL      HITENTER
            GOTO      VALD9000
          ENDIF
          RESET     DIM60
.
          PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          APPEND    "cd ",CMDLINE
          APPEND    DIM60,CMDLINE
          APPEND    SP60,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID      * check if exists
.
          CMATCH    "0",TASKID
          IF        !@EQUAL
            DISPLAY   *P1:24,*EL,*B,"Directory does not exist ";
            CALL      HITENTER
            GOTO      VALD9000
          ENDIF
          GOTO      VALD9999
.
VALD9000  MOVE      ONE,EXIT            * Not valid
VALD9999  RETURN
+
.**********************************************************************
.*                               ENDP0000                             *
.**********************************************************************
ENDP0000  CALL      IBACLOCK
          DISPLAY   *P1:24,*EL,*B,"Finish processing.  ";
          CALL      HITENTER
.
ENDP9999  RETURN
+
.**********************************************************************
.         Get the default directory
.**********************************************************************
DEFT0000  EXECUTE   "ldat patmi1af.dat > temp.txt",TASKID
.
          PACK      DEFPATH,SP30,SP30
          CLOSE     FINDFILE
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      FINDFILE,"temp"
          TRAPCLR   IO
          BRANCH    OVRCD,DEFT3000
.
          READ      FINDFILE,SEQ;DEFPATH
          GOTO      DEFT3000 IF OVER
.
          ENDSET    DEFPATH
DEFT1000  CMATCH    "/",DEFPATH
          GOTO      DEFT2000 IF EQUAL
.
          BUMP      DEFPATH,-1
          GOTO      DEFT1000 IF NOT EOS
          GOTO      DEFT3000
.
DEFT2000  LENSET    DEFPATH
          RESET     DEFPATH
.
          PACK      DEFPATH,DEFPATH,SP30,SP30,SP30,SP30
          STRIP     DEFPATH
          ENDSET    DEFPATH
          RESET     DEFPATH
          CLOSE     FINDFILE
          MOVE      ZERO,EXIT
          GOTO      DEFT9999
.
DEFT3000  DISPLAY   *P1:24,*EL,*B,"Error finding patmi1af.  ";
          CALL      HITENTER
          CLOSE     FINDFILE
          MOVE      ONE,EXIT
DEFT9999  RETURN
+
          INC       PATMI1IO/INC
          INC       PATVISIO/INC
          INC       PMSVX1IO/INC
          INC       PATMA1IO/INC
          INC       STD001IO

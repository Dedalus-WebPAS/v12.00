. **********************************************************************
. * System    :   Accounting System                                    *
. * Program   :   IBAAPS73                                             *
. * Desc      :   Copy Report Sequence                                 *
. * Mods      :                                                        *
. **********************************************************************
. * V9.02.00  03.05.2002 Glenn Saunders                                *
. *           Export to new release i.e. v9.02 from vf.09              *
. **********************************************************************
. * VF.00.02  23.12.1999 Sandra Barcham                                *
. *           Recompiled for FMSCCAFD                                  *
. *           srf 646145                                               *
. * VF.00.01  30.06.1999 Sandra Barcham                                *
. *           Recompiled for FMSLEVKY                                  *
. *           srf 632475                                               *
. * VF.00.00  18.01.1999 Sandra Barcham                                *
. *           Copy of IBAFMS92 with only copy Report Sequence          *
. **********************************************************************
.
          INC       FMSSTDDF
.
          INC       FMSAMAFD/INC
          INC       FMSCONFD/INC
          INC       FMSLMAFD/INC
          INC       FMSLMBFD/INC
          INC       FMSLMCFD/INC
          INC       FMSLMDFD/INC
          INC       FMSLEVFD/INC
          INC       FMSCAFFD/INC
          INC       FMSCCAFD/INC
          INC       FMSRSFFD/INC
          INC       FMSSBAFD/INC
          INC       FMSSSCFD/INC
          INC       FMSTCFFD/INC
          INC       FMSUWPFD/INC
          INC       FMSXCSFD/INC
.
ACCLEVEL  DIM       3
ACLVDESC  DIM       35
ADDLEDFL  FORM      1
.
DIRFLAG   FORM      1
DM12     DIM       12
.
FINISH    INIT      "Finish"
FIRSTFLG  FORM      1
FROMACCT  DIM       12
FROMDESC  DIM       35
FROMLED   DIM       2
FROMLEV   DIM       3
FROMSUB   DIM       12
FROMCST   DIM       12
FROMPOS   DIM       5
FROMREPT DIM       2
.
ITEM      FORM      1
.
LEDGDESC  DIM       35
LEDGER    DIM       2
.
NEWLEDG   DIM       2
NLEDDESC  DIM       35
.
START     INIT      "Start"
.
TOSUB     DIM       12
TOCST     DIM       12
TOACCT    DIM       12
TODESC    DIM       35
TOLED     DIM       2
TOLEV     DIM       3
TOPOS     DIM       5
TOREPT   DIM       2
.
VALIDFLG  FORM      1
.
Z12       INIT      "zzzzzzzzzzzzz"
COSTCODE  DIM       12
SUBJCODE  DIM       12
ACCOUNT   DIM       12
.
PRGID     INIT      "IBAAPS73"
PRGNAM    INIT      "Copy Report Sequence" 
VERSION   INIT      "V12.00.00"
.
.**********************************************************************
.*                           ML0000                                   *
.*                       Mainline  Code                               *
.**********************************************************************
.
ML0000    CALL      INIT0000             * initialisation
.
ML6000    CALL      CPRSF000             * Copy Report Details
.
ML9999    CHAIN     PGM
.
.*********************************************************************
.*                          INIT0000                                 *
.*                     initialisation                                *
.*********************************************************************
.
INIT0000  CALL      DISPHEAD
.
          DISPLAY   *P56:24,"Opening fmsamaaf";
          OPEN      FMSAMAA1,"fmsamaaf"  * account master file
          OPEN      FMSAMAA2,"fmsamaaf"
          OPEN      FMSAMAA3,"fmsamaaf"
.
          DISPLAY   *P64:24,"fmslmaaf";
          OPEN      FMSLMAA1,"fmslmaaf"  * ledger master file
.
          DISPLAY   *P64:24,"fmslmbaf";
          OPEN      FMSLMBA1,"fmslmbaf"  * ledger calender control file
.
          DISPLAY   *P64:24,"fmslmcaf";
          OPEN      FMSLMCA1,"fmslmcaf"  * ledger calender control file
.
          DISPLAY   *P64:24,"fmslmdaf";
          OPEN      FMSLMDA1,"fmslmdaf"  * ledger word processing file 
.
          DISPLAY   *P64:24,"fmsrsfaf";
          OPEN      FMSRSFA1,"fmsrsfaf"  * report sequence file        
          OPEN      FMSRSFA2,"fmsrsfaf"  * report sequence file        
.
          DISPLAY   *P64:24,"fmstcfaf";
          OPEN      FMSTCFA1,"fmstcfaf"  * total calculation file      
          OPEN      FMSTCFA2,"fmstcfaf"  * total calculation file      
.
          DISPLAY   *P64:24,"fmsuwpaf";
          OPEN      FMSUWPA1,"fmsuwpaf"  * user defined word processing
.
          DISPLAY   *P64:24,"fmscafaf";
          OPEN      FMSCAFA1,"fmscafaf"  * control account file            
.
          DISPLAY   *P64:24,"fmsccaaf";
          OPEN      FMSCCAA1,"fmsccaaf"  * cost centre file            
.
          DISPLAY   *P64:24,"fmssbaaf";
          OPEN      FMSSBAA1,"fmssbaaf"  * subjective file             
.
          DISPLAY   *P64:24,"fmslevaf";
          OPEN      FMSLEVA1,"fmslevaf"
.
          DISPLAY   *P64:24,"fmssscaf";
          OPEN      FMSSSCA1,"fmssscaf"
          OPEN      FMSSSCA2,"fmssscaf"
.
          DISPLAY   *P64:24,"fmsxcsaf";
          OPEN      FMSXCSA1,"fmsxcsaf"
          OPEN      FMSXCSA2,"fmsxcsaf"
.
          DISPLAY   *P64:24,"controlf";  * control file
          OPEN      CONTROLF,"controlf"
          CALL      RDFMCO51
          CALL      RDFMCO52
.
INIT9999  RETURN
.------------------------------------------------------------
. Copy Report Sequence 
.------------------------------------------------------------
CPRSF000  CALL      GETREP00
          BRANCH    EXIT,CPRSF999
          CALL      GETLED00
          CALL      GETSEQ00
          CALL      GETLEV00
          CALL      GETSUB00
          CALL      GETCST00
.
CPRSF200  KEYIN     *P1:24,*EL,"Ok to Continue (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,ANS
          REP       UPPLOW,ANS
          MATCH     ANSN,ANS
          GOTO      CPRSF999 IF EQUAL
          MATCH     ANSY,ANS
          GOTO      CPRSF200 IF NOT EQUAL
.
          PACK      KEY26,FROMREPT,FROMPOS,SP70
          CALL      RSFMRF1
CPRSF300  CALL      RKFMRF1
          BRANCH    OVRCD,CPRSF400
          MATCH     FROMREPT,FMRFREP
          GOTO      CPRSF400 IF NOT EQUAL
.
          MATCH     FMRFPOS,TOPOS
          GOTO      CPRSF400 IF LESS
.
          MATCH     FROMLED,FMRFLED
          GOTO      CPRSF300 IF LESS
          MATCH     FMRFLED,TOLED
          GOTO      CPRSF300 IF LESS
.
          CALL      CHKCS000       * Check Cost Centre & Subjective
          BRANCH    EXIT,CPRSF300
.
          PACK      KEY14,FMRFLED,FMRFACC
          CALL      RDFMAM1
          BRANCH    OVRCD,CPRSF300
.
          MATCH     FROMLEV,FMAMCLEV
          GOTO      CPRSF300 IF LESS
          MATCH     FMAMCLEV,TOLEV
          GOTO      CPRSF300 IF LESS
.
          MOVE      TOREPT,FMRFREP
          PACK      KEY26,FMRFREP,FMRFPOS,FMRFSEQ,FMRFLED,FMRFACC
          CALL      RAFMRF1
          IF        OVRCD=1 
            CALL      WRFMRF1
          ENDIF
          PACK      KEY26,FROMREPT,FMRFPOS,FMRFSEQ,FMRFLED,FMRFACC
          CALL      RDFMRF1
          GOTO      CPRSF300
.
CPRSF400  DISPLAY   *P1:24,"Copy Complete - ";
          CALL      HITENTER
.
CPRSF999  RETURN
.------------------------------------------------------------
. Check Cost Centre & Subjective Range Exit 0=Ok 1=Out of Range
.------------------------------------------------------------
CHKCS000  MOVE      FMRFACC,ACCOUNT
          CALL      GCOD0000
          MATCH     FROMCST,COSTCODE
          GOTO      CHKCS900 IF LESS
          MATCH     COSTCODE,TOCST
          GOTO      CHKCS900 IF LESS
          MATCH     FROMSUB,SUBJCODE
          GOTO      CHKCS900 IF LESS
          MATCH     SUBJCODE,TOSUB
          GOTO      CHKCS900 IF LESS
          MOVE      ZERO,EXIT
          GOTO      CHKCS999
CHKCS900  MOVE      ONE,EXIT
CHKCS999  RETURN
.------------------------------------------------------------
. Get Report Code
.------------------------------------------------------------
GETREP00  DISPLAY   *P1:3,*EF
          KEYIN     *P1:4,"Copy From Report Code : ",FROMREPT
          ENDSET    FROMREPT
          APPEND    SP70,FROMREPT
          RESET     FROMREPT
          MATCH     SP70,FROMREPT
          GOTO      GETREP90 IF EQUAL
          MOVE      FROMREPT,KEY2
          CALL      RDFMLB1
          IF        OVRCD=1
            BEEP
            DISPLAY   *P1:24,"Invalid Report Code - ";
            CALL      HITENTER
            GOTO      GETREP00
          ENDIF
          DISPLAY   *P1:4,"Copy From Report Code : ",FMLBRPNO,SP1,FMLBDESC
.
GETREP10  KEYIN     *P1:5,*EL,"Copy To   Report Code : ",TOREPT
          ENDSET    TOREPT
          APPEND    SP70,TOREPT
          RESET     TOREPT
          MATCH     SP70,TOREPT
          GOTO      GETREP00 IF EQUAL
          MOVE      TOREPT,KEY2
          CALL      RDFMLB1
          IF        OVRCD=1
            BEEP
            DISPLAY   *P1:24,"Invalid Report Code - ";
            CALL      HITENTER
            GOTO      GETREP10
          ENDIF
          DISPLAY   *P1:5,"Copy To   Report Code : ",FMLBRPNO,SP1,FMLBDESC
          MOVE      ZERO,EXIT
          MATCH     FROMREPT,TOREPT
          GOTO      GETREP99 IF NOT EQUAL
          BEEP
          DISPLAY   *P1:24,"Invalid Same as From Code - ";
          CALL      HITENTER
          GOTO      GETREP10
GETREP90  MOVE      ONE,EXIT
GETREP99  RETURN
.------------------------------------------------------------
. Get Ledger Range
.------------------------------------------------------------
GETLED00  KEYIN     *P1:6,*EL,"Ledger           From : ",*JR,*ZF,FROMLED
          ENDSET    FROMLED
          APPEND    SP70,FROMLED
          RESET     FROMLED
          MATCH     "00",FROMLED
          IF        @EQUAL
            MOVE      SP70,FROMLED
          ENDIF
          MATCH     SP70,FROMLED
          IF        !@EQUAL
            MOVE      FROMLED,KEY2
            CALL      RDFMLA1
            BRANCH    OVRCD,GETLED00
            DISPLAY   *P1:6,*EL,"Ledger           From : ",FROMLED,SP1,FMLADESC
          ELSE
            DISPLAY   *P1:6,*EL,"Ledger           From : Start"
          ENDIF
GETLED10  KEYIN     *P1:7,*EL,"                 To   : ",*JR,*ZF,TOLED
          ENDSET    TOLED
          APPEND    SP70,TOLED
          RESET     TOLED
          MATCH     "00",TOLED
          IF        @EQUAL
            MOVE      SP70,TOLED
          ENDIF
          MATCH     SP70,TOLED
          IF        !@EQUAL
            MOVE      TOLED,KEY2
            CALL      RDFMLA1
            BRANCH    OVRCD,GETLED10
            DISPLAY   *P1:7,*EL,"                 To   : ",TOLED,SP1,FMLADESC
          ELSE
            MOVE      Z70,TOLED
            DISPLAY   *P1:7,*EL,"                 To   : Finish"
          ENDIF
          RETURN
.------------------------------------------------------------
. Get Position Range
.------------------------------------------------------------
GETSEQ00  KEYIN     *P1:8,*EL,"Print Position   From : ",*JR,*ZF,FROMPOS
          ENDSET    FROMPOS
          APPEND    SP70,FROMPOS
          RESET     FROMPOS
          MATCH     "00000",FROMPOS
          IF        @EQUAL
            MOVE      SP70,FROMPOS
          ENDIF
          MATCH     SP70,FROMPOS
          IF        !@EQUAL
            DISPLAY   *P1:8,*EL,"Print Position   From : ",FROMPOS
          ELSE
            DISPLAY   *P1:8,*EL,"Print Position   From : Start"
          ENDIF
GETSEQ10  KEYIN     *P1:9,*EL,"                 To   : ",*JR,*ZF,TOPOS
          ENDSET    TOPOS
          APPEND    SP70,TOPOS
          RESET     TOPOS
          MATCH     "00",TOPOS
          IF        @EQUAL
            MOVE      SP70,TOPOS
          ENDIF
          MATCH     SP70,TOPOS
          IF        !@EQUAL
            DISPLAY   *P1:9,*EL,"                 To   : ",TOPOS
          ELSE
            DISPLAY   *P1:9,*EL,"                 To   : Finish"
            MOVE      Z70,TOPOS
          ENDIF
          RETURN
.------------------------------------------------------------
. Get Level Range
.------------------------------------------------------------
GETLEV00  MOVE      SP70,FROMLEV
          KEYIN     *P1:10,*EL,"Report Level     From : ",*JR,*ZF,FROMLEV
          ENDSET    FROMLEV
          APPEND    SP70,FROMLEV
          RESET     FROMLEV
          MATCH     "000",FROMLEV
          IF        @EQUAL
            MOVE      SP70,FROMLEV
          ENDIF
          MATCH     SP70,FROMLEV
          IF        !@EQUAL
            MOVE      FROMLEV,KEY3
            CALL      RDFMLV1
            BRANCH    OVRCD,GETLEV00
            DISPLAY   *P1:10,*EL,"Report Level     From : ",FROMLEV,SP1,FMLVDESC
          ELSE
            DISPLAY   *P1:10,*EL,"Report Level     From : Start"
          ENDIF
GETLEV10  KEYIN     *P1:11,*EL,"                 To   : ",*JR,*ZF,TOLEV
          ENDSET    TOLEV
          APPEND    SP70,TOLEV
          RESET     TOLEV
          MATCH     "000",TOLEV
          IF        @EQUAL
            MOVE      SP70,TOLEV
          ENDIF
          MATCH     SP70,TOLEV
          IF        !@EQUAL
            MOVE      TOLEV,KEY3
            CALL      RDFMLV1
            BRANCH    OVRCD,GETLEV10
            DISPLAY   *P1:11,*EL,"                 To   : ",TOLEV,SP1,FMLVDESC
          ELSE
            MOVE      Z70,TOLEV
            DISPLAY   *P1:11,*EL,"                 To   : Finish"
          ENDIF
          RETURN
.
          INC       FMSSTDCD
          INC       FMSAMAIO/INC
          INC       FMSLEVIO/INC
          INC       FMSLMAIO/INC
          INC       FMSLMBIO/INC
          INC       FMSCONIO/INC
          INC       FMSSBAIO/INC
          INC       FMSCAFIO/INC
          INC       FMSCCAIO/INC
          INC       FMSSSCIO/INC
          INC       FMSUWPIO/INC
          INC       FMSTCFIO/INC
          INC       FMSRSFIO/INC
          INC       FMSLMDIO/INC
          INC       FMSLMCIO/INC
          INC       FMSXCSIO/INC
          INC       FMSAMAKY
          INC       FMSLMAKY
          INC       FMSLEVKY
.
.------------------------------------------------------------
. Get Subjective Range
.------------------------------------------------------------
GETSUB00  MATCH     SP70,FROMLED
          GOTO      GETSUB90 IF EQUAL
.
          MOVE      SP70,FROMSUB
          KEYIN     *P1:12,*EL,"Report Subjective From: ",FROMSUB
          ENDSET    FROMSUB
          APPEND    SP70,FROMSUB
          RESET     FROMSUB
          MATCH     SP70,FROMSUB
          IF        !@EQUAL
            PACK      KEY14,FROMLED,FROMSUB,SP70
            CALL      RDFMSA1
            BRANCH    OVRCD,GETSUB00
            DISPLAY   *P1:12,*EL,"Report Subjective From: ",FROMSUB,SP1,FMSADESC
          ELSE
            DISPLAY   *P1:12,*EL,"Report Subjective From: Start"
          ENDIF
GETSUB10  KEYIN     *P1:13,*EL,"                  To  : ",TOSUB
          ENDSET    TOSUB
          APPEND    SP70,TOSUB
          RESET     TOSUB
          MATCH     SP70,TOSUB
          IF        !@EQUAL
            PACK      KEY14,FROMLED,TOSUB,SP70
            CALL      RDFMSA1
            BRANCH    OVRCD,GETSUB10
            DISPLAY   *P1:13,*EL,"                  To  : ",TOSUB,SP1,FMSADESC
          ELSE
            MOVE      Z70,TOSUB
            DISPLAY   *P1:13,*EL,"                  To  : Finish"
          ENDIF
          GOTO      GETSUB99
.
GETSUB90  MOVE      SP70,FROMSUB
          MOVE      Z70,TOSUB
          DISPLAY   *P1:12,*EL,"Report Subjective From: Start"
          DISPLAY   *P1:13,*EL,"                  To  : Finish"
.
GETSUB99  RETURN
.
.------------------------------------------------------------
. Get Subjective Range
.------------------------------------------------------------
GETCST00  MATCH     SP70,FROMLED
          GOTO      GETCST90 IF EQUAL
.
          MOVE      SP70,FROMCST
          KEYIN     *P1:14,*EL,"Report Cost Cent. From: ",FROMCST
          ENDSET    FROMCST
          APPEND    SP70,FROMCST
          RESET     FROMCST
          MATCH     SP70,FROMCST
          IF        !@EQUAL
            PACK      KEY14,FROMLED,FROMCST,SP70
            CALL      RDFMCC1
            BRANCH    OVRCD,GETCST00
            DISPLAY   *P1:14,*EL,"Report Cost Cent. From: ",FROMCST,SP1,FMCCDESC
          ELSE
            DISPLAY   *P1:14,*EL,"Report Cost Cent. From: Start"
          ENDIF
GETCST10  KEYIN     *P1:15,*EL,"                  To  : ",TOCST
          ENDSET    TOCST
          APPEND    SP70,TOCST
          RESET     TOCST
          MATCH     SP70,TOCST
          IF        !@EQUAL
            PACK      KEY14,FROMLED,TOCST,SP70
            CALL      RDFMCC1
            BRANCH    OVRCD,GETCST10
            DISPLAY   *P1:15,*EL,"                  To  : ",TOCST,SP1,FMCCDESC
          ELSE
            MOVE      Z70,TOCST
            DISPLAY   *P1:15,*EL,"                  To  : Finish"
          ENDIF
          GOTO      GETCST99
.
GETCST90  MOVE      SP70,FROMCST
          MOVE      Z70,TOCST
          DISPLAY   *P1:14,*EL,"Report Cost Cent. From: Start"
          DISPLAY   *P1:15,*EL,"                  To  : Finish"
.
GETCST99  RETURN
.
.****************************************************************************
.  GCOD - get subjective and cost codes from account code    Called by lots
.        Requires - ACCOUNT   (account code)
.                   FMSUUD2A  (separate CC/Subj 1=yes)
.                   FMSUUD4A  (cost centre code length)
.        Returns  - SUBJCODE  (subjective code)
.                   COSTCODE  (cost centre code)
.****************************************************************************
GCOD0000  UNPACK    SP70,SUBJCODE,COSTCODE       * clear old vars
          BRANCH    FMSUUD4A,GCOD0100,GCOD0200,GCOD0300,GCOD0400:
                             GCOD0500,GCOD0600,GCOD0700,GCOD0800:
                             GCOD0900,GCOD1000,GCOD1100,GCOD1200
.
GCOD0100  BRANCH    FMSUUD2A,GCOD0110
          UNPACK    ACCOUNT,KEY1,SUBJCODE
          GOTO      GCOD90000
.
GCOD0110  UNPACK    ACCOUNT,KEY1,ANS,SUBJCODE
          GOTO      GCOD90000
.
GCOD0200  BRANCH    FMSUUD2A,GCOD0210
          UNPACK    ACCOUNT,KEY2,SUBJCODE
          GOTO      GCOD90000
.
GCOD0210  UNPACK    ACCOUNT,KEY2,ANS,SUBJCODE
          GOTO      GCOD90000
.
GCOD0300  BRANCH    FMSUUD2A,GCOD0310
          UNPACK    ACCOUNT,KEY3,SUBJCODE
          GOTO      GCOD90000
.
GCOD0310  UNPACK    ACCOUNT,KEY3,ANS,SUBJCODE
          GOTO      GCOD90000
.
GCOD0400  BRANCH    FMSUUD2A,GCOD0410
          UNPACK    ACCOUNT,KEY4,SUBJCODE
          GOTO      GCOD90000
.
GCOD0410  UNPACK    ACCOUNT,KEY4,ANS,SUBJCODE
          GOTO      GCOD90000
.
GCOD0500  BRANCH    FMSUUD2A,GCOD0510
          UNPACK    ACCOUNT,KEY5,SUBJCODE
          GOTO      GCOD90000
.
GCOD0510  UNPACK    ACCOUNT,KEY5,ANS,SUBJCODE
          GOTO      GCOD90000
.
GCOD0600  BRANCH    FMSUUD2A,GCOD0610
          UNPACK    ACCOUNT,KEY6,SUBJCODE
          GOTO      GCOD90000
.
GCOD0610  UNPACK    ACCOUNT,KEY6,ANS,SUBJCODE
          GOTO      GCOD90000
.
GCOD0700  BRANCH    FMSUUD2A,GCOD0710
          UNPACK    ACCOUNT,KEY7,SUBJCODE
          GOTO      GCOD90000
.
GCOD0710  UNPACK    ACCOUNT,KEY7,ANS,SUBJCODE
          GOTO      GCOD90000
.
GCOD0800  BRANCH    FMSUUD2A,GCOD0810
          UNPACK    ACCOUNT,KEY8,SUBJCODE
          GOTO      GCOD90000
.
GCOD0810  UNPACK    ACCOUNT,KEY8,ANS,SUBJCODE
          GOTO      GCOD90000
.
GCOD0900  BRANCH    FMSUUD2A,GCOD0910
          UNPACK    ACCOUNT,KEY9,SUBJCODE
          GOTO      GCOD90000
.
GCOD0910  UNPACK    ACCOUNT,KEY9,ANS,SUBJCODE
          GOTO      GCOD90000
.
GCOD1000  BRANCH    FMSUUD2A,GCOD1010
          UNPACK    ACCOUNT,KEY10,SUBJCODE
          GOTO      GCOD90000
.
GCOD1010  UNPACK    ACCOUNT,KEY10,ANS,SUBJCODE
          GOTO      GCOD90000
.
GCOD1100  BRANCH    FMSUUD2A,GCOD1110
          UNPACK    ACCOUNT,KEY11,SUBJCODE
          GOTO      GCOD90000
.
GCOD1110  UNPACK    ACCOUNT,KEY11,ANS,SUBJCODE
          GOTO      GCOD90000
.
GCOD1200  BRANCH    FMSUUD2A,GCOD1210
          UNPACK    ACCOUNT,KEY12,SUBJCODE
          GOTO      GCOD90000
.
GCOD1210  UNPACK    ACCOUNT,KEY12,ANS,SUBJCODE
          GOTO      GCOD90000
.
GCOD9000  LOAD      COSTCODE,FMSUUD4A,KEY1,KEY1,KEY1,KEY1:
                                      KEY5,KEY6,KEY7,KEY8:
                                      KEY9,KEY10,KEY11,KEY12
          PACK      SUBJCODE,SUBJCODE,SP70
          PACK      COSTCODE,COSTCODE,SP70
.
GCOD9999  RETURN

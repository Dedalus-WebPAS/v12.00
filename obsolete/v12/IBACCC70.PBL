.******************************************************************************
.* System    :   CIAS                                                         *
.* Program   :   IBACCC70                                                     *
.* Desc      :   CIAS patient data interface functions                        *
.******************************************************************************
.* Date      :   05/01/2004                                                   *
.* Author    :   Ebon Clements                                                *
.* Function  :   This program contains the standard CIAS patient              *
.*               data interface functions                                     *
.******************************************************************************
.*        V11.05.01 26/03/2025  Davin          TSK 0956210                    *
.*                  Added DRG Version 12.0 (EDRG0000)                         *
.******************************************************************************
.*        V11.03.01 20.03.2023  DASarkies      TSK 0909393                    *
.*                  Added hospital name as key to theatre booking             *
.******************************************************************************
.*        V11.02.01 20/04/2022  Davin          TSK 0917793                    *
.*                  Added DRG Version 11.0 (EDRG0000)                         *
.******************************************************************************
.*        V11.01.03 05/05/2021  Ebon Clements  TSK 0902615                    *
.*                  Added read of NWAU parameters MRCNUNWA and MRCNENWA       *
.*        V11.01.02 27/04/2021  Thanh T        TSK 0895165                    *
.*                  Recompiled for OPRARDFD changes                           *
.*        V11.01.01 17/02/2021  Tracey Nguyen  TSK 0888639                    *
.*                  Recompiled for PATMMBFD changes                           *
.******************************************************************************
.*        V11.00.03 08/10/2020  Ebon Clements  TSK 0893634                    *
.*                  Recompiled for WIESCALC - WIES27 Aboriginal and Torres    *
.*                  Strait Islander loading                                   *
.*        V11.00.02 23/09/2020  Ebon Clements  TSK 0893634                    *
.*                  Added WIES27 for 2020/2021                                *
.*        V11.00.01 25/05/2020  Davin          TSK 0890603                    *
.*                  Recompiled for WEBGROUP/WIESCALC - WIES for private facil *
.*        V10.14.02 26/08/2019  Davin          TSK 0880255                    *
.*                  Recompiled for WIESCALC - Added WIES26 for 2019/2020      *
.*        V10.14.01 27/02/2019  Richa Phogat     TSK 0870439                  *
.*                  Added DRG Version 10.0 (EDRG0000)                         *
.*        V10.13.01 21/08/2018  Davin            TSK 0860935                  *
.*                  Recompiled for WIESCALC - Added WIES25 for 2018/2019      *
.*        V10.12.01 23/03/2018  Tracey Nguyen        TSK 0852793              *
.*                  Added DRG Version 9.0 (EDRG0000)                          *
.*        V10.11.01 15/08/2017  Davin            TSK 0842626                  *
.*                  Recompiled for WIESCALC - Added WIES24 for 2017/2018      *
.*        V10.10.01 23/03/2017  Richa Phogat   TSK 0832066                    *
.*                  Changed DVA Card colour to be collected from              *
.*                  PMCDDVAC.PMSPX2FD instead of PMPXDVAC.PMIMA1FD            *
.*        V10.08.02 02/09/2016  Davin          TSK 0825157                    *
.*                  Recompiled for WIESCALC                                   *
.*        V10.08.01 19/07/2016  Davin          TSK 0822753                    *
.*                  Recompiled for WIESCALC - Added WIES23 for 2016/2017      *
.*        V10.06.02 29/05/2015  Ebon Clements        CAR 317094               *
.*                  Added DRG Version 8.0 (EDRG0000)                          *
.*        V10.06.01 13/04/2015  J.Tan                CAR 304813               *
.*                  Mods for WIES22                                           *
.*        V10.05.01 09/09/2014  Davin S              CAR 296980               *
.*                  Mods for WIES21                                           *
.*        V10.03.04 08/08/2013  Davin S              CAR 284960               *
.*                  Mods for WIES20                                           *
.*        V10.03.03 23/05/2013  Davin           CAR 284669 HDP 2013 DRG 7.0   *
.*                  Added DRG Version 7.0 (EDRG0000)                          *
.*        V10.03.02 08/08/2012  Davin S              CAR 270114               *
.*                  Mods for WIES19                                           *
.*        V10.03.01 02/12/2011  Davin          CAR 251748                     *
.*                  Recompiled for changes to PATWIS18                        *
.*        V10.02.03 31/10/2011  Mike Laming    CAR 250267                     *
.*                  Correct lengths for vars in PATICUFD at EPSDWT90          *
.*        V10.02.02 11/08/2011  Davin S              CAR 238236               *
.*                  Mods for WIES18                                           *
.*        V10.02.01 28/03/2011  Mike Laming   CAR 240107                      *
.*                  Mods to PATECDaf & PATECOaf variables & Keys - file change*
.*        V10.00.09 03/06/2010  Ebon Clements        CAR 217427               *
.*                  Added CCEPADTS and CCEPDCTS                               *
.*        V10.00.08 31/05/2010  Jill Parkinson       CAR 211125               *
.*                  Mods to check for credited items in RMED0000              *
.*                  Changes to RMED0000 to check transaction number           *
.*        V10.00.06 20/05/2010  Mike Laming          CAR 211125               *
.*                  Changes to DTR MBS Items in RMED0000                      *
.*        V10.00.05 04/05/2010  Mike Laming          CAR 211125               *
.*                  Added read DTR to sequencs MBS Items in RMED0000          *
.*        V10.00.04 03/05/2010  Mike Laming          CAR 211936               *
.*                  Changed printing to show CCEPSDRG (not CCEPDRGC)          *
.*        V10.00.03 22/04/2010  Mike Laming          CAR 211936               *
.*                  Add DRG Keyin routine for Private Hospitals -             *
.*                  seen CHOSTYP, GETDRGNO, & EDRG0000 (also 197814)          *
.*        V10.00.02 14/04/2010  Steve Armstrong      CAR 219933               *
.*                  Recompiled for changes to EMRVCDFD                        *
.*        V10.00.01 24/03/2010  Davin S              CAR 216505               *
.*                  Mods for WIES17                                           *
.***************************************************************************
.*               V9.12.04 12/03/2010  J.Tan                CAR 194862      *
.*                        Recompiled for CALCR508 - calculates income      *
.*               V9.12.03 10/12/2009  Mike Laming          CAR 212169      *
.*                        Mods to GET01000 to create Hospital Header       *
.*               V9.12.02 12/08/2009  Ebon Clements        CAR 198266      *
.*                        Added CCEPRHC1 - Referring HCP                   *
.*               V9.12.01 01/07/2009  Davin S              CAR 199724      *
.*                        Mods for WIES16                                  *
.*               V9.11.01 28/01/2009  Ebon Clements        CAR 178341      *
.*                        Added EMR fields CCEPUC21 to CCEPUC28            *
.*               V9.10.01 17/07/2008  Davin S              CAR 163993      *
.*                        Mods for WIES15                                  *
.***************************************************************************
.*               V9.09.03 26/10/2007  Peter Vela           CAR 151159      *
.*                        Added status 4 cancelled emergency visits        *
.*               V9.09.02 02/08/2007  Steve Armstrong      CAR 145161      *
.*                        Removed all reference to WIES 7, 8, 9 & 10 -     *
.*                        no longer supported.                             *
.*               V9.09.01 18/07/2007  Mike Laming          CAR 145161      *
.*                        Mods for WIES14 (starts 01/07/2006 for DRG 5.2   *
.*                        onwards).                                        *
.***************************************************************************
.*               V9.07.01 11/07/2006  Davin S              CAR 111764      *
.*                        Mods for WIES13                                  *
.***************************************************************************
.*               V9.05.B02 20/02/2006  Ebon Clements CAR 76341             *
.*                        Added referral and encounter file audit          *
.*               V9.05.B01 20/12/2005  Ebon Clements CAR 76341             *
.*                        Key length changes for encounter number          *
.***************************************************************************
.*               V9.04.01 13/08/2004  Lina Vo    CAR 52596                 *
.*                        Replaced oprdetcf with oprardaf and added extra  *
.*                        file oprsrgaf in ROPR0000.  Changed THTIM000     *
.*                        to use new opr table fields.                     *
.***************************************************************************
.*               V9.03.04 09/08/2004  J.Tan      CAR 52388                 *
.*                        Mods to check for credit notes                   *
.*               V9.03.03 06/08/2004  Henry Son            CAR 51504       *
.*                        Mods for WIES12                                  *
.*               V9.03.02 20/02/2004 Ebon Clements         CAR 46515       *
.*                        Added Outpatient, Allied Health and Emergency    *
.*                        to extract generation                            *
.*               V9.03.01 19/01/2004 Ebon Clements         CAR 45473       *
.*                        Fixed ML1000 branch                              *
.*               V9.03.00 05/01/2004 Ebon Clements         CAR 45473       *
.*                        Created program from IBACEA70                    *
.***************************************************************************
.
          INC       STD001FD
.
. FILE DESCRIPTION INCLUDES
. -------------------------
          INC       ALLCONFD/INC
          INC       ALLDADFD/INC
          INC       ALLREFFD/INC
          INC       ALLENCFD/INC
          INC       CALVARDF
          INC       CCSAGEFD/INC
          INC       CCSCONFD/INC
          INC       CCSDRGFD/INC
          INC       CCSEPSFD/INC
          INC       CCSEWTFD/INC
          INC       CCSHCDFD/INC
          INC       CCSHLCFD/INC
          INC       CCSIADFD/INC
          INC       CCSIMCFD/INC
          INC       CCSXHDFD/INC
          INC       CEABHDFD/INC
          INC       CEADEFFD/INC
          INC       CEAMAPFD/INC
          INC       CEAMBPFD/INC
          INC       CEAMCPFD/INC
          INC       CEAMDPFD/INC
          INC       CEAMEPFD/INC
          INC       CEANAMFD/INC
          INC       CEANBMFD/INC
          INC       CEANCMFD/INC
          INC       CEANDMFD/INC
          INC       CEAPSCFD/INC
          INC       CEASTRFD/INC
          INC       CEATAMFD/INC
          INC       CEATBMFD/INC
          INC       CEATCMFD/INC
          INC       CEATDMFD/INC
          INC       CEATEMFD/INC
          INC       CEATFMFD/INC
          INC       CEATGMFD/INC
          INC       CEAVAMFD/INC
          INC       CEAVBMFD/INC
          INC       EMRVISFD/INC
          INC       MRTCONFD/INC
          INC       OPRCLIFD/INC
          INC       OPRDEAFD/INC
          INC       OPRDEBFD/INC
          INC       OPRARDFD/INC
          INC       OPRSRGFD/INC
          INC       OPRMOPFD/INC
          INC       OPRSESFD/INC
          INC       OUTBB1FD/INC
          INC       OUTBOAFD/INC
          INC       OUTSITFD/INC
          INC       PATCODFD/INC
          INC       PATDADFD/INC
          INC       PATDO1FD/INC
          INC       PATDSCFD/INC
          INC       PATDTRFD/INC
          INC       PATECDFD/INC
          INC       PATECOFD/INC
          INC       PATINVFD/INC
          INC       PATITMFD/INC
          INC       PATMA1FD/INC
          INC       PATMI1FD/INC
          INC       PATMMBFD/INC
          INC       PATPGRFD/INC
          INC       PATTRNFD/INC
          INC       PATVISFD/INC
          INC       PMSCCDFD/INC
          INC       PMSMTIFD/INC
          INC       PMSFCIFD/INC
          INC       PATICUFD/INC
          INC       EMRVCDFD/INC
          INC       PMSVX1FD/INC
          INC       PMSPX2FD/INC
          INC       PRIDTRFD/INC
          INC       STDHLPDF
.
. LOCAL VARIABLE DEFINITION
. -------------------------
DIM8A     DIM       8
DIM8      DIM       8
DIM16     DIM       16
DRGVERS   DIM       3                                                 *I-145161
FORM16    FORM      16
ENCNNUMB  DIM       8
INCTYPE   FORM      1
CHOSTYP   FORM      1                                                 *I-211936
CDYSDAYS  FORM      6
CDYSTDTE  DIM       8
CDYSYEAR  FORM      2
CDYSFDTE  DIM       8
CURRDATE  DIM       8
DIM2A     DIM       2
DRGVDESC  DIM       10                                                *I-211936
ENDDAT    DIM       8
ENDDTD    DIM       8
ENDEPS    DIM       16
FORM5A    FORM      5
FORM5B    FORM      5
FORMA122  FORM      12.2                                              *I-211125
FORMB122  FORM      12.2                                              *I-211125
FROMDAT   DIM      10
FROMTIME  DIM       5
FROMHOUR  FORM      2
FROMMIN   FORM      2
FROMDTD   DIM      10 
FROMEPS   DIM      30
GETDRGNO  FORM      1                                                 *I-211936
KEY22A    DIM      22
TOEPS     DIM      30
TODTD     DIM      10 
INCOMPLT  FORM      1 
LOADNAME  DIM      40 
LOADFILE  FILE      ASCII, FIXED=350
MAXLOS    FORM      6
PTCNDGPV  DIM       3                                                 *I-211936
PTCNHDPS  FORM      1       250       Hospital state for HDP extracts
QUANTITY  FORM      4
TODAT     DIM      10
TOTIME    DIM       5
TOHOUR    FORM      2
TOMIN     FORM      2
TITEM1    DIM       9                                                 *I-211125
TITEM2    DIM       9                                                 *I-211125
..PTCNUGRP  FORM      1
STRDAT    DIM       8
WIESONLF  FORM      2                       * version of WIES selected
WIESDES   DIM      17
ZEROLOS   FORM      1
.
ALLREFOP  FORM      1
ALLENCOP  FORM      1
EMRVISOP  FORM      1
PATMASOP  FORM      1
PATTRNOP  FORM      1
PATMISOP  FORM      1
PATDSCOP  FORM      1
PATVISOP  FORM      1
PATMOPOP  FORM      1
PATMDIOP  FORM      1
LASTEPS   DIM      16
OUTSITOP  FORM      1
OUTBOBOP  FORM      1
OUTBOKOP  FORM      1
PATMMBOP  FORM      1
PATCODOP  FORM      1
PATDOCOP  FORM      1
PATINVOP  FORM      1
PATDTROP  FORM      1
OPRDEAOP  FORM      1
OPRARDOP  FORM      1
OPRSRGOP  FORM      1
OPRSESOP  FORM      1
OPRCLIOP  FORM      1
OPCNCLSU  FORM      1
SAVKEY19  DIM      19
SAVEEPS   FORM      8 
STRDTD    DIM       8
STREPS    DIM       16
SUMMREPT  FORM      1 
TOTALERR  FORM      5 
TOTALCOM  FORM      5
TOTALSCN  FORM      5
.
PRGID     INIT      "IBACCC70"
PRGNAM    INIT      "Patient Data Interface                  "
VERSION   INIT      "V12.00.00"
+
.**************************************************************************
.*                              ML0000                                    *
.*                      Controlling Logic (Mainline code)                 *
.**************************************************************************
.
ML0000    CALL      INIT0000               * initialisation and open files
.
ML0100    CALL      OPTN0000               * select options
          BRANCH    EXIT,ML9999            * EXIT = 1 if 0 chosen in menu
          BRANCH    COPTION,ML1000,ML1100,ML1200,ML1300:
                            ML1400,ML1500,ML1600,ML1700
.
ML1000    CALL      LIPD0000               * Load I.B.A. Patient Data by Date
          BRANCH    EXIT,ML0100
          GOTO      ML9999
.
ML1100    CALL      LIPE0000               * Load I.B.A. Patient Data by Episode
          BRANCH    EXIT,ML0100
          GOTO      ML9999
.
ML1200    CALL      LASC0000               * Load ASCI File Patient Data
          BRANCH    EXIT,ML0100
          GOTO      ML9999
.
ML1300    CALL      PEXP0000               * Print Expisode Exeption Report
          BRANCH    EXIT,ML0100
          GOTO      ML9999
.
ML1400    CALL      PINC0000               * Print Incomplete Episode Records
          BRANCH    EXIT,ML0100
          GOTO      ML9999
.
ML1500    CALL      PEPS0000               * Print Episode Details
          BRANCH    EXIT,ML0100
          GOTO      ML9999
.
ML1600    CALL      CEPS0000               * Complete a Range of Episodes
          BRANCH    EXIT,ML0100
          GOTO      ML9999
.
ML1700    CALL      FINC0000               * Flag a Range of Episodes as
          BRANCH    EXIT,ML0100            * Incomplete
          GOTO      ML9999
.
ML9999    CHAIN     PGM                    * chain back to program
+
.****************************************************************************
.*                                INIT0000             Called by: ML0000    *
.*                             initialisation                               *
.*  The initialisation routine is used to display headings and open files.  *
.****************************************************************************
.
INIT0000  CALL      DISPHEAD                  * display heading
.
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
.
          DISPLAY   *P56:24,"Opening ccsageaf";
          OPEN      CCSAGEA2,"ccsageaf"
          MOVE      "   64",AUDTSECT
          MOVE      " 37",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening ccsaudep";
            OPEN      CCSAUDEP,"ccsaudep"
          ENDIF
          MOVE      "   64",AUDTSECT
          MOVE      " 38",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening ccsaudia";
            OPEN      CCSAUDIA,"ccsaudia"
          ENDIF
          DISPLAY   *P56:24,"Opening ccsdrgaf";
          OPEN      CCSDRGA1,"ccsdrgaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA1,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA2,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA3,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA4,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA5,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccsewtaf";
          OPEN      CCSEWTA1,"ccsewtaf"
          DISPLAY   *P56:24,"Opening ccshcdaf";
          OPEN      CCSHCDA1,"ccshcdaf"
          DISPLAY   *P56:24,"Opening ccshcdaf";
          OPEN      CCSHCDA2,"ccshcdaf"
          DISPLAY   *P56:24,"Opening ccshlcaf";
          OPEN      CCSHLCA1,"ccshlcaf"
          DISPLAY   *P56:24,"Opening ccsiadaf";
          OPEN      CCSIADA1,"ccsiadaf"
          DISPLAY   *P56:24,"Opening ccsimcaf";
          OPEN      CCSIMCA1,"ccsimcaf"
          DISPLAY   *P56:24,"Opening ccsxhdaf";
          OPEN      CCSXHDA1,"ccsxhdaf"
          MOVE      "   64",AUDTSECT
          MOVE      " 39",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening ceaaudps";
            OPEN      CEAAUDPS,"ceaaudps"
          ENDIF
          MOVE      "   64",AUDTSECT
          MOVE      " 40",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening ceaaudst";
            OPEN      CEAAUDST,"ceaaudst"
          ENDIF
          DISPLAY   *P56:24,"Opening ceabhdaf";
          OPEN      CEABHDA1,"ceabhdaf"
          DISPLAY   *P56:24,"Opening ceadefaf";
          OPEN      CEADEFA1,"ceadefaf"
          DISPLAY   *P56:24,"Opening ceamapaf";
          OPEN      CEAMAPA1,"ceamapaf"
          DISPLAY   *P56:24,"Opening ceambpaf";
          OPEN      CEAMBPA1,"ceambpaf"
          DISPLAY   *P56:24,"Opening ceamcpaf";
          OPEN      CEAMCPA1,"ceamcpaf"
          DISPLAY   *P56:24,"Opening ceamdpaf";
          OPEN      CEAMDPA1,"ceamdpaf"
          DISPLAY   *P56:24,"Opening ceamepaf";
          OPEN      CEAMEPA1,"ceamepaf"
          DISPLAY   *P56:24,"Opening ceanamaf";
          OPEN      CEANAMA1,"ceanamaf"
          DISPLAY   *P56:24,"Opening ceanbmaf";
          OPEN      CEANBMA1,"ceanbmaf"
          DISPLAY   *P56:24,"Opening ceanbmaf";
          OPEN      CEANBMA2,"ceanbmaf"
          DISPLAY   *P56:24,"Opening ceancmaf";
          OPEN      CEANCMA1,"ceancmaf"
          DISPLAY   *P56:24,"Opening ceandmaf";
          OPEN      CEANDMA1,"ceandmaf"
          DISPLAY   *P56:24,"Opening ceapscaf";
          OPEN      CEAPSCA1,"ceapscaf"
          DISPLAY   *P56:24,"Opening ceastraf";
          OPEN      CEASTRA1,"ceastraf"
          DISPLAY   *P56:24,"Opening ceastraf";
          OPEN      CEASTRA2,"ceastraf"
          DISPLAY   *P56:24,"Opening ceastraf";
          OPEN      CEASTRA3,"ceastraf"
          DISPLAY   *P56:24,"Opening ceastraf";
          OPEN      CEASTRA4,"ceastraf"
          DISPLAY   *P56:24,"Opening ceastraf";
          OPEN      CEASTRA5,"ceastraf"
          DISPLAY   *P56:24,"Opening ceatamaf";
          OPEN      CEATAMA1,"ceatamaf"
          DISPLAY   *P56:24,"Opening ceatbmaf";
          OPEN      CEATBMA1,"ceatbmaf"
          DISPLAY   *P56:24,"Opening ceatcmaf";
          OPEN      CEATCMA1,"ceatcmaf"
          DISPLAY   *P56:24,"Opening ceatdmaf";
          OPEN      CEATDMA1,"ceatdmaf"
          DISPLAY   *P56:24,"Opening ceatemaf";
          OPEN      CEATEMA1,"ceatemaf"
          DISPLAY   *P56:24,"Opening ceatfmaf";
          OPEN      CEATFMA1,"ceatfmaf"
          DISPLAY   *P56:24,"Opening ceatgmaf";
          OPEN      CEATGMA1,"ceatgmaf"
          DISPLAY   *P56:24,"Opening ceavamaf";
          OPEN      CEAVAMA1,"ceavamaf"
          DISPLAY   *P56:24,"Opening ceavbmaf";
          OPEN      CEAVBMA1,"ceavbmaf"
          DISPLAY   *P56:24,"Opening  patmx1af           ";
          OPEN      PATMX1A1,"patmx1af"
          DISPLAY   *P56:24,"Opening  patpgraf           ";
          OPEN      PATPGRA1,"patpgraf"
          DISPLAY   *P56:24,"Opening pmsmtiaf";
          OPEN      PMSMTIA1,"pmsmtiaf"
          DISPLAY   *P56:24,"Opening pmsmtiaf";
          OPEN      PMSMTIA2,"pmsmtiaf"
          DISPLAY   *P56:24,"Opening pmsmtiaf";
          OPEN      PMSMTIA3,"pmsmtiaf"
          DISPLAY   *P56:24,"Opening paticuaf";
          OPEN      PATICUA1,"paticuaf"
          DISPLAY   *P56:24,"Opening emrvcdaf";
          OPEN      EMRVCDA1,"emrvcdaf"
          DISPLAY   *P56:24,"Opening pridtraf";
          OPEN      PRIDTRA1,"pridtraf"
          DISPLAY   *P56:24,"Opening alldadaf";
          OPEN      ALLDADA1,"alldadaf"
          DISPLAY   *P56:24,"Opening patdadaf";
          OPEN      PATDADA1,"patdadaf"
          DISPLAY   *P64:24,"pmsccdaf";
          OPEN      PMSCCDA1,"pmsccdaf"
.
...obs..  READ      CONTROLF,SEVENTY9;*249,PTCNUGRP   * drg release paramter
          READ      CONTROLF,TEN3;*245,CHOSTYP        * Hospital Type *I-211936
          READ      CONTROLF,SIXTY1;*240,MRCNUNWA,*241,MRCNENWA

          READ      CONTROLF,EIGHTY;*250,PTCNHDPS
          READ      CONTROLF,HUND05;*158,PTCNDGPV     * default Grouper ver.
.         
          MOVE      ZERO,GETDRGNO           * default Public          *I-211936
          MOVE      CHOSTYP,KEY1
          REP       "0-9-",KEY1
          MATCH     "-",KEY1                * select "0" or "9"
          IF        @EQUAL
            MOVE      ONE,GETDRGNO          * Private Hospitals
          ENDIF
.
          DISPLAY   *P1:24,*EL;
.
INIT9999  RETURN
+
.****************************************************************************
.*                                OPTN0000             Called by: ML0000    *
.*                        get user options or exit                          *
.*                                                                          *
.*    Returns:  EXIT    = FALSE (0)  Run clean up                           *
.*                        TRUE  (1)  Exit option selected                   *
.****************************************************************************
.
OPTN0000  DISPLAY   *P1:3,*EF,*P1:4,*V2LON,ZERO,*HOFF,". Exit":
                    *P1:5,*V2LON,ONE,*HOFF,". Load I.B.A. Patient Data":
                                           " by Date Range":
                    *P1:6,*V2LON,TWO,*HOFF,". Load I.B.A. Patient Data":
                                           " by Episode Number":
                    *P1:7,*V2LON,THREE,*HOFF,". Load Ascii File Patient Data":
                    *P1:8,*V2LON,FOUR,*HOFF,". Print Episode Exception Report":
                    *P1:9,*V2LON,FIVE,*HOFF,". List Incomplete Episode Records":
                    *P1:10,*V2LON,SIX,*HOFF,". List Episode Details":
                    *P1:11,*V2LON,SEVEN,*HOFF,". Complete a Range of Episodes":
                    *P1:12,*V2LON,EIGHT,*HOFF,". Flag a Range of Episodes as":
                                            " Incomplete"
.
OPTN0500  KEYIN     *P1:16,*EL,"Select Option : ",*DV,UNDLN1:
                    *P17:16,*V2LON,COPTION
.
          COMPARE   ZERO,COPTION                 * exit selected ?
          GOTO      OPTN9500 IF EQUAL            * yes
.
          BRANCH    COPTION,OPTN9000,OPTN9000,OPTN9000,OPTN9000:
                            OPTN9000,OPTN9000,OPTN9000,OPTN9000
.
          BEEP
          GOTO      OPTN0500
.
OPTN9000  MOVE      ZERO,EXIT
          GOTO      OPTN9999
.
OPTN9500  MOVE      ONE,EXIT
.
OPTN9999  RETURN
+
.**************************************************************************
.*                               LIPD0000              Called by: ML1000  *
.* Load I.B.A. Patient Data                                               *
.**************************************************************************
.
LIPD0000  CALL      GET01000                    * Get default hospital
.
          CALL      RDATE000                    * Keyin scan visit date
.
          IF        GETDRGNO = 1
            CALL      EDRG0000                  * Keyin DRG Code      *I-21936
          ELSE
            CALL      EWVS0000                  * Keyin WIES Version
          ENDIF
.
          CALL      CONTQST                     * ok to continue
          BRANCH    CEXIT,LIPD5000,LIPD9999,LIPD9999    * 1=Yes, 2=No, 3=Cancel
.
LIPD5000  CALL      EXTR0000               * Extract Patient Data by date
.
LIPD9999  RETURN
.
+
.**************************************************************************
.*                               LIPE0000              Called by: ML1100  *
.* Load I.B.A. Patient Data                                               
.**************************************************************************
.
LIPE0000  CALL      GET01000                    * Get defaault hospital
.
          CALL      SING0000                    * Process a Single Episode
          BRANCH    EXIT,LIPE9999
.
          IF        GETDRGNO = 1                
            CALL      EDRG0000                  * Keyin DRG Code      *I-21936
          ELSE
            CALL      EWVS0000                  * Keyin WIES Version
          ENDIF
.
          CALL      CONTQST                     * ok to continue
          BRANCH    CEXIT,LIPE5000,LIPE9999,LIPE9999    * 1=Yes, 2=No, 3=Cancel
.
LIPE5000  MATCH     SP70,CCEPEPS
          GOTO      LIPE9999 IF EQUAL
.
          CALL      EPSUP000               * Extract a Single Episode
.
LIPE9999  RETURN
.
.------------------------------------------------------------
. Select and Extract a Single Admission
.------------------------------------------------------------
SING0000  DISPLAY   *P1:4,*EF
          KEYIN     *P1:4,"Episode to Update : ",*V2LON,CCEPEPS
          ENDSET    CCEPEPS
          APPEND    SP70,CCEPEPS
          RESET     CCEPEPS
          MATCH     SP70,CCEPEPS
          GOTO      SING9000 IF EQUAL
.
          PACK      KEY18,CCHCHCD,CCEPEPS,SP70
          CALL      RDCCEP1
          IF        OVRCD=1
            BEEP
            DISPLAY  *P1:24,"Invalid Episode ";
            CALL      HITENTER
            GOTO      SING0000
          ENDIF
.
          DISPLAY   *P38:4,"Episode to Update : ",*V2LON,CCEPEPS,SP1,CCEPSUR:
                                                         SP1,CCEPGIV
.
          MOVE      ZERO,EXIT
          GOTO      SING9999
.
SING9000  MOVE      ONE,EXIT
          GOTO      SING9999
.
SING9999  RETURN
.
.----------------------------------------------------------------------
. Enter WIES Version
.----------------------------------------------------------------------
EWVS0000  DISPLAY   *P1:6,*EF,"WIES Version :"
.
EWVS0500  DISPLAY   *P19:6,WIESDES      
          KEYIN     *P16:6,*V2LON,*RV,F2
          IF        F2 > 16
            BEEP
            GOTO      EWVS0500
          ENDIF
.
          MOVE      F2,WIESONLF
.                                           * WIES versions - 0 = current (27)
          BRANCH    F2,EWVS1000:            * WIES 26
                       EWVS1001:            * WIES 25
                       EWVS1002:            * WIES 24
                       EWVS1003:            * WIES 23
                       EWVS1004:            * WIES 22
                       EWVS1005:            * WIES 21
                       EWVS1010:            * WIES 20
                       EWVS1020:            * WIES 19
                       EWVS1030:            * WIES 18
                       EWVS1040:            * WIES 17
                       EWVS1050:            * WIES 16
                       EWVS1060:            * WIES 15
                       EWVS1070:            * WIES 14
                       EWVS1080:            * WIES 13
                       EWVS1090:            * WIES 12
                       EWVS1100             * WIES 11
.
.                                           * current version of WIES
          MOVE      "WIES 27",WIESDES
          MOVE      "100",DRGVERS
          DISPLAY   *P18:6,WIESDES
          GOTO      EWVS9999
.
EWVS1000  MOVE      "WIES 26",WIESDES
          MOVE      "090",DRGVERS
          DISPLAY   *P18:6,WIESDES
          GOTO      EWVS9999
.
EWVS1001  MOVE      "WIES 25",WIESDES
          MOVE      "090",DRGVERS
          DISPLAY   *P18:6,WIESDES
          GOTO      EWVS9999
.
EWVS1002  MOVE      "WIES 24",WIESDES
          MOVE      "080",DRGVERS
          DISPLAY   *P18:6,WIESDES
          GOTO      EWVS9999
.
EWVS1003  MOVE      "WIES 23",WIESDES
          MOVE      "080",DRGVERS
          DISPLAY   *P18:6,WIESDES
          GOTO      EWVS9999
.
EWVS1004  MOVE      "WIES 22",WIESDES
          MOVE      "070",DRGVERS
          DISPLAY   *P18:6,WIESDES
          GOTO      EWVS9999
.
EWVS1005  MOVE      "WIES 21",WIESDES
          MOVE      "070",DRGVERS
          DISPLAY   *P18:6,WIESDES
          GOTO      EWVS9999
.
EWVS1010  MOVE      "WIES 20",WIESDES
          MOVE      "070",DRGVERS
          DISPLAY   *P18:6,WIESDES
          GOTO      EWVS9999
.
EWVS1020  MOVE      "WIES 19",WIESDES
          MOVE      "062",DRGVERS
          DISPLAY   *P18:6,WIESDES
          GOTO      EWVS9999
.
EWVS1030  MOVE      "WIES 18",WIESDES
          MOVE      "060",DRGVERS
          DISPLAY   *P18:6,WIESDES
          GOTO      EWVS9999
.
EWVS1040  MOVE      "WIES 17",WIESDES
          MOVE      "060",DRGVERS
          DISPLAY   *P18:6,WIESDES
          GOTO      EWVS9999
.
EWVS1050  MOVE      "WIES 16",WIESDES
          MOVE      "060",DRGVERS
          DISPLAY   *P18:6,WIESDES
          GOTO      EWVS9999
.
EWVS1060  MOVE      "WIES 15",WIESDES
          MOVE      "052",DRGVERS
          DISPLAY   *P18:6,WIESDES
          GOTO      EWVS9999
.
EWVS1070  MOVE      "WIES 14",WIESDES                                 *I-145161
          MOVE      "052",DRGVERS
          DISPLAY   *P18:6,WIESDES
          GOTO      EWVS9999
.
EWVS1080  MOVE      "WIES 13",WIESDES                                 *C-145161
          MOVE      "051",DRGVERS
          DISPLAY   *P18:6,WIESDES
          GOTO      EWVS9999
.
EWVS1090  MOVE      "WIES 12",WIESDES                                  *C-51504
          MOVE      "050",DRGVERS
          DISPLAY   *P18:6,WIESDES
          GOTO      EWVS9999
.
EWVS1100  MOVE      "WIES 11 ",WIESDES
          MOVE      "042",DRGVERS
          DISPLAY   *P18:6,WIESDES
          GOTO      EWVS9999
.
EWVS9999  RETURN
.
.----------------------------------------------------------------------
. Enter DRG Version
.----------------------------------------------------------------------
EDRG0000  DISPLAY   *P1:6,*EF,"DRG Version :"
          MOVE      ZERO,F2
          MOVE      "DRG 12.0  ",DRGVDESC
.
EDRG1000  DISPLAY   *P19:6,DRGVDESC
          KEYIN     *P16:6,*V2LON,*RV,F2
          IF        F2 > 11
            BEEP
            GOTO      EDRG1000
          ENDIF
.                                           * DRG Versions - 0 = current (12.0)
          BRANCH    F2,EDRG1990:            * DRG Ver 11.0
                       EDRG2000:            * DRG Ver 10.0
                       EDRG2010:            * DRG Ver 9.0
                       EDRG2020:            * DRG Ver 8.0
                       EDRG2030:            * DRG Ver 7.0
                       EDRG2040:            * DRG Ver 6.2
                       EDRG2050:            * DRG Ver 6.0
                       EDRG2060:            * DRG Ver 5.2
                       EDRG2070:            * DRG Ver 5.1
                       EDRG2080:            * DRG Ver 5.0
                       EDRG2090             * DRG Ver 4.2
          IF        F2 <> 0
            GOTO      EDRG1000
          ENDIF
.                                           * current version of DRG
          MOVE      "DRG 12.0  ",DRGVDESC 
          MOVE      "120",DRGVERS
          DISPLAY   *P18:6,DRGVDESC
          GOTO      EDRG9999
.
EDRG1990  MOVE      "DRG 11.0  ",DRGVDESC 
          MOVE      "110",DRGVERS
          DISPLAY   *P18:6,DRGVDESC
          GOTO      EDRG9999
.
EDRG2000  MOVE      "DRG 10.0  ",DRGVDESC 
          MOVE      "100",DRGVERS
          DISPLAY   *P18:6,DRGVDESC
          GOTO      EDRG9999
.
EDRG2010  MOVE      "DRG 9.0   ",DRGVDESC 
          MOVE      "090",DRGVERS
          DISPLAY   *P18:6,DRGVDESC
          GOTO      EDRG9999
.
EDRG2020  MOVE      "DRG 8.0   ",DRGVDESC                             *I-284669
          MOVE      "080",DRGVERS
          DISPLAY   *P18:6,DRGVDESC
          GOTO      EDRG9999
.
EDRG2030  MOVE      "DRG 7.0   ",DRGVDESC                             *I-197814
          MOVE      "070",DRGVERS
          DISPLAY   *P18:6,DRGVDESC
          GOTO      EDRG9999
.
EDRG2040  MOVE      "DRG 6.2   ",DRGVDESC                             *I-197814
          MOVE      "062",DRGVERS
          DISPLAY   *P18:6,DRGVDESC
          GOTO      EDRG9999
.
EDRG2050  MOVE      "DRG 6.0   ",DRGVDESC                             *I-197814
          MOVE      "060",DRGVERS
          DISPLAY   *P18:6,DRGVDESC
          GOTO      EDRG9999
.
EDRG2060  MOVE      "DRG 5.2   ",DRGVDESC                             *I-197814
          MOVE      "052",DRGVERS
          DISPLAY   *P18:6,DRGVDESC
          GOTO      EDRG9999
.
EDRG2070  MOVE      "DRG 5.1   ",DRGVDESC                             *I-197814
          MOVE      "051",DRGVERS
          DISPLAY   *P18:6,DRGVDESC
          GOTO      EDRG9999
.
EDRG2080  MOVE      "DRG 5.0   ",DRGVDESC                             *I-197814
          MOVE      "050",DRGVERS
          DISPLAY   *P18:6,DRGVDESC
          GOTO      EDRG9999
.
EDRG2090  MOVE      "DRG 4.2   ",DRGVDESC                             *I-197814
          MOVE      "042",DRGVERS
          DISPLAY   *P18:6,DRGVDESC
          GOTO      EDRG9999
.
EDRG9999  RETURN
.
.*************************************************************************
. Read Default Hospital Code
.*************************************************************************
GET01000  MOVE    "1 ",KEY2
          CALL    RDCCHC1
          IF      OVRCD=1
            MOVE    "1 ",CCHCHCD
            MOVE    "Unknown Hospital Name",CCHCDES
            UNPACK  SP70,CCHCPREF,CCHCPUSE,CCHCSPA
            CALL    WRCCHC1
          ENDIF
          MOVE    "1 ",KEY2
          CALL    RDCCHL1
          IF      OVRCD=1
            MOVE    "1 ",CCHLHCD
            MOVE    SP70,CCHLPMA
            MOVE    SP70,CCHLPTR
            MOVE    SP70,CCHLPMI
            MOVE    SP70,CCHLPDS
            MOVE    SP70,CCHLPVI
            MOVE    SP70,CCHLPMO
            MOVE    SP70,CCHLPMD
            MOVE    SP70,CCHLADE
            MOVE    SP70,CCHLADI
            MOVE    SP70,CCHLOSI
            MOVE    SP70,CCHLOBB
            MOVE    SP70,CCHLCDP
            UNPACK  SP70,CCHLPMX,CCHLPIN
            UNPACK  SP70,CCHLPDT,CCHLPCD
            UNPACK  SP70,CCHLPMB,CCHLPDC
            UNPACK  SP70,CCHLPIC,CCHLARF
            UNPACK  SP70,CCHLENC,CCHLEVS
            UNPACK  SP70,CCHLOPR
            PACK    CCHLSPA,SP70,SP70,SP70
            CALL    WRCCHL1
          ENDIF
.
          CALL    OPPMS000
.
          MOVE    ZERO,WIESONLF
          MOVE    "WIES 27",WIESDES         * Current WIES version
          MOVE    "100",DRGVERS
          RETURN
.
.*************************************************************************
. Keyin load visit date load range
.*************************************************************************
RDATE000  MOVE       FALSE,EXIT
          DISPLAY    *P1:4,*EF,"Load Visit Date From :":
                     *P1:5,"Load Visit Date To  :";
.
          MOVE      "24",CCOL
          MOVE      "4",CVERT
          CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
          MOVE      CCC,CCENT
          MOVE      CYY,CYEAR
          MOVE      CMM,CMON
          MOVE      CDD,CDAY
          CALL      KEYDATE 
          BRANCH    OVRCD,RDATE100
.
          MATCH     SP2,CDAY
          GOTO      RDATE100 IF EQUAL
.
          PACK      STRDAT,CCENT,CYEAR,CMON,CDAY
          REP       " 0",STRDAT
          CALL      PACDATE
          MOVE      CPCDATE,FROMDAT
          GOTO      RDATE150
.
RDATE100  MOVE      "Start             ",FROMDAT
          MOVE      SP70,STRDAT
.
RDATE150  MOVE      "0",CKEYTYP
          MOVE      "24",CCOL
          MOVE      "5",CVERT 
          CALL      KEYDATE
          BRANCH    OVRCD,RDATE200
.
          MATCH     SP2,CDAY
          GOTO      RDATE200 IF EQUAL
.
          PACK      ENDDAT,CCENT,CYEAR,CMON,CDAY
          REP       " 0",ENDDAT
          CALL      PACDATE
          MOVE      CPCDATE,TODAT
.
          MATCH     STRDAT,ENDDAT
          GOTO      RDATE999 IF EQUAL
          GOTO      RDATE999 IF NOT LESS
.
          BEEP
          DISPLAY   *P1:24,"To Date Must Be > From Date ";
          CALL      HITENTER
          GOTO      RDATE000
.
RDATE200  MOVE      "Finish             ",TODAT
          MOVE      "99999999",ENDDAT
.
RDATE999  RETURN
.
.---------------------------------------------------------------------
. Open Patient Management Files
.------------------------------
. Flag Files That Could Be Opened
.--------------------------------
. PATVISOP FORM 1 0=Yes Visit File
. PATMASOP FORM 1 0=Yes Patient Master File
. PATTRNOP FORM 1 0=Yes Bed Transfer File
. PATMISOP FORM 1 0=Yes Admissions File
. PATMDIOP FORM 1 0=Yes Diagnosis
. PATMOPOP FORM 1 0=Yes Operations
. PATDSCOP FORM 1 0=Yes Discharge File
. EMRVISOP FORM 1 0=Yes Emergency File
. OUTSITOP FORM 1 0=Yes Outpatient Site File
. OUTBOBOP FORM 1 0=Yes Outpatient File B with "out" default prefix
. ALLREFOP FORM 1 0=Yes Allied Health Referral file
. ALLENCOP FORM 1 0=Yes Allied Health Encounter file
.---------------------------------------------------------------------
OPPMS000  MOVE     ONE,ALLREFOP
          MOVE     ONE,ALLENCOP
          MOVE     ONE,PATVISOP
          MOVE     ONE,PATMASOP
          MOVE     ONE,PATTRNOP
          MOVE     ONE,PATMISOP
          MOVE     ONE,PATMDIOP
          MOVE     ONE,PATMOPOP
          MOVE     ONE,PATDSCOP
          MOVE     ONE,EMRVISOP
          MOVE     ONE,OUTSITOP
          MOVE     ONE,OUTBOBOP
          MOVE     ONE,OUTBOKOP
          MOVE     ONE,PATDOCOP
          MOVE     ONE,PATMMBOP
          MOVE     ONE,PATINVOP
          MOVE     ONE,PATDTROP
          MOVE     ONE,PATCODOP
          MOVE     ONE,OPRSESOP
          MOVE     ONE,OPRDEAOP
          MOVE     ONE,OPRARDOP
          MOVE     ONE,OPRSRGOP
.
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          MATCH    SP70,CCHLPDT
          IF       @EQUAL
            OPEN     PATDTRA1,"patdtraf"                               * V90200
            OPEN     PATDTRA3,"patdtraf"                              *I-211125
          ELSE
            MOVE     "patdtraf",KEY8
            STRIP    CCHLPDT
            PACK     KEY80,CCHLPDT,KEY8
            OPEN     PATDTRA1,KEY80                                    * V90200
            OPEN     PATDTRA3,KEY80                                   *I-211125
          ENDIF
          TRAPCLR  IO
          MOVE     OVRCD,PATDTROP
.
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          MATCH    SP70,CCHLPIN
          IF       @EQUAL
            OPEN     PATINVR3,"patinvrf"                               * V90200
          ELSE
            MOVE     "patinvrf",KEY8
            STRIP    CCHLPIN
            PACK     KEY80,CCHLPIN,KEY8
            OPEN     PATINVR3,KEY80                                    * V90200
          ENDIF
          TRAPCLR  IO
          MOVE     OVRCD,PATINVOP
.
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          MATCH    SP70,CCHLPCD
          IF       @EQUAL
            OPEN     PATCODE1,"patcodes"                               * V90200
          ELSE
            MOVE     "patcodes",KEY8
            STRIP    CCHLPCD
            PACK     KEY80,CCHLPCD,KEY8
            OPEN     PATCODE1,KEY80                                    * V90200
          ENDIF
          TRAPCLR  IO
          MOVE     OVRCD,PATCODOP
.
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          MATCH    SP70,CCHLPMB
          IF       @EQUAL
            OPEN     PATMMBS1,"patmmbsf"
          ELSE
            MOVE     "patmmbsf",KEY8
            STRIP    CCHLPMB
            PACK     KEY80,CCHLPMB,KEY8
            OPEN     PATMMBS1,KEY80
          ENDIF
          TRAPCLR  IO
          MOVE     OVRCD,PATMMBOP
.
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          MATCH    SP70,CCHLPVI
          IF       @EQUAL
            OPEN     PATVISA1,"patvisaf"
            OPEN     PMSVX1A1,"pmsvx1af"
          ELSE
            MOVE     "patvisaf",KEY8
            STRIP    CCHLPVI
            PACK     KEY80,CCHLPVI,KEY8
            OPEN     PATVISA1,KEY80
.
            MOVE     "pmsvx1af",KEY8
            STRIP    CCHLPVI
            PACK     KEY80,CCHLPVI,KEY8
            OPEN     PMSVX1A1,KEY80
          ENDIF
          TRAPCLR  IO
          TRAPCLR  IO
          MOVE     OVRCD,PATVISOP
.
          CALL     PATDOC00
          CALL     PATMA100
          CALL     PATMI100
.
          MOVE     "out",OSTFILE
          CALL     OUTBB100
.
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          MATCH    SP70,CCHLPTR
          IF       @EQUAL
            OPEN     PATTRAN2,"pattranf"                               * V90200
          ELSE
            MOVE     "pattranf",KEY8
            STRIP    CCHLPTR
            PACK     KEY80,CCHLPTR,KEY8
            OPEN     PATTRAN2,KEY80                                    * V90200
          ENDIF
          TRAPCLR  IO
          MOVE     OVRCD,PATTRNOP
.
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          MATCH    SP70,CCHLPMD
          IF       @EQUAL
            OPEN     PATECDA2,"patecdaf"
          ELSE
            MOVE     "patecdaf",KEY8
            STRIP    CCHLPMD
            PACK     KEY80,CCHLPMD,KEY8
            OPEN     PATECDA2,KEY80
          ENDIF
          TRAPCLR  IO
          MOVE     OVRCD,PATMDIOP
.
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          MATCH    SP70,CCHLPMO
          IF       @EQUAL
            OPEN     PATECOA2,"patecoaf"
          ELSE
            MOVE     "patecoaf",KEY8
            STRIP    CCHLPMO
            PACK     KEY80,CCHLPMO,KEY8
            OPEN     PATECOA2,KEY80
          ENDIF
          TRAPCLR  IO
          MOVE     OVRCD,PATMOPOP
.
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          MATCH    SP70,CCHLPDS
          IF       @EQUAL
            OPEN     PATDSCH1,"patdschf"                               * V90200
          ELSE
            MOVE     "patdschf",KEY8
            STRIP    CCHLPDS
            PACK     KEY80,CCHLPDS,KEY8
            OPEN     PATDSCH1,KEY80                                    * V90200
          ENDIF
          TRAPCLR  IO
.
          MOVE     OVRCD,PATDSCOP
.
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          MATCH    SP70,CCHLOSI
          IF       @EQUAL
            OPEN     OUTSITA1,"outsitaf"
          ELSE
            MOVE     "outsitaf",KEY8
            STRIP    CCHLOSI
            PACK     KEY80,CCHLOSI,KEY8
            OPEN     OUTSITA1,KEY80
          ENDIF
          TRAPCLR  IO
          MOVE     OVRCD,OUTSITOP
.
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          MATCH    SP70,CCHLOPR
          IF       @EQUAL
            OPEN     OPRDETA2,"oprdetaf"
          ELSE
            MOVE     "oprdetaf",KEY8
            STRIP    CCHLOPR
            PACK     KEY80,CCHLOPR,KEY8
            OPEN     OPRDETA2,KEY80
          ENDIF
          TRAPCLR  IO
          MOVE     OVRCD,OPRDEAOP
.
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          MATCH    SP70,CCHLOPR
          IF       @EQUAL
            OPEN     OPRARDA1,"oprardaf"
          ELSE
            MOVE     "oprardaf",KEY8
            STRIP    CCHLOPR
            PACK     KEY80,CCHLOPR,KEY8
            OPEN     OPRARDA1,KEY80
          ENDIF
          TRAPCLR  IO
          MOVE     OVRCD,OPRARDOP
.
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          MATCH    SP70,CCHLOPR
          IF       @EQUAL
            OPEN     OPRSRGA1,"oprsrgaf"
          ELSE
            MOVE     "oprsrgaf",KEY8
            STRIP    CCHLOPR
            PACK     KEY80,CCHLOPR,KEY8
            OPEN     OPRSRGA1,KEY80
          ENDIF
          TRAPCLR  IO
          MOVE     OVRCD,OPRSRGOP
.
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          MATCH    SP70,CCHLOPR
          IF       @EQUAL
            OPEN     OPRSESA1,"oprsesaf"
          ELSE
            MOVE     "oprsesaf",KEY8
            STRIP    CCHLOPR
            PACK     KEY80,CCHLOPR,KEY8
            OPEN     OPRSESA1,KEY80
          ENDIF
          TRAPCLR  IO
          MOVE     OVRCD,OPRSESOP
.
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          MATCH    SP70,CCHLOPR
          IF       @EQUAL
            OPEN     OPRCLIA1,"oprcliaf"
          ELSE
            MOVE     "oprcliaf",KEY8
            STRIP    CCHLOPR
            PACK     KEY80,CCHLOPR,KEY8
            OPEN     OPRCLIA1,KEY80
          ENDIF
          TRAPCLR  IO
          MOVE     OVRCD,OPRCLIOP
.
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          MATCH    SP70,CCHLARF
          IF       @EQUAL
            OPEN     ALLREFA1,"allrefaf"
          ELSE
            MOVE     "allrefaf",KEY8
            STRIP    CCHLARF
            PACK     KEY80,CCHLARF,KEY8
            OPEN     ALLREFA1,KEY80
          ENDIF
          TRAPCLR  IO
          MOVE     OVRCD,ALLREFOP
.
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          MATCH    SP70,CCHLENC
          IF       @EQUAL
            OPEN     ALLENCA1,"allencaf"
            OPEN     ALLENCA4,"allencaf"
          ELSE
            MOVE     "allencaf",KEY8
            STRIP    CCHLENC
            PACK     KEY80,CCHLENC,KEY8
            OPEN     ALLENCA1,KEY80
            OPEN     ALLENCA4,KEY80
          ENDIF
          TRAPCLR  IO
          MOVE     OVRCD,ALLENCOP
.
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          MATCH    SP70,CCHLEVS
          IF       @EQUAL
            OPEN     EMRVISA4,"emrvisaf"
            OPEN     EMRVISA1,"emrvisaf"
          ELSE     
            MOVE     "emrvisaf",KEY8
            STRIP    CCHLEVS
            PACK     KEY80,CCHLEVS,KEY8
            OPEN     EMRVISA4,KEY80
            OPEN     EMRVISA1,KEY80
          ENDIF
          TRAPCLR  IO
          MOVE     OVRCD,EMRVISOP                                      
. 
OPPMS999  RETURN
.
.----------------------------
. Open Outpatient Details
.--------------------------
OUTBB100  PACK     CFNAME,OSTFILE,FILBB1A1
          TRAP     OVERCOND IF IO
          MOVE     CFNAME,KEY8
          MATCH    SP70,CCHLOBB
          IF       @EQUAL
            MOVE     ZERO,OVRCD
            OPEN     OUTBB1A1,KEY8
            OPEN     OUTBB1A2,KEY8
          ELSE
            STRIP    CCHLOBB
            PACK     KEY80,CCHLOBB,KEY8
            OPEN     OUTBB1A1,KEY80
            OPEN     OUTBB1A2,KEY80
          ENDIF
          TRAPCLR  IO
          MOVE     OVRCD,OUTBOBOP
.
          PACK     CFNAME,OSTFILE,FILBOKA6
          TRAP     OVERCOND IF IO
          MOVE     CFNAME,KEY8
          MATCH    SP70,CCHLOBB
          IF       @EQUAL
            MOVE     ZERO,OVRCD
            OPEN     OUTBOKA6,KEY8
          ELSE
            STRIP    CCHLOBB
            PACK     KEY80,CCHLOBB,KEY8
            OPEN     OUTBOKA6,KEY80
          ENDIF
          TRAPCLR  IO
          MOVE     OVRCD,OUTBOKOP
          RETURN
.
.-----------------------------------------
. Open Patient Master File
.--------------------------
PATMA100  TRAP     OVERCOND IF IO
          MOVE     "patma1af",KEY8
          MOVE     "patmx1af",D8              * Open Extension file a

          MATCH    SP70,CCHLPMA
          IF       @EQUAL
            MOVE     ZERO,OVRCD
            OPEN     PATMA1A1,KEY8
            OPEN     PATMX1A1,D8
            MOVE     "pmspx2af",D8
            OPEN     PMSPX2A1,D8
          ELSE
            STRIP    CCHLPMA
            PACK     KEY80,CCHLPMA,KEY8
            OPEN     PATMA1A1,KEY80
            PACK     KEY80,CCHLPMA,D8
            OPEN     PATMX1A1,KEY80
            MOVE     "pmspx2af",D8
            PACK     KEY80,CCHLPMA,D8
            OPEN     PMSPX2A1,KEY80
          ENDIF
          TRAPCLR  IO
          MOVE     OVRCD,PATMASOP
          RETURN
.-----------------------------------------
. Open Admission File
.---------------------
PATMI100  TRAP     OVERCOND IF IO
          MOVE     "patmi1af",KEY8
          MATCH    SP70,CCHLPMI
          IF       @EQUAL
            MOVE     ZERO,OVRCD
            OPEN     PATMI1A1,KEY8
            OPEN     PATMI1A3,KEY8
          ELSE
            STRIP    CCHLPMI
            PACK     KEY80,CCHLPMI,KEY8
            OPEN     PATMI1A1,KEY80
            OPEN     PATMI1A3,KEY80
          ENDIF
          TRAPCLR  IO
          MOVE     OVRCD,PATMISOP
          RETURN
.
.-----------------------------------------
.
. Open Doctors File
.----------------------
PATDOC00  TRAP     OVERCOND IF IO
          MOVE     "patdo1af",KEY8
          MATCH    SP70,CCHLPDC
          IF       @EQUAL
            MOVE     ZERO,OVRCD
            OPEN     PATDO1A1,KEY8

          ELSE
            STRIP    CCHLPDC
            PACK     KEY80,CCHLPDC,KEY8
            OPEN     PATDO1A1,KEY80

          ENDIF
          TRAPCLR  IO
          MOVE     OVRCD,PATDOCOP
          RETURN
.
.----------------------------------------------------------
. Extract Patient Data From IBA Patient Management System
.----------------------------------------------------------
EXTR0000  BRANCH   PATINVOP,EXTR9100
          BRANCH   PATDTROP,EXTR9100
          BRANCH   PATMASOP,EXTR9100
          BRANCH   PATVISOP,EXTR9100
          BRANCH   PATCODOP,EXTR9100
          BRANCH   PATDSCOP,EXTR9100
          BRANCH   PATMISOP,EXTR9100
          READ      CONTROLF,FORTY;*111,OPCNCLSU
          READ      CONTROLF,SIXTY4;*177,CCCOSOPR:
                                    *183,CCCOTH1,CCCOTH2,CCCOTH3,CCCOTH4:
                                         CCCOTF1,CCCOTF2,CCCOTF3,CCCOTF4:
                                         CCCOTT1,CCCOTT2,CCCOTT3,CCCOTT4
.
. First Scan Admissions for the Date Range Entered
.--------------------------------------------------
          CALL     SCAN0000
.
          MOVE     ZERO,TOTALERR
          MOVE     ZERO,TOTALSCN
          MOVE     ZERO,TOTALCOM
          MOVE     "99",CLNO
          MOVE     ZERO,CPAGENO
          CLOCK    TIME,CTIMEIS
          DISPLAY  *P1:24,*EL,"Started : ",CTIMEIS
          PACK     KEY19,SP70
          CALL     RSCCEP2
EXTR1000  CALL     RKCCEP2            * Only Process Incomplete Records
          BRANCH   OVRCD,EXTR9000
          MATCH    "1",CCEPCOM
          GOTO     EXTR9000 IF EQUAL
.
          MATCH    CCHCHCD,CCEPHCD   * Only Process a Single Hospital
          GOTO     EXTR1000 IF NOT EQUAL
.
          PACK     SAVKEY19,CCEPCOM,CCEPHCD,CCEPEPS
.
          ADD      ONE,TOTALSCN      * Total Processed
          IF       (TOTALSCN%1000=0)
            CLOCK    TIME,CTIMEIS
            DISPLAY   *P20:24,*EL,"Records Complete : ",TOTALSCN:
                     " at ",CTIMEIS
          ENDIF
          PACK     KEY18,CCEPHCD,CCEPEPS
          CALL     RDCCIA1
          IF       OVRCD=1
            CALL     CLRIAD00
            UNPACK   KEY18,CCIAHCD,CCIAEPS
          ENDIF
.
          CALL     READ0000
          BRANCH   EXIT,EXTR1000
.
          PACK     CCEPLTD,CCC,CYY,CMM,CDD
          REP      " 0",CCEPLTD
.
          CALL     GETDTY00        * Get Doctor Types
.
          PACK     KEY18,CCEPHCD,CCEPEPS
          UNPACK   KEY18,CCIAHCD,CCIAEPS
          MOVE     SP70,CCIASPA
          CALL     RACCIA1
          IF       OVRCD=0
            CALL     UPCCIA1
          ELSE
            CALL     WRCCIA1
          ENDIF
.
          CALL     EPSDWT00        * Update DRG Weights for WIES     * moved up
.
          CALL     UPCCEP2         * Only Process Incomplete Records
.
....      CALL     EPSDWT00        * Update DRG Weights for WIES     * moved
.
          MATCH    "1",CCEPCOM
          IF       @EQUAL
            ADD      ONE,TOTALCOM  * Total Completed
            MOVE     SAVKEY19,KEY19
            CALL     RDCCEP2       * Reposition for Next Readks
          ENDIF
          GOTO     EXTR1000
.
EXTR9000  COMPARE   ZERO,CPAGENO
          CALL      HEAD0000 IF EQUAL
          CALL      UND80
          PRINT     *20,TOTALERR," Error Records Printed."
          PRINT     *20,TOTALSCN," Episode Records Scanned."
          PRINT     *20,TOTALCOM," Episode Records Completed."
          CALL      UND80
          GOTO      EXTR9999
EXTR9100  BEEP
          CLEAR    DISPMSG
          APPEND   "Unable to Process. ",DISPMSG
          APPEND   "Not Enough Files Available. - ",DISPMSG
          RESET    DISPMSG
          CALL     MESSAGE1
          GOTO     EXTR9999
EXTR9999  CALL     CLOSE000
          RETURN
.
.-------------------------------------------------------------------------------
. Scan Visit File for the Visit Number Range Entered and Create any New Records
.-------------------------------------------------------------------------------
SCAN0000  CALL     CLREPS00
          CALL     CLRIAD00
.
. Inpatients
.------------
          MOVE     ZERO,SECTOR
          DISPLAY   *P1:24,*EL,"Scanning Inpatients  : "
          PACK     KEY16,STRDAT,SP70
          CALL     RDSMISS3                                            * V90200
SCAN1000  CALL     RDKMISS3                                            * V90200
          BRANCH   OVRCD,SCAN1900
          MATCH    ADATE,ENDDAT                                        * V90200
          GOTO     SCAN1900 IF LESS
          ADD      ONE,SECTOR
          IF       (SECTOR%100=0)
            DISPLAY   *P24:24,*V2LON,DAADMNO,"/",SECTOR                * V90200
          ENDIF
          MOVE      ZERO,F1
          MOVE      ASTAT,F1                                           * V90200
          BRANCH    F1,SCAN1000,SCAN1200,SCAN1200,SCAN1200,SCAN1000
SCAN1200  MOVE     DAADMNO,KEY8                                        * V90200
          MOVE     AURNO,CCEPURN                                       * V90200
          CALL     WRTEPS00
          GOTO     SCAN1000
.
. Emergency 
.-------
SCAN1900  BRANCH   EMRVISOP,SCAN2900
          MOVE     ZERO,SECTOR
          DISPLAY  *P1:24,*EL,"Scanning Emergency   : "
.
          PACK     KEY24,STRDAT,SP70
          CALL     RSEMVIS4
SCAN2000  CALL     RKEMVIS4
          BRANCH   OVRCD,SCAN2900
.
          MATCH    EMVIDATE,ENDDAT
          GOTO     SCAN2900 IF LESS
.
          BRANCH   EMVISTAT,SCAN2000,SCAN2100,SCAN2100,SCAN2000        
.                                              * Only include discharged visits
.
SCAN2100  ADD      ONE,SECTOR
          IF       (SECTOR%100=0)
            DISPLAY   *P24:24,*V2LON,EMVIADMN,"/",SECTOR    
          ENDIF
.
          MOVE     DEMVIADM,KEY8                          
          MOVE     EMVIURNO,CCEPURN                       
          CALL     WRTEPS00
          GOTO     SCAN2000
.
. Outpatients
.-------------
SCAN2900  BRANCH   OUTSITOP,SCAN4000
          MOVE     ZERO,SECTOR
          DISPLAY  *P1:24,*EL,"Scanning Outpatients : "
          PACK     KEY6,SP70
          CALL     RDSSITA1
SCAN3000  CALL     RDKSITA1
          BRANCH   OVRCD,SCAN4000
.
          CLOSE    OUTBB1A2
          MATCH    SP70,CCHLOBB
          IF       @EQUAL
            CLEAR     KEY80
            APPEND    OSTFILE,KEY80
            APPEND    "bb1af",KEY80
            RESET     KEY80
          ELSE
            CLEAR     KEY8
            APPEND    OSTFILE,KEY8
            APPEND    "bb1af",KEY8
            RESET     KEY8
            STRIP    CCHLOBB
            PACK     KEY80,CCHLOBB,KEY8
          ENDIF
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      OUTBB1A2,KEY80
          TRAPCLR   IO
          BRANCH    OVRCD,SCAN3000
.
          PACK     KEY16,STRDAT,SP70
          CALL     RDSBOKB2
SCAN3100  CALL     RDKBOKB2
          BRANCH   OVRCD,SCAN3000
.
          MATCH    OBADATE,ENDDAT
          GOTO     SCAN3000 IF LESS
          ADD      ONE,SECTOR
          IF       (SECTOR%100=0)
            DISPLAY   *P24:24,*V2LON,OSTFILE,"/",DOBAOUTN,"/",SECTOR
          ENDIF
          MOVE     DOBAOUTN,KEY8
          CALL     RDVISA1                  * Include attended only
          BRANCH   OVRCD,SCAN3100
.
          MOVE     PVIURNO,CCEPURN
          CALL     WRTEPS00
          GOTO     SCAN3100
.
. Allied Health
.
SCAN4000  BRANCH   ALLENCOP,SCAN9000
.
          MOVE     ZERO,SECTOR
          DISPLAY  *P1:24,*EL,"Scanning Allied Health: "
          PACK     KEY24,STRDAT,SP70
          CALL     RSALENC4
SCAN4100  CALL     RKALENC4
          BRANCH   OVRCD,SCAN9000
.
          MATCH    ALENSDAT,ENDDAT
          GOTO     SCAN9000 IF LESS
.
          MATCH    "1",ALENRSTA             * Encounter is cancelled
          GOTO     SCAN4100 IF EQUAL
.
          ADD      ONE,SECTOR
          IF       (SECTOR%100=0)
            DISPLAY   *P24:24,*V2LON,ALENVISN,"/",ALENENCT,"/",SECTOR
          ENDIF
.
          MOVE     ALENVISN,KEY8
          CALL     RDVISA1
          BRANCH   OVRCD,SCAN4100
.
          MOVE     PVIURNO,CCEPURN
          CALL     WREEPS00                 * Write allied health episode
          GOTO     SCAN4100

SCAN9000  RETURN
.
.------------------------------------------------------------
. Read Patient System Information Where Possible
.------------------------------------------------------------
READ0000  MATCH     "10",CCEPVIST           * Allied health so extract 3 char
          GOTO      READ0500 IF NOT EQUAL   * encounter number from ccepeps
.
READXXXX  MOVE      CCEPEPS,KEY16
          SQUEEZE   KEY16
          MOVE      KEY16,FORM16
          MOVE      FORM16,DIM16
          UNPACK    DIM16,DIM8,DIM8A
          MOVE      DIM8,PVIBILL
          MOVE      PVIBILL,SAVEEPS         * Referral Number
          MOVE      DIM8A,ENCNNUMB
          REP       "0 ",ENCNNUMB           * Encounter Number
.
          GOTO      READ0600
.
READ0500  MOVE      CCEPEPS,KEY16
          SQUEEZE   KEY16
          MOVE      KEY16,PVIBILL
          MOVE      PVIBILL,SAVEEPS
.
READ0600  MOVE      PVIBILL,KEY8
          CALL      RDVISA1         * Read Visit Record for This Admission
          BRANCH    OVRCD,READ9010  * Delete episode if not visit record
.
          MOVE      PVIBILL,KEY8
          CALL      RDPMVX11        * Read Visit Extn Record for This Admission
          BRANCH    OVRCD,READ9010  * Delete episode if no visit extn record
.
          MATCH     "00000000",PVIDATE
          GOTO      READ9010 IF EQUAL
.
          CALL      UPVIS000        * Update any Visit Details to Episode File
.
          MOVE      PVIURNO,KEY8
          CALL      RDMAST1                                            * V90200
          IF        OVRCD=0
            MOVE      PVIURNO,KEY8
            CALL      RDPMPX21
            IF        OVRCD=1
              MOVE      "No Patient Masterfile Entn Record",DISPMSG
              CALL      WARN0000
            ENDIF
            CALL      UPMAS000      * Update any Master Details to Episode File
          ELSE
            MOVE      "No Patient Masterfile Record",DISPMSG
            CALL      WARN0000
          ENDIF
.
          MOVE      ZERO,CCEPINPT
          BRANCH    PVITYPE,READ1000,READ2000,READ3000,READ7000,READ8000
.
          MATCH    "10",PTVITYPE            * Allied Health
          GOTO     READ6000 IF EQUAL
.
          GOTO      READ9020        * Err 2 "Invalid Visit Type"
.
. EMR Patient
.--------------
READ1000  MOVE     ONE,CCEPLOS
          MOVE     ONE,CCIALOS
          MOVE     ZERO,CCIABA1
          MOVE     ZERO,CCIABA2
          MOVE     ZERO,CCIABA3
          MOVE     ONE,CCEPDAY
          CALL     REMR0000         * Read & Update EMR Details
.
          CALL     PATCALCR        * Calculate Income and LOS Details
.
          MOVE     THTREVNE,CCIAITH
          MOVE     AC1REVNE,CCIAIA1
          MOVE     AC2REVNE,CCIAIA2
          MOVE     AC3REVNE,CCIAIA3
          MOVE     ACOREVNE,CCIAIAO
          MOVE     OT1REVNE,CCIAIM1
          MOVE     OT2REVNE,CCIAIM2
          MOVE     OT3REVNE,CCIAIM3
          MOVE     OTOREVNE,CCIAIMO
.
          GOTO     READ9900
.
. Outpatient
.--------------
READ2000  MOVE     ONE,CCEPLOS
          MOVE     ONE,CCIALOS
          MOVE     ZERO,CCIABA1
          MOVE     ZERO,CCIABA2
          MOVE     ZERO,CCIABA3
          MOVE     ONE,CCEPDAY
          CALL     ROUT0000         * Read & Update Outpatient Details
.
          CALL     PATCALCR         * Calculate Income and LOS Details
.
          MOVE     THTREVNE,CCIAITH
          MOVE     AC1REVNE,CCIAIA1
          MOVE     AC2REVNE,CCIAIA2
          MOVE     AC3REVNE,CCIAIA3
          MOVE     ACOREVNE,CCIAIAO
          MOVE     OT1REVNE,CCIAIM1
          MOVE     OT2REVNE,CCIAIM2
          MOVE     OT3REVNE,CCIAIM3
          MOVE     OTOREVNE,CCIAIMO
.
          GOTO     READ9900
.
. Inpatients
.--------------
READ3000  CALL     RINP0000         * Read & Update Inpatient Details
          MOVE     ONE,CCEPINPT
.
          CALL     ROPR0000         * Read Operation Details
.
          CALL     PATCALCR         * Calculate Income and LOS Details
.
          MOVE     TOTPBDAY,CCEPLOS
          MOVE     TOTPBDAY,CCIALOS
          MOVE     TO1PBDAY,CCIABA1
          MOVE     TO2PBDAY,CCIABA2
          MOVE     TO3PBDAY,CCIABA3
          MOVE     THTREVNE,CCIAITH
          MOVE     AC1REVNE,CCIAIA1
          MOVE     AC2REVNE,CCIAIA2
          MOVE     AC3REVNE,CCIAIA3
          MOVE     ACOREVNE,CCIAIAO
          MOVE     OT1REVNE,CCIAIM1
          MOVE     OT2REVNE,CCIAIM2
          MOVE     OT3REVNE,CCIAIM3
          MOVE     OTOREVNE,CCIAIMO
.
          IF        CCEPLOS=0
            MOVE      ONE,CCEPLOS
            MOVE      ONE,CCIALOS
          ENDIF
.
          MOVE     ZERO,CCEPDAY
          MATCH    CCEPADAT,CCEPDDAT
          IF       @EQUAL
            MOVE     ONE,CCEPDAY
          ENDIF
          GOTO     READ9900
.
. Allied Health
.-----------------
READ6000  MOVE     ONE,CCEPLOS
          MOVE     ONE,CCIALOS
          MOVE     ZERO,CCIABA1
          MOVE     ZERO,CCIABA2
          MOVE     ZERO,CCIABA3
          MOVE     ONE,CCEPDAY
          CALL     RALL0000         * Read & Update Outpatient Details
.
          CALL     ALCL0000         * Calculate Income and LOS Details
.
          MOVE     ZERO,CCIAITH
          MOVE     ZERO,CCIAIA1
          MOVE     ZERO,CCIAIA2
          MOVE     ZERO,CCIAIA3
          MOVE     ZERO,CCIAIAO
          MOVE     OT1REVNE,CCIAIM1
          MOVE     OT2REVNE,CCIAIM2
          MOVE     OT3REVNE,CCIAIM3
          MOVE     OTOREVNE,CCIAIMO   
          GOTO     READ9900

. Other Financial
.-----------------
READ7000  MOVE     "Invalid Visit Type 4. ",DISPMSG
          CALL     WARN0000
          GOTO     READ9990
.
. Day Centre
.-----------------
READ8000  MOVE     "Invalid Visit Type 5. ",DISPMSG
          CALL     WARN0000
          GOTO     READ9900
.
READ9010  MOVE     ONE,EXIT
          PACK     KEY19,CCEPCOM,CCEPHCD,CCEPEPS,SP70
          CALL     DECCEP2
          GOTO     READ9999
.
READ9020 MOVE     "Invalid Visit Type. ",DISPMSG
          CALL     WARN0000
          GOTO     READ9990
.
READ9900  CALL     RMED0000       * Get Operation and Diagnosis Codes
READ9990  MOVE     ZERO,EXIT
READ9999  RETURN
.
.-------------------------------------------------------------------
. Read Medical Coding for Operation, ICD Diagnosis and MBS Coding
.-------------------------------------------------------------------
RMED0000  BRANCH   PATMOPOP,RMED1000
          PACK     KEY16,SAVEEPS,SP70
          CALL     RSPTECO2
          CALL     RKPTECO2
          BRANCH   OVRCD,RMED1000
          COMPARE  SAVEEPS,PTEOADMN
          GOTO     RMED1000 IF NOT EQUAL
          MOVE     PTEOCODE,CCEPPOPP
.
          CALL     RKPTECO2
          BRANCH   OVRCD,RMED1000
          COMPARE  SAVEEPS,PTEOADMN
          GOTO     RMED1000 IF NOT EQUAL
          MOVE     PTEOCODE,CCEPSOPP
.
RMED1000  BRANCH   PATMDIOP,RMED2000
          PACK     KEY16,SAVEEPS,SP70
          CALL     RSPTECD2
          CALL     RKPTECD2
          BRANCH   OVRCD,RMED2000
          COMPARE  SAVEEPS,PTEDADMN
          GOTO     RMED2000 IF NOT EQUAL
          MOVE     PTEDCODE,CCEPPDIA
.
          CALL     RKPTECD2
          BRANCH   OVRCD,RMED2000
          COMPARE  SAVEEPS,PTEDADMN
          GOTO     RMED2000 IF NOT EQUAL
          MOVE     PTEDCODE,CCEPSDIA
.
.                                           * read MBS Items from DTR *I-211125
RMED2000  PACK      CCEPPMBS,SP70
          PACK      CCEPSMBS,SP70
          MOVE      ZERO,F2
          MOVE      ZERO,FORM5A
          MOVE      ZERO,FORM5B
.
          MOVE      "2",KEY1                 * select Theatre items only
          PACK      KEY18,SAVEEPS,KEY1,SP20
          CALL      RDSDTRN3                 * position on DTR
RMED2002  CALL      RDKDTRN3
          BRANCH    OVRCD,RMED9999
.
          COMPARE   SAVEEPS,TADMNO
          GOTO      RMED9999 IF NOT EQUAL
          MATCH     "2",DTRECTYP
          GOTO      RMED9999 IF NOT EQUAL
.                                           * find first two Items
          MATCH     "1",PTDTCRST       * ignore credited items
          GOTO      RMED2002 IF EQUAL
.
          MATCH     "2",PTDTCRST
          GOTO      RMED2002 IF EQUAL
.   
          IF        F2=0
            MOVE      TTRANSN1,FORM5A
            MOVE      TITEMNO,CCEPPMBS
            MOVE      ONE,F2
            GOTO      RMED2002
          ENDIF
.
          COMPARE   FORM5A,TTRANSN1
          IF        @LESS
            MOVE      FORM5A,FORM5B
            MOVE      TTRANSN1,FORM5A
            MOVE      CCEPPMBS,CCEPSMBS
            MOVE      TITEMNO,CCEPPMBS
            MOVE      ONE,F2
            GOTO      RMED2002
          ENDIF
.
          IF        F2=1
            MOVE      TTRANSN1,FORM5B
            MOVE      TITEMNO,CCEPSMBS
            MOVE      TWO,F2
            GOTO      RMED2002
          ENDIF
.
          COMPARE   FORM5B,TTRANSN1
          IF        @LESS
            MOVE      TTRANSN1,FORM5B
            MOVE      TITEMNO,CCEPSMBS
            ADD       ONE,F2
            GOTO      RMED2002
          ENDIF
.
          GOTO      RMED2002
.
RMED9999  RETURN
.
.------------------------------------------------------------
. Get Doctor Types
.------------------------------------------------------------
GETDTY00  BRANCH   PATDOCOP,GETDTY99
          PACK     KEY6,CCEPAADC
          MATCH    SP70,KEY6
          GOTO     GETDTY10 IF EQUAL
          CALL     RDDOCT1                                             * V90200
          BRANCH   OVRCD,GETDTY10
          MOVE     DRTYPE,CCEPASER                                     * V90200
.
GETDTY10  PACK     KEY6,CCEPDADC
          MATCH    SP70,KEY6
          GOTO     GETDTY99 IF EQUAL
          CALL     RDDOCT1                                             * V90200
          BRANCH   OVRCD,GETDTY99
          MOVE     DRTYPE,CCEPDSER                                     * V90200
.
GETDTY99  RETURN
.
.----------------------------------------------------------------------
. Clear Epsiode Record
.----------------------------------------------------------------------
CLREPS00  MOVE      SP70,CCEPHCD
          MOVE      SP70,CCEPEPS
          MOVE      SP70,CCEPSUR
          MOVE      SP70,CCEPGIV
          MOVE      SP70,CCEPCOM
          MOVE      SP70,CCEPURN
          MOVE      SP70,CCEPSDT
          MOVE      SP70,CCEPLTD
          MOVE      ZERO,CCEPLOS
          MOVE      SP70,CCEPINPT
          MOVE      SP70,CCEPDAY
          MOVE      SP70,CCEPVIST
          MOVE      SP70,CCEPSEX
          MOVE      SP70,CCEPDOB
          MOVE      SP70,CCEPAGEY
          MOVE      SP70,CCEPAGEM
          MOVE      SP70,CCEPAGED
          MOVE      SP70,CCEPCOB
          MOVE      SP70,CCEPREL
          MOVE      SP70,CCEPDDAT
          MOVE      SP70,CCEPDWAR
          MOVE      SP70,CCEPDSTA
          MOVE      SP70,CCEPDDES
          MOVE      SP70,CCEPDMBS
          MOVE      SP70,CCEPDDPT
          MOVE      SP70,CCEPDSER
          MOVE      SP70,CCEPMDCC
          MOVE      SP70,CCEPDRGC
          MOVE      SP70,CCEPADAT
          MOVE      SP70,CCEPAWAR
          MOVE      SP70,CCEPASRC
          MOVE      SP70,CCEPACLS
          MOVE      SP70,CCEPACAR
          MOVE      SP70,CCEPADPT
          MOVE      SP70,CCEPASER
          MOVE      SP70,CCEPARDC
          MOVE      SP70,CCEPATDC
          MOVE      SP70,CCEPAADC
          MOVE      SP70,CCEPDADC
          MOVE      SP70,CCEPAHFD
          MOVE      SP70,CCEPAHTB
          MOVE      SP70,CCEPAMBS
          MOVE      SP70,CCEPOPCL
          MOVE      SP70,CCEPPDIA
          MOVE      SP70,CCEPSDIA
          MOVE      SP70,CCEPPOPP
          MOVE      SP70,CCEPSOPP
          MOVE      SP70,CCEPEXC
          MOVE      SP70,CCEPPMBS
          MOVE      SP70,CCEPSMBS
          MOVE      SP70,CCEPMU1
          MOVE      SP70,CCEPMU2
          MOVE      SP70,CCEPMU3
          MOVE      SP70,CCEPMU4
          MOVE      SP70,CCEPMU5
          MOVE      SP70,CCEPMU6
          MOVE      SP70,CCEPMU7
          MOVE      SP70,CCEPPCD
          MOVE      SP70,CCEPCLM
          MOVE      SP70,CCEPCLI
          MOVE      SP70,CCEPCTY
          MOVE      SP70,CCEPANA
          MOVE      SP70,CCEPOTY
          MOVE      SP70,CCEPTTR
          MOVE      SP70,CCEPOY6
          MOVE      SP70,CCEPOY7
          MOVE      SP70,CCEPOY8
          MOVE      SP70,CCEPOY9
          MOVE      SP70,CCEPORM
          MOVE      SP70,CCEPOKI
          MOVE      SP70,CCEPOTP
          MOVE      SP70,CCEPTST
          MOVE      SP70,CCEPINS
          MOVE      SP70,CCEPTIM
          MOVE      SP70,CCEPTDP
          MOVE      SP70,CCEPAST
          MOVE      SP70,CCEPAMD
          MOVE      SP70,CCEPAU1
          MOVE      SP70,CCEPAU2
          MOVE      SP70,CCEPAU3
          MOVE      SP70,CCEPAU4
          MOVE      SP70,CCEPAU5
          MOVE      SP70,CCEPAU6
          MOVE      SP70,CCEPAU7
          MOVE      SP70,CCEPAU8
          MOVE      SP70,CCEPAWT
          MOVE      SP70,CCEPAPR
          MOVE      SP70,CCEPAET
          MOVE      SP70,CCEPART
          MOVE      SP70,CCEPAIN
          MOVE      SP70,CCEPAPL
          MOVE      SP70,CCEPAPY
          MOVE      SP70,CCEPOST
          MOVE      SP70,CCEPOCL
          MOVE      SP70,CCEPOCT
          MOVE      SP70,CCEPOVT
          MOVE      SP70,CCEPODY
          MOVE      SP70,CCEPOSS
          MOVE      SP70,CCEPODS
          MOVE      SP70,CCEPOAT
          MOVE      SP70,CCEPOPR
          MOVE      SP70,CCEPOU1
          MOVE      SP70,CCEPOU2
          MOVE      SP70,CCEPOU3
          MOVE      SP70,CCEPOU4
          MOVE      SP70,CCEPODP
          MOVE      SP70,CCEPOTR
          MOVE      SP70,CCEPOLG
          MOVE      SP70,CCEPOOT
          MOVE      SP70,CCEPMU8
          MOVE      SP70,CCEPMU9
          MOVE      SP70,CCEPMU10
          MOVE      SP70,CCEPPHP
          MOVE      SP70,CCEPAGN
          MOVE      ZERO,CCEPVW5
          MOVE      ZERO,CCEPV5A
.
          MOVE      SP70,CCEPCMX  
          MOVE      ZERO,CCEPV8A  
          MOVE      ZERO,CCEPINTR 
          MOVE      SP70,CCEPSTAT 
          MOVE      SP70,CCEPCIND 
          MOVE      SP70,CCEPSPCA 
          MOVE      SP70,CCEPRSTA 
          MOVE      SP70,CCEPRHCP 
          MOVE      SP70,CCEPPRB1 
          MOVE      SP70,CCEPPRB2 
          MOVE      SP70,CCEPPRB3 
          MOVE      SP70,CCEPDIA1 
          MOVE      SP70,CCEPDIA2 
          MOVE      SP70,CCEPDIA3 
          MOVE      SP70,CCEPENCN 
          MOVE      SP70,CCEPSERP 
          MOVE      SP70,CCEPACTY 
          MOVE      SP70,CCEPSERD 
          MOVE      SP70,CCEPPTYP 
          MOVE      SP70,CCEPSTYP 
          MOVE      ZERO,CCEPDUNT 
          MOVE      ZERO,CCEPDBUN 
          MOVE      ZERO,CCEPIUNT 
          MOVE      ZERO,CCEPIBUN 
          MOVE      SP70,CCEPABRG 
          MOVE      SP70,CCEPCADM 
          MOVE      SP70,CCEPIRAD 
          MOVE      SP70,CCEPIDUS 
          MOVE      SP70,CCEPCRAV 
          MOVE      SP70,CCEPRCCT 
          MOVE      ZERO,CCEPINDC 
          MOVE      SP70,CCEPMDAV 
          MOVE      SP70,CCEPCSNG 
          MOVE      SP70,CCEPASUT 
          MOVE      SP70,CCEPELPS 
          MOVE      SP70,CCEPEMPL 
          MOVE      SP70,CCEPFINP 
          MOVE      SP70,CCEPOCCP 
          MOVE      SP70,CCEPPALC 
          MOVE      SP70,CCEPPPAL 
          MOVE      SP70,CCEPPPPT 
          MOVE      SP70,CCEPPSOS 
          MOVE      SP70,CCEPPYSP 
          MOVE      SP70,CCEPQLDB 
          MOVE      SP70,CCEPREAD 
          MOVE      SP70,CCEPUDIN 
          MOVE      SP70,CCEPUREA 
          MOVE      SP70,CCEPUSAC 
          MOVE      SP70,CCEPUVTH 
          MOVE      SP70,CCEPDVAC 
          MOVE      SP70,CCEPFLDR 
          MOVE      SP70,CCEPPCCL 
          MOVE      SP70,CCEPSDRG
          MOVE      ZERO,CCEPUINT
          MOVE      ZERO,CCEPUCCU
          MOVE      ZERO,CCEPUMEC
          MOVE      ZERO,CCEPCPAP
          MOVE      SP70,CCEPRCLO
          MOVE      SP70,CCEPSRCE
          MOVE      SP70,CCEPDEPT
          MOVE      SP70,CCEPSTYP
          MOVE      SP70,CCEPASIT
          MOVE      SP70,CCEPUC21
          MOVE      SP70,CCEPUC09
          MOVE      SP70,CCEPUC20
          MOVE      SP70,CCEPUC28
          MOVE      SP70,CCEPRHC1
          MOVE      SP70,CCEPADTS
          MOVE      SP70,CCEPDCTS
          MOVE      SP70,CCEPSPA
.
          RETURN
.
CLRIAD00  MOVE      SP70,CCIAHCD
          MOVE      SP70,CCIAEPS
          MOVE      ZERO,CCIABA1
          MOVE      ZERO,CCIABA2
          MOVE      ZERO,CCIABA3
          MOVE      ZERO,CCIALOS
          MOVE      ZERO,CCIAITH
          MOVE      ZERO,CCIAIA1
          MOVE      ZERO,CCIAIA2
          MOVE      ZERO,CCIAIA3
          MOVE      ZERO,CCIAIAO
          MOVE      ZERO,CCIAIM1
          MOVE      ZERO,CCIAIM2
          MOVE      ZERO,CCIAIM3
          MOVE      ZERO,CCIAIMO
.
          MOVE      ZERO,CCIAETH1
          MOVE      ZERO,CCIAETH2
          MOVE      ZERO,CCIAETH3
          MOVE      ZERO,CCIAETH4
          MOVE      ZERO,CCIAETH5
.
          MOVE      ZERO,CCIAEA11
          MOVE      ZERO,CCIAEA12
          MOVE      ZERO,CCIAEA13
          MOVE      ZERO,CCIAEA14
          MOVE      ZERO,CCIAEA15
.
          MOVE      ZERO,CCIAEA21
          MOVE      ZERO,CCIAEA22
          MOVE      ZERO,CCIAEA23
          MOVE      ZERO,CCIAEA24
          MOVE      ZERO,CCIAEA25
.
          MOVE      ZERO,CCIAEA31
          MOVE      ZERO,CCIAEA32
          MOVE      ZERO,CCIAEA33
          MOVE      ZERO,CCIAEA34
          MOVE      ZERO,CCIAEA35
.
          MOVE      ZERO,CCIAEAO1
          MOVE      ZERO,CCIAEAO2
          MOVE      ZERO,CCIAEAO3
          MOVE      ZERO,CCIAEAO4
          MOVE      ZERO,CCIAEAO5
.
          MOVE      ZERO,CCIAEM11
          MOVE      ZERO,CCIAEM12
          MOVE      ZERO,CCIAEM13
          MOVE      ZERO,CCIAEM14
          MOVE      ZERO,CCIAEM15
.
          MOVE      ZERO,CCIAEM21
          MOVE      ZERO,CCIAEM22
          MOVE      ZERO,CCIAEM23
          MOVE      ZERO,CCIAEM24
          MOVE      ZERO,CCIAEM25
.
          MOVE      ZERO,CCIAEM31
          MOVE      ZERO,CCIAEM32
          MOVE      ZERO,CCIAEM33
          MOVE      ZERO,CCIAEM34
          MOVE      ZERO,CCIAEM35
.
          MOVE      ZERO,CCIAEMO1
          MOVE      ZERO,CCIAEMO2
          MOVE      ZERO,CCIAEMO3
          MOVE      ZERO,CCIAEMO4
          MOVE      ZERO,CCIAEMO5
.
          MOVE      ZERO,CCIATT1
          MOVE      ZERO,CCIATT2
          MOVE      ZERO,CCIATT3
          MOVE      ZERO,CCIATT4
.
          RETURN
.
.------------------------------------------------------------
. Update Single Episode
.------------------------------------------------------------
EPSUP000  READ      CONTROLF,FORTY;*111,OPCNCLSU
          READ      CONTROLF,SIXTY4;*177,CCCOSOPR:
                                    *183,CCCOTH1,CCCOTH2,CCCOTH3,CCCOTH4:
                                         CCCOTF1,CCCOTF2,CCCOTF3,CCCOTF4:
                                         CCCOTT1,CCCOTT2,CCCOTT3,CCCOTT4
.
          PACK     KEY18,CCEPHCD,CCEPEPS
          CALL     RDCCIA1
          IF       OVRCD=1
            CALL     CLRIAD00
            UNPACK   KEY18,CCIAHCD,CCIAEPS
          ENDIF
.
          CALL     READ0000
          BRANCH   EXIT,EXTR1000
.
          PACK     CCEPLTD,CCC,CYY,CMM,CDD
          REP      " 0",CCEPLTD
.
          CALL     GETDTY00        * Get Doctor Types
.
          PACK     KEY18,CCEPHCD,CCEPEPS
          UNPACK   KEY18,CCIAHCD,CCIAEPS
          MOVE     SP70,CCIASPA
          CALL     RACCIA1
          IF       OVRCD=0
            CALL     UPCCIA1
          ELSE
            CALL     WRCCIA1
          ENDIF
.
          CALL     EPSDWT00        * Update DRG Weights for WIES   * moved up
.
          CALL     UPCCEP1
.
....      CALL     EPSDWT00        * Update DRG Weights for WIES   * moved
.
EPSUP999  RETURN
.
.------------------------------------------------------------
. Get WIES Weights if Available
.------------------------------------------------------------
EPSDWT00  MOVE      CCEPEPS,KEY16
          SQUEEZE   KEY16
          MOVE      KEY16,PVIBILL
          MOVE      PVIBILL,SAVEEPS
          MOVE      PVIBILL,KEY8
.
          MOVE      DRGVERS,KEY3                                      *C-145161
          PACK      KEY13,PVIBILL,SP1,ONE,KEY3
.
          CALL      RDPTPGR1
          BRANCH    OVRCD,EPSDWT90
EPSDWT20  PACK      KEY18,CCEPHCD,CCEPEPS,SP70
          UNPACK    KEY18,CCEWHCD,CCEWEPS
          CALL      RDCCEW1
          IF        OVRCD=0
            MOVE      PTPGWFIX,CCEWFWT
            MOVE      PTPGWVAR,CCEWVWT
            MOVE      PTPGWTOL,CCEWTWT
            MOVE      PTPGPCCL,CCEPPCCL
            MOVE      PTPGSDRG,CCEPSDRG
            CALL      UPCCEW1
          ELSE
            MOVE      PTPGWFIX,CCEWFWT
            MOVE      PTPGWVAR,CCEWVWT
            MOVE      PTPGWTOL,CCEWTWT
            MOVE      PTPGPCCL,CCEPPCCL
            MOVE      PTPGSDRG,CCEPSDRG
            MOVE      SP70,CCEWSPA
            CALL      WRCCEW1
          ENDIF
.
EPSDWT90  PACK      KEY8,PVIBILL,SP70
          CALL      RDPTICU1
          BRANCH    OVRCD,EPSDWT99
.
          MOVE      PTICUINT,FORM4          * (form 5 to form 4)      *C-250267
          MOVE      FORM4,CCEPUINT          * Hrs in Intensive Care
          MOVE      PTICUCCU,FORM4          * (form 5 to form 4)      *C-250267
          MOVE      FORM4,CCEPUCCU          * Hrs in Critical Care
          MOVE      PTICUMEC,FORM4          * (form 5 to form 4)      *C-250267
          MOVE      FORM4,CCEPUMEC          * Hrs on Mech Vent
          MOVE      PTICCPAP,CCEPCPAP       * Hrs on Const Pos Air
.
EPSDWT99  RETURN
.
HEAD0000  CALL     HEAD80
          PRINT    "Epispode Interface Errors and Warnings Report"
          CALL     UND80
          PRINT    "Hospital/Episode    U/R No.    Message"
          CALL     UND80
          RETURN
.
WRTEPS00  PACK     KEY16,KEY8,SP70
          SQUEEZE  KEY16
          PACK     KEY18,CCHCHCD,KEY16,SP70
          CALL     RACCEP1
          IF       OVRCD=1
            UNPACK   KEY18,CCEPHCD,CCEPEPS
            PACK     CCEPSDT,CCC,CYY,CMM,CDD
            REP      " 0",CCEPSDT
            MOVE     CCEPSDT,CCEPLTD
            MOVE     "0",CCEPCOM
            CALL     WRCCEP1
          ENDIF
          RETURN
.
WREEPS00  REP      " 0",ALENENCT
          PACK     KEY16,ALENVISN,ALENENCT,SP70
          SQUEEZE  KEY16
          PACK     KEY18,CCHCHCD,KEY16,SP70
          CALL     RACCEP1
          IF       OVRCD=1
            UNPACK   KEY18,CCEPHCD,CCEPEPS
            PACK     CCEPSDT,CCC,CYY,CMM,CDD
            REP      " 0",CCEPSDT
            MOVE     CCEPSDT,CCEPLTD
            MOVE     "0",CCEPCOM
            MOVE     "10",CCEPVIST
            CALL     WRCCEP1
          ENDIF
          RETURN
.
.----------------------------------------------------------------------
. Close Files
.----------------------------------------------------------------------
CLOSE000  CLOSE    PATDTRA1
          CLOSE    PATINVR3
          CLOSE    PATCODE1
          CLOSE    PATDO1A1
          CLOSE    PATMMBS1
          CLOSE    PATVISA1
          CLOSE    PATMA1A1
          CLOSE    PATMX1A1                                            * v90202
          CLOSE    PATTRAN2
          CLOSE    PATMI1A1
          CLOSE    PATECDA2
          CLOSE    PATECOA2
          CLOSE    PATDSCH1
          CLOSE    OUTSITA1
          CLOSE    OUTBB1A1
          RETURN
.
.------------------------------------------------------------
. Print Warning Messages
.------------------------------------------------------------
WARN0000  COMPARE  "55",CLNO
          CALL     HEAD0000 IF NOT LESS
          ADD      ONE,CLNO
          MATCH    CCEPEPS,LASTEPS
          IF       @EQUAL
            PRINT    *32,"Warning : ",DISPMSG
          ELSE
            ADD      ONE,TOTALERR
            MOVE     CCEPEPS,LASTEPS
            PRINT    CCEPHCD,"/",CCEPEPS,SP1,CCEPURN," Warning : ",DISPMSG
          ENDIF
          RETURN
.
.------------------------------------------------------------
. Update Patient Visit File Details
.-------------------------------------------
. Other Visit File Fields
.------------------------
. PVIDOCT  DIM   6  Clinic / Doctor
. PVISITE  DIM   6  Outpatients Site
. PVIRESI  DIM   3  Resident Status
.------------------------------------------------------------
UPVIS000  MATCH     PVIURNO,CCEPURN
          GOTO      UPVIS100 IF EQUAL
.
          MATCH     SP10,CCEPURN
          GOTO      UPVIS050 IF NOT EQUAL
.
          COMPARE   TWO,PVITYPE
          GOTO      UPVIS050 IF NOT EQUAL
.
          PACK      CCEPURN,PVIURNO,SP10
          GOTO      UPVIS100
.
UPVIS050  MOVE      "UR No. from Visit File Does Not Match.",DISPMSG
          CALL      WARN0000
.
UPVIS100  MOVE      PTVITYPE,CCEPVIST
          MOVE      PVIDATE,CCEPADAT
          REP       " 0",CCEPADAT
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      "Admission Date > Todays Date.",DISPMSG
          MATCH     CCEPADAT,KEY8
          CALL      WARN0000 IF LESS  * Warn "Admission Date > Todays Date"
.
. Update Visit Extn File vars
.
          MATCH     "1",PMVXINTR
          IF        @EQUAL
            MOVE      ONE,CCEPINTR          * Interpreter required
          ENDIF
.
          MOVE      PMVXABRG,CCEPABRG       * Indigenous status
          MOVE      PMVXCADM,CCEPCADM       * Admission Criteria
          MOVE      PMVXIRAD,CCEPIRAD       * Intent to re admit
          MOVE      PMVXIDUS,CCEPIDUS       * Intended stay
          MOVE      PMVXCRAV,CCEPCRAV       * Carer Available
          MOVE      PMVXRCCT,CCEPRCCT       * Critical Care Transfer
.
          MATCH     "1",PMVXINDC
          IF        @EQUAL
            MOVE      ONE,CCEPINDC          * Intended Day Case
          ENDIF
.
          MOVE      PMVXMDAV,CCEPMDAV       * Mode of Inp Arrival
          MOVE      PMVXCSNG,CCEPCSNG       * Coder Snag
          MOVE      PMVXASUT,CCEPASUT       * Adm Serv Unit Type
          MOVE      PMVXELPS,CCEPELPS       * Elective Patient Stat
          MOVE      PMVXEMPL,CCEPEMPL       * Employment Status
          MOVE      PMVXFINP,CCEPFINP       * Financial Program
          MOVE      PMVXOCCP,CCEPOCCP       * Occupation
          MOVE      PMVXPALC,CCEPPALC       * Inv In Palliative Care
          MOVE      PMVXPPAL,CCEPPPAL       * Palliative Care
          MOVE      PMVXPPPT,CCEPPPPT       * Public/Private Patient
          MOVE      PMVXPSOS,CCEPPSOS       * Pension Status on Sep
          MOVE      PMVXPYSP,CCEPPYSP       * Payment Status on Sep
          MOVE      PMVXQLDB,CCEPQLDB       * Type of Episode QLD
          MOVE      PMVXREAD,CCEPREAD       * Re-Admit 28 Days
          MOVE      PMVXUDIN,CCEPUDIN       * Dishcarge Intention
          MOVE      PMVXUREA,CCEPUREA       * Unplanned Re Admission
          MOVE      PMVXUSAC,CCEPUSAC       * Usual Accom
          MOVE      PMVXUVTH,CCEPUVTH       * Unplanned Visit To Theatre
          MOVE      PMVXPOST,CCEPPCD        * Post Code
          MOVE      PMVXLNG1,CCEPOLG        * Preferred Labguage 1
          MOVE      PMVXRHC1,CCEPRHC1       * Referring HCP 1
.
          RETURN
.
.------------------------------------------------------------
. Read & Update Theatre Details
.------------------------------------------------------------
ROPR0000  BRANCH    OPRDEAOP,ROPR9999        * NO Theatre Files Available
          BRANCH    OPRARDOP,ROPR9999        * NO Theatre Files Available
          BRANCH    OPRSESOP,ROPR9999        * NO Theatre Files Available
          BRANCH    OPRSRGOP,ROPR9999        * NO Theatre Files Available
          PACK      KEY31,SAVEEPS,SP70
          CALL      RSOPDEA2
ROPR1000  CALL      RKOPDEA2
          BRANCH    OVRCD,ROPR9999
          MOVE      SAVEEPS,KEY8
          MATCH     KEY8,OPDAADMN            * Check for Correct Admission
          GOTO      ROPR9999 IF NOT EQUAL
          COMPARE   "3",OPDASTAT             * Ignore Cancelled Records
          GOTO      ROPR1000 IF EQUAL
.
          PACK      KEY22,OPDAHOSP,OPDADATE,OPDATIME,OPDACLIN
          CALL      RDOPSES1                 * Get Usage Record          V90200
          BRANCH    OVRCD,ROPR9999           * Ignore if Not Found
.
          PACK      KEY10,OPDAUNIQ
          CALL      RDOPARD1                 * Get Arrival & Recovery Record
          BRANCH    OVRCD,ROPR9999           * Ignore if Not Found
.
          PACK      KEY11,OPDAUNIQ,ONE
          CALL      RDOPSRG1                 * Get Surgical Record         
          IF        OVRCD=1
            CALL      RKOPSRG1                 * Get Surgical Record         
            BRANCH    OVRCD,ROPR9999           * Ignore if Not Found
            MATCH     OPDAUNIQ,OPSGUNID
            GOTO      ROPR9999 IF NOT EQUAL
          ENDIF
.
          CALL      THTIM000                 * Calculate Theatre Times
.
          CALL      MOVOPR00                 * Move in Theatre Analysis Fields
.
ROPR9999  RETURN
.
.------------------------------------------------------------
. Read & Update Inpatient Details
.------------------------------------------------------------
RINP0000
.
. Admission Record
.-------------------
          IF        PATMISOP=0
            PACK      KEY8,SAVEEPS    * Episode = Admission Number
            CALL      RDMISS1                                          * V90200
            IF        OVRCD=0
              CALL      UPMIS000       * Update Admission Details
            ELSE
              MOVE      ZERO,DASTAT                                    * V90200
              MOVE      "No Patient Admission Record.",DISPMSG
              CALL      WARN0000
            ENDIF
          ENDIF
.
          PACK      KEY8,SAVEEPS,SP70
          CALL      RDPTDAD1
          IF        OVRCD<>1
              MOVE      PTDAADTS,CCEPADTS
              MOVE      PTDADCTS,CCEPDCTS
          ENDIF
.
. Admission Bed Transfer Record
.--------------------------------
          IF        PATTRNOP=1
            GOTO      RINP1100
          ENDIF
          PACK      KEY30,SAVEEPS,SP70
          CALL      RDSTRAN2                                           * V90200
          CALL      RDKTRAN2                                           * V90200
          BRANCH    OVRCD,RINP1000
          MATCH     KEY8,DTADMN                                        * V90200
          GOTO      RINP1000 IF NOT EQUAL
          MATCH     "A",TMOVE                                          * V90200
          GOTO      RINP0200 IF EQUAL
.
RINP0100  CALL      RDKTRAN2                                           * V90200
          BRANCH    OVRCD,RINP0300
          MATCH     KEY8,DTADMN                                        * V90200
          GOTO      RINP0300 IF NOT EQUAL
          MATCH     "A",TMOVE                                          * V90200
          GOTO      RINP0100 IF NOT EQUAL
.
RINP0200  CALL      UPATR000        * Update First Bed Transfer Record
          GOTO      RINP0500
.
RINP0300  MOVE      ZERO,F1
          MOVE      DASTAT,F1                                          * V90200
          BRANCH    F1,RINP0500,RINP0350,RINP0350,RINP0350,RINP0500
.
RINP0350  MOVE      "No Admission Bed Transfer Record.",DISPMSG
          CALL      WARN0000
.
. Discharge Bed Transfer Record
.--------------------------------
RINP0500  PACK      KEY30,SAVEEPS,Z70
          CALL      RDSTRAN2                                           * V90200
.
RINP0600  CALL      RDPTRAN2                                           * V90200
          BRANCH    OVRCD,RINP0700
          MATCH     KEY8,DTADMN                                        * V90200
          GOTO      RINP0700 IF NOT EQUAL
          MATCH     "D",TMOVE                                          * V90200
          GOTO      RINP0600 IF NOT EQUAL
          CALL      UPDTR000        * Update Last Bed Transfer Record
          GOTO      RINP1100
RINP0700  MOVE      ZERO,F1
          MOVE      ASTAT,F1                                           * V90200
          IF        F1=3
            MOVE      "No Discharge Bed Transfer Record.",DISPMSG
            CALL      WARN0000
          ENDIF
          GOTO      RINP1100
.
RINP1000  MOVE      ZERO,F1
          MOVE      ASTAT,F1                                           * V90200
          BRANCH    F1,RINP1100,RINP1050,RINP1050,RINP1050,RINP1100
.
RINP1050  MOVE      "No Bed Transfer Records.",DISPMSG
          CALL      WARN0000
.
RINP1100  IF        PATDSCOP=0
            PACK      KEY8,SAVEEPS    * Episode = Admission Number
            CALL      RDDSCH1                                          * V90200
            IF        OVRCD=0
              CALL     UPDSC000       * Update Discharge Details
            ELSE
              MOVE     ZERO,F1
              MOVE     ASTAT,F1                                        * V90200
              IF       F1=3
                MOVE      "Inpatient Discharge Record Missing.",DISPMSG
                CALL      WARN0000
              ENDIF
            ENDIF
          ENDIF
.
RINP9999  RETURN
.
.-------------------------------------------
. Update Patient Master File Details
.-------------------------------------------
UPMAS000  MOVE      PSEX,CCEPSEX
          MOVE      PSNAME,CCEPSUR
          MOVE      PGNAME,CCEPGIV
          MOVE      PBDATE,CCEPDOB
          REP       " 0",CCEPDOB
          MOVE      PCONT,CCEPCOB
          MOVE      PREG,CCEPREL
          MOVE      PPOST,CCEPPCD
.
.         Get DVA Card details
.
          MOVE      THREE,DIM1              * set for DVA card type
          CALL      GCCARD00                * get DVA card details
          MOVE      PMCDDVAC,CCEPDVAC       * DVA Card Colour
          MOVE      PMPXFLDR,CCEPFLDR       * Folder Selection
.
          CALL      AGE0000
.
          COMPARE   ZERO,PSTAT
          GOTO      UPMAS100 IF EQUAL
          MOVE      "Patient Master Status Not = 0",DISPMSG
          CALL      WARN0000
UPMAS100  RETURN
.
.------------------------------------------------------------
. Read & Update Outpatient Details
.------------------------------------------------------------
ROUT0000  BRANCH    OUTSITOP,ROUT9999
          MOVE      PVISITE,KEY6
          CALL      RDSITA1
          BRANCH    OVRCD,ROUT9000
          MATCH     "out",OSTFILE
          CALL      OUTOPN00 IF NOT EQUAL
.
          IF        OUTBOBOP=0
            PACK      KEY8,SAVEEPS    * Episode = Admission Number
            CALL      RDBOKB1
            IF        OVRCD=0
              CALL      UOBOB000      * Update Outpatient Details
            ELSE
              MOVE      "No Outpatient Booking Record.",DISPMSG
              CALL      WARN0000
            ENDIF
          ENDIF
.
          IF        OUTBOKOP=0
            PACK      KEY36,SAVEEPS,SP70    * Episode = Admission Number
            CALL      RDSBOKA6
            CALL      RDKBOKA6
            IF        OVRCD=0
              COMPARE   SAVEEPS,OBAOUTNO
              GOTO      ROUT8000 IF NOT EQUAL
.
              CALL      UOBOK000      * Update Outpatient Details
            ELSE
              MOVE      "No Outpatient Booking A Record.",DISPMSG
              CALL      WARN0000
            ENDIF
          ENDIF
.
ROUT8000  MATCH     "out",OSTFILE
          GOTO      ROUT9999 IF EQUAL
.
          CLOSE     OUTBB1A1
          CLOSE     OUTBB1A2
.
          MOVE      "outbb1af",KEY8
          MATCH     SP70,CCHLOBB
          IF        @EQUAL
            MOVE      ZERO,OVRCD
            OPEN      OUTBB1A1,KEY8
            OPEN      OUTBB1A2,KEY8
          ELSE
            STRIP     CCHLOBB
            PACK      KEY80,CCHLOBB,KEY8
            OPEN      OUTBB1A1,KEY80
            OPEN      OUTBB1A2,KEY80
          ENDIF
          TRAPCLR   IO
          MOVE      OVRCD,OUTBOBOP
.
          CLOSE     OUTBOKA6
          MOVE      "outbokaf",KEY8
          MATCH     SP70,CCHLOBB
          IF        @EQUAL
            MOVE      ZERO,OVRCD
            OPEN      OUTBOKA6,KEY8
          ELSE
            STRIP     CCHLOBB
            PACK      KEY80,CCHLOBB,KEY8
            OPEN      OUTBOKA6,KEY80
          ENDIF
          TRAPCLR   IO
          MOVE      OVRCD,OUTBOKOP
.
          GOTO      ROUT9999
.
ROUT9000  CLEAR     DISPMSG
          APPEND    "Outpatient Site : ",DISPMSG
          APPEND    KEY6,DISPMSG
          APPEND    " - ",DISPMSG
          CALL      WARN0000
          GOTO      ROUT9999
.
ROUT9999  RETURN
.
.------------------------------------------------------------
. Open Alternate Outpatient File
.------------------------------------------------------------
OUTOPN00  CLOSE     OUTBB1A1
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          TRAPCLR   IO
          CLEAR     KEY8
          APPEND    OSTFILE,KEY8
          APPEND    "bb1af",KEY8
          RESET     KEY8
          OPEN      OUTBB1A1,KEY8
          MOVE      OVRCD,OUTBOBOP
.
          CLOSE     OUTBOKA6
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          TRAPCLR   IO
          CLEAR     KEY8
          APPEND    OSTFILE,KEY8
          APPEND    "bokaf",KEY8
          RESET     KEY8
          OPEN      OUTBOKA6,KEY8
          MOVE      OVRCD,OUTBOBOP
.
          RETURN
.
.------------------------------------------------------------
. Update outpatient Details
.------------------------------------------------------------
UOBOB000  MOVE      OBADATE,CCEPDDAT                                  
          MOVE      OBADATE,CCEPADAT                                  
          MOVE      OBACLASS,CCEPDDPT                                 
          MOVE      OBASRCR,CCEPASRC                                  
          MOVE      OBACAT,CCEPACLS                                   
          MOVE      OBACLASS,CCEPADPT                                 
          MOVE      OBADOCT,CCEPATDC                                  
          MOVE      OBBCTYP,CCEPOPCL        * Clinic Type
          MOVE      OBACOMP,CCEPCLM                                   
          MOVE      "1",CCEPCOM
          MOVE      OBAPRTY,CCEPOPR         * Priority
          MOVE      OBAATTN,CCEPOAT         * Attendance Code
          MOVE      OBOUSR1,CCEPOU1         * User Def 1
          MOVE      OBOUSR2,CCEPOU2         * User Def 2
          MOVE      OBOUSR3,CCEPOU3         * User Def 3
          MOVE      OBOUSR4,CCEPOU4         * User Def 4
          MOVE      OTBBDEPT,CCEPODP        * Department
          MOVE      OTBBTRAN,CCEPOTR        * Transport
          MOVE      OTBBLNGI,CCEPOLG        * Language
          MOVE      OTBBOUTC,CCEPOOT        * Outcome
          MOVE      OTBBCIND,CCEPCIND       * Clinic Indicator
          MOVE      OTBBSPCA,CCEPSPCA       * Special Arrang
.
UOBOB999  RETURN
.
.
.------------------------------------------------------------
. Update outpatient Details
.------------------------------------------------------------
UOBOK000  MOVE      OBASITE,CCEPOST         * Site Code 
          MOVE      OBACLIN,CCEPOCL         * Clinic
          MOVE      OBACTYP,CCEPOCT         * Clinic Type
          MOVE      OBAVISIT,CCEPOVT        * Visit Type
          MOVE      OBADAY,CCEPODY          * Day Indicator
          MOVE      OBASESST,CCEPOSS        * Session Status
          MOVE      OBADISCH,CCEPODS        * Discharge Status
          MOVE      OBASTAT,CCEPSTAT        * Slot Status
.
UOBOK999  RETURN
.
.------------------------------------------------------------
. Calculate Patient's Age at Admission
.------------------------------------------------------------
AGE0000   PACK      AGEDATE,CCEPADAT
          CALL      CALCAGE
          MOVE      SP3,CCEPAGEY
          MOVE      SP3,CCEPAGEM
          MOVE      SP3,CCEPAGED
          IF        !(PSAGEYRS=0)
            MOVE      PSAGEYRS,CCEPAGEY
            GOTO      AGE9000
          ENDIF
          IF        !(PSAGEMNT=0)
            MOVE      PSAGEMNT,MM
            MOVE      MM,CCEPAGEM
            GOTO      AGE9000
          ENDIF
          MOVE      PSAGEDAY,DD
          IF        DD=0
            MOVE      "01",CCEPAGED
          ELSE
            MOVE      DD,CCEPAGED
          ENDIF
AGE9000   REP       " 0",CCEPAGEY
          REP       " 0",CCEPAGEM
          REP       " 0",CCEPAGED
AGE9999   RETURN
.
.------------------------------------------------------------
. Update Admission Details
.------------------------------------------------------------
UPMIS000  MOVE      ADOCTR,CCEPARDC                                    
          MOVE      ADOCTA,CCEPATDC                                    
          MOVE      ASRCE,CCEPASRC                                     
          MOVE      ACLSS,CCEPACLS                                     
          MOVE      AFUNDH,CCEPAHFD                                    
          MOVE      AFNDTB,CCEPAHTB                                    
          MOVE      AMBS,CCEPAMBS                                      
          MOVE      ACARE,CCEPACAR                                     
          MOVE      AUSR1,CCEPMU1                                      
          MOVE      AUSR2,CCEPMU2                                      
          MOVE      AUSR3,CCEPMU3                                      
          MOVE      AUSR4,CCEPMU4                                      
          MOVE      AUSR5,CCEPMU5                                      
          MOVE      AUSR6,CCEPMU6                                      
          MOVE      AUSR7,CCEPMU7                                      
          MOVE      ACLAIM,CCEPCLM                                     
          MOVE      PTMICMXP,CCEPCMX                                   
          RETURN
.
.------------------------------------------------------------
. Move in Theatre Analysis Fields
.------------------------------------------------------------
MOVOPR00  MOVE     OPDACLIN,CCEPCLI   *   Clinic/Surgeon (opr)
.
          BRANCH   OPCNCLSU,MOVOPR05
          BRANCH   OPRCLIOP,MOVOPR10
          PACK     KEY6,CCEPCLI
          MATCH    SP70,KEY6
          GOTO     MOVOPR10 IF EQUAL
          CALL     RDOPCLI1
          BRANCH   OVRCD,MOVOPR10
          MOVE     OPCLCAT,CCEPCTY     * Clinic Type (YG)
.
MOVOPR05  BRANCH   PATDOCOP,MOVOPR10
          PACK     KEY6,CCEPCLI
          MATCH    SP70,KEY6
          GOTO     MOVOPR10 IF EQUAL
          CALL     RDDOCT1                                             * V90200
          BRANCH   OVRCD,MOVOPR10
          MOVE     DRTYPE,CCEPCTY     * Clinic/Surgeon Type (DT)         V90200
.
MOVOPR10  MOVE     OPDAANAE,CCEPANA   * Anaesthetic Code (OA)
          MOVE     OPDATYPE,CCEPOTY   * Operation Type   (OY)
          MOVE     OPDATRAN,CCEPTTR   * Operation Transport Code (OR)
          MOVE     OPDAUSR1,CCEPOY6   * Oper. User Def 1 (Y6)
          MOVE     OPDAUSR2,CCEPOY7   * Oper. User Def 2 (Y7)
          MOVE     OPDAUSR3,CCEPOY8   * Oper. User Def 3 (Y8)
          MOVE     OPDAUSR4,CCEPOY9   * Oper. User Def 4 (Y9)
          MOVE     OPDATHET,CCEPORM   * Operating Room
          MOVE     OPDAKNOW,CCEPOKI   * Operating Known Infection (OK)
          MOVE     OPSETPER,CCEPOTP   * Time Period (SP)                 V90200
          MOVE     OPSETYPE,CCEPTST   * Oper. Session Type (ST)          V90200
.
MOVOPR99  RETURN
.
.------------------------------------------------------------
. Calculate Theatre Times for Analysis
.------------------------------------------------------------
THTIM000  MOVE      ZERO,CCIATT1
          MOVE      ZERO,CCIATT2
          MOVE      ZERO,CCIATT3
          MOVE      ZERO,CCIATT4
.
          COMPARE   ZERO,CCCOTF1
          GOTO      THTIM100 IF EQUAL
          COMPARE   "15",CCCOTF1
          GOTO      THTIM010 IF NOT EQUAL
          MOVE      OPDATDUR,CCIATT1         * Actual Duration
          GOTO      THTIM100
.
THTIM010  LOAD      FROMTIME,CCCOTF1,OPARTCAL,OPARATIM,OPARANAP,OPARANAS:
                                     OPSGTIPS,OPSGTISS,OPSGTISE,OPARANAE:
                                     OPSGTIDR,OPARTIRF,OPARTIRB,OPARTIRD:
                                     OPARTIDP,OPARTETC
..                                     OPDAPRE1,OPDAPRE2,OPDAPRE3,OPDAPRE4:
..                                     OPDAPRE5,OPDCOTM1,OPDCOTM2,OPDCOTM3:
..                                     OPDCOTM4,OPDAPOS1,OPDAPOS2,OPDAPOS3:
..                                     OPDAPOS4
          LOAD      TOTIME,CCCOTT1,OPARTCAL,OPARATIM,OPARANAP,OPARANAS:
                                   OPSGTIPS,OPSGTISS,OPSGTISE,OPARANAE:
                                   OPSGTIDR,OPARTIRF,OPARTIRB,OPARTIRD:
                                   OPARTIDP,OPARTETC
          CALL      CDUR0000                  * Calculate Duration
          MOVE      QUANTITY,CCIATT1
.
THTIM100  COMPARE   ZERO,CCCOTF2
          GOTO      THTIM200 IF EQUAL
          COMPARE   "15",CCCOTF2
          GOTO      THTIM110 IF NOT EQUAL
          MOVE      OPDATDUR,CCIATT2         * Actual Duration
          GOTO      THTIM200
.
THTIM110  LOAD      FROMTIME,CCCOTF2,OPARTCAL,OPARATIM,OPARANAP,OPARANAS:
                                     OPSGTIPS,OPSGTISS,OPSGTISE,OPARANAE:
                                     OPSGTIDR,OPARTIRF,OPARTIRB,OPARTIRD:
                                     OPARTIDP,OPARTETC
          LOAD      TOTIME,CCCOTT2,OPARTCAL,OPARATIM,OPARANAP,OPARANAS:
                                     OPSGTIPS,OPSGTISS,OPSGTISE,OPARANAE:
                                     OPSGTIDR,OPARTIRF,OPARTIRB,OPARTIRD:
                                     OPARTIDP,OPARTETC
          CALL      CDUR0000                  * Calculate Duration
          MOVE      QUANTITY,CCIATT2
.
THTIM200  COMPARE   ZERO,CCCOTF3
          GOTO      THTIM300 IF EQUAL
          COMPARE   "15",CCCOTF3
          GOTO      THTIM210 IF NOT EQUAL
          MOVE      OPDATDUR,CCIATT3         * Actual Duration
          GOTO      THTIM300
.
THTIM210  LOAD      FROMTIME,CCCOTF3,OPARTCAL,OPARATIM,OPARANAP,OPARANAS:
                                     OPSGTIPS,OPSGTISS,OPSGTISE,OPARANAE:
                                     OPSGTIDR,OPARTIRF,OPARTIRB,OPARTIRD:
                                     OPARTIDP,OPARTETC
          LOAD      TOTIME,CCCOTT3,OPARTCAL,OPARATIM,OPARANAP,OPARANAS:
                                   OPSGTIPS,OPSGTISS,OPSGTISE,OPARANAE:
                                   OPSGTIDR,OPARTIRF,OPARTIRB,OPARTIRD:
                                   OPARTIDP,OPARTETC
          CALL      CDUR0000                  * Calculate Duration
          MOVE      QUANTITY,CCIATT3
.
THTIM300  COMPARE   ZERO,CCCOTF4
          GOTO      THTIM999 IF EQUAL
          COMPARE   "15",CCCOTF4
          GOTO      THTIM310 IF NOT EQUAL
          MOVE      OPDATDUR,CCIATT4         * Actual Duration
          GOTO      THTIM999
.
THTIM310  LOAD      FROMTIME,CCCOTF4,OPARTCAL,OPARATIM,OPARANAP,OPARANAS:
                                     OPSGTIPS,OPSGTISS,OPSGTISE,OPARANAE:
                                     OPSGTIDR,OPARTIRF,OPARTIRB,OPARTIRD:
                                     OPARTIDP,OPARTETC
          LOAD      TOTIME,CCCOTT4,OPARTCAL,OPARATIM,OPARANAP,OPARANAS:
                                   OPSGTIPS,OPSGTISS,OPSGTISE,OPARANAE:
                                   OPSGTIDR,OPARTIRF,OPARTIRB,OPARTIRD:
                                   OPARTIDP,OPARTETC
          CALL      CDUR0000                  * Calculate Duration
          MOVE      QUANTITY,CCIATT4
.
THTIM999  RETURN
.
.
.------------------------------------------------------------
. Calculate Duration between FROMTIME & TOTIME
. for Theatre Times
.------------------------------------------------------------
CDUR0000  MOVE        ZERO,QUANTITY
.
.******* Test if the from time or to time is blank and if so *******
.******* exit with quantity still set to zero                *******
.
          PACK        FROMTIME,FROMTIME,SP5
          MATCH       SP5,FROMTIME
          GOTO        CDUR9999 IF EQUAL
.
          PACK        TOTIME,TOTIME,SP5
          MATCH       SP5,TOTIME
          GOTO        CDUR9999 IF EQUAL
.
.******* Unpack the from time and the to time and move them to *****
.******* numeric fields for the calculation                    *****
.
          UNPACK      FROMTIME,DIM2,DIM1,DIM2A
          MOVE        DIM2,FROMHOUR
          MOVE        DIM2A,FROMMIN
          UNPACK      TOTIME,DIM2,DIM1,DIM2A
          MOVE        DIM2,TOHOUR
          MOVE        DIM2A,TOMIN
.
.******* If the totime is less than the from time then assume that *****
.******* the duration has run over midnight.                       *****
.
          MATCH       FROMTIME,TOTIME
          IF          @LESS
            ADD         "24",TOHOUR
          ENDIF
.
.******* Calculate the quantity in minutes                        *****
.
          ASSIGN      ((TOHOUR*60)+TOMIN)-((FROMHOUR*60)+FROMMIN),QUANTITY
.
CDUR9999  RETURN
.
.------------------------------------------------------------
. Update Discharge Bed Transfer Record
.------------------------------------------------------------
UPDTR000  MOVE      TWARD,CCEPDWAR                                    
          MOVE      TATYPE,CCEPDDPT                                   
          MOVE      TADOCT,CCEPDADC                                   
          RETURN
.
.------------------------------------------------------------
. Update Admission Bed Transfer Record
.------------------------------------------------------------
UPATR000  MOVE      TWARD,CCEPAWAR                                     
          MOVE      TATYPE,CCEPADPT                                    
          MOVE      TADOCT,CCEPAADC                                    
          RETURN
.
.--------------------------------------------------
. EMR Patient Details
.--------------------------------------------------
REMR0000  IF       EMRVISOP=0
            MOVE     PVIBILL,KEY8
            CALL     RDEMVIS1                                          
            IF       OVRCD=0
              CALL    UEVIS000      * Update EMR visit file fields
            ELSE
              MOVE      "EMR Visit Record Not Found.",DISPMSG
              CALL      WARN0000
            ENDIF
          ENDIF
.
          RETURN
.
.-------------------------------------------
. Update EMR Visit Details
.-------------------------------------------
UEVIS000  MOVE      EMVIDDAT,CCEPDDAT
          MOVE      EMVIDSTA,CCEPDSTA
          MOVE      ONE,CCEPCOM
          MOVE      EMVICLAS,CCEPADPT                                 
          MOVE      EMVIDOCT,CCEPATDC                                  
          MOVE      EMVICOMP,CCEPCLM                                   
          MOVE      EMVIINSR,CCEPINS
          MOVE      EMVIDRDT,CCEPTIM
          MOVE      EMVIDTIM,CCEPTDP
          MOVE      EMVISITN,CCEPAST
          MOVE      EMVIMODE,CCEPAMD
          MOVE      EMVIUC01,CCEPAU1
          MOVE      EMVIUC02,CCEPAU2
          MOVE      EMVIUC03,CCEPAU3
          MOVE      EMVIUC04,CCEPAU4
          MOVE      EMVIUC05,CCEPAU5
          MOVE      EMVIUC06,CCEPAU6
          MOVE      EMVIUC07,CCEPAU7
          MOVE      EMVIUC08,CCEPAU8
          MOVE      EMVIWAIT,CCEPAWT
          MOVE      EMVIPREV,CCEPAPR
          MOVE      EMVIELAP,CCEPAET
          MOVE      EMVIRTAS,CCEPART
          MOVE      EMVIINIT,CCEPAIN
          MOVE      EMVIPLIN,CCEPAPL
          MOVE      EMVITRIG,CCEPAPY
          MOVE      EMVISRCE,CCEPASRC                                   
          MOVE      EMVIUC21,CCEPUC21
          MOVE      EMVIUC09,CCEPUC09
          MOVE      EMVIUC20,CCEPUC20
          MOVE      EMVIUC28,CCEPUC28
          MOVE      EMVITSRC,CCEPADTS
          MOVE      EMVIDEST,CCEPDCTS
.
          REP       " 0",EMVIDATE
          MATCH     CCEPADAT,EMVIDATE
          IF        !@EQUAL
            MOVE      EMVIDATE,CCEPADAT
            MOVE      "Visit Date Not Equal to EMR Date.",DISPMSG
            CALL      WARN0000
          ENDIF
.
          MOVE      "005",D3
          MOVE      PVIBILL,KEY8
          PACK      KEY14,KEY8,D3,SP70
          CALL      RSEMVCD1
UEVIS100  CALL      RKEMVCD1
          BRANCH    OVRCD,UEVIS999
.
          MATCH     KEY8,EMVCVIST
          GOTO      UEVIS999 IF NOT EQUAL
.
          MATCH     D3,EMVCTYPE
          GOTO      UEVIS999 IF NOT EQUAL
.
          MOVE      EMVCMNCD,CCEPDMBS
.
UEVIS999  RETURN
.
.------------------------------------------------------------
. Update Discharge Details
.------------------------------------------------------------
UPDSC000  MOVE      DSTAT,CCEPDSTA                                     
          MOVE      DDEST,CCEPDDES                                     
          MOVE      DFMBS,CCEPDMBS                                     
          MOVE      PTDSDMDC,CCEPMDCC                                  
          MOVE      PTDSDDRG,CCEPDRGC                                  
.
          MATCH     SP70,PTDSDMDC                                      
          IF        !@EQUAL
            MOVE      PTDSDMDC,CCEPMDCC                                
          ENDIF
.
          MATCH     SP70,PTDSDDRG                                      
          IF        !@EQUAL
            MOVE      PTDSDDRG,CCEPDRGC                                
          ENDIF
.
          PACK      CCEPDDAT,DDATE                                     
          REP       " 0",CCEPDDAT
          MATCH     SP70,PTDSDDRG                                      
          GOTO      UPDSC999 IF EQUAL
.
          MOVE      PTDSDDRG,KEY4                                      
          MOVE      ONE,CCEPCOM
          CALL      RDCCDG1
          IF        OVRCD=0
            IF        CCDGWAR=1
              CLEAR     DISPMSG
              APPEND    "Patient in DRG Group : ",DISPMSG
              APPEND    PTDSDDRG,DISPMSG                               
              APPEND    " - ",DISPMSG
              RESET     DISPMSG
              CALL      WARN0000
            ENDIF
          ENDIF
.
UPDSC999  RETURN
.
.**************************************************************************
.*                               LASC0000              Called by: ML1200  *
.* Load ASCII File Patient Data                                           *
.**************************************************************************
.
LASC0000  CALL      KASC0000                    * Keyin ASCII File Name
          BRANCH    EXIT,LASC9999
.
          CALL      CONTQST                     * ok to continue
          BRANCH    CEXIT,LASC5000,LASC9999,LASC9999    * 1=Yes, 2=No, 3=Cancel
.
LASC5000  CALL      LOAD0000               * Load ASCII File Patient Data
.
LASC9999  RETURN
.
.
.------------------------------------------------------------
. Select and Extract a Single Admission
.------------------------------------------------------------
KASC0000  DISPLAY   *P1:4,*EF
          KEYIN     *P1:4,"ASCII File Name : ",*V2LON,LOADNAME
.
          ENDSET    LOADNAME
          APPEND    SP70,LOADNAME
          RESET     LOADNAME
.
          MATCH     SP70,LOADNAME
          GOTO      KASC9000 IF EQUAL
.
          GOTO      KASC9999
.
KASC9000  MOVE      ONE,EXIT
          GOTO      KASC9999
.
KASC9999  RETURN
.
.----------------------------------------------------------------------
. Load ASCII Interface File
.----------------------------------------------------------------------
LOAD0000  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      LOADFILE,LOADNAME
          TRAPCLR   IO
          BRANCH    OVRCD,LOAD9100
.
          MOVE      ZERO,SECTOR
          MOVE      ZERO,CPAGENO
          MOVE      ZERO,TOTALERR
          MOVE      "99",CLNO
          CALL      IBACLOCK
.
LOAD1000  READ      LOADFILE,SEQ;CCEPHCD,CCEPEPS
          PACK      KEY18,CCEPHCD,CCEPEPS
          CALL      RDCCEP1              * Get Current Details if Available
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF FORMAT
          ADD       ONE,SECTOR
          READ      LOADFILE,SEQ;CCEPHCD,CCEPEPS,CCEPSUR,CCEPGIV,CCEPCOM:
                        CCEPURN,CCEPLOS,CCEPINPT,CCEPDAY:
                        CCEPVIST,CCEPSEX,CCEPDOB,CCEPAGEY,CCEPAGEM,CCEPAGED:
                        CCEPCOB,CCEPREL,CCEPDDAT,CCEPDWAR,CCEPDSTA,CCEPDDES:
                        CCEPDMBS,CCEPDDPT,CCEPDSER,CCEPMDCC,CCEPDRGC,CCEPADAT:
                        CCEPAWAR,CCEPASRC,CCEPACLS,CCEPACAR,CCEPADPT,CCEPASER:
                        CCEPARDC,CCEPATDC,CCEPAADC,CCEPDADC,CCEPAHFD,CCEPAHTB:
                        CCEPAMBS,CCEPOPCL,CCEPPDIA,CCEPSDIA,CCEPPOPP,CCEPSOPP:
                        CCEPEXC,CCEPPMBS,CCEPSMBS,CCEPMU1,CCEPMU2,CCEPMU3:
                        CCEPMU4,CCEPMU5,CCEPMU6,CCEPMU7,CCEPPCD,CCEPCLM:
                        CCIAITH,CCIAIA1,CCIAIA2,CCIAIA3,CCIAIAO:
                        CCIAIM1,CCIAIM2,CCIAIM3,CCIAIMO
.
          GOTO      LOAD9900 IF OVER
          TRAPCLR   FORMAT
          BRANCH    OVRCD,LOAD3000
          IF        (SECTOR%100=0)
            DISPLAY   *P1:24,*EL,"Records Processed : ",*V2LON,SECTOR
          ENDIF
.
          MOVE      SP70,CCEPSPA
          MOVE      SP70,CCIASPA
          PACK      KEY18,CCEPHCD,CCEPEPS
          CALL      RACCEP1              * Update Master Details
          IF        OVRCD=0
            PACK      CCEPLTD,CCC,CYY,CMM,CDD
            REP       " 0",CCEPLTD
            CALL      UPCCEP1
          ELSE
            PACK      CCEPLTD,CCC,CYY,CMM,CDD
            REP       " 0",CCEPLTD
            MOVE      CCEPLTD,CCEPSDT
            CALL      CLRRES00
            CALL      WRCCEP1
          ENDIF
.
          UNPACK    KEY18,CCIAHCD,CCIAEPS
          CALL      RACCIA1              * Update Income Details
          IF        OVRCD=0
            CALL      UPCCIA1
          ELSE
            CALL      WRCCIA1
          ENDIF
.
          GOTO      LOAD1000
.
. Error in Format
.
LOAD3000  COMPARE  "55",CLNO
          CALL     ASCH0000 IF NOT LESS
          ADD      ONE,CLNO
          ADD      ONE,TOTALERR
.
          PRINT     *1,SECTOR
          GOTO      LOAD1000
.
LOAD9100  MOVE      "Unable to Open ASCII File - ",DISPMSG
          CALL      MESSAGE1
          MOVE      "2",EXIT
          GOTO      LOAD9999
.
LOAD9900  COMPARE   ZERO,TOTALERR
          IF        !@EQUAL
            COMPARE   ZERO,CPAGENO
            CALL      ASCH0000 IF EQUAL
            CALL      UND80
            PRINT     *20,TOTALERR," Error Records Printed."
            CALL      UND80
          ENDIF
.
          MOVE      "0",EXIT
          GOTO      LOAD9999
.
LOAD9999  RETURN
.
.----------------------------------------------------------------------
. Clear fields not in ascii file
.----------------------------------------------------------------------
CLRRES00  MOVE      SP70,CCEPCLI
          MOVE      SP70,CCEPCTY
          MOVE      SP70,CCEPANA
          MOVE      SP70,CCEPOTY
          MOVE      SP70,CCEPTTR
          MOVE      SP70,CCEPOY6
          MOVE      SP70,CCEPOY7
          MOVE      SP70,CCEPOY8
          MOVE      SP70,CCEPOY9
          MOVE      SP70,CCEPORM
          MOVE      SP70,CCEPOKI
          MOVE      SP70,CCEPOTP
          MOVE      SP70,CCEPTST
          MOVE      SP70,CCEPINS
          MOVE      SP70,CCEPTIM
          MOVE      SP70,CCEPTDP
          MOVE      SP70,CCEPAST
          MOVE      SP70,CCEPAMD
          MOVE      SP70,CCEPAU1
          MOVE      SP70,CCEPAU2
          MOVE      SP70,CCEPAU3
          MOVE      SP70,CCEPAU4
          MOVE      SP70,CCEPAU5
          MOVE      SP70,CCEPAU6
          MOVE      SP70,CCEPAU7
          MOVE      SP70,CCEPAU8
          MOVE      SP70,CCEPAWT
          MOVE      SP70,CCEPAPR
          MOVE      SP70,CCEPAET
          MOVE      SP70,CCEPART
          MOVE      SP70,CCEPAIN
          MOVE      SP70,CCEPAPL
          MOVE      SP70,CCEPAPY
          MOVE      SP70,CCEPOST
          MOVE      SP70,CCEPOCL
          MOVE      SP70,CCEPOCT
          MOVE      SP70,CCEPOVT
          MOVE      SP70,CCEPODY
          MOVE      SP70,CCEPOSS
          MOVE      SP70,CCEPODS
          MOVE      SP70,CCEPOAT
          MOVE      SP70,CCEPOPR
          MOVE      SP70,CCEPOU1
          MOVE      SP70,CCEPOU2
          MOVE      SP70,CCEPOU3
          MOVE      SP70,CCEPOU4
          MOVE      SP70,CCEPODP
          MOVE      SP70,CCEPOTR
          MOVE      SP70,CCEPOLG
          MOVE      SP70,CCEPOOT
          MOVE      SP70,CCEPMU8
          MOVE      SP70,CCEPMU9
          MOVE      SP70,CCEPMU10
          MOVE      SP70,CCEPPHP
          MOVE      SP70,CCEPAGN
          MOVE      ZERO,CCEPVW5
          MOVE      ZERO,CCEPV5A
          MOVE      SP70,CCEPUC21
          MOVE      SP70,CCEPUC09
          MOVE      SP70,CCEPUC20
          MOVE      SP70,CCEPUC28
          MOVE      SP70,CCEPSPA
          RETURN
.
.----------------------------------------------------------------------
. Load ASCII File Patient Data Error Report Header
.----------------------------------------------------------------------
ASCH0000  CALL     HEAD80
          PRINT    "Load ASCII File Patient Data Error Report"
          CALL     UND80
          PRINT    "Error Reading Record Number"
          CALL     UND80
.
ASCH9999  RETURN
.
.
.**************************************************************************
.*                               PEXP0000              Called by: ML1300  *
.* Load ASCII File Patient Data                                           *
.**************************************************************************
.
PEXP0000  CALL      KSTY0000         * Keyin Report Length of Stay Greater Than
          BRANCH    EXIT,PEXP9999
.
          CALL      KZER0000                    * Report Zero LOS
.
          CALL      KINC0000                    * Include Incomplete Episodes
.
          CALL      TDATE000                    * Keyin Data Transfer Date
.
          CALL      CONTQST                     * ok to continue
          BRANCH    CEXIT,PEXP5000,PEXP9999,PEXP9999    * 1=Yes, 2=No, 3=Cancel
.
PEXP5000  CALL      PEXCP000                    * Print Episode Execption Report
.
PEXP9999  RETURN
.
.------------------------------------------------------------
. Keyin Report Length of Stay Greater Than   
.------------------------------------------------------------
KSTY0000  DISPLAY   *P1:4,*EF
          KEYIN     *P1:4,"Report Length of Stay Greater Than : ",*V2LON,MAXLOS
.
          COMPARE   ZERO,MAXLOS
          GOTO      KSTY9000 IF EQUAL
.
          MOVE      ZERO,EXIT
          GOTO      KSTY9999
.
KSTY9000  MOVE      ONE,EXIT
          GOTO      KSTY9999
.
KSTY9999  RETURN
.
.------------------------------------------------------------
. Keyin Report Zero LOS
.------------------------------------------------------------
KZER0000  DISPLAY   *P1:5,*EF
          KEYIN     *P1:5,*EL,"Report Zero Length of Stay":
                    " (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,ANS;
.
          REP       UPPLOW,ANS
          MATCH     ANSY,ANS
          IF        @EQUAL
            MOVE      ONE,ZEROLOS
            GOTO      KZER9999
          ENDIF
.
          MATCH     ANSN,ANS
          IF        @EQUAL
            MOVE      ZERO,ZEROLOS
            GOTO      KZER9999
          ENDIF
.
          BEEP
          GOTO      KZER0000
.
KZER9999  RETURN
.
.------------------------------------------------------------
. Keyin Include Incomplete Episodes
.------------------------------------------------------------
KINC0000  DISPLAY   *P1:6,*EF
          KEYIN     *P1:6,*EL,"Include Incomplete Episodes":
                    " (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,ANS;
.
          REP       UPPLOW,ANS
          MATCH     ANSY,ANS
          IF        @EQUAL
            MOVE      ONE,INCOMPLT
            GOTO      KINC9999
          ENDIF
.
          MATCH     ANSN,ANS
          IF        @EQUAL
            MOVE      ZERO,INCOMPLT
            GOTO      KINC9999
          ENDIF
.
          BEEP
          GOTO      KINC0000
.
KINC9999  RETURN
.
.*************************************************************************
. Keyin Data Transfer Date Range
.*************************************************************************
TDATE000  MOVE       FALSE,EXIT
          DISPLAY    *P1:7,*EF,"Data Transfer Date From :":
                     *P1:8,"Data Transfer Date To  :";
.
          MOVE      "27",CCOL
          MOVE      "7",CVERT
          CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
          MOVE      CCC,CCENT
          MOVE      CYY,CYEAR
          MOVE      CMM,CMON
          MOVE      CDD,CDAY
          CALL      KEYDATE
          BRANCH    OVRCD,TDATE100
.
          MATCH     SP2,CDAY
          GOTO      TDATE100 IF EQUAL
.
          PACK      STRDTD,CCENT,CYEAR,CMON,CDAY
          REP       " 0",STRDTD
          CALL      PACDATE
          MOVE      CPCDATE,FROMDTD
          GOTO      TDATE150
.
TDATE100  MOVE      "Start             ",FROMDTD
          MOVE      SP70,STRDTD
.
TDATE150  MOVE      "0",CKEYTYP
          MOVE      "26",CCOL
          MOVE      "8",CVERT
          CALL      KEYDATE
          BRANCH    OVRCD,TDATE200
.
          MATCH     SP2,CDAY
          GOTO      TDATE200 IF EQUAL
.
          PACK      ENDDTD,CCENT,CYEAR,CMON,CDAY
          REP       " 0",ENDDTD
          CALL      PACDATE
          MOVE      CPCDATE,TODTD
.
          MATCH     STRDTD,ENDDTD
          GOTO      TDATE999 IF EQUAL
          GOTO      TDATE999 IF NOT LESS
.
          BEEP
          DISPLAY   *P1:24,"To Date Must Be > From Date ";
          CALL      HITENTER
          GOTO      TDATE000
.
TDATE200  MOVE      "Finish             ",TODTD
          MOVE      "99999999",ENDDTD
.
TDATE999  RETURN
.
.------------------------------------------------------------
. Print Episode Execption Audit Report
.------------------------------------------------------------
PEXCP000
          DISPLAY  *P1:24,*EL,"Printing : "
          MOVE     ZERO,SECTOR
          MOVE     "99",CLNO
          MOVE     ZERO,CPAGENO
          CLOCK    TIME,CTIMEIS
.
          PACK     KEY26,STRDTD,SP70  * Start of Date Range
          CALL     RSCCEP3
PEXCP100  CALL     RKCCEP3
          BRANCH   OVRCD,PEXCP900
          MATCH    CCEPLTD,ENDDTD     * End of Date Range
          GOTO     PEXCP900 IF LESS
.
          IF       INCOMPLT=0
            MATCH    "0",CCEPCOM      * Ingnore Incomplete Records
            GOTO     PEXCP100 IF EQUAL
          ENDIF
.
          IF       CCEPLOS>MAXLOS
            GOTO     PEXCP150         * Include if > maximum LOS Parameter
          ENDIF
.
          IF       (ZEROLOS=1)&(CCEPLOS<1)
            GOTO     PEXCP150         * Include if Zero LOS Required and LOS<1
          ENDIF
          GOTO     PEXCP100
.
PEXCP150  ADD      ONE,SECTOR
          IF       (SECTOR%100=0)
            DISPLAY   *P11:24,*V2LON,SECTOR
          ENDIF
.
          ADD      ONE,CLNO
          COMPARE  "55",CLNO
          CALL     PEXPH000 IF NOT LESS
.
          UNPACK   CCEPSDT,CCENT,CYEAR,CMON,CDAY
          CALL     PACDATE
          PACK     KEY10,CPCDATE,SP70
.
          UNPACK   CCEPLTD,CCENT,CYEAR,CMON,CDAY
          CALL     PACDATE
          PACK     KEY11,CPCDATE,SP70
.
          UNPACK   CCEPADAT,CCENT,CYEAR,CMON,CDAY
          CALL     PACDATE
.
.                                                           * changed *C-211936
....      PRINT    CCEPHCD,"/",CCEPEPS,SP1,CCEPURN,SP1,KEY10,SP1:
....               KEY11,CPCDATE,SP2,CCEPMDCC,"/",CCEPDRGC,SP2,CCEPLOS
          PRINT    CCEPHCD,"/",CCEPEPS,SP1,CCEPURN,SP1,KEY10,SP1:
                   KEY11,CPCDATE,SP2,CCEPMDCC,"/",CCEPSDRG,SP2,CCEPLOS
.                                                           * end     *C-211936
.
          ASSIGN   (SECTOR%500),AUDTSECT
          COMPARE  ZERO,AUDTSECT
          GOTO     PEXCP100 IF NOT EQUAL
.
PEXCP200  BEEP
          KEYIN     *P40:24,*V2LON,*DV,SECTOR,*HOFF:
                    " Records Printed. Continue (":
                    *V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",ANS
          REP       UPPLOW,ANS
          MATCH     ANSY,ANS
          GOTO      PEXCP100 IF EQUAL
          MATCH     ANSN,ANS
          GOTO      PEXCP200 IF NOT EQUAL
.
PEXCP900  COMPARE   ZERO,CPAGENO
          CALL      PEXPH000 IF EQUAL
          CALL      UND80
          PRINT     *20,SECTOR," Episodes Printed."
          CALL      UND80
          PRINT     *20,"**** End of Report ****"
.
PEXCP999  RETURN
.
.------------------------------------------------------------
. Print Exception Episode Report Header
.------------------------------------------------------------
PEXPH000  CALL     HEAD80
          PRINT    *20,"Patient Interface Audit Exceptions Report"
          PRINT    "Transfer Date From ",FROMDTD," to ",TODTD
          PRINT    "Episodes with L.O.S. > ",MAXLOS;
          IF       ZEROLOS=1
            PRINT    " and < 1 "
          ELSE
            PRINT    " "
          ENDIF
          IF       INCOMPLT=1
            PRINT    "Including Incomplete Episodes"
            ADD      ONE,CLNO
          ENDIF
          CALL     UND80
          PRINT    "Hospital/Episode    UR Number  Creation   Last Tran":
                   "  Admission  MDC/DRG  L.O.S."
          CALL     UND80
          ADD      SIX,CLNO
PEXPH999  RETURN
.
.
.**************************************************************************
.*                               PINC0000              Called by: ML1400  *
.* Print Incomplete Episode Records                                       *
.**************************************************************************
.
PINC0000  CALL      CONTQST                     * ok to continue
          BRANCH    CEXIT,PINC5000,PINC9999,PINC9999    * 1=Yes, 2=No, 3=Cancel
.
PINC5000  CALL      PINCE000                * Print Incomplete Episode Records
.
PINC9999  RETURN
.
.------------------------------------------------------------
. Print Incomplete Episode Listing
.------------------------------------------------------------
PINCE000  PACK     KEY19,ZERO,SP70
          DISPLAY  *P1:24,*EL,"Printing : "
          MOVE     ZERO,SECTOR
          MOVE     "99",CLNO
          MOVE     ZERO,CPAGENO
          CLOCK    TIME,CTIMEIS
.
          CALL     RSCCEP2
PINCE100  CALL     RKCCEP2
          BRANCH   OVRCD,PINCE900
          MATCH    "0",CCEPCOM
          GOTO     PINCE900 IF NOT EQUAL
.
          ADD      ONE,SECTOR
          IF       (SECTOR%100=0)
            DISPLAY   *P11:24,*V2LON,SECTOR
          ENDIF
.
          ADD      ONE,CLNO
          COMPARE  "55",CLNO
          CALL     PINCH000 IF NOT LESS
.
          UNPACK   CCEPSDT,CCENT,CYEAR,CMON,CDAY
          CALL     PACDATE
          PACK     KEY10,CPCDATE,SP70
.
          UNPACK   CCEPLTD,CCENT,CYEAR,CMON,CDAY
          CALL     PACDATE
          PACK     KEY11,CPCDATE,SP70
.
          UNPACK   CCEPADAT,CCENT,CYEAR,CMON,CDAY
          CALL     PACDATE
.
.                                                           * changed *C-211936
....      PRINT    CCEPHCD,"/",CCEPEPS,SP1,CCEPURN,SP1,KEY10,SP1:
....               KEY11,CPCDATE,SP2,CCEPMDCC,"/",CCEPDRGC,SP2,CCEPLOS
          PRINT    CCEPHCD,"/",CCEPEPS,SP1,CCEPURN,SP1,KEY10,SP1:
                   KEY11,CPCDATE,SP2,CCEPMDCC,"/",CCEPSDRG,SP2,CCEPLOS
.                                                           * end     *C-211936
.
          GOTO     PINCE100
.
PINCE900  COMPARE   ZERO,CPAGENO
          CALL      PINCH000 IF EQUAL
          CALL      UND80
          PRINT     *20,SECTOR," Episodes Printed."
          CALL      UND80
          PRINT     *20,"**** End of Report ****"
.
PINCE999  RETURN
.
.------------------------------------------------------------
. Print Incomplete Episode Report Header
.------------------------------------------------------------
PINCH000  CALL     HEAD80
          PRINT    *20,"Incomplete Episode Report"
          CALL     UND80
          PRINT    "Hospital/Episode    UR Number  Creation   Last Tran":
                   "  Admission  MDC/DRG  L.O.S."
          CALL     UND80
          ADD      FOUR,CLNO
          RETURN
.
.
.**************************************************************************
.*                               PEPS0000              Called by: ML1500  *
.* Print Episode Details                                                  *
.**************************************************************************
.
PEPS0000  CALL      REPS0000                    * Keyin Episode From / To
.
          CALL      KSUM0000                    * Summary Report
.
          CALL      CONTQST                     * ok to continue
          BRANCH    CEXIT,PEPS5000,PEPS9999,PEPS9999    * 1=Yes, 2=No, 3=Cancel
.
PEPS5000  CALL      REPT0000                * Print Episode Details 
.
PEPS9999  RETURN
.
.------------------------------------------------------------
. Keyin Episode Number From and To
.------------------------------------------------------------
REPS0000  DISPLAY   *P1:4,*EF
          KEYIN     *P1:4,"Episode From : ",*V2LON,STREPS
          ENDSET    STREPS
          APPEND    SP70,STREPS
          RESET     STREPS
          MATCH     SP70,STREPS
          GOTO      REPS0100 IF EQUAL
.
          MOVE     "1 ",CCEPHCD
          PACK      KEY18,CCEPHCD,STREPS,SP70
          CALL      RDCCEP1
          IF        OVRCD=1
            BEEP
            DISPLAY  *P1:24,"Invalid Episode - ";
            CALL      HITENTER
            GOTO      REPS0000
          ENDIF

          PACK      FROMEPS,CCEPEPS,SP1,CCEPSUR
          GOTO      REPS0150
.
REPS0100  MOVE      "Start             ",FROMEPS
          MOVE      SP70,STREPS
.
REPS0150  KEYIN     *P1:5,"Episode To   : ",*V2LON,ENDEPS
          ENDSET    ENDEPS
          APPEND    SP70,ENDEPS
          RESET     ENDEPS
          MATCH     SP70,ENDEPS
          GOTO      REPS0200 IF EQUAL
.
          MOVE     "1 ",CCEPHCD
          PACK      KEY18,CCEPHCD,ENDEPS,SP70
          CALL      RDCCEP1
          IF        OVRCD=1
            BEEP
            DISPLAY  *P1:24,"Invalid Episode - ";
            CALL      HITENTER
            GOTO      REPS0000
          ENDIF
.
          PACK      TOEPS,CCEPEPS,SP1,CCEPSUR
          MATCH     STREPS,ENDEPS
          GOTO      REPS0999 IF EQUAL
          GOTO      REPS0999 IF NOT LESS
          BEEP
          DISPLAY   *P1:24,"To Episode Must Be > From Episode - "
          CALL      HITENTER
          GOTO      REPS0000
.
REPS0200  MOVE      "Finish             ",TOEPS
          MOVE      "ZZ",ENDEPS
.
REPS0999  RETURN
.
.
.------------------------------------------------------------
. Keyin Report Zero LOS
.------------------------------------------------------------
KSUM0000  DISPLAY   *P1:6,*EF
          KEYIN     *P1:6,*EL,"Summary Report":
                    " (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,ANS;
.
          REP       UPPLOW,ANS
          MATCH     ANSY,ANS
          IF        @EQUAL
            MOVE      ONE,SUMMREPT
            GOTO      KSUM9999
          ENDIF
.
          MATCH     ANSN,ANS
          IF        @EQUAL
            MOVE      ZERO,SUMMREPT
            GOTO      KSUM9999
          ENDIF
.
          BEEP
          GOTO      KSUM0000
.
KSUM9999  RETURN
.
.------------------------------------------------------------
. Print Episode Report
.------------------------------------------------------------
.
.------------------------------------------------------------
. Print Episode Report
.------------------------------------------------------------
REPT0000  DISPLAY   *P1:24,*EL,"Printing Report : ";
          MOVE      ZERO,CPAGENO          * reset page no.
          CLOCK     TIME,CTIMEIS          * get current time
          MOVE      "99",CLNO             * init last line number
          MOVE      "1 ",CCHCHCD
          PACK      KEY18,CCHCHCD,STREPS
          CALL      RDCCEP1
          IF        OVRCD=0
            CALL      RPCCEP1
          ENDIF
.
REPT1000  CALL      RKCCEP1
          BRANCH    OVRCD,REPT9000
          MATCH     CCEPHCD,CCHCHCD
          GOTO      REPT9000 IF NOT EQUAL
          MATCH     CCEPEPS,ENDEPS
          GOTO      REPT9000 IF LESS
          DISPLAY   *P19:24,*V2LON,CCEPEPS
.
          MOVE      CCEPCOM,F1
          MOVE      "No ",KEY3
          IF        F1=1
            MOVE      "Yes",KEY3
          ENDIF
.
          MOVE      CCEPINPT,F1
          MOVE      "No  ",KEY4
          IF        F1=1
            MOVE      "Yes ",KEY4
          ENDIF
.
          UNPACK    CCEPSDT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPCDATE,KEY10
          UNPACK    CCEPLTD,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
.
          BRANCH    SUMMREPT,REPT1100
          COMPARE   "52",CLNO
          CALL      PHED0000 IF NOT LESS
          ADD       FOUR,CLNO
          CALL      UND132
          PRINT     CCEPEPS," 1. ",CCEPURN,SP1,CCEPSUR,SP1,CCEPGIV,SP1:
                    KEY3,SP3,KEY10,SP1,CPCDATE,SP1,CCEPLOS,SP2,KEY4:
                    SP4,CCEPVIST,SP4,CCEPSEX
          MOVE      CCEPDAY,F1
          MOVE      "No ",KEY3
          IF        F1=1
            MOVE      "Yes",KEY3
          ENDIF
          UNPACK    CCEPDOB,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
.
          PRINT     *17," 2. ",CPCDATE,*33,KEY3,*45,CCEPAGEY:
                    *57,CCEPAGEM,*69,CCEPAGED,*81,CCEPCOB,*95,CCEPREL:
                    *108,CCEPAHFD,*121,CCEPAHTB
.
          UNPACK    CCEPADAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     *17," 3. ",CPCDATE,*33,CCEPAWAR,*45,CCEPASRC,*57,CCEPACLS:
                    *69,CCEPAMBS,*81,CCEPADPT,*95,CCEPASER,*108,CCEPACAR:
                    *121,CCEPOPCL
.
          UNPACK    CCEPDDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
.                                                           * changed *C-211936
....      PRINT     *17," 4. ",CPCDATE,*33,CCEPDWAR,*45,CCEPDSTA,*57,CCEPDDES:
....                *69,CCEPDMBS,*81,CCEPDDPT,*95,CCEPDSER,*108,CCEPMDCC:
....                *121,CCEPDRGC
          PRINT     *17," 4. ",CPCDATE,*33,CCEPDWAR,*45,CCEPDSTA,*57,CCEPDDES:
                    *69,CCEPDMBS,*81,CCEPDDPT,*95,CCEPDSER,*108,CCEPMDCC:
                    *121,CCEPSDRG
.                                                           * end     *C-211936
.
          PRINT     *17," 5. ",CCEPPDIA,*33,CCEPSDIA,*45,CCEPPOPP,*57,CCEPSOPP:
                    *69,CCEPARDC,*81,CCEPATDC,*95,CCEPAADC,*108,CCEPDADC
.
          GOTO      REPT1000
.
REPT1100  COMPARE   "52",CLNO
          CALL      PHED0000 IF NOT LESS
          ADD       ONE,CLNO
          PRINT     CCEPEPS," 1. ",CCEPURN,SP1,CCEPSUR,SP1,CCEPGIV,SP1:
                    KEY3,SP3,KEY10,SP1,CPCDATE,SP1,CCEPLOS,SP2,KEY4:
                    SP4,CCEPVIST,SP4,CCEPSEX
          GOTO      REPT1000
.
REPT9000  COMPARE   ZERO,CPAGENO
          CALL      PHED0000 IF EQUAL
          CALL      UND132
          PRINT     *45,"*** End of Report ***"
.
REPT9999  RETURN
.
.------------------------------------------------------------
. Print Episode Report Heading
.------------------------------------------------------------
PHED0000  CALL      HEAD132
          PRINT     "Hospital      : ",CCHCHCD,SP1,CCHCDES
          PRINT     "Episodes From : ",FROMEPS," to ",TOEPS
          CALL      UND132
          BRANCH    SUMMREPT,PHED1100
          PRINT     "Episode";
.
          PRINT     *17," 1. U/R Number Surname              Given Names":
                    "            Completed Created    Updated    L.O.S. I":
                    "npat. Visit Sex"
.
          PRINT     *17," 2. Birth Date  Day Case    Age Years   Age Mths  ":
                   "  Age Days    C.O.B.        Religion     Heath Fund  ":
                   " Fund Table"
.
          PRINT     *17," 3. Adm. Date   Ward        Source      Class     ":
                   "  Diagnosis   Department    Service      Care Class  ":
                   " Clinic "
.
          PRINT     *17," 4. Dis. Date   Ward        Status      Destinatio":
                   "n Diagnosis   Department    Service      MDC          DRG"
.
          PRINT     *17," 5. Pr. Diag.   Sc. Diag.   Pr. Oper.   Sc. Oper    ":
                   "Ref. Doc.   Treat. Doc.   Adm.Att.Doc. Dis.Att.Doc.   "
.
          GOTO      PHED9999
.
PHED1100  PRINT     "Episode          1. U/R Number Surname            ":
                    "  Given Names            Complete Created    Upd":
                    "ated    L.O.S. Inpat  Visit Sex"
.
PHED9000  CALL      UND132
.
PHED9999  RETURN
.
.**************************************************************************
.*                               CEPS0000              Called by: ML1600  *
.* Complete a Range of Epsiodes                                           *
.**************************************************************************
.
CEPS0000  CALL      COMP0000                    * Complete a Range of Episodes
.
CEPS9999  RETURN
.
.
.**************************************************************************
.*                               FINC0000              Called by: ML1700  *
.* Flag a Range of Episodes as Incomplete                                 *
.**************************************************************************
.
FINC0000  CALL      INCM0000                     * Flag a Range of Episodes 
.                                                * as Incomplete
FINC9999  RETURN
.
.----------------------------------------------------------------------------
. Routine to Flag as complete a range of episodes based of discharge date
.----------------------------------------------------------------------------
COMP0000   DISPLAY  *P1:4,*EF,*V2LON,*ULON,"Complete Episodes in the Range":
                    *HOFF,*P1:5,"Discharge Date From : ":
                    *P1:6,"               To   : "
           MOVE     "23",CCOL
           MOVE     "5",CVERT
           MOVE     SP70,CDAY
           MOVE     CMM,CMON
           MOVE     CYY,CYEAR
           MOVE     CCC,CCENT
           CALL     KEYDATE
           BRANCH   OVRCD,COMP0100
.
           MATCH    SP2,CDAY
           GOTO     COMP0100 IF EQUAL
           PACK     STRDAT,CCENT,CYEAR,CMON,CDAY
           REP      " 0",STRDAT
           CALL     PACDATE
           MOVE     CPCDATE,FROMDAT
           GOTO     COMP0140
.
COMP0100   MOVE     "Start             ",FROMDAT
           MOVE     SP70,STRDAT
.
COMP0140   DISPLAY  *P23:5,*V2LON,FROMDAT
.
COMP0150   MOVE     "23",CCOL
           MOVE     "6",CVERT
           MOVE     SP70,CDAY
           MOVE     CMM,CMON
           MOVE     CYY,CYEAR
           MOVE     CCC,CCENT
           CALL     KEYDATE
           BRANCH   OVRCD,COMP0200
           MATCH    SP2,CDAY
           GOTO     COMP0200 IF EQUAL
           PACK     ENDDAT,CCENT,CYEAR,CMON,CDAY
           REP      " 0",ENDDAT
           CALL     PACDATE
           MOVE     CPCDATE,TODAT
           MATCH    STRDAT,ENDDAT
           GOTO     COMP0900 IF EQUAL
           GOTO     COMP0900 IF NOT LESS
           BEEP
           DISPLAY  *P1:24,"To Date Must Be > From Date - "
           CALL     HITENTER  
           GOTO     COMP0000
.
COMP0200   MOVE     "Finish             ",TODAT
           MOVE     "99999999",ENDDAT
COMP0900   DISPLAY  *P23:6,*V2LON,TODAT
.
           CALL      CONTQST                     * ok to continue
           BRANCH    CEXIT,COMP1000,COMP9999,COMP9999    * 1=Yes, 2=No, 3=Cancel
           GOTO     COMP9999
.
COMP1000   PACK     KEY26,STRDAT,SP70
           MOVE     ZERO,TOTALSCN
           MOVE     ZERO,TOTALCOM
           CLOCK    TIME,CTIMEIS
           DISPLAY  *P1:24,*EL,"Started : ",CTIMEIS
           CALL     RSCCEP4
COMP2000   CALL     RKCCEP4
           BRANCH   OVRCD,COMP9000
           MATCH    CCEPDDAT,ENDDAT
           GOTO     COMP9000 IF LESS
.
           ADD      ONE,TOTALSCN
           IF       (TOTALSCN%1000=0)
             CLOCK    TIME,CTIMEIS
             DISPLAY   *P20:24,*EL,"Records Scanned : ",TOTALSCN:
                      " at ",CTIMEIS
           ENDIF
.
           MOVE     CCEPCOM,F1
           BRANCH   F1,COMP2000
           ADD      ONE,TOTALCOM
           MOVE     ONE,CCEPCOM
           CALL     UPCCEP4
           GOTO     COMP2000
.
COMP9000   CLEAR    DISPMSG
           APPEND   "Episodes Scanned : ",DISPMSG
           APPEND   TOTALSCN,DISPMSG
           APPEND   "  Completed : ",DISPMSG
           APPEND   TOTALCOM,DISPMSG
           APPEND   " - ",DISPMSG
           RESET    DISPMSG
           BEEP
           CALL     MESSAGE1
.
COMP9999   RETURN
.
.----------------------------------------------------------------------------
. Routine to Flag as Incomplete a range of episodes based of discharge date
.----------------------------------------------------------------------------
INCM0000   DISPLAY  *P1:4,*EF,*V2LON,*ULON,"Flag as Incomplete Episodes in":
                    "the Range":
                    *HOFF,*P1:5,"Discharge Date From : ":
                    *P1:6,"               To   : "
           MOVE     "23",CCOL
           MOVE     "5",CVERT
           MOVE     SP70,CDAY
           MOVE     CMM,CMON
           MOVE     CYY,CYEAR
           MOVE     CCC,CCENT
           CALL     KEYDATE
           BRANCH   OVRCD,INCM0100
.
           MATCH    SP2,CDAY
           GOTO     INCM0100 IF EQUAL
           PACK     STRDAT,CCENT,CYEAR,CMON,CDAY
           REP      " 0",STRDAT
           CALL     PACDATE
           MOVE     CPCDATE,FROMDAT
           GOTO     INCM0140
.
INCM0100   MOVE     "Start             ",FROMDAT
           MOVE     SP70,STRDAT
.
INCM0140   DISPLAY  *P23:5,*V2LON,FROMDAT
.
INCM0150   MOVE     "23",CCOL
           MOVE     "6",CVERT
           MOVE     SP70,CDAY
           MOVE     CMM,CMON
           MOVE     CYY,CYEAR
           MOVE     CCC,CCENT
           CALL     KEYDATE
           BRANCH   OVRCD,INCM0200
           MATCH    SP2,CDAY
           GOTO     INCM0200 IF EQUAL
           PACK     ENDDAT,CCENT,CYEAR,CMON,CDAY
           REP      " 0",ENDDAT
           CALL     PACDATE
           MOVE     CPCDATE,TODAT
           MATCH    STRDAT,ENDDAT
           GOTO     INCM0900 IF EQUAL
           GOTO     INCM0900 IF NOT LESS
           BEEP
           DISPLAY  *P1:24,"To Date Must Be > From Date - "
           CALL     HITENTER
           GOTO     INCM0000
.
INCM0200   MOVE     "Finish             ",TODAT
           MOVE     "99999999",ENDDAT
INCM0900   DISPLAY  *P23:6,*V2LON,TODAT
.
           CALL      CONTQST                     * ok to continue
           BRANCH    CEXIT,INCM1000,INCM9999,INCM9999    * 1=Yes, 2=No, 3=Cancel
           GOTO     INCM9999
.
INCM1000   PACK     KEY26,STRDAT,SP70
           MOVE     ZERO,TOTALSCN
           MOVE     ZERO,TOTALCOM
           CLOCK    TIME,CTIMEIS
           DISPLAY  *P1:24,*EL,"Started : ",CTIMEIS
           CALL     RSCCEP4
INCM2000   CALL     RKCCEP4
           BRANCH   OVRCD,INCM9000
           MATCH    CCEPDDAT,ENDDAT
           GOTO     INCM9000 IF LESS
.
           ADD      ONE,TOTALSCN
           IF       (TOTALSCN%1000=0)
             CLOCK    TIME,CTIMEIS
             DISPLAY   *P20:24,*EL,"Records Scanned : ",TOTALSCN:
                      " at ",CTIMEIS
           ENDIF
.
           MOVE     CCEPCOM,F1
           COMPARE  ZERO,F1
           GOTO     INCM2000 IF EQUAL
           ADD      ONE,TOTALCOM
           MOVE     ZERO,CCEPCOM
           CALL     UPCCEP4
           GOTO     INCM2000
.
INCM9000   CLEAR    DISPMSG
           APPEND   "Episodes Scanned : ",DISPMSG
           APPEND   TOTALSCN,DISPMSG
           APPEND   "  Flagged : ",DISPMSG
           APPEND   TOTALCOM,DISPMSG
           APPEND   " - ",DISPMSG
           RESET    DISPMSG
           BEEP
           CALL     MESSAGE1
.
INCM9999   RETURN
.
.
.------------------------------------------------------------
. Read & Update Allied Health Details
.------------------------------------------------------------
RALL0000  IF        ALLREFOP=0
            PACK      KEY8,PVIBILL,SP70 * Episode = Admission Number/Encounter 
            CALL      RDALREF1
            IF        OVRCD=0
              CALL      UREF0000      * Update Referral Details
.
              PACK      KEY8,PVIBILL,SP70
              CALL      RDALDAD1
              IF        OVRCD<>1
                MOVE      ALDAFHOS,CCEPADTS
                MOVE      ALDATHOS,CCEPDCTS
              ENDIF
            ELSE
              MOVE      "No Allied Health Referral Record.",DISPMSG
              CALL      WARN0000
            ENDIF
          ENDIF
.
          IF        ALLENCOP=0
            PACK      KEY16,PVIBILL,ENCNNUMB,SP70     
            CALL      RDALENC1
            IF        OVRCD=0
              CALL      UENC0000              * Update Encounter Details
            ELSE
              MOVE      "No Allied Health Encounter Record.",DISPMSG
              CALL      WARN0000
            ENDIF
          ENDIF
.
RALL9999  RETURN
.
.------------------------------------------------------------
. Update Allied Health Referral Details
.------------------------------------------------------------
UREF0000  MOVE      ALRESTAT,CCEPRSTA       * Referral Status
          MOVE      ALRERHCP,CCEPRHCP       * Resp HCP
          MOVE      ALREPRO1,CCEPPRB1       * Problem Code 1
          MOVE      ALREPRO2,CCEPPRB2       * Problem Code 2
          MOVE      ALREPRO3,CCEPPRB3       * Problem Code 3
          MOVE      ALREDIA1,CCEPDIA1       * Diagnosis Code 1
          MOVE      ALREDIA2,CCEPDIA2       * Diagnosis Code 2
          MOVE      ALREDIA3,CCEPDIA3       * Diagnosis Code 3
          MOVE      ALREDCLO,CCEPDDAT       * Date Closed
          MOVE      ALRERCLO,CCEPDSTA       * Closure Reason
          MOVE      ALREDACT,CCEPADAT       * Date Activated
          MOVE      ALRESRCE,CCEPASRC       * Admission Source
          MOVE      ALREDEPT,CCEPADPT       * Department
          MOVE      ALRERCLO,CCEPRCLO       * Reason for Closure
          MOVE      ALRESRCE,CCEPSRCE       * Source of Referral
          MOVE      ALREDEPT,CCEPDEPT       * Department
.
UREF9999  RETURN
.
.------------------------------------------------------------
. Update Allied Health Encounter Details
.------------------------------------------------------------
UENC0000  MOVE      ALENENCT,CCEPENCN       * Encounter Number
          REP       " 0",CCEPENCN           * Zero Fill
          MOVE      ALENHCP,CCEPSERP        * Service Provider
          MOVE      ALENCLIN,CCEPACTY       * Clinic Type
          MOVE      ONE,CCEPCOM
          MOVE      ALENSDAT,CCEPSERD       * Service Date
          MOVE      ALENTYPE,CCEPPTYP       * Patient Type
          MOVE      ALENSERV,CCEPSTYP       * Service Type
          MOVE      ALENDIUN,CCEPDUNT       * Direct Units
          MOVE      ALENDBUN,CCEPDBUN       * Direct Billable Units
          MOVE      ALENINUN,CCEPIUNT       * Indirect Units
          MOVE      ALENIBUN,CCEPIBUN       * Indirect Billable Units
.
UENC9999  RETURN
.
+
. =========================================================================
.         I/O Includes
. =========================================================================
.
          INC       STD001IO
          INC       CALCAGE
          INC       CALCR508
          INC       CALDY508
          INC       CALCDAYS
.
          INC       ALLDADIO/INC
          INC       ALLREFIO/INC
          INC       ALLENCIO/INC
..        INC       CALAG508
..        INC       CALCDAYS
..        INC       CALCR508
..        INC       CALDY508
          INC       CCSAGEIO/INC
          INC       CCSDRGIO/INC
          INC       CCSEPSIO/INC
          INC       CCSEWTIO/INC
..        INC       CCSG58CD
          INC       CCSHCDIO/INC
          INC       CCSHLCIO/INC
          INC       CCSIADIO/INC
          INC       CCSIMCIO/INC
          INC       CCSXHDIO/INC
          INC       CEABHDIO/INC
          INC       CEADEFIO/INC
          INC       CEAMAPIO/INC
          INC       CEAMBPIO/INC
          INC       CEAMCPIO/INC
          INC       CEAMDPIO/INC
          INC       CEAMEPIO/INC
          INC       CEANAMIO/INC
          INC       CEANBMIO/INC
          INC       CEANCMIO/INC
          INC       CEANDMIO/INC
          INC       CEAPSCIO/INC
          INC       CEASTRIO/INC
          INC       CEATAMIO/INC
          INC       CEATBMIO/INC
          INC       CEATCMIO/INC
          INC       CEATDMIO/INC
          INC       CEATEMIO/INC
          INC       CEATFMIO/INC
          INC       CEATGMIO/INC
          INC       CEAVAMIO/INC
          INC       CEAVBMIO/INC
..        INC       OPN508CD
          INC       OPRCLIIO/INC
          INC       OPRDEAIO/INC
          INC       OPRDEBIO/INC
          INC       OPRARDIO/INC
          INC       OPRSRGIO/INC
          INC       OPRMOPIO/INC
          INC       OPRSESIO/INC
          INC       OUTBB1IO/INC
          INC       OUTSITIO/INC
          INC       PATCODIO/INC
          INC       PATDADIO/INC
          INC       PATDO1IO/INC
          INC       PATDSCIO/INC
          INC       PATDTRIO/INC
          INC       PATECDIO/INC
          INC       PATECOIO/INC
          INC       PATINVIO/INC
          INC       PATITMIO/INC
          INC       PATMA1IO/INC
          INC       PATMI1IO/INC
          INC       PATMMBIO/INC
          INC       PATPGRIO/INC
          INC       PATTRNIO/INC
          INC       PATVISIO/INC
          INC       PMSMTIIO/INC
          INC       PMSFCIIO/INC
          INC       EMRVISIO/INC
          INC       PATICUIO/INC
          INC       EMRVCDIO/INC
          INC       PMSVX1IO/INC
          INC       PMSPX2IO/INC
          INC       PRIDTRIO/INC
          INC       OUTBOAIO/INC
          INC       PMSCCDIO/INC
.
          INC       GCCARD00/PBL
.

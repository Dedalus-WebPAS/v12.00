.-------------------------------------------------------------------------------
.   System    :   FMS Accounting System  
.                           
.   Program   :   FMSCCCFM 
.                            
.   Requires  :   FMLALEDG Ledger Number
.                 FMLADESC Ledger Number Description
.                 FMSUUD4A Cost Centre Code Length (Sector 51 controlf)
.                 FMSAMAA1 open
.
.   Routines  :   KCCCFM00 Keyin Consol Cost Centre  - Returns a valid record
.                 ACCCFM00 Accept Consol Cost Centre - Returns a key NOT on file
.   
.   Return    :   EXIT = 1 null entry EXIT = 2 EXITCHAR entered
.
.   Internal  :   HFMCFA00 Help Display for Consol Cost Centre  
.                            
.   Redisplay :   RCCCFM00 Screen Redisplay Called for Consol Cost Centre  
.-------------------------------------------------------------------------------
.   Mods      :    
.-------------------------------------------------------------------------------
. Normal Code Keyin - Code Must Exist Exit = 1 if Null Entry
.-------------------------------------------------------------------------------
KCCCFM00  MOVE      FMSUUD4A,CSTRLEN          * set up string length
          CALL      GSTR0000                  * get code
          PACK      FMCFCCOS,CSTRING,SP70
.
          MATCH     SP70,FMCFCCOS             * System Code Spaces so exit set
          GOTO      KCCCFM90 IF EQUAL
.
          CMATCH    EXITCHAR,FMCFCCOS         * Exit Selected
          GOTO      KCCCFM95 IF EQUAL
.
          CMATCH    QUEST,FMCFCCOS            * Help Required  
          GOTO      KCCCFM10 IF NOT EQUAL
          CALL      HFMCFA00                  * Display List Of FMCFCCOSs
.         PACK      CDATASAV,FMCFCCOS,SP70    * save Consol Cost centre
.         CALL      RCCCFM00                  * Redisplay Routine
.         PACK      FMCFCCOS,CDATASAV,SP70    * restore Consol Cost centre
.
          ENDSET    FMCFCCOS
          APPEND    SP70,FMCFCCOS
          RESET     FMCFCCOS
          MATCH     SP70,FMCFCCOS             * System Code Spaces so exit set
          GOTO      KCCCFM00 IF EQUAL
.
KCCCFM10  PACK      KEY26,FMLALEDG,FMCFCCOS,SP70
          CALL      RDFMCF1                                   
          BRANCH    OVRCD,KCCCFM80
          MOVE      ZERO,EXIT                 * no entry so exit is set
          GOTO      KCCCFM99
.
KCCCFM80  DISPLAY   *P1:24,*EL,*B,"Consolidated Cost Centre Does Not Exist - ";
          CALL      HITENTER
          GOTO      KCCCFM00
.
KCCCFM90  MOVE      ONE,EXIT                  * null entry so exit is set
          GOTO      KCCCFM99
.
KCCCFM95  MOVE      TWO,EXIT                  * Exit character entered    
.
KCCCFM99  RETURN
.-------------------------------------------------------------------------------
. Accept Code Keyin - Code Must Not Exist 
.-------------------------------------------------------------------------------
ACCCFM00  MOVE      FMSUUD4A,CSTRLEN          * set up string length
          CALL      GSTR0000                  * get code
          PACK      FMCFCCOS,CSTRING,SP70
.
          MATCH     SP70,FMCFCCOS             * System Code Spaces so exit set
          GOTO      ACCCFM90 IF EQUAL
.
          CMATCH    EXITCHAR,FMCFCCOS         * Exit Selected
          GOTO      ACCCFM95 IF EQUAL
.
          CMATCH    QUEST,FMCFCCOS            * Help Required  
          GOTO      ACCCFM10 IF NOT EQUAL
          CALL      HFMCFA00                  * Display List Of FMCFCCOSs
.         PACK      CDATASAV,FMCFCCOS,SP70    * save Consol Cost centre
.         CALL      RCCCFM00                  * Redisplay Routine
.         PACK      FMCFCCOS,CDATASAV,SP70    * restore Consol Cost centre
.
          ENDSET    FMCFCCOS
          APPEND    SP70,FMCFCCOS
          RESET     FMCFCCOS
          MATCH     SP70,FMCFCCOS             * System Code Spaces so exit set
          GOTO      ACCCFM00 IF EQUAL
.
ACCCFM10  PACK      KEY26,FMLALEDG,FMCFCCOS,SP70
          MOVE      ZERO,EXIT                 * no entry so exit is set
          CALL      RDFMCF1                                   
          BRANCH    OVRCD,ACCCFM20
.
          DISPLAY   *P1:24,*EL,*B,"Consolidated Cost Centre Already Exists - ";
          CALL      HITENTER
          GOTO      ACCCFM00
.
ACCCFM20  PACK      KEY14,FMLALEDG,FMCFCCOS
          MOVE      ZERO,EXIT                 * no entry so exit is set
          CALL      RDFMAM1                                   
          BRANCH    OVRCD,ACCCFM99
.
          DISPLAY   *P1:24,*EL,*B,"Account Already Exists - ";
          CALL      HITENTER
          GOTO      ACCCFM00
.
ACCCFM90  MOVE      ONE,EXIT                  * null entry so exit is set
          GOTO      ACCCFM99
.
ACCCFM95  MOVE      TWO,EXIT                  * Exit character entered    
.
ACCCFM99  RETURN
.------------------------------------------------------------------------------
. Display List of All Codes
.------------------------------------------------------------------------------
HFMCFA00  
          MOVE      ZERO,CSCRSIZ
          IF        HTOP<3
            MOVE      "10",HTOP
            MOVE      "24",HBOT
            MOVE      "30",HLEF
            MOVE      "80",HRIG
          ENDIF
HFMCFA04
          CALL      GSCRN000
          BRANCH    EXIT,HFMCFA99
          MOVE      STDCOL00,STDCOL01
          ADD       " 5",STDCOL01
          DISPLAY   *PSTDCOL01:STDROW,*V2LON,*ULON,"Cost Centre"               
.
          MOVE      STDCOL01,STDCOL02
          ADD       "12",STDCOL02
          DISPLAY   *PSTDCOL02:STDROW,*V2LON,*ULON,"Description"        
.
          MOVE      STDCOL02,STDCOL03
          ADD       "30",STDCOL03
HFMCFA08
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          MOVE      SP70,FMCFCCOS
          MOVE      SP70,FMCFSCOS
          PACK      KEY26,FMLALEDG,SP70
.                                                                               
          CALL      RSFMCF1 
HFMCFA10
          CALL      RKFMCF1 
          BRANCH    OVRCD,HFMCFA15
          PACK      KEY26,FMCFLEDG,FMCFCCOS,FMCFSCOS,SP70
.                                                                               
          MATCH     FMLALEDG,FMCFLEDG
          GOTO      HFMCFA15 IF NOT EQUAL
.
          MATCH     SP70,FMCFSCOS
          GOTO      HFMCFA10 IF NOT EQUAL
.                                                                               
          BRANCH    CSEARCH,HFMCFA12
          CALL      HFMCFA60
          BRANCH    OVRCD,HFMCFA10
HFMCFA12
          ADD       ONE,XITEMNO
          ADD       ONE,STDROW
          STORE     KEY26,XITEMNO,ST1,ST2,ST3,ST4,ST5:
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          DISPLAY   *PSTDCOL00:STDROW,SP1,*V2LON,XITEMNO,DOT
          DISPLAY   *PSTDCOL01:STDROW,FMCFCCOS
          DISPLAY   *PSTDCOL02:STDROW,FMCFDESC
          COMPARE   MAXITEM,XITEMNO
          GOTO      HFMCFA10 IF NOT EQUAL
HFMCFA15
.                                                                               
          MOVE      ONE,DITEM
          MOVE      MINITEM,DROW
          ADD       ONE,DROW
          DISPLAY   *PSTDCOL00:DROW,*V2LON,*HON,SP1,DITEM,DOT
          CLIP
          FLUSH     HLEF,HTOP,HRIG,HBOT
.
HFMCFA20
          CALL      HSCRI000
          BRANCH    EXIT,HFMCFA30,HFMCFA35,HFMCFA40,HFMCFA45,HFMCFA04:
                              HFMCFA91,HFMCFA50
          GOTO      HFMCFA92
HFMCFA30
          CALL      RKFMCF1 
          BRANCH    OVRCD,HFMCFA85
          PACK      KEY26,FMCFLEDG,FMCFCCOS,SP70
.                                                                               
.                                                                               
          CALL      RPFMCF1 
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMCFA10
HFMCFA35
          MOVE      ST1,KEY26 
          CALL      RDFMCF1 
          CALL      RPFMCF1 
          BRANCH    OVRCD,HFMCFA85
          PACK      KEY26,FMCFLEDG,FMCFCCOS,SP70
.                                                                               
.                                                                               
.                                                                               
.                                                                               
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
HFMCFA36
          CALL      RPFMCF1 
          BRANCH    OVRCD,HFMCFA37
          PACK      KEY26,FMCFLEDG,FMCFCCOS,SP70
.                                                                               
.                                                                               
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HFMCFA36 IF NOT EQUAL
HFMCFA37
          MOVE      ZERO,XITEMNO
          GOTO      HFMCFA10
HFMCFA40
          MOVE      ST1,KEY26 
          CALL      RDFMCF1 
          CALL      RPFMCF1 
          BRANCH    OVRCD,HFMCFA85
          PACK      KEY26,FMCFLEDG,FMCFCCOS,SP70
.                                                                               
.                                                                               
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMCFA08
HFMCFA45
          CALL      RKFMCF1 
          BRANCH    OVRCD,HFMCFA85
          PACK      KEY26,FMCFLEDG,FMCFCCOS,SP70
.                                                                               
.                                                                               
          SUSPEND
          CLIP      1,1,CRIG,24
.
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      ZERO,XITEMNO
          PACK      KEY26,Z70                                                    
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
          CALL      RSFMCF1 
HFMCFA46
          CALL      RPFMCF1 
          BRANCH    OVRCD,HFMCFA47
          PACK      KEY26,FMCFLEDG,FMCFCCOS,SP70
.                                                                               
.                                                                               
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HFMCFA46 IF NOT EQUAL
HFMCFA47
          MOVE      ZERO,XITEMNO
          GOTO      HFMCFA10
HFMCFA50  COMPARE   ZERO,CSEARCH
          GOTO      HFMCFA55 IF EQUAL
          MOVE      ZERO,CSEARCH
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          ADD       ONE,STDROW
          UNPACK    SP70,SCHFLD01,SCHFLD02,SCHFLD03,SCHFLD04,SCHFLD05
          UNPACK    SP70,SCHFLD06,SCHFLD07,SCHFLD08,SCHFLD09,SCHFLD10
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          DISPLAY   *PSTDCOL00:STDROW,*V2LON,*HON,"Sch"
          KEYIN     *PSTDCOL01:STDROW,*V2LON,SCHFLD01
          RESET     SCHFLD01
          KEYIN     *PSTDCOL02:STDROW,*V2LON,SCHFLD02
          RESET     SCHFLD02
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMCFA08
HFMCFA55  MOVE      ONE,CSEARCH
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMCFA08
HFMCFA60  MOVE      ZERO,OVRCD
          MATCH     SP70,SCHFLD01
          GOTO      HFMCFA61 IF EQUAL
          MATCH     SCHFLD01,FMCFCCOS
          GOTO      HFMCFA72 IF NOT EQUAL
HFMCFA61
          MATCH     SP70,SCHFLD02
          GOTO      HFMCFA62 IF EQUAL
          MATCH     SCHFLD02,FMCFDESC
          GOTO      HFMCFA72 IF NOT EQUAL
HFMCFA62
HFMCFA63
HFMCFA64
HFMCFA65
HFMCFA66
HFMCFA67
HFMCFA68
HFMCFA69
HFMCFA70
          GOTO      HFMCFA75
HFMCFA72  MOVE      ONE,OVRCD
HFMCFA75  RETURN
HFMCFA85
          LOAD      KEY26,XITEMNO,ST1,ST2,ST3,ST4,ST5:
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY26,FMCFLEDG,FMCFCCOS
          CALL      RDFMCF1 
HFMCFA90
.                                                                               
          BEEP
          GOTO      HFMCFA20
HFMCFA91
          MOVE      SP70,FMCFDESC
          MOVE      SP70,KEY26 
          MOVE      SP70,FMCFCCOS
          GOTO      HFMCFA96
HFMCFA92
          MOVE      SP70,KEY26 
          MOVE      SP70,FMCFCCOS
          LOAD      KEY26,CCITEM,ST1,ST2,ST3,ST4,ST5:
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY26,FMCFLEDG,FMCFCCOS
HFMCFA96
          PUTSCR    CSSCRNUM,HLEF,HTOP,HRIG,HBOT
          CALL      FRESCR00
          MOVE      ZERO,HTOP
          MOVE      ZERO,HLEF
          MOVE      ZERO,HBOT
          MOVE      ZERO,HRIG
HFMCFA99
          RETURN
.

.-------------------------------------------------------------------------------
.   System    :   FMS Accounting System  
.                           
.   Program   :   FMSGRPFM 
.                            
.   Routines  :   KGRPFM00 Keyin Alloc. Group   - Returns a valid record
.                 AGRPFM00 Accept Alloc. Group  - Returns a key NOT on file
.   
.   Return    :   EXIT = 1 null entry EXIT = 2 EXITCHAR entered
.
.   Internal  :   HFMGPA00 Help Display for Alloc. Group  
.                            
.   Redisplay :   RGRPFM00 Screen Redisplay Called for Alloc. Group  
.-------------------------------------------------------------------------------
.   Mods      :    
.-------------------------------------------------------------------------------
. Normal Code Keyin - Code Must Exist Exit = 1 if Null Entry
.-------------------------------------------------------------------------------
KGRPFM00  MOVE      UNDLN70,FMGPCODE
          KEYIN     *PCCOL:CVERT,*EL,*DV,FMGPCODE:
                    *PCCOL:CVERT,*V2LON,FMGPCODE: 
                    *PCCOL:CVERT,*EL,*DV,FMGPCODE
.
          ENDSET    FMGPCODE
          APPEND    SP70,FMGPCODE
          RESET     FMGPCODE
          MATCH     SP70,FMGPCODE             * System Code Spaces so exit set
          GOTO      KGRPFM90 IF EQUAL
.
          CMATCH    EXITCHAR,FMGPCODE         * Exit Selected
          GOTO      KGRPFM95 IF EQUAL
.
          CMATCH    QUEST,FMGPCODE            * Help Required  
          GOTO      KGRPFM10 IF NOT EQUAL
          CALL      HFMGPA00                  * Display List Of FMGPCODEs
          PACK      CDATASAV,FMGPCODE,SP70    * save data
          CALL      RGRPFM00                  * Redisplay Routine
          PACK      FMGPCODE,CDATASAV,SP70    * restore data
.
          ENDSET    FMGPCODE
          APPEND    SP70,FMGPCODE
          RESET     FMGPCODE
          MATCH     SP70,FMGPCODE             * System Code Spaces so exit set
          GOTO      KGRPFM00 IF EQUAL
.
KGRPFM10  PACK      KEY3,FMGPCODE
          CALL      RDFMGP1                                   
          BRANCH    OVRCD,KGRPFM80
          MOVE      ZERO,EXIT                 * no entry so exit is set
          GOTO      KGRPFM99
.
KGRPFM80  DISPLAY   *P1:24,*EL,*B,"Alloc. Group Does Not Exist - ";
          CALL      HITENTER
          GOTO      KGRPFM00
.
KGRPFM90  MOVE      ONE,EXIT                  * null entry so exit is set
          GOTO      KGRPFM99
.
KGRPFM95  MOVE      TWO,EXIT                  * Exit character entered    
.
KGRPFM99  RETURN
.-------------------------------------------------------------------------------
. Accept Code Keyin - Code Must Not Exist 
.-------------------------------------------------------------------------------
AGRPFM00  MOVE      UNDLN70,FMGPCODE
          KEYIN     *PCCOL:CVERT,*EL,*DV,FMGPCODE:
                    *PCCOL:CVERT,*V2LON,FMGPCODE: 
                    *PCCOL:CVERT,*EL,*DV,FMGPCODE
.
          ENDSET    FMGPCODE
          APPEND    SP70,FMGPCODE
          RESET     FMGPCODE
          MATCH     SP70,FMGPCODE             * System Code Spaces so exit set
          GOTO      AGRPFM90 IF EQUAL
.
          CMATCH    EXITCHAR,FMGPCODE         * Exit Selected
          GOTO      AGRPFM95 IF EQUAL
.
          CMATCH    QUEST,FMGPCODE            * Help Required  
          GOTO      AGRPFM10 IF NOT EQUAL
          CALL      HFMGPA00                  * Display List Of FMGPCODEs
          PACK      CDATASAV,FMGPCODE,SP70    * save data
          CALL      RGRPFM00                  * Redisplay Routine
          PACK      FMGPCODE,CDATASAV,SP70    * restore data
.
          ENDSET    FMGPCODE
          APPEND    SP70,FMGPCODE
          RESET     FMGPCODE
          MATCH     SP70,FMGPCODE             * System Code Spaces so exit set
          GOTO      AGRPFM00 IF EQUAL
.
AGRPFM10  PACK      KEY3,FMGPCODE
          MOVE      ZERO,EXIT                 * no entry so exit is set
          CALL      RDFMGP1                                   
          BRANCH    OVRCD,AGRPFM99
.
          DISPLAY   *P1:24,*EL,*B,"Alloc. Group Already Exists - ";
          CALL      HITENTER
          GOTO      AGRPFM00
.
AGRPFM90  MOVE      ONE,EXIT                  * null entry so exit is set
          GOTO      AGRPFM99
.
AGRPFM95  MOVE      TWO,EXIT                  * Exit character entered    
.
AGRPFM99  RETURN
.------------------------------------------------------------------------------
. Display List of All Codes
.------------------------------------------------------------------------------
HFMGPA00
          MOVE      ZERO,CSCRSIZ
          IF        HTOP<3
            MOVE      "12",HTOP
            MOVE      "24",HBOT
            MOVE      "40",HLEF
            MOVE      "80",HRIG
          ENDIF
HFMGPA04
          CALL      GSCRN000
          BRANCH    EXIT,HFMGPA99
          MOVE      STDCOL00,STDCOL01
          ADD       " 5",STDCOL01
          DISPLAY   *PSTDCOL01:STDROW,*V2LON,*ULON,"Group"             
.
          MOVE      STDCOL01,STDCOL02
          ADD       " 7",STDCOL02
          DISPLAY   *PSTDCOL02:STDROW,*V2LON,*ULON,"Description"        
.
          MOVE      STDCOL02,STDCOL03
          ADD       "36",STDCOL03
HFMGPA08
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          MOVE      SP70,FMGPCODE
          PACK      KEY3,FMGPCODE,SP70                                          
.                                                                               
.                                                                               
          CALL      RSFMGP1 
HFMGPA10
          CALL      RKFMGP1 
          BRANCH    OVRCD,HFMGPA15
          PACK      KEY3,FMGPCODE,SP70                                          
.                                                                               
.                                                                               
          BRANCH    CSEARCH,HFMGPA12
          CALL      HFMGPA60
          BRANCH    OVRCD,HFMGPA10
HFMGPA12
          ADD       ONE,XITEMNO
          ADD       ONE,STDROW
          STORE     KEY3,XITEMNO,ST1,ST2,ST3,ST4,ST5:
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          DISPLAY   *PSTDCOL00:STDROW,SP1,*V2LON,XITEMNO,DOT
          DISPLAY   *PSTDCOL01:STDROW,FMGPCODE
          DISPLAY   *PSTDCOL02:STDROW,FMGPDESC
          COMPARE   MAXITEM,XITEMNO
          GOTO      HFMGPA10 IF NOT EQUAL
HFMGPA15
.                                                                               
          MOVE      ONE,DITEM
          MOVE      MINITEM,DROW
          ADD       ONE,DROW
          DISPLAY   *PSTDCOL00:DROW,*V2LON,*HON,SP1,DITEM,DOT
          CLIP
          FLUSH     HLEF,HTOP,HRIG,HBOT
.
HFMGPA20
          CALL      HSCRI000
          BRANCH    EXIT,HFMGPA30,HFMGPA35,HFMGPA40,HFMGPA45,HFMGPA04:
                              HFMGPA91,HFMGPA50
          GOTO      HFMGPA92
HFMGPA30
          CALL      RKFMGP1 
          BRANCH    OVRCD,HFMGPA85
          PACK      KEY3,FMGPCODE,SP70                                          
.                                                                               
.                                                                               
          CALL      RPFMGP1 
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMGPA10
HFMGPA35
          MOVE      ST1,KEY3 
          CALL      RDFMGP1 
          CALL      RPFMGP1 
          BRANCH    OVRCD,HFMGPA85
          PACK      KEY3,FMGPCODE,SP70                                          
.                                                                               
.                                                                               
.                                                                               
.                                                                               
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
HFMGPA36
          CALL      RPFMGP1 
          BRANCH    OVRCD,HFMGPA37
          PACK      KEY3,FMGPCODE,SP70                                          
.                                                                               
.                                                                               
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HFMGPA36 IF NOT EQUAL
HFMGPA37
          MOVE      ZERO,XITEMNO
          GOTO      HFMGPA10
HFMGPA40
          MOVE      ST1,KEY3 
          CALL      RDFMGP1 
          CALL      RPFMGP1 
          BRANCH    OVRCD,HFMGPA85
          PACK      KEY3,FMGPCODE,SP70                                          
.                                                                               
.                                                                               
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMGPA08
HFMGPA45
          CALL      RKFMGP1 
          BRANCH    OVRCD,HFMGPA85
          PACK      KEY3,FMGPCODE,SP70                                          
.                                                                               
.                                                                               
          SUSPEND
          CLIP      1,1,CRIG,24
.
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      ZERO,XITEMNO
          PACK      KEY3,Z70                                                    
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
          CALL      RSFMGP1 
HFMGPA46
          CALL      RPFMGP1 
          BRANCH    OVRCD,HFMGPA47
          PACK      KEY3,FMGPCODE,SP70                                          
.                                                                               
.                                                                               
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HFMGPA46 IF NOT EQUAL
HFMGPA47
          MOVE      ZERO,XITEMNO
          GOTO      HFMGPA10
HFMGPA50  COMPARE   ZERO,CSEARCH
          GOTO      HFMGPA55 IF EQUAL
          MOVE      ZERO,CSEARCH
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          ADD       ONE,STDROW
          UNPACK    SP70,SCHFLD01,SCHFLD02,SCHFLD03,SCHFLD04,SCHFLD05
          UNPACK    SP70,SCHFLD06,SCHFLD07,SCHFLD08,SCHFLD09,SCHFLD10
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          DISPLAY   *PSTDCOL00:STDROW,*V2LON,*HON,"Sch"
          KEYIN     *PSTDCOL01:STDROW,*V2LON,SCHFLD01
          RESET     SCHFLD01
          KEYIN     *PSTDCOL02:STDROW,*V2LON,SCHFLD02
          RESET     SCHFLD02
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMGPA08
HFMGPA55  MOVE      ONE,CSEARCH
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMGPA08
HFMGPA60  MOVE      ZERO,OVRCD
          MATCH     SP70,SCHFLD01
          GOTO      HFMGPA61 IF EQUAL
          MATCH     SCHFLD01,FMGPCODE
          GOTO      HFMGPA72 IF NOT EQUAL
HFMGPA61
          MATCH     SP70,SCHFLD02
          GOTO      HFMGPA62 IF EQUAL
          MATCH     SCHFLD02,FMGPDESC
          GOTO      HFMGPA72 IF NOT EQUAL
HFMGPA62
HFMGPA63
HFMGPA64
HFMGPA65
HFMGPA66
HFMGPA67
HFMGPA68
HFMGPA69
HFMGPA70
          GOTO      HFMGPA75
HFMGPA72  MOVE      ONE,OVRCD
HFMGPA75  RETURN
HFMGPA85
          LOAD      KEY3,XITEMNO,ST1,ST2,ST3,ST4,ST5:
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY3,FMGPCODE                                               
          CALL      RDFMGP1 
HFMGPA90
.                                                                               
          BEEP
          GOTO      HFMGPA20
HFMGPA91
          MOVE      SP70,FMGPDESC
          MOVE      SP70,FMGPSPAR
          MOVE      SP70,KEY3 
          MOVE      SP70,FMGPCODE
          GOTO      HFMGPA96
HFMGPA92
          MOVE      SP70,KEY3 
          MOVE      SP70,FMGPCODE
          LOAD      KEY3,CCITEM,ST1,ST2,ST3,ST4,ST5:                            
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY3,FMGPCODE                                               
HFMGPA96
          PUTSCR    CSSCRNUM,HLEF,HTOP,HRIG,HBOT
          CALL      FRESCR00
          MOVE      ZERO,HTOP
          MOVE      ZERO,HLEF
          MOVE      ZERO,HBOT
          MOVE      ZERO,HRIG
HFMGPA99
          RETURN
.

.***************************************************************************
.* System    :   CIAS                                                      *
.* Program   :   IBACCC55                                                  *
.* Desc      :   CIAS extract generation                                   *
.***************************************************************************
.* Date      :   19/01/2004                                                *
.* Author    :   Ebon Clements                                             *
.* Function  :   This program contains the standard CIAS extract           *
.*               generation processes                                      *
.***************************************************************************
.* Mods      :                                                             *
.*              V11.00.01 04/03/2020  J.Tan                TSK 0838262     *
.*                        Added Effective from and to date to MBS Item file*
.*               V10.00.01 03/06/2010  Ebon Clements       CAR 217427      *
.*                        Recompiled for CCSG58CD                          *
.*               V9.12.01 13/08/2009 Ebon Clements         CAR 198266      *
.*                        Recompiled for CCSG58CD                          *
.*               V9.03.01 04/03/2004 Ebon Clements         CAR 46515       *
.*                        Created Allied health visit type                 *
.*               V9.03.00 19/01/2004 Ebon Clements         CAR 45487       *
.*                        Created program from IBACEA55                    *
.***************************************************************************
.
          INC       STD001FD
.
. FILE DESCRIPTION INCLUDES
. -------------------------
          INC       CCSCEAFD/INC
          INC       CCSAGEFD/INC
          INC       CCSCEXFD/INC
          INC       CCSDRGFD/INC
          INC       CCSEPSFD/INC
          INC       CCSEWTFD/INC
          INC       CCSEYAFD/INC
          INC       CCSHCDFD/INC
          INC       CCSIADFD/INC
          INC       CCSSTYFD/INC
          INC       CCSXHDFD/INC
          INC       CEAPPMFD/INC
          INC       CEAPMDFD/INC
          INC       PATITMFD/INC
          INC       CCSCONFD/INC
          INC       CCSCEDFD/INC
          INC       CCSCEBFD/INC
          INC       CCSCECFD/INC
          INC       CCSCEEFD/INC
          INC       CCSCEFFD/INC
          INC       CCSCEGFD/INC
.
. LOCAL VARIABLE DEFINITION
. -------------------------
BEDCALC   FORM      1
ITHEDESC  DIM      10 
CTHEDESC  DIM      10 
COMMAND   DIM       80
EXTRSUMM  FORM      1
AGERANGE  DIM       3 
SOPP01    DIM       9
THEBAND   DIM       10
SDIA01    DIM       9
PDIA01    DIM       9
CASPAYTP  DIM       1 
POPP01    DIM       9
FILENAME  DIM       8
FROMDD    DIM      10 
TODD      DIM      10 
FROMAD    DIM      10 
TOAD      DIM      10 
VISITDES  DIM      15 
CLV1DES   DIM      35 
CLV2DES   DIM      35 
CLV3DES   DIM      35 
DAYCDESC  DIM      25 
CSTMDES   DIM      35 
INCMDES   DIM      35 
INCICU   FORM      6.2
INCINCI  FORM      1
INCUTH   FORM      1
INCB01   FORM      6.2
INCB02   FORM      6.2
INCB03   FORM      6.2
INCB04   FORM      6.2
INCB05   FORM      6.2
INCB06   FORM      6.2
INCB07   FORM      6.2
INCB08   FORM      6.2
INCB09   FORM      6.2
INCB10   FORM      6.2
INCB11   FORM      6.2
INCB12   FORM      6.2
INCB13   FORM      6.2
INCB14   FORM      6.2
INCB15   FORM      6.2
CSTICU   FORM      6.2
CSTINCI  FORM      1
CSTUTH   FORM      1
CSTB01   FORM      6.2
CSTB02   FORM      6.2
CSTB03   FORM      6.2
CSTB04   FORM      6.2
CSTB05   FORM      6.2
CSTB06   FORM      6.2
CSTB07   FORM      6.2
CSTB08   FORM      6.2
CSTB09   FORM      6.2
CSTB10   FORM      6.2
CSTB11   FORM      6.2
CSTB12   FORM      6.2
CSTB13   FORM      6.2
CSTB14   FORM      6.2
CSTB15   FORM      6.2
TOTALEPS  FORM      6
TOTALEXT  FORM      6
EXRANGE   FORM      1 
EXTRBRAN  FORM      3 
EXSTR     DIM      10 
EXEND     DIM      10 
F12P4     FORM      12.4
SGENISB   INIT      "isbuild "
STDGISE   INIT      "iserase "
PATMBSOP  FORM      1
EXCOMPS   FORM      1
.
PRGID     INIT      "IBACCC55"
PRGNAM    INIT      "Extract Generation                      "
VERSION   INIT      "V12.00.00"
+
.**************************************************************************
.*                              ML0000                                    *
.*                      Controlling Logic (Mainline code)                 *
.**************************************************************************
.
ML0000    CALL      INIT0000               * initialisation and open files
.
ML0100    CALL      OPTN0000               * select options
          BRANCH    EXIT,ML9999            * EXIT = 1 if 0 chosen in menu
          BRANCH    COPTION,ML1000
.
ML1000    CALL      EXTG0000               * Generate Casemix Extract          
          BRANCH    EXIT,ML0100
          GOTO      ML9999
.
ML9999    CHAIN     PGM                    * chain back to program
+
.****************************************************************************
.*                                INIT0000             Called by: ML0000    *
.*                             initialisation                               *
.*  The initialisation routine is used to display headings and open files.  *
.****************************************************************************
.
INIT0000  CALL      DISPHEAD                  * display heading
.
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
.
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
.
          DISPLAY   *P56:24,"Opening ccsageaf";
          OPEN      CCSAGEA1,"ccsageaf"
          DISPLAY   *P56:24,"Opening ccsageaf";
          OPEN      CCSAGEA2,"ccsageaf"
.
          MOVE      "   64",AUDTSECT
          MOVE      " 38",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening ccsaudia";
            OPEN      CCSAUDIA,"ccsaudia"
          ENDIF
          DISPLAY   *P56:24,"Opening ccsceaaf";
          OPEN      CCSCEAA1,"ccsceaaf"
          DISPLAY   *P56:24,"Opening ccscexaf";
          OPEN      CCSCEXA1,"ccscexaf"
          DISPLAY   *P56:24,"Opening ccsdrgaf";
          OPEN      CCSDRGA1,"ccsdrgaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA1,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA2,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA3,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA4,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA5,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccsewtaf";
          OPEN      CCSEWTA1,"ccsewtaf"
          DISPLAY   *P56:24,"Opening ccseyaaf";
          OPEN      CCSEYAA1,"ccseyaaf"
          DISPLAY   *P56:24,"Opening ccshcdaf";
          OPEN      CCSHCDA1,"ccshcdaf"
          DISPLAY   *P56:24,"Opening ccshcdaf";
          OPEN      CCSHCDA2,"ccshcdaf"
          DISPLAY   *P56:24,"Opening ccsiadaf";
          OPEN      CCSIADA1,"ccsiadaf"
          DISPLAY   *P56:24,"Opening ccsstyaf";
          OPEN      CCSSTYA1,"ccsstyaf"
          DISPLAY   *P56:24,"Opening ccsxhdaf";
          OPEN      CCSXHDA1,"ccsxhdaf"
          DISPLAY   *P56:24,"Opening ccsxhdaf";
          OPEN      CCSXHDA2,"ccsxhdaf"
          DISPLAY   *P56:24,"Opening ceapmdaf";
          OPEN      CEAPMDA1,"ceapmdaf"
          DISPLAY   *P56:24,"Opening ceappmaf";
          OPEN      CEAPPMA1,"ceappmaf"
          DISPLAY   *P56:24,"Opening  patitemn           ";
          OPEN      PATITEM1,"patitemn"
.
INIT9999  RETURN
+
.****************************************************************************
.*                                OPTN0000             Called by: ML0000    *
.*                        get user options or exit                          *
.*                                                                          *
.*    Returns:  EXIT    = FALSE (0)  Run clean up                           *
.*                        TRUE  (1)  Exit option selected                   *
.****************************************************************************
.
OPTN0000  DISPLAY   *P1:3,*EF,*P1:4,*V2LON,ZERO,*HOFF,". Exit":
                    *P1:5,*V2LON,ONE,*HOFF,". Generate Casemix Extract"
.
OPTN0500  KEYIN     *P1:16,*EL,"Select Option : ",*DV,UNDLN1:
                    *P17:16,*V2LON,COPTION
.
          COMPARE   ZERO,COPTION                 * exit selected ?
          GOTO      OPTN9500 IF EQUAL            * yes
.
          BRANCH    COPTION,OPTN9000
.
          BEEP
          GOTO      OPTN0500
.
OPTN9000  MOVE      ZERO,EXIT
          GOTO      OPTN9999
.
OPTN9500  MOVE      ONE,EXIT
.
OPTN9999  RETURN
.
+
.**************************************************************************
.*                               EXTG0000              Called by: ML1000  *
.* Generate Casemix Extract                                               *
.**************************************************************************
.
EXTG0000  CALL      KEXT0000                     * Keyin extract ID
          BRANCH    EXIT,EXTG9999
.
          CALL      CONTQST                      * ok to continue
          BRANCH    CEXIT,EXTG5000,EXTG9999,EXTG9999    * 1=Yes, 2=No, 3=Cancel
.
EXTG5000  CALL      POST0000                    * Generate Extract
.
EXTG9999  RETURN
.
.------------------------------------------------------------
. Keyin extract ID                           
.------------------------------------------------------------
KEXT0000  DISPLAY   *P1:4,*EF
          KEYIN     *P1:4,"Extract ID : ",*V2LON,CCEAEID
          ENDSET    CCEAEID
          APPEND    SP70,CCEAEID
          RESET     CCEAEID
.
          MATCH     SP70,CCEAEID
          GOTO      KEXT9000 IF EQUAL
.
          PACK      KEY4,CCEAEID,SP70
          CALL      RDCCEA1
          IF        OVRCD=1
            BEEP
            DISPLAY  *P1:24,"Invalid Extract ID";
            CALL      HITENTER
            GOTO      KEXT0000
          ENDIF
.
          DISPLAY   *P19:4,*V2LON,CCEADES
          MOVE      ZERO,EXIT
          GOTO      KEXT9999
.
KEXT9000  MOVE      ONE,EXIT
          GOTO      KEXT9999
.
KEXT9999  RETURN
.
.======================================================================
. Determine Display Values for a Valid Casemix Extract Code
.======================================================================
GETCME00  MOVE      SP70,ITHEDESC
          MOVE      SP70,CTHEDESC
          MATCH     SP70,CCEAITHE
          IF        !@EQUAL
            MOVE      CCEAITHE,F1
            LOAD      ITHEDESC,F1,CCCOTH1,CCCOTH2,CCCOTH3,CCCOTH4
          ENDIF
.
          MATCH     SP70,CCEACTHE
          IF        !@EQUAL
            MOVE      CCEACTHE,F1
            LOAD      CTHEDESC,F1,CCCOTH1,CCCOTH2,CCCOTH3,CCCOTH4
          ENDIF
.
          MATCH     SP70,CCEAFDD
          IF        @EQUAL
            MOVE      "Start     ",FROMDD
          ELSE
            UNPACK    CCEAFDD,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
            MOVE      CPCDATE,FROMDD
          ENDIF
.
          MATCH     "99999999",CCEATDD
          IF        @EQUAL
            MOVE      "Finish    ",TODD
          ELSE
            UNPACK    CCEATDD,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
            MOVE      CPCDATE,TODD
          ENDIF
.
          MATCH     SP70,CCEAFAD
          IF        @EQUAL
            MOVE      "Start     ",FROMAD
          ELSE
            UNPACK    CCEAFAD,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
            MOVE      CPCDATE,FROMAD
          ENDIF
.
          MATCH     "99999999",CCEATAD
          IF        @EQUAL
            MOVE      "Finish    ",TOAD
          ELSE
            UNPACK    CCEATAD,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
            MOVE      CPCDATE,TOAD
          ENDIF
.
          MOVE     CCEAVIS,F1
          BRANCH   F1,GETCME10,GETCME20,GETCME30,GETCME35
          MOVE     "All        ",VISITDES
          GOTO     GETCME40
GETCME10  MOVE     "EMR        ",VISITDES
          GOTO     GETCME40
GETCME20  MOVE     "Outpatients ",VISITDES
          GOTO     GETCME40
GETCME30  MOVE     "Inpatients",VISITDES
          GOTO     GETCME40
GETCME35  MOVE     "Allied Health",VISITDES
          GOTO     GETCME40
.
.
GETCME40
          MOVE     SP70,CLV1DES
          MOVE     SP70,CLV2DES
          MOVE     SP70,CLV3DES
          MOVE     CCEALV1,KEY3
          CALL     RDCCST1
          IF       OVRCD=0
            MOVE     CCSTDES,CLV1DES
          ENDIF
.
          MOVE     CCEALV2,KEY3
          CALL     RDCCST1
          IF       OVRCD=0
            MOVE     CCSTDES,CLV2DES
          ENDIF
.
          MOVE     CCEALV3,KEY3
          CALL     RDCCST1
          IF       OVRCD=0
            MOVE     CCSTDES,CLV3DES
          ENDIF
.
          MATCH    "0",CCEAUST
          IF       !@EQUAL
            MOVE     ONE,CCEAUST
          ENDIF
.
          MOVE       CCEADAY,F1
          IF         F1=0
            MOVE       "Exclude Day Cases",DAYCDESC
          ELSE
            IF         F1=2
              MOVE       "Day Cases Only",DAYCDESC
            ELSE
              MOVE       "Include Day Cases",DAYCDESC
            ENDIF
          ENDIF
.
          MOVE       SP70,CSTMDES
          MOVE       SP70,INCMDES
          MOVE       CCEAIMOD,KEY1
          CALL       RDCEPP1
          IF         OVRCD=0
            MOVE       CEPPDES,INCMDES
          ENDIF
          MOVE       CCEACMOD,KEY1
          CALL       RDCEPP1
          IF         OVRCD=0
            MOVE       CEPPDES,CSTMDES
          ENDIF
.
          RETURN
.
GETMOD00  MATCH    SP70,CCEAIMOD
          GOTO     GETMOD50 IF EQUAL
          MOVE     CCEAIMOD,KEY1
          CALL     RDCEPP1
          BRANCH   OVRCD,GETMOD50
          MOVE     CEPPICU,INCICU
          MOVE     CEPPINCI,INCINCI
          MOVE     CEPPUTH,INCUTH
          MOVE     CEPPB01,INCB01
          MOVE     CEPPB02,INCB02
          MOVE     CEPPB03,INCB03
          MOVE     CEPPB04,INCB04
          MOVE     CEPPB05,INCB05
          MOVE     CEPPB06,INCB06
          MOVE     CEPPB07,INCB07
          MOVE     CEPPB08,INCB08
          MOVE     CEPPB09,INCB09
          MOVE     CEPPB10,INCB10
          MOVE     CEPPB11,INCB11
          MOVE     CEPPB12,INCB12
          MOVE     CEPPB13,INCB13
          MOVE     CEPPB14,INCB14
          MOVE     CEPPB15,INCB15
.
          GOTO     GETMOD99
.
GETMOD50  MATCH    SP70,CCEACMOD
          GOTO     GETMOD99 IF EQUAL
          MOVE     CCEACMOD,KEY1
          CALL     RDCEPP1
          BRANCH   OVRCD,GETMOD99
          MOVE     CEPPICU,CSTICU
          MOVE     CEPPINCI,CSTINCI
          MOVE     CEPPUTH,CSTUTH
          MOVE     CEPPB01,CSTB01
          MOVE     CEPPB02,CSTB02
          MOVE     CEPPB03,CSTB03
          MOVE     CEPPB04,CSTB04
          MOVE     CEPPB05,CSTB05
          MOVE     CEPPB06,CSTB06
          MOVE     CEPPB07,CSTB07
          MOVE     CEPPB08,CSTB08
          MOVE     CEPPB09,CSTB09
          MOVE     CEPPB10,CSTB10
          MOVE     CEPPB11,CSTB11
          MOVE     CEPPB12,CSTB12
          MOVE     CEPPB13,CSTB13
          MOVE     CEPPB14,CSTB14
          MOVE     CEPPB15,CSTB15
.
GETMOD99  RETURN
.
.---------------------------------------------------------------------------
. Post Casemix Extract Details and Perform Extract
.---------------------------------------------------------------------------
POST0000  CALL     GETCME00
          CALL     GETMOD00
.
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     PATITEM1,"patitemn"                                 * V90200
          TRAPCLR  IO
          MOVE     OVRCD,PATMBSOP
.
          PACK     KEY4,CCEAEID
          CALL     RDCCEX1             * Read Record
          MOVE     OVRCD,EXRANGE       * 1 = no more ranges
.
          PACK     KEY4,CCEAEID
          CALL     RDCCEY1             * Read Record
          MOVE     OVRCD,EXCOMPS       * 1 = No Components Specified
.
          MOVE     ZERO,BEDCALC
          IF       EXCOMPS=0
            IF       (CCEYBA1+CCEYBA2+CCEYBA3+CCEYBAO=4)
              MOVE     ZERO,BEDCALC    * No LOS Calc Required
            ELSE
              MOVE     ONE,BEDCALC     * LOS Calculation Required
            ENDIF
          ENDIF
.
. Create and Open Files
.---------------------------------------------------------------------------
          CALL     CREAT000            * Create Files
          BRANCH   EXIT,POST9500
.
. Extract Episodes to the ccec file
.---------------------------------------------------------------------------
          CALL     EXTR0000            * Create Extract
.
. Calculate Statistical Variances
.---------------------------------------------------------------------------
          MATCH    "0",CCEAUST
          GOTO     POST9000 IF EQUAL   * Update Stats Y or N 0=N
.
          CALL     STAT0000
.
POST9000  PACK      KEY4,CCEAEID,SP70
          CALL      RDCCEA1
          BRANCH    OVRCD,POST9999
.
          MOVE      ZERO,CCEASTAT      * Process Complete
          CALL      UPCCEA1
.
          GOTO      POST9999
.
POST9500  PACK      KEY4,CCEAEID,SP70
          CALL      RDCCEA1
          BRANCH    OVRCD,POST9999
.
          MOVE      TWO,CCEASTAT      * Process Error
          CALL      UPCCEA1
.
          GOTO      POST9999
.
POST9999  RETURN
.
.---------------------------------------------------------------------------
. Create and Open Files
.---------------------------------------------------------------------------
CREAT000  DISPLAY  *P1:24,*EL,"Creating Extract Files : "
          MOVE     "cceb",KEY4
          PACK     FILENAME,KEY4,CCEAEID
          DISPLAY  *P26:24,*EL,FILENAME
          REP      " 0",FILENAME
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCEBA1,FILENAME
          TRAPCLR  IO
          IF       OVRCD=0
            CLOSE    CCSCEBA1,DELETE
          ENDIF
          PACK     COMMAND,SGENISB,FILENAME,CCEBIDX
          EXECUTE  COMMAND,TASKID
.
          MATCH    "1",TASKID               * File could not be built as it must
          GOTO     CREAT900 IF EQUAL        * not have been deleted
.
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCEBA1,FILENAME
          TRAPCLR  IO
          IF       OVRCD=1
            BEEP
            MOVE     "Unable to Create Casemix Extract Files - ",DISPMSG
            CALL     MESSAGE1
            GOTO     CREAT900
          ENDIF
.
          MOVE     "ccec",KEY4
          PACK     FILENAME,KEY4,CCEAEID
          DISPLAY  *P26:24,*EL,FILENAME
          REP      " 0",FILENAME
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCECA1,FILENAME
          TRAPCLR  IO
          IF       OVRCD=0
            CLOSE    CCSCECA2
            CLOSE    CCSCECA1,DELETE
          ENDIF
          PACK     COMMAND,SGENISB,FILENAME,CCECIDX
          EXECUTE  COMMAND,TASKID
.
          MATCH    "1",TASKID               * File could not be built as it must
          GOTO     CREAT900 IF EQUAL        * not have been deleted
.
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCECA1,FILENAME
          TRAPCLR  IO
          IF       OVRCD=1
            BEEP
            MOVE     "Unable to Create Casemix Extract Files - ",DISPMSG
            CALL     MESSAGE1
            GOTO     CREAT900
          ENDIF
          OPEN     CCSCECA2,FILENAME
.
          MOVE     "cced",KEY4
          PACK     FILENAME,KEY4,CCEAEID
          DISPLAY  *P26:24,*EL,FILENAME
          REP      " 0",FILENAME
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCEDA1,FILENAME
          TRAPCLR  IO
          IF       OVRCD=0
            CLOSE    CCSCEDA1,DELETE
          ENDIF
          PACK     COMMAND,SGENISB,FILENAME,CCEDIDX
          EXECUTE  COMMAND,TASKID
.
          MATCH    "1",TASKID               * File could not be built as it must
          GOTO     CREAT900 IF EQUAL        * not have been deleted
.
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCEDA1,FILENAME
          TRAPCLR  IO
          IF       OVRCD=1
            BEEP
            MOVE     "Unable to Create Casemix Extract Files - ",DISPMSG
            CALL     MESSAGE1
            GOTO     CREAT900
          ENDIF
.
          MOVE     "ccee",KEY4
          PACK     FILENAME,KEY4,CCEAEID
          DISPLAY  *P26:24,*EL,FILENAME
          REP      " 0",FILENAME
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCEEA1,FILENAME
          TRAPCLR  IO
          IF       OVRCD=0
            CLOSE    CCSCEEA1,DELETE
          ENDIF
          PACK     COMMAND,SGENISB,FILENAME,CCEEIDX
          EXECUTE  COMMAND,TASKID
.
          MATCH    "1",TASKID               * File could not be built as it must
          GOTO     CREAT900 IF EQUAL        * not have been deleted
.
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCEEA1,FILENAME
          TRAPCLR  IO
          IF       OVRCD=1
            BEEP
            MOVE     "Unable to Create Casemix Extract Files - ",DISPMSG
            CALL     MESSAGE1
            GOTO     CREAT900
          ENDIF
.
          MOVE     "ccef",KEY4
          PACK     FILENAME,KEY4,CCEAEID
          DISPLAY  *P26:24,*EL,FILENAME
          REP      " 0",FILENAME
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCEFA1,FILENAME
          TRAPCLR  IO
          IF       OVRCD=0
            CLOSE    CCSCEFA2
            CLOSE    CCSCEFA1,DELETE
          ENDIF
          PACK     COMMAND,SGENISB,FILENAME,CCEFIDX
          EXECUTE  COMMAND,TASKID
.
          MATCH    "1",TASKID               * File could not be built as it must
          GOTO     CREAT900 IF EQUAL        * not have been deleted
.
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCEFA1,FILENAME
          TRAPCLR  IO
          IF       OVRCD=1
            BEEP
            MOVE     "Unable to Create Casemix Extract Files - ",DISPMSG
            CALL     MESSAGE1
            GOTO     CREAT900
          ENDIF
.
          MOVE     "cceg",KEY4
          PACK     FILENAME,KEY4,CCEAEID
          DISPLAY  *P26:24,*EL,FILENAME
          REP      " 0",FILENAME
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCEGA1,FILENAME
          TRAPCLR  IO
          IF       OVRCD=0
            CLOSE    CCSCEGA2
            CLOSE    CCSCEGA1,DELETE
          ENDIF
          PACK     COMMAND,SGENISB,FILENAME,CCEGIDX
          EXECUTE  COMMAND,TASKID
.
          MATCH    "1",TASKID               * File could not be built as it must
          GOTO     CREAT900 IF EQUAL        * not have been deleted
.
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCEGA1,FILENAME
          TRAPCLR  IO
          IF       OVRCD=1
            BEEP
            MOVE     "Unable to Create Casemix Extract Files - ",DISPMSG
            CALL     MESSAGE1
            GOTO     CREAT900
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      CREAT999
.
CREAT900  MOVE      ONE,EXIT
.
CREAT999  RETURN
.
.======================================================================
. Extract Casemix Analysis
.======================================================================
EXTR0000  PACK      KEY18,SP70
          DISPLAY   *P1:24,*EL,"Scanning Episodes : "
          MOVE      ZERO,TOTALEPS
          MOVE      ZERO,TOTALEXT
          PACK      KEY26,CCEAFDD,SP70
          CALL      RSCCEP4
EXTR1000  CALL      RKCCEP4
          BRANCH    OVRCD,EXTR9000
          MATCH     CCEPDDAT,CCEATDD
          GOTO      EXTR9000 IF LESS
.
          ADD       ONE,TOTALEPS
          IF        (TOTALEPS%500=0)
            DISPLAY   *P21:24,*V2LON,TOTALEPS
          ENDIF
.
          CALL      RANGE000     * Check Range Options
          BRANCH    EXIT,EXTR1000
.
          MOVE      SP70,CCECLV1
          MOVE      SP70,CCECLV2
          MOVE      SP70,CCECLV3
          MOVE      CCEALV1,EXTRBRAN
          CALL      GETCD000     * Get Extract Code Level 1
          MOVE      KEY10,CCECLV1
          MATCH     SP70,CCECLV1
          IF        @EQUAL
            MOVE      Z70,CCECLV1
          ENDIF
.
          MATCH     SP70,CCEALV2
          IF        !@EQUAL
            MOVE      CCEALV2,EXTRBRAN
            CALL      GETCD000     * Get Extract Code Level 2
            MOVE      KEY10,CCECLV2
            MATCH     SP70,CCECLV2
            IF        @EQUAL
              MOVE      Z70,CCECLV2
            ENDIF
          ENDIF
.
          MATCH     SP70,CCEALV3
          IF        !@EQUAL
            MOVE      CCEALV3,EXTRBRAN
            CALL      GETCD000     * Get Extract Code Level 3
            MOVE      KEY10,CCECLV3
            MATCH     SP70,CCECLV3
            IF        @EQUAL
              MOVE      Z70,CCECLV3
            ENDIF
          ENDIF
.
          MOVE      CCEPHCD,CCECHCD
          MOVE      CCEPEPS,CCECEPS
          MOVE      CCEPEXC,CCECEXC
          PACK      KEY18,CCECHCD,CCECEPS
          CALL      RDCCIA1            * Income Analysis File
          IF        OVRCD=0
            CALL      CALEPS00
          ELSE
            MOVE      ZERO,CCECFTC
            MOVE      ZERO,CCECTTC
          ENDIF
.
          MOVE      CCEPLOS,CCECLOS
          IF        BEDCALC=1
            MOVE      ZERO,CCECLOS
            ASSIGN    ((CCEPLOS-CCIABA1-CCIABA2-CCIABA3)*CCEYBAO),CCECLOS
            ASSIGN    CCECLOS+(CCIABA1*CCEYBA1),CCECLOS
            ASSIGN    CCECLOS+(CCIABA2*CCEYBA2),CCECLOS
            ASSIGN    CCECLOS+(CCIABA3*CCEYBA3),CCECLOS
          ENDIF
.
          PACK      KEY18,CCECHCD,CCECEPS
          CALL      RACCEC1
          IF        OVRCD=0
            CALL      UPCCEC1
          ELSE
            CALL      WRCCEC1
          ENDIF
          CALL      UPLEV000
          GOTO      EXTR1000
.
EXTR9000  RETURN
.
.-------------------------------------------
. Check for Range Option - EXIT 0=In Range
.-------------------------------------------
RANGE000  MATCH     CCEAHCD,CCEPHCD
          GOTO      RANGE900 IF NOT EQUAL
.
          MATCH     SP70,CCEPADAT   * Admission Date Range
          GOTO      RANGE010 IF EQUAL
.
          MATCH     CCEAFAD,CCEPADAT   * Admission Date Range
          GOTO      RANGE900 IF LESS
          MATCH     CCEPADAT,CCEATAD
          GOTO      RANGE900 IF LESS
.
RANGE010  MATCH     "0",CCEAVIS       * Include Visits 0=All
          IF        !(@EQUAL)
            MATCH     "4",CCEAVIS
            IF        @EQUAL
              MATCH     "10",CCEPVIST
              GOTO      RANGE900 IF NOT EQUAL
            ELSE
              MOVE      CCEAVIS,F2
              MOVE      F2,DIM2
              MATCH     CCEPVIST,DIM2
              GOTO      RANGE900 IF NOT EQUAL
            ENDIF
          ENDIF
.
          MATCH     "0",CCEADAY       * Day Cases 0=Exclude
          IF        @EQUAL
            MATCH     "1",CCEPDAY      * Day Case 0=NO
            GOTO      RANGE900 IF EQUAL
          ENDIF
          MATCH     "2",CCEADAY       * Day Cases 2=Only
          IF        @EQUAL
            MATCH     "1",CCEPDAY      * Day Case 0=NO
            GOTO      RANGE900 IF NOT EQUAL
          ENDIF
.
          MATCH     "0",CCEAINC       * Include Incompleted 0=No
          IF        @EQUAL
            MATCH     "0",CCEPCOM     * Complete 0=NO
            GOTO      RANGE900 IF EQUAL
          ENDIF
.
          BRANCH    EXRANGE,RANGE800
          MOVE      ZERO,F2
RANGE700  ADD       ONE,F2
          COMPARE   "15",F2
          GOTO      RANGE800 IF EQUAL
          LOAD      KEY3,F2,CCEXR01,CCEXR02,CCEXR03,CCEXR04,CCEXR05:
                            CCEXR06,CCEXR07,CCEXR08,CCEXR09,CCEXR10:
                            CCEXR11,CCEXR12,CCEXR13,CCEXR14
          MATCH     SP70,KEY3
          GOTO      RANGE700 IF EQUAL
.
          MOVE      KEY3,EXTRBRAN
          CALL      GETCD000     * Get Extract Code
.
          MATCH     "027",KEY3              * Visit type
          IF        @EQUAL
            SQUEEZE   KEY10
            PACK      KEY10,KEY10,SP70
          ENDIF
.
          LOAD      EXSTR,F2,CCEXF01,CCEXF02,CCEXF03,CCEXF04,CCEXF05:
                                   CCEXF06,CCEXF07,CCEXF08,CCEXF09,CCEXF10:
                                   CCEXF11,CCEXF12,CCEXF13,CCEXF14
          LOAD      EXEND,F2,CCEXT01,CCEXT02,CCEXT03,CCEXT04,CCEXT05:
                                   CCEXT06,CCEXT07,CCEXT08,CCEXT09,CCEXT10:
                                   CCEXT11,CCEXT12,CCEXT13,CCEXT14
.
          MATCH     EXSTR,KEY10   * Range
          GOTO      RANGE900 IF LESS
          MATCH     KEY10,EXEND
          GOTO      RANGE900 IF LESS
          GOTO      RANGE700
.
RANGE800  MOVE      ZERO,EXIT
          GOTO      RANGE999
RANGE900  MOVE      ONE,EXIT
RANGE999  RETURN
.
.-------------------------------------------------------------------------------
. Update Levels
.-------------------------------------------------------------------------------
UPLEV000  MATCH     "1",CCECEXC         * Excluded from Summary
          GOTO      UPLEV999 IF EQUAL
.
          CALL      UPDEB000
.
          MATCH     SP70,CCEALV2
          GOTO      UPLEV999 IF EQUAL
          CALL      UPDED000
.
          MATCH     SP70,CCEALV3
          GOTO      UPLEV999 IF EQUAL
          CALL      UPDEE000
.
UPLEV999  RETURN
.
.------------------------------------------------------------
. Update Casemix Level 1
.------------------------------------------------------------
UPDEB000  PACK      KEY10,CCECLV1
          CALL      RDCCEB1
          IF        OVRCD=1
            CALL      CLREB000
            MOVE      CCECLV1,CCEBLV1
            CALL      WRCCEB1
            CALL      RDCCEB1
          ENDIF
          ADD       ONE,CCEBNEP    * Increase Number of Episodes
          ADD       CCECFTC,CCEBFTC
          ADD       CCECTTC,CCEBTTC
          ADD       CCECLOS,CCEBLTO
          CALL      UPCCEB1
          RETURN
.------------------------------------------------------------
. Update Casemix Level 2
.------------------------------------------------------------
UPDED000  PACK      KEY20,CCECLV1,CCECLV2,SP70
          MATCH     SP70,KEY20
          GOTO      UPDED999 IF EQUAL
          CALL      RDCCED1
          IF        OVRCD=1
            CALL      CLRED000
            UNPACK    KEY20,CCEDLV1,CCEDLV2
            CALL      WRCCED1
            CALL      RDCCED1
          ENDIF
          ADD       ONE,CCEDNEP    * Increase Number of Episodes
          ADD       CCECFTC,CCEDFTC
          ADD       CCECTTC,CCEDTTC
          ADD       CCECLOS,CCEDLTO
          CALL      UPCCED1
UPDED999  RETURN
.------------------------------------------------------------
. Update Casemix Level 3
.------------------------------------------------------------
UPDEE000  PACK      KEY30,CCECLV1,CCECLV2,CCECLV3,SP70
          MATCH     SP70,KEY30
          GOTO      UPDEE999 IF EQUAL
          CALL      RDCCEE1
          IF        OVRCD=1
            CALL      CLREE000
            UNPACK    KEY30,CCEELV1,CCEELV2,CCEELV3
            CALL      WRCCEE1
            CALL      RDCCEE1
          ENDIF
          ADD       ONE,CCEENEP    * Increase Number of Episodes
          ADD       CCECFTC,CCEEFTC
          ADD       CCECTTC,CCEETTC
          ADD       CCECLOS,CCEELTO
          CALL      UPCCEE1
.
UPDEE999  RETURN
.
.------------------------------------------------------------
. Clear Summary File Details
.------------------------------------------------------------
CLREB000  MOVE      ZERO,CCEBNEP
          MOVE      ZERO,CCEBFTC
          MOVE      "999999999999",CCEBFMN
          MOVE      ZERO,CCEBFMX
          MOVE      ZERO,CCEBFSV
          MOVE      ZERO,CCEBTTC
          MOVE      "999999999999",CCEBTMN
          MOVE      ZERO,CCEBTMX
          MOVE      ZERO,CCEBTSV
          MOVE      "999999999999",CCEBLMN
          MOVE      ZERO,CCEBLMX
          MOVE      ZERO,CCEBLSV
          MOVE      ZERO,CCEBLTO
          RETURN
.
CLRED000  MOVE      ZERO,CCEDNEP
          MOVE      ZERO,CCEDFTC
          MOVE      "999999999999",CCEDFMN
          MOVE      ZERO,CCEDFMX
          MOVE      ZERO,CCEDFSV
          MOVE      ZERO,CCEDTTC
          MOVE      "999999999999",CCEDTMN
          MOVE      ZERO,CCEDTMX
          MOVE      ZERO,CCEDTSV
          MOVE      "999999999999",CCEDLMN
          MOVE      ZERO,CCEDLMX
          MOVE      ZERO,CCEDLSV
          MOVE      ZERO,CCEDLTO
          RETURN
.
CLREE000  MOVE      ZERO,CCEENEP
          MOVE      ZERO,CCEEFTC
          MOVE      "999999999999",CCEEFMN
          MOVE      ZERO,CCEEFMX
          MOVE      ZERO,CCEEFSV
          MOVE      ZERO,CCEETTC
          MOVE      "999999999999",CCEETMN
          MOVE      ZERO,CCEETMX
          MOVE      ZERO,CCEETSV
          MOVE      "999999999999",CCEELMN
          MOVE      ZERO,CCEELMX
          MOVE      ZERO,CCEELSV
          MOVE      ZERO,CCEELTO
          RETURN
.
.------------------------------------------------------------
. Calculate Statistics
.------------------------------------------------------------
STAT0000  PACK      KEY10,SP70
          DISPLAY   *P1:24,*EL,"Calculating Statistics : "
          MOVE      ZERO,TOTALEXT
.
          CALL      STEB0000  * Level 1 Min , Max  & Variance Calculation
          CALL      STED0000  * Level 2 Min , Max  & Variance Calculation
          CALL      STEE0000  * Level 3 Min , Max  & Variance Calculation
.
STAT9999  RETURN
.------------------------------------------------------------
. Update Variance Casemix Level 1
.------------------------------------------------------------
STEB0000  PACK      KEY10,SP70
          CALL      RDCCEB1
          IF        OVRCD=0
            CALL      RPCCEB1
          ENDIF
.
STEB1000  CALL      RKCCEB1
          BRANCH    OVRCD,STEB9999
.
          ADD       ONE,TOTALEXT
          IF        (TOTALEXT%100=0)
            DISPLAY   *P26:24,*V2LON,TOTALEXT,"/1"
          ENDIF
.
          MOVE      "999999999999",CCEBFMN
          MOVE      ZERO,CCEBFMX
          MOVE      ZERO,CCEBFSV
          MOVE      "999999999999",CCEBTMN
          MOVE      ZERO,CCEBTMX
          MOVE      ZERO,CCEBTSV
          MOVE      "999999999999",CCEBLMN
          MOVE      ZERO,CCEBLMX
          MOVE      ZERO,CCEBLSV
.
          PACK      KEY48,CCEBLV1,SP70
          CALL      RSCCEC2
STEB1100  CALL      RKCCEC2
          BRANCH    OVRCD,STEB1900
          MATCH     CCEBLV1,CCECLV1
          GOTO      STEB1900 IF NOT EQUAL
.
          MATCH     "1",CCECEXC  * Excluded
          GOTO      STEB1100 IF EQUAL
.
          CALL      CHKEB000
.
          ASSIGN    CCECFTC-(CCEBFTC/CCEBNEP),F12P4
          ASSIGN    CCEBFSV+(F12P4*F12P4),CCEBFSV
.
          ASSIGN    CCECTTC-(CCEBTTC/CCEBNEP),F12P4
          ASSIGN    CCEBTSV+(F12P4*F12P4),CCEBTSV
.
          ASSIGN    CCECLOS-(CCEBLTO/CCEBNEP),F12P4
          ASSIGN    CCEBLSV+(F12P4*F12P4),CCEBLSV
.
          GOTO      STEB1100
.
STEB1900  IF        CCEBNEP>1
            ASSIGN    CCEBFSV/(CCEBNEP-1),CCEBFSV
            ASSIGN    CCEBTSV/(CCEBNEP-1),CCEBTSV
            ASSIGN    CCEBLSV/(CCEBNEP-1),CCEBLSV
          ENDIF
          CALL      UPCCEB1
          GOTO      STEB1000
.
STEB9999  RETURN
.
.------------------------------------------------------------
. Update Variance Casemix Level 2
.------------------------------------------------------------
STED0000  PACK      KEY20,SP70
          CALL      RDCCED1
          IF        OVRCD=0
            CALL      RPCCED1
          ENDIF
STED1000  CALL      RKCCED1
          BRANCH    OVRCD,STED9999
.
          ADD       ONE,TOTALEXT
          IF        (TOTALEXT%100=0)
            DISPLAY   *P26:24,*V2LON,TOTALEXT,"/2"
          ENDIF
.
          MOVE      "999999999999",CCEDFMN
          MOVE      ZERO,CCEDFMX
          MOVE      ZERO,CCEDFSV
          MOVE      "999999999999",CCEDTMN
          MOVE      ZERO,CCEDTMX
          MOVE      ZERO,CCEDTSV
          MOVE      "999999999999",CCEDLMN
          MOVE      ZERO,CCEDLMX
          MOVE      ZERO,CCEDLSV
.
          PACK      KEY48,CCEDLV1,CCEDLV2,SP70
          PACK      KEY20,CCEDLV1,CCEDLV2,SP70
          CALL      RSCCEC2
STED1100  CALL      RKCCEC2
          BRANCH    OVRCD,STED1900
          PACK      KEY48,CCECLV1,CCECLV2,SP70
          MATCH     KEY20,KEY48
          GOTO      STED1900 IF NOT EQUAL
.
          MATCH     "1",CCECEXC  * Excluded
          GOTO      STED1100 IF EQUAL
.
          CALL      CHKED000
.
          ASSIGN    CCECFTC-(CCEDFTC/CCEDNEP),F12P4
          ASSIGN    CCEDFSV+(F12P4*F12P4),CCEDFSV
.
          ASSIGN    CCECTTC-(CCEDTTC/CCEDNEP),F12P4
          ASSIGN    CCEDTSV+(F12P4*F12P4),CCEDTSV
.
          ASSIGN    CCECLOS-(CCEDLTO/CCEDNEP),F12P4
          ASSIGN    CCEDLSV+(F12P4*F12P4),CCEDLSV
.
          GOTO      STED1100
.
STED1900  IF        CCEDNEP>1
            ASSIGN    CCEDFSV/(CCEDNEP-1),CCEDFSV
            ASSIGN    CCEDTSV/(CCEDNEP-1),CCEDTSV
            ASSIGN    CCEDLSV/(CCEDNEP-1),CCEDLSV
          ENDIF
          CALL      UPCCED1
          GOTO      STED1000
.
STED9999  RETURN
.
.------------------------------------------------------------
. Update Variance Casemix Level 3
.------------------------------------------------------------
STEE0000  PACK      KEY30,SP70
          CALL      RDCCEE1
          IF        OVRCD=0
            CALL      RPCCEE1
          ENDIF
.
STEE1000  CALL      RKCCEE1
          BRANCH    OVRCD,STEE9999
.
          ADD       ONE,TOTALEXT
          IF        (TOTALEXT%100=0)
            DISPLAY   *P26:24,*V2LON,TOTALEXT,"/3"
          ENDIF
.
          MOVE      "999999999999",CCEEFMN
          MOVE      ZERO,CCEEFMX
          MOVE      ZERO,CCEEFSV
          MOVE      "999999999999",CCEETMN
          MOVE      ZERO,CCEETMX
          MOVE      ZERO,CCEETSV
          MOVE      "999999999999",CCEELMN
          MOVE      ZERO,CCEELMX
          MOVE      ZERO,CCEELSV
.
          PACK      KEY48,CCEELV1,CCEELV2,CCEELV3,SP70
          PACK      KEY30,CCEELV1,CCEELV2,CCEELV3,SP70
          CALL      RSCCEC2
STEE1100  CALL      RKCCEC2
          BRANCH    OVRCD,STEE1900
          PACK      KEY48,CCECLV1,CCECLV2,CCECLV3,SP70
          MATCH     KEY30,KEY48
          GOTO      STEE1900 IF NOT EQUAL
.
          MATCH     "1",CCECEXC  * Excluded
          GOTO      STEE1100 IF EQUAL
.
          CALL      CHKEE000
.
          ASSIGN    CCECFTC-(CCEEFTC/CCEENEP),F12P4
          ASSIGN    CCEEFSV+(F12P4*F12P4),CCEEFSV
.
          ASSIGN    CCECTTC-(CCEETTC/CCEENEP),F12P4
          ASSIGN    CCEETSV+(F12P4*F12P4),CCEETSV
.
          ASSIGN    CCECLOS-(CCEELTO/CCEENEP),F12P4
          ASSIGN    CCEELSV+(F12P4*F12P4),CCEELSV
.
          GOTO      STEE1100
.
STEE1900  IF        CCEENEP>1
            ASSIGN    CCEEFSV/(CCEENEP-1),CCEEFSV
            ASSIGN    CCEETSV/(CCEENEP-1),CCEETSV
            ASSIGN    CCEELSV/(CCEENEP-1),CCEELSV
          ENDIF
          CALL      UPCCEE1
          GOTO      STEE1000
.
STEE9999  RETURN
.
.------------------------------------------------------------
. Check Level 3 Min & Max
.------------------------------------------------------------
CHKEE000  IF        CCECFTC>CCEEFMX
            MOVE      CCECFTC,CCEEFMX
          ENDIF
          IF        CCECFTC<CCEEFMN
            MOVE      CCECFTC,CCEEFMN
          ENDIF
.
          IF        CCECTTC>CCEETMX
            MOVE      CCECTTC,CCEETMX
          ENDIF
          IF        CCECTTC<CCEETMN
            MOVE      CCECTTC,CCEETMN
          ENDIF
.
          IF        CCECLOS>CCEELMX
            MOVE      CCECLOS,CCEELMX
          ENDIF
          IF        CCECLOS<CCEELMN
            MOVE      CCECLOS,CCEELMN
          ENDIF
          RETURN
.
.------------------------------------------------------------
. Check Min & Max for Level 2
.------------------------------------------------------------
CHKED000  IF        CCECFTC>CCEDFMX
            MOVE      CCECFTC,CCEDFMX
          ENDIF
          IF        CCECFTC<CCEDFMN
            MOVE      CCECFTC,CCEDFMN
          ENDIF
.
          IF        CCECTTC>CCEDTMX
            MOVE      CCECTTC,CCEDTMX
          ENDIF
          IF        CCECTTC<CCEDTMN
            MOVE      CCECTTC,CCEDTMN
          ENDIF
.
          IF        CCECLOS>CCEDLMX
            MOVE      CCECLOS,CCEDLMX
          ENDIF
          IF        CCECLOS<CCEDLMN
            MOVE      CCECLOS,CCEDLMN
          ENDIF
          RETURN
.
.------------------------------------------------------------
. Check Level 1 Min & Max
.------------------------------------------------------------
CHKEB000  IF        CCECFTC>CCEBFMX
            MOVE      CCECFTC,CCEBFMX
          ENDIF
          IF        CCECFTC<CCEBFMN
            MOVE      CCECFTC,CCEBFMN
          ENDIF
.
          IF        CCECTTC>CCEBTMX
            MOVE      CCECTTC,CCEBTMX
          ENDIF
          IF        CCECTTC<CCEBTMN
            MOVE      CCECTTC,CCEBTMN
          ENDIF
.
          IF        CCECLOS>CCEBLMX
            MOVE      CCECLOS,CCEBLMX
          ENDIF
          IF        CCECLOS<CCEBLMN
            MOVE      CCECLOS,CCEBLMN
          ENDIF
          RETURN
.
.--------------------------------------------------
. Calculate Episode Income/Costs
.--------------------------------------------------
CALEPS00  MOVE      ZERO,CCECFTC
          MOVE      ZERO,CCECTTC
.
          MATCH     SP70,CCEAIMOD        * Use Payment Model Calculation
          GOTO      CALEPS10 IF NOT EQUAL
          MATCH     SP70,CCEAITHE        * Use Theatre Time in place of Income
          GOTO      CALEPS30 IF NOT EQUAL
.
          BRANCH    EXCOMPS,CALEPS20     * Simple Calculation (All)
.
. Partial Components Specified
.-----------------------------
          ASSIGN    CCECFTC+(CCIAITH*CCEYITH)+(CCIAIA1*CCEYIA1),CCECFTC
          ASSIGN    CCECFTC+(CCIAIA2*CCEYIA2)+(CCIAIA3*CCEYIA3),CCECFTC
          ASSIGN    CCECFTC+(CCIAIAO*CCEYIAO)+(CCIAIM1*CCEYIM1),CCECFTC
          ASSIGN    CCECFTC+(CCIAIM2*CCEYIM2)+(CCIAIM3*CCEYIM3),CCECFTC
          ASSIGN    CCECFTC+(CCIAIMO*CCEYIMO),CCECFTC
          GOTO      CALEPS50
.
. Payment Model Calculation
.---------------------------
CALEPS10  MOVE    ZERO,F1
          MOVE    CCEAIMOD,F1
          BRANCH  F1,CALEPS15,CALEPS15,CALEPS15
.
          MOVE    ZERO,CCECFTC               * Keep Theatre Component
          IF      INCUTH=1
            MOVE    CCIAITH,CCECFTC               * Keep Theatre Component
          ELSE
            IF      PATMBSOP=0
              PACK    KEY17,CCEPPMBS,SP70
              CALL    PATITMRD                                         * V90200
              IF      OVRCD=0
                SQUEEZE  IBAND1                                        * V90200
                MOVE     IBAND1,F2                                     * V90200
                LOAD     CCECFTC,F2,INCB01,INCB02,INCB03,INCB04,INCB05:
                                    INCB06,INCB07,INCB08,INCB09,INCB10:
                                    INCB11,INCB12,INCB13,INCB14,INCB15
              ENDIF
            ENDIF
          ENDIF
.
. Add Charge per ICU Day Assume Accom. Component 1
.
          ASSIGN  (INCICU*CCIABA1)+CCECFTC,CCECFTC
.
. Add Charge per day & per case from drg
.
          PACK    KEY5,CCEAIMOD,CCEPDRGC
          CALL    RDCEPM1
          IF      OVRCD=0
            IF      INCINCI=1
              ASSIGN  (CEPMPDAY*CCIALOS)+CEPMPCAS+CCECFTC,CCECFTC
            ELSE
              ASSIGN  (CEPMPDAY*(CCIALOS-CCIABA1))+CEPMPCAS+CCECFTC,CCECFTC
            ENDIF
          ENDIF
          GOTO    CALEPS50
.
CALEPS15  PACK      KEY18,CCECHCD,CCECEPS
          CALL      RDCCEW1            * Income Analysis File
          IF        OVRCD=0
            LOAD      CCECFTC,F1,CCEWFWT,CCEWVWT,CCEWTWT
          ELSE
            MOVE      ZERO,CCECFTC
          ENDIF
          GOTO    CALEPS50
.
. No Component Measures Specified (ALL)
.---------------------------------
CALEPS20  ASSIGN  CCECFTC+CCIAITH+CCIAIA1+CCIAIA2+CCIAIA3+CCIAIAO,CCECFTC
          ASSIGN  CCECFTC+CCIAIM1+CCIAIM2+CCIAIM3+CCIAIMO,CCECFTC
          GOTO    CALEPS50
.
. Theatre Time Replacing Income
.---------------------------------
CALEPS30  MOVE      CCEAITHE,F1
          LOAD      CCECFTC,F1,CCIATT1,CCIATT2,CCIATT3,CCIATT4
.
.--------------------------------------------------
. Calculate Episode Income/Costs
.--------------------------------------------------
CALEPS50  MATCH     SP70,CCEACMOD        * Use Model/Weight Calculation
          GOTO      CALEPS60 IF NOT EQUAL
          MATCH     SP70,CCEACTHE        * Use Theatre Time in place of Cost
          GOTO      CALEPS80 IF NOT EQUAL
.
          BRANCH    EXCOMPS,CALEPS70     * Simple Calculation
.
          ASSIGN    CCECTTC+(CCIAETH1*CCEYETH1)+(CCIAEA11*CCEYEA11),CCECTTC
          ASSIGN    CCECTTC+(CCIAEA21*CCEYEA21)+(CCIAEA31*CCEYEA31),CCECTTC
          ASSIGN    CCECTTC+(CCIAEAO1*CCEYEAO1)+(CCIAEM11*CCEYEM11),CCECTTC
          ASSIGN    CCECTTC+(CCIAEM21*CCEYEM21)+(CCIAEM31*CCEYEM31),CCECTTC
          ASSIGN    CCECTTC+(CCIAEMO1*CCEYEMO1),CCECTTC
.
          ASSIGN    CCECTTC+(CCIAETH2*CCEYETH2)+(CCIAEA12*CCEYEA12),CCECTTC
          ASSIGN    CCECTTC+(CCIAEA22*CCEYEA22)+(CCIAEA32*CCEYEA32),CCECTTC
          ASSIGN    CCECTTC+(CCIAEAO2*CCEYEAO2)+(CCIAEM12*CCEYEM12),CCECTTC
          ASSIGN    CCECTTC+(CCIAEM22*CCEYEM22)+(CCIAEM32*CCEYEM32),CCECTTC
          ASSIGN    CCECTTC+(CCIAEMO2*CCEYEMO2),CCECTTC
.
          ASSIGN    CCECTTC+(CCIAETH3*CCEYETH3)+(CCIAEA13*CCEYEA13),CCECTTC
          ASSIGN    CCECTTC+(CCIAEA23*CCEYEA23)+(CCIAEA33*CCEYEA33),CCECTTC
          ASSIGN    CCECTTC+(CCIAEAO3*CCEYEAO3)+(CCIAEM13*CCEYEM13),CCECTTC
          ASSIGN    CCECTTC+(CCIAEM23*CCEYEM23)+(CCIAEM33*CCEYEM33),CCECTTC
          ASSIGN    CCECTTC+(CCIAEMO3*CCEYEMO3),CCECTTC
.
          ASSIGN    CCECTTC+(CCIAETH4*CCEYETH4)+(CCIAEA14*CCEYEA14),CCECTTC
          ASSIGN    CCECTTC+(CCIAEA24*CCEYEA24)+(CCIAEA34*CCEYEA34),CCECTTC
          ASSIGN    CCECTTC+(CCIAEAO4*CCEYEAO4)+(CCIAEM14*CCEYEM14),CCECTTC
          ASSIGN    CCECTTC+(CCIAEM24*CCEYEM24)+(CCIAEM34*CCEYEM34),CCECTTC
          ASSIGN    CCECTTC+(CCIAEMO4*CCEYEMO4),CCECTTC
.
          ASSIGN    CCECTTC+(CCIAETH5*CCEYETH5)+(CCIAEA15*CCEYEA15),CCECTTC
          ASSIGN    CCECTTC+(CCIAEA25*CCEYEA25)+(CCIAEA35*CCEYEA35),CCECTTC
          ASSIGN    CCECTTC+(CCIAEAO5*CCEYEAO5)+(CCIAEM15*CCEYEM15),CCECTTC
          ASSIGN    CCECTTC+(CCIAEM25*CCEYEM25)+(CCIAEM35*CCEYEM35),CCECTTC
          ASSIGN    CCECTTC+(CCIAEMO5*CCEYEMO5),CCECTTC
.
          GOTO      CALEPS99
.
. Payment Model Calculation
.---------------------------
CALEPS60  MOVE    ZERO,F1
          MOVE    CCEACMOD,F1
          BRANCH  F1,CALEPS65,CALEPS65,CALEPS65
.
          MOVE    ZERO,CCECTTC
          IF      CSTUTH=1
            MOVE    CCIAITH,CCECTTC               * Keep Theatre Component
          ELSE
            IF      PATMBSOP=0
              PACK    KEY17,CCEPPMBS,SP70
              CALL    PATITMRD                                         * V90200
              IF      OVRCD=0
                SQUEEZE  IBAND1                                        * V90200
                MOVE     IBAND1,F2                                     * V90200
                LOAD     CCECTTC,F2,CSTB01,CSTB02,CSTB03,CSTB04,CSTB05:
                                    CSTB06,CSTB07,CSTB08,CSTB09,CSTB10:
                                    CSTB11,CSTB12,CSTB13,CSTB14,CSTB15
              ENDIF
            ENDIF
          ENDIF
.
. Add Charge per ICU Day Assume Accom. Component 1
.
          ASSIGN  (CSTICU*CCIABA1)+CCECTTC,CCECTTC
.
. Add Charge per day & per case from drg
.
          PACK    KEY5,CCEACMOD,CCEPDRGC
          CALL    RDCEPM1
          IF      OVRCD=0
            IF      CSTINCI=1
              ASSIGN  (CEPMPDAY*CCIALOS)+CEPMPCAS+CCECTTC,CCECTTC
            ELSE
              ASSIGN  (CEPMPDAY*(CCIALOS-CCIABA1))+CEPMPCAS+CCECTTC,CCECTTC
            ENDIF
          ENDIF
          GOTO    CALEPS99
.
. WEIS Weight
.
CALEPS65  PACK      KEY18,CCECHCD,CCECEPS
          CALL      RDCCEW1            * Income Analysis File
          IF        OVRCD=0
            LOAD      CCECTTC,F1,CCEWFWT,CCEWVWT,CCEWTWT
          ELSE
            MOVE      ZERO,CCECTTC
          ENDIF
          GOTO    CALEPS99
.
. No Component Measures Specified
.---------------------------------
CALEPS70  ASSIGN  CCECTTC+CCIAETH1+CCIAEA11+CCIAEA21+CCIAEA31+CCIAEAO1,CCECTTC
          ASSIGN  CCECTTC+CCIAEM11+CCIAEM21+CCIAEM31+CCIAEMO1,CCECTTC
          ASSIGN  CCECTTC+CCIAETH2+CCIAEA12+CCIAEA22+CCIAEA32+CCIAEAO2,CCECTTC
          ASSIGN  CCECTTC+CCIAEM12+CCIAEM22+CCIAEM32+CCIAEMO2,CCECTTC
          ASSIGN  CCECTTC+CCIAETH3+CCIAEA13+CCIAEA23+CCIAEA33+CCIAEAO3,CCECTTC
          ASSIGN  CCECTTC+CCIAEM13+CCIAEM23+CCIAEM33+CCIAEMO3,CCECTTC
          ASSIGN  CCECTTC+CCIAETH4+CCIAEA14+CCIAEA24+CCIAEA34+CCIAEAO4,CCECTTC
          ASSIGN  CCECTTC+CCIAEM14+CCIAEM24+CCIAEM34+CCIAEMO4,CCECTTC
          ASSIGN  CCECTTC+CCIAETH5+CCIAEA15+CCIAEA25+CCIAEA35+CCIAEAO5,CCECTTC
          ASSIGN  CCECTTC+CCIAEM15+CCIAEM25+CCIAEM35+CCIAEMO5,CCECTTC
          GOTO    CALEPS99
.
. Theatre Time Replacing Cost
.---------------------------------
CALEPS80  MOVE      CCEACTHE,F1
          LOAD      CCECTTC,F1,CCIATT1,CCIATT2,CCIATT3,CCIATT4
.
CALEPS99  RETURN
.
+
. =========================================================================
.         I/O Includes
. =========================================================================
.
          INC       STD001IO
          INC       CCSG58CD
          INC       PATITMRD
.
          INC       CCSCEAIO/INC
          INC       CCSAGEIO/INC
          INC       CCSCEXIO/INC
          INC       CCSDRGIO/INC
          INC       CCSEPSIO/INC
          INC       CCSEWTIO/INC
          INC       CCSEYAIO/INC
          INC       CCSHCDIO/INC
          INC       CCSIADIO/INC
          INC       CCSSTYIO/INC
          INC       CCSXHDIO/INC
          INC       CEAPPMIO/INC
          INC       CEAPMDIO/INC
          INC       PATITMIO/INC
          INC       CCSCEBIO/INC
          INC       CCSCECIO/INC
          INC       CCSCEDIO/INC
          INC       CCSCEEIO/INC
          INC       CCSCEFIO/INC
          INC       CCSCEGIO/INC

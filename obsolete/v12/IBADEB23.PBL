.-----------------------------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.00.00"
.-------------------------------------------------------
. V9.02.00  03.05.2002  Glenn Saunders
.           Export to new release i.e. v9.02 from vf.09
.-----------------------------------------------------------------------------
. VF.09.01  28.02.2002  Glenn Saunders   srf 15126
.           Re-compile for changes in DEBDKIKY
.-----------------------------------------------------------------------------
. VF.00.01  04.05.1999 Sandra Barcham
.           To debtor can also be equal to from debtor
.-----------------------------------------------------------------------------
ENDDEB    DIM       8
ENDDEP    DIM       8
ENDPTY    DIM       8
ENDDAT    DIM       8
FALLPTY   FORM      1
FALLDAT   FORM      1
FALLDEP   FORM      1
INVTOTAL  FORM      12.2
LASTDEB   DIM       8
NEXTDEB   DIM       8
STRDEB    DIM       8
STRDEP    DIM       8
STRPTY    DIM       8
STRDAT    DIM       8
.-----------------------------------------------------------------------------
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBADEB23
.   Function      :   Create Proposed Invoices                
.   Generated  On :   13/12/2005
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       DEBBILFD/INC
          INC       DEBCODFD/INC
          INC       DEBCONFD/INC
          INC       DEBDBTFD/INC
          INC       DEBDEPFD/INC
          INC       DEBDKIFD/INC
          INC       DEBITMFD/INC
          INC       DEBPTYFD/INC
.=========================
.Local Variable Definition
.-------------------------
FROMDEB   DIM      40 * Scr 00 Fld     4
TODEB     DIM      40 * Scr 00 Fld     5
FROMDEP   DIM      40 * Scr 00 Fld     6
TODEP     DIM      40 * Scr 00 Fld     7
FROMPTY   DIM      40 * Scr 00 Fld     8
TOPTY     DIM      40 * Scr 00 Fld     9
FROMDAT   DIM      10 * Scr 00 Fld    10
TODAT     DIM      10 * Scr 00 Fld    11
MININV    FORM     12.2 * Scr 00 Fld    12
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBADEB23"
PRGNAM    INIT      "Create Proposed Invoices                "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          MOVE      PORT,PARENTID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      SC00L000
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          MOVE      "   81",AUDTSECT
          MOVE      "  9",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening debaudcd";
            OPEN      DEBAUDCD,"debaudcd"
          ENDIF
          MOVE      "   81",AUDTSECT
          MOVE      " 10",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening debauddb";
            OPEN      DEBAUDDB,"debauddb"
          ENDIF
          MOVE      "   81",AUDTSECT
          MOVE      " 11",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening debaudde";
            OPEN      DEBAUDDE,"debaudde"
          ENDIF
          MOVE      "   81",AUDTSECT
          MOVE      " 12",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening debaudit";
            OPEN      DEBAUDIT,"debaudit"
          ENDIF
          MOVE      "   81",AUDTSECT
          MOVE      " 13",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening debaudpt";
            OPEN      DEBAUDPT,"debaudpt"
          ENDIF
          DISPLAY   *P56:24,"Opening debbilaf";
          OPEN      DEBBILA1,"debbilaf"
          DISPLAY   *P56:24,"Opening debbilaf";
          OPEN      DEBBILA2,"debbilaf"
          DISPLAY   *P56:24,"Opening debcodaf";
          OPEN      DEBCODA1,"debcodaf"
          DISPLAY   *P56:24,"Opening debcodaf";
          OPEN      DEBCODA2,"debcodaf"
          DISPLAY   *P56:24,"Opening debdbtaf";
          OPEN      DEBDBTA1,"debdbtaf"
          DISPLAY   *P56:24,"Opening debdbtaf";
          OPEN      DEBDBTA2,"debdbtaf"
          DISPLAY   *P56:24,"Opening debdbtaf";
          OPEN      DEBDBTA3,"debdbtaf"
          DISPLAY   *P56:24,"Opening debdbtaf";
          OPEN      DEBDBTA4,"debdbtaf"
          DISPLAY   *P56:24,"Opening debdepaf";
          OPEN      DEBDEPA1,"debdepaf"
          DISPLAY   *P56:24,"Opening debdepaf";
          OPEN      DEBDEPA2,"debdepaf"
          DISPLAY   *P56:24,"Opening debdkiaf";
          OPEN      DEBDKIA1,"debdkiaf"
          DISPLAY   *P56:24,"Opening debdkiaf";
          OPEN      DEBDKIA2,"debdkiaf"
          DISPLAY   *P56:24,"Opening debitmaf";
          OPEN      DEBITMA1,"debitmaf"
          DISPLAY   *P56:24,"Opening debitmaf";
          OPEN      DEBITMA2,"debitmaf"
          DISPLAY   *P56:24,"Opening debitmaf";
          OPEN      DEBITMA3,"debitmaf"
          DISPLAY   *P56:24,"Opening debptyaf";
          OPEN      DEBPTYA1,"debptyaf"
          DISPLAY   *P56:24,"Opening debptyaf";
          OPEN      DEBPTYA2,"debptyaf"
          DISPLAY   *P56:24,"Opening debptyaf";
          OPEN      DEBPTYA3,"debptyaf"
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "00",SCRID
          IF         @EQUAL
            CALL       PS00L000   * Create Proposed Invoices           
          ENDIF
          RETURN
.--------------------------------
. Screen - Create Proposed Invoices           
.--------------------------------
SC00L000
SC00L100
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC00L200
          CALL      CF00L000 * Clear Fields
          CALL      DEFPAR00
SC00L300
          CALL      KY00L000 * Enter Key Fields
          BRANCH    EXIT,SC00L999,SC00L999
SC00L400
          CALL      WP00L000 * Load any WP Details
SC00L500
          CALL      LM00L000 * Load any Batch Details
SC00L600
          CALL      DF00L000 * Display Fields
SC00L700
          CALL      SF00L000 * Select Fields
          BRANCH    EXIT,SC00L100,SC00L100,SC00L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC00L800
SC00L900
SC00L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Create Proposed Invoices           
.-------------------------------------------------------
CF00L000
          MOVE      SP70,FROMDEB 
          MOVE      SP70,FROMDEP 
          MOVE      SP70,FROMPTY 
          MOVE      SP70,FROMDAT 
          MOVE      ZERO,MININV  
CF00L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Create Proposed Invoices           
.--------------------------------------------------------
KY00L000
          MOVE      ZERO,EXIT
          GOTO      KY00L999
.
KY00L900  MOVE      ONE,EXIT
KY00L999  RETURN
.---------------------------------------------------------
. Load WP files for : Create Proposed Invoices           
.---------------------------------------------------------
WP00L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Create Proposed Invoices           
.---------------------------------------------------------
LM00L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Create Proposed Invoices           
.---------------------------------------------------------
DF00L000
          BRANCH   ACCEPT,DF00L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF00L900
          MATCH    PRGID,SCPSPID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF00L010 IF NOT EQUAL
.
          CALL     PS00L000 * Display Field
          GOTO     DF00L010
DF00L900
DF00L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Create Proposed Invoices           
.---------------------------------------------------------
PS00L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS00L999,PS00L999,PS00L999,PS00L101:
                            PS00L102,PS00L103,PS00L104,PS00L105:
                            PS00L106,PS00L107,PS00L108,PS00L109
          GOTO     PS00L999
.
PS00L101
          MOVE      FROMDEB,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L102
          MOVE      TODEB,VAR        
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L103
          MOVE      FROMDEP,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L104
          MOVE      TODEP,VAR        
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L105
          MOVE      FROMPTY,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L106
          MOVE      TOPTY,VAR        
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L107
          MOVE      FROMDAT,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L108
          MOVE      TODAT,VAR        
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L109
          MOVE      MININV,VAR       
          CALL      DISPITEM
          GOTO     PS00L999
PS00L999
          RETURN
.---------------------------------------------------------
. Selections for : Create Proposed Invoices           
.---------------------------------------------------------
SF00L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF00L001  BRANCH   ACCEPT,SF00L020
.
SF00L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L006,SF00L101,SF00L102,SF00L103:
                            SF00L006,SF00L104,SF00L006,SF00L105:
                            SF00L006,SF00L106,SF00L006,SF00L107
SF00L006  BEEP
          GOTO     SF00L005
SF00L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF00L090
          MATCH    PRGID,SCSLPID
          GOTO     SF00L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF00L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L020,SF00L020,SF00L020,SF00L103:
                            SF00L020,SF00L104,SF00L020,SF00L105:
                            SF00L020,SF00L106,SF00L020,SF00L107
          GOTO     SF00L020
SF00L090  MOVE     ZERO,ACCEPT
          GOTO     SF00L001
.
SF00L101
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L102
          CALL      POST0000
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L103
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TODEB   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      RDEB0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L103
            ENDIF
            BRANCH    EXIT,SF00L103,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      FROMDEB,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TODEB,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L104
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TODEP   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      RDEP0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L104
            ENDIF
            BRANCH    EXIT,SF00L104,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      FROMDEP,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TODEP,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L105
.
.
          MOVE      "    9",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOPTY   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      RPTY0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L105
            ENDIF
            BRANCH    EXIT,SF00L105,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      FROMPTY,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    9",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOPTY,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L106
.
.
          MOVE      "   11",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TODAT   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      RDAT0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L106
            ENDIF
            BRANCH    EXIT,SF00L106,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      FROMDAT,VAR      
          CALL      DISPITEM
.
.
          MOVE      "   11",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TODAT,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L107
          CALL     SELECTED
          MOVE      SP70,VAR
          CALL      DISPITEM
          KEYIN     *PCCOL:CVERT,*V2LON,*NOMASK,*RV,MININV  
          IF        SCPSMAN=1
            COMPARE   ZERO,MININV  
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L107
            ENDIF
          ENDIF
          MOVE      MININV,VAR       
          CALL      DISPITEM
          GOTO     SF00L001
SF00L990  MOVE      FOUR,EXIT * Exit Char Exit
SF00L999  RETURN
.@@@@@ Function Restart Point @@@@@
.---------------------------------------
. Setup Defaults for Invoice Generation
.---------------------------------------
DEFPAR00  MOVE      "Start    ",FROMDEB
          MOVE      "Start    ",FROMDEP
          MOVE      "Start    ",FROMPTY
          MOVE      "Start    ",FROMDAT
          MOVE      "Finish   ",TODEB
          MOVE      "Finish   ",TODEP
          MOVE      "Finish   ",TOPTY
          MOVE      "Finish   ",TODAT
          MOVE      ZERO,MININV
          MOVE      SP70,STRDEB
          MOVE      SP70,STRDEP
          MOVE      SP70,STRPTY
          MOVE      SP70,STRDAT
          MOVE      Z70,ENDDEB
          MOVE      Z70,ENDDEP
          MOVE      Z70,ENDPTY
          MOVE      Z70,ENDDAT
          RETURN
.
.---------------------
. Generate Invoices
.---------------------
POST0000  READ      CONTROLF,EIGHTY1;*20,CFDBIFL
          IF        CFDBIFL=1
            BEEP
            MOVE      "ERROR : Invoice Generation in Progress. - ",DISPMSG
            CALL      MESSAGE1
            BEEP
            MOVE      "      0 Billing Items Processed. - ",DISPMSG
            CALL      MESSAGE1
            GOTO      POST9999
          ENDIF
          MOVE      ONE,CFDBIFL
          WRITAB    CONTROLF,EIGHTY1;*20,CFDBIFL
.
          CALL      CHKRAN00     * Check Ranges
.
          PACK      KEY14,STRDEB,SP70
          MOVE      ZERO,SECTOR
          CALL      RSDBBI1
POST1000  CALL      RKDBBI1
          BRANCH    OVRCD,POST9000
          MATCH     DBBIDEB,ENDDEB
          GOTO      POST9000 IF LESS
.
          MATCH     "1",DBBISTA
          GOTO      POST1000 IF NOT EQUAL
.
          CALL      RANGE000
          BRANCH    EXIT,POST1000
.
          MOVE      "2",DBBISTA
          CALL      UPDBBI1
          ADD       ONE,SECTOR
          GOTO      POST1000
.
POST9000  CALL      MININV00     * Check for Minimum Invoice Value
.
          BEEP
          CLEAR     DISPMSG
          APPEND    "Completed : ",DISPMSG
          APPEND    SECTOR,DISPMSG
          APPEND    " Billing Items Processed.- ",DISPMSG
          RESET     DISPMSG
          CALL      MESSAGE1
.
POST9999  RETURN
.--------------------------------------------------------
. Check Ranges
.--------------------------------------------------------
RANGE000  BRANCH    FALLDAT,RANGE100
          MATCH     STRDAT,DBBISDAT   * Service Date Range
          GOTO      RANGE900 IF LESS
          MATCH     DBBISDAT,ENDDAT
          GOTO      RANGE900 IF LESS
.
RANGE100  BRANCH    FALLPTY,RANGE200
          PACK      KEY8,DBBIITM
          CALL      RDDBIT1
          BRANCH    OVRCD,RANGE810
.
          MATCH     STRPTY,DBITPTY    * Product Type Range
          GOTO      RANGE900 IF LESS
          MATCH     DBITPTY,ENDPTY
          GOTO      RANGE900 IF LESS
.
RANGE200  BRANCH    FALLDEP,RANGE300
          PACK      KEY8,DBBIITM
          CALL      RDDBIT1
          BRANCH    OVRCD,RANGE810
          PACK      KEY8,DBITPTY
          CALL      RDDBPT1
          BRANCH    OVRCD,RANGE820
.
          MATCH     STRDEP,DBPTDEP    * Department Range
          GOTO      RANGE900 IF LESS
          MATCH     DBPTDEP,ENDDEP
          GOTO      RANGE900 IF LESS
.
RANGE300  MOVE      ZERO,EXIT
          GOTO      RANGE999
.
RANGE810  CLEAR     DISPMSG
          APPEND    "ERROR : Sales Item Not On File - ",DISPMSG
          APPEND    KEY8,DISPMSG
          APPEND    " - ",DISPMSG
          RESET     DISPMSG
          BEEP
          CALL      MESSAGE1
          GOTO      RANGE900
.
RANGE820  CLEAR     DISPMSG
          APPEND    "ERROR : Product Type Not On File - ",DISPMSG
          APPEND    KEY8,DISPMSG
          APPEND    " - ",DISPMSG
          RESET     DISPMSG
          BEEP
          CALL      MESSAGE1
          GOTO      RANGE900
.
RANGE900  MOVE      ONE,EXIT
.
RANGE999  RETURN
.--------------------------------------------------
. Check Ranges and set "ALL" flag for each range
.--------------------------------------------------
CHKRAN00  MOVE      ZERO,FALLDEP
          MOVE      ZERO,FALLDAT
          MOVE      ZERO,FALLPTY
.
          MATCH     SP70,STRDEP
          IF        @EQUAL
            MATCH     Z70,ENDDEP
            IF        @EQUAL
              MOVE      ONE,FALLDEP
            ENDIF
          ENDIF
.
          MATCH     SP70,STRPTY
          IF        @EQUAL
            MATCH     Z70,ENDPTY
            IF        @EQUAL
              MOVE      ONE,FALLPTY
            ENDIF
          ENDIF
.
          MATCH     SP70,STRDAT
          IF        @EQUAL
            MATCH     Z70,ENDDAT
            IF        @EQUAL
              MOVE      ONE,FALLDAT
            ENDIF
          ENDIF
.
          RETURN
.--------------------------------------------------
. Check for Minimum Invoice Value
.--------------------------------------------------
MININV00  COMPARE   ZERO,MININV          * No Minimum Set
          GOTO      MININV99 IF EQUAL
          MOVE      ZERO,INVTOTAL        * Calculate Invoice Total
          MOVE      SP70,LASTDEB
          PACK      KEY14,STRDEB,SP70
          CALL      RSDBBI1
MININV10  CALL      RKDBBI1
          BRANCH    OVRCD,MININV99
          MATCH     DBBIDEB,ENDDEB
          GOTO      MININV99 IF LESS
          MATCH     "2",DBBISTA
          GOTO      MININV10 IF NOT EQUAL
          MATCH     DBBIDEB,LASTDEB
          GOTO      MININV20 IF NOT EQUAL
          ADD       DBBITOT,INVTOTAL        * Calculate Invoice Total
          ADD       DBBITAX,INVTOTAL        * Calculate Invoice Total
          GOTO      MININV10
.
MININV20  MOVE      DBBIDEB,NEXTDEB
          MATCH     SP70,LASTDEB
          GOTO      MININV40 IF EQUAL
.
          IF        INVTOTAL>MININV
            GOTO      MININV40
          ENDIF
.
          PACK      KEY14,LASTDEB,SP70
          CALL      RSDBBI1
MININV30  CALL      RKDBBI1
          BRANCH    OVRCD,MININV40
          MATCH     DBBIDEB,LASTDEB
          GOTO      MININV40 IF NOT EQUAL
          MOVE      "1",DBBISTA          * Clear from Proposed Invoice
          CALL      UPDBBI1
          SUB       ONE,SECTOR
          GOTO      MININV30
.
MININV40  MOVE      ZERO,INVTOTAL        * Calculate Invoice Total
          MOVE      NEXTDEB,LASTDEB
          PACK      KEY14,LASTDEB,SP70
          CALL      RSDBBI1
          GOTO      MININV10
.
MININV99  RETURN
.--------------------------------------------------
. Enter Debtors Range
.--------------------------------------------------
RDEB0000   MOVE     "    4",FLDID
           CALL     GETPOSIT
           CALL     KDBDBA00
           BRANCH   EXIT,RDEB0100,RDEB0999
           MOVE     DBDBDEB,STRDEB
           PACK     FROMDEB,DBDBDEB,SP1,DBDBNA1
           GOTO     RDEB0140
RDEB0100   MOVE     "Start             ",FROMDEB
           MOVE     SP70,STRDEB
.
RDEB0140   MOVE     FROMDEB,VAR
           CALL     DISPITEM
.
RDEB0150   MOVE     "    5",FLDID
           CALL     GETPOSIT
           CALL     KDBDBA00
           BRANCH   EXIT,RDEB0200,RDEB0999
           MOVE     DBDBDEB,ENDDEB
           PACK     TODEB,DBDBDEB,SP1,DBDBNA1
           MATCH    STRDEB,ENDDEB
           GOTO     RDEB0999 IF EQUAL
           GOTO     RDEB0999 IF NOT LESS
           BEEP
           MOVE     "To Debtor Must Be >= From Debtor - ",DISPMSG
           CALL     MESSAGE1
           GOTO     RDEB0000
.
RDEB0200   MOVE     "Finish             ",TODEB
           MOVE     Z70,ENDDEB
.
RDEB0999   MOVE     "    4",FLDID
           CALL     GETPOSIT
           RETURN
.--------------------------------------------------
. Enter Department Range
.--------------------------------------------------
RDEP0000   MOVE     "    6",FLDID
           CALL     GETPOSIT
           CALL     KDBDEA00
           BRANCH   EXIT,RDEP0100,RDEP0999
           MOVE     DBDEDEP,STRDEP
           PACK     FROMDEP,DBDEDEP,SP1,DBDEDES
           GOTO     RDEP0140
RDEP0100   MOVE     "Start             ",FROMDEP
           MOVE     SP70,STRDEP
.
RDEP0140   MOVE     FROMDEP,VAR
           CALL     DISPITEM
.
RDEP0150   MOVE     "    7",FLDID
           CALL     GETPOSIT
           CALL     KDBDEA00
           BRANCH   EXIT,RDEP0200,RDEP0999
           MOVE     DBDEDEP,ENDDEP
           PACK     TODEP,DBDEDEP,SP1,DBDEDES
           MATCH    STRDEP,ENDDEP
           GOTO     RDEP0999 IF EQUAL
           GOTO     RDEP0999 IF NOT LESS
           BEEP
           MOVE     "To Department Must Be >= From Department - ",DISPMSG
           CALL     MESSAGE1
           GOTO     RDEP0000
.
RDEP0200   MOVE     "Finish             ",TODEP
           MOVE     Z70,ENDDEP
.
RDEP0999   MOVE     "    6",FLDID
           CALL     GETPOSIT
           RETURN
.--------------------------------------------------
. Enter PTYartment Range
.--------------------------------------------------
RPTY0000   MOVE     "    8",FLDID
           CALL     GETPOSIT
           CALL     KDBPTA00
           BRANCH   EXIT,RPTY0100,RPTY0999
           MOVE     DBPTPTY,STRPTY
           PACK     FROMPTY,DBPTPTY,SP1,DBPTDES
           GOTO     RPTY0140
RPTY0100   MOVE     "Start             ",FROMPTY
           MOVE     SP70,STRPTY
.
RPTY0140   MOVE     FROMPTY,VAR
           CALL     DISPITEM
.
RPTY0150   MOVE     "    9",FLDID
           CALL     GETPOSIT
           CALL     KDBPTA00
           BRANCH   EXIT,RPTY0200,RPTY0999
           MOVE     DBPTPTY,ENDPTY
           PACK     TOPTY,DBPTPTY,SP1,DBPTDES
           MATCH    STRPTY,ENDPTY
           GOTO     RPTY0999 IF EQUAL
           GOTO     RPTY0999 IF NOT LESS
           BEEP
           MOVE     "To Product Type Must Be >= From Product Type - ",DISPMSG
           CALL     MESSAGE1
           GOTO     RPTY0000
.
RPTY0200   MOVE     "Finish             ",TOPTY
           MOVE     Z70,ENDPTY
.
RPTY0999   MOVE     "    8",FLDID
           CALL     GETPOSIT
           RETURN
.----------------------------------------
. Enter Service Date Range
.----------------------------------------
RDAT0000   MOVE     "   10",FLDID
           CALL     GETPOSIT
           MOVE     SP70,CDAY
           MOVE     CMM,CMON
           MOVE     CYY,CYEAR
           MOVE     CCC,CCENT
           CALL     KEYDATE
           BRANCH   OVRCD,RDAT0100
           MATCH    SP2,CDAY
           GOTO     RDAT0100 IF EQUAL
           PACK     STRDAT,CCENT,CYEAR,CMON,CDAY
           REP      " 0",STRDAT
           CALL     PACDATE
           MOVE     CPCDATE,FROMDAT
           GOTO     RDAT0140
RDAT0100   MOVE     "Start             ",FROMDAT
           MOVE     SP70,STRDAT
.
RDAT0140   MOVE     FROMDAT,VAR
           CALL     DISPITEM
.
RDAT0150   MOVE     "   11",FLDID
           CALL     GETPOSIT
           MOVE     SP70,CDAY
           MOVE     CMM,CMON
           MOVE     CYY,CYEAR
           MOVE     CCC,CCENT
           CALL     KEYDATE
           BRANCH   OVRCD,RDAT0200
           MATCH    SP2,CDAY
           GOTO     RDAT0200 IF EQUAL
           PACK     ENDDAT,CCENT,CYEAR,CMON,CDAY
           REP      " 0",ENDDAT
           CALL     PACDATE
           MOVE     CPCDATE,TODAT
           MATCH    STRDAT,ENDDAT
           GOTO     RDAT0999 IF EQUAL
           GOTO     RDAT0999 IF NOT LESS
           BEEP
           MOVE     "To Date Must Be > From Date - ",DISPMSG
           CALL     MESSAGE1
           GOTO     RDAT0000
.
RDAT0200   MOVE     "Finish             ",TODAT
           MOVE     "99999999",ENDDAT
.
RDAT0999   MOVE     "   10",FLDID
           CALL     GETPOSIT
           RETURN

.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       DEBBILIO/INC
          INC       DEBCODIO/INC
          INC       DEBDBTIO/INC
          INC       DEBDBTKY    
          INC       DEBDEPIO/INC
          INC       DEBDEPKY    
          INC       DEBDKIIO/INC
          INC       DEBDKIKY    
          INC       DEBDKIPR    
          INC       DEBITMIO/INC
          INC       DEBPTYIO/INC
          INC       DEBPTYKY    
.
          INC       STDGENCD
.

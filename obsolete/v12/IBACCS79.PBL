.-------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.00.00"
.-------------------------------------------------------
. V9.02.00  04.07.2002  Glenn Saunders
.           Export to new release i.e. v9.02 from r5.09
.-------------------------------------------------------
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBACCS79
.   Function      :   Cost Model - Indirect Allocation Report 
.   Generated  On :   04/07/2002
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       CCSATYFD/INC
          INC       CCSCALFD/INC
          INC       CCSCMAFD/INC
          INC       CCSCMBFD/INC
          INC       CCSCMCFD/INC
          INC       CCSCMDFD/INC
          INC       CCSCMEFD/INC
          INC       CCSCMFFD/INC
          INC       CCSCTYFD/INC
          INC       CCSDPTFD/INC
          INC       CCSEXTDF    
          INC       CCSHCDFD/INC
          INC       CCSTMPDF    
.=========================
.Local Variable Definition
.-------------------------
FROMYEAR  DIM       4 * Scr 00 Fld     2
FROMPER   DIM       2 * Scr 00 Fld     3
RDIRECT   FORM      1 * Scr 00 Fld    10
RINDIR    FORM      1 * Scr 00 Fld    11
FLAGALL   FORM      1 * Scr 00 Fld    12
TOPER     DIM       2 * Scr 00 Fld    14
TOYEAR    DIM       4 * Scr 00 Fld    15
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBACCS79"
PRGNAM    INIT      "Cost Model - Indirect Allocation Report "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      SC00L000
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          DISPLAY   *P56:24,"Opening ccsatyaf";
          OPEN      CCSATYA1,"ccsatyaf"
          DISPLAY   *P56:24,"Opening ccsatyaf";
          OPEN      CCSATYA2,"ccsatyaf"
          DISPLAY   *P56:24,"Opening ccscalaf";
          OPEN      CCSCALA1,"ccscalaf"
          DISPLAY   *P56:24,"Opening ccscalaf";
          OPEN      CCSCALA2,"ccscalaf"
          DISPLAY   *P56:24,"Opening ccscalaf";
          OPEN      CCSCALA3,"ccscalaf"
          DISPLAY   *P56:24,"Opening ccscmaaf";
          OPEN      CCSCMAA1,"ccscmaaf"
          DISPLAY   *P56:24,"Opening ccsctyaf";
          OPEN      CCSCTYA1,"ccsctyaf"
          DISPLAY   *P56:24,"Opening ccsctyaf";
          OPEN      CCSCTYA2,"ccsctyaf"
          DISPLAY   *P56:24,"Opening ccsdptaf";
          OPEN      CCSDPTA1,"ccsdptaf"
          DISPLAY   *P56:24,"Opening ccsdptaf";
          OPEN      CCSDPTA2,"ccsdptaf"
          DISPLAY   *P56:24,"Opening ccsdptaf";
          OPEN      CCSDPTA3,"ccsdptaf"
          DISPLAY   *P56:24,"Opening ccsdptaf";
          OPEN      CCSDPTA4,"ccsdptaf"
          DISPLAY   *P56:24,"Opening ccshcdaf";
          OPEN      CCSHCDA1,"ccshcdaf"
          DISPLAY   *P56:24,"Opening ccshcdaf";
          OPEN      CCSHCDA2,"ccshcdaf"
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "00",SCRID
          IF         @EQUAL
            CALL       PS00L000   * Indirect Budget Allocation Report  
          ENDIF
          RETURN
.--------------------------------
. Screen - Indirect Budget Allocation Report  
.--------------------------------
SC00L000
SC00L100
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    8",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC00L200
          CALL      CF00L000 * Clear Fields
          CALL      MVACCEPT
SC00L300
          CALL      KY00L000 * Enter Key Fields
          BRANCH    EXIT,SC00L999,SC00L999
SC00L400
          CALL      WP00L000 * Load any WP Details
SC00L500
          CALL      LM00L000 * Load any Batch Details
SC00L600
          CALL      DF00L000 * Display Fields
SC00L700
          CALL      SF00L000 * Select Fields
          BRANCH    EXIT,SC00L100,SC00L100,SC00L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC00L800
SC00L900
SC00L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Indirect Budget Allocation Report  
.-------------------------------------------------------
CF00L000
          MOVE      SP70,SAVEHCD 
          MOVE      SP70,FROMYEAR
          MOVE      SP70,FROMPER 
          MOVE      SP70,CCHCDES 
          MOVE      SP70,CCCADES 
          MOVE      SP70,CCCAFDT 
          MOVE      SP70,CCCATDT 
          MOVE      ZERO,RDIRECT 
          MOVE      ZERO,RINDIR  
          MOVE      ZERO,FLAGALL 
          MOVE      SP70,TOPER   
          MOVE      SP70,TOYEAR  
          MOVE      SP70,CCMACOM 
          MOVE      SP70,CCMADES 
CF00L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Indirect Budget Allocation Report  
.--------------------------------------------------------
KY00L000
          MOVE      ZERO,EXIT
          GOTO      KY00L999
.
KY00L900  MOVE      ONE,EXIT
KY00L999  RETURN
.---------------------------------------------------------
. Load WP files for : Indirect Budget Allocation Report  
.---------------------------------------------------------
WP00L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Indirect Budget Allocation Report  
.---------------------------------------------------------
LM00L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Indirect Budget Allocation Report  
.---------------------------------------------------------
DF00L000
          BRANCH   ACCEPT,DF00L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF00L900
          MATCH    PRGID,SCPSPID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF00L010 IF NOT EQUAL
.
          CALL     PS00L000 * Display Field
          GOTO     DF00L010
DF00L900
DF00L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Indirect Budget Allocation Report  
.---------------------------------------------------------
PS00L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS00L101,PS00L102,PS00L103,PS00L104:
                            PS00L105,PS00L106,PS00L107,PS00L999:
                            PS00L999,PS00L108,PS00L109,PS00L110:
                            PS00L999,PS00L111,PS00L112,PS00L113:
                            PS00L114
          GOTO     PS00L999
.
PS00L101
          MOVE      SAVEHCD,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L102
          MOVE      FROMYEAR,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L103
          MOVE      FROMPER,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L104
          CALL      CCCHC000
          MOVE      CCHCDES,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L105
          MOVE      CCCADES,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L106
          UNPACK    CCCAFDT,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L107
          UNPACK    CCCATDT,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L108
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      RDIRECT,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L109
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      RINDIR,FORM2     
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L110
          MOVE      FLAGALL,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L111
          MOVE      TOPER,VAR        
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L112
          MOVE      TOYEAR,VAR       
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L113
          MOVE      CCMACOM,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L114
          MOVE      CCMADES,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
PS00L999
          RETURN
.---------------------------------------------------------
. Selections for : Indirect Budget Allocation Report  
.---------------------------------------------------------
SF00L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF00L001  BRANCH   ACCEPT,SF00L020
.
SF00L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L101,SF00L102,SF00L103,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L104,SF00L105,SF00L106,SF00L006:
                            SF00L107,SF00L108,SF00L109,SF00L110:
                            SF00L006
SF00L006  BEEP
          GOTO     SF00L005
SF00L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF00L090
          MATCH    PRGID,SCSLPID
          GOTO     SF00L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF00L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L101,SF00L102,SF00L103,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L105,SF00L106,SF00L020:
                            SF00L020,SF00L108,SF00L109,SF00L110:
                            SF00L020
          GOTO     SF00L020
SF00L090  MOVE     ZERO,ACCEPT
          GOTO     SF00L001
.
SF00L101
          CALL      CCCHC000
.
.
          MOVE      "    4",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CCHCDES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KCCHCA00
          MOVE      CCHCHCD,SAVEHCD
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L101
            ENDIF
            BRANCH    EXIT,SF00L101,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      SAVEHCD,VAR      
          CALL      DISPITEM
          CALL      CCCHC000
.
.
          MOVE      "    4",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      CCHCDES,VAR      
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L102
          CALL      CCCACL00
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KCCCAB00
          MOVE      CCCAYEAR,FROMYEAR
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L102
            ENDIF
            BRANCH    EXIT,SF00L102,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      FROMYEAR,VAR     
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L103
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CCCADES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    6",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CCCAFDT 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CCCATDT 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KCCCAA00
          MOVE      CCCAPER,FROMPER
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L103
            ENDIF
            BRANCH    EXIT,SF00L103,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      FROMPER,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      CCCADES,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    6",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            UNPACK    CCCAFDT,CCENT,CYEAR,CMON,CDAY           
            CALL      PACDATE
            MOVE      CPCDATE,VAR
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            UNPACK    CCCATDT,CCENT,CYEAR,CMON,CDAY           
            CALL      PACDATE
            MOVE      CPCDATE,VAR
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L104
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L105
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,RDIRECT 
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      RDIRECT,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L106
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,RINDIR  
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      RINDIR,FORM2     
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L107
          CALL      CCICR000
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L108
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KCCCAA00
          MOVE      CCCAPER,TOPER
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L108
            ENDIF
            BRANCH    EXIT,SF00L108,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      TOPER,VAR        
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L109
          CALL      CCCACL00
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KCCCAB00
          MOVE      CCCAYEAR,TOYEAR
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L109
            ENDIF
            BRANCH    EXIT,SF00L109,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      TOYEAR,VAR       
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L110
.
.
          MOVE      "   17",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CCMADES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      ECMOD000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L110
            ENDIF
            BRANCH    EXIT,SF00L110,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      CCMACOM,VAR      
          CALL      DISPITEM
.
.
          MOVE      "   17",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      CCMADES,VAR      
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
SF00L990  MOVE      FOUR,EXIT * Exit Char Exit
SF00L999  RETURN
.@@@@@ Function Restart Point @@@@@
.----------------------------------------
. Move one to accept to for insert mode
.----------------------------------------
MVACCEPT  MOVE      ONE,ACCEPT
          RETURN
.-----------------------------------------------
. Clinical Costing Clear Fields for Keyin Year
.-----------------------------------------------
CCCACL00  MOVE      SP70,CCCAYEAR
          MOVE      SP70,CCCAPER
          RETURN
.
.----------------------------------------
. Check for All Hospital Display
.----------------------------------------
CCCHC000  MATCH     SP70,CCHCHCD
          IF        @EQUAL
            MOVE      "All Hospitals",CCHCDES
          ENDIF
          RETURN
.
.--------------------------------------------------
. Indirect Cost Allocation Reports
.--------------------------------------------------
CCICR000  MOVE      ZERO,FLAGALL
          CLOCK     TIME,CTIMEIS
          MATCH     SP70,SAVEHCD
          IF        @EQUAL
            MOVE      ONE,FLAGALL
          ENDIF
          DISPLAY   *P1:1;
          PACK      FILENAME,EXTMNAM,PORT
          REP       " 0",FILENAME
          PACK      MAKETMP,ISBUILD,FILENAME,EXTMIDX
          PACK      KILLTMP,ISERASE,FILENAME
          EXECUTE   KILLTMP,TASKID
          EXECUTE   MAKETMP,TASKID
          OPEN      EXTTMPA1,FILENAME
.
          IF        RDIRECT=0
            IF        RINDIR=0
              MOVE      "No Report Selected - ",DISPMSG
              CALL      MESSAGE1
              GOTO      CCICR999
            ENDIF
          ENDIF
          IF        RDIRECT=1
            DISPLAY   *P1:24,*EL,"Direct Department Report : "
            CALL      CCDDR000   * Direct Department Report
          ENDIF
          IF        RINDIR=1
            DISPLAY   *P1:24,*EL,"Indirect Department Report : "
            CALL      CCIDR000   * Indirect Department Report
          ENDIF
CCICR999  RETURN
.--------------------------------------------------
. Direct Department Allocation Report
.  "where its costs came from"
.--------------------------------------------------
CCDDR000  MOVE      ZERO,TOTAL
          PACK      KEY10,SAVEHCD,SP70
          CALL      RSCCDP1
          GOTO      CCDDR110
CCDDR100
          MOVE      "999,999,999.99",COST
          FEDIT     TOTAL,COST
          IF        !(TOTAL=0)
            PRINT     *119,"--------------"
            PRINT     *110,"Total",*119,COST
          ENDIF
          MOVE      ZERO,TOTAL
.
          PACK      KEY10,TOHCD,TODPT
          CALL      RDCCDP1
CCDDR110
          CALL      RKCCDP1
          BRANCH    OVRCD,CCDDR900
          IF        FLAGALL=0
            MATCH     SAVEHCD,CCDPHCD
            GOTO      CCDDR900 IF NOT EQUAL
          ENDIF
          DISPLAY   *P50:24,CCDPHCD,"/",CCDPDPT
          MATCH     "0",CCDPDTY
          GOTO      CCDDR110 IF NOT EQUAL
          MOVE      "99",CLNO
.
          MOVE      CCDPHCD,TOHCD
          MOVE      CCDPDPT,TODPT
.
          CALL      DEXT0000
          CALL      DPRT0000
          GOTO      CCDDR100
.
CCDDR900  CALL      UND132
          PRINT     *50,"**** End of Report ****"
          RETURN
.
DEXT0000
          MOVE      SP70,LASTDEPT
          PACK      KEY28,CCDPHCD,CCDPDPT,FROMYEAR,FROMPER,SP70
          PACK      KEY17,CCDPHCD,CCDPDPT,TOYEAR,TOPER,SP70
          CALL      RSCCMF2
DEXT1000  CALL      RKCCMF2
          BRANCH    OVRCD,DEXT9999
          PACK      KEY28,CCMFHCD,CCMFTDPT,CCMFYEAR,CCMFPER,SP70
          MATCH     KEY28,KEY17
          GOTO      DEXT1100 IF EQUAL
          GOTO      DEXT9999 IF LESS
DEXT1100  PACK      KEY16,CCMFFDPT,CCMFCTY,CCMFATY
          CALL      RDEXTM1
          IF        OVRCD=0
            ADD       CCMFAMT,EXTMAMT
            ADD       CCMFTWG,EXTMTWG
            ADD       CCMFWGT,EXTMWGT
            ADD       CCMFTOT,EXTMTOT
            ADD       ONE,EXTMCNT
            CALL      UPEXTM1
          ELSE
            UNPACK    KEY16,EXTMDPT,EXTMCTY,EXTMATY
            MOVE      CCMFAMT,EXTMAMT
            MOVE      CCMFTWG,EXTMTWG
            MOVE      CCMFWGT,EXTMWGT
            MOVE      CCMFTOT,EXTMTOT
            MOVE      ONE,EXTMCNT
            CALL      WREXTM1
          ENDIF
          GOTO      DEXT1000
.
DEXT9999  RETURN
.
DPRT0000  MOVE      SP70,LASTDEPT
          PACK      KEY16,SP70
          CALL      RSEXTM1
DPRT1000  CALL      RKEXTM1
          BRANCH    OVRCD,DPRT9999
          MATCH     LASTDEPT,EXTMDPT
          IF        !(@EQUAL)
            MOVE      EXTMDPT,LASTDEPT
            COMPARE   "58",CLNO
            CALL      HDIR0000 IF NOT LESS
            PACK      KEY10,TOHCD,EXTMDPT
            CALL      RDCCDP1
            PRINT     EXTMDPT,SP1,CCDPDES
            ADD       ONE,CLNO
          ENDIF
          COMPARE   "58",CLNO
          CALL      HDIRCONT IF NOT LESS
          MOVE      EXTMCTY,KEY4
          CALL      RDCCCT1
          MOVE      EXTMATY,KEY4
          CALL      RDCCAT1
.
          ASSIGN    EXTMWGT/EXTMTWG*100.0,FORM12P6
          MOVE      "9999.9999",PERCENT
          MOVE      FORM12P6,FORM4P4
          FEDIT     FORM4P4,PERCENT
.
          ASSIGN    EXTMAMT/EXTMTOT,FORM12P6
          MOVE      "99999.999999",FACTOR
          MOVE      FORM12P6,FORM5P6
          FEDIT     FORM5P6,FACTOR
.
          MOVE      EXTMWGT,PRT10P4
          MOVE      "999,999,999.99",COST
          FEDIT     EXTMAMT,COST
          ADD       EXTMAMT,TOTAL
.
          MOVE      CCCTDES,KEY25
          MOVE      CCATDES,KEY26
          PRINT     *13,CCCTCTY,SP1,KEY25,SP1,CCATATY,SP1,KEY26:
                    PRT10P4,SP4,PERCENT,SP1,FACTOR,SP3,COST
          ADD       ONE,CLNO
          PACK      KEY16,EXTMDPT,EXTMCTY,EXTMATY
          CALL      DEEXTM1
          GOTO      DPRT1000
DPRT9999  RETURN
.
HDIRCONT  CALL      HDIR0000
          PACK      KEY10,CCMFHCD,EXTMDPT
          CALL      RDCCDP1
          PRINT     EXTMDPT,SP1,CCDPDES," - Continued"
          ADD       ONE,CLNO
          RETURN
.
HDIR0000  PACK     KEY10,TOHCD,TODPT
          CALL     RDCCDP1
          MOVE     TOHCD,KEY2
          CALL     RDCCHC1
          CALL     HEAD132
          PRINT    "Hospital                 : ",CCHCHCD,SP7,CCHCDES:
                   *70,"From Year/Period  : ",FROMYEAR,"/",FROMPER
          PRINT    "Allocated to Department  : ",CCDPDPT,SP1,CCDPDES:
                   *70,"To   Year/Period  : ",TOYEAR,"/",TOPER
          CALL     UND132
          PRINT    "Department  Cost Type                      ":
                   "Allocation Type                      Weighting     ":
                   "Percent       Factor             Cost"
          CALL     UND132
          MOVE     "8",CLNO
          RETURN
.--------------------------------------------------
. Indirect Department Allocation Report
.  "where its costs went to"
.--------------------------------------------------
CCIDR000
          MOVE      ZERO,TOTAL
          PACK      KEY10,SAVEHCD,SP70
          CALL      RSCCDP1
          GOTO      CCIDR110
CCIDR100
          MOVE      "999,999,999.99",COST
          FEDIT     TOTAL,COST
          IF        !(TOTAL=0)
            PRINT     *119,"--------------"
            PRINT     *110,"Total",*119,COST
          ENDIF
          MOVE      ZERO,TOTAL
.
          PACK      KEY10,TOHCD,TODPT
          CALL      RDCCDP1
CCIDR110
          CALL      RKCCDP1
          BRANCH    OVRCD,CCIDR900
          IF        FLAGALL=0
            MATCH     SAVEHCD,CCDPHCD
            GOTO      CCIDR900 IF NOT EQUAL
          ENDIF
          DISPLAY   *P50:24,CCDPHCD,"/",CCDPDPT
.
          MATCH     "0",CCDPDTY
          GOTO      CCIDR110 IF EQUAL
          MOVE      "99",CLNO
          MOVE      CCDPHCD,TOHCD
          MOVE      CCDPDPT,TODPT
.
          CALL      IEXT0000
          CALL      IPRT0000
          GOTO      CCIDR100
.
CCIDR900  CALL      UND132
          PRINT     *50,"**** End of Report ****"
          RETURN
.
HINDCONT  CALL      HIND0000
          PACK      KEY10,CCMFHCD,EXTMDPT
          CALL      RDCCDP1
          PRINT     EXTMDPT,SP1,CCDPDES," - Continued"
          ADD       ONE,CLNO
          RETURN
.
HIND0000  PACK     KEY10,TOHCD,TODPT
          CALL     RDCCDP1
          MOVE     TOHCD,KEY2
          CALL     RDCCHC1
          CALL     HEAD132
          PRINT    "Hospital                   : ",CCHCHCD,SP7,CCHCDES:
                   *70,"From Year/Period  : ",FROMYEAR,"/",FROMPER
          PRINT    "Allocation From Department : ",CCDPDPT,SP1,CCDPDES:
                   *70,"To   Year/Period  : ",TOYEAR,"/",TOPER
          CALL     UND132
          PRINT    "Department  Cost Type                      ":
                   "Allocation Type                      Weighting     ":
                   "Percent       Factor             Cost"
          CALL     UND132
          MOVE     "8",CLNO
          RETURN
.
IEXT0000  MOVE      SP70,LASTDEPT
          PACK      KEY28,CCDPHCD,CCDPDPT,FROMYEAR,FROMPER,SP70
          PACK      KEY17,CCDPHCD,CCDPDPT,TOYEAR,TOPER,SP70
          CALL      RSCCMF1
IEXT1000  CALL      RKCCMF1
          BRANCH    OVRCD,IEXT9999
          PACK      KEY28,CCMFHCD,CCMFFDPT,CCMFYEAR,CCMFPER,SP70
          MATCH     KEY28,KEY17
          GOTO      IEXT1100 IF EQUAL
          GOTO      IEXT9999 IF LESS
IEXT1100  PACK      KEY16,CCMFTDPT,CCMFCTY,CCMFATY
          CALL      RDEXTM1
          IF        OVRCD=0
            ADD       CCMFAMT,EXTMAMT
            ADD       CCMFTWG,EXTMTWG
            ADD       CCMFWGT,EXTMWGT
            ADD       CCMFTOT,EXTMTOT
            ADD       ONE,EXTMCNT
            CALL      UPEXTM1
          ELSE
            UNPACK    KEY16,EXTMDPT,EXTMCTY,EXTMATY
            MOVE      CCMFAMT,EXTMAMT
            MOVE      CCMFTWG,EXTMTWG
            MOVE      CCMFWGT,EXTMWGT
            MOVE      CCMFTOT,EXTMTOT
            MOVE      ONE,EXTMCNT
            CALL      WREXTM1
          ENDIF
          GOTO      IEXT1000
.
IEXT9999  RETURN
.
IPRT0000  MOVE      SP70,LASTDEPT
          PACK      KEY16,SP70
          CALL      RSEXTM1
IPRT1000  CALL      RKEXTM1
          BRANCH    OVRCD,IPRT9999
          MATCH     LASTDEPT,EXTMDPT
          IF        !(@EQUAL)
            MOVE      EXTMDPT,LASTDEPT
            COMPARE   "58",CLNO
            CALL      HIND0000 IF NOT LESS
            PACK      KEY10,TOHCD,EXTMDPT
            CALL      RDCCDP1
            PRINT     EXTMDPT,SP1,CCDPDES
            ADD       ONE,CLNO
          ENDIF
          COMPARE   "58",CLNO
          CALL      HINDCONT IF NOT LESS
          MOVE      EXTMCTY,KEY4
          CALL      RDCCCT1
          MOVE      EXTMATY,KEY4
          CALL      RDCCAT1
.
          ASSIGN    EXTMWGT/EXTMTWG*100.0,FORM12P6
          MOVE      "9999.9999",PERCENT
          MOVE      FORM12P6,FORM4P4
          FEDIT     FORM4P4,PERCENT
.
          ASSIGN    EXTMAMT/EXTMTOT,FORM12P6
          MOVE      "99999.999999",FACTOR
          MOVE      FORM12P6,FORM5P6
          FEDIT     FORM5P6,FACTOR
.
          MOVE      EXTMWGT,PRT10P4
          MOVE      "999,999,999.99",COST
          FEDIT     EXTMAMT,COST
          ADD       EXTMAMT,TOTAL
.
          MOVE      CCCTDES,KEY25
          MOVE      CCATDES,KEY26
          PRINT     *13,CCCTCTY,SP1,KEY25,SP1,CCATATY,SP1,KEY26:
                    PRT10P4,SP4,PERCENT,SP1,FACTOR,SP3,COST
          ADD       ONE,CLNO
          PACK      KEY16,EXTMDPT,EXTMCTY,EXTMATY
          CALL      DEEXTM1
          GOTO      IPRT1000
IPRT9999  RETURN
ECMOD000  MOVE      ZERO,CKEYTYP
          CALL      CCSMOPCL    * Close Model
          CALL      KCCMAA00
          BRANCH    EXIT,ECMOD999,ECMOD999
.
          CALL      CCSMOPOP    * Open Model
          IF        EXIT=1
            MOVE      "Unable to Open Cost Model Files. - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      ECMOD000
          ENDIF
ECMOD999  RETURN
.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       CCSATYIO/INC
          INC       CCSCALIO/INC
          INC       CCSCALKY    
          INC       CCSCMAIO/INC
          INC       CCSCMAKY    
          INC       CCSCMBIO/INC
          INC       CCSCMCIO/INC
          INC       CCSCMDIO/INC
          INC       CCSCMEIO/INC
          INC       CCSCMFIO/INC
          INC       CCSCTYIO/INC
          INC       CCSDPTIO/INC
          INC       CCSEXTCD    
          INC       CCSHCDIO/INC
          INC       CCSHCDKY    
          INC       CCSMOPCD    
.
          INC       STDGENCD
.

.************************************************************************
.*  Procedure: DGCLIMWN  -  Send New Med. Warning  details              *
.*                                                                      *
.*  Author   : Steve Armstrong  (25/02/1998)                            *
.*                                                                      *
.*  Requires : Valid read on patmwsaf                                   *
.*             FORM1    -  (1=Add, 2=Delete)                            *
.*                                                                      *
.*  Mods     :                                                          *
.*  V9.02.02   13/12/2002  Tracey Nguyen  SRF 34292                     *
.*             a) Renamed DGCLIMWN to DGCLICMW.                         *
.*             b) Changed HLBMs variables to the new naming format in   *
.*                the HL7BMTFD.                                         *
.*             c) Removed WRHLBM1 and replaced with DGMESSID and        *
.*                DGHLSEND                                              * 
.*  V9.02.01   02/10/2001  Davin                                        *
.*             Mods to use message holding file                         *
.*                                                                      *
.************************************************************************
.
          DEFPROC   DGCLICMW
.
          INC       HL7BMTFD/INC
.
DGCLI000  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,TWENTY1;*138,PTCNNHII
          READ      CONTROLF,EIGHTY8;*55,PTCNDGMW
.
. Check if we are broadcasting medical warning messages and NHI is on
.
          IF        PTCNDGMW <> 1 | PTCNNHII <> 1
            GOTO      DGCLI999
          ENDIF
.
. Open the broadcast message holding table file
.
          OPEN      HL7BMTA1,"hl7bmtaf"
.
. Write message
.
          MOVE      "T",HLBMSTAT                 * Message Status
                                                 * "T" - to be processed
          MOVE      "CMW",HLBMTYPE               * Transaction Type
          MOVE      PTMWURNO,HLBMURNO            * U/R Number
          PACK      HLBMVISN,SP30                * Visit Number
          PACK      HLBMSPAR,SP30,SP30           * Spare variable
          MOVE      SP1,HLBMFLAG                 * Flag for CUA update
.
	  PACK      HLBMTKEY,PTMWURNO,PTMWCLSS,PTMWCNT,SP30,SP20
.
          CALL      DGMESSID                     * Get message ID, date & time
.
          CALL      DGHLSEND                     * Send the HL7 message
.
          CLOSE     HL7BMTA1                     
.
DGCLI999  GOTO      DGCLIEND                     * End Procedure
+
.
. IO Includes
. ===========
.
          INC       DGHLCOMN
          INC       HL7BMTIO/INC
          INC       IBAOVRIO/INC
.
+
DGCLIEND  ENDPROC
+

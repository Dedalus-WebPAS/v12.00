.-------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.00.00"
.-------------------------------------------------------
. V9.02.00  03.05.2002  Glenn Saunders
.           Export to new release i.e. v9.02 from vf.09
.-------------------------------------------------------
. VF.00.01  07.10.1999 Charles Handaya
.           Added export option
.-------------------------------------------------------
ACCSTAT0  INIT      "Open        "
ACCSTAT1  INIT      "Journal Only"
ACCSTAT2  INIT      "Closed      "
ACCALL    INIT      "All         "
SACSTAT0  INIT      "Open  "
SACSTAT1  INIT      "Jrnl. "
SACSTAT2  INIT      "Closed"
DACCTYPE  DIM       1
SVHBOT    FORM      2
SVHLEF    FORM      3
SVHRIG    FORM      3
SVHTOP    FORM      2
SP12      INIT      "            "
.
EXPORTFL  FILE      ASCII, FIXED=400     * Export File (Adjust Length to Suit)
EXPORTFN  DIM       8                    * Export File Name
TABDELM   EQU       0x09                 * Tab Delimiter
.-------------------------------------------------------
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBAFMS40
.   Function      :   Account Code Master Listing             
.   Generated  On :   13/12/2005
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       FMSAMADF    
          INC       FMSAMAFD/INC
          INC       FMSLMAFD/INC
.=========================
.Local Variable Definition
.-------------------------
FACCDESC  DIM      48 * Scr 00 Fld     6
FACCCODE  DIM      12 * Scr 00 Fld     7
TACCDESC  DIM      48 * Scr 00 Fld     8
TACCCODE  DIM      12 * Scr 00 Fld     9
ACCOTYPE  FORM      1 * Scr 00 Fld    10
ACCOSTAT  FORM      2 * Scr 00 Fld    11
EXPORTYN  FORM      1 * Scr 00 Fld    12
SDESSTAT  DIM       6 * Scr 00 Fld    15
ATYPDESC  DIM      12 * Scr 00 Fld    16
ASTADESC  DIM      12 * Scr 00 Fld    17
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBAFMS40"
PRGNAM    INIT      "Account Code Master Listing             "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          MOVE      PORT,PARENTID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      SC00L000
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          DISPLAY   *P56:24,"Opening fmsamaaf";
          OPEN      FMSAMAA1,"fmsamaaf"
          DISPLAY   *P56:24,"Opening fmsamaaf";
          OPEN      FMSAMAA2,"fmsamaaf"
          DISPLAY   *P56:24,"Opening fmsamaaf";
          OPEN      FMSAMAA3,"fmsamaaf"
          DISPLAY   *P56:24,"Opening fmsamaaf";
          OPEN      FMSAMAA4,"fmsamaaf"
          MOVE      "   51",AUDTSECT
          MOVE      " 43",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening fmsaudam";
            OPEN      FMSAUDAM,"fmsaudam"
          ENDIF
          MOVE      "   51",AUDTSECT
          MOVE      " 46",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening fmsaudla";
            OPEN      FMSAUDLA,"fmsaudla"
          ENDIF
          DISPLAY   *P56:24,"Opening  fmslmaaf           ";
          OPEN      FMSLMAA1,"fmslmaaf"          
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "00",SCRID
          IF         @EQUAL
            CALL       PS00L000   * Main Screen                        
          ENDIF
          RETURN
.--------------------------------
. Screen - Main Screen                        
.--------------------------------
SC00L000
SC00L100
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC00L200
          CALL      CF00L000 * Clear Fields
          CALL      MVACCEPT
SC00L300
          CALL      KY00L000 * Enter Key Fields
          BRANCH    EXIT,SC00L999,SC00L999
SC00L400
          CALL      WP00L000 * Load any WP Details
SC00L500
          CALL      LM00L000 * Load any Batch Details
SC00L600
          CALL      DF00L000 * Display Fields
SC00L700
          CALL      SF00L000 * Select Fields
          BRANCH    EXIT,SC00L100,SC00L100,SC00L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC00L800
SC00L900
SC00L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Main Screen                        
.-------------------------------------------------------
CF00L000
          MOVE      SP70,FMLALEDG
          MOVE      SP70,FMLADESC
          MOVE      SP70,FACCDESC
          MOVE      SP70,FACCCODE
          MOVE      SP70,TACCDESC
          MOVE      SP70,TACCCODE
          MOVE      ZERO,ACCOTYPE
          MOVE      ZERO,ACCOSTAT
          MOVE      ZERO,EXPORTYN
          MOVE      SP70,SDESSTAT
          MOVE      SP70,ATYPDESC
          MOVE      SP70,ASTADESC
CF00L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Main Screen                        
.--------------------------------------------------------
KY00L000
          MOVE      ZERO,EXIT
          GOTO      KY00L999
.
KY00L900  MOVE      ONE,EXIT
KY00L999  RETURN
.---------------------------------------------------------
. Load WP files for : Main Screen                        
.---------------------------------------------------------
WP00L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Main Screen                        
.---------------------------------------------------------
LM00L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Main Screen                        
.---------------------------------------------------------
DF00L000
          BRANCH   ACCEPT,DF00L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF00L900
          MATCH    PRGID,SCPSPID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF00L010 IF NOT EQUAL
.
          CALL     PS00L000 * Display Field
          GOTO     DF00L010
DF00L900
DF00L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Main Screen                        
.---------------------------------------------------------
PS00L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS00L999,PS00L999,PS00L999,PS00L101:
                            PS00L102,PS00L103,PS00L104,PS00L105:
                            PS00L106,PS00L107,PS00L108,PS00L109:
                            PS00L999,PS00L999,PS00L110,PS00L111:
                            PS00L112
          GOTO     PS00L999
.
PS00L101
          MOVE      FMLALEDG,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L102
          MOVE      FMLADESC,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L103
          MOVE      FACCDESC,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L104
          MOVE      FACCCODE,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L105
          MOVE      TACCDESC,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L106
          MOVE      TACCCODE,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L107
          MOVE      ACCOTYPE,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L108
          MOVE      ACCOSTAT,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L109
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      EXPORTYN,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L110
          MOVE      SDESSTAT,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L111
          MOVE      ATYPDESC,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L112
          MOVE      ASTADESC,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
PS00L999
          RETURN
.---------------------------------------------------------
. Selections for : Main Screen                        
.---------------------------------------------------------
SF00L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF00L001  BRANCH   ACCEPT,SF00L020
.
SF00L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L006,SF00L101,SF00L102,SF00L103:
                            SF00L006,SF00L104,SF00L006,SF00L006:
                            SF00L006,SF00L105,SF00L106,SF00L107:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006
SF00L006  BEEP
          GOTO     SF00L005
SF00L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF00L090
          MATCH    PRGID,SCSLPID
          GOTO     SF00L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF00L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L020,SF00L020,SF00L020,SF00L103:
                            SF00L020,SF00L104,SF00L020,SF00L020:
                            SF00L020,SF00L105,SF00L106,SF00L107:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020
          GOTO     SF00L020
SF00L090  MOVE     ZERO,ACCEPT
          GOTO     SF00L001
.
SF00L101
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L102
          CALL      REPT0000
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L103
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,FMLADESC
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KLED0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L103
            ENDIF
            BRANCH    EXIT,SF00L103,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      FMLALEDG,VAR     
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      FMLADESC,VAR     
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L104
.
.
          MOVE      "    8",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TACCDESC
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      FACC0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L104
            ENDIF
            BRANCH    EXIT,SF00L104,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      FACCDESC,VAR     
          CALL      DISPITEM
.
.
          MOVE      "    8",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TACCDESC,VAR     
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L105
.
.
          MOVE      "   16",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,ATYPDESC
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KTYP0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L105
            ENDIF
            BRANCH    EXIT,SF00L105,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      ACCOTYPE,VAR     
          CALL      DISPITEM
.
.
          MOVE      "   16",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      ATYPDESC,VAR     
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L106
.
.
          MOVE      "   17",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,ASTADESC
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KSTA0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L106
            ENDIF
            BRANCH    EXIT,SF00L106,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      ACCOSTAT,VAR     
          CALL      DISPITEM
.
.
          MOVE      "   17",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      ASTADESC,VAR     
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L107
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,EXPORTYN
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      EXPORTYN,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF00L001
SF00L990  MOVE      FOUR,EXIT * Exit Char Exit
SF00L999  RETURN
.@@@@@ Function Restart Point @@@@@
.----------------------------------------
. Move one to accept to for insert mode
.----------------------------------------
MVACCEPT  MOVE      ONE,ACCEPT
          RETURN
.--------------------------------------------------
. Process and Print Report
.--------------------------------------------------
REPT0000  MOVE      ACCOTYPE,DACCTYPE
.
          DISPLAY   *P1:24,*EL,"Printing :   ";
          MOVE      ZERO,CPAGENO            * reset page no.
          CLOCK     TIME,CTIMEIS            * get current time
          MOVE      "999",CLNO              * init last line number
.
          CALL      MKEXP000                * make export file
.
          MATCH     "0",DACCTYPE
          GOTO      REPT2000 IF NOT EQUAL
.
. 1st index
.
          PACK      KEY14,FMLALEDG,FACCCODE,SP70
          CALL      RDFMAM1
          BRANCH    OVRCD,REPT0100
          GOTO      REPT0200
.
REPT0100  CALL      RKFMAM1
          BRANCH    OVRCD,REPT3000
.
REPT0200  MATCH     FMLALEDG,FMAMLEDG
          GOTO      REPT3000 IF NOT EQUAL
.
          MATCH     FMAMACCT,TACCCODE
          GOTO      REPT3000 IF LESS
.
          COMPARE   THREE,ACCOSTAT          * All status ?
          GOTO      REPT0300 IF EQUAL       * yes
.
          COMPARE   FMAMSTAT,ACCOSTAT
          GOTO      REPT0100 IF NOT EQUAL
.
REPT0300  DISPLAY   *P14:24,*V2LON,FMAMLEDG,SLASH,FMAMACCT,*EL;
          CALL      PLIN0000
          GOTO      REPT0100
.
. 2nd index
.                                      ACCOTYPE = 0 (All Types)
REPT2000  IF        ACCOTYPE=0
            MOVE      SP1,DACCTYPE
          ENDIF
          PACK      KEY15,FMLALEDG,DACCTYPE,FACCCODE,SP70
          CALL      RDFMAM2
          BRANCH    OVRCD,REPT2100
          GOTO      REPT2200
.
REPT2100  CALL      RKFMAM2
          BRANCH    OVRCD,REPT3000
.
REPT2200  MATCH     FMLALEDG,FMAMLEDG
          GOTO      REPT3000 IF NOT EQUAL
.
          IF        ACCOTYPE<>0
            MATCH     DACCTYPE,FMAMTYPE
            GOTO      REPT3000 IF NOT EQUAL
          ENDIF
.
          MATCH     FMAMACCT,TACCCODE
          GOTO      REPT3000 IF LESS
.
          IF        ACCOSTAT<>3
            COMPARE   FMAMSTAT,ACCOSTAT
            GOTO      REPT2100 IF NOT EQUAL
          ENDIF
.
REPT2300  DISPLAY   *P14:24,*V2LON,FMAMLEDG,SLASH,FMAMACCT,*EL;
          CALL      PLIN0000
          GOTO      REPT2100
.
. Print end report
.
REPT3000  CALL      UND80                   * End of Report
          PRINT     *1,"*** End of Report ***"
          CALL      TREXP000                * Transfer file to PC
.
          MOVE      ZERO,EXIT
          GOTO      REPT9999
.
REPT9999  RETURN
.--------------------------------------------------
. Print Detail Line
.--------------------------------------------------
PLIN0000  COMPARE   "56",CLNO                    * end of page ?
          CALL      HEAD0000 IF NOT LESS         * start new page
.
          MOVE      ACCSTAT0,ASTADESC
          LOAD      ASTADESC,FMAMSTAT,ACCSTAT1,ACCSTAT2
.
          MOVE      SACSTAT0,SDESSTAT
          LOAD      SDESSTAT,FMAMSTAT,SACSTAT1,SACSTAT2
.
          MOVE      FMAMTYPE,F1
          MOVE      "Invalid Types  ",ATYPDESC
          LOAD      ATYPDESC,F1,ACCTYPE1,ACCTYPE2,ACCTYPE3:
                                ACCTYPE4,ACCTYPE5,ACCTYPE6:
                                ACCTYPE7,ACCTYPE8,ACCTYPE9
.
          PRINT     "|",*3,FMAMACCT,*16,"|",*18,FMAMDESC,*59,"|":
                    *61,ATYPDESC,*73,"|",SDESSTAT,*80,"|"
          ADD       ONE,CLNO
.
          CALL      WREXP000                     * Write to Export file
.
PLIN9999  RETURN
.--------------------------------------------------
. Print Header
.--------------------------------------------------
HEAD0000  CALL      HEAD80                  * print heading
.
          PRINT     "Ledger       : ",FMLALEDG,SP1,FMLADESC,*N:
                    "From Account : ",FACCDESC,*N:
                    "To   Account : ",TACCDESC
          CALL      UND80
          PRINT     "|",*3,"Account",*16,"|",*18,"Description":
                    *59,"|",*61,"Type",*73,"|",*75,"Stat.",*80,"|"
          CALL      UND80
          ADD       FOUR,CLNO
.
HEAD9999  RETURN
.----------------------------------------------------------------------
. File       : EXPORTxx
.
. Functions  : This file contains standard routines for
.              creating and transfering TAB delimited
.              export files to a PC using the unix script
.              keatran.
.
. Routines   : MKEXP000  - Create the Export File and Headings
.              WREXP000  - Write Export Record to File
.              TREXP000  - Transfer file to PC using script keatran
.
. Note       : The Variable EXPORTYN is used to determine if a
.              export file is to be created. 0=No, 1=Yes.
.
. Variables to be Declared
. ------------------------
. EXPORTFL  FILE      ASCII, FIXED=400     * Export File (Adjust Length to Suit)
. EXPORTFN  DIM       8                    * Export File Name
. TABDELM   EQU       0x09                 * Tab Delimiter
.----------------------------------------------------------------------
. Create Export File
.----------------------------------------------------------------------
MKEXP000  COMPARE  ONE,EXPORTYN
          GOTO     MKEXP999 IF NOT EQUAL
          MOVE     "EXPORT",KEY6
          PACK     EXPORTFN,KEY6,PORT
          REP      " 0",EXPORTFN
          PREP     EXPORTFL,EXPORTFN
          WRITE    EXPORTFL,SEQ;"Ledger/Account Code",TABDELM:
                                "Description",TABDELM:
                                "Account Type",TABDELM:
                                "Account Type Description",TABDELM:
                                "Account Status",TABDELM:
                                "Account Status Description"
MKEXP999  RETURN
.----------------------------------------------------------------------
. Write to Export File
.----------------------------------------------------------------------
WREXP000  COMPARE  ONE,EXPORTYN
          GOTO     WREXP999 IF NOT EQUAL
          WRITE    EXPORTFL,SEQ;FMAMLEDG,SLASH,FMAMACCT,TABDELM:
                                FMAMDESC,TABDELM:
                                FMAMTYPE,TABDELM:
                                ATYPDESC,TABDELM:
                                FMAMSTAT,TABDELM:
                                ASTADESC
WREXP999  RETURN
.----------------------------------------------------------------------
. Execute Transfer Script eg softerm
.----------------------------------------------------------------------
TREXP000  COMPARE  ONE,EXPORTYN
          GOTO     TREXP999 IF NOT EQUAL
..          MOVE     YES,DEFYESNO
          CLOSE    EXPORTFL
          DISPLAY  *P1:24,*EL,"Execute Transfer Now (":
                              *V2LON,"Y",*HOFF,"/":
                              *V2LON,"N",*HOFF,") ? "
          MOVE     "24",CVERT
          MOVE     "30",CCOL
          CALL     YORN0000
          COMPARE  ZERO,FYESNO
          GOTO     TREXP999 IF EQUAL        *  No Transfer
.
          MOVE     ZERO,HLEF
          CALL     GETSCR00
.
          CLEAR    KEY80
          APPEND   "keatran ",KEY80
          APPEND   EXPORTFN,KEY80
          APPEND   ".txt",KEY80
          RESET    KEY80
          EXECUTE  KEY80,TASKID
.
          CALL     PUTSCR00
.
          DISPLAY  *P1:24,*EL,"Transfer Completed Ok (":
                              *V2LON,"Y",*HOFF,"/":
                              *V2LON,"N",*HOFF,") ? "
          MOVE     "24",CVERT
          MOVE     "31",CCOL
          CALL     YORN0000
          COMPARE  ZERO,FYESNO
          GOTO     TREXP000 IF EQUAL        *  Not ok
.
          PREP     EXPORTFL,EXPORTFN
          CLOSE    EXPORTFL
.
TREXP999  RETURN
.
.--------------------------------------------------
. Keyin Ledger Code
.--------------------------------------------------
KLED0000  MOVE      SP2,FMAMLEDG
          CALL      KFMLAA00
          BRANCH    EXIT,KLED9900,KLED9900
          MOVE      FMLALEDG,FMAMLEDG
          GOTO      KLED9999
.
KLED9800  MOVE      ONE,EXIT                * remain on Screen
          MOVE      ZERO,ACCEPT
          GOTO      KLED9999
.
KLED9900  MOVE      TWO,EXIT                * exit out of Screen
          MOVE      ZERO,ACCEPT
          GOTO      KLED9999
.
KLED9999  RETURN
.
.--------------------------------------------------
. Keyin Range Account Code
.--------------------------------------------------
FACC0000  MOVE      "    6",FLDID
          CALL      GETPOSIT
          CALL      KFMAMA00
          BRANCH    EXIT,FACC0100,FACC9900
          MOVE      FMAMACCT,FACCCODE
          PACK      FACCDESC,FMAMACCT,SP1,FMAMDESC
          GOTO      FACC0140
FACC0100  MOVE      "Start                                           ",FACCDESC
          MOVE      SP70,FACCCODE
.
FACC0140  MOVE      FACCDESC,VAR
          CALL      DISPITEM
.
FACC0150  MOVE      "    8",FLDID
          CALL      GETPOSIT
.
          CALL      KFMAMA00
          BRANCH    EXIT,FACC0200,FACC9900
          MOVE      FMAMACCT,TACCCODE
          PACK      TACCDESC,FMAMACCT,SP1,FMAMDESC
          MATCH     FACCCODE,TACCCODE
          GOTO      FACC9999 IF EQUAL
          GOTO      FACC9999 IF NOT LESS
          BEEP
          MOVE      "To Account Type Must Be > From Account Type - ",DISPMSG
          CALL      MESSAGE1
          GOTO      FACC0000
.
FACC0200  MOVE      "Finish                                          ",TACCDESC
          MOVE      Z70,TACCCODE
          COMPARE   ZERO,ACCEPT
          GOTO      FACC9999 IF NOT EQUAL
.
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          GOTO      FACC9999
.
FACC9900  MOVE      TWO,EXIT                * exit out of Screen
          MOVE      ZERO,ACCEPT
          GOTO      FACC9999
.
FACC9999  RETURN
.
.--------------------------------------------------
. Keyin Account Type
.--------------------------------------------------
KTYP0000  CALL      GETSCR00
          CALL      DTY00000
KTYP0100  KEYIN     *PCCOL:CVERT,*V2LON,*RV,ACCOTYPE
.
          MOVE      ACCOTYPE,F1
          MOVE      ACCALL,ATYPDESC
          LOAD      ATYPDESC,F1,ACCTYPE1,ACCTYPE2,ACCTYPE3:
                                ACCTYPE4,ACCTYPE5,ACCTYPE6:
                                ACCTYPE7,ACCTYPE8,ACCTYPE9
          CALL      PUTSCR00
.
KTYP9999  RETURN
.--------------------------------------------------
. Display Account Type Selection Box
.--------------------------------------------------
DTY00000  MOVE      HTOP,SVHTOP
          MOVE      HLEF,SVHLEF
          MOVE      HBOT,SVHBOT
          MOVE      HRIG,SVHRIG
.
          MOVE      "9",HTOP
          MOVE      "55",HLEF
          MOVE      "22",HBOT
          MOVE      "79",HRIG
          CALL      GETSCR00
.
          BOXCLR    HLEF,HTOP,HRIG,HBOT
          BOX       16,HLEF,HTOP,HRIG,HBOT
          DISPLAY   *P57:10,*V2LON,*ULON,"Account Type",*HOFF:
                    *P57:11,*V2LON,"0. ",*HOFF,"All":
                    *P57:12,*V2LON,"1. ",*HOFF,ACCTYPE1:
                    *P57:13,*V2LON,"2. ",*HOFF,ACCTYPE2:
                    *P57:14,*V2LON,"3. ",*HOFF,ACCTYPE3:
                    *P57:15,*V2LON,"4. ",*HOFF,ACCTYPE4:
                    *P57:16,*V2LON,"5. ",*HOFF,ACCTYPE5:
                    *P57:17,*V2LON,"6. ",*HOFF,ACCTYPE6:
                    *P57:18,*V2LON,"7. ",*HOFF,ACCTYPE7:
                    *P57:19,*V2LON,"8. ",*HOFF,ACCTYPE8:
                    *P57:20,*V2LON,"9. ",*HOFF,ACCTYPE9
.
          MOVE      SVHTOP,HTOP
          MOVE      SVHLEF,HLEF
          MOVE      SVHBOT,HBOT
          MOVE      SVHRIG,HRIG
.
DTY99999  RETURN
.
.--------------------------------------------------
. Keyin Account Status
.--------------------------------------------------
KSTA0000  CALL      GETSCR00
          CALL      DST00000
KSTA0100  KEYIN     *PCCOL:CVERT,*V2LON,*RV,ACCOSTAT
          COMPARE   ZERO,ACCOSTAT
          GOTO      KSTA0100 IF LESS
.
          COMPARE   FOUR,ACCOSTAT
          GOTO      KSTA0100 IF NOT LESS
.
          MOVE      ACCSTAT0,ASTADESC
          LOAD      ASTADESC,ACCOSTAT,ACCSTAT1,ACCSTAT2,ACCALL
          CALL      PUTSCR00
.
KSTA9999  RETURN
.--------------------------------------------------
. Display Account Status Selection Box
.--------------------------------------------------
DST00000  MOVE      HTOP,SVHTOP
          MOVE      HLEF,SVHLEF
          MOVE      HBOT,SVHBOT
          MOVE      HRIG,SVHRIG
.
          MOVE      "11",HTOP
          MOVE      "55",HLEF
          MOVE      "17",HBOT
          MOVE      "79",HRIG
          CALL      GETSCR00
.
          BOXCLR    HLEF,HTOP,HRIG,HBOT
          BOX       16,HLEF,HTOP,HRIG,HBOT
          DISPLAY   *P57:12,*V2LON,*ULON,"Account Status",*HOFF:
                    *P57:13,*V2LON,"0. ",*HOFF,"Open":
                    *P57:14,*V2LON,"1. ",*HOFF,"Journal only":
                    *P57:15,*V2LON,"2. ",*HOFF,"Closed":
                    *P57:16,*V2LON,"3. ",*HOFF,"All"
.
          MOVE      SVHTOP,HTOP
          MOVE      SVHLEF,HLEF
          MOVE      SVHBOT,HBOT
          MOVE      SVHRIG,HRIG
.
DST99999  RETURN
.
.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       FMSAMAIO/INC
          INC       FMSAMAKY    
          INC       FMSLMAIO/INC
          INC       FMSLMAKY    
.
          INC       STDGENCD
.

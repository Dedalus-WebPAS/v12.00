.******************************************************************************
.* WRTHIS00 - Write to the Outpatient History
.******************************************************************************
WRTHIS00  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,SEVENTY9;*138,PTCNURHA
.
          COMPARE   ONE,PTCNURHA
          GOTO      WRTHIS99 IF NOT EQUAL
.
. ------- Check if anything has changed ---------------------------
.
          MATCH     SAOTPRIO,OBAPRTY
          GOTO      WRTHIS50 IF NOT EQUAL 
.
          MATCH     SAOTRANK,OTBBRANK
          GOTO      WRTHIS50 IF NOT EQUAL 
.
          GOTO      WRTHIS99          * No Changes
.
. ------- write a history record -----------------------
.
WRTHIS50  PACK      CFNAME,UID,FILHISA1
          OPEN      OUTHISA1,CFNAME     
          PACK      KEY8,CCC,CYY,CMM,CDD,SP10
          REP       " 0",KEY8
          PACK      KEY28,OBAURNO,OBAOUTNO,KEY8,Z70
          CALL      RSOTHIS1
          CALL      RPOTHIS1
          BRANCH    OVRCD,WRTHIS60
.
          MATCH     OBAURNO,OTHIURNO
          GOTO      WRTHIS60 IF NOT EQUAL
.
          MOVE      OBAOUTNO,DIM8
          MATCH     DIM8,OTHIEVNT
          GOTO      WRTHIS60 IF NOT EQUAL
.
          MATCH     KEY8,OTHIEDAT
          GOTO      WRTHIS60 IF NOT EQUAL
.
          ADD       ONE,OTHIUCNT
          GOTO      WRTHIS70
.
WRTHIS60  MOVE      OBAURNO,OTHIURNO
          MOVE      OBAOUTNO,OTHIEVNT
          PACK      OTHIEDAT,CCC,CYY,CMM,CDD,SP10
          REP       " 0",OTHIEDAT
          MOVE      ONE,OTHIUCNT
.
WRTHIS70  MOVE      OBAPRTY,OTHIPRIO
          MOVE      OTBBRANK,OTHIRANK
          PACK      OTHISPAR,SP20,SP20,SP20
.
          PACK      KEY28,OTHIURNO,OTHIEVNT,OTHIEDAT,OTHIUCNT,SP20
          CALL      RAOTHIS1
          IF        OVRCD=1
            CALL      WROTHIS1
          ENDIF
.
WRTHIS99  RETURN

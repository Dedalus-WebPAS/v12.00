.-------------------------------------------------------------------------------
.   System    :   FMS Accounting System  
.                           
.   Program   :   FMSLMBFM 
.                            
.   Routines  :   KLMBFM00 Keyin Report No.   - Returns a valid record
.                 ALMBFM00 Accept Report No.  - Returns a key NOT on file
.   
.   Return    :   EXIT = 1 null entry EXIT = 2 EXITCHAR entered
.
.   Uses      :   CODE as a save variable to ensure entry no affected by redisp
.
.   Internal  :   HFMLBA00 Help Display for Report No.  
.                            
.   Redisplay :   RLMBFM00 Screen Redisplay Called for Report No.  
.-------------------------------------------------------------------------------
.   Mods      :    
.-------------------------------------------------------------------------------
. Normal Code Keyin - Code Must Exist Exit = 1 if Null Entry
.-------------------------------------------------------------------------------
KLMBFM00  MOVE      UNDLN70,FMLBRPNO
          KEYIN     *PCCOL:CVERT,*EL,*DV,FMLBRPNO:
                    *PCCOL:CVERT,*V2LON,*JR,*ZF,FMLBRPNO:
                    *PCCOL:CVERT,*EL,*DV,FMLBRPNO
.
          ENDSET    FMLBRPNO
          APPEND    SP70,FMLBRPNO
          RESET     FMLBRPNO
          MATCH     SP70,FMLBRPNO             * System Code Spaces so exit set
          GOTO      KLMBFM90 IF EQUAL
.
          MATCH     "00",FMLBRPNO             * System Code Spaces so exit set
          GOTO      KLMBFM90 IF EQUAL
.
          UNPACK    FMLBRPNO,DIM1,ANS
.
          CMATCH    EXITCHAR,ANS              * Exit Selected
          GOTO      KLMBFM95 IF EQUAL
.
          MATCH     QUEST,ANS                 * Help Required  
          GOTO      KLMBFM10 IF NOT EQUAL
          CALL      HFMLBA00                  * Display List Of FMLBRPNOs
          PACK      CDATASAV,FMLBRPNO,SP70    * save data
          CALL      RLMBFM00                  * Redisplay Routine
          PACK      FMLBRPNO,CDATASAV,SP70    * restore data
.
          ENDSET    FMLBRPNO
          APPEND    SP70,FMLBRPNO
          RESET     FMLBRPNO
          MATCH     SP70,FMLBRPNO             * System Code Spaces so exit set
          GOTO      KLMBFM00 IF EQUAL
.
KLMBFM10  PACK      KEY2,FMLBRPNO
          CALL      RDFMLB1                                   
          BRANCH    OVRCD,KLMBFM80
          MOVE      ZERO,EXIT                 * no entry so exit is set
          GOTO      KLMBFM99
.
KLMBFM80  DISPLAY   *P1:24,*EL,*B,"Report No. Does Not Exist - ";
          CALL      HITENTER
          GOTO      KLMBFM00
.
KLMBFM90  MOVE      ONE,EXIT                  * null entry so exit is set
          GOTO      KLMBFM99
.
KLMBFM95  MOVE      TWO,EXIT                  * Exit character entered    
.
KLMBFM99  RETURN
.-------------------------------------------------------------------------------
. Accept Code Keyin - Code Must Not Exist 
.-------------------------------------------------------------------------------
ALMBFM00  MOVE      UNDLN70,FMLBRPNO
          KEYIN     *PCCOL:CVERT,*EL,*DV,FMLBRPNO:
                    *PCCOL:CVERT,*V2LON,*JR,*ZF,FMLBRPNO:
                    *PCCOL:CVERT,*EL,*DV,FMLBRPNO
.
          ENDSET    FMLBRPNO
          APPEND    SP70,FMLBRPNO
          RESET     FMLBRPNO
          MATCH     SP70,FMLBRPNO             * System Code Spaces so exit set
          GOTO      ALMBFM90 IF EQUAL
.
          MATCH     "00",FMLBRPNO             * System Code Spaces so exit set
          GOTO      ALMBFM90 IF EQUAL
.
          UNPACK    FMLBRPNO,DIM1,ANS
.
          CMATCH    EXITCHAR,ANS              * Exit Selected
          GOTO      ALMBFM95 IF EQUAL
.
          CMATCH    QUEST,ANS                 * Help Required  
          GOTO      ALMBFM10 IF NOT EQUAL
          CALL      HFMLBA00                  * Display List Of FMLBRPNOs
          PACK      CDATASAV,FMLBRPNO,SP70    * save data
          CALL      RLMBFM00                  * Redisplay Routine
          PACK      FMLBRPNO,CDATASAV,SP70    * restore data
.
          ENDSET    FMLBRPNO
          APPEND    SP70,FMLBRPNO
          RESET     FMLBRPNO
          MATCH     SP70,FMLBRPNO             * System Code Spaces so exit set
          GOTO      ALMBFM00 IF EQUAL
.
ALMBFM10  PACK      KEY2,FMLBRPNO
          MOVE      ZERO,EXIT                 * no entry so exit is set
          CALL      RDFMLB1                                   
          BRANCH    OVRCD,ALMBFM99
.
          DISPLAY   *P1:24,*EL,*B,"Report No. Already Exists - ";
          CALL      HITENTER
          GOTO      ALMBFM00
.
ALMBFM90  MOVE      ONE,EXIT                  * null entry so exit is set
          GOTO      ALMBFM99
.
ALMBFM95  MOVE      TWO,EXIT                  * Exit character entered    
.
ALMBFM99  RETURN
.------------------------------------------------------------------------------
. Display List of All Codes
.------------------------------------------------------------------------------
HFMLBA00
          MOVE      ZERO,CSCRSIZ
          IF        HTOP<3
            MOVE      "12",HTOP
            MOVE      "24",HBOT
            MOVE      "42",HLEF
            MOVE      "80",HRIG
          ENDIF
.
HFMLBA04  CALL      GSCRN000
          BRANCH    EXIT,HFMLBA99
          MOVE      STDCOL00,STDCOL01
          ADD       " 5",STDCOL01
          DISPLAY   *PSTDCOL01:STDROW,*V2LON,*ULON,"Report"             
.
          MOVE      STDCOL01,STDCOL02
          ADD       " 7",STDCOL02
          DISPLAY   *PSTDCOL02:STDROW,*V2LON,*ULON,"Description"        
.
          MOVE      STDCOL02,STDCOL03
          ADD       "36",STDCOL03
HFMLBA08
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          MOVE      SP70,FMLBRPNO
          PACK      KEY2,FMLBRPNO,SP70                                          
          CALL      RSFMLB1 
.
HFMLBA10  CALL      RKFMLB1 
          BRANCH    OVRCD,HFMLBA15
          PACK      KEY2,FMLBRPNO,SP70                                          
.                                                                               
.                                                                               
          BRANCH    CSEARCH,HFMLBA12
          CALL      HFMLBA60
          BRANCH    OVRCD,HFMLBA10
HFMLBA12
          ADD       ONE,XITEMNO
          ADD       ONE,STDROW
          STORE     KEY2,XITEMNO,ST1,ST2,ST3,ST4,ST5:                            
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          DISPLAY   *PSTDCOL00:STDROW,SP1,*V2LON,XITEMNO,DOT
          DISPLAY   *PSTDCOL01:STDROW,FMLBRPNO
          DISPLAY   *PSTDCOL02:STDROW,FMLBDESC
          COMPARE   MAXITEM,XITEMNO
          GOTO      HFMLBA10 IF NOT EQUAL
HFMLBA15
.                                                                               
          MOVE      ONE,DITEM
          MOVE      MINITEM,DROW
          ADD       ONE,DROW
          DISPLAY   *PSTDCOL00:DROW,*V2LON,*HON,SP1,DITEM,DOT
          CLIP
          FLUSH     HLEF,HTOP,HRIG,HBOT
.
HFMLBA20
          CALL      HSCRI000
          BRANCH    EXIT,HFMLBA30,HFMLBA35,HFMLBA40,HFMLBA45,HFMLBA04:
                              HFMLBA91,HFMLBA50
          GOTO      HFMLBA92
HFMLBA30
          CALL      RKFMLB1 
          BRANCH    OVRCD,HFMLBA85
          PACK      KEY2,FMLBRPNO,SP70                                          
.                                                                               
.                                                                               
          CALL      RPFMLB1 
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMLBA10
HFMLBA35
          MOVE      ST1,KEY2 
          CALL      RDFMLB1 
          CALL      RPFMLB1 
          BRANCH    OVRCD,HFMLBA85
          PACK      KEY2,FMLBRPNO,SP70                                          
.                                                                               
.                                                                               
.                                                                               
.                                                                               
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
HFMLBA36
          CALL      RPFMLB1 
          BRANCH    OVRCD,HFMLBA37
          PACK      KEY2,FMLBRPNO,SP70                                          
.                                                                               
.                                                                               
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HFMLBA36 IF NOT EQUAL
HFMLBA37
          MOVE      ZERO,XITEMNO
          GOTO      HFMLBA10
HFMLBA40
          MOVE      ST1,KEY2 
          CALL      RDFMLB1 
          CALL      RPFMLB1 
          BRANCH    OVRCD,HFMLBA85
          PACK      KEY2,FMLBRPNO,SP70                                          
.                                                                               
.                                                                               
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMLBA08
HFMLBA45
          CALL      RKFMLB1 
          BRANCH    OVRCD,HFMLBA85
          PACK      KEY2,FMLBRPNO,SP70                                          
.                                                                               
.                                                                               
          SUSPEND
          CLIP      1,1,CRIG,24
.
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      ZERO,XITEMNO
          PACK      KEY2,Z70                                                    
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
          CALL      RSFMLB1 
HFMLBA46
          CALL      RPFMLB1 
          BRANCH    OVRCD,HFMLBA47
          PACK      KEY2,FMLBRPNO,SP70
.                                                                               
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HFMLBA46 IF NOT EQUAL
HFMLBA47
          MOVE      ZERO,XITEMNO
          GOTO      HFMLBA10
HFMLBA50  COMPARE   ZERO,CSEARCH
          GOTO      HFMLBA55 IF EQUAL
          MOVE      ZERO,CSEARCH
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          ADD       ONE,STDROW
          UNPACK    SP70,SCHFLD01,SCHFLD02,SCHFLD03,SCHFLD04,SCHFLD05
          UNPACK    SP70,SCHFLD06,SCHFLD07,SCHFLD08,SCHFLD09,SCHFLD10
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          DISPLAY   *PSTDCOL00:STDROW,*V2LON,*HON,"Sch"
          KEYIN     *PSTDCOL01:STDROW,*V2LON,SCHFLD01
          RESET     SCHFLD01
          KEYIN     *PSTDCOL02:STDROW,*V2LON,SCHFLD02
          RESET     SCHFLD02
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMLBA08
HFMLBA55  MOVE      ONE,CSEARCH
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMLBA08
HFMLBA60  MOVE      ZERO,OVRCD
          MATCH     SP70,SCHFLD01
          GOTO      HFMLBA61 IF EQUAL
          MATCH     SCHFLD01,FMLBRPNO
          GOTO      HFMLBA72 IF NOT EQUAL
HFMLBA61
          MATCH     SP70,SCHFLD02
          GOTO      HFMLBA62 IF EQUAL
          MATCH     SCHFLD02,FMLBDESC
          GOTO      HFMLBA72 IF NOT EQUAL
HFMLBA62
HFMLBA63
HFMLBA64
HFMLBA65
HFMLBA66
HFMLBA67
HFMLBA68
HFMLBA69
HFMLBA70
          GOTO      HFMLBA75
HFMLBA72  MOVE      ONE,OVRCD
HFMLBA75  RETURN
HFMLBA85
          LOAD      KEY2,XITEMNO,ST1,ST2,ST3,ST4,ST5:                            
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY2,FMLBRPNO                                               
          CALL      RDFMLB1 
HFMLBA90
.                                                                               
          BEEP
          GOTO      HFMLBA20
HFMLBA91
          MOVE      SP70,FMLBDESC
          MOVE      SP70,FMLBACUI
          MOVE      ZERO,FMLBBUUI
          MOVE      SP70,FMLBSPAR 
          MOVE      SP70,KEY2 
          MOVE      SP70,FMLBRPNO
          GOTO      HFMLBA96
HFMLBA92
          MOVE      SP70,KEY2 
          MOVE      SP70,FMLBRPNO
          LOAD      KEY2,CCITEM,ST1,ST2,ST3,ST4,ST5:                            
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY2,FMLBRPNO                                               
HFMLBA96
          PUTSCR    CSSCRNUM,HLEF,HTOP,HRIG,HBOT
          CALL      FRESCR00
          MOVE      ZERO,HTOP
          MOVE      ZERO,HLEF
          MOVE      ZERO,HBOT
          MOVE      ZERO,HRIG
HFMLBA99
          RETURN



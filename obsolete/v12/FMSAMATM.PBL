.------------------------------------------------------------
. Add Field
.------------------------------------------------------------
FMSA0000  BRANCH    FLDITMNO,FMSA0100,FMSA0200,FMSA0300,FMSA0400,FMSA0500:
                             FMSA0600,FMSA0700,FMSA0800,FMSA0900,FMSA1000:
                             FMSA1100,FMSA1200,FMSA1300,FMSA1400,FMSA1500:
                             FMSA1600,FMSA1700,FMSA1800,FMSA1900,FMSA2000:
                             FMSA2100,FMSA2200,FMSA2300,FMSA2400,FMSA2500:
                             FMSA2600,FMSA2700
.
FMSA0100  MOVE      ACCTKEYS,KEY14
          CALL      SETACC00
          REP       " +",FMTACCT
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      PERIODNO,KEY2
          REP       " 0",KEY2
          WRITE     HTMLFILE;"fmsweb04.pbl?reportno=1":
                                 "&template=",FLDPARA:
                                 "&fincyear=",CURYEAR:
                                 "&fincperd=",KEY2:
                                 "&acctkeys=",FMTACCT;
          GOTO      FMSA9999
.
FMSA0200  MOVE      ACCTKEYS,KEY14
          CALL      SETACC00
          REP       " +",FMTACCT
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      FMAMTYPE,F1
          IF        F1<6
            MOVE      PERIODNO,KEY2
            REP       " 0",KEY2
            WRITE     HTMLFILE;"fmsweb02.pbl?reportno=1":
                                   "&template=",FLDPARA:
                                   "&fincyear=",CURYEAR:
                                   "&fincperd=",KEY2:
                                   "&acctkeys=",FMTACCT;
          ENDIF
          GOTO      FMSA9999
.
FMSA0300  MOVE      ACCTKEYS,KEY14
          CALL      SETACC00
          REP       " +",FMTACCT
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      FMAMTYPE,F1
          IF        F1<6
            MOVE      PERIODNO,KEY2
            REP       " 0",KEY2
            WRITE     HTMLFILE;"fmsweb02.pbl?reportno=2":
                                   "&template=",FLDPARA:
                                   "&fincyear=",CURYEAR:
                                   "&fincperd=",KEY2:
                                   "&acctkeys=",FMTACCT;
          ENDIF
          GOTO      FMSA9999
.
FMSA0400  WRITE     HTMLFILE;FMAMLEDG;
          GOTO      FMSA9999
.
FMSA0500  WRITE     HTMLFILE;FMAMACCT;
          GOTO      FMSA9999
.
FMSA0600  CLEAR     DISPNAME
          MOVE      FMAMDESC,NAME35
          CALL      NAMSTR00
          RESET     DISPNAME
          WRITE     HTMLFILE;DISPNAME;
          GOTO      FMSA9999
.
FMSA0700  MOVE      FMAMTYPE,F1
          BRANCH    F1,FMSA0710,FMSA0720,FMSA0730,FMSA0740,FMSA0750:
                       FMSA0760,FMSA0770,FMSA0780,FMSA0790
FMSA0710  WRITE     HTMLFILE;"Income";
          GOTO      FMSA9999
FMSA0720  WRITE     HTMLFILE;"Expense";
          GOTO      FMSA9999
FMSA0730  WRITE     HTMLFILE;"Asset";
          GOTO      FMSA9999
FMSA0740  WRITE     HTMLFILE;"Liability";
          GOTO      FMSA9999
FMSA0750  WRITE     HTMLFILE;"Equity";
          GOTO      FMSA9999
FMSA0760  WRITE     HTMLFILE;"Total";
          GOTO      FMSA9999
FMSA0770  WRITE     HTMLFILE;"Heading";
          GOTO      FMSA9999
FMSA0780  WRITE     HTMLFILE;"Statistic";
          GOTO      FMSA9999
FMSA0790  WRITE     HTMLFILE;"Calculated Statistic";
          GOTO      FMSA9999
.
FMSA0800  WRITE     HTMLFILE;CURYEAR;
          GOTO      FMSA9999
.
FMSA0900  MOVE      PERIODNO,F2
          LOAD      PERNAME,F2,FMLC01DE,FMLC02DE,FMLC03DE,FMLC04DE,FMLC05DE:
                               FMLC06DE,FMLC07DE,FMLC08DE,FMLC09DE,FMLC10DE:
                               FMLC11DE,FMLC12DE
          WRITE     HTMLFILE;PERNAME;
          GOTO      FMSA9999
.
FMSA1000  UNPACK    DIM127,D1,ACCTKEYS,DIM127
          PACK      KEY14,ACCTKEYS,SP70
          CALL      RDFMAM1
          BRANCH    OVRCD,FMSA9999
.
          CALL      FINDET00   * Get Financial Data
.
          GOTO      FMSA9999
.
FMSA1100  UNPACK    DIM127,D1,FLDPARA,DIM127
          CALL      ACTAMT00
          CALL      OUTAMT00
          GOTO      FMSA9999
.
FMSA1200  UNPACK    DIM127,D1,FLDPARA,DIM127
          CALL      LYRAMT00
          CALL      OUTAMT00
          GOTO      FMSA9999
.
FMSA1300  UNPACK    DIM127,D1,FLDPARA,DIM127
          CALL      BUDAMT00
          CALL      OUTAMT00
          GOTO      FMSA9999
.
FMSA1400  UNPACK    DIM127,D1,FLDPARA,DIM127
          CALL      ALTAMT00
          CALL      OUTAMT00
          GOTO      FMSA9999
.
FMSA1500  UNPACK    DIM127,D1,DSETNUM,DIM127
          MOVE      FMLC01DE,MTH301
          MOVE      FMLC02DE,MTH302
          MOVE      FMLC03DE,MTH303
          MOVE      FMLC04DE,MTH304
          MOVE      FMLC05DE,MTH305
          MOVE      FMLC06DE,MTH306
          MOVE      FMLC07DE,MTH307
          MOVE      FMLC08DE,MTH308
          MOVE      FMLC09DE,MTH309
          MOVE      FMLC10DE,MTH310
          MOVE      FMLC11DE,MTH311
          MOVE      FMLC12DE,MTH312
          MOVE      FMLC13DE,MTH313
          WRITE     HTMLFILE;" <param name=dataset",DSETNUM:
                             "Labels value=#"":
                             MTH301,COMMA,MTH302,COMMA,MTH303,COMMA:
                             MTH304,COMMA,MTH305,COMMA,MTH306,COMMA:
                             MTH307,COMMA,MTH308,COMMA,MTH309,COMMA:
                             MTH310,COMMA,MTH311,COMMA,MTH312;
          SUB       LYRABF,LYRA01
          IF        FMLAPERS=1
            WRITE     HTMLFILE;COMMA,MTH313;
          ENDIF
          WRITE     HTMLFILE;"#">"
          GOTO      FMSA9999
.
FMSA1600  UNPACK    DIM127,D1,DSETNUM,DIM127
          CALL      LNKREF00
          GOTO      FMSA9999
.
FMSA1700  UNPACK    DIM127,D1,DSETNUM,DSETAXIS,DIM127
          ADD       CURABF,CURA01
          CALL      IMCURA00
          WRITE     HTMLFILE;" <param name=dataset",DSETNUM,DSETAXIS:
                             "Values value=#"":
                             CURA01,COMMA,CURA02,COMMA,CURA03,COMMA:
                             CURA04,COMMA,CURA05,COMMA,CURA06,COMMA:
                             CURA07,COMMA,CURA08,COMMA,CURA09,COMMA:
                             CURA10,COMMA,CURA11,COMMA,CURA12;
          IF        FMLAPERS=1
            WRITE     HTMLFILE;COMMA,CURA13;
          ENDIF
          WRITE     HTMLFILE;"#">"
          CALL      IMCURA00
          SUB       CURABF,CURA01
          GOTO      FMSA9999
.
FMSA1800  UNPACK    DIM127,D1,DSETNUM,DSETAXIS,DIM127
          ADD       LYRABF,LYRA01
          CALL      IMLYRA00
          WRITE     HTMLFILE;" <param name=dataset",DSETNUM,DSETAXIS:
                             "Values value=#"":
                             LYRA01,COMMA,LYRA02,COMMA,LYRA03,COMMA:
                             LYRA04,COMMA,LYRA05,COMMA,LYRA06,COMMA:
                             LYRA07,COMMA,LYRA08,COMMA,LYRA09,COMMA:
                             LYRA10,COMMA,LYRA11,COMMA,LYRA12;
          IF        FMLAPERS=1
            WRITE     HTMLFILE;COMMA,LYRA13;
          ENDIF
          WRITE     HTMLFILE;"#">"
          SUB       LYRABF,LYRA01
          CALL      IMLYRA00
          GOTO      FMSA9999
.
FMSA1900  UNPACK    DIM127,D1,DSETNUM,DSETAXIS,DIM127
          CALL      IMCURB00
          WRITE     HTMLFILE;" <param name=dataset",DSETNUM,DSETAXIS:
                             "Values value=#"":
                             CURB01,COMMA,CURB02,COMMA,CURB03,COMMA:
                             CURB04,COMMA,CURB05,COMMA,CURB06,COMMA:
                             CURB07,COMMA,CURB08,COMMA,CURB09,COMMA:
                             CURB10,COMMA,CURB11,COMMA,CURB12;
          IF        FMLAPERS=1
            WRITE     HTMLFILE;COMMA,CURB13;
          ENDIF
          WRITE     HTMLFILE;"#">"
          CALL      IMCURB00
          GOTO      FMSA9999
.
FMSA2000  UNPACK    DIM127,D1,DSETNUM,DSETAXIS,DIM127
          CALL      IMLYRB00
          WRITE     HTMLFILE;" <param name=dataset",DSETNUM,DSETAXIS:
                             "Values value=#"":
                             LYRB01,COMMA,LYRB02,COMMA,LYRB03,COMMA:
                             LYRB04,COMMA,LYRB05,COMMA,LYRB06,COMMA:
                             LYRB07,COMMA,LYRB08,COMMA,LYRB09,COMMA:
                             LYRB10,COMMA,LYRB11,COMMA,LYRB12;
          IF        FMLAPERS=1
            WRITE     HTMLFILE;COMMA,LYRB13;
          ENDIF
          WRITE     HTMLFILE;"#">"
          CALL      IMLYRB00
          GOTO      FMSA9999
.
FMSA2100  UNPACK    DIM127,D1,DSETNUM,DSETAXIS,KEY2,DIM127
          MOVE      KEY2,NUMPER
          CALL      ACTDAT00
          GOTO      FMSA9999
.
FMSA2200  UNPACK    DIM127,D1,DSETNUM,DSETAXIS,KEY2,DIM127
          MOVE      KEY2,NUMPER
          CALL      BUDDAT00
          GOTO      FMSA9999
.
FMSA2300  UNPACK    DIM127,D1,DSETNUM,KEY2,DIM127
          MOVE      KEY2,NUMPER
          CALL      NAMDAT00
          GOTO      FMSA9999
.
FMSA2400  UNPACK    DIM127,D1,DSETNUM,KEY2,DIM127
          MOVE      KEY2,NUMPER
          CALL      LNKDAT00
          GOTO      FMSA9999
.
FMSA2500  MOVE      ZERO,LASTCOL
          CALL      FMTABA00
          GOTO      FMSA9999
.
FMSA2600  WRITE     HTMLFILE;PERIODNO;
          GOTO      FMSA9999
.
FMSA2700  MOVE      ONE,LASTCOL
          CALL      FMTABA00
          GOTO      FMSA9999
.
FMSA9999  RETURN
.
IMCURA00  MULT      INCOMEFL,CURA01
          MULT      INCOMEFL,CURA02
          MULT      INCOMEFL,CURA03
          MULT      INCOMEFL,CURA04
          MULT      INCOMEFL,CURA05
          MULT      INCOMEFL,CURA06
          MULT      INCOMEFL,CURA07
          MULT      INCOMEFL,CURA08
          MULT      INCOMEFL,CURA09
          MULT      INCOMEFL,CURA10
          MULT      INCOMEFL,CURA11
          MULT      INCOMEFL,CURA12
          MULT      INCOMEFL,CURA13
          RETURN
.
IMCURB00  MULT      INCOMEFL,CURB01
          MULT      INCOMEFL,CURB02
          MULT      INCOMEFL,CURB03
          MULT      INCOMEFL,CURB04
          MULT      INCOMEFL,CURB05
          MULT      INCOMEFL,CURB06
          MULT      INCOMEFL,CURB07
          MULT      INCOMEFL,CURB08
          MULT      INCOMEFL,CURB09
          MULT      INCOMEFL,CURB10
          MULT      INCOMEFL,CURB11
          MULT      INCOMEFL,CURB12
          MULT      INCOMEFL,CURB13
          RETURN
.
IMLYRA00  MULT      INCOMEFL,LYRA01
          MULT      INCOMEFL,LYRA02
          MULT      INCOMEFL,LYRA03
          MULT      INCOMEFL,LYRA04
          MULT      INCOMEFL,LYRA05
          MULT      INCOMEFL,LYRA06
          MULT      INCOMEFL,LYRA07
          MULT      INCOMEFL,LYRA08
          MULT      INCOMEFL,LYRA09
          MULT      INCOMEFL,LYRA10
          MULT      INCOMEFL,LYRA11
          MULT      INCOMEFL,LYRA12
          MULT      INCOMEFL,LYRA13
          RETURN
.
IMLYRB00  MULT      INCOMEFL,LYRB01
          MULT      INCOMEFL,LYRB02
          MULT      INCOMEFL,LYRB03
          MULT      INCOMEFL,LYRB04
          MULT      INCOMEFL,LYRB05
          MULT      INCOMEFL,LYRB06
          MULT      INCOMEFL,LYRB07
          MULT      INCOMEFL,LYRB08
          MULT      INCOMEFL,LYRB09
          MULT      INCOMEFL,LYRB10
          MULT      INCOMEFL,LYRB11
          MULT      INCOMEFL,LYRB12
          MULT      INCOMEFL,LYRB13
          RETURN
.------------------------------------------------------------
. A Individual Current Year Amount
.------------------------------------------------------------
ACTAMT00  MOVE      FLDPARA,F3
          IF        F3=14
            MOVE      PERIODNO,F3
          ENDIF
          IF        F3=15
            ASSIGN    100+PERIODNO,F3
          ENDIF
          IF        F3<100
            MOVE      CURABF,F12P5
            LOAD      F12P5,F3,CURA01,CURA02,CURA03,CURA04,CURA05:
                               CURA06,CURA07,CURA08,CURA09,CURA10:
                               CURA11,CURA12,CURA13
            GOTO      ACTAMT99
          ENDIF
          MOVE      ZERO,F12P5
          SUB       "100",F3
          BRANCH    F3,ACTAMT01,ACTAMT02,ACTAMT03,ACTAMT04,ACTAMT05:
                       ACTAMT06,ACTAMT07,ACTAMT08,ACTAMT09,ACTAMT10:
                       ACTAMT11,ACTAMT12,ACTAMT13
ACTAMT01  ASSIGN    CURABF+CURA01,F12P5
          GOTO      ACTAMT90
ACTAMT02  ASSIGN    CURABF+CURA01+CURA02,F12P5
          GOTO      ACTAMT90
ACTAMT03  ASSIGN    CURABF+CURA01+CURA02+CURA03,F12P5
          GOTO      ACTAMT90
ACTAMT04  ASSIGN    CURABF+CURA01+CURA02+CURA03+CURA04,F12P5
          GOTO      ACTAMT90
ACTAMT05  ASSIGN    CURABF+CURA01+CURA02+CURA03+CURA04+CURA05,F12P5
          GOTO      ACTAMT90
ACTAMT06  ASSIGN    CURABF+CURA01+CURA02+CURA03+CURA04+CURA05+CURA06,F12P5
          GOTO      ACTAMT90
ACTAMT07  ASSIGN    CURABF+CURA01+CURA02+CURA03+CURA04+CURA05+CURA06,F12P5
          ASSIGN    F12P5+CURA07,F12P5
          GOTO      ACTAMT90
ACTAMT08  ASSIGN    CURABF+CURA01+CURA02+CURA03+CURA04+CURA05+CURA06,F12P5
          ASSIGN    F12P5+CURA07+CURA08,F12P5
          GOTO      ACTAMT90
ACTAMT09  ASSIGN    CURABF+CURA01+CURA02+CURA03+CURA04+CURA05+CURA06,F12P5
          ASSIGN    F12P5+CURA07+CURA08+CURA09,F12P5
          GOTO      ACTAMT90
ACTAMT10  ASSIGN    CURABF+CURA01+CURA02+CURA03+CURA04+CURA05+CURA06,F12P5
          ASSIGN    F12P5+CURA07+CURA08+CURA09+CURA10,F12P5
          GOTO      ACTAMT90
ACTAMT11  ASSIGN    CURABF+CURA01+CURA02+CURA03+CURA04+CURA05+CURA06,F12P5
          ASSIGN    F12P5+CURA07+CURA08+CURA09+CURA10+CURA11,F12P5
          GOTO      ACTAMT90
ACTAMT12  ASSIGN    CURABF+CURA01+CURA02+CURA03+CURA04+CURA05+CURA06,F12P5
          ASSIGN    F12P5+CURA07+CURA08+CURA09+CURA10+CURA11+CURA12,F12P5
          GOTO      ACTAMT90
ACTAMT13  ASSIGN    CURABF+CURA01+CURA02+CURA03+CURA04+CURA05+CURA06,F12P5
          ASSIGN    F12P5+CURA07+CURA08+CURA09+CURA10+CURA11+CURA12+CURA13,F12P5
          GOTO      ACTAMT90
ACTAMT90  MOVE      FMAMTYPE,F1
          IF        F1=9|F1=8
            IF        FMAMAYTD=1
              DIV       F3,F12P5
            ENDIF
          ENDIF   
ACTAMT99  RETURN
.------------------------------------------------------------
. A Individual Last Year Amount
.------------------------------------------------------------
LYRAMT00  MOVE      FLDPARA,F3
          IF        F3=14
            MOVE      PERIODNO,F3
          ENDIF
          IF        F3=15
            ASSIGN    100+PERIODNO,F3
          ENDIF
          IF        F3<100
            MOVE      LYRABF,F12P5
            LOAD      F12P5,F3,LYRA01,LYRA02,LYRA03,LYRA04,LYRA05:
                               LYRA06,LYRA07,LYRA08,LYRA09,LYRA10:
                               LYRA11,LYRA12,LYRA13
            GOTO      LYRAMT99
          ENDIF
          MOVE      ZERO,F12P5
          SUB       "100",F3
          BRANCH    F3,LYRAMT01,LYRAMT02,LYRAMT03,LYRAMT04,LYRAMT05:
                       LYRAMT06,LYRAMT07,LYRAMT08,LYRAMT09,LYRAMT10:
                       LYRAMT11,LYRAMT12,LYRAMT13
LYRAMT01  ASSIGN    LYRABF+LYRA01,F12P5
          GOTO      LYRAMT90
LYRAMT02  ASSIGN    LYRABF+LYRA01+LYRA02,F12P5
          GOTO      LYRAMT90
LYRAMT03  ASSIGN    LYRABF+LYRA01+LYRA02+LYRA03,F12P5
          GOTO      LYRAMT90
LYRAMT04  ASSIGN    LYRABF+LYRA01+LYRA02+LYRA03+LYRA04,F12P5
          GOTO      LYRAMT90
LYRAMT05  ASSIGN    LYRABF+LYRA01+LYRA02+LYRA03+LYRA04+LYRA05,F12P5
          GOTO      LYRAMT90
LYRAMT06  ASSIGN    LYRABF+LYRA01+LYRA02+LYRA03+LYRA04+LYRA05+LYRA06,F12P5
          GOTO      LYRAMT90
LYRAMT07  ASSIGN    LYRABF+LYRA01+LYRA02+LYRA03+LYRA04+LYRA05+LYRA06,F12P5
          ASSIGN    F12P5+LYRA07,F12P5
          GOTO      LYRAMT90
LYRAMT08  ASSIGN    LYRABF+LYRA01+LYRA02+LYRA03+LYRA04+LYRA05+LYRA06,F12P5
          ASSIGN    F12P5+LYRA07+LYRA08,F12P5
          GOTO      LYRAMT90
LYRAMT09  ASSIGN    LYRABF+LYRA01+LYRA02+LYRA03+LYRA04+LYRA05+LYRA06,F12P5
          ASSIGN    F12P5+LYRA07+LYRA08+LYRA09,F12P5
          GOTO      LYRAMT90
LYRAMT10  ASSIGN    LYRABF+LYRA01+LYRA02+LYRA03+LYRA04+LYRA05+LYRA06,F12P5
          ASSIGN    F12P5+LYRA07+LYRA08+LYRA09+LYRA10,F12P5
          GOTO      LYRAMT90
LYRAMT11  ASSIGN    LYRABF+LYRA01+LYRA02+LYRA03+LYRA04+LYRA05+LYRA06,F12P5
          ASSIGN    F12P5+LYRA07+LYRA08+LYRA09+LYRA10+LYRA11,F12P5
          GOTO      LYRAMT90
LYRAMT12  ASSIGN    LYRABF+LYRA01+LYRA02+LYRA03+LYRA04+LYRA05+LYRA06,F12P5
          ASSIGN    F12P5+LYRA07+LYRA08+LYRA09+LYRA10+LYRA11+LYRA12,F12P5
          GOTO      LYRAMT90
LYRAMT13  ASSIGN    LYRABF+LYRA01+LYRA02+LYRA03+LYRA04+LYRA05+LYRA06,F12P5
          ASSIGN    F12P5+LYRA07+LYRA08+LYRA09+LYRA10+LYRA11+LYRA12+LYRA13,F12P5
          GOTO      LYRAMT90
LYRAMT90  MOVE      FMAMTYPE,F1
          IF        F1=9|F1=8
            IF        FMAMAYTD=1
              DIV       F3,F12P5
            ENDIF
          ENDIF
LYRAMT99  RETURN
.
.------------------------------------------------------------
. A Individual Budget Amount
.------------------------------------------------------------
BUDAMT00  MOVE      FLDPARA,F3
          IF        F3=14
            MOVE      PERIODNO,F3
          ENDIF
          IF        F3=15
            ASSIGN    100+PERIODNO,F3
          ENDIF
          IF        F3<100
            MOVE      ZERO,F12P5
            LOAD      F12P5,F3,CURB01,CURB02,CURB03,CURB04,CURB05:
                               CURB06,CURB07,CURB08,CURB09,CURB10:
                               CURB11,CURB12,CURB13
            GOTO      BUDAMT99
          ENDIF
          SUB       "100",F3
          MOVE      ZERO,F12P5
          BRANCH    F3,BUDAMT01,BUDAMT02,BUDAMT03,BUDAMT04,BUDAMT05:
                       BUDAMT06,BUDAMT07,BUDAMT08,BUDAMT09,BUDAMT10:
                       BUDAMT11,BUDAMT12,BUDAMT13
BUDAMT01  ASSIGN    CURB01,F12P5
          GOTO      BUDAMT90
BUDAMT02  ASSIGN    CURB01+CURB02,F12P5
          GOTO      BUDAMT90
BUDAMT03  ASSIGN    CURB01+CURB02+CURB03,F12P5
          GOTO      BUDAMT90
BUDAMT04  ASSIGN    CURB01+CURB02+CURB03+CURB04,F12P5
          GOTO      BUDAMT90
BUDAMT05  ASSIGN    CURB01+CURB02+CURB03+CURB04+CURB05,F12P5
          GOTO      BUDAMT90
BUDAMT06  ASSIGN    CURB01+CURB02+CURB03+CURB04+CURB05+CURB06,F12P5
          GOTO      BUDAMT90
BUDAMT07  ASSIGN    CURB01+CURB02+CURB03+CURB04+CURB05+CURB06,F12P5
          ASSIGN    F12P5+CURB07,F12P5
          GOTO      BUDAMT90
BUDAMT08  ASSIGN    CURB01+CURB02+CURB03+CURB04+CURB05+CURB06,F12P5
          ASSIGN    F12P5+CURB07+CURB08,F12P5
          GOTO      BUDAMT90
BUDAMT09  ASSIGN    CURB01+CURB02+CURB03+CURB04+CURB05+CURB06,F12P5
          ASSIGN    F12P5+CURB07+CURB08+CURB09,F12P5
          GOTO      BUDAMT90
BUDAMT10  ASSIGN    CURB01+CURB02+CURB03+CURB04+CURB05+CURB06,F12P5
          ASSIGN    F12P5+CURB07+CURB08+CURB09+CURB10,F12P5
          GOTO      BUDAMT90
BUDAMT11  ASSIGN    CURB01+CURB02+CURB03+CURB04+CURB05+CURB06,F12P5
          ASSIGN    F12P5+CURB07+CURB08+CURB09+CURB10+CURB11,F12P5
          GOTO      BUDAMT90
BUDAMT12  ASSIGN    CURB01+CURB02+CURB03+CURB04+CURB05+CURB06,F12P5
          ASSIGN    F12P5+CURB07+CURB08+CURB09+CURB10+CURB11+CURB12,F12P5
          GOTO      BUDAMT90
BUDAMT13  ASSIGN    CURB01+CURB02+CURB03+CURB04+CURB05+CURB06,F12P5
          ASSIGN    F12P5+CURB07+CURB08+CURB09+CURB10+CURB11+CURB12+CURB13,F12P5
          GOTO      BUDAMT90
BUDAMT90  MOVE      FMAMTYPE,F1
          IF        F1=9|F1=8
            IF        FMAMAYTD=1
              DIV       F3,F12P5
            ENDIF
          ENDIF
BUDAMT99  RETURN
.
.------------------------------------------------------------
. A Individual Alternate Budget Amount
.------------------------------------------------------------
ALTAMT00  MOVE      FLDPARA,F3
          IF        F3=14
            MOVE      PERIODNO,F3
          ENDIF
          IF        F3=15
            ASSIGN    100+PERIODNO,F3
          ENDIF
          IF        F3<100
            MOVE      ZERO,F12P5
            LOAD      F12P5,F3,LYRB01,LYRB02,LYRB03,LYRB04,LYRB05:
                               LYRB06,LYRB07,LYRB08,LYRB09,LYRB10:
                               LYRB11,LYRB12,LYRB13
            GOTO      ALTAMT99
          ENDIF
          SUB       "100",F3
          MOVE      ZERO,F12P5
          BRANCH    F3,ALTAMT01,ALTAMT02,ALTAMT03,ALTAMT04,ALTAMT05:
                       ALTAMT06,ALTAMT07,ALTAMT08,ALTAMT09,ALTAMT10:
                       ALTAMT11,ALTAMT12,ALTAMT13
ALTAMT01  ASSIGN    LYRB01,F12P5
          GOTO      ALTAMT90
ALTAMT02  ASSIGN    LYRB01+LYRB02,F12P5
          GOTO      ALTAMT90
ALTAMT03  ASSIGN    LYRB01+LYRB02+LYRB03,F12P5
          GOTO      ALTAMT90
ALTAMT04  ASSIGN    LYRB01+LYRB02+LYRB03+LYRB04,F12P5
          GOTO      ALTAMT90
ALTAMT05  ASSIGN    LYRB01+LYRB02+LYRB03+LYRB04+LYRB05,F12P5
          GOTO      ALTAMT90
ALTAMT06  ASSIGN    LYRB01+LYRB02+LYRB03+LYRB04+LYRB05+LYRB06,F12P5
          GOTO      ALTAMT90
ALTAMT07  ASSIGN    LYRB01+LYRB02+LYRB03+LYRB04+LYRB05+LYRB06,F12P5
          ASSIGN    F12P5+LYRB07,F12P5
          GOTO      ALTAMT90
ALTAMT08  ASSIGN    LYRB01+LYRB02+LYRB03+LYRB04+LYRB05+LYRB06,F12P5
          ASSIGN    F12P5+LYRB07+LYRB08,F12P5
          GOTO      ALTAMT90
ALTAMT09  ASSIGN    LYRB01+LYRB02+LYRB03+LYRB04+LYRB05+LYRB06,F12P5
          ASSIGN    F12P5+LYRB07+LYRB08+LYRB09,F12P5
          GOTO      ALTAMT90
ALTAMT10  ASSIGN    LYRB01+LYRB02+LYRB03+LYRB04+LYRB05+LYRB06,F12P5
          ASSIGN    F12P5+LYRB07+LYRB08+LYRB09+LYRB10,F12P5
          GOTO      ALTAMT90
ALTAMT11  ASSIGN    LYRB01+LYRB02+LYRB03+LYRB04+LYRB05+LYRB06,F12P5
          ASSIGN    F12P5+LYRB07+LYRB08+LYRB09+LYRB10+LYRB11,F12P5
          GOTO      ALTAMT90
ALTAMT12  ASSIGN    LYRB01+LYRB02+LYRB03+LYRB04+LYRB05+LYRB06,F12P5
          ASSIGN    F12P5+LYRB07+LYRB08+LYRB09+LYRB10+LYRB11+LYRB12,F12P5
          GOTO      ALTAMT90
ALTAMT13  ASSIGN    LYRB01+LYRB02+LYRB03+LYRB04+LYRB05+LYRB06,F12P5
          ASSIGN    F12P5+LYRB07+LYRB08+LYRB09+LYRB10+LYRB11+LYRB12+LYRB13,F12P5
          GOTO      ALTAMT90
ALTAMT90  MOVE      FMAMTYPE,F1
          IF        F1=9|F1=8
            IF        FMAMAYTD=1
              DIV       F3,F12P5
            ENDIF
          ENDIF
ALTAMT99  RETURN
.
.------------------------------------------------------------
. Output Formatted Amount
.------------------------------------------------------------
OUTAMT00  UNPACK    DIM127,D1,KEY1,DIM127
          MULT      INCOMEFL,F12P5
          MOVE      KEY1,F1
          BRANCH    F1,OUTAMT10,OUTAMT20,OUTAMT30,OUTAMT40,OUTAMT50
.
          MOVE      EDITSTR0,OUTSTR18
          MOVE      F12P5,AMT12P0
          FEDIT     AMT12P0,OUTSTR18
          WRITE     HTMLFILE;OUTSTR18;
          GOTO      OUTAMT99
.
OUTAMT10  MOVE      EDITSTR1,OUTSTR18
          MOVE      F12P5,AMT12P1
          FEDIT     AMT12P1,OUTSTR18
          WRITE     HTMLFILE;OUTSTR18;
          GOTO      OUTAMT99
.
OUTAMT20  MOVE      EDITSTR2,OUTSTR18
          MOVE      F12P5,AMT12P2
          FEDIT     AMT12P2,OUTSTR18
          WRITE     HTMLFILE;OUTSTR18;
          GOTO      OUTAMT99
.
OUTAMT30  MOVE      EDITSTR3,OUTSTR18
          MOVE      F12P5,AMT12P3
          FEDIT     AMT12P3,OUTSTR18
          WRITE     HTMLFILE;OUTSTR18;
          GOTO      OUTAMT99
.
OUTAMT40  MOVE      EDITSTR4,OUTSTR18
          MOVE      F12P5,AMT12P4
          FEDIT     AMT12P4,OUTSTR18
          WRITE     HTMLFILE;OUTSTR18;
          GOTO      OUTAMT99
.
OUTAMT50  MOVE      EDITSTR5,OUTSTR18
          MOVE      F12P5,AMT12P5
          FEDIT     AMT12P5,OUTSTR18
          WRITE     HTMLFILE;OUTSTR18;
          GOTO      OUTAMT99
.
OUTAMT99  RETURN
.------------------------------------------------------------
. Actual Data for a number of periods
.------------------------------------------------------------
ACTDAT00  WRITE     HTMLFILE;" <param name=dataset",DSETNUM,DSETAXIS:
                             "Values value=#""
          BRANCH    FMLAPERS,ACTDAT50
.
          ASSIGN    PERIODNO+12-NUMPER,F2
          IF        F2<0
            MOVE      ZERO,F2
          ENDIF
ACTDAT10  ADD       ONE,F2
          LOAD      F12P5,F2,LYRA01,LYRA02,LYRA03,LYRA04,LYRA05,LYRA06:
                             LYRA07,LYRA08,LYRA09,LYRA10,LYRA11,LYRA12:
                             CURA01,CURA02,CURA03,CURA04,CURA05,CURA06:
                             CURA07,CURA08,LYRA09,CURA10,CURA11,CURA12
          MULT      INCOMEFL,F12P5
          IF        F2=PERIODNO+12
            GOTO      ACTDAT90
          ENDIF
          WRITE     HTMLFILE;F12P5,COMMA;
          GOTO      ACTDAT10
.
ACTDAT50  ASSIGN    PERIODNO+13-NUMPER,F2
          IF        F2<0
            MOVE      ZERO,F2
          ENDIF
ACTDAT60  ADD       ONE,F2
          LOAD      F12P5,F2,LYRA01,LYRA02,LYRA03,LYRA04,LYRA05,LYRA06:
                             LYRA07,LYRA08,LYRA09,LYRA10,LYRA11,LYRA12,LYRA13:
                             CURA01,CURA02,CURA03,CURA04,CURA05,CURA06:
                             CURA07,CURA08,LYRA09,CURA10,CURA11,CURA12,CURA13
          MULT      INCOMEFL,F12P5
          IF        F2=PERIODNO+12
            GOTO      ACTDAT90
          ENDIF
          WRITE     HTMLFILE;F12P5,COMMA;
          GOTO      ACTDAT60
.
ACTDAT90  WRITE     HTMLFILE;F12P5,"#">"
ACTDAT99  RETURN
.------------------------------------------------------------
. Budget Data for a number of periods
.------------------------------------------------------------
BUDDAT00  WRITE     HTMLFILE;" <param name=dataset",DSETNUM,DSETAXIS:
                             "Values value=#""
          BRANCH    FMLAPERS,BUDDAT50
.
          ASSIGN    PERIODNO+12-NUMPER,F2
          IF        F2<0
            MOVE      ZERO,F2
          ENDIF
BUDDAT10  ADD       ONE,F2
          LOAD      F12P5,F2,LYRB01,LYRB02,LYRB03,LYRB04,LYRB05,LYRB06:
                             LYRB07,LYRB08,LYRB09,LYRB10,LYRB11,LYRB12:
                             CURB01,CURB02,CURB03,CURB04,CURB05,CURB06:
                             CURB07,CURB08,LYRB09,CURB10,CURB11,CURB12
          MULT      INCOMEFL,F12P5
          IF        F2=PERIODNO+12
            GOTO      BUDDAT90
          ENDIF
          WRITE     HTMLFILE;F12P5,COMMA;
          GOTO      BUDDAT10
.
BUDDAT50  ASSIGN    PERIODNO+13-NUMPER,F2
          IF        F2<0
            MOVE      ZERO,F2
          ENDIF
BUDDAT60  ADD       ONE,F2
          LOAD      F12P5,F2,LYRB01,LYRB02,LYRB03,LYRB04,LYRB05,LYRB06:
                             LYRB07,LYRB08,LYRB09,LYRB10,LYRB11,LYRB12,LYRB13:
                             CURB01,CURB02,CURB03,CURB04,CURB05,CURB06:
                             CURB07,CURB08,LYRB09,CURB10,CURB11,CURB12,CURB13
          MULT      INCOMEFL,F12P5
          IF        F2=PERIODNO+12
            GOTO      BUDDAT90
          ENDIF
          WRITE     HTMLFILE;F12P5,COMMA;
          GOTO      BUDDAT60
.
BUDDAT90  WRITE     HTMLFILE;F12P5,"#">"
BUDDAT99  RETURN
.------------------------------------------------------------
. Label Data for a number of periods
.------------------------------------------------------------
NAMDAT00  WRITE     HTMLFILE;" <param name=dataset",DSETNUM:
                             "Labels value=#""
          MOVE      FMLC01DE,MTH301
          MOVE      FMLC02DE,MTH302
          MOVE      FMLC03DE,MTH303
          MOVE      FMLC04DE,MTH304
          MOVE      FMLC05DE,MTH305
          MOVE      FMLC06DE,MTH306
          MOVE      FMLC07DE,MTH307
          MOVE      FMLC08DE,MTH308
          MOVE      FMLC09DE,MTH309
          MOVE      FMLC10DE,MTH310
          MOVE      FMLC11DE,MTH311
          MOVE      FMLC12DE,MTH312
          MOVE      FMLC13DE,MTH313
          BRANCH    FMLAPERS,NAMDAT50
.
          ASSIGN    PERIODNO+12-NUMPER,F2
          IF        F2<0
            MOVE      ZERO,F2
          ENDIF
NAMDAT10  ADD       ONE,F2
          LOAD      KEY3,F2,MTH301,MTH302,MTH303,MTH304,MTH305,MTH306:
                            MTH307,MTH308,MTH309,MTH310,MTH311,MTH312:
                            MTH301,MTH302,MTH303,MTH304,MTH305,MTH306:
                            MTH307,MTH308,MTH309,MTH310,MTH311,MTH312
          IF        F2=PERIODNO+12
            GOTO      NAMDAT90
          ENDIF
          WRITE     HTMLFILE;KEY3,COMMA;
          GOTO      NAMDAT10
.
NAMDAT50  ASSIGN    PERIODNO+13-NUMPER,F2
          IF        F2<0
            MOVE      ZERO,F2
          ENDIF
NAMDAT60  ADD       ONE,F2
          LOAD      KEY3,F2,MTH301,MTH302,MTH303,MTH304,MTH305,MTH306:
                            MTH307,MTH308,MTH309,MTH310,MTH311,MTH312,MTH313:
                            MTH301,MTH302,MTH303,MTH304,MTH305,MTH306:
                            MTH307,MTH308,MTH309,MTH310,MTH311,MTH312,MTH313
          IF        F2=PERIODNO+13
            GOTO      NAMDAT90
          ENDIF
          WRITE     HTMLFILE;KEY3,COMMA;
          GOTO      NAMDAT60
.
NAMDAT90  WRITE     HTMLFILE;KEY3,"#">"
NAMDAT99  RETURN
.------------------------------------------------------------
. Label Data for a number of periods
.------------------------------------------------------------
LNKDAT00  WRITE     HTMLFILE;" <param name=dataset",DSETNUM:
                             "Links value=#""
.
          MOVE      ONE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
          CLEAR     KEY80
          MOVE      FMAMTYPE,F1
          IF        F1=6|F1=9 
            APPEND    "#"/fmsweb04.pbl?reportno=2",KEY80
          ELSE
            APPEND    "#"/fmsweb01.pbl?reportno=1",KEY80
          ENDIF
          APPEND    "&template=",KEY80
          APPEND    KEY3,KEY80
          APPEND    "&acctkeys=",KEY80
          CALL      SETACC00
          REP       " +",FMTACCT
          APPEND    FMTACCT,KEY80
          REP       "+ ",FMTACCT
          APPEND    SP70,KEY80
          RESET     KEY80
          STRIP     KEY80
.
          BRANCH    FMLAPERS,LNKDAT50
          ASSIGN    PERIODNO+12-NUMPER,F2
          IF        F2<0
            MOVE      ZERO,F2
          ENDIF
LNKDAT10  ADD       ONE,F2
          MOVE      CURYEAR,F4
          IF        F2<13
            SUB       ONE,F4
          ENDIF
.
          CLEAR     HTMLLINK
          APPEND    KEY80,HTMLLINK
          APPEND    "&fincyear=",HTMLLINK
          APPEND    F4,HTMLLINK
          APPEND    "&fincperd=",HTMLLINK
          IF        F2>12
            SUB       "12",F2
            MOVE      F2,KEY2
            ADD       "12",F2
          ELSE
            MOVE      F2,KEY2
          ENDIF
          REP       " 0",KEY2
          APPEND    KEY2,HTMLLINK
          APPEND    "#"",HTMLLINK
          RESET     HTMLLINK
          SQUEEZE   HTMLLINK
.
          IF        F2=PERIODNO+12
            GOTO      LNKDAT90
          ENDIF
.
          WRITE     HTMLFILE;HTMLLINK,COMMA;
          GOTO      LNKDAT10
.
LNKDAT50  ASSIGN    PERIODNO+13-NUMPER,F2
          IF        F2<0
            MOVE      ZERO,F2
          ENDIF
LNKDAT60  ADD       ONE,F2
          MOVE      CURYEAR,F4
          IF        F2<14
            SUB       ONE,F4
          ENDIF
          CLEAR     HTMLLINK
          APPEND    KEY80,HTMLLINK
          APPEND    "&fincyear=",HTMLLINK
          APPEND    F4,HTMLLINK                                                
          APPEND    "&fincperd=",HTMLLINK
          IF        F2>13
            SUB       "13",F2
            MOVE      F2,KEY2
            ADD       "13",F2
          ELSE
            MOVE      F2,KEY2
          ENDIF
          REP       " 0",KEY2
          APPEND    KEY2,HTMLLINK
          APPEND    "#"",HTMLLINK
          RESET     HTMLLINK
          SQUEEZE   HTMLLINK
          IF        F2=PERIODNO+13
            GOTO      LNKDAT90
          ENDIF
          WRITE     HTMLFILE;HTMLLINK,COMMA;
          GOTO      LNKDAT60
.
LNKDAT90  WRITE     HTMLFILE;HTMLLINK,"#">"
LNKDAT99  RETURN
.------------------------------------------------------------
. Table A 
.------------------------------------------------------------
FMTABA00  MOVE      ZERO,FORMATTY
          UNPACK    DIM127,KEY1,ANS,DIM127
          MOVE      ANS,FORMATTY
          MOVE      ZERO,HEADTYPE
          UNPACK    DIM127,KEY1,ANS,DIM127
          MOVE      ANS,HEADTYPE
          WRITE     HTMLFILE;"<table border=1 width=#"100%#" >"
          MOVE      FMAMTYPE,F1
          IF        F1=6|F1=8|F1=9|HEADTYPE=1
            WRITE     HTMLFILE;"<tr><td colspan=8 align=center":
                               " bgcolor=#"##FFFF00#">":
                               " Financial Year ",CURYEAR:
                               "</td></tr>"
          ELSE
            CALL      PSTHED00
          ENDIF
          WRITE     HTMLFILE;"<TR><TD ALIGN=RIGHT><B>Actual</B></TD>":
                             "<TD ALIGN=RIGHT><B>Budget</B></TD>":
                             "<TD ALIGN=RIGHT><B>Variance</B></TD>":
                             "<TD><B>Period</B></TD>":
                             "<TD ALIGN=RIGHT><B>YTD Actual</B></TD>":
                             "<TD ALIGN=RIGHT><B>YTD Budget</B></TD>":
                             "<TD ALIGN=RIGHT><B>Variance</B></TD>";
          IF        LASTCOL=0
            WRITE    HTMLFILE;"<TD ALIGN=RIGHT><B>Last Year</B></TD></TR>";
          ELSE
            WRITE    HTMLFILE;"<TD ALIGN=RIGHT><B>Annual Budget</B></TD></TR>";
          ENDIF
.
          MOVE      ZERO,F2
          MOVE      ZERO,ACTUALYD
          MOVE      ZERO,ACTUALLY
          MOVE      ZERO,BUDGETYD
          MOVE      "2",EDITTYPE        * Standard 2 Decimal Places Financial
          MOVE      FMAMTYPE,F1
          IF        F1>7
            MOVE      FMAMDPLA,EDITTYPE * Set up Number for Stats
          ENDIF
.
          MOVE      ONE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
          CLEAR     KEY80
          MOVE      FMAMTYPE,F1
          IF        F1=6|F1=9
            APPEND    "fmsweb04.pbl?reportno=2",KEY80
          ELSE
            APPEND    "fmsweb01.pbl?reportno=1",KEY80
          ENDIF
          APPEND    "&template=",KEY80
          APPEND    KEY3,KEY80
          APPEND    "&acctkeys=",KEY80
          CALL      SETACC00
          REP       " +",FMTACCT
          APPEND    FMTACCT,KEY80
          REP       "+ ",FMTACCT
          APPEND    SP70,KEY80
          RESET     KEY80
          STRIP     KEY80
.
FMTABA10  ADD       ONE,F2
          COMPARE   "13",F2
          GOTO      FMTABA90 IF EQUAL
.
          LOAD      ACTUALCP,F2,CURA01,CURA02,CURA03,CURA04,CURA05:
                                CURA06,CURA07,CURA08,CURA09,CURA10:
                                CURA11,CURA12
          ADD       ACTUALCP,ACTUALYD
          LOAD      F12P2,F2,LYRA01,LYRA02,LYRA03,LYRA04,LYRA05:
                                LYRA06,LYRA07,LYRA08,LYRA09,LYRA10:
                                LYRA11,LYRA12
          ADD       F12P2,ACTUALLY
          LOAD      BUDGETCP,F2,CURB01,CURB02,CURB03,CURB04,CURB05:
                                CURB06,CURB07,CURB08,CURB09,CURB10:
                                CURB11,CURB12
          ADD       BUDGETCP,BUDGETYD
          LOAD      PERNAME,F2,FMLC01DE,FMLC02DE,FMLC03DE,FMLC04DE,FMLC05DE:
                               FMLC06DE,FMLC07DE,FMLC08DE,FMLC09DE,FMLC10DE:
                               FMLC11DE,FMLC12DE
          MATCH     "1",FMCOBVAR
          IF        @EQUAL
            MOVE      BGGREEN,BGBAD
            MOVE      BGRED,BGGOOD
            ASSIGN    BUDGETCP-ACTUALCP,VARIANCP
            ASSIGN    BUDGETYD-ACTUALYD,VARIANYD
          ELSE
            MOVE      BGGREEN,BGGOOD
            MOVE      BGRED,BGBAD
            ASSIGN    ACTUALCP-BUDGETCP,VARIANCP
            ASSIGN    ACTUALYD-BUDGETYD,VARIANYD
          ENDIF
.
          ASSIGN    (VARIANYD/BUDGETYD)*100,PERVARYD
.
          PACK      KEY14,FMAMLEDG,FMAMACCT
          CALL      RDFMWC1
          BRANCH    OVRCD,FMTABA15
.
          MOVE      BGGOOD,YTDBGC
          IF        VARIANYD<=0
            MOVE      BGBAD,YTDBGC
          ENDIF
          MOVE      BGGOOD,CURBGC
          IF        VARIANCP<=0
            MOVE      BGBAD,CURBGC
          ENDIF
          GOTO      FMTABA20
.
FMTABA15  MOVE      BGGOOD,YTDBGC
          IF        VARIANYD>=0
            MOVE      BGBAD,YTDBGC
          ENDIF
          MOVE      BGGOOD,CURBGC
          IF        VARIANCP>=0
            MOVE      BGBAD,CURBGC
          ENDIF
.
FMTABA20  CLEAR     HTMLLINK
          APPEND    KEY80,HTMLLINK
          APPEND    "&fincyear=",HTMLLINK
          APPEND    CURYEAR,HTMLLINK
          APPEND    "&fincperd=",HTMLLINK
          MOVE      F2,KEY2
          REP       " 0",KEY2
          APPEND    KEY2,HTMLLINK
          RESET     HTMLLINK
          SQUEEZE   HTMLLINK
.
          MOVE      ACTUALCP,AMTCOL01
          MOVE      BUDGETCP,AMTCOL02
          MOVE      VARIANCP,AMTCOL03
          MOVE      ACTUALYD,AMTCOL04
          MOVE      BUDGETYD,AMTCOL05
          MOVE      VARIANYD,AMTCOL06
          IF        LASTCOL=0
            MOVE      ACTUALLY,AMTCOL07
          ELSE
            MOVE      CURB01,AMTCOL07
            ADD       CURB02,AMTCOL07
            ADD       CURB03,AMTCOL07
            ADD       CURB04,AMTCOL07
            ADD       CURB05,AMTCOL07
            ADD       CURB06,AMTCOL07
            ADD       CURB07,AMTCOL07
            ADD       CURB08,AMTCOL07
            ADD       CURB09,AMTCOL07
            ADD       CURB10,AMTCOL07
            ADD       CURB11,AMTCOL07
            ADD       CURB12,AMTCOL07
            ADD       CURB13,AMTCOL07
          ENDIF
          MOVE      FMAMTYPE,F1
          IF        F1>7
            CALL      STAADJ00   * Adjust Statistics
          ENDIF
          MULT      INCOMEFL,AMTCOL01
          MULT      INCOMEFL,AMTCOL02
          MULT      INCOMEFL,AMTCOL03
          MULT      INCOMEFL,AMTCOL04
          MULT      INCOMEFL,AMTCOL05
          MULT      INCOMEFL,AMTCOL06
          MULT      INCOMEFL,AMTCOL07
.
          CALL      FORMAT00
.
          WRITE     HTMLFILE;"<tr>":
                             "<td align=right>",FMTCOL01,"</td>":
                             "<td align=right>",FMTCOL02,"</td>":
                             "<td align=right><font color=",CURBGC,">":
                             FMTCOL03,"</font></td>":
                             "<td><a href=#"",HTMLLINK,"#">":
                              PERNAME,"</a></td>":
                             "<td align=right>",FMTCOL04,"</td>":
                             "<td align=right>",FMTCOL05,"</td>":
                             "<td align=right><font color=",YTDBGC,">":
                              FMTCOL06,"</font></td>":
                             "<td align=right>",FMTCOL07,"</td></tr>"
          GOTO      FMTABA10
FMTABA90  WRITE     HTMLFILE;"</table>"
FMTABA99  RETURN
.------------------------------------------------------------
. Adjust Statistical Accounts for Multi, Div and Average
.------------------------------------------------------------
STAADJ00  IF        FMAMMULT<>0
            MULT      FMAMMULT,AMTCOL01
            MULT      FMAMMULT,AMTCOL02
            MULT      FMAMMULT,AMTCOL03
            MULT      FMAMMULT,AMTCOL04
            MULT      FMAMMULT,AMTCOL05
            MULT      FMAMMULT,AMTCOL06
            MULT      FMAMMULT,AMTCOL07
          ENDIF
          IF        FMAMDIV<>0
            DIV       FMAMDIV,AMTCOL01
            DIV       FMAMDIV,AMTCOL02
            DIV       FMAMDIV,AMTCOL03
            DIV       FMAMDIV,AMTCOL04
            DIV       FMAMDIV,AMTCOL05
            DIV       FMAMDIV,AMTCOL06
            DIV       FMAMDIV,AMTCOL07
          ENDIF
          IF        FMAMAYTD=1
            DIV       F2,AMTCOL04
            DIV       F2,AMTCOL05
            DIV       F2,AMTCOL06
            DIV       F2,AMTCOL07
          ENDIF
          RETURN
.------------------------------------------------------------
. Heading for Posting Account Including Dissection & Resp Links
.------------------------------------------------------------
PSTHED00  MOVE      ONE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
          MOVE      PERIODNO,KEY2
          REP       " 0",KEY2
          MOVE      ACCTKEYS,KEY14
          CALL      SETACC00
          REP       " +",FMTACCT
          WRITE     HTMLFILE;"<tr>":
                             "<td align=center colspan=2":
                             " bordercolordark=#FFFFFF ":
                             " bordercolorlight=#000000>":
                             "<a href=#"fmsweb02.pbl?reportno=1":
                             "&fincyear=",CURYEAR,"&fincperd=",KEY2:
                             "&template=",KEY3,"&acctkeys=",FMTACCT,"#">":
                             "Dissection Analysis</a></td>":
                             "<td colspan=4 align=center":
                             " bgcolor=#"##FFFF00#">":
                             " Financial Year ",CURYEAR,"</td>":
                             "<td align=center colspan=2":
                             " bordercolordark=#FFFFFF ":
                             " bordercolorlight=#000000>":
                             "<a href=#"fmsweb02.pbl?reportno=2":
                             "&fincyear=",CURYEAR,"&fincperd=",KEY2:
                             "&template=",KEY3,"&acctkeys=",FMTACCT,"#">":
                             "Responsibility Analysis</a></td></tr>"
          REP       "+ ",FMTACCT
          RETURN
.------------------------------------------------------------
. Format Amount Strings
.------------------------------------------------------------
FORMAT00  MOVE      EDITSTA0,EDITSTR0
          MOVE      EDITSTA1,EDITSTR1
          MOVE      EDITSTA2,EDITSTR2
          MOVE      EDITSTA3,EDITSTR3
          MOVE      EDITSTA4,EDITSTR4
          MOVE      EDITSTA5,EDITSTR5
.
          IF        FORMATTY=1
            IF        AMTCOL03<0
              MULT      SEQ,AMTCOL03
            ENDIF
            IF        AMTCOL06<0
              MULT      SEQ,AMTCOL06
            ENDIF
          ENDIF
.
          COMPARE   TWO,FORMATTY
          CALL      FMTBRK00 IF EQUAL
.
          BRANCH    EDITTYPE,FORMAT10,FORMAT20,FORMAT30,FORMAT40,FORMAT50
.
          MOVE      EDITSTR0,FMTCOL01
          MOVE      AMTCOL01,AMT12P0
          FEDIT     AMT12P0,FMTCOL01
.
          MOVE      EDITSTR0,FMTCOL02
          MOVE      AMTCOL02,AMT12P0
          FEDIT     AMT12P0,FMTCOL02
.
          MOVE      EDITSTR0,FMTCOL03
          MOVE      AMTCOL03,AMT12P0
          FEDIT     AMT12P0,FMTCOL03
.
          MOVE      EDITSTR0,FMTCOL04
          MOVE      AMTCOL04,AMT12P0
          FEDIT     AMT12P0,FMTCOL04
.
          MOVE      EDITSTR0,FMTCOL05
          MOVE      AMTCOL05,AMT12P0
          FEDIT     AMT12P0,FMTCOL05
.
          MOVE      EDITSTR0,FMTCOL06
          MOVE      AMTCOL06,AMT12P0
          FEDIT     AMT12P0,FMTCOL06
.
          MOVE      EDITSTR0,FMTCOL07
          MOVE      AMTCOL07,AMT12P0
          FEDIT     AMT12P0,FMTCOL07
.
          GOTO      FORMAT99
.
FORMAT10  MOVE      EDITSTR1,FMTCOL01
          MOVE      AMTCOL01,AMT12P1
          FEDIT     AMT12P1,FMTCOL01
.
          MOVE      EDITSTR1,FMTCOL02
          MOVE      AMTCOL02,AMT12P1
          FEDIT     AMT12P1,FMTCOL02
.
          MOVE      EDITSTR1,FMTCOL03
          MOVE      AMTCOL03,AMT12P1
          FEDIT     AMT12P1,FMTCOL03
.
          MOVE      EDITSTR1,FMTCOL04
          MOVE      AMTCOL04,AMT12P1
          FEDIT     AMT12P1,FMTCOL04
.
          MOVE      EDITSTR1,FMTCOL05
          MOVE      AMTCOL05,AMT12P1
          FEDIT     AMT12P1,FMTCOL05
.
          MOVE      EDITSTR1,FMTCOL06
          MOVE      AMTCOL06,AMT12P1
          FEDIT     AMT12P1,FMTCOL06
.
          MOVE      EDITSTR1,FMTCOL07
          MOVE      AMTCOL07,AMT12P1
          FEDIT     AMT12P1,FMTCOL07
          GOTO      FORMAT99
.
FORMAT20  MOVE      EDITSTR2,FMTCOL01
          MOVE      AMTCOL01,AMT12P2
          FEDIT     AMT12P2,FMTCOL01
.
          MOVE      EDITSTR2,FMTCOL02
          MOVE      AMTCOL02,AMT12P2
          FEDIT     AMT12P2,FMTCOL02
.
          MOVE      EDITSTR2,FMTCOL03
          MOVE      AMTCOL03,AMT12P2
          FEDIT     AMT12P2,FMTCOL03
.
          MOVE      EDITSTR2,FMTCOL04
          MOVE      AMTCOL04,AMT12P2
          FEDIT     AMT12P2,FMTCOL04
.
          MOVE      EDITSTR2,FMTCOL05
          MOVE      AMTCOL05,AMT12P2
          FEDIT     AMT12P2,FMTCOL05
.
          MOVE      EDITSTR2,FMTCOL06
          MOVE      AMTCOL06,AMT12P2
          FEDIT     AMT12P2,FMTCOL06
.
          MOVE      EDITSTR2,FMTCOL07
          MOVE      AMTCOL07,AMT12P2
          FEDIT     AMT12P2,FMTCOL07
          GOTO      FORMAT99
.
FORMAT30  MOVE      EDITSTR3,FMTCOL01
          MOVE      AMTCOL01,AMT12P3
          FEDIT     AMT12P3,FMTCOL01
.
          MOVE      EDITSTR3,FMTCOL02
          MOVE      AMTCOL02,AMT12P3
          FEDIT     AMT12P3,FMTCOL02
.
          MOVE      EDITSTR3,FMTCOL03
          MOVE      AMTCOL03,AMT12P3
          FEDIT     AMT12P3,FMTCOL03
.
          MOVE      EDITSTR3,FMTCOL04
          MOVE      AMTCOL04,AMT12P3
          FEDIT     AMT12P3,FMTCOL04
.
          MOVE      EDITSTR3,FMTCOL05
          MOVE      AMTCOL05,AMT12P3
          FEDIT     AMT12P3,FMTCOL05
.
          MOVE      EDITSTR3,FMTCOL06
          MOVE      AMTCOL06,AMT12P3
          FEDIT     AMT12P3,FMTCOL06
.
          MOVE      EDITSTR3,FMTCOL07
          MOVE      AMTCOL07,AMT12P3
          FEDIT     AMT12P3,FMTCOL07
          GOTO      FORMAT99
.
FORMAT40  MOVE      EDITSTR4,FMTCOL01
          MOVE      AMTCOL01,AMT12P4
          FEDIT     AMT12P4,FMTCOL01
.
          MOVE      EDITSTR4,FMTCOL02
          MOVE      AMTCOL02,AMT12P4
          FEDIT     AMT12P4,FMTCOL02
.
          MOVE      EDITSTR4,FMTCOL03
          MOVE      AMTCOL03,AMT12P4
          FEDIT     AMT12P4,FMTCOL03
.
          MOVE      EDITSTR4,FMTCOL04
          MOVE      AMTCOL04,AMT12P4
          FEDIT     AMT12P4,FMTCOL04
.
          MOVE      EDITSTR4,FMTCOL05
          MOVE      AMTCOL05,AMT12P4
          FEDIT     AMT12P4,FMTCOL05
.
          MOVE      EDITSTR4,FMTCOL06
          MOVE      AMTCOL06,AMT12P4
          FEDIT     AMT12P4,FMTCOL06
.
          MOVE      EDITSTR4,FMTCOL07
          MOVE      AMTCOL07,AMT12P4
          FEDIT     AMT12P4,FMTCOL07
          GOTO      FORMAT99
.
FORMAT50  MOVE      EDITSTR5,FMTCOL01
          MOVE      AMTCOL01,AMT12P5
          FEDIT     AMT12P5,FMTCOL01
.
          MOVE      EDITSTR5,FMTCOL02
          MOVE      AMTCOL02,AMT12P5
          FEDIT     AMT12P5,FMTCOL02
.
          MOVE      EDITSTR5,FMTCOL03
          MOVE      AMTCOL03,AMT12P5
          FEDIT     AMT12P5,FMTCOL03
.
          MOVE      EDITSTR5,FMTCOL04
          MOVE      AMTCOL04,AMT12P5
          FEDIT     AMT12P5,FMTCOL04
.
          MOVE      EDITSTR5,FMTCOL05
          MOVE      AMTCOL05,AMT12P5
          FEDIT     AMT12P5,FMTCOL05
.
          MOVE      EDITSTR5,FMTCOL06
          MOVE      AMTCOL06,AMT12P5
          FEDIT     AMT12P5,FMTCOL06
.
          MOVE      EDITSTR5,FMTCOL07
          MOVE      AMTCOL07,AMT12P5
          FEDIT     AMT12P5,FMTCOL07
          GOTO      FORMAT99
.
FORMAT99  RETURN
.----------------------------------------------------------------------
. Routine to format Red Variances as Negative and Green as Positive
.----------------------------------------------------------------------
FMTBRK00  MATCH     BGGREEN,CURBGC
          GOTO      FMTBRK10 IF NOT EQUAL
          IF        AMTCOL03<0
            MULT      SEQ,AMTCOL03
          ENDIF
          GOTO      FMTBRK20
.
FMTBRK10  IF        AMTCOL03>0
            MULT      SEQ,AMTCOL03
          ENDIF
.
FMTBRK20  MATCH     BGGREEN,YTDBGC
          GOTO      FMTBRK30 IF NOT EQUAL
          IF        AMTCOL06<0
            MULT      SEQ,AMTCOL06
          ENDIF
          GOTO      FMTBRK99
.
FMTBRK30  IF        AMTCOL06>0
            MULT      SEQ,AMTCOL06
          ENDIF
.
FMTBRK99  RETURN
.
.------------------------------------------------------------
. Label Data for a number of periods
.------------------------------------------------------------
LNKREF00  WRITE     HTMLFILE;" <param name=dataset",DSETNUM:
                             "Links value=#""
.
          MOVE      ONE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
          CLEAR     KEY80
          MOVE      FMAMTYPE,F1
          IF        F1=6|F1=9
            APPEND    "fmsweb04.pbl?reportno=2",KEY80
          ELSE
            APPEND    "fmsweb01.pbl?reportno=1",KEY80
          ENDIF
          APPEND    "&template=",KEY80
          APPEND    KEY3,KEY80
          APPEND    "&acctkeys=",KEY80
          CALL      SETACC00
          REP       " +",FMTACCT
          APPEND    FMTACCT,KEY80
          REP       "+ ",FMTACCT
          APPEND    SP70,KEY80
          RESET     KEY80
          STRIP     KEY80
.
          MOVE      ZERO,F2
LNKREF10  ADD       ONE,F2
          CLEAR     HTMLLINK
          APPEND    KEY80,HTMLLINK
          APPEND    "&fincyear=",HTMLLINK
          APPEND    CURYEAR,HTMLLINK
          APPEND    "&fincperd=",HTMLLINK
          MOVE      F2,KEY2
          REP       " 0",KEY2
          APPEND    KEY2,HTMLLINK
          RESET     HTMLLINK
          SQUEEZE   HTMLLINK
.
          IF        F2=12+FMLAPERS
            GOTO      LNKREF90
          ENDIF

          WRITE     HTMLFILE;HTMLLINK,COMMA;
          GOTO      LNKREF10
.
LNKREF90  WRITE     HTMLFILE;HTMLLINK,"#">"
LNKREF99  RETURN
.
.------------------------------------------------------------
. Setup Account Key replace & with &AMP;
.------------------------------------------------------------
SETACC00  MOVE      KEY14,WRKKEY14
          CLEAR     FMTACCT
SETACC10  SCAN      "&",WRKKEY14
          GOTO      SETACC90 IF NOT EQUAL
          BUMP      WRKKEY14,-1
          MOVEFPTR  WRKKEY14,CCITEM          * another handly form field
          RESET     WRKKEY14                 * reset the form pointer
          SETLPTR   WRKKEY14,CCITEM          * set logical length to end of name
          APPEND    WRKKEY14,FMTACCT
          APPEND    "a",FMTACCT
          SETLPTR   WRKKEY14,14             * reset logical length
          ADD       TWO,CCITEM            * position of 1st blank
          RESET     WRKKEY14,CCITEM          * reset to this point
          PACK      KEY15,WRKKEY14,SP70      * reset form pointer
          MOVE      KEY15,WRKKEY14
          GOTO      SETACC10
.
SETACC90  APPEND    WRKKEY14,FMTACCT
          RESET     FMTACCT
          STRIP     FMTACCT
          RETURN


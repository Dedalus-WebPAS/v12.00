.-------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.00.00"
.-------------------------------------------------------
. V9.03.01  20.10.2003  Sandra Barcham     44473
.           Don't open fmsbudaf it should be fmsbxxxx
. V9.02.00  03.05.2002  Glenn Saunders
.           Export to new release i.e. v9.02 from vf.09
.-------------------------------------------------------
. VF.00.02  11.01.2000 Charles Handaya
.           Recompiled for Audit Files date
. VF.00.01  27.07.1999 Sandra Barcham
.           Don't allow load if budget type is locked
.           srf 645908
.-------------------------------------------------------
F12P2     FORM      12.2
.-------------------------------------------------------
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBAAPS65
.   Function      :   Budget Interface Load Program           
.   Generated  On :   13/12/2005
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       APS65DF     
          INC       FMSAMADF    
          INC       FMSAMAFD/INC
          INC       FMSBIAFD/INC
          INC       FMSBIBFD/INC
          INC       FMSBPFFD/INC
          INC       FMSBTYFD/INC
          INC       FMSBUDFD/INC
          INC       FMSCONFD/INC
          INC       FMSFPSFD/INC
          INC       FMSLBUFD/INC
          INC       FMSLMAFD/INC
          INC       FMSLMCFD/INC
          INC       FMSSBUFD/INC
          INC       FMSSMAFD/INC
          INC       FMSTCFFD/INC
          INC       FMSTUPFD/INC
          INC       FMSUDADF    
          INC       IBACONFD/INC
          INC       SINCONFD/INC
.=========================
.Local Variable Definition
.-------------------------
GINFILE   DIM      40 * Scr 01 Fld     4
BUDCODE   DIM       4 * Scr 01 Fld     5
PROCODE   DIM       3 * Scr 02 Fld     7
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBAAPS65"
PRGNAM    INIT      "Budget Interface Load Program           "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          MOVE      PORT,PARENTID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      FMSCON00
          CALL      SC00L000
          CALL      FMSUPD00
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          DISPLAY   *P56:24,"Opening fmsamaaf";
          OPEN      FMSAMAA1,"fmsamaaf"
          DISPLAY   *P56:24,"Opening fmsamaaf";
          OPEN      FMSAMAA2,"fmsamaaf"
          DISPLAY   *P56:24,"Opening fmsamaaf";
          OPEN      FMSAMAA3,"fmsamaaf"
          DISPLAY   *P56:24,"Opening fmsamaaf";
          OPEN      FMSAMAA4,"fmsamaaf"
          DISPLAY   *P56:24,"Opening fmsbpfaf";
          OPEN      FMSBPFA1,"fmsbpfaf"
          DISPLAY   *P56:24,"Opening fmsbtyaf";
          OPEN      FMSBTYA1,"fmsbtyaf"
          DISPLAY   *P56:24,"Opening fmslmaaf";
          OPEN      FMSLMAA1,"fmslmaaf"
          DISPLAY   *P56:24,"Opening fmslmcaf";
          OPEN      FMSLMCA1,"fmslmcaf"
          DISPLAY   *P56:24,"Opening  fmstcfaf           ";
          OPEN      FMSTCFA1,"fmstcfaf"          
          DISPLAY   *P56:24,"Opening  fmstcfaf           ";
          OPEN      FMSTCFA2,"fmstcfaf"          
          DISPLAY   *P56:24,"Opening  fmstupaf           ";
          OPEN      FMSTUPA1,"fmstupaf"          
          DISPLAY   *P56:24,"Opening  fmstupaf           ";
          OPEN      FMSTUPA2,"fmstupaf"          
          DISPLAY   *P56:24,"Opening  fmstupaf           ";
          OPEN      FMSTUPA3,"fmstupaf"          
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "00",SCRID
          IF         @EQUAL
            CALL       PS00L000   * Main Menu                          
          ENDIF
          MATCH     "01",SCRID
          IF         @EQUAL
            CALL       PS01L000   * By Amount by Period                
          ENDIF
          MATCH     "02",SCRID
          IF         @EQUAL
            CALL       PS02L000   * By Annual Amount                   
          ENDIF
          RETURN
.--------------------------------
. Screen - Main Menu                          
.--------------------------------
SC00L000
SC00L100
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC00L200
          CALL      CF00L000 * Clear Fields
SC00L300
          CALL      KY00L000 * Enter Key Fields
          BRANCH    EXIT,SC00L999,SC00L999
SC00L400
          CALL      WP00L000 * Load any WP Details
SC00L500
          CALL      LM00L000 * Load any Batch Details
SC00L600
          CALL      DF00L000 * Display Fields
SC00L700
          CALL      SF00L000 * Select Fields
          BRANCH    EXIT,SC00L100,SC00L100,SC00L200
SC00L800
SC00L900
SC00L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Main Menu                          
.-------------------------------------------------------
CF00L000
CF00L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Main Menu                          
.--------------------------------------------------------
KY00L000
          MOVE      ZERO,EXIT
          GOTO      KY00L999
.
KY00L900  MOVE      ONE,EXIT
KY00L999  RETURN
.---------------------------------------------------------
. Load WP files for : Main Menu                          
.---------------------------------------------------------
WP00L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Main Menu                          
.---------------------------------------------------------
LM00L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Main Menu                          
.---------------------------------------------------------
DF00L000
          BRANCH   ACCEPT,DF00L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF00L900
          MATCH    PRGID,SCPSPID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF00L010 IF NOT EQUAL
.
          CALL     PS00L000 * Display Field
          GOTO     DF00L010
DF00L900
DF00L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Main Menu                          
.---------------------------------------------------------
PS00L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS00L999,PS00L999,PS00L999,PS00L999
          GOTO     PS00L999
PS00L999
          RETURN
.---------------------------------------------------------
. Selections for : Main Menu                          
.---------------------------------------------------------
SF00L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF00L001  BRANCH   ACCEPT,SF00L020
.
SF00L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L006,SF00L101,SF00L102,SF00L103
SF00L006  BEEP
          GOTO     SF00L005
SF00L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF00L090
          MATCH    PRGID,SCSLPID
          GOTO     SF00L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF00L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L020,SF00L020,SF00L020,SF00L020
          GOTO     SF00L020
SF00L090  MOVE     ZERO,ACCEPT
          GOTO     SF00L001
.
SF00L101
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L102
          CALL      SC01L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L103
          CALL      SC02L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
SF00L990  MOVE      ONE,EXIT * Exit Char Restart
SF00L999  RETURN
.--------------------------------
. Screen - By Amount by Period                
.--------------------------------
SC01L000
SC01L100
          MOVE      "01",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC01L200
          CALL      CF01L000 * Clear Fields
          CALL      SETINS00
SC01L300
          CALL      KY01L000 * Enter Key Fields
          BRANCH    EXIT,SC01L999,SC01L999
SC01L400
          CALL      WP01L000 * Load any WP Details
SC01L500
          CALL      LM01L000 * Load any Batch Details
SC01L600
          CALL      DF01L000 * Display Fields
SC01L700
          CALL      SF01L000 * Select Fields
          BRANCH    EXIT,SC01L100,SC01L100,SC01L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC01L800
SC01L900
SC01L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : By Amount by Period                
.-------------------------------------------------------
CF01L000
          MOVE      SP70,GINFILE 
          MOVE      SP70,BUDCODE 
          MOVE      SP70,FMBTDESC
CF01L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for By Amount by Period                
.--------------------------------------------------------
KY01L000
          MOVE      ZERO,EXIT
          GOTO      KY01L999
.
KY01L900  MOVE      ONE,EXIT
KY01L999  RETURN
.---------------------------------------------------------
. Load WP files for : By Amount by Period                
.---------------------------------------------------------
WP01L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : By Amount by Period                
.---------------------------------------------------------
LM01L000
          RETURN
.---------------------------------------------------------
. Display Fields for : By Amount by Period                
.---------------------------------------------------------
DF01L000
          BRANCH   ACCEPT,DF01L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF01L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF01L900
          MATCH    PRGID,SCPSPID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF01L010 IF NOT EQUAL
.
          CALL     PS01L000 * Display Field
          GOTO     DF01L010
DF01L900
DF01L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : By Amount by Period                
.---------------------------------------------------------
PS01L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS01L999,PS01L999,PS01L999,PS01L101:
                            PS01L102,PS01L103
          GOTO     PS01L999
.
PS01L101
          MOVE      GINFILE,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L102
          MOVE      BUDCODE,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L103
          MOVE      FMBTDESC,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
PS01L999
          RETURN
.---------------------------------------------------------
. Selections for : By Amount by Period                
.---------------------------------------------------------
SF01L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF01L001  BRANCH   ACCEPT,SF01L020
.
SF01L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L006,SF01L101,SF01L102,SF01L103:
                            SF01L104,SF01L006
SF01L006  BEEP
          GOTO     SF01L005
SF01L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF01L090
          MATCH    PRGID,SCSLPID
          GOTO     SF01L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF01L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L020,SF01L020,SF01L020,SF01L103:
                            SF01L104,SF01L020
          GOTO     SF01L020
SF01L090  MOVE     ZERO,ACCEPT
          GOTO     SF01L001
.
SF01L101
          MOVE      ZERO,EXIT
          GOTO      SF01L999
.
SF01L102
          CALL      RUNINA00
          MOVE      ONE,EXIT
          GOTO      SF01L999
.
SF01L103
          CALL     SELECTED
          MOVE      "2",CKEYTYP
          CALL      KFILA000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF01L103
            ENDIF
            BRANCH    EXIT,SF01L103,SF01L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF01L990 IF EQUAL
          ENDIF
          MOVE      GINFILE,VAR      
          CALL      DISPITEM
          GOTO     SF01L001
.
SF01L104
.
.
          MOVE      "    6",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,FMBTDESC
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KBTYP000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF01L104
            ENDIF
            BRANCH    EXIT,SF01L104,SF01L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF01L990 IF EQUAL
          ENDIF
          MOVE      BUDCODE,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    6",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      FMBTDESC,VAR     
            CALL      DISPITEM
          ENDIF
          GOTO     SF01L001
SF01L990  MOVE      FOUR,EXIT * Exit Char Exit
SF01L999  RETURN
.--------------------------------
. Screen - By Annual Amount                   
.--------------------------------
SC02L000
SC02L100
          MOVE      "02",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC02L200
          CALL      CF02L000 * Clear Fields
          CALL      SETINS00
SC02L300
          CALL      KY02L000 * Enter Key Fields
          BRANCH    EXIT,SC02L999,SC02L999
SC02L400
          CALL      WP02L000 * Load any WP Details
SC02L500
          CALL      LM02L000 * Load any Batch Details
SC02L600
          CALL      DF02L000 * Display Fields
SC02L700
          CALL      SF02L000 * Select Fields
          BRANCH    EXIT,SC02L100,SC02L100,SC02L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC02L800
SC02L900
SC02L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : By Annual Amount                   
.-------------------------------------------------------
CF02L000
          MOVE      SP70,GINFILE 
          MOVE      SP70,BUDCODE 
          MOVE      SP70,FMBTDESC
          MOVE      SP70,PROCODE 
          MOVE      SP70,FMBPDESC
CF02L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for By Annual Amount                   
.--------------------------------------------------------
KY02L000
          MOVE      ZERO,EXIT
          GOTO      KY02L999
.
KY02L900  MOVE      ONE,EXIT
KY02L999  RETURN
.---------------------------------------------------------
. Load WP files for : By Annual Amount                   
.---------------------------------------------------------
WP02L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : By Annual Amount                   
.---------------------------------------------------------
LM02L000
          RETURN
.---------------------------------------------------------
. Display Fields for : By Annual Amount                   
.---------------------------------------------------------
DF02L000
          BRANCH   ACCEPT,DF02L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF02L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF02L900
          MATCH    PRGID,SCPSPID
          GOTO     DF02L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF02L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF02L010 IF NOT EQUAL
.
          CALL     PS02L000 * Display Field
          GOTO     DF02L010
DF02L900
DF02L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : By Annual Amount                   
.---------------------------------------------------------
PS02L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS02L999,PS02L999,PS02L999,PS02L101:
                            PS02L102,PS02L103,PS02L104,PS02L105
          GOTO     PS02L999
.
PS02L101
          MOVE      GINFILE,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L102
          MOVE      BUDCODE,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L103
          MOVE      FMBTDESC,VAR     
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L104
          MOVE      PROCODE,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L105
          MOVE      FMBPDESC,VAR     
          CALL      DISPITEM
          GOTO     PS02L999
PS02L999
          RETURN
.---------------------------------------------------------
. Selections for : By Annual Amount                   
.---------------------------------------------------------
SF02L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF02L001  BRANCH   ACCEPT,SF02L020
.
SF02L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF02L006,SF02L101,SF02L102,SF02L103:
                            SF02L104,SF02L006,SF02L105,SF02L006
SF02L006  BEEP
          GOTO     SF02L005
SF02L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF02L090
          MATCH    PRGID,SCSLPID
          GOTO     SF02L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF02L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF02L020,SF02L020,SF02L020,SF02L103:
                            SF02L104,SF02L020,SF02L105,SF02L020
          GOTO     SF02L020
SF02L090  MOVE     ZERO,ACCEPT
          GOTO     SF02L001
.
SF02L101
          MOVE      ZERO,EXIT
          GOTO      SF02L999
.
SF02L102
          CALL      RUNINB00
          MOVE      ONE,EXIT
          GOTO      SF02L999
.
SF02L103
          CALL     SELECTED
          MOVE      "2",CKEYTYP
          CALL      KFILB000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L103
            ENDIF
            BRANCH    EXIT,SF02L103,SF02L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF02L990 IF EQUAL
          ENDIF
          MOVE      GINFILE,VAR      
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L104
.
.
          MOVE      "    6",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,FMBTDESC
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KBTYP000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L104
            ENDIF
            BRANCH    EXIT,SF02L104,SF02L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF02L990 IF EQUAL
          ENDIF
          MOVE      BUDCODE,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    6",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      FMBTDESC,VAR     
            CALL      DISPITEM
          ENDIF
          GOTO     SF02L001
.
SF02L105
.
.
          MOVE      "    8",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,FMBPDESC
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KBPRO000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L105
            ENDIF
            BRANCH    EXIT,SF02L105,SF02L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF02L990 IF EQUAL
          ENDIF
          MOVE      PROCODE,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    8",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      FMBPDESC,VAR     
            CALL      DISPITEM
          ENDIF
          GOTO     SF02L001
SF02L990  MOVE      FOUR,EXIT * Exit Char Exit
SF02L999  RETURN
.@@@@@ Function Restart Point @@@@@
.----------------------------------------------------------------------
. Read FMS Control File Parameters
.----------------------------------------------------------------------
FMSCON00  CALL      RDFMCO50
          CALL      RDFMCO51
          CALL      RDFMCO52
          CALL      RDFMCO65
          CALL      RDFMCO66
.
          READ       CONTROLF,TWENTY3;*95,HACCNT
          READ       CONTROLF,ZERO;*85,IBCNUGST
.
          PACK       KEY2,SP70
          CALL       RSFMLA1
          CALL       RKFMLA1
          BRANCH     OVRCD,FMSERR01
.
FMSCON10  MATCH      SP70,FMLABNK
          GOTO       FMSERR02 IF EQUAL
          MATCH      SP70,FMLACRD
          GOTO       FMSERR03 IF EQUAL
          MATCH      SP70,FMLAAGST
          GOTO       FMSERR04 IF EQUAL
.
          CALL       RKFMLA1
          COMPARE    ZERO,OVRCD
          GOTO       FMSCON10 IF EQUAL
.
          RETURN
.
FMSERR01  DISPLAY    *P1:24,*EL,"No Ledgers Found - ";
          CALL       HITENTER
          GOTO       FATALERR
.
FMSERR02  CALL       FMSCOS00
          BRANCH     EXIT,FMSCOS99
          DISPLAY    *P1:24,*EL,"Bank Account Missing for Ledger ":
                     FMLALEDG," - ";
          CALL       HITENTER
          MATCH      "*",ANS
          IF         @EQUAL
            MATCH      "1426",PASSCODE
            RETURN     IF EQUAL
          ENDIF
          GOTO       FATALERR
.
FMSERR03  CALL       FMSCOS00
          BRANCH     EXIT,FMSCOS99
          DISPLAY    *P1:24,*EL,"Creditors Control Account Missing for Ledger ":
                     FMLALEDG," - ";
          CALL       HITENTER
          MATCH      "*",ANS
          IF         @EQUAL
            MATCH      "1426",PASSCODE
            RETURN     IF EQUAL
          ENDIF
          GOTO       FATALERR
.
FMSERR04  CALL       FMSCOS00
          BRANCH     EXIT,FMSCOS99
          DISPLAY    *P1:24,*EL,"G.S.T. Control Account Missing for Ledger ":
                     FMLALEDG," - ";
          CALL       HITENTER
          MATCH      "*",ANS
          IF         @EQUAL
            MATCH      "1426",PASSCODE
            RETURN     IF EQUAL
          ENDIF
          GOTO       FATALERR
.
FMSCOS00  MOVE       ONE,EXIT
          PACK       KEY15,FMLALEDG,ONE,SP70
          CALL       RSFMAM2
          CALL       RKFMAM2
          BRANCH     OVRCD,FMSCOS99
.
          MATCH      "6",FMAMTYPE
          RETURN     IF NOT LESS
.
          MOVE       ZERO,EXIT
.
FMSCOS99  RETURN
.----------------------------------------------------------------------
. Call standard update routine
.----------------------------------------------------------------------
FMSUPD00
          MOVE      PORT,PORTCODE      * set up port code
          CALL      CTUP0000           * update all accounts flagged for update
.
FMSUPD99  RETURN
.----------------------------------------------------------------------
. Set Insert Mode
.----------------------------------------------------------------------
SETINS00
          MOVE      ONE,ACCEPT
.
SETINS99  RETURN
.----------------------------------------------------------------------
. Run interface for amount by period format
.----------------------------------------------------------------------
.---- validate file ----
.
RUNINA00
          MOVE      ZERO,ERRFLAG       * 0=ok, 1=err+print, 2=quit
          MOVE      "1",SCRNO          * set up screen number
.
          CLOSE     FMSBIAA1
          STRIP     GINFILE
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      FMSBIAA1,GINFILE
          TRAPCLR   IO
          COMPARE   ONE,OVRCD
          GOTO      RUNINA90 IF EQUAL
          MOVE      ZERO,SECTOR
.
          CALL      DELTEMP            * delete old temp file
          CALL      CRTTEMP            * create new temp file
.
RUNINA10
          ADD       ONE,SECTOR
          DISPLAY   *P1:24,"Verifying : ",*V2LON,SECTOR,*EL;
          MOVE      ZERO,EXIT
          TRAP      RUNINAEX IF FORMAT
          CALL      RKFMBA1
          TRAPCLR   FORMAT
          BRANCH    EXIT,RUNINA91      * format error ?
          BRANCH    OVRCD,RUNINA30     * end of file ?
.
RUNINA15  PACK      KEY2,FMBALED,SP70
          CALL      RDFMLA1
          BRANCH    OVRCD,RUNINA92     * ledger does not exist ?
.
          MOVE      "10",CACCTIND
          PACK      KEY14,FMBALED,FMBAACC,SP70
          CALL      RDFMAM1
          BRANCH    OVRCD,RUNINA93     * account does not exist ?
.
          CALL      CKAMA000
          BRANCH    OVRCD,RUNINA94     * valid type ?
.
          MOVE      FMBAV01,VAL01      * get amounts
          MATCH     "-",FMBAS01
          IF        @EQUAL
            MULT      SEQ,VAL01
          ENDIF
          MOVE      FMBAV02,VAL02
          MATCH     "-",FMBAS02
          IF        @EQUAL
            MULT      SEQ,VAL02
          ENDIF
          MOVE      FMBAV03,VAL03
          MATCH     "-",FMBAS03
          IF        @EQUAL
            MULT      SEQ,VAL03
          ENDIF
          MOVE      FMBAV04,VAL04
          MATCH     "-",FMBAS04
          IF        @EQUAL
            MULT      SEQ,VAL04
          ENDIF
          MOVE      FMBAV05,VAL05
          MATCH     "-",FMBAS05
          IF        @EQUAL
            MULT      SEQ,VAL05
          ENDIF
          MOVE      FMBAV06,VAL06
          MATCH     "-",FMBAS06
          IF        @EQUAL
            MULT      SEQ,VAL06
          ENDIF
          MOVE      FMBAV07,VAL07
          MATCH     "-",FMBAS07
          IF        @EQUAL
            MULT      SEQ,VAL07
          ENDIF
          MOVE      FMBAV08,VAL08
          MATCH     "-",FMBAS08
          IF        @EQUAL
            MULT      SEQ,VAL08
          ENDIF
          MOVE      FMBAV09,VAL09
          MATCH     "-",FMBAS09
          IF        @EQUAL
            MULT      SEQ,VAL09
          ENDIF
          MOVE      FMBAV10,VAL10
          MATCH     "-",FMBAS10
          IF        @EQUAL
            MULT      SEQ,VAL10
          ENDIF
          MOVE      FMBAV11,VAL11
          MATCH     "-",FMBAS11
          IF        @EQUAL
            MULT      SEQ,VAL11
          ENDIF
          MOVE      FMBAV12,VAL12
          MATCH     "-",FMBAS12
          IF        @EQUAL
            MULT      SEQ,VAL12
          ENDIF
          MOVE      FMBAV13,VAL13
          MATCH     "-",FMBAS13
          IF        @EQUAL
            MULT      SEQ,VAL13
          ENDIF
.
          PACK      KEY15,FMAMTYPE,FMBALED,FMBAACC,SP70
          UNPACK    KEY15,NEZATYPE,NEZALEDG,NEZAACCT
          MOVE      SP70,NEZAPRO
          CALL      RDNEZA1            * update temp file
          IF        OVRCD=1
            MOVE      VAL01,NEZAV01
            MOVE      VAL02,NEZAV02
            MOVE      VAL03,NEZAV03
            MOVE      VAL04,NEZAV04
            MOVE      VAL05,NEZAV05
            MOVE      VAL06,NEZAV06
            MOVE      VAL07,NEZAV07
            MOVE      VAL08,NEZAV08
            MOVE      VAL09,NEZAV09
            MOVE      VAL10,NEZAV10
            MOVE      VAL11,NEZAV11
            MOVE      VAL12,NEZAV12
            MOVE      VAL13,NEZAV13
            CALL      WRNEZA1
          ELSE
            ADD       VAL01,NEZAV01
            ADD       VAL02,NEZAV02
            ADD       VAL03,NEZAV03
            ADD       VAL04,NEZAV04
            ADD       VAL05,NEZAV05
            ADD       VAL06,NEZAV06
            ADD       VAL07,NEZAV07
            ADD       VAL08,NEZAV08
            ADD       VAL09,NEZAV09
            ADD       VAL10,NEZAV10
            ADD       VAL11,NEZAV11
            ADD       VAL12,NEZAV12
            ADD       VAL13,NEZAV13
            CALL      UPNEZA1
          ENDIF
          GOTO      RUNINA10
.
.---- create data ----
.
RUNINA30  BRANCH    ERRFLAG,RUNINA98   * errors found ?
.
          CALL      CRDAT0000          * create data
          GOTO      RUNINA99
.
.---- errors ----
.
RUNINA90
          PRINT     *1,"File ",GINFILE," Missing"
          MOVE      "1",ERRFLAG
          GOTO      RUNINA98
.
RUNINA91
          PRINT     *1,"Format Error on line ",SECTOR," of file ",GINFILE
          MOVE      "1",ERRFLAG
          GOTO      RUNINA98
.
RUNINA92
          PRINT     *1,"Error on line ",SECTOR," of file ",GINFILE:
                    " - Ledger ",FMBALED," Does Not Exist"
          MOVE      "1",ERRFLAG
          GOTO      RUNINA10
.
RUNINA93
          UNPACK    KEY14,FMAMLEDG,FMAMACCT
          CLEAR     ERRLINE
          APPEND    "Error on line ",ERRLINE
          APPEND    SECTOR,ERRLINE
          APPEND    " of file ",ERRLINE
          APPEND    GINFILE,ERRLINE
          APPEND    " - Account ",ERRLINE
          APPEND    FMAMLEDG,ERRLINE
          APPEND    SLASH,ERRLINE
          APPEND    FMAMACCT,ERRLINE
          APPEND    " Does Not Exist",ERRLINE
.
          MOVE      ZERO,EXIT
          COMPARE   "1",ERRFLAG
          CALL      CACCT000 IF NOT EQUAL        * change account
          BRANCH    EXIT,RUNINA15,RUNINA99       * 0=continue, 1=retry, 2=quit
.
          MOVE      "1",ERRFLAG
          PRINT     *+,ERRLINE
          GOTO      RUNINA10
.
RUNINA94
          UNPACK    KEY14,FMAMLEDG,FMAMACCT
          CLEAR     ERRLINE
          APPEND    "Error on line ",ERRLINE
          APPEND    SECTOR,ERRLINE
          APPEND    " of file ",ERRLINE
          APPEND    GINFILE,ERRLINE
          APPEND    " - Account ",ERRLINE
          APPEND    FMAMLEDG,ERRLINE
          APPEND    SLASH,ERRLINE
          APPEND    FMAMACCT,ERRLINE
          APPEND    " Has Account Type ",ERRLINE
          APPEND    FMAMTYPE,ERRLINE
.
          MOVE      ZERO,EXIT
          COMPARE   "1",ERRFLAG
          CALL      CACCT000 IF NOT EQUAL        * change account
          BRANCH    EXIT,RUNINA15,RUNINA99       * 0=continue, 1=retry, 2=quit
.
          MOVE      "1",ERRFLAG
          PRINT     *+,ERRLINE
          GOTO      RUNINA10
.
RUNINA98
          DISPLAY   *P1:24,"Errors Found. Error Report Has Been Created - ";
          CALL      HITENTER
.
RUNINA99
          CALL      DELTEMP            * delete old temp file
          RETURN
.**********************************************************************
. Set exit
.**********************************************************************
RUNINAEX
          MOVE      "1",EXIT
          RETURN
.----------------------------------------------------------------------
. Keyin File Name
. Note : EXIT (0=Ok, 2=Exitchar)
.----------------------------------------------------------------------
KFILA000
          KEYIN     *PCCOL:CVERT,*V2LON,*RV,GINFILE
          PACK      GINFILE,GINFILE,SP70
          MATCH     SP70,GINFILE
          GOTO      KFILA9500 IF EQUAL
          MATCH     EXITCHAR,GINFILE
          GOTO      KFILA9500 IF EQUAL
.
          STRIP     GINFILE
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      FMSBIAA1,GINFILE
          TRAPCLR   IO
          COMPARE   ZERO,OVRCD
          GOTO      KFILA900 IF EQUAL
.
          REP       "./",GINFILE
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      FMSBIAA1,GINFILE
          TRAPCLR   IO
          COMPARE   ZERO,OVRCD
          GOTO      KFILA900 IF EQUAL
.
          MOVE      "File Does Not Exist - ",DISPMSG
          CALL      MESSAGE1
          GOTO      KFILA0000
.
KFILA900  MOVE      ZERO,EXIT          * return to prompt
          GOTO      KFILA9999
.
KFILA950  MOVE      TWO,EXIT           * exit
.
KFILA999  RETURN
.----------------------------------------------------------------------
. Keyin Budget Type
.----------------------------------------------------------------------
KBTYP000
          CALL      KFMBTA00
          BRANCH    EXIT,KBTYP000,KBTYP999
.
          MATCH     "2",FMBTSTAT
          GOTO      KBTYP950 IF EQUAL
.
          MOVE      FMBTCODE,BUDCODE
.
          PACK      KEY8,FMSB,FMBTCODE,SP70
          REP       " 0",KEY8
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      FMSBUDA1,KEY8       * open budget file if possible
          TRAPCLR   IO
          BRANCH    OVRCD,KBTYP900
.
          PACK      KEY8,FMSC,FMBTCODE,SP70
          REP       " 0",KEY8
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      FMSSBUA1,KEY8       * open budget file if possible
          TRAPCLR   IO
          BRANCH    OVRCD,KBTYP900
          GOTO      KBTYP999
.
.---- file missing ----
.
KBTYP900  CLEAR     DISPMSG
          APPEND    "Budget File ",DISPMSG
          APPEND    KEY8,DISPMSG
          APPEND    " Missing - ",DISPMSG
          CALL      MESSAGE1
          GOTO      KBTYP000
.
.---- Type Locked ----
.
KBTYP950  CLEAR     DISPMSG
          APPEND    "Budget Type ",DISPMSG
          APPEND    " Locked - ",DISPMSG
          CALL      MESSAGE1
          GOTO      KBTYP000
.
KBTYP999  RETURN
.----------------------------------------------------------------------
. Run interface for annual amount format
.----------------------------------------------------------------------
.---- validate file ----
.
RUNINB00
          MOVE      ZERO,ERRFLAG       * 0=ok, 1=err+print, 2=quit
          MOVE      "2",SCRNO          * set up screen number
.
          CLOSE     FMSBIBA1
          STRIP     GINFILE
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      FMSBIBA1,GINFILE
          TRAPCLR   IO
          COMPARE   ONE,OVRCD
          GOTO      RUNINB90 IF EQUAL
          MOVE      ZERO,SECTOR
.
          CALL      DELTEMP            * delete old temp file
          CALL      CRTTEMP            * create new temp file
.
RUNINB10
          ADD       ONE,SECTOR
          DISPLAY   *P1:24,"Verifying : ",*V2LON,SECTOR,*EL;
          MOVE      ZERO,EXIT
          TRAP      RUNINBEX IF FORMAT
          CALL      RKFMBB1
          TRAPCLR   FORMAT
          BRANCH    EXIT,RUNINB91      * format error ?
          BRANCH    OVRCD,RUNINB30     * end of file ?
.
RUNINB15  PACK      KEY2,FMBBLED,SP70
          CALL      RDFMLA1
          BRANCH    OVRCD,RUNINB92     * ledger does not exist ?
.
          MOVE      "10",CACCTIND
          PACK      KEY14,FMBBLED,FMBBACC,SP70
          CALL      RDFMAM1
          BRANCH    OVRCD,RUNINB93     * account does not exist ?
.
          CALL      CKAMA000
          BRANCH    OVRCD,RUNINB94     * valid type ?
.
          MOVE      FMBBVAL,TEMPAMT
          MATCH     "-",FMBBSIN
          IF        @EQUAL
            MULT      SEQ,TEMPAMT
          ENDIF
.
          MATCH     FMBBPRO,SP70       * get desired budget profile
          IF        @EQUAL
            MOVE      PROCODE,FMBBPRO
          ENDIF
          MATCH     FMBBPRO,SP70       * any profile to be used ?
          IF        !@EQUAL
            PACK      KEY9,FMBBLED,FMBTYEAR,FMBBPRO
            CALL      RDFMBP1
            BRANCH    OVRCD,RUNINB95   * budget profile does not exist ?
          ENDIF
.
          MATCH     FMBBPRO,SP70
          IF        @EQUAL
            CALL      CBTS0000
          ELSE
            CALL      CBUD0000
          ENDIF
.
          PACK      KEY15,FMAMTYPE,FMBBLED,FMBBACC,SP70
          UNPACK    KEY15,NEZATYPE,NEZALEDG,NEZAACCT
          MOVE      FMBBPRO,NEZAPRO
          CALL      RDNEZA1            * update temp file
          IF        OVRCD=1
            MOVE      VAL01,NEZAV01
            MOVE      VAL02,NEZAV02
            MOVE      VAL03,NEZAV03
            MOVE      VAL04,NEZAV04
            MOVE      VAL05,NEZAV05
            MOVE      VAL06,NEZAV06
            MOVE      VAL07,NEZAV07
            MOVE      VAL08,NEZAV08
            MOVE      VAL09,NEZAV09
            MOVE      VAL10,NEZAV10
            MOVE      VAL11,NEZAV11
            MOVE      VAL12,NEZAV12
            MOVE      VAL13,NEZAV13
            CALL      WRNEZA1
          ELSE
            ADD       VAL01,NEZAV01
            ADD       VAL02,NEZAV02
            ADD       VAL03,NEZAV03
            ADD       VAL04,NEZAV04
            ADD       VAL05,NEZAV05
            ADD       VAL06,NEZAV06
            ADD       VAL07,NEZAV07
            ADD       VAL08,NEZAV08
            ADD       VAL09,NEZAV09
            ADD       VAL10,NEZAV10
            ADD       VAL11,NEZAV11
            ADD       VAL12,NEZAV12
            ADD       VAL13,NEZAV13
            CALL      UPNEZA1
          ENDIF
          GOTO      RUNINB10
.
.---- create data ----
.
RUNINB30  BRANCH    ERRFLAG,RUNINB98   * errors found ?
.
          CALL      CRDAT0000          * create data
          GOTO      RUNINB99
.
.---- errors ----
.
RUNINB90
          PRINT     *1,"File ",GINFILE," Missing"
          MOVE      "1",ERRFLAG
          GOTO      RUNINB98
.
RUNINB91
          PRINT     *1,"Format Error on line ",SECTOR," of file ",GINFILE
          MOVE      "1",ERRFLAG
          GOTO      RUNINB98
.
RUNINB92
          PRINT     *1,"Error on line ",SECTOR," of file ",GINFILE:
                    " - Ledger ",FMBBLED," Does Not Exist"
          MOVE      "1",ERRFLAG
          GOTO      RUNINB10
.
RUNINB93
          UNPACK    KEY14,FMAMLEDG,FMAMACCT
          CLEAR     ERRLINE
          APPEND    "Error on line ",ERRLINE
          APPEND    SECTOR,ERRLINE
          APPEND    " of file ",ERRLINE
          APPEND    GINFILE,ERRLINE
          APPEND    " - Account ",ERRLINE
          APPEND    FMAMLEDG,ERRLINE
          APPEND    SLASH,ERRLINE
          APPEND    FMAMACCT,ERRLINE
          APPEND    " Does Not Exist",ERRLINE
.
          MOVE      ZERO,EXIT
          COMPARE   "1",ERRFLAG
          CALL      CACCT000 IF NOT EQUAL        * change account
          BRANCH    EXIT,RUNINB15,RUNINB99       * 0=continue, 1=retry, 2=quit
.
          MOVE      "1",ERRFLAG
          PRINT     *+,ERRLINE
          GOTO      RUNINB10
.
RUNINB94
          UNPACK    KEY14,FMAMLEDG,FMAMACCT
          CLEAR     ERRLINE
          APPEND    "Error on line ",ERRLINE
          APPEND    SECTOR,ERRLINE
          APPEND    " of file ",ERRLINE
          APPEND    GINFILE,ERRLINE
          APPEND    " - Account ",ERRLINE
          APPEND    FMAMLEDG,ERRLINE
          APPEND    SLASH,ERRLINE
          APPEND    FMAMACCT,ERRLINE
          APPEND    " Has Account Type ",ERRLINE
          APPEND    FMAMTYPE,ERRLINE
.
          MOVE      ZERO,EXIT
          COMPARE   "1",ERRFLAG
          CALL      CACCT000 IF NOT EQUAL        * change account
          BRANCH    EXIT,RUNINB15,RUNINB99       * 0=continue, 1=retry, 2=quit
.
          MOVE      "1",ERRFLAG
          PRINT     *+,ERRLINE
          GOTO      RUNINB10
.
RUNINB95
          PRINT     *1,"Error on line ",SECTOR," of file ",GINFILE:
                    " - Profile ",FMBBPRO," Does Not Exist For Ledger ":
                    FMBBLED," and year ",FMBTYEAR
          MOVE      "1",ERRFLAG
          GOTO      RUNINB10
.
RUNINB98
          DISPLAY   *P1:24,"Errors Found. Error Report Has Been Created - ";
          CALL      HITENTER
.
RUNINB99
          CALL      DELTEMP            * delete old temp file
          RETURN
.**********************************************************************
. Set exit
.**********************************************************************
RUNINBEX
          MOVE      "1",EXIT
          RETURN
.*************************************************************************
.* CBUD - Calculate the budget for each period                           *
.*************************************************************************
CBUD0000
          MOVE      TEMPAMT,FORM14P5    * move the annual budget into each feild
          DIV       "100",FORM14P5      * Divide each period by 100 to get value
          MULT      FMBPPC1,FORM14P5    * Multiply each period by its percentage
          CALL      ROUND000            * Round if not stat type
          MOVE      FORM14P5,VAL01      * move the annual budget into each feild
.
          MOVE      TEMPAMT,FORM14P5
          DIV       "100",FORM14P5
          MULT      FMBPPC2,FORM14P5
          CALL      ROUND000
          MOVE      FORM14P5,VAL02
.
          MOVE      TEMPAMT,FORM14P5
          DIV       "100",FORM14P5
          MULT      FMBPPC3,FORM14P5
          CALL      ROUND000
          MOVE      FORM14P5,VAL03
.
          MOVE      TEMPAMT,FORM14P5
          DIV       "100",FORM14P5
          MULT      FMBPPC4,FORM14P5
          CALL      ROUND000
          MOVE      FORM14P5,VAL04
.
          MOVE      TEMPAMT,FORM14P5
          DIV       "100",FORM14P5
          MULT      FMBPPC5,FORM14P5
          CALL      ROUND000
          MOVE      FORM14P5,VAL05
.
          MOVE      TEMPAMT,FORM14P5
          DIV       "100",FORM14P5
          MULT      FMBPPC6,FORM14P5
          CALL      ROUND000
          MOVE      FORM14P5,VAL06
.
          MOVE      TEMPAMT,FORM14P5
          DIV       "100",FORM14P5
          MULT      FMBPPC7,FORM14P5
          CALL      ROUND000
          MOVE      FORM14P5,VAL07
.
          MOVE      TEMPAMT,FORM14P5
          DIV       "100",FORM14P5
          MULT      FMBPPC8,FORM14P5
          CALL      ROUND000
          MOVE      FORM14P5,VAL08
.
          MOVE      TEMPAMT,FORM14P5
          DIV       "100",FORM14P5
          MULT      FMBPPC9,FORM14P5
          CALL      ROUND000
          MOVE      FORM14P5,VAL09
.
          MOVE      TEMPAMT,FORM14P5
          DIV       "100",FORM14P5
          MULT      FMBPPC10,FORM14P5
          CALL      ROUND000
          MOVE      FORM14P5,VAL10
.
          MOVE      TEMPAMT,FORM14P5
          DIV       "100",FORM14P5
          MULT      FMBPPC11,FORM14P5
          CALL      ROUND000
          MOVE      FORM14P5,VAL11
.
          MOVE      TEMPAMT,FORM14P5
          DIV       "100",FORM14P5
          MULT      FMBPPC12,FORM14P5
          CALL      ROUND000
          MOVE      FORM14P5,VAL12
.
          MOVE      TEMPAMT,FORM12P5        * calculate the budget for the last
          SUB       VAL01,FORM12P5       * period of the year
          SUB       VAL02,FORM12P5
          SUB       VAL03,FORM12P5
          SUB       VAL04,FORM12P5
          SUB       VAL05,FORM12P5
          SUB       VAL06,FORM12P5
          SUB       VAL07,FORM12P5
          SUB       VAL08,FORM12P5
          SUB       VAL09,FORM12P5
          SUB       VAL10,FORM12P5
          SUB       VAL11,FORM12P5
.
          BRANCH    FMLAPERS,CBUD1000
          MOVE      FORM12P5,FORM14P5
          CALL      ROUND000
          MOVE      FORM14P5,VAL12
          GOTO      CBUD2000
.
CBUD1000  SUB       VAL12,FORM12P5
          MOVE      FORM12P5,FORM14P5
          CALL      ROUND000
          MOVE      FORM14P5,VAL13
          GOTO      CBUD2000
.
.
CBUD2000
.
CBUD9999  RETURN
.*************************************************************************
.* CBTS - Calculate the annual budget from the period budgets entered    *
.*************************************************************************
CBTS0000
          MOVE      "12",NOPERD           * calculate number of periods
          ADD       FMLAPERS,NOPERD
.
          MOVE      TEMPAMT,FORM14P5
          DIV       NOPERD,FORM14P5
          CALL      ROUND000
          MOVE      FORM14P5,FORM13P5
          MOVE      ZERO,F2
          MOVE      TEMPAMT,FORM14P5
.
CBTS1400
          ADD       ONE,F2
.
          COMPARE   NOPERD,F2
          GOTO      CBTS1450 IF EQUAL
          STORE     FORM13P5,F2,VAL01,VAL02,VAL03,VAL04:
                                 VAL05,VAL06,VAL07,VAL08:
                                 VAL09,VAL10,VAL11,VAL12:
                                 VAL13
          SUB       FORM13P5,FORM14P5
          GOTO      CBTS1400
.
CBTS1450
          MOVE      NOPERD,F2
          SUB       "11",F2      * if 12 periods - F2 = 1
          CALL      ROUND000
          STORE     FORM14P5,F2,VAL12,VAL13
.
CBTS9999  RETURN
.----------------------------------------------------------------------
. Keyin File Name
. Note : EXIT (0=Ok, 2=Exitchar)
.----------------------------------------------------------------------
KFILB000
          KEYIN     *PCCOL:CVERT,*V2LON,*RV,GINFILE
          PACK      GINFILE,GINFILE,SP70
          MATCH     SP70,GINFILE
          GOTO      KFILB9500 IF EQUAL
          MATCH     EXITCHAR,GINFILE
          GOTO      KFILB9500 IF EQUAL
.
          STRIP     GINFILE
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      FMSBIBA1,GINFILE
          TRAPCLR   IO
          COMPARE   ZERO,OVRCD
          GOTO      KFILB900 IF EQUAL
.
          REP       "./",GINFILE
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      FMSBIBA1,GINFILE
          TRAPCLR   IO
          COMPARE   ZERO,OVRCD
          GOTO      KFILB900 IF EQUAL
.
          MOVE      "File Does Not Exist - ",DISPMSG
          CALL      MESSAGE1
          GOTO      KFILB0000
.
KFILB900  MOVE      ZERO,EXIT          * return to prompt
          GOTO      KFILB9999
.
KFILB950  MOVE      TWO,EXIT           * exit
.
KFILB999  RETURN
.----------------------------------------------------------------------
. Keyin Budget Profile
.----------------------------------------------------------------------
KBPRO000
          PACK      KEY2,SP70
          CALL      RSFMLA1
          CALL      RKFMLA1
.
          MOVE      FMLALEDG,FMBPLEDG
          MOVE      FMBTYEAR,FMBPYEAR
          CALL      KFMBPA00           * keyin budget profile
          MOVE      FMBPCODE,PROCODE
.
          MOVE      SP70,FMBPDESC
          PACK      KEY9,FMBPLEDG,FMBPYEAR,FMBPCODE,SP70
          CALL      RDFMBP1
.
KBPRO999  RETURN
.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       APS65CD     
          INC       FMSAMAIO/INC
          INC       FMSAMAKY    
          INC       FMSBIAIO/INC
          INC       FMSBIBIO/INC
          INC       FMSBPFIO/INC
          INC       FMSBPFKY    
          INC       FMSBTYIO/INC
          INC       FMSBTYKY    
          INC       FMSBUDIO/INC
          INC       FMSCONIO/INC
          INC       FMSFPSIO/INC
          INC       FMSLBUIO/INC
          INC       FMSLMAIO/INC
          INC       FMSLMAKY    
          INC       FMSLMCIO/INC
          INC       FMSSBUIO/INC
          INC       FMSSMAIO/INC
          INC       FMSTCFIO/INC
          INC       FMSTUPIO/INC
          INC       FMSUDACD    
          INC       PRCFMSAA    
          INC       PRCFMSUA    
.
          INC       STDGENCD
.

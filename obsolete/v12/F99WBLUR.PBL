.*****************************************************************************
.*    Program      : F99WBLUR                                                 *
.*    Description  : Conversion webluraf to new File layout                   *
.*                                                                           *
.*    Author       : Jill Habasque CAR 147606                                *
.*    Date         : 05/12/2007                                              *
.*    Modifications:                                                         *
.*****************************************************************************
.
.
.
          INC       STD001FD
.
.Data File Definition      
.--------------------      
WEBLURA1   IFILE    SQL, FIXED=381, KEY="U1-10"
.
.Name     Type      Length Physical Start Description
.----     ----      ------ -------- ----- -----------
WBLRUID   DIM       10     10       1     Web User ID
WBLRUR01  DIM       8      8        11    UR Number 1 (Most Recent Reference)
WBLRVS01  DIM       8      8        19    Visit number 1 (Most Recent Ref)
WBLRUR02  DIM       8      8        27    UR Number 2
WBLRVS02  DIM       8      8        35    Visit Number 2
WBLRUR03  DIM       8      8        43    UR Number 3
WBLRVS03  DIM       8      8        51    Visit Number 3
WBLRUR04  DIM       8      8        59    UR Number 4
WBLRVS04  DIM       8      8        67    Visit Number 4
WBLRUR05  DIM       8      8        75    UR Number 5
WBLRVS05  DIM       8      8        83    Visit Number 5
WBLRUR06  DIM       8      8        91    UR Number 6
WBLRVS06  DIM       8      8        99    Visit Number 6
WBLRUR07  DIM       8      8        107   UR Number 7
WBLRVS07  DIM       8      8        115   Visit Number 7
WBLRUR08  DIM       8      8        123   UR Number 8
WBLRVS08  DIM       8      8        131   Visit Number 8
WBLRUR09  DIM       8      8        139   UR Number 9
WBLRVS09  DIM       8      8        147   Visit Number 9
WBLRUR10  DIM       8      8        155   UR Number 10
WBLRVS10  DIM       8      8        163   Visit Number 10
WBLRUR11  DIM       8      8        171   UR Number 11
WBLRVS11  DIM       8      8        179   Visit Number 11
WBLRUR12  DIM       8      8        187   UR Number 12
WBLRVS12  DIM       8      8        195   Visit Number 12
WBLRUR13  DIM       8      8        203   UR Number 13
WBLRVS13  DIM       8      8        211   Visit Number 13
WBLRUR14  DIM       8      8        219   UR Number 14
WBLRVS14  DIM       8      8        227   Visit Number 14
WBLRUR15  DIM       8      8        235   UR Number 15
WBLRVS15  DIM       8      8        243   Visit Number 15
WBLRUR16  DIM       8      8        251   UR Number 16
WBLRVS16  DIM       8      8        259   Visit Number 16
WBLRUR17  DIM       8      8        267   UR Number 17
WBLRVS17  DIM       8      8        275   Visit Number 17
WBLRUR18  DIM       8      8        283   UR Number 18
WBLRVS18  DIM       8      8        291   Visit Number 18
WBLRUR19  DIM       8      8        299   UR Number 19
WBLRVS19  DIM       8      8        307   Visit Number 19
WBLRUR20  DIM       8      8        315   UR Number 20 (Oldest Reference)
WBLRVS20  DIM       8      8        323   Visit Number 20 (Oldest Reference)
WBLRSPAR  DIM       50     50       331   Spare
.
FINDFILE  FILE      ASCII, FIXED=256
.
OLDFILE    IFILE    SQL, FIXED=221, KEY="U1-10"      
.
CMDLINE   DIM       100
DIM4      DIM       4
DIM4A     DIM       4
DIM6      DIM       6
DIM6A     DIM       6
DIM60     DIM       60
DDCENT    DIM       2
.
RECNUM    FORM      8
NEWFILE   DIM       60
NEWPATH   DIM       60
OLDPATH   DIM       60
DEFPATH   DIM       60
SAVEFLG   FORM      1
SP50      INIT    "                                                  "
SP60      INIT    "                                                            "
.
PRGNAM    INIT      "CONVERSION WEBLURFD"
PRGID     INIT      "F99WBLUR"
VERSION   INIT      "V12.00.00"
.
. Start of Program
.
MAIN0000  CALL      INIT0000                      * init and open files
          BRANCH    EXIT,MAIN9999                 * init failure
.
          CALL      KDIR0000                      * Keyin directory
          BRANCH    EXIT,MAIN9999
.
          CALL      CONTQST                       * Ok to continue ?
          BRANCH    CEXIT,MAIN1000,MAIN0000,MAIN9999 * Yes, no, cancel
.
MAIN1000  CALL      PREP0000                      * preparing files
          BRANCH    EXIT,MAIN9999
.
. Loop thru old file and WRWBLUR1 records to new file
.
          CALL      READ0000                      * read old records and WRWBLUR1
          CALL      ENDP0000                      * save/compress saved file
.
MAIN9999  CHAIN     PGM
+
.********************************************************************
.*                          INIT0000                                *
.*  Display heading and check that the files needed exist&open them *
.********************************************************************
INIT0000  CALL      DISPHEAD
          MOVE      ZERO,RECNUM
          
INIT9999  RETURN
.
.********************************************************************
.*                          KDIR0000                                *
.*  Keyin directories                                               *
.********************************************************************
KDIR0000  MOVE      ONE,SAVEFLG        * Default to keep file
          KEYIN     *P1:10,*EL,"Do you want to save the original file (Y/N) ? ":
                    ANS;
          REP       "yYnN",ANS
          CMATCH    "Y",ANS
          GOTO      KDIR1000 IF EQUAL
          MOVE      ZERO,SAVEFLG       * not to keep file
          CMATCH    "N",ANS
          GOTO      KDIR1000 IF EQUAL
          BEEP
          GOTO      KDIR0000
.
KDIR1000  CALL      DEFT0000                * Get the default path
          BRANCH    EXIT,KDIR9999
          MOVE      SP60,OLDPATH
.
          DISPLAY   *P1:24,*EL,"The directory path must end with a slash (/) ";
.
          MOVE      DEFPATH,OLDPATH
          BRANCH    SAVEFLG,KDIR2000
.
.         Keyin the path for the original file
.
          KEYIN     *P1:12,*EL,"Keyin path for temporarily saving original ":
                    "file: ":
                    *P10:13,*EL,*DV,*RV,OLDPATH:
                    *P10:13,OLDPATH;
          GOTO      KDIR3000
.
KDIR2000  KEYIN     *P1:12,*EL,"Keyin path for saving original file: ":
                    *P10:13,*EL,*DV,*RV,OLDPATH:
                    *P10:13,OLDPATH;
.
KDIR3000  ENDSET    OLDPATH
          APPEND    SP60,OLDPATH
          RESET     OLDPATH
.
          MATCH     SP60,OLDPATH
          IF        @EQUAL
            PACK      OLDPATH,DEFPATH      * use the default
            DISPLAY   *P10:13,*EL,*V2LON,OLDPATH;
          ENDIF
.
          SQUEEZE   OLDPATH
          CMATCH    EXITCHAR,OLDPATH
          GOTO      KDIR9000 IF EQUAL
.
          PACK      DIM60,OLDPATH,SP60
          CALL      VALD0000         * check if it's a valid directory
          BRANCH    EXIT,KDIR1000
.
.         Keyin the path for the new file
.
KDIR5000  MOVE      SP60,NEWPATH
          MOVE      DEFPATH,NEWPATH
          KEYIN     *P1:15,*EL,"Keyin path for the new file: ":
                    *P10:16,*EL,*DV,*RV,NEWPATH:
                    *P10:16,NEWPATH;
          ENDSET    NEWPATH
          APPEND    SP60,NEWPATH
          RESET     NEWPATH
.
          MATCH     SP60,NEWPATH
          IF        @EQUAL
            PACK      NEWPATH,DEFPATH      * use the default
            DISPLAY   *P10:16,*V2LON,NEWPATH;
          ENDIF
.
          SQUEEZE   NEWPATH
          CMATCH    EXITCHAR,NEWPATH
          GOTO      KDIR9000 IF EQUAL
.
          PACK      DIM60,NEWPATH,SP60
          CALL      VALD0000         * check if it's a valid directory
          BRANCH    EXIT,KDIR5000
          GOTO      KDIR9999
.
KDIR9000  MOVE      ONE,EXIT
KDIR9999  DISPLAY   *P1:24,*EL;
          RETURN
+
.
.********************************************************************
.*                          PREP0000                                *
.*  Preparing files                                                 *
.********************************************************************
PREP0000 
. open old file
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      OLDFILE,"webluraf"
          TRAPCLR   IO
          BRANCH    OVRCD,PREP5000       * Original file does not exist
          CLOSE     OLDFILE
          DISPLAY   *P1:24,*EL,"Copying files ... Please wait !! ";
.
. Copy old file to the keyin directory
.
          PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          APPEND    "cp `ldat webluraf.dat` ",CMDLINE
          APPEND    OLDPATH,CMDLINE
          APPEND    "swbluraf.dat",CMDLINE
          APPEND    SP60,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CMATCH    "0",TASKID
          IF        !@EQUAL
            GOTO      PREP8000
          ENDIF
.
          PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          APPEND    "cp `ldat webluraf.idx` ",CMDLINE
          APPEND    OLDPATH,CMDLINE
          APPEND    "swbluraf.idx",CMDLINE
          APPEND    SP60,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CMATCH    "0",TASKID
          IF        !@EQUAL
            GOTO      PREP8000
          ENDIF
.
. remove the original files
.
          PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          APPEND    "iserase ",CMDLINE
          APPEND    DEFPATH,CMDLINE
          APPEND    "webluraf",CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CMATCH    "0",TASKID
          IF        !@EQUAL
            DISPLAY   *P1:24,*EL,*B,"Unable to remove the original file.  ";
            CALL      HITENTER
            GOTO      PREP9000
          ENDIF
.
. Opening old file after being copied
.
          MOVE      SP60,DIM60
          CLEAR     DIM60
          APPEND    OLDPATH,DIM60
          APPEND    "swbluraf",DIM60
          APPEND    SP60,DIM60
          RESET     DIM60
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      OLDFILE,DIM60
          TRAPCLR   IO
          IF        OVRCD = 1
            DISPLAY   *P1:24,*EL,*B,"Unable to open saved original file.  ";
            CALL      HITENTER
            GOTO      PREP9000
          ENDIF
.
. Create the new file
.
          DISPLAY   *P1:24,*EL,"Creating new files ... Please wait !! ";
          PACK      NEWFILE,SP60
          CLEAR     NEWFILE
          APPEND    NEWPATH,NEWFILE
          APPEND    "webluraf",NEWFILE
          APPEND    SP60,NEWFILE
          RESET     NEWFILE
          SQUEEZE   NEWFILE
.
PREP1000  PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          APPEND    "isbuild ",CMDLINE
          APPEND    NEWFILE,CMDLINE
.
.  The files new record length and unique key must be written here
.      eg    APPEND    " 195 U9-16",CMDLINE
.
          APPEND    " 381 u1-10",CMDLINE
          APPEND    SP60,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          OPEN      WEBLURA1,NEWFILE
.
. set the flag to say we want to continue
.
          DISPLAY   *P1:24,*EL;
          MOVE      ZERO,EXIT
          CALL      IBACLOCK
          REP       " 0",CDATE
          DISPLAY   *P1:18,"Started : ",CDATE,SP1,CTIMEIS:
                    *P1:20,"Record : "
          GOTO      PREP9999
.
PREP5000  DISPLAY   *P1:24,*EL,*B,"Old file not found.  ";
          CALL      HITENTER
          GOTO      PREP9000
.
PREP8000  DISPLAY   *P1:24,*EL,*B,"Unable to copy original file.  ":
                    "(Error: ",TASKID,")  ";
          CALL      HITENTER
.
PREP9000  MOVE      ONE,EXIT
PREP9999  RETURN
+
.**********************************************************************
.*                               READ0000                             *
.*             loop thru old file and WRWBLUR1 each record               *
.**********************************************************************
READ0000  DISPLAY   *P1:20,*EL,"Record No. : ";
          PACK      KEY10,SP60
          CALL      READSOLD                      * position at start
READ1000  CALL      READKOLD                      * read next record
          BRANCH    OVRCD,READ6000                * no more records
          ADD       ONE,RECNUM                    * update record counter
.
.  All necessary changes to the files field lengths, date changes
.  or any other sort of modification must be made here
.
.    eg    PACK      DSPARE,SP50
           PACK      WBLRUR10,SP10
           PACK      WBLRVS10,SP10
           PACK      WBLRUR11,SP10
           PACK      WBLRVS11,SP10
           PACK      WBLRUR12,SP10
           PACK      WBLRUR13,SP10
           PACK      WBLRVS13,SP10
           PACK      WBLRUR14,SP10
           PACK      WBLRVS14,SP10
           PACK      WBLRUR15,SP10
           PACK      WBLRVS15,SP10
           PACK      WBLRUR16,SP10
           PACK      WBLRVS16,SP10
           PACK      WBLRUR17,SP10
           PACK      WBLRVS17,SP10
           PACK      WBLRUR18,SP10
           PACK      WBLRVS18,SP10
           PACK      WBLRUR19,SP10
           PACK      WBLRVS19,SP10
           PACK      WBLRUR20,SP10
           PACK      WBLRVS20,SP10
.                                               * Pack key here
          CALL      WRWBLUR1                       * WRWBLUR1 to new file
.
          IF        (RECNUM%1000) = 0
            DISPLAY   *P15:20,*V2LON,RECNUM
          ENDIF
.
          GOTO      READ1000                      * get next record
.
READ6000  CLOSE     WEBLURA1                      * close new file
          CLOSE     OLDFILE                       * close old file
.
          CALL      IBACLOCK
          REP       " 0",CDATE
          DISPLAY   *P1:22,"Ended  : ",CDATE,SP1,CTIMEIS
.
READ9999  RETURN
.
+
.**********************************************************************
.*                               VALD0000                             *
.*        Check if it a valid directory                               *
.**********************************************************************
VALD0000  MOVE      ZERO,EXIT
          SQUEEZE   DIM60
          ENDSET    DIM60
          CMATCH    SLASH,DIM60
          IF        !@EQUAL
            DISPLAY   *P1:24,*EL,*B,"Directory path must end with a slash (/) ";
            CALL      HITENTER
            GOTO      VALD9000
          ENDIF
          RESET     DIM60
.
          PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          APPEND    "cd ",CMDLINE
          APPEND    DIM60,CMDLINE
          APPEND    SP60,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID      * check if exists
.
          CMATCH    "0",TASKID
          IF        !@EQUAL
            DISPLAY   *P1:24,*EL,*B,"Directory does not exist ";
            CALL      HITENTER
            GOTO      VALD9000
          ENDIF
          GOTO      VALD9999
.
VALD9000  MOVE      ONE,EXIT            * Not valid
VALD9999  RETURN
+
.**********************************************************************
.*                               ENDP0000                             *
.*        Remove or compress save file                                *
.**********************************************************************
ENDP0000  MOVE      SP60,DIM60
          CLEAR     DIM60
          APPEND    OLDPATH,DIM60        * set up the saved file with path
          APPEND    "swbluraf*",DIM60
          APPEND    SP60,DIM60
          RESET     DIM60
          SQUEEZE   DIM60
.
          PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          IF        SAVEFLG = 1
            APPEND    "compress -f ",CMDLINE
            APPEND    DIM60,CMDLINE
            APPEND    SP60,CMDLINE
            RESET     CMDLINE
            DISPLAY   *P1:24,*EL,"Compressing original file.. ":
                      "Please wait !!  ";
          ELSE
            APPEND    "rm ",CMDLINE
            APPEND    DIM60,CMDLINE
            APPEND    SP60,CMDLINE
            RESET     CMDLINE
            DISPLAY   *P1:24,*EL,"Removing original file.. Please wait !!  ";
          ENDIF
          EXECUTE   CMDLINE,TASKID      * check if exists
.
          CMATCH    "0",TASKID
          IF        !@EQUAL
            DISPLAY   *P1:24,*EL,*B,"Saved file not compressed or removed.  ";
            CALL      HITENTER
            GOTO      ENDP9999
          ENDIF
.
          CALL      IBACLOCK
          DISPLAY   *P1:24,*EL,*B,"Finish processing.  ";
          CALL      HITENTER
.
ENDP9999  RETURN
+
.**********************************************************************
.         Get the default directory
.**********************************************************************
DEFT0000  EXECUTE   "ldat webluraf.dat > temp.txt",TASKID
.
          PACK      DEFPATH,SP30,SP30
          CLOSE     FINDFILE
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      FINDFILE,"temp"
          TRAPCLR   IO
          BRANCH    OVRCD,DEFT3000
.
          READ      FINDFILE,SEQ;DEFPATH
          GOTO      DEFT3000 IF OVER
.
          ENDSET    DEFPATH
DEFT1000  CMATCH    "/",DEFPATH
          GOTO      DEFT2000 IF EQUAL
.
          BUMP      DEFPATH,-1
          GOTO      DEFT1000 IF NOT EOS
          GOTO      DEFT3000
.
DEFT2000  LENSET    DEFPATH
          RESET     DEFPATH
.
          PACK      DEFPATH,DEFPATH,SP30,SP30,SP30,SP30
          STRIP     DEFPATH
          ENDSET    DEFPATH
          RESET     DEFPATH
          CLOSE     FINDFILE
          MOVE      ZERO,EXIT
          GOTO      DEFT9999
.
DEFT3000  DISPLAY   *P1:24,*EL,*B,"Error finding webluraf.  ";
          CALL      HITENTER
          CLOSE     FINDFILE
          MOVE      ONE,EXIT
DEFT9999  RETURN
+
.**********************************************************************
. ---- OLD IO ROUTINES ----
.**********************************************************************
READSOLD  RESET     KEY10
          READ      OLDFILE,KEY10;;
          RETURN
.
READKOLD  MOVE      ZERO,OVRCD
          READKS    OLDFILE;WBLRUID,WBLRUR01,WBLRVS01,WBLRUR02,WBLRVS02:
                        WBLRUR03,WBLRVS03,WBLRUR04,WBLRVS04,WBLRUR05,WBLRVS05:
                        WBLRUR06,WBLRVS06,WBLRUR07,WBLRVS07,WBLRUR08,WBLRVS08:
                        WBLRUR09,WBLRVS09,WBLRUR10,WBLRVS10,WBLRSPAR
          GOTO      OVERCOND IF OVER
          RETURN
.
.
.
. WEBLURIO
. --------
. Filename     : webluraf.dat
.
RSWBLUR1  RESET     KEY10
          READ      WEBLURA1,KEY10;;
          RETURN
.
RAWBLUR1  RESET     KEY10
          MOVE      ZERO,OVRCD
          READ      WEBLURA1,KEY10;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
RDWBLUR1  RESET     KEY10
          MOVE      ZERO,OVRCD
          READ      WEBLURA1,KEY10;WBLRUID,WBLRUR01,WBLRVS01,WBLRUR02,WBLRVS02:
                        WBLRUR03,WBLRVS03,WBLRUR04,WBLRVS04,WBLRUR05,WBLRVS05:
                        WBLRUR06,WBLRVS06,WBLRUR07,WBLRVS07,WBLRUR08,WBLRVS08:
                        WBLRUR09,WBLRVS09,WBLRUR10,WBLRVS10,WBLRUR11,WBLRVS11:
                        WBLRUR12,WBLRVS12,WBLRUR13,WBLRVS13,WBLRUR14,WBLRVS14:
                        WBLRUR15,WBLRVS15,WBLRUR16,WBLRVS16,WBLRUR17,WBLRVS17:
                        WBLRUR18,WBLRVS18,WBLRUR19,WBLRVS19,WBLRUR20,WBLRVS20:
                        WBLRSPAR
          GOTO      OVERCOND IF OVER
          RETURN
.
RKWBLUR1
          MOVE      ZERO,OVRCD
          READKS    WEBLURA1;WBLRUID,WBLRUR01,WBLRVS01,WBLRUR02,WBLRVS02:
                        WBLRUR03,WBLRVS03,WBLRUR04,WBLRVS04,WBLRUR05,WBLRVS05:
                        WBLRUR06,WBLRVS06,WBLRUR07,WBLRVS07,WBLRUR08,WBLRVS08:
                        WBLRUR09,WBLRVS09,WBLRUR10,WBLRVS10,WBLRUR11,WBLRVS11:
                        WBLRUR12,WBLRVS12,WBLRUR13,WBLRVS13,WBLRUR14,WBLRVS14:
                        WBLRUR15,WBLRVS15,WBLRUR16,WBLRVS16,WBLRUR17,WBLRVS17:
                        WBLRUR18,WBLRVS18,WBLRUR19,WBLRVS19,WBLRUR20,WBLRVS20:
                        WBLRSPAR
          GOTO      OVERCOND IF OVER
          RETURN
.
RPWBLUR1
          MOVE      ZERO,OVRCD
          READKP    WEBLURA1;WBLRUID,WBLRUR01,WBLRVS01,WBLRUR02,WBLRVS02:
                        WBLRUR03,WBLRVS03,WBLRUR04,WBLRVS04,WBLRUR05,WBLRVS05:
                        WBLRUR06,WBLRVS06,WBLRUR07,WBLRVS07,WBLRUR08,WBLRVS08:
                        WBLRUR09,WBLRVS09,WBLRUR10,WBLRVS10,WBLRUR11,WBLRVS11:
                        WBLRUR12,WBLRVS12,WBLRUR13,WBLRVS13,WBLRUR14,WBLRVS14:
                        WBLRUR15,WBLRVS15,WBLRUR16,WBLRVS16,WBLRUR17,WBLRVS17:
                        WBLRUR18,WBLRVS18,WBLRUR19,WBLRVS19,WBLRUR20,WBLRVS20:
                        WBLRSPAR
          GOTO      OVERCOND IF OVER
          RETURN
.
UPWBLUR1
          UPDATE    WEBLURA1;WBLRUID,WBLRUR01,WBLRVS01,WBLRUR02,WBLRVS02:
                        WBLRUR03,WBLRVS03,WBLRUR04,WBLRVS04,WBLRUR05,WBLRVS05:
                        WBLRUR06,WBLRVS06,WBLRUR07,WBLRVS07,WBLRUR08,WBLRVS08:
                        WBLRUR09,WBLRVS09,WBLRUR10,WBLRVS10,WBLRUR11,WBLRVS11:
                        WBLRUR12,WBLRVS12,WBLRUR13,WBLRVS13,WBLRUR14,WBLRVS14:
                        WBLRUR15,WBLRVS15,WBLRUR16,WBLRVS16,WBLRUR17,WBLRVS17:
                        WBLRUR18,WBLRVS18,WBLRUR19,WBLRVS19,WBLRUR20,WBLRVS20:
                        WBLRSPAR
          GOTO      UPDFLOCK IF LOCKED
          RETURN
.
WRWBLUR1  RESET     KEY10
          WRITE     WEBLURA1,KEY10;WBLRUID,WBLRUR01,WBLRVS01,WBLRUR02,WBLRVS02:
                        WBLRUR03,WBLRVS03,WBLRUR04,WBLRVS04,WBLRUR05,WBLRVS05:
                        WBLRUR06,WBLRVS06,WBLRUR07,WBLRVS07,WBLRUR08,WBLRVS08:
                        WBLRUR09,WBLRVS09,WBLRUR10,WBLRVS10,WBLRUR11,WBLRVS11:
                        WBLRUR12,WBLRVS12,WBLRUR13,WBLRVS13,WBLRUR14,WBLRVS14:
                        WBLRUR15,WBLRVS15,WBLRUR16,WBLRVS16,WBLRUR17,WBLRVS17:
                        WBLRUR18,WBLRVS18,WBLRUR19,WBLRVS19,WBLRUR20,WBLRVS20:
                        WBLRSPAR
          RETURN
.
DEWBLUR1  RESET     KEY10
          DELETE    WEBLURA1,KEY10
          RETURN
.
RLWBLUR1  RESET     KEY10
          MOVE      ZERO,OVRCD
          READL     WEBLURA1,KEY10;WBLRUID,WBLRUR01,WBLRVS01,WBLRUR02,WBLRVS02:
                        WBLRUR03,WBLRVS03,WBLRUR04,WBLRVS04,WBLRUR05,WBLRVS05:
                        WBLRUR06,WBLRVS06,WBLRUR07,WBLRVS07,WBLRUR08,WBLRVS08:
                        WBLRUR09,WBLRVS09,WBLRUR10,WBLRVS10,WBLRUR11,WBLRVS11:
                        WBLRUR12,WBLRVS12,WBLRUR13,WBLRVS13,WBLRUR14,WBLRVS14:
                        WBLRUR15,WBLRVS15,WBLRUR16,WBLRVS16,WBLRUR17,WBLRVS17:
                        WBLRUR18,WBLRVS18,WBLRUR19,WBLRVS19,WBLRUR20,WBLRVS20:
                        WBLRSPAR
          GOTO      OVERCOND IF OVER
          GOTO      OVERLOCK IF LOCKED
          RETURN
.
KLWBLUR1
          MOVE      ZERO,OVRCD
          READLKS   WEBLURA1;WBLRUID,WBLRUR01,WBLRVS01,WBLRUR02,WBLRVS02:
                        WBLRUR03,WBLRVS03,WBLRUR04,WBLRVS04,WBLRUR05,WBLRVS05:
                        WBLRUR06,WBLRVS06,WBLRUR07,WBLRVS07,WBLRUR08,WBLRVS08:
                        WBLRUR09,WBLRVS09,WBLRUR10,WBLRVS10,WBLRUR11,WBLRVS11:
                        WBLRUR12,WBLRVS12,WBLRUR13,WBLRVS13,WBLRUR14,WBLRVS14:
                        WBLRUR15,WBLRVS15,WBLRUR16,WBLRVS16,WBLRUR17,WBLRVS17:
                        WBLRUR18,WBLRVS18,WBLRUR19,WBLRVS19,WBLRUR20,WBLRVS20:
                        WBLRSPAR
          GOTO      OVERCOND IF OVER
          GOTO      OVERLOCK IF LOCKED
          RETURN
.
PLWBLUR1
          MOVE      ZERO,OVRCD
          READLKP   WEBLURA1;WBLRUID,WBLRUR01,WBLRVS01,WBLRUR02,WBLRVS02:
                        WBLRUR03,WBLRVS03,WBLRUR04,WBLRVS04,WBLRUR05,WBLRVS05:
                        WBLRUR06,WBLRVS06,WBLRUR07,WBLRVS07,WBLRUR08,WBLRVS08:
                        WBLRUR09,WBLRVS09,WBLRUR10,WBLRVS10,WBLRUR11,WBLRVS11:
                        WBLRUR12,WBLRVS12,WBLRUR13,WBLRVS13,WBLRUR14,WBLRVS14:
                        WBLRUR15,WBLRVS15,WBLRUR16,WBLRVS16,WBLRUR17,WBLRVS17:
                        WBLRUR18,WBLRVS18,WBLRUR19,WBLRVS19,WBLRUR20,WBLRVS20:
                        WBLRSPAR
          GOTO      OVERCOND IF OVER
          GOTO      OVERLOCK IF LOCKED
          RETURN
.
UUWBLUR1  RESET     KEY10
          UNLOCK    WEBLURA1
          RETURN
          INC       STD001IO

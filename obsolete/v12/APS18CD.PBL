. ---------- Modification History ----------------------------------
.V10.02.01  07/04/2011 Mike Laming for Jill CAR 239574
.           Remove CALL to ' IBAPRNT1,"ibaprntf" '
. 27.03.2009 Sandra Barcham               CAR 172763
.            Added FMCOEPWC into standard laser layout
. 30.07.2007 Sandra Barcham              CAR 146314
.            Re-used cheque layout 4 (DVC) for Modbury
. 20.05.2002 Raghunandan Surve,HPS -      SRF17025
.            Moved cheque layout for Mercy down by half-a-line !
. 14.05.2002 Raghunandan Surve,HPS -      SRF17025
.            Moved cheque layout for Mercy up by one line 
. 14.05.2002 Raghunandan Surve,HPS -      SRF17025  
.            Copied over changes for Mercy cheque layout from f.01
.  3.09.2001 Glenn Saunders srf 10799 (continuation from D.Matthews)
.            Correct Hutt Valley printing to be consistent with f.01 version.   
.            (Find FMCOAPCH = 14)
. 22.08.2001 Glenn Saunders srf 10799 (continuation from D.Matthews)
.            Amend printing of cheques for Mercy (Dunedin)                      
.            (Find FMCOAPCH = 23)
. 26.06.2001 Dave Matthews  
.            Amend printing of cheques for Mercy (Dunedin)                      
.            (Find FMCOAPCH = 23)
. 10.04.2001 Dave Matthews  
.            Alter processing for new cheque layout for Hutt Valley NZ          
.            (Find FMCOAPCH = 14)
. 12.12.2000 Charles Handaya
.            Add in new MHD layout for Mercy Hospital Dunedin in Laser printer
. 27.11.2000 Sandra Barcham 
.            Add in BAS Code
. 23.10.2000 Charles Handaya
.            Add in new HWK layout that copied from 0=std
. 12.10.2000 Charles Handaya
.            Add a Date printed at Cheque Remittance for Layout 19
.            srf 6645 
. 18.09.2000 Charles Handaya
.            Fix CHC layout
. 04.08.2000 Charles Handaya
.            Add in new STH layout
.            srf 647056
. 07.01.2000 Charles Handaya
.            Fix LTR layout
.            srf 636139
. 09.11.1999 Sandra Barcham
.            Fix LTR layout
. 11.07.1999 Sandra Barcham
.            Add in new LTR layout
. 01.07.1999 Sandra Barcham
.            Add in new LAS layout
. 13.05.1999 Sandra Barcham
.            Add in new SVB layout
. 17.09.1998 Sandra Barcham
.            Add in keyword maintenance for non-specific creditors
. 13.03.1998 Sandra Barcham
.            Add in new STV layout
. 29.01.1998 Sandra Barcham
.            Move STD amount right 2 characters 
. 07.01.1998 Sandra Barcham
.            Change to new cheque layout for ACC
.            srf 622472 Quote 9012
. 18.11.1997 Sandra Barcham
.            Change to new cheque layout for ACC & WGH
.            srf 622472 Quote 9012 & 622882
. 31.10.1997 Sandra Barcham
.            Change HSP layout
.            srf 622558
. 14.10.1997 Sandra Barcham
.            Change STD layout for epworth
.            srf 622235
.            Change BUD for new cheque layout
. 12.09.1997 Sandra Barcham
.            Add in new HSP layout
.            srf 621687
.            Check STD layout against epworth cheques
. 13.08.1997 Sandra Barcham
.            Add in new WWH layout
.            srf 621337
. 12.08.1997 Sandra Barcham
.            Move *f to bottom of cheque for HUT 
.            Fix invoice date on HUT layout
.            srf 621071 & 621292
. 27.05.1997 Sandra Barcham
.            Add in new Hutt cheque layout
. 07.04.1997 Sandra Barcham
.            Add in new standard cheque layout
.            srf 619570
. 04.11.1996 Sandra Barcham
.            Add in SAR & Mater cheque layout
.            Quotes 8781 & 8783
. 09.10.1996 Sandra Barcham
.            Fix WGH layout for STV
.            srf 617368
. 03.09.1996 Sandra Barcham
.            Add in Hawkesbury Cheque layout
.            srf 616354 quote 8717
. 13.06.1996 Sandra Barcham
.            Change Buderim Cheque Layout
.            srf 615591 quote 8682
. 30.05.1996 Sandra Barcham
.            Added Buderim Cheque Layout
.            quote 8682
. 12.09.1995 B.G.Ackland
.            Fixed Credit Not Outstanding Problem
.            srf 611052
. 31.10.1994 Robert Sumsion
.            Moved PVH Layout down 2 lines.
. 19.08.1994 Robert Sumsion 
.            New Cheque Layout for Pioneer Valley.
.            srf 129566 quote 8060 
. 02.02.1994 Robert Sumsion
.            Changed so that batch update could not be done if period is locked
.            srf 126933
. 05.01.1994 Robert Sumsion
.            Not updating cheque number if go over page (and 1st cancelled)
.            srf 127118
. 15.03.1993 S.Barcham
.            Fix paying of credit notes.
.            srf 120955
. 13.07.1993 N.Dye
.            Modify Tamara layout
.            srf 123857
.-------------------------------------------------------------------
. Update Creditors Payments, Print Cheques and Remittances
.           and create General Ledger batch details.
.-------------------------------------------------------------------
UPDT0000  IF        PERLOCK=1
            BEEP
            CLEAR     DISPMSG
            APPEND    "Period is Locked - ",DISPMSG
            RESET     DISPMSG
            CALL      MESSAGE1
            MOVE      TRUE,EXIT
            GOTO      UPDT9999
          ENDIF
.
          CALL      CKPPY000          * check if proposed payments active
.
          CALL      CBAT0000              * Check Batch
          BRANCH    EXIT,UPDT9990         * Batch Not Balanced Exit
.
          CALL      CHQPRT00              * Cheque Printing Options
          BRANCH    EXIT,UPDT9990
.
          CLOSE     SCRSBGA1
          CLOSE     SCRPSTA1
          CLOSE     SCRPSTA2
          CLOSE     SCRSLTA1
.
          CALL      INITB000              * Initialise Files & Parameters
.
          CALL      UCHNO000              * Update Cheque Numbers
.
          CALL      UPINV000              * Update Original Invoices Payment
.
          CALL      UPFMS000              * Update General Ledger Batch
.
          CALL      CLOSE000              * Close Files etc
.
          OPEN      SCRSBGA1,"scrsbgaf"
          OPEN      SCRPSTA1,"scrpstaf"
          OPEN      SCRPSTA2,"scrpstaf"
          OPEN      SCRSLTA1,"scrsltaf"
.
          MOVE      TWO,EXIT              * Restart Screen
          GOTO      UPDT9999
.
UPDT9990  MOVE      THREE,EXIT            * Restore Screen
.
UPDT9999  MOVE      SP70,APMACRD
          RETURN
.----------------------------------------------------------
. Close Files Not Required & Update Batch Header with Date
.----------------------------------------------------------
CLOSE000  CLOSE     APSTMPA1,DELETE
          CLOSE     APSGSTA1,DELETE
.
          PACK      KEY5,APBMBCH
          PACK      APBMUDT,CCC,CYY,CMM,CDD
          REP       " 0",APBMUDT
          CALL      RAAPBM1
          IF        OVRCD=0
            CALL      UPAPBM1
            CALL      UUAPBM1         * Unlock Record
          ENDIF
          RETURN
.----------------------------------------------------------------------
. Create Input Record for G.S.T.
.----------------------------------------------------------------------
MVINP000  MOVE     APIMBCH,APINBCH
          MOVE     APIMCRD,APINCRD
          MOVE     APIMREF,APINREF
          MOVE     APIMDOC,APINDOC
          MOVE     SP70,APINORD
          MOVE     "  1",APINLIN
          MOVE     SP70,APINCAT
          MOVE     ZERO,APINQTY
          MOVE     ZERO,APINUCT
          MOVE     ZERO,APINPAY
          MOVE     SP6,APINBASC
          MOVE     SP6,APINCGS
          MOVE     SP70,APINSPA
          RETURN
.----------------------------------------------------------------------
. Create Batch for FMS system
.----------------------------------------------------------------------
UPFMS000  CALL      MKBAT000           * Create Batch and Write Initail Sectors
.
          DISPLAY   *P1:24,*EL
          PACK      KEY40,APBMBCH,SP70
          CALL      RSAPIM1
.
UPFMS100  CALL      RKAPIM1            * Read Through Invoices
          BRANCH    OVRCD,UPFMS900
          MATCH     APBMBCH,APIMBCH
          GOTO      UPFMS900 IF NOT EQUAL
          DISPLAY   *P1:24,"Processing FMS Creditor : ",*V2LON,APIMCRD,*HOFF:
                    "  Ref : ",*V2LON,APIMDOC
          MATCH     "~~",APIMCRD
          IF        @EQUAL
            UNPACK    APIMCRD,KEY2,KEY3
            PACK      KEY8,APBMBCH,KEY3
            CALL      RDAPNS1
            MOVE      APNSNA1,APMACN1
          ELSE
            MOVE      APIMCRD,KEY5
            CALL      RDAPMA1
          ENDIF
.
          PACK      KEY51,APIMBCH,APIMCRD,APIMREF,APIMDOC,SP70
          PACK      KEY40,APIMBCH,APIMCRD,APIMREF,APIMDOC
          CALL      RSAPIN1
.
UPFMS110  CALL      RKAPIN1           * Read Through Allocations
          BRANCH    OVRCD,UPFMS100
          PACK      KEY51,APINBCH,APINCRD,APINREF,APINDOC,SP70
          MATCH     KEY40,KEY51
          GOTO      UPFMS100 IF NOT EQUAL
.
          CALL      WRBCH000          * Update Batch Record
          CALL      ALGST000          * Allocate Gst
          GOTO      UPFMS110
.
. Update Batch Header and Write Control Account Records
.----------------------------------------------------------------------
UPFMS900  ADD       ONE,BC0NXTSC
          WEOF      BATFILE,BC0NXTSC
          MOVE      BC1ACCT,BC1KEYT
          CALL      WRBAT1
.
          CALL      CCTR0000           * Update Totals in Batch
          CALL      UPGL0000           * Update Batch Queue
.
UPFMS999  RETURN
.----------------------------------------------------------------------
. Create Batch
.----------------------------------------------------------------------
MKBAT000  MOVE      APBMBCH,BC1BATCH
          MOVE      ZERO,BC0BTCHT
          MOVE      SP2,BC0DIM2
          MOVE      TWO,BC0NXTSC
          MOVE      ZERO,BC0NXTSW
          MOVE      ONE,BC0SUPBC
          MOVE      SP6,BC0DIM6
          MOVE      ZERO,BC0SPLTK
          MOVE      ZERO,BC0SPLTP
          MOVE      ONE,BC0ONE
          MOVE      ZERO,BC0SPSEC
          MOVE      ZERO,BC0DISC
.
          CLEAR     FNAME
          APPEND    "bch",FNAME
          APPEND    BC1BATCH,FNAME
          APPEND    ".txt",FNAME
          RESET     FNAME
          PREP      BATFILE,FNAME
          CALL      WRBAT0
.
          MOVE      FIVE,BC1STAT
          MOVE      "HD",BC1HEAD
          MOVE      BC1BATCH,BCBATCH
          MOVE      ZERO,BC1KEYT
          MOVE      ZERO,BC1ACCT
          MOVE      ZERO,BC1NOTR
.
          UNPACK    APBMDAT,CCENT,CYEAR,CMON,CDAY
          PACK      BC1DATE,CDAY,CMON,CCENT,CYEAR
          REP       " 0" IN BC1DATE
          MOVE      APBMOPR,BC1OPER
          MOVE      APBMLED,BC1LEDG
          MOVE      BC1LEDG,BCLEDG
          MOVE      "PY",BC1TRAN
          UNPACK    APBMADT,CCENT,CYEAR,CMON,CDAY
          PACK      BC1BDATE,CDAY,CMON,CCENT,CYEAR
          REP       " 0" IN BC1BDATE
          MOVE      ZERO,BC1REORG
.         MOVE      APBMDIS,BC1DISS
          MOVE      BC1DISS,BCDISS
          MOVE      SP2,BC1PAYT
.         MOVE      APBMRES,BC1RESP
          MOVE      BC1RESP,BCRESP
          MOVE      ZERO,BC1REST
          MOVE      ZERO TO BC1UTYPE
.
          CALL      WRBAT1
.
          RETURN
.----------------------------------------------------------------------
. Write Batch Transaction
.----------------------------------------------------------------------
WRBCH000  MOVE      "PY",BCTRAN
          MOVE      APINLED,BCLEDG
          MOVE      APINACC,BCACCTP
          MOVE      APINAMT,BCAMT
          MOVE      APINREF,BCREFER
          MOVE      APINDES,BCTRAND
          MOVE      APINRES,BCRESP
          MOVE      APINDIS,BCDISS
          MOVE      SP70,BCBASC
          IF        BASFLAG=1
            MOVE      APINBASC,BCBASC
          ENDIF
          UNPACK    APIMDDT,CCENT,CYEAR,CMON,CDAY
          PACK      BCDATED,CDAY,CMON,CCENT,CYEAR
          REP       " 0" IN BCDATED
.
          CALL      RDBATS0
          ADD       ONE,BC0NXTSC
          CALL      WRBATS0
          SUB       ONE FROM BC0NXTSC
.
          MOVE      FIVE,BCSTAT
          MOVE      APIMTER,BCPAYT
          MOVE      APIMCRD,BCRED
          UNPACK    APIMIDT,CCENT,CYEAR,CMON,CDAY
          PACK      BCDATEE,CDAY,CMON,CCENT,CYEAR
          REP       " 0" IN BCDATEE
          MOVE      "00000000",BCDATCX
          MOVE      ZERO,BCINVT
          MOVE      ZERO,BCDISC
          MOVE      "0",BCCOMX
          MOVE      ZERO,BCCOMXA
          MOVE      SP70,BCCONT
          MOVE      SP70,BCDISCC
.
          PACK      KEY2,APINLED
          CALL      RDFMLA1
          PACK      KEY14,APINLED,APINACC,SP70
          CALL      GBNK0000         * get control accounts
.
          MATCH     "~~",APINCRD
          IF        @EQUAL
            MOVE      APINACC,BCACCT *  Account Code
          ELSE     
            MATCH     SP70,APINREF
            IF        @EQUAL
              MOVE      APINACC,BCACCT *  Account Code
            ELSE
              MATCH     ANSZ,APINPAYG
              IF        !@EQUAL
                MOVE      FMCSCRD,BCACCT
              ELSE
                MOVE      FMLAPAYG,BCACCT
              ENDIF
              UNPACK    APINDES,KEY5,KEY15,KEY8,KEY3,KEY1
              MOVE      KEY1,F1
              CLEAR     BCTRAND
              IF        F1=0
                APPEND    "Inv. Batch : ",BCTRAND
              ELSE
                APPEND    "Cr.  Batch : ",BCTRAND
              ENDIF
              APPEND    KEY5,BCTRAND
              APPEND    "  Ord. : ",BCTRAND
              APPEND    KEY8,BCTRAND
              RESET     BCTRAND
            ENDIF
          ENDIF
.         
          MOVE      FMCSBNK,BCCONT
          PACK      KEY14,APINLED,FMCSBNK,SP70
          CALL      RDAPTM1
          BRANCH    OVRCD,WRBCH100
.
          ADD       BCAMT,APTMAMT
          CALL      UPAPTM1
          GOTO      WRBCH200
.
WRBCH100  UNPACK    KEY14,APTMLED,APTMACC
          MOVE      BCAMT,APTMAMT
          CALL      WRAPTM1
.
WRBCH200  MOVE      APBMCHQ,BCCHQAC
          UNPACK    APINDOC,KEY7,BCORD 
          MOVE      APMACN1,BCCDESC
.
          CALL      WRBATC
          ADD       ONE,BC0NXTSC
          ADD       ONE,BC1NOTR
          ADD       BCAMT,BC1KEYT
          ADD       BCAMT,BC1ACCT
          WEOF      BATFILE,BC0NXTSC
.
WRBCH999  RETURN
.
.******************************************************************************
. Post Control Account Transactions
.******************************************************************************
CCTR0000  MOVE      "00000",BCRED
          UNPACK    APBMDAT,CCENT,CYEAR,CMON,CDAY
          PACK      BCDATEE,CDAY,CMON,CCENT,CYEAR
          REP       " 0" IN BCDATEE
          UNPACK    APBMADT,CCENT,CYEAR,CMON,CDAY
          PACK      BCDATED,CDAY,CMON,CCENT,CYEAR
          REP       " 0" IN BCDATED
          MOVE      ZERO,BCINVT
          MOVE      ZERO,BCDISC
          MOVE      BC1RESP TO BCRESP
          MOVE      SP70 TO BCTRAND
          MOVE      "PAYMENT ",BCORD
          MOVE      "PAYMENT        ",BCREFER
          MOVE      FMCOPDIS TO BCDISS
.
          MOVE      SP70,KEY14
          CALL      RSAPTM1
CCTR8000  CALL      RKAPTM1
          BRANCH    OVRCD,CCTR9999
          MOVE      APTMAMT,BCAMT
.
          MOVE      "JC" TO BCTRAN
.
          MOVE      APTMLED,BCLEDG
          MOVE      APTMACC,BCACCT
          MOVE      APTMACC,BCACCTP
.
          CALL      WBCH0000                * Write Record Back to Batch file
.
          GOTO      CCTR8000                * for General Ledger
.
CCTR9999  MOVE      "PY",BCTRAN
          RETURN
.**********************************************************************
. Add Control Account Transactions to Batch
.**********************************************************************
WBCH0000  UNPACK    APBMADT,CCENT,CYEAR,CMON,CDAY
          PACK      BCDATED,CDAY,CMON,CCENT,CYEAR
          REP       " 0" IN BCDATED
          MOVE      "5",BCSTAT
          MOVE      SP70,BCDATCX
          MOVE      "N",BCCOMX
          MOVE      ZERO,BCCOMXA
          MOVE      SP70,BCCONT
          MOVE      SP70,BCDISCC
          MOVE      SP70,BCCEORD
          MOVE      SP70,BCCELNE
          MOVE      SP70,BCCATA
          MOVE      SP3,BCBASC
          CALL      RDBATS0
          ADD       ONE,BC0NXTSC
          CALL      WRBATS0
          SUB       ONE,BC0NXTSC
          CALL      WRBATC
.
          CALL      RDBAT1
          ADD       ONE,BC1NOTR
          MOVE      "5",BC1STAT
          CALL      WRBAT1
.
          RETURN
.----------------------------------------------------------------------
. Update Control File in General Ledger
.----------------------------------------------------------------------
UPGL0000
          CALL      RDBATS0
          MOVE      BC1BATCH,F5
          MOVE      F5,FMBCBAT
          MOVE      "2",FMBCSTA
          MOVE      BC0NXTSC,FMBCSEC
          MOVE      BC1ACCT,FMBCTOT
          MOVE      ZERO,FMBCDIS
          MOVE      BC1OPER,FMBCUID
          MOVE      BC1LEDG,FMBCLED
          MOVE      BC1TRAN,FMBCTRT
          MOVE      BC0SUPBC,FMBCINV
.
          UNPACK    BC1DATE,CDAY,CMON,CCENT,CYEAR
          PACK      FMBCDAT,CCENT,CYEAR,CMON,CDAY
          UNPACK    BC1BDATE,CDAY,CMON,CCENT,CYEAR
          PACK      FMBCPDAT,CCENT,CYEAR,CMON,CDAY
          PACK      FMBCCDAT,CCENT,CYEAR,CMON,CDAY
.
          MOVE      SP70,FMBCSPAR
          PACK      KEY5,APBMBCH
          UNPACK    KEY5,FMBCBAT
          CALL      RAFMBC1
          IF        OVRCD=0
            CALL      UPFMBC1
          ELSE
            CALL      WRFMBC1
          ENDIF
UPGL9999  RETURN
.**********************************************************************
. Temp file IO routines
.**********************************************************************
RSAPTM1   RESET     KEY14
          READ      APSTMPA1,KEY14;;
          RETURN
.
RAAPTM1   RESET     KEY14
          MOVE      ZERO,OVRCD
          READ      APSTMPA1,KEY14;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
RDAPTM1   RESET     KEY14
          MOVE      ZERO,OVRCD
          READ      APSTMPA1,KEY14;APTMLED,APTMACC,APTMAMT
          GOTO      OVERCOND IF OVER
          RETURN
.
RKAPTM1   MOVE      ZERO,OVRCD
          READKS    APSTMPA1;APTMLED,APTMACC,APTMAMT
          GOTO      OVERCOND IF OVER
          RETURN
.
RPAPTM1   MOVE      ZERO,OVRCD
          READKP    APSTMPA1;APTMLED,APTMACC,APTMAMT
          GOTO      OVERCOND IF OVER
          RETURN
.
UPAPTM1   UPDATE    APSTMPA1;APTMLED,APTMACC,APTMAMT
          RETURN
.
WRAPTM1   RESET     KEY14
          WRITE     APSTMPA1,KEY14;APTMLED,APTMACC,APTMAMT
          RETURN
.
DEAPTM1   RESET     KEY14
          DELETE    APSTMPA1,KEY14
          RETURN
.
RSAPGS1   RESET     KEY14
          READ      APSGSTA1,KEY14;;
          RETURN
.
RDAPGS1   RESET     KEY14
          MOVE      ZERO,OVRCD
          READ      APSGSTA1,KEY14;APGSLED,APGSACC,APGSAMT
          GOTO      OVERCOND IF OVER
          RETURN
.
RKAPGS1   MOVE      ZERO,OVRCD
          READKS    APSGSTA1;APGSLED,APGSACC,APGSAMT
          GOTO      OVERCOND IF OVER
          RETURN
.
UPAPGS1   
          UPDATE    APSGSTA1;APGSLED,APGSACC,APGSAMT
          RETURN
.
WRAPGS1   RESET     KEY14
          WRITE     APSGSTA1,KEY14;APGSLED,APGSACC,APGSAMT
          RETURN
.
DEAPGS1   RESET     KEY14
          DELETE    APSGSTA1,KEY14
          RETURN
.
.-----------------------------------------------
. Check batch totals for balance here.
.-----------------------------------------------
CBAT0000  MOVE      ZERO,BATCHCAL
          MOVE      TWO,EXIT           * set to no records found
          PACK      KEY40,APBMBCH,SP70
          CALL      RSAPIM1
CBAT0100
          CALL      RKAPIM1
          BRANCH    OVRCD,CBAT0900
          MATCH     APBMBCH,APIMBCH
          GOTO      CBAT0900 IF NOT EQUAL
          MOVE      ZERO,EXIT          * set to records found
          ASSIGN    APIMTOT+APIMGST-APIMDIS+BATCHCAL,BATCHCAL
          MOVE      ZERO,ALLTOTAL
          PACK      KEY51,APIMBCH,APIMCRD,APIMREF,APIMDOC,SP70
          PACK      KEY40,APIMBCH,APIMCRD,APIMREF,APIMDOC
          CALL      RSAPIN1
CBAT0200
          CALL      RKAPIN1
          BRANCH    OVRCD,CBAT0300
          PACK      KEY51,APINBCH,APINCRD,APINREF,APINDOC,SP70
          MATCH     KEY40,KEY51
          GOTO      CBAT0300 IF NOT EQUAL
          ADD       APINAMT,ALLTOTAL
          GOTO      CBAT0200
CBAT0300                                   * Flag as Updated
          IF        !(APIMTOT-APIMDIS=ALLTOTAL)
            PACK       DISPMSG,SP70,SP70
            APPEND     "Unbalanced. Cred/Ref : ",DISPMSG
            APPEND     APIMCRD,DISPMSG
            APPEND     SLASH,DISPMSG
            APPEND     APIMDOC,DISPMSG
            RESET      DISPMSG
            CALL       MESSAGE2
            MOVE       "%",ANS
            PACK       DISPMSG,APIMCRD,SLASH,APIMREF,SLASH:
                               APIMDOC,ANS,ALLTOTAL,ANS
            SQUEEZE    DISPMSG
            REP        "% ",DISPMSG
            DISPLAY    *P1:24,*+,"Unbal Crd/Ref ",DISPMSG;
            CALL       HITENTER
            CALL       MESSAGE3
            MOVE       ONE,EXIT
            GOTO       CBAT9999
          ENDIF
          GOTO      CBAT0100
CBAT0900
          IF        !(BATCHCAL=APBMTOT)
            MOVE      "Batch Unbalanced. ",DISPMSG
            CALL       MESSAGE1
            MOVE       ONE,EXIT
            GOTO       CBAT9999
          ENDIF
          IF        EXIT=TWO
            MOVE      "No Transactions in this Batch. ",DISPMSG
            CALL      MESSAGE1
            MOVE      ONE,EXIT
            GOTO       CBAT9999
          ENDIF
CBAT9999  RETURN
.
.----------------------------------------
. Read parameters & Open Files
.----------------------------------------
INITB000  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,SIXTY6;*62,FMCOPDIS
.
. Create Temp File APSTMPxx
.--------------------------
          PACK      TMPFILE,APSTMPPY,PORT
          REP       " 0",TMPFILE
          PACK      MAKETMP,MAKE,TMPFILE,INDEX
          PACK      KILLTMP,KILL,TMPFILE
.
          CLOSE     APSTMPA1
          EXECUTE   KILLTMP,TASKID
          EXECUTE   MAKETMP,TASKID
          OPEN      APSTMPA1,TMPFILE
.
          PACK      TMPFILE,APSGSTPY,PORT
          REP       " 0",TMPFILE
          PACK      MAKETMP,MAKE,TMPFILE,INDEX
          PACK      KILLTMP,KILL,TMPFILE
.
          CLOSE     APSGSTA1
          EXECUTE   KILLTMP,TASKID
          EXECUTE   MAKETMP,TASKID
          OPEN      APSGSTA1,TMPFILE
.
          RETURN
.----------------------------------------------------------------------
. Write Details to creditors for G.S.T.
.----------------------------------------------------------------------
ALGST000  COMPARE   ZERO,APINGST
          GOTO      ALGST999 IF EQUAL
.
          MOVE      APINLED,KEY2
          CALL      RDFMLA1
          BRANCH    OVRCD,ALGST999
.
          PACK      KEY14,APINLED,APINACC
          CALL      RDFMAM1
          BRANCH    OVRCD,ALGST999
.
          CALL      RFMCOT00        * Determine GST Control Account
.
          MOVE      APINLED,APINLED
          MOVE      FMCSAGST,APINACC
          MOVE      APINGST,APINAMT
          CALL      MVINP000          * Move in Fields
          CALL      WRBCH000          * Update Batch Record
.
ALGST999  RETURN
.----------------------------------------------------------------------
. Print Cheques Routine
.----------------------------------------------------------------------
CHQPRT00  CALL      FINCHQ00  * Find out if any cheques need to be printed
          BRANCH    EXIT,CHQPRT90,CHQPRT97
.
          CALL      CHQINT00  * Initialise Parameters and Printer System
CHQPRT10  CALL      CHQOPT00  * Input Options 0 Exit 1 Align 2 Print 
          BRANCH    EXIT,CHQPRT20,CHQPRT30
          MOVE      ONE,EXIT
          GOTO      CHQPRT95
.
CHQPRT20  CALL      CHQAL000  * Print Cheque Alignment
          GOTO      CHQPRT10
.
CHQPRT30  CALL      CHQNUM00  * Enter First Cheque Number
          BRANCH    EXIT,CHQPRT10
.
          CALL      CPRINT00  * Print Cheques
.
CHQPRT35  KEYIN     *P1:24,*EL,"Cheque Print Complete. Continue Update (":
                    *V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,ANS
          REP       UPPLOW,ANS
          MOVE      ONE,EXIT
          MATCH     "N",ANS
          GOTO      CHQPRT40 IF EQUAL
          MATCH     "Y",ANS
          GOTO      CHQPRT35 IF NOT EQUAL
          MOVE      ZERO,EXIT
          GOTO      CHQPRT95
.
CHQPRT40  KEYIN     *P1:24,*EL,"If you quit here, cheques will ":
                    "have to be reprinted. Continue Update (":
                    *V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,ANS
          REP       UPPLOW,ANS
          MOVE      ONE,EXIT
          MATCH     "N",ANS
          GOTO      CHQPRT95 IF EQUAL
          MATCH     "Y",ANS
          GOTO      CHQPRT40 IF NOT EQUAL
          MOVE      ZERO,EXIT
          GOTO      CHQPRT95
.
CHQPRT90  KEYIN     *P1:24,*EL,"No Cheque to Print. Continue Update (":
                    *V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,ANS
          REP       UPPLOW,ANS
          MOVE      ONE,EXIT
          MATCH     "N",ANS
          GOTO      CHQPRT99 IF EQUAL
          MATCH     "Y",ANS
          GOTO      CHQPRT90 IF NOT EQUAL
          MOVE      ZERO,EXIT
          GOTO      CHQPRT99
.
CHQPRT95  CLOSE     IBACODE1
...       CLOSE     IBAPRNT1                                          *D-249574
          GOTO      CHQPRT99
.
CHQPRT97  MOVE      ONE,EXIT           * negative cheque found
.
CHQPRT99  RETURN
.----------------------------------------------------------------------
. Determine if Any Cheques Require Printing
. returns EXIT - 0=yes, 1=no, 2=negative cheque found
.----------------------------------------------------------------------
FINCHQ00  MOVE      ONE,EXIT
          MOVE      "999.99",LASTTOT
          PACK      KEY5,SP70
          PACK      KEY40,APBMBCH,SP70
          CALL      RSAPIM1
FINCHQ10
          CALL      RKAPIM1
          BRANCH    OVRCD,FINCHQ90
          MATCH     APBMBCH,APIMBCH
          GOTO      FINCHQ90 IF NOT EQUAL
.
          MATCH     "Cheque Print",APIMDOC
          IF        @EQUAL
            MOVE      ZERO,EXIT
          ENDIF
.
          MATCH     KEY5,APIMCRD       * end of last creditor ?
          IF        !@EQUAL
            IF        !(LASTTOT>0)
              CLEAR     DISPMSG        * negative cheque found ?
              APPEND    "Payment to Creditor ",DISPMSG
              APPEND    KEY5,DISPMSG
              APPEND    " Must Be Greater Than Zero - ",DISPMSG
              CALL      MESSAGE1
              MOVE      TWO,EXIT
              GOTO      FINCHQ99
            ENDIF
            MOVE      ZERO,LASTTOT     * set up for next creditor
            MOVE      APIMCRD,KEY5
          ENDIF
.
          ASSIGN    APIMTOT-APIMDIS+APIMGST+LASTTOT,LASTTOT
          GOTO      FINCHQ10
.
FINCHQ90  
            IF        !(LASTTOT>0)
              CLEAR     DISPMSG        * negative cheque found ?
              APPEND    "Payment to Creditor ",DISPMSG
              APPEND    KEY5,DISPMSG
              APPEND    " Must Be Greater Than Zero - ",DISPMSG
              CALL      MESSAGE1
              MOVE      TWO,EXIT
              GOTO      FINCHQ99
            ENDIF
.
FINCHQ99  RETURN
.----------------------------------------------------------------------
. Initialise Printer System & Parameters for Cheque Printing
.----------------------------------------------------------------------
CHQINT00  CALL      RDFMCO50
          MOVE      "24",MAXLINES
          IF        FMCOAPCH=1
            MOVE      "27",MAXLINES
          ENDIF
          IF        FMCOAPCH=2
            MOVE      "24",MAXLINES
          ENDIF
          IF        FMCOAPCH=3
            MOVE      "39",MAXLINES
          ENDIF
          IF        FMCOAPCH=4
            MOVE      "29",MAXLINES
          ENDIF
          IF        FMCOAPCH=5
            MOVE      "20",MAXLINES
          ENDIF
          IF        FMCOAPCH=6
            MOVE      "24",MAXLINES
          ENDIF
          IF        FMCOAPCH=7
            MOVE      "12",MAXLINES
          ENDIF
          IF        FMCOAPCH=8
            MOVE      "27",MAXLINES
          ENDIF
          IF        FMCOAPCH=9
            MOVE      "13",MAXLINES
          ENDIF
          IF        FMCOAPCH=10
            MOVE      "27",MAXLINES
          ENDIF
          IF        FMCOAPCH=11
            MOVE      "24",MAXLINES
          ENDIF
          IF        FMCOAPCH=12
            MOVE      "24",MAXLINES
          ENDIF
          IF        FMCOAPCH=13
            MOVE      "23",MAXLINES
          ENDIF
          IF        FMCOAPCH=14
            MOVE      "24",MAXLINES
          ENDIF
          IF        FMCOAPCH=15
            MOVE      "24",MAXLINES
          ENDIF
          IF        FMCOAPCH=16
            MOVE      "28",MAXLINES
          ENDIF
          IF        FMCOAPCH=17
            MOVE      "37",MAXLINES
          ENDIF
          IF        FMCOAPCH=18
            MOVE      "27",MAXLINES
          ENDIF
          IF        FMCOAPCH=19
            MOVE      "28",MAXLINES
          ENDIF
          IF        FMCOAPCH=20
            MOVE      "27",MAXLINES
          ENDIF
          IF        FMCOAPCH=21
            MOVE      "24",MAXLINES
          ENDIF
          IF        FMCOAPCH=22
            MOVE      "24",MAXLINES
          ENDIF
          IF        FMCOAPCH=23
            MOVE      "28",MAXLINES
          ENDIF
.
          OPEN      IBACODE1,"ibacodef"
...       OPEN      IBAPRNT1,"ibaprntf"                               *D-239574
          CALL      SELPRINT
          DISPLAY   *P1:3,*EF
          RETURN
.----------------------------------------------------------------------
. Cheque Printing Options
.----------------------------------------------------------------------
CHQOPT00  KEYIN     *P1:24,"Cheque Printing Options : ":
                    *V2LON,"0. ",*HOFF,"Exit, ":
                    *V2LON,"1. ",*HOFF,"Print Alignment, ":
                    *V2LON,"2. ",*HOFF,"Print Cheques  ? ",*V2LON,EXIT
          COMPARE   ZERO,EXIT
          GOTO      CHQOPT99 IF EQUAL
          BRANCH    EXIT,CHQOPT99,CHQOPT99
          BEEP
          GOTO      CHQOPT00
.
CHQOPT99  RETURN
.----------------------------------------------------------------------
. Enter First Cheque Number
.----------------------------------------------------------------------
CHQNUM00  
          KEYIN     *P1:24,"Enter First Cheque Number : ",*EL,*V2LON,CHEQNUMB:
                    *P28:24,*DV,CHEQNUMB,*HOFF,"   Ok (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,ANS
          REP       UPPLOW,ANS
          MATCH     NO,ANS
          GOTO      CHQNUM00 IF EQUAL
          MATCH     YES,ANS
          GOTO      CHQNUM00 IF NOT EQUAL
          MOVE      ZERO,EXIT
          MOVE      CHEQNUMB,CHEQNUMB
          IF        CHEQNUMB=0
            MOVE      ONE,EXIT
            GOTO      CHQNUM99
          ENDIF
          IF        CHEQNUMB<0
            MOVE      ONE,EXIT
            GOTO      CHQNUM99
          ENDIF
          PACK      FMBNREF,SP7,CHEQNUMB
          PACK      KEY36,APBMCHQ,ZERO,FMBNREF,SP70
          CALL      RSFMBN2
          CALL      RKFMBN2
          BRANCH    OVRCD,CHQNUM90
.
          PACK      KEY31,FMBNBNK,FMBNTYP,FMBNREF,SP70
          MATCH     KEY31,KEY36
          GOTO      CHQNUM90 IF NOT EQUAL
.
          DISPLAY   *P1:24,*EL,*B,"Cheque No. Already Exists - ";
          CALL      HITENTER
          GOTO      CHQNUM00
.
CHQNUM90
          MOVE      SP70,APMACRD
          PACK      FMBNREF,SP7,CHEQNUMB
          CALL      CKDOC000
          IF        OVRCD=1
            SQUEEZE   FMBNREF
            CLEAR     DISPMSG
            APPEND    "Cheque ",DISPMSG
            APPEND    FMBNREF,DISPMSG
            APPEND    " Used in Batch ",DISPMSG
            APPEND    APCLBCH,DISPMSG
            APPEND    " For Cred ",DISPMSG
            APPEND    APCLCRD,DISPMSG
            APPEND    " - ",DISPMSG
            CALL      MESSAGE1
            PACK      FMBNREF,FMBNREF,SP70
            GOTO      CHQNUM00
          ENDIF
.
CHQNUM99  RETURN
.----------------------------------------------------------------------
. Alignment Print
.----------------------------------------------------------------------
CHQAL000  CALL      OPNPRINT
          CALL      RDFMCO50
          BRANCH    FMCOAPCH,CHQAL010,CHQAL020,CHQAL030,CHQAL040,CHQAL050:
                             CHQAL060,CHQAL070,CHQAL080,CHQAL090,CHQAL100:
                             CHQAL110,CHQAL120,CHQAL130,CHQAL140,CHQAL150:
                             CHQAL160,CHQAL170,CHQAL180,CHQAL190,CHQAL200:
                             CHQAL210,CHQAL220,CHQAL230
.
.---- standard cheque layout ----
.
          PRINT     *F,*N,*N,*N:
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"***********************   ****":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*62,"**********.**":
                    *N,*N,*N,*2,"***** ***** ***** ***** ***** ***** 00"
          GOTO      CHQAL900
.
.---- HLC cheque layout ----
.
CHQAL010  PRINT     *F,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,"****************************************":
                    "***************************************":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*64,"********.**":
                    *N,*N,*N:
                    *N,*15," *****  *****  *****  *****  *****  *****   00"
          GOTO      CHQAL900
.
.---- hastings cheque layout ----
.
CHQAL020  PRINT     *F,*65,"********":
                    *N,*65,"********":
                    *N,*65,"*****":
                    *N,*N:
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"***********************   ****":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *5,"******************************":
                    *43,"********",*58,"**********.**",*N,*N,*N,*N:
                    *14,"*****  ","*****",SP2,"*****",SP2,"*****",SP2,"*****":
                    SP2,"*****",SP2,"*****",SP4,"**"
          GOTO      CHQAL900
.
.---- West Gippsland Hospital ----
.
CHQAL030  PRINT     *F,*N,*N,*N,*N:
                    *N,*66,"**/**/**",*N,*N,*N,*N:
                    *6,"*****",SP3,"*****",SP2,"*****",SP3,"*****",SP3,"*****":
                    SP3,"*****",SP2,"**":
                    *N,*60,"**********.**":
                    *N,*N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"***********************   ****":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*3,"*************",SP2,"**/**/**",SP3,"********.**":
                    SP1,"**************",SP2,"**/**/**",SP3,"********.**":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *3,"************",SP2,"**/**/**",SP3,"********.**":
                    SP1,"*************",SP2,"**/**/**",SP3,"********.**":
                    *N,*N,*N,*68,"********.**"
          GOTO      CHQAL900
.
.---- MOD ----
.
.
CHQAL040  PRINT     *N,*N,*N,*N,*N,*N:
                    *10,"******************************":
                    *4,"XXXXX",*11,"*************************":
                    *N,*N,*3,"INVOICE NO",*19,"DATE",*36,"AMOUNT":
                    *44,"INVOICE NO",*60,"DATE",*76,"AMOUNT":
                    *N:
                    *N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*52,"Total Cheque: ","9999999999.99",*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*69,"99 XXX 99",*N,*N:
                    *9,"*****",SP1,"*****",SP1,"*****",SP1,"*****",SP1,"*****":
                    SP2,"*****",SP1,"*****",SP2,"99",*N,*N:
                    *N,*12,"*************************",*65,"9999999999.99":
                    *N,*12,"*************************":
                    *N,*12,"*************************":
                    *N,*12,"*************************":
                    *N,*N,*N,*N,*N
          GOTO      CHQAL900
.
.---- TAM cheque layout ----
.
CHQAL050  PRINT     *F,*65,"********":
                    *N,*65,"********":
                    *N,*65,"*****":
                    *N,*N,*N,*N,*N,*N,*N:
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"***********************   ****":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *5,"******************************":
                    *43,"********",*58,"**********.**",*N,*N,*N,*N:
                    *14,"*****  ","*****",SP2,"*****",SP2,"*****",SP2,"*****":
                    SP2,"*****",SP2,"*****",SP4,"**"
          GOTO      CHQAL900
.
.---- ACC cheque layout ----
.
CHQAL060  PRINT     *F,*N,*N,*N,*N,*N,*N:
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"***********************   ****":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*59,"XX/XX/XX":
                    *N,*N,*N,*N,*4,"***** ***** ***** ***** ***** ***** 00":
                    *55,"**********.**"
          GOTO      CHQAL900
.
.---- GreyM ----
.
CHQAL070  PRINT     *F,*N,*N,*N,*N,*N:
                    *N,*06,"******************************":
                    *N,*06,"******************************":
                    *N,*06,"******************************":
                    *N,*06,"******************************":
                    *N,*06,"***********************   ****":
                    *N,*42,"**/**/****":
                    *N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N:
                    *N:
                    *N,*61,"********.**":
                    *N,*N,*N,*64,"**/**/****":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *09,"******************************",*N:
                    *09,"******************************":
                    *60,"*********.**",*N:
                    *11,"***** ***** ***** ***** ***** ***** ****** 00",*N:
                    *04,"***** ***** **** ***** **** **** ***** ***** ***** 00"
          GOTO      CHQAL900
.
.---- PVH ----
.
CHQAL080  PRINT     *F,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    "****************************************":
                    "***************************************":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*61,"********.**":
                    *N,*N,*N:
                    *N,*13," *****  *****  *****  *****  *****  *****   00"
          GOTO      CHQAL900
.
.---- Buderim ----
.
CHQAL090  PRINT     *N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*4,"**/**/**":
                    *16,"*****",SP1,"*****",SP1,"*****",SP2,"*****",SP1,"*****":
                    SP1,"*****",SP2,"**":
                    *N,*N,*61,"********.**":
                    *N,*14,"******************************":
                    *N,*14,"******************************":
                    *N,*14,"******************************":
                    *N,*14,"******************************":
                    *N,*14,"***********************   ****":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N: 
                    *N,*3,"**********",SP2,"********.**":
                    SP3,"**********",SP3,"********.**":
                    SP3,"**********",SP2,"********.**":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *3,"**********",SP2,"********.**":
                    SP3,"**********",SP3,"********.**":
                    SP3,"**********",SP2,"********.**":
                    *N,*68,"********.**",*N
          GOTO      CHQAL900
.
.---- Hawkesbury cheque layout ----
.
CHQAL100  PRINT     *F,*N,*N,*N,*N,*N:
                    *N,*17,"******************************":
                    *N,*17,"******************************":
                    *N,*17,"******************************":
                    *N,*17,"******************************":
                    *N,*N,*N,*N:
                    *06,"*************************************":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *06,"*************************************":
                    *N,*N,*N,*18,"*****",*27,"*******",*36,"999999999.99":
                    *50,"99999.99",*62,"9999999999.99":
                    *N,*N,*N,*N,*N,*N,*N,*N,*60,"99/99/99",*N,*N:
                    *03,"*************************************",*N:
                    *03,"*************************************",*N,*N:
                    *08,"*************************************":
                    *N,*57,"9999999999.99"
          GOTO      CHQAL900
.
.---- St Andrews Rockhampton cheque layout ----
.
CHQAL110  PRINT     *F,*N,*N,*N,*N:
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"***********************   ****":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*2,"***** ***** ***** ***** ***** **** 00":
                    *59,"**********.**"
          GOTO      CHQAL900
.
.---- Mater cheque layout ----
.
CHQAL120  PRINT     *F,*N,*N,*N,*N:
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"***********************   ****":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*2,"***** ***** ***** ***** ***** **** 00":
                    *57,"**********.**"
          GOTO      CHQAL900
.
.---- New standard cheque layout ----
.
CHQAL130  PRINT     *F,*N,*N,*N,*N:
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"***********************   ****":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*2,"***** ***** ***** ***** ***** ***** 00":
                    *N,*57,"**********.**"
          GOTO      CHQAL900
.
.---- HUT ----
.
CHQAL140  PRINT     *N,*N,*N,*06,"******************************":
                    *N,*06,"******************************":
                    *N,*06,"******************************":
                    *N,*06,"******************************":
                    *N,*06,"***********************   ****":
                    *N,*N,"*****",*43,"DD/MM/YY":
                    *N,*48,"Cheque Number ","********":
                    *N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*57,"**********.**":
                    *N,*N,*N,*N,*N:
                    *N,*70,"********":
                    *N,*N,*N,*N,*N,*N,*N:
                    *N,*06,"**********************************":
                    *N,*N,*60,"*********.**":
                    *N,*09,"*ZERO *ZERO *ZERO *ZERO *ZERO *ZERO 00": 
                    *N,*N,*N,*N,*N,*N,*N,*N,*N
          GOTO      CHQAL900
.
.---- West Wimmera cheque layout ----
.
CHQAL150  PRINT     *N,*N,*N,*N,*N:
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"***********************   ****":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*4,"*ZERO *ZERO *ZERO *ZERO *ZERO *ZERO 00":
                    *56,"**********.**",*N,*N,*N,*N,*N,*N,*N,*N,*N,*N
          GOTO      CHQAL900
.
.---- Holy Spirit cheque layout ----
.
CHQAL160  PRINT     *N,*N,*N,*N:
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"***********************   ****":
                    *N,*65,"99999999",*N,*N,*18,"XXXXX",*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*55,"**********.**",*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*53,"99/99/99",*N,*N,*N:
                    *3,"XXXXX XXXXX XXXXX XXXXX XXXXX  XXXXX 00":
                    *N,*66,"9999999999.99",*N:
                    *N,*8,"******************************":
                    *N,*8,"******************************",*N:
                    *N,*N,*N
          GOTO      CHQAL900
.
.---- St Vincents Melbourne ----
.
CHQAL170  PRINT     *F,*N,*N,*N,*N:
                    *N,*N,*N:
                    *7,"**/**/**":
                    *20,"*****",SP2,"*****",SP1,"*****",SP1,"*****":
                    SP2,"*****",SP2,"*****",SP1,"**":
                    *N,*N,*N,*62,"**********.**":
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"***********************   ****":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*3,"*************",SP2,"**/**/**",SP3,"********.**":
                    SP1,"**************",SP2,"**/**/**",SP3,"********.**":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *3,"************",SP2,"**/**/**",SP3,"********.**":
                    SP1,"*************",SP2,"**/**/**",SP3,"********.**":
                    *N,*N,*N,*68,"********.**"
          GOTO      CHQAL900
.
.---- SVB ----
.
CHQAL180  PRINT     *F,*N,*N,*N,*N,*N:
                    *N,*6,"****************************************":
                    *N,*6,"****************************************":
                    *N,*6,"****************************************":
                    *N,*6,"****************************************":
                    *N,*N,*N:
                    *7,"99/99/99",*17,"**************",*31,"**":
                       *38,"***************",*62,"***********.**":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *7,"99/99/99",*17,"**************",*31,"**":
                       *38,"***************",*62,"***********.**":
                    *N,*N,*N,*18,"*****",*27,"99999999",*36,"********.**":
                          *61,"********.**":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *2,"*************",*49,"99999999",*61,"99/99/99":
                    *N,*N,*N,*N:
                    *2,"*****  *****  *****  *****  *****  *****   00":
                          *58,"********.**"
          GOTO      CHQAL900
.
.---- Standard Laser cheque layout ----
.
CHQAL190  PRINT     *N,*N,*N,*N:
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"***********************   ****":
                    *N,*65,"99999999",*N,*N,*18,"XXXXX",*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*55,"**********.**",*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*53,"99/99/99",*N,*N,*N:
                    *3,"XXXXX XXXXX XXXXX XXXXX XXXXX  XXXXX 00":
                    *N,*66,"9999999999.99",*N:
                    *N,*8,"******************************":
                    *N,*8,"******************************",*N:
                    *N,*N,*N
          GOTO      CHQAL900
.
.---- Latrobe Regional Laser cheque layout ----
.
CHQAL200  PRINT     *N,*N,*N,*N: 
                    *N,*4,"******************************": 
                    *N,*4,"******************************":
                    *N,*4,"******************************":
                    *N,*4,"******************************":
                    *N,*4,"***********************   ****",*52,"99999999":
                    *N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*67,"**********.**",*N:
                    *N,*N,*N,*N,*N,*N,*N,*66,"99/99/9999",*N:
                    *N,*8,"******************************":
                    *N,*8,"******************************":
                    *N,*N,*7,"XXXXX XXXXX XXXXX XXXXX XXXXX XXXXX XXXXX 00":
                    *66,"9999999999.99",*N,*N:
                    *N,*N,*N,*N
          GOTO      CHQAL900
.
.---- STH cheque layout ----
.
CHQAL210  PRINT     *F,*N,*N,*N:
                    *N,*10,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*10,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*10,"XXXXXXXXXXXXXXXXXXXXXXXXX":                        
                    *N,*10,"XXXXXXXXXXXXXXXXXXXXXXXXX":
                    *N,*10,"XXXXXXXXXXXXXXXXXXXXXXXXX 999999":                 
                    *N,*63,"99999999":                                         
                    *N,*N,*10,"99999":                                         
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:                             
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:                             
                    *N,*N,*N,*N,*N,*N,*N:                                      
                    *N,*62,"*********.**",*N,*N:
                    *N,*66,"99/99/9999":
                    *N,*N,*N,*N,*N,*N,*N,*N:                                   
                    *07,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",*N:                   
                    *07,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",*N:
                    *57,"*********.**",*N:                                    
                    *10,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",*N:    
                    " XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
          GOTO      CHQAL900
.
.---- HWK (Hawkes Bay) cheque layout ----
.
CHQAL220  PRINT     *F,*N,*N,*N:
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"******************************":
                    *N,*10,"***********************   ****":
                    *N,*63,"********":
                    *N,*18,"*****":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N:
                    *N,*63,"**/**/****":
                    *N,*N,*N,*N:
                    *N,*18,"*****************************":
                    *N,*18,"*****************************":
                    *N,*N:
                    *N,*62,"**********.**":
                    *N,*4,"***** ***** ***** ***** ***** ***** 00"
          GOTO      CHQAL900
.
.---- MHD (Mercy Hospital Dunedin) cheque layout ----
.
CHQAL230  PRINT     *N,*N,*N:
                    *N,*10:
                    *SUBSCR,"******************************",*SUOFF:
                    *N,*10:
                    *SUBSCR,"******************************",*SUOFF:
                    *N,*10:
                    *SUBSCR,"*************************",*SUOFF:
                    *N,*10:
                    *SUBSCR,"*************************",*SUOFF:
                    *N,*10:
                    *SUBSCR,"************************* ******",*SUOFF:
                    *N,*71:
                    *SUBSCR,"********",*SUOFF:
                    *N,*18:
                    *SUBSCR,"*****",*SUOFF:
                    *N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N:
                    *N,*66,*SUBSCR,"**********.**",*SUOFF:
                    *N,*N:
                    *N,*66,*SUBSCR,"**/**/****",*SUOFF:
                    *N,*N,*N,*N,*N:
                    *N,*09:
                    *SUBSCR,"******************************",*SUOFF:
                    *N,*09:
                    *SUBSCR,"******************************",*SUOFF:
                    *N,*N:
                    *N,*64,*SUBSCR,"*********.**",*SUOFF:
                    *N,*14:
                    *SUBSCR,"***** ***** ***** ***** ***** *****",*SUOFF:
                    *N,*4,*SUBSCR,"**********",*SUOFF
          GOTO      CHQAL900
.
CHQAL900  DISPLAY   *P1:24,*EL
          CALL      CLSPRINT
          RETURN 
.----------------------------------------------------------------------
. Print Cheques
.----------------------------------------------------------------------
CPRINT00  CALL      OPNPRINT
          MOVE      SP70,LASTCRED
          MOVE      ZERO,DOLLARS
          MOVE      ZERO,TOTALINV
          MOVE      ZERO,TOTALCRD
          PACK      KEY40,APBMBCH,SP70
          DISPLAY   *P1:24,*EL,"Printing Cheque : "
          CALL      RSAPIM1
.
CPRINT10  CALL      RKAPIM1
          BRANCH    OVRCD,CPRINT90
          MATCH     APBMBCH,APIMBCH
          GOTO      CPRINT90 IF NOT EQUAL
.
          MATCH     "Cheque Print",APIMDOC
          GOTO      CPRINT10 IF NOT EQUAL
.
          MOVE      APIMCM1,COMMENT1
          MOVE      APIMCM2,COMMENT2
          PACK      SAVKEY40,APIMBCH,APIMCRD,APIMREF,APIMDOC
.
          MATCH     APIMCRD,LASTCRED     * Same Creditor ?
          GOTO      CPRINT30 IF EQUAL
.
          CALL      CHCHQ000             * check if cheque to be printed
          IF        EXIT=1
            PACK      KEY40,APIMBCH,APIMCRD,Z70
            CALL      RSAPIM1
            GOTO      CPRINT10
          ELSE
            PACK      KEY40,SAVKEY40,SP70
            CALL      RDAPIM1
          ENDIF
.
          MATCH     SP70,LASTCRED        * First Creditor ?
          IF        !@EQUAL
            CALL      CHQEN000           * Print End of Cheque
            DISPLAY   *P18:24,*V2LON,CHEQNUMB
            CALL      CHQUPD00           * Update Last Creditor with Cheque No.
            MOVE      SAVKEY40,KEY40
            CALL      RDAPIM1
            ADD       ONE,CHEQNUMB
            MOVE      ZERO,DOLLARS
            MOVE      ZERO,TOTALINV
            MOVE      ZERO,TOTALCRD
          ENDIF
.
          MOVE      APIMCRD,LASTCRED
          MATCH     "~~",APIMCRD         * Non Specific Creditor
          IF        @EQUAL
            UNPACK    APIMCRD,KEY2,KEY3
            MOVE      APIMCRD,APMACRD
            PACK      KEY8,APIMBCH,KEY3
            CALL      RDAPNS1
            MOVE      APNSNA1,APMACN1
            MOVE      APNSNA2,APMACN2
            MOVE      APNSAD1,APMACA1
            MOVE      APNSAD2,APMACA2
            MOVE      APNSAD3,APMACA3
            MOVE      APNSPC,APMACPC
          ELSE
            MOVE      APIMCRD,KEY5      * Specific Creditor
            CALL      RDAPMA1
          ENDIF
.
          CALL      CHQHE000            * Print Cheque Header
.
CPRINT30  
          MATCH     "~~",APIMCRD
          GOTO      CPRINT70 IF EQUAL
          MATCH     SP70,APIMREF
          GOTO      CPRINT70 IF EQUAL
.
          PACK      KEY40,APIMBCH,APIMCRD,APIMREF,APIMDOC,SP70
          PACK      KEY51,APIMBCH,APIMCRD,APIMREF,APIMDOC,SP70
          MOVE      SP70,REFERENC
          MOVE      SP70,REFEREN1
          MOVE      SP70,KEY35
          MOVE      ZERO,DRAMT
          MOVE      ZERO,CRAMT
          CALL      RSAPIN1
CPRINT40
          CALL      RKAPIN1
          BRANCH    OVRCD,CPRINT60
          PACK      KEY51,APINBCH,APINCRD,APINREF,APINDOC,SP70
          MATCH     KEY40,KEY51
          GOTO      CPRINT60 IF NOT EQUAL
.
          UNPACK    APINDES,KEY5,KEY15,KEY8,KEY3,KEY1
          PACK      SKEY16,KEY15,KEY1,SP70
          MOVE      KEY1,F1
.
          MATCH     SP70,REFEREN1           * First
          IF        @EQUAL
            PACK      REFERENC,SKEY16,SP70
            PACK      REFEREN1,SKEY16,SP70
            MOVE      APINDES,KEY35
          ENDIF
.
          MATCH     REFEREN1,SKEY16
          IF        @EQUAL
            IF        F1=0
              ASSIGN    DRAMT+APINAMT+APINGST,DRAMT
            ELSE
              ASSIGN    CRAMT-APINAMT-APINGST,CRAMT
            ENDIF
          ELSE
            MOVE      SP70,APIMCM1
            MOVE      SP70,APIMCM2
            UNPACK    KEY35,APIMBCH,APIMDOC,ORDER
            PACK      KEY40,APIMBCH,APIMCRD,APIMREF,APIMDOC
            CALL      RDAPIM1
            UNPACK    APIMIDT,CCENT,CYEAR,CMON,CDAY
            MATCH     "0",APIMTYP
            IF        @EQUAL
              MOVE      "IN",TRANTYP2
              MOVE      "Invoice",TRANTYP7
            ELSE
              MOVE      "CR",TRANTYP2
              MOVE      "Credit ",TRANTYP7
            ENDIF
            CALL      CHQLI000
.
            PACK      REFERENC,SKEY16,SP70
            PACK      REFEREN1,SKEY16,SP70
            MOVE      APINDES,KEY35
            MOVE      ZERO,DRAMT
            MOVE      ZERO,CRAMT
            IF        F1=0
              ASSIGN    DRAMT+APINAMT+APINGST,DRAMT
            ELSE
              ASSIGN    CRAMT-APINAMT-APINGST,CRAMT
            ENDIF
            MOVE      SAVKEY40,KEY40
            CALL      RDAPIM1
          ENDIF
.
          GOTO      CPRINT40
.
CPRINT60  
          MOVE      SP70,APIMCM1
          MOVE      SP70,APIMCM2
          UNPACK    KEY35,APIMBCH,APIMDOC,ORDER
          PACK      KEY40,APIMBCH,APIMCRD,APIMREF,APIMDOC
          CALL      RDAPIM1
          UNPACK    APIMIDT,CCENT,CYEAR,CMON,CDAY
          MATCH     "0",APIMTYP
          IF        @EQUAL
            MOVE      "IN",TRANTYP2
            MOVE      "Invoice",TRANTYP7
          ELSE
            MOVE      "CR",TRANTYP2
            MOVE      "Credit ",TRANTYP7
          ENDIF
          CALL      CHQLI000
          MOVE      SAVKEY40,KEY40
          CALL      RDAPIM1
          GOTO      CPRINT10
.
CPRINT70  UNPACK    APIMIDT,CCENT,CYEAR,CMON,CDAY
          ASSIGN    APIMTOT+APIMGST,DRAMT
          MOVE      ZERO,CRAMT
          PACK      REFERENC,APIMREF,SP70
          PACK      REFEREN1,APIMREF,APIMTYP,SP70
          MOVE      SP70,ORDER
          MOVE      "IN",TRANTYP2
          MOVE      "Invoice",TRANTYP7
          CALL      CHQLI000
          GOTO      CPRINT10
.----------------------------------------------
. End of Print
.----------------------------------------------
CPRINT90  MATCH     SP70,LASTCRED        * First Creditor ? 
          IF        !@EQUAL
            CALL      CHQEN000           * Print End of Cheque
            DISPLAY   *P18:24,*V2LON,CHEQNUMB
            CALL      CHQUPD00           * Update Last Creditor with Cheque No.
            ADD       ONE,CHEQNUMB
          ENDIF
.
          DISPLAY   *P1:24,*EL
          CALL      CLSPRINT
.
          RETURN
.----------------------------------------------------------------------
. Print Cheque Remittance Line
.----------------------------------------------------------------------
. Variables Required
.---------------------
. DRAMOUNT    DIM   13
. CRAMOUNT    DIM   13
. TTAMOUNT    DIM   13
. DRAMT       FORM  10.2
. CRAMT       FORM  10.2
. TTAMT       FORM  10.2
. TRANTYP2    DIM   2        IN or CR
. TRANTYP7    DIM   7        Invoice or Credit
. REFERENC    DIM   15
. ORDER       DIM   8
.----------------------------------------------------------------------
CHQLI000  MOVE      CLNO,TESTLINE
          IF        FMCOAPCH<>9
            MATCH     SP70,APIMCM1
            IF        !@EQUAL
              ADD       ONE,TESTLINE
            ENDIF
.
            MATCH     SP70,APIMCM2
            IF        !@EQUAL
              ADD       ONE,TESTLINE
            ENDIF
          ENDIF
.
CHQLI010  COMPARE   MAXLINES,TESTLINE
          CALL      CHQNX000 IF NOT LESS
.
          IF        FMCOAPCH<>9
            ADD       ONE,CLNO
          ENDIF
.
          UNPACK    APIMIDT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
.
          MOVE      CMON,F2
          LOAD      MONTHD FROM F2 OF JAN,FEB,MAR,APR,MAY,JUN:
                                      JUL,AUG,SEP,OCT,NOV,DEC
          REP       " 0",CDAY
          REP       " 0",CYEAR
          PACK      DATED,CDAY,SP1,MONTHD,SP1,CYEAR
.
          MOVE      SP70,DRAMOUNT
          MOVE      SP70,CRAMOUNT
          IF        !(DRAMT=0)
            MOVE      DRAMT,DRAMOUNT
            ADD       DRAMT,TOTALINV
          ENDIF
          IF        !(CRAMT=0)
            MOVE      CRAMT,CRAMOUNT
            ADD       CRAMT,TOTALCRD
          ENDIF
          ASSIGN    DRAMT-CRAMT,TTAMT
          MOVE      TTAMT,TTAMOUNT
          ADD       TTAMT,DOLLARS
.
          BRANCH    FMCOAPCH,CHQLI020,CHQLI030,CHQLI040,CHQLI050,CHQLI060:
                             CHQLI070,CHQLI080,CHQLI090,CHQLI100,CHQLI110:
                             CHQLI120,CHQLI130,CHQLI140,CHQLI150,CHQLI160:
                             CHQLI170,CHQLI180,CHQLI190,CHQLI200,CHQLI210:
                             CHQLI220,CHQLI230,CHQLI240
.
.---- standard cheque layout ----
.
          PRINT     *2,CPDATE,SP2,REFERENC,ORDER,SP3:
                    TRANTYP7,SP3,CRAMOUNT,DRAMOUNT
.
          MATCH     SP70,APIMCM1
          IF        !@EQUAL
            MOVE      APIMCM1,KEY50
            PRINT     *10,KEY50
            ADD       ONE,CLNO
          ENDIF
.
          MATCH     SP70,APIMCM2
          IF        !@EQUAL
            MOVE      APIMCM2,KEY50
            PRINT     *10,KEY50
            ADD       ONE,CLNO
          ENDIF
          GOTO      CHQLI999
.
.---- HLC cheque layout ----
.
CHQLI020  PRINT     *10,CPDATE,SP2,REFERENC,SP1:
                    TRANTYP2,SP1,DRAMOUNT,CRAMOUNT,TTAMOUNT
.
          MATCH     SP70,APIMCM1
          IF        !@EQUAL
            MOVE      APIMCM1,KEY50
            PRINT     *20,KEY50
            ADD       ONE,CLNO
          ENDIF
.
          MATCH     SP70,APIMCM2
          IF        !@EQUAL
            MOVE      APIMCM2,KEY50
            PRINT     *20,KEY50
            ADD       ONE,CLNO
          ENDIF
          GOTO      CHQLI999
.
.---- hastings cheque layout ----
.
CHQLI030  PRINT     *2,CPDATE,SP2,REFERENC,ORDER,SP3:
                    TRANTYP7,SP3,CRAMOUNT,DRAMOUNT
.
          MATCH     SP70,APIMCM1
          IF        !@EQUAL
            MOVE      APIMCM1,KEY50
            PRINT     *10,KEY50
            ADD       ONE,CLNO
          ENDIF
.
          MATCH     SP70,APIMCM2
          IF        !@EQUAL
            MOVE      APIMCM2,KEY50
            PRINT     *10,KEY50
            ADD       ONE,CLNO
          ENDIF
          GOTO      CHQLI999
.
.---- West Gippsland ----- 
.
CHQLI040  BRANCH    PRTSIDE,CHQLI045
          PRINT     *3,REFERENC,SP1,CPDATE,TTAMOUNT,SP1;
          SUB       ONE,CLNO
          MOVE      ONE,PRTSIDE
          GOTO      CHQLI046
.
CHQLI045  PRINT     REFERENC,SP1,CPDATE,SP1,TTAMOUNT
          MOVE      ZERO,PRTSIDE
          GOTO      CHQLI046
.
CHQLI046  MATCH     SP70,APIMCM1
          IF        !@EQUAL
            IF        PRTSIDE=0
              PRINT     *3,APIMCM1
              ADD       ONE,CLNO
            ELSE
              PRINT     " "
              PRINT     *3,APIMCM1
              ADD       TWO,CLNO
              MOVE      ZERO,PRTSIDE
            ENDIF
          ENDIF
.
          MATCH     SP70,APIMCM2
          IF        !@EQUAL
            IF        PRTSIDE=0
              PRINT     *3,APIMCM2
              ADD       ONE,CLNO
            ELSE
              PRINT     " "
              PRINT     *3,APIMCM2
              ADD       TWO,CLNO
              MOVE      ZERO,PRTSIDE
            ENDIF
          ENDIF
          GOTO      CHQLI999
.
.---- MOD ----
.
CHQLI050  BRANCH    PRTSIDE,CHQLI055
          PRINT     *3,REFERENC,SP1,DATED," ",TTAMOUNT,SP2;
          SUB       ONE,CLNO
          MOVE      ONE,PRTSIDE
          GOTO      CHQLI999
.
CHQLI055  PRINT     REFERENC,SP1,DATED,TTAMOUNT
          MOVE      ZERO,PRTSIDE
          GOTO      CHQLI999
.
.---- TAM cheque layout ----
.
CHQLI060  PRINT     *2,CPDATE,SP2,REFERENC,ORDER,SP3:
                    TRANTYP7,SP3,CRAMOUNT,DRAMOUNT
.
          MATCH     SP70,APIMCM1
          IF        !@EQUAL
            MOVE      APIMCM1,KEY50
            PRINT     *10,KEY50
            ADD       ONE,CLNO
          ENDIF
.
          MATCH     SP70,APIMCM2
          IF        !@EQUAL
            MOVE      APIMCM2,KEY50
            PRINT     *10,KEY50
            ADD       ONE,CLNO
          ENDIF
          GOTO      CHQLI999
.
.---- ACC cheque layout ----
.
CHQLI070  PRINT     *2,CPDATE,SP2,REFERENC,ORDER,SP3:
                    TRANTYP7,SP3,CRAMOUNT,DRAMOUNT
.
          MATCH     SP70,APIMCM1
          IF        !@EQUAL
            MOVE      APIMCM1,KEY50
            PRINT     *12,KEY50
            ADD       ONE,CLNO
          ENDIF
.
          MATCH     SP70,APIMCM2
          IF        !@EQUAL
            MOVE      APIMCM2,KEY50
            PRINT     *12,KEY50
            ADD       ONE,CLNO
          ENDIF
          GOTO      CHQLI999
.
.---- GreyM ----
.
CHQLI080  MOVE      APIMTOT,TEMPGROS
          ADD       APIMGST,TEMPGROS
          MOVE      APIMDIS,TEMPDISC
          MOVE      TTAMT,TEMPNET
          IF        F1<>0
            MULT      SEQ,TEMPGROS
          ENDIF
.
          PRINT     CPDATE:
                    *10,APIMDOC:
                    *27,TEMPGROS:
                    *43,TEMPDISC:
                    *57,TEMPNET
.
          MATCH     SP70,APIMCM1
          IF        !@EQUAL
            MOVE      APIMCM1,KEY50
            PRINT     *11,KEY50
            ADD       ONE,CLNO
          ENDIF
.
          MATCH     SP70,APIMCM2
          IF        !@EQUAL
            MOVE      APIMCM2,KEY50
            PRINT     *11,KEY50
            ADD       ONE,CLNO
          ENDIF
          GOTO      CHQLI999
.
.---- PVH cheque layout ----
.
CHQLI090  PRINT     *07,CPDATE:
                    *17,REFERENC,*31,TRANTYP2:
                    *38,DRAMOUNT,*48,CRAMOUNT,*64,TTAMOUNT
.
          MATCH     SP70,APIMCM1
          IF        !@EQUAL
            MOVE      APIMCM1,KEY20
            PRINT     *17,KEY20
            ADD       ONE,CLNO
          ENDIF
.
          MATCH     SP70,APIMCM2
          IF        !@EQUAL
            MOVE      APIMCM2,KEY20
            PRINT     *17,KEY20
            ADD       ONE,CLNO
          ENDIF
          GOTO      CHQLI999
.
.---- Buderim ----- 
.
CHQLI100  MOVE      TTAMT,FORM8P2
          MATCH     "1",APIMTYP
          IF        @EQUAL
            MOVE      APIMDOC,KEY15
          ELSE
            MOVE      APIMREF,KEY15
          ENDIF
.
          MOVE      KEY15,KEY10
          BRANCH    PRTSIDE,CHQLI103,CHQLI105
          PRINT     *3,KEY10,SP2,FORM8P2,SP2;
          MOVE      ONE,PRTSIDE
          GOTO      CHQLI108
.
CHQLI103  PRINT     KEY10,SP3,FORM8P2,SP2;
          MOVE      TWO,PRTSIDE
          GOTO      CHQLI108
.
CHQLI105  PRINT     KEY10,SP3,FORM8P2
          MOVE      ZERO,PRTSIDE
          ADD       ONE,CLNO
          GOTO      CHQLI108
.
CHQLI108  GOTO      CHQLI999
.
.---- Hawkesbury cheque layout ----
.
CHQLI110  PRINT     *7,CPDATE,*17,REFERENC,*31,TRANTYP2:
                    *35,DRAMOUNT,*45,CRAMOUNT,*62,TTAMOUNT
          GOTO      CHQLI999
.
.---- SAR cheque layout ----
.
CHQLI120  PRINT     *2,CPDATE,SP2,REFERENC,ORDER,SP3:
                    TRANTYP7,SP3,CRAMOUNT,DRAMOUNT
.
          MATCH     SP70,APIMCM1
          IF        !@EQUAL
            MOVE      APIMCM1,KEY50
            PRINT     *10,KEY50
            ADD       ONE,CLNO
          ENDIF
.
          MATCH     SP70,APIMCM2
          IF        !@EQUAL
            MOVE      APIMCM2,KEY50
            PRINT     *10,KEY50
            ADD       ONE,CLNO
          ENDIF
          GOTO      CHQLI999
.
.---- Mater cheque layout ----
.
CHQLI130  PRINT     *2,CPDATE,SP2,REFERENC,ORDER,SP3:
                    TRANTYP7,SP3,CRAMOUNT,DRAMOUNT
.
          MATCH     SP70,APIMCM1
          IF        !@EQUAL
            MOVE      APIMCM1,KEY50
            PRINT     *10,KEY50
            ADD       ONE,CLNO
          ENDIF
.
          MATCH     SP70,APIMCM2
          IF        !@EQUAL
            MOVE      APIMCM2,KEY50
            PRINT     *10,KEY50
            ADD       ONE,CLNO
          ENDIF
          GOTO      CHQLI999
.
.---- New Standard cheque layout ----
.
CHQLI140  PRINT     *1,CPDATE,SP1,REFERENC,ORDER,SP2:
                    TRANTYP7,SP3,CRAMOUNT,DRAMOUNT
.
          MATCH     SP70,COMMENT1
          IF        !@EQUAL
            MOVE      COMMENT1,KEY50
            PRINT     *10,KEY50
            ADD       ONE,CLNO
          ENDIF
.
          MATCH     SP70,COMMENT2
          IF        !@EQUAL
            MOVE      COMMENT2,KEY50
            PRINT     *10,KEY50
            ADD       ONE,CLNO
          ENDIF
          GOTO      CHQLI999
.
.---- HUT ----
.
CHQLI150  MOVE      APIMTOT,TEMPGROS
          ADD       APIMGST,TEMPGROS
          MOVE      APIMDIS,TEMPDISC
          MOVE      TTAMT,TEMPNET
          IF        F1<>0
            MULT      SEQ,TEMPGROS
          ENDIF
.
          PRINT     CPDATE:
                    *12,APIMDOC:
                    *55,TEMPNET
.
          MATCH     SP70,APIMCM1
          IF        !@EQUAL
            MOVE      APIMCM1,KEY50
            PRINT     *13,KEY50
            ADD       ONE,CLNO
          ENDIF
.
          MATCH     SP70,APIMCM2
          IF        !@EQUAL
            MOVE      APIMCM2,KEY50
            PRINT     *13,KEY50
            ADD       ONE,CLNO
          ENDIF
          GOTO      CHQLI999
.
.---- West Wimmera cheque layout ----
.
CHQLI160  PRINT     *1,CPDATE,SP2,REFERENC,ORDER,SP3:
                    TRANTYP7,SP3,CRAMOUNT,DRAMOUNT
.
          MATCH     SP70,APIMCM1
          IF        !@EQUAL
            MOVE      APIMCM1,KEY50
            PRINT     *11,KEY50
            ADD       ONE,CLNO
          ENDIF
.
          MATCH     SP70,APIMCM2
          IF        !@EQUAL
            MOVE      APIMCM2,KEY50
            PRINT     *11,KEY50
            ADD       ONE,CLNO
          ENDIF
          GOTO      CHQLI999
.
.---- holy spirit cheque layout ----
.
CHQLI170  PRINT     *2,CPDATE,SP3,REFERENC,ORDER:
                    SP3,TRANTYP7,*53,CRAMOUNT,*67,DRAMOUNT
          MATCH     SP70,COMMENT1 
          IF        !@EQUAL
            MOVE      COMMENT1,KEY50
            PRINT     *13,KEY50
            ADD       ONE,CLNO
          ENDIF
.
          MATCH     SP70,COMMENT2
          IF        !@EQUAL
            MOVE      COMMENT2,KEY50
            PRINT     *13,KEY50
            ADD       ONE,CLNO
          ENDIF
          GOTO      CHQLI999
.
.---- St Vincents Melbourne ----
.
CHQLI180  BRANCH    PRTSIDE,CHQLI185
          PRINT     *3,REFERENC,SP1,CPDATE,TTAMOUNT,SP1;
          SUB       ONE,CLNO
          MOVE      ONE,PRTSIDE
          GOTO      CHQLI186
.
CHQLI185  PRINT     REFERENC,SP1,CPDATE,SP1,TTAMOUNT
          MOVE      ZERO,PRTSIDE
          GOTO      CHQLI186
.
CHQLI186  MATCH     SP70,APIMCM1
          IF        !@EQUAL
            IF        PRTSIDE=0
              PRINT     *3,APIMCM1
              ADD       ONE,CLNO
            ELSE
              PRINT     " "
              PRINT     *3,APIMCM1
              ADD       TWO,CLNO
              MOVE      ZERO,PRTSIDE
            ENDIF
          ENDIF
.
          MATCH     SP70,APIMCM2
          IF        !@EQUAL
            IF        PRTSIDE=0
              PRINT     *3,APIMCM2
              ADD       ONE,CLNO
            ELSE
              PRINT     " "
              PRINT     *3,APIMCM2
              ADD       TWO,CLNO
              MOVE      ZERO,PRTSIDE
            ENDIF
          ENDIF
          GOTO      CHQLI999
.
.---- SVB cheque layout ----
.
CHQLI190  PRINT     *07,CPDATE:
                    *17,REFERENC,*31,TRANTYP2:
                    *38,DRAMOUNT,*48,CRAMOUNT,*64,TTAMOUNT
.
          MATCH     SP70,APIMCM1
          IF        !@EQUAL
            MOVE      APIMCM1,KEY20
            PRINT     *17,KEY20
            ADD       ONE,CLNO
          ENDIF
.
          MATCH     SP70,APIMCM2
          IF        !@EQUAL
            MOVE      APIMCM2,KEY20
            PRINT     *17,KEY20
            ADD       ONE,CLNO
          ENDIF
          GOTO      CHQLI999
.
.---- Standard Laser cheque layout ---- 
.
CHQLI200  PRINT     *2,CPDATE,SP3,REFERENC,ORDER:
                    SP3,TRANTYP7,*53,CRAMOUNT,*67,DRAMOUNT
          MATCH     SP70,COMMENT1 
          IF        !@EQUAL
            MOVE      COMMENT1,KEY50
            PRINT     *13,KEY50
            ADD       ONE,CLNO
          ENDIF
.
          MATCH     SP70,COMMENT2
          IF        !@EQUAL
            MOVE      COMMENT2,KEY50
            PRINT     *13,KEY50
            ADD       ONE,CLNO
          ENDIF
          GOTO      CHQLI999
.
.---- Latrobe Regional Laser cheque layout ---- 
.
CHQLI210  PRINT     *2,CPCDATE,*14,REFERENC:
                    *36,DRAMOUNT,*50,CRAMOUNT,*67,TTAMOUNT
          GOTO      CHQLI999
.
.---- STH cheque layout ----
.
CHQLI220  PRINT     *2,CPDATE,SP2,REFERENC,ORDER,SP3:
                    TRANTYP7,SP3,CRAMOUNT,DRAMOUNT
.
          MATCH     SP70,APIMCM1
          IF        !@EQUAL
            MOVE      APIMCM1,KEY50
            PRINT     *10,KEY50
            ADD       ONE,CLNO
          ENDIF
.
          MATCH     SP70,APIMCM2
          IF        !@EQUAL
            MOVE      APIMCM2,KEY50
            PRINT     *10,KEY50
            ADD       ONE,CLNO
          ENDIF
          GOTO      CHQLI999
.
.---- HWK (Hawkes Bay) cheque layout ----
.
CHQLI230  PRINT     *2,CPDATE,SP2,REFERENC,ORDER,SP3:
                    TRANTYP7,SP3,CRAMOUNT,DRAMOUNT
.
          MATCH     SP70,APIMCM1
          IF        !@EQUAL
            MOVE      APIMCM1,KEY50
            PRINT     *10,KEY50
            ADD       ONE,CLNO
          ENDIF
.
          MATCH     SP70,APIMCM2
          IF        !@EQUAL
            MOVE      APIMCM2,KEY50
            PRINT     *10,KEY50
            ADD       ONE,CLNO
          ENDIF
          GOTO      CHQLI999
.
.---- MHD (Mercy Hospital Dunedin - NZ) cheque layout ----
.
CHQLI240  PRINT     *3,*SUBSCR,CPDATE,SP3,REFERENC,ORDER,SP3:
                    TRANTYP7,SP5,CRAMOUNT,SP1,DRAMOUNT,*SUOFF
.
          MATCH     SP70,APIMCM1
          IF        !@EQUAL
            MOVE      APIMCM1,KEY50
            PRINT     *10,KEY50
            ADD       ONE,CLNO
          ENDIF
.
          MATCH     SP70,APIMCM2
          IF        !@EQUAL
            MOVE      APIMCM2,KEY50
            PRINT     *10,KEY50
            ADD       ONE,CLNO
          ENDIF
          GOTO      CHQLI999
.
CHQLI999  RETURN
.----------------------------------------------------------------------
. Print Cheque Remittance Header
.----------------------------------------------------------------------
CHQHE000  MOVE      ZERO,CLNO
.
          BRANCH    FMCOAPCH,CHQHE010,CHQHE020,CHQHE030,CHQHE040,CHQHE050:
                             CHQHE060,CHQHE070,CHQHE080,CHQHE090,CHQHE100:
                             CHQHE110,CHQHE120,CHQHE130,CHQHE140,CHQHE150:
                             CHQHE160,CHQHE170,CHQHE180,CHQHE190,CHQHE200:
                             CHQHE210,CHQHE220,CHQHE230
.
.---- standard cheque layout ----
.
          PRINT     *F,*N,*N,*N:
                    *N,*10,APMACN1:
                    *N,*10,APMACN2:
                    *N,*10,APMACA1:
                    *N,*10,APMACA2:
                    *N,*10,APMACA3," ",APMACPC,*N,*63,CHEQNUMB:
                    *N,*18,APIMCRD:
                    *N,*N,*N
          GOTO      CHQHE999
.
.---- HLC cheque layout ----
.
CHQHE010  MOVE      APMACA2,KEY20
          PRINT     *F,*N,*N,*N,*N:
                    *N,*21,APMACN1:
                    *N,*21,APMACN2:
                    *N,*21,APMACA1:
                    *N,*21,KEY20,APMACPC:
                    *N,*N,*N,*N
          GOTO      CHQHE999
.
.---- hastings cheque layout ----
.
CHQHE020  PRINT     *F,*65,CHEQNUMB:
                    *N,*65,CDATE:
                    *N,*65,APMACRD:
                    *N,*N:
                    *N,*10,APMACN1:
                    *N,*10,APMACN2:
                    *N,*10,APMACA1:
                    *N,*10,APMACA2:
                    *N,*10,APMACA3," ",APMACPC,*N:
                    *N,*2,"-----------------------------------------------":
                          "-------------------------":
                    *N,*2,"Date      Reference No.  Order      Transaction":
                          "       Credit       Debit":
                    *N,*2,"-----------------------------------------------":
                          "-------------------------"
          GOTO      CHQHE999
.
.---- West Gippsland ----
.
CHQHE030  CALL      CHQSTR00
          MOVE      ZERO,PRTSIDE
          GOTO      CHQHE999
.
.---- MOD ----
.
CHQHE040  PRINT     *N,*N,*N,*N,*N,*N:
                    *4,APMACRD,*11,APMACN1:
                    *N,*N,*3,"INVOICE NO",*19,"DATE",*36,"AMOUNT": 
                       *44,"INVOICE NO",*60,"DATE",*76,"AMOUNT":
                    *N
          MOVE      ZERO,PRTSIDE
          GOTO      CHQHE999
.
.---- TAM cheque layout ----
.
CHQHE050  PRINT     *F,*65,CHEQNUMB:
                    *N,*65,CDATE:
                    *N,*65,APMACRD:
                    *N,*N,*N,*N,*N,*N,*N:
                    *N,*10,APMACN1:
                    *N,*10,APMACN2:
                    *N,*10,APMACA1:
                    *N,*10,APMACA2:
                    *N,*10,APMACA3," ",APMACPC:
                    *N,*2,"-----------------------------------------------":
                          "-------------------------":
                    *N,*2,"Date      Reference No.  Order      Transaction":
                          "       Credit       Debit":
                    *N,*2,"-----------------------------------------------":
                          "-------------------------"
          GOTO      CHQHE999
.
.---- ACC cheque layout ----
.
CHQHE060  PRINT     *F,*N,*N,*N,*N,*N:
                    *N,*N,*10,APMACN1
          MATCH     SP70,APMACN2
          IF        !@EQUAL
            PRINT   *10,APMACN2
          ENDIF
          PRINT     *10,APMACA1:
                    *N,*10,APMACA2:
                    *N,*10,APMACA3," ",APMACPC;
          MATCH     SP70,APMACN2
          IF        @EQUAL
            PRINT     *N,*63,CHEQNUMB:
                      *N,*18,APIMCRD:
                      *N,*N
          ELSE
            PRINT     *63,CHEQNUMB:
                      *N,*18,APIMCRD:
                      *N,*N
          ENDIF
          GOTO      CHQHE999
.
.---- GreyM ----
.
CHQHE070  PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          UNPACK    KEY8,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     *F,*N,*N,*N,*N,*N:
                    *6,APMACN1
          MATCH     SP30,APMACN2
          IF        @EQUAL
            PRINT   *6,APMACA1:
                    *N,*6,APMACA2:
                    *N,*6,APMACA3,*32,APMACPC:
                    *N,*N,*42,CPCDATE:
                    *N,*N,*N
          ELSE
            PRINT   *6,APMACN2:
                    *N,*6,APMACA1:
                    *N,*6,APMACA2:
                    *N,*6,APMACA3,*32,APMACPC:
                    *N,*42,CPCDATE:
                    *N,*N,*N
          ENDIF
          GOTO      CHQHE999
.
.---- PVH ----
.
CHQHE080  MOVE      APMACA2,KEY20
          PRINT     *F,*N,*N,*N,*N,*N:
                    *N,*06,APMACN1:
                    *N,*06,APMACN2:
                    *N,*06,APMACA1:
                    *N,*06,KEY20,APMACPC:
                    *N,*N
          GOTO      CHQHE999
.
.---- Buderim ----
.
CHQHE090  CALL      CHQSTR00
          MOVE      ZERO,PRTSIDE
          GOTO      CHQHE999
.
.---- Hawkesbury cheque layout ----
.
CHQHE100  MOVE      APMACA3,KEY20
          PRINT     *F,*N,*N,*N,*N,*N:
                    *N,*17,APMACN1:
                    *N,*17,APMACA1:
                    *N,*17,APMACA2:
                    *N,*17,KEY20,APMACPC:
                    *N,*N,*N
          GOTO      CHQHE999
.
.---- SAR cheque layout ----
.
CHQHE110  PRINT     *F,*N,*N,*N,*N:
                    *N,*10,APMACN1:
                    *N,*10,APMACN2:
                    *N,*10,APMACA1:
                    *N,*10,APMACA2:
                    *N,*10,APMACA3," ",APMACPC,*63,CHEQNUMB,*N:
                    *N,*18,APIMCRD:
                    *N,*N
          GOTO      CHQHE999
.
.---- Mater cheque layout ----
.
CHQHE120  PRINT     *F,*N,*N,*N,*N:
                    *N,*10,APMACN1:
                    *N,*10,APMACN2:
                    *N,*10,APMACA1:
                    *N,*10,APMACA2:
                    *N,*10,APMACA3," ",APMACPC,*63,CHEQNUMB,*N:
                    *N,*18,APIMCRD:
                    *N,*N
          GOTO      CHQHE999
.
.---- New Standard cheque layout ----
.
CHQHE130  PRINT     *F,*N,*N,*N,*N:
                    *N,*10,APMACN1:
                    *N,*10,APMACN2:
                    *N,*10,APMACA1:
                    *N,*10,APMACA2:
                    *N,*10,APMACA3," ",APMACPC:
                    *N,*59,CHEQNUMB,*N,*18,APIMCRD:
                    *N,*N,*N
          GOTO      CHQHE999
.
.---- Hutt ----
.
CHQHE140  PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          UNPACK    KEY8,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     *N,*N,*N,*6,APMACN1
          MATCH     SP30,APMACN2
          IF        @EQUAL
            PRINT   *6,APMACA1:
                    *N,*6,APMACA2:
                    *N,*6,APMACA3,*32,APMACPC:
                    *N,*N,*N,APMACRD,*43,CPDATE:
                    *N,*48,"Cheque Number ",CHEQNUMB,*N,*N
          ELSE
            PRINT   *6,APMACN2:
                    *N,*6,APMACA1:
                    *N,*6,APMACA2:
                    *N,*6,APMACA3,*32,APMACPC:
                    *N,*N,APMACRD,*43,CPDATE:
                    *N,*48,"Cheque Number ",CHEQNUMB,*N,*N
          ENDIF
          GOTO      CHQHE999
.
.---- West Wimmera cheque layout ----
.
CHQHE150  PRINT     *N,*N,*N,*N,*N:
                    *N,*10,APMACN1:
                    *N,*10,APMACN2:
                    *N,*10,APMACA1:
                    *N,*10,APMACA2:
                    *N,*10,APMACA3," ",APMACPC,*63,CHEQNUMB,*N:
                    *N,*18,APMACRD:
                    *N,*N
          GOTO      CHQHE999
.
.---- Holy Spirit cheque layout ----
.
CHQHE160  PRINT     *N,*N,*N,*N:
                    *N,*10,APMACN1:
                    *N,*10,APMACN2:
                    *N,*10,APMACA1:
                    *N,*10,APMACA2:
                    *N,*10,APMACA3," ",APMACPC,*N,*65,CHEQNUMB:
                    *N,*N,*18,APMACRD:
                    *N,*N
          GOTO      CHQHE999
.
.---- St Vincents Melboutn ----
.
CHQHE170  CALL      CHQSTR00
          MOVE      ZERO,PRTSIDE
          GOTO      CHQHE999
.
.---- SVB ----
.
CHQHE180  MOVE      APMACA2,KEY20
          PRINT     *F,*N,*N,*N,*N,*N:
                    *N,*06,APMACN1:
                    *N,*06,APMACN2:
                    *N,*06,APMACA1:
                    *N,*06,KEY20,APMACPC:
                    *N,*N
          GOTO      CHQHE999
.
.---- Standard Laser cheque layout ----
.
CHQHE190  PRINT     *N,*N,*N,*N:
                    *N,*10,APMACN1:
                    *N,*10,APMACN2:
                    *N,*10,APMACA1:
                    *N,*10,APMACA2,*65,CDATE:         * srf 6645
                    *N,*10,APMACA3," ",APMACPC,*N,*65,CHEQNUMB:
                    *N,*N,*18,APMACRD:
                    *N,*N
          GOTO      CHQHE999
.
.---- Latrobe Regional Laser cheque layout ----
.
CHQHE200  PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          UNPACK    KEY8,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     *N,*N,*N,*N:
                    *N,*4,APMACN1:
                    *N,*4,APMACN2:                                             
                    *N,*4,APMACA1:
                    *N,*4,APMACA2:
                    *N,*4,APMACA3," ",APMACPC,*52,CHEQNUMB:
                    *N,*N,*13,APMACRD,*N,*N,*N
          GOTO      CHQHE999
.
.---- STH cheque layout ----
.
CHQHE210  PRINT     *F,*N,*N,*N:
                    *N,*10,APMACN1:
                    *N,*10,APMACN2:
                    *N,*10,APMACA1:
                    *N,*10,APMACA2:
                    *N,*10,APMACA3," ",APMACPC,*N,*63,CHEQNUMB:
                    *N,*N,*10,APIMCRD:
                    *N,*N
          GOTO      CHQHE999
.
.---- HWK (Hawkes Bay) cheque layout ----
.
CHQHE220  PRINT     *F,*N,*N,*N:
                    *N,*10,APMACN1:
                    *N,*10,APMACN2:
                    *N,*10,APMACA1:
                    *N,*10,APMACA2:
                    *N,*10,APMACA3," ",APMACPC,*N,*63,CHEQNUMB:
                    *N,*18,APIMCRD:
                    *N,*N
          GOTO      CHQHE999
.
.---- MHD (Mercy Hospital Dunedin) cheque layout ----
.
CHQHE230  PRINT     *N,*N,*N:
                    *N,*10,*SUBSCR,APMACN1,*SUOFF:
                    *N,*10,*SUBSCR,APMACN2,*SUOFF:
                    *N,*10,*SUBSCR,APMACA1,*SUOFF:
                    *N,*10,*SUBSCR,APMACA2,*SUOFF:
                    *N,*10,*SUBSCR,APMACA3," ",APMACPC,*SUOFF:
                    *N,*71,*SUBSCR,CHEQNUMB,*SUOFF:
                    *N,*18,*SUBSCR,APIMCRD,*SUOFF:
                    *N,*N,*N
          GOTO      CHQHE999
.
CHQHE999  RETURN
.----------------------------------------------------------------------
. Print Cheque Totals
.----------------------------------------------------------------------
CHQEN000  MOVE      "1",SECTOR
          MOVE      DOLLARS,D13
          RESET     D13
.
          IF        FMCOAPCH=20 |FMCOAPCH=4
            MOVE      D13,D4
            MOVE      ZERO,F4
            MOVE      D4,F4
            MOVE      D4,DMILL
            IF        F4<10
              ADD       ONE,F4
              LOAD      DMILL,F4,DSTARS,DONE,DTWO,DTHREE,DFOUR,DFIVE,DSIX:
                                 DSEVEN,DEIGHT,DNINE
            ENDIF
            RESET     D13,5
          ELSE
            MOVE      D13,D5
            MOVE      ZERO,F5
            MOVE      D5,F5
            MOVE      D5,DHUNTH
            IF        F5<10
              ADD       ONE,F5
              LOAD      DHUNTH,F5,DSTARS,DONE,DTWO,DTHREE,DFOUR,DFIVE,DSIX:
                                  DSEVEN,DEIGHT,DNINE
            ENDIF
            RESET     D13,6
          ENDIF
.
CHQEN020  MOVE      SP1,D1
          MOVE      D13,D1
          MATCH     SP1,D1
          GOTO      CHQEN030 IF NOT EQUAL
          MOVE      DSTARS,NUMBER
          GOTO      CHQEN040
.
CHQEN030  MOVE      D1,F2
          ADD       ONE,F2
          LOAD      NUMBER,F2,DZERO,DONE,DTWO,DTHREE,DFOUR,DFIVE,DSIX,DSEVEN:
                    DEIGHT,DNINE
.
CHQEN040  IF        FMCOAPCH=20 | FMCOAPCH=4
            STORE     NUMBER,SECTOR,DHUNTH,DTENTH,DTHOUS,DHUND,DTENS,DUNITS
            BUMP      D13
            ADD       ONE,SECTOR
            COMPARE   SEVEN,SECTOR
            GOTO      CHQEN050 IF EQUAL
          ELSE
            STORE     NUMBER,SECTOR,DTENTH,DTHOUS,DHUND,DTENS,DUNITS
            BUMP      D13
            ADD       ONE,SECTOR
            COMPARE   SIX,SECTOR
            GOTO      CHQEN050 IF EQUAL
          ENDIF
          GOTO      CHQEN020
.
CHQEN050  RESET     D13,12
          RESET     DCENTS
          CMOVE     D13,DCENTS
          RESET     D13,13
          RESET     DCENTS,2
          CMOVE     D13,DCENTS
          RESET     DCENTS
.
          MOVE      DOLLARS,D13
          REP       " *",D13
          MOVE      DOLLARS,FORM8P2
.
CHQEN060  IF        FMCOAPCH=9 |FMCOAPCH=4
            IF        PRTSIDE<>0
              PRINT     " "
              ADD       ONE,CLNO
              MOVE      ZERO,PRTSIDE
            ENDIF
          ENDIF
.
          COMPARE   MAXLINES,CLNO
          GOTO      CHQEN070 IF NOT LESS
          PRINT     " "
          ADD       ONE,CLNO
          GOTO      CHQEN060
.
CHQEN070  BRANCH    FMCOAPCH,CHQEN080,CHQEN090,CHQEN100,CHQEN110,CHQEN120:
                             CHQEN130,CHQEN140,CHQEN150,CHQEN160,CHQEN170:
                             CHQEN180,CHQEN190,CHQEN200,CHQEN210,CHQEN220:
                             CHQEN230,CHQEN240,CHQEN250,CHQEN260,CHQEN270:
                             CHQEN280,CHQEN290,CHQEN300
.
.---- standard cheque layout ----
.
          PRINT     *N,*55,DOLLARS,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*50,CDATE,*62,D13,*N,*N,*N:
                    *2,DHUNTH,SP1,DTENTH,SP1,DTHOUS,SP1,DHUND,SP1,DTENS:
                    SP1,DUNITS,SP1,DCENTS,*N,*N,*N,*8,APMACN1,*N,*8,APMACN2
. Epworth
          MATCH     "1",FMCOEPWC
          IF        @EQUAL
            PRINT     *8,APMACA1,*N,*8,APMACA2,*N,*8,APMACA3," ",APMACPC
          ENDIF
          GOTO      CHQEN900
.
.---- HLC cheque layout ----
.
CHQEN080  PRINT     *N,*N,*21,APMACRD,*30,CHEQNUMB,*39,DOLLARS,*64,DOLLARS:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*2,CDATE,*13,APMACN1,*52,CHEQNUMB,*64,D13:
                    *N,*N,*N,*N:
                    *16,DHUNTH,SP2,DTENTH,SP2,DTHOUS,SP2,DHUND,SP2,DTENS:
                    SP2,DUNITS,SP3,DCENTS
          GOTO      CHQEN900
.
.---- hastings cheque layout ----
.
CHQEN090  PRINT     *N,*N,*N,*45,"Total : ",DOLLARS,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N:
                    *5,APMACN1,*43,CDATE,*58,D13,*N,*N,*N,*N:
                    *14,"*****  ",DHUNTH,SP2,DTENTH,SP2,DTHOUS,SP2,DHUND:
                    SP2,DTENS,SP2,DUNITS,SP4,DCENTS
          GOTO      CHQEN900
.
.---- West Gippsland cheque layout ----
.
CHQEN100  PRINT     *66,D13
          GOTO      CHQEN900
.
.---- MOD ----
.
CHQEN110  LOAD      MONTHD FROM CMM OF JAN,FEB,MAR,APR,MAY,JUN:
                                       JUL,AUG,SEP,OCT,NOV,DEC
          MOVE      CDD,CDAY
          REP       " 0",CDAY
          MOVE      CYY,CYEAR
          REP       " 0",CYEAR
          PACK      DATEH,CDAY,SP1,MONTHD,SP1,CYEAR
.
          PRINT     *N,*N,*52,"Total Cheque: ",DOLLARS,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*69,DATEH,*N:
                    *9,DMILL,SP1,DHUNTH,SP1,DTENTH,SP1,DTHOUS,SP1,DHUND:
                    SP2,DTENS,SP1,DUNITS,SP2,DCENTS,*N,*N,*N
          MATCH     SP70,APMACN2
          IF        @EQUAL
            PRINT     *12,APMACN1,*65,D13,*N,*12,APMACA1,*N,*12,APMACA2:
                      *N,*12,APMACA3," ",APMACPC,*N,*N,*N,*N,*N
          ELSE
            PRINT     *12,APMACN1,*65,D13,*N,*12,APMACN2,*N,*12,APMACA1:
                      *N,*12,APMACA2,*N,*12,APMACA3," ",APMACPC,*N,*N,*N,*N
          ENDIF
          GOTO      CHQEN900
.
.---- TAM cheque layout ----
.
CHQEN120  PRINT     *N,*N,*N,*45,"Total : ",DOLLARS,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N:
                    *5,APMACN1,*43,CDATE,*58,D13,*N,*N,*N,*N:
                    *14,"*****  ",DHUNTH,SP2,DTENTH,SP2,DTHOUS,SP2,DHUND:
                    SP2,DTENS,SP2,DUNITS,SP4,DCENTS
          GOTO      CHQEN900
.
.---- ACC cheque layout ----
.
CHQEN130  PRINT     *N,*N,*48,DOLLARS:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*59,CDATE,*N,*N,*N:
                    *N,*4,DHUNTH,SP1,DTENTH,SP1,DTHOUS,SP1,DHUND,SP1,DTENS:
                    SP1,DUNITS,SP1,DCENTS,*55,D13,*N,*N,*N,*8,APMACN1
          MATCH     SP30,APMACN2
          GOTO      CHQEN135 IF EQUAL
.
          PRINT     *8,APMACN2:
                    *N,*8,APMACA1,*N,*8,APMACA2,*N,*8,APMACA3," ",APMACPC
          GOTO      CHQEN900
.
CHQEN135  PRINT     *8,APMACA1,*N,*8,APMACA2,*N,*8,APMACA3," ",APMACPC,*N
          GOTO      CHQEN900
.
.---- GreyM cheque layout ----
.
CHQEN140  CALL      GMNEW000               * Print New Words Format
          GOTO      CHQEN900
.
.---- PVH cheque layout ----
.
CHQEN150  PRINT     *N,*N,*18,APMACRD,*27,CHEQNUMB,*36,DOLLARS,*61,DOLLARS:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,CDATE,*10,APMACN1,*49,CHEQNUMB,*61,D13:
                    *N,*N,*N,*N:
                    *13,DHUNTH,SP2,DTENTH,SP3,DTHOUS,SP2,DHUND,SP2,DTENS:
                    SP2,DUNITS,SP2,DCENTS
          GOTO      CHQEN900
.
.---- Buderim cheque layout ----
.
CHQEN160  PRINT     *52,"CHEQUE TOTAL",*67,FORM8P2,*N
          GOTO      CHQEN900
.
.---- Hawkesbury cheque layout ----
.
CHQEN170  CALL      GMNEW000               * Print New Words Format
          GOTO      CHQEN900
.
.---- SAR cheque layout ----
.
CHQEN180  PRINT     *N,*55,DOLLARS,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*63,CDATE,*N,*N,*N,*N:
                    *2,DHUNTH,SP1,DTENTH,SP1,DTHOUS,SP1,DHUND,SP1,DTENS:
                    SP1,DUNITS,SP1,DCENTS,*59,D13,*N,*N,*N,*13,APMACN1:
                    *N,*13,APMACN2
          GOTO      CHQEN900
.
.---- Mater cheque layout ----
.
CHQEN190  PRINT     *N,*55,DOLLARS,*N: 
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*54,CDATE,*N,*N,*N: 
                    *2,DHUNTH,SP1,DTENTH,SP1,DTHOUS,SP1,DHUND,SP1,DTENS: 
                    SP1,DUNITS,SP1,DCENTS,*57,D13,*N,*N,*N,*8,APMACN1 
          MATCH     SP70,APMACN2 
          IF        @EQUAL 
            PRINT   *8,APMACA1,*N,*8,APMACA2,*N,*8,APMACA3," ",APMACPC 
          ELSE
            PRINT   *8,APMACN2:
                    *N,*8,APMACA1,*N,*8,APMACA2,*N,*8,APMACA3," ",APMACPC
          ENDIF
          GOTO      CHQEN900
.
.---- New standard cheque layout ----
.
CHQEN200  PRINT     *N,*N,*45,DOLLARS: 
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*50,CDATE,*N,*N,*N: 
                    *2,DHUNTH,SP1,DTENTH,SP1,DTHOUS,SP1,DHUND,SP1,DTENS: 
                    SP1,DUNITS,SP1,DCENTS,*N,*59,D13,*N,*N,*8,APMACN1 
          MATCH     SP70,APMACN2 
          IF        !@EQUAL 
            PRINT   *8,APMACN2
          ENDIF
. Epworth
          MATCH     "1",FMCOEPWC
          IF        @EQUAL
            PRINT     *8,APMACA1,*N,*8,APMACA2,*N,*8,APMACA3," ",APMACPC
          ENDIF
          GOTO      CHQEN900
.
.---- Hut cheque layout ----
.
CHQEN210  CALL      GMNEW000               * Print New Words Format
          GOTO      CHQEN900
.
.---- West Wimmera cheque layout ----
.
CHQEN220  PRINT     *N,*N,*60,DOLLARS:
                    *N,*N,*N,*N,*N,*N,*N,*N,*60,CDATE,*N,*N,*N,*N,*N:
                    *4,DHUNTH,SP1,DTENTH,SP1,DTHOUS,SP1,DHUND,SP1,DTENS:
                    SP1,DUNITS,SP1,DCENTS,*56,D13,*N,*N,*N,*15,APMACN1:
                    *N,*15,APMACN2,*F;
          GOTO      CHQEN900
.
.---- Holy Spirit cheque layout ----
.
CHQEN230  PRINT     *N,*55,DOLLARS,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*53,CDATE,*N,*N,*N:
                    *2,DHUNTH,SP1,DTENTH,SP1,DTHOUS,SP1,DHUND,SP2,DTENS:
                    SP1,DUNITS,SP1,DCENTS,*N,*66,D13,*N:
                    *N,*8,APMACN1,*N,*8,APMACN2,*N:
                    *N,*N,*N,*N
          GOTO      CHQEN900
.
.---- West Gippsland cheque layout ----
.
CHQEN240  PRINT     *N,*N,*66,D13
          GOTO      CHQEN900
.
.---- SVB cheque layout ----
.
CHQEN250  PRINT     *N,*N,*18,APMACRD,*27,CHEQNUMB,*36,DOLLARS,*62,DOLLARS:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *2,APMACN1,*49,CHEQNUMB,*61,CDATE:
                    *N,*N,*N,*N:
                    *2,DHUNTH,SP2,DTENTH,SP3,DTHOUS,SP2,DHUND,SP2,DTENS:
                    SP2,DUNITS,SP2,DCENTS,*58,D13
          GOTO      CHQEN900
.
.---- Standard Laser cheque layout ----
.
CHQEN260  PRINT     *N,*55,DOLLARS,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*53,CDATE,*N,*N,*N:
                    *2,DHUNTH,SP1,DTENTH,SP1,DTHOUS,SP1,DHUND,SP2,DTENS:
                    SP1,DUNITS,SP1,DCENTS,*N,*66,D13,*N
          MATCH     SP70,APMACN2
          IF        @EQUAL
            MATCH     "1",FMCOEPWC
            IF        @EQUAL
              PRINT     *10,APMACN1,*N,*10,APMACA1,*N,*10,APMACA2:
                        *N,*10,APMACA3," ",APMACPC,*N,*N,*N
            ELSE
              PRINT     *10,APMACN1,*N,*10," ",*N,*10," ":
                        *N,*10," ",*N,*N,*N
            ENDIF
          ELSE
            MATCH     "1",FMCOEPWC
            IF        @EQUAL
              PRINT     *10,APMACN1,*N,*10,APMACN2,*N,*10,APMACA1:
                        *N,*10,APMACA2,*N,*10,APMACA3," ",APMACPC,*N,*N
            ELSE
              PRINT     *10,APMACN1,*N,*10,APMACN2,*N,*10," ":
                        *N,*10," ",*N,*10," ",*N,*N
            ENDIF
          ENDIF
          GOTO      CHQEN900
.
.---- Latrobe Regional Laser cheque layout ----
.
CHQEN270  PRINT     *N,*N,*67,DOLLARS,*N:
                    *N,*N,*N,*N,*N,*N,*N,*66,CDATE,*N:
                    *N,*8,APMACN1:
                    *N,*8,APMACN2:
                    *N,*N,*7,DMILL,SP1,DHUNTH,SP1,DTENTH,SP1,DTHOUS,SP1,DHUND:
                    SP1,DTENS:
                    SP1,DUNITS,SP1,DCENTS,*66,D13,*N,*N,*N,*N,*N,*N,*N,*N
          GOTO      CHQEN900
.
.---- STH cheque layout ----
.
CHQEN280  CALL      GMNEW000               * Print New Words Format
          GOTO      CHQEN900
.
.---- HWK (Hawkes Bay) cheque layout ----
.
CHQEN290  PRINT     *N,*N,*61,DOLLARS,*N:
                    *N,*N,*N,*N,*63,CDATE,*N,*N,*N,*N,*N:
                    *18,APMACN1,*N,*18,APMACN2,*N,*N,*N,*62,D13,*N:
                    *4,DHUNTH,SP1,DTENTH,SP1,DTHOUS,SP1,DHUND,SP1,DTENS:
                    SP1,DUNITS,SP1,DCENTS
          GOTO      CHQEN900
.
.---- MHD (Mercy Hospital Dunedin) cheque layout ----
.
CHQEN300  CALL      GMNEW000               * Print New Words Format
          GOTO      CHQEN900
.
CHQEN900  
.         CALL      UPREC000
.         ADD       CANCHQNO,CHEQNUMB  * Increase Cheque No by Can. Cheq. (WGH)
.         MOVE      ZERO,CANCHQNO     * Init Count for Cancelled Cheques (WGH)
.
CHQEN999  RETURN
.-------------------------------------------------------------------------
. Greymouth Print String if <= 999999.99 in amount
.-------------------------------------------------------------------------
GMNEW000  CALL      GMSTR000                 * Get Greymouth string
.
          IF        FMCOAPCH=7
            PACK      DIM12,SP10,SP2
            UNPACK    D13,D1,DIM12
            PRINT     *N,*59,DOLLARS,*N,*N,*N:
                      *64,CDATE,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                      *09,APMACN1,*N:
                      *09,APMACN2,*60,DIM12,*N:
                      *12,PRNSTR1,*N,*03,PRNSTR2
          ENDIF
          IF        FMCOAPCH=10
            PACK      DIM12,SP10,SP2
            UNPACK    D13,D1,DIM12
            PRINT     *N,*N,*18,APMACRD,*27,CHEQNUMB,*37,TOTALINV:
                      *47,TOTALCRD,*62,DOLLARS:
                      *N,*N,*N,*N,*N,*N,*N,*N,*61,CDATE,*N,*N:
                      *03,APMACN1,*N:
                      *03,APMACN2,*N,*N:
                      *08,PRNSTR1,*N,PRNSTR2:
                      *57,DIM12
          ENDIF
          IF        FMCOAPCH=14
            PACK      DIM12,SP10,SP2
            UNPACK    D13,D1,DIM12
            PRINT     *N,*57,DOLLARS:
                      *N,*N,*N,*N,*N:
                      *N,*70,CDATE:
                      *N,*N,*N,*N,*N,*N,*N:
                      *N,*06,APMACN1:
                      *N,*06,APMACN2:
                      *N,*60,DIM12:
                      *N,*09,PRNSTR1:                
                      *N,*09,PRNSTR2:               
                      *N,*N,*N,*N,*N,*N,*N,*N,*N
          ENDIF
          IF        FMCOAPCH=21
            PACK      DIM12,SP10,SP2
            UNPACK    D13,D1,DIM12
            PRINT     *N,*61,DOLLARS,*N,*N:
                      *N,*66,CDATE:
                      *N,*N,*N,*N,*N,*N,*N,*N:
                      *07,APMACN1,*N:
                      *07,APMACN2,*N,*57,DIM12,*N:
                      *10,PRNSTR1,*N,PRNSTR2
          ENDIF
          IF        FMCOAPCH=23
            PACK      DIM12,SP10,SP2
            UNPACK    D13,D1,DIM12
            PRINT     *N,*66,*SUBSCR,DOLLARS,*SUOFF,*N,*N:
                      *N,*66,*SUBSCR,CDATE,*SUOFF:
                      *N,*N,*N,*N,*N,*N:
                      *09,*SUBSCR,APMACN1,*SUOFF,*N:
                      *09,*SUBSCR,APMACN2,*SUOFF,*N,*N,*N:
                      *64,*SUBSCR,DIM12,*SUOFF,*N:
                      *13,*SUBSCR,PRNSTR1,*SUOFF,*N:
                      *4,*SUBSCR,PRNSTR2,*SUOFF:
                      *N:
                      *N,*N,*N,*N,*N,*N
          ENDIF
.
GMNEW999  RETURN
.-------------------------------------------------------------------------
. Get the print strings for Greymouth cheque amount in words
.-------------------------------------------------------------------------
GMSTR000  UNPACK    DOLLARS,KEY4,GMDIM9
.
.-------- i.e       999999.99
          UNPACK    GMDIM9,GMD1A,GMD1B,GMD1C,GMD1D,GMD1E,GMD1F,GMD1G,GMD1H,GMD1I
          MOVE      GMD1A,GMF1A
          MOVE      GMD1B,GMF1B
          MOVE      GMD1C,GMF1C
          MOVE      GMD1D,GMF1D
          MOVE      GMD1E,GMF1E
          MOVE      GMD1F,GMF1F
          MOVE      GMD1H,GMF1H
          MOVE      GMD1I,GMF1I
.
          PACK      GMSTR1,SP70,SP70         * String Line 1
          CLEAR     GMSTR1
.
          MATCH     SP4,KEY4
          IF        !@EQUAL
            UNPACK    KEY4,KEY3,KEY1
            MATCH     KEY3,SP70
            IF        @EQUAL
              MOVE      KEY1,FORM1
              LOAD      KEY9,FORM1,GMONE,GMTWO,GMTHREE,GMFOUR,GMFIVE:     
                                   GMSIX,GMSEVEN,GMEIGHT,GMNINE
              SQUEEZE   KEY9
              APPEND    KEY9,GMSTR1
            ELSE
              APPEND    KEY4,GMSTR1
            ENDIF
            APPEND    " MILLION ",GMSTR1
          ENDIF
.
          MATCH     SP1,GMD1A
          IF        @EQUAL
            GOTO    GMSTR100
          ENDIF
.
          LOAD      KEY9,GMF1A,GMONE,GMTWO,GMTHREE,GMFOUR,GMFIVE:     
                               GMSIX,GMSEVEN,GMEIGHT,GMNINE
          SQUEEZE   KEY9
          APPEND    KEY9,GMSTR1
          APPEND    " HUNDRED",GMSTR1
.
GMSTR100  MATCH     SP1,GMD1B
          GOTO      GMSTR130 IF NOT EQUAL
          MATCH     SP1,GMD1C
          GOTO      GMSTR300 IF EQUAL
.
          MATCH     SP1,GMD1B
          GOTO      GMSTR200 IF EQUAL
.
GMSTR130  COMPARE   ZERO,GMF1B
          GOTO      GMSTR200 IF EQUAL
.
          APPEND    SP1,GMSTR1
          IF        GMF1B=1
            PACK      DIM2,GMF1B,GMF1C
            MOVE      DIM2,FORM2
            SUBTRACT  TEN,FORM2
            MOVE      GMTEN,KEY9
            LOAD      KEY9,FORM2,GMELEVEN,GMTWELVE,GMTHIRTE,GMFOURTE,GMFIFTEE:
                                 GMSIXTEE,GMSEVENT,GMEIGHTE,GMNINETE
            SQUEEZE   KEY9
            APPEND    KEY9,GMSTR1
            GOTO      GMSTR250
          ELSE
            LOAD      KEY9,GMF1B,GMTEN,GMTWENTY,GMTHIRTY,GMFOURTY,GMFIFTY:
                                 GMSIXTY,GMSEVENY,GMEIGHTY,GMNINETY
          ENDIF
          SQUEEZE   KEY9
          APPEND    KEY9,GMSTR1
.
GMSTR200  IF        GMF1C=0
            GOTO      GMSTR250
          ELSE
            LOAD      KEY9,GMF1C,GMONE,GMTWO,GMTHREE,GMFOUR,GMFIVE:     
                                 GMSIX,GMSEVEN,GMEIGHT,GMNINE
          ENDIF
          SQUEEZE   KEY9
          MATCH     SP1,GMD1B
          IF        !@EQUAL
            APPEND    "-",GMSTR1
          ELSE
            APPEND    SP1,GMSTR1
          ENDIF
          APPEND    KEY9,GMSTR1
.
GMSTR250  APPEND    " THOUSAND ",GMSTR1   * Max of 40 after here
.
GMSTR300  MATCH     SP1,GMD1D
          GOTO      GMSTR400 IF EQUAL
.
          IF        GMF1D > 0
            LOAD      KEY9,GMF1D,GMONE,GMTWO,GMTHREE,GMFOUR,GMFIVE:     
                                 GMSIX,GMSEVEN,GMEIGHT,GMNINE
            SQUEEZE   KEY9
            APPEND    KEY9,GMSTR1
            APPEND    " HUNDRED ",GMSTR1
          ENDIF
.
GMSTR400  MOVE      SP9,KEY9
          MATCH     SP1,GMD1E
          GOTO      GMSTR430 IF NOT EQUAL
          MATCH     SP1,GMD1F
          GOTO      GMSTR500 IF EQUAL
.
          MATCH     SP1,GMD1E
          GOTO      GMSTR450 IF EQUAL
.
GMSTR430  COMPARE   ZERO,GMF1E
          IF        @EQUAL
            APPEND    SP1,GMSTR1
            GOTO      GMSTR450
          ENDIF
.
          IF        GMF1E=1
            PACK      DIM2,GMF1E,GMF1F
            MOVE      DIM2,FORM2
            SUB       TEN,FORM2
            MOVE      GMTEN,KEY9
            LOAD      KEY9,FORM2,GMELEVEN,GMTWELVE,GMTHIRTE,GMFOURTE,GMFIFTEE:
                                 GMSIXTEE,GMSEVENT,GMEIGHTE,GMNINETE
            SQUEEZE   KEY9
            APPEND    KEY9,GMSTR1
            APPEND    SP1,GMSTR1
            GOTO      GMSTR500
          ELSE
            LOAD      KEY9,GMF1E,GMTEN,GMTWENTY,GMTHIRTY,GMFOURTY,GMFIFTY:
                                 GMSIXTY,GMSEVENY,GMEIGHTY,GMNINETY
          ENDIF
          SQUEEZE   KEY9
          APPEND    KEY9,GMSTR1
          IF        GMF1F = 0
            APPEND    SP1,GMSTR1
            GOTO      GMSTR500
          ENDIF
          APPEND    "-",GMSTR1
.
GMSTR450  LOAD      KEY9,GMF1F,GMONE,GMTWO,GMTHREE,GMFOUR,GMFIVE:     
                                 GMSIX,GMSEVEN,GMEIGHT,GMNINE
          SQUEEZE   KEY9
          APPEND    KEY9,GMSTR1
          APPEND    SP1,GMSTR1
.
GMSTR500  MATCH     SP1,GMD1F
          IF        !@EQUAL
            APPEND    "DOLLARS",GMSTR1
          ELSE
            GOTO      GMSTR600
          ENDIF
.
          PACK      DIM2,GMD1H,GMD1I
          MATCH     "00",DIM2
          IF        @EQUAL
            APPEND    " ONLY",GMSTR1
          ELSE
            APPEND    " AND ",GMSTR1
            APPEND    GMD1H,GMSTR1
            APPEND    GMD1I,GMSTR1
            APPEND    " CENTS",GMSTR1
          ENDIF
          GOTO      GMSTR650
.
GMSTR600  APPEND    GMD1H,GMSTR1
          APPEND    GMD1I,GMSTR1
          APPEND    " CENTS",GMSTR1
.
GMSTR650  PACK      PRNSTR1,SP70
          PACK      PRNSTR2,SP70
          RESET     GMSTR1
          RESET     GMSTR1,GM45
.
          MOVE      GM45,GMFORM3
.
GMSTR660  SUB       ONE,GMFORM3
          RESET     GMSTR1,GMFORM3
          CMATCH    SP1,GMSTR1
          GOTO      GMSTR660 IF NOT EQUAL
.
          MOVE      GMSTR1,PRNSTR2
.
          BUMP      GMSTR1,-1
          LENSET    GMSTR1
          RESET     GMSTR1
          MOVE      GMSTR1,PRNSTR1
.
.
GMSTR999  RETURN
.----------------------------------------------------------------------
. Print Cheque Continuation
.----------------------------------------------------------------------
CHQNX000  IF        FMCOAPCH=9 |FMCOAPCH=4
            IF        PRTSIDE<>0
              PRINT     " "
            ENDIF
          ENDIF
.
          COMPARE   MAXLINES,CLNO           * fill in any spare lines
          GOTO      CHQNX005 IF NOT LESS
          PRINT     " "
          ADD       ONE,CLNO
          GOTO      CHQNX000
.
CHQNX005  
          ASSIGN    DOLLARS-(XTOTINVC-XTOTCRD),DOLLARS
          BRANCH    FMCOAPCH,CHQNX010,CHQNX020,CHQNX030,CHQNX040,CHQNX050:
                             CHQNX060,CHQNX070,CHQNX080,CHQNX090,CHQNX100:
                             CHQNX110,CHQNX120,CHQNX130,CHQNX140,CHQNX150:
                             CHQNX160,CHQNX170,CHQNX180,CHQNX190,CHQNX200:
                             CHQNX210,CHQNX220,CHQNX230
.
.---- standard cheque layout ----
.
          PRINT     *45,"C/FORWARD : ",DOLLARS:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *67,"*CANCELLED",*N,*N,*N,*3,"***CANCELLED***":
                    *N,*N,*N,*N,*16,"C A N C E L L E D ";
          GOTO      CHQNX900
.
.---- HLC cheque layout ----
.
CHQNX010  PRINT     *N,*N,*50,"C/FORWARD : ",DOLLARS:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*16,"***CANCELLED***",*66,"*CANCELLED":
                    *N,*N,*N,*N,*21,"C A N C E L L E D ";
          GOTO      CHQNX900
.
.---- hastings cheque layout ----
.
CHQNX020  PRINT     *45,"C/FORWARD : ",DOLLARS:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *67,"*CANCELLED",*N,*N,*N,*3,"***CANCELLED***":
                    *N,*N,*N,*N,*16,"C A N C E L L E D ";
          GOTO      CHQNX900
.
.---- West Gippsland cheque layout ----
.
CHQNX030  PRINT     *45,"C/FORWARD : ",DOLLARS
          PRINT     *F,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*6,"CANCELLED":
                    *19,"*****",SP2,"*****",SP1,"*****",SP2,"*****",SP1,"*****":
                    SP2,"*****",SP1,"**":
                    *65,"CANCELLED",*N:
                    *N,*6,APMACN1:
                    *N,*6,APMACN2:
                    *N,*6,APMACA1:
                    *N,*6,APMACA2:
                    *N,*6,APMACA3,"  ",APMACPC:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N
          MOVE      ZERO,CLNO
          GOTO      CHQNX950
.
.---- MOD ----      
.
CHQNX040  PRINT     *N,*N,*52,"C/FORWARD   : ",DOLLARS,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*69,DATEH,*N:
                    *9,"***** C A N C E L L E D *****":
                    *N,*N,*N
          MATCH     SP70,APMACN2
          IF        @EQUAL
            PRINT     *12,APMACN1,*65,"**CANCELLED**":
                      *N,*12,APMACA1,*N,*12,APMACA2:
                      *N,*12,APMACA3," ",APMACPC,*N,*N,*N,*N,*N
          ELSE
            PRINT     *12,APMACN1,*65,"**CANCELLED**":
                      *N,*12,APMACN2,*N,*12,APMACA1:
                      *N,*12,APMACA2,*N,*12,APMACA3," ",APMACPC,*N,*N,*N,*N
          ENDIF
          GOTO      CHQNX900
.
.---- TAM cheque layout ----
.
CHQNX050  PRINT     *45,"C/FORWARD : ",DOLLARS:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *67,"*CANCELLED",*N,*N,*N,*3,"***CANCELLED***":
                    *N,*N,*N,*N,*16,"C A N C E L L E D ";
          GOTO      CHQNX900
.
.---- ACC cheque layout ----
.
CHQNX060  PRINT     *N,*47,"C/FORWARD : ",*59,DOLLARS:
                    *N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*10,"***CANCELLED***",*N,*N,*N,*61,"*CANCELLED":
                    *N,*N,*N,*N,*25,"C A N C E L L E D ";
          GOTO      CHQNX900
.
.---- GreyM ----
CHQNX070  PRINT     *N,*47,"C/FORWARD : ",*59,DOLLARS:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*13,"***CANCELLED***",*N,*61,"*CANCELLED":
                    *N,*N,*25,"C A N C E L L E D "
          GOTO      CHQNX900
.
.---- PVH cheque layout ----
.
CHQNX080  PRINT     *N,*N,*47,"C/FORWARD : ",DOLLARS:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*13,"***CANCELLED***",*63,"*CANCELLED":
                    *N,*N,*N,*N,*18,"C A N C E L L E D ";
          GOTO      CHQNX900
.
.---- Buderim cheque layout ----
.
CHQNX090  PRINT     *48,"Carried Forward : ",*67,"********.**"
          PRINT     *N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*4,"CANCELLED":
                    *16,"*****",SP1,"*****",SP1,"*****",SP2,"*****",SP1,"*****":
                    SP1,"*****",SP2,"**":
                    *N,*N,*61,"CANCELLED":
                    *N,*12,APMACN1:
                    *N,*12,APMACN2:
                    *N,*12,APMACA1:
                    *N,*12,APMACA2:
                    *N,*12,APMACA3,"  ",APMACPC:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N
          MOVE      ZERO,CLNO
          GOTO      CHQNX950
.
.---- Hawkesbury cheque layout ----
.
CHQNX100  PRINT     *N,*N,*50,"C/FORWARD : ",DOLLARS:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*3,"***CANCELLED***",*N,*N,*N,*8,"*CANCELLED":
                    *N,*57,"C A N C E L L E D ",*N;
          GOTO      CHQNX900
.
.---- SAR cheque layout ----
.
CHQNX110  PRINT     *N,*51,"C/FORWARD:",DOLLARS:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*5,"***CANCELLED***":
                    *61,"*CANCELLED",*N:
                    *N,*N,*16,"C A N C E L L E D ";
          GOTO      CHQNX900
.
.---- Mater cheque layout ----
.
CHQNX120  PRINT     *N,*51,"C/FORWARD:",DOLLARS:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*5,"***CANCELLED***":
                    *N,*55,"*CANCELLED":
                    *N,*16,"C A N C E L L E D ";
          GOTO      CHQNX900
.
.---- New standard cheque layout ----
.
CHQNX130  PRINT     *N,*N,*45,"C/FORWARD:",DOLLARS:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*5,"***CANCELLED***   ":
                    "***CANCELLED***":
                    *N,*57,"*CANCELLED":
                    *N,*N,*N,*12,"C A N C E L L E D ";
          GOTO      CHQNX900
.
.---- Hutt ---
.
CHQNX140  PRINT     *N,*37,"C/FORWARD : ",*57,DOLLARS,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N:
                    *N,*10,"***CANCELLED***":
                    *N:
                    *N,*62,"*CANCELLED":
                    *N,*12,"C A N C E L L E D ":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N
          GOTO      CHQNX900
.
.---- West Wimmera cheque layout ----
.
CHQNX150  PRINT     *N,*N,*50,"C/FORWARD:",DOLLARS:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*5,"***CANCELLED***":
                    *59,"*CANCELLED",*N:
                    *N,*N,*16,"C A N C E L L E D ",*F;
          GOTO      CHQNX900
.
.---- Holy Spirit cheque layout ----
.
CHQNX160  PRINT     *N,*53,"C/FORWARD : ",DOLLARS:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*3,"****CANCELLED****  ****CANCELLED****":
                    *N,*67,"*CANCELLED",*N,*N,*N,*3,"***CANCELLED***":
                    *N,*N,*N,*N,*N
          GOTO      CHQNX900
.
.---- St Vincents Melbourne ----
.
CHQNX170  PRINT     *N,*N,*45,"C/FORWARD : ",*66,DOLLARS
          PRINT     *F,*N,*N,*N,*N:
                    *N,*N,*N:
                    *6,"CANCELLED":
                    *20,"*****",SP2,"*****",SP1,"*****",SP1,"*****",SP2,"*****":
                    SP2,"*****",SP1,"**":
                    *N,*N,*N,*62,"CANCELLED":
                    *N,*6,APMACN1:
                    *N,*6,APMACN2:
                    *N,*6,APMACA1:
                    *N,*6,APMACA2:
                    *N,*6,APMACA3,"  ",APMACPC:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N
          MOVE      ZERO,CLNO
          GOTO      CHQNX950
.
.---- SVB cheque layout ----
.
CHQNX180  PRINT     *N,*N,*47,"C/FORWARD :    ",DOLLARS:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*13,"***CANCELLED***":
                    *N,*N,*N,*N,*18,"C A N C E L L E D ",*59,"*CANCELLED";
          GOTO      CHQNX900
.
.---- Standard Laser cheque layout ----
.
CHQNX190  PRINT     *N,*53,"C/FORWARD : ",DOLLARS:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*3,"****CANCELLED****  ****CANCELLED****":
                    *N,*67,"*CANCELLED",*N,*N,*N,*3,"***CANCELLED***":
                    *N,*N,*N,*N,*N
          GOTO      CHQNX900
.
.---- Latrobe Regional Laser cheque layout ----
.
CHQNX200  PRINT     *N,*N,*55,"C/FORWARD : ",DOLLARS:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*8,"***CANCELLED***":
                    *N,*N,*N,*8,"****CANCELLED****     ****CANCELLED****":
                    *65,"***CANCELLED***",*N,*N,*N:
                    *N,*N,*N,*N,*N
          GOTO      CHQNX900
.
.---- STH ----
.
..          PRINT     *N,*47,"C/FORWARD : ",*59,DOLLARS:
CHQNX210  PRINT     *N,*59,"CARRIED FORWARD":
                    *N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*10,"***CANCELLED***",*N,*N,*58,"*CANCELLED":
                    *N,*N,*25,"C A N C E L L E D "
          GOTO      CHQNX900
.
.---- HWK (Hawkes Bay) cheque layout ----
.
CHQNX220  PRINT     *N,*45,"C/FORWARD :     ",DOLLARS:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*19,"***CANCELLED***",*N,*N:
                    *N,*N,*64,"*CANCELLED",*N,*16,"C A N C E L L E D ",*N;
          GOTO      CHQNX900
.
.---- MHD (Mercy Hospital Dunedin) cheque layout ----
.
..          PRINT     *N,*47,"C/FORWARD : ",*59,DOLLARS:
CHQNX230  PRINT     *N,*64,*SUBSCR,"CARRIED FORWARD",*SUOFF:
                    *N,*N:
                    *N,*66,*SUBSCR,"**********",*SUOFF:
                    *N,*N,*N,*N,*N:
                    *N,*09,*SUBSCR,"***CANCELLED***",*SUOFF:
                    *N,*N,*N:
                    *N,*64,*SUBSCR,"*CANCELLED",*SUOFF:
                    *N,*13,*SUBSCR,"C A N C E L L E D ",*SUOFF:
                    *N,*N,*N,*N,*N,*N,*N,*N
          GOTO      CHQNX900
.
CHQNX900  ADD       "1",CHEQNUMB
          CALL      CHQHE000
          ASSIGN    DOLLARS+(XTOTINVC-XTOTCRD),DOLLARS
          GOTO      CHQNX999
.
CHQNX950  ASSIGN    DOLLARS+(XTOTINVC-XTOTCRD),DOLLARS
          ADD       "1",CHEQNUMB
.
CHQNX999  RETURN
.----------------------------------------------------------------------
. Update Cheque Number to IMS File Date Entered Field
.----------------------------------------------------------------------
CHQUPD00  PACK      KEY40,APBMBCH,LASTCRED,SP70
          PACK      KEY10,APBMBCH,LASTCRED,SP70
          CALL      RSAPIM1
.
CHQUPD10  CALL      RKAPIM1
          BRANCH    OVRCD,CHQUPD90
          PACK      KEY40,APIMBCH,APIMCRD,APIMREF,APIMDOC,SP70
          MATCH     KEY10,KEY40
          GOTO      CHQUPD90 IF NOT EQUAL
          MATCH     "Cheque Print",APIMDOC
          GOTO      CHQUPD10 IF NOT EQUAL
          MOVE      CHEQNUMB,APIMTDT
          CALL      UPAPIM1
          CALL      RDAPIM1
.
          PACK      KEY40,APIMDOC,APIMBCH,APIMCRD,APIMREF * write to chq file
          UNPACK    KEY40,APCLDOC,APCLBCH,APCLCRD,APCLREF
          CALL      RAAPCL1
          IF        1=OVRCD
            CALL      WRAPCL1
          ENDIF
          GOTO      CHQUPD10
.
CHQUPD90  RETURN
.----------------------------------------------------------
. Update Printed Cheque Numbers to Header and Detail File
.----------------------------------------------------------
UCHNO000  PACK      KEY40,APBMBCH,SP70
          CALL      RSAPIM1               * Main Loop through Invoice
.
UCHNO100  CALL      RKAPIM1               * Header Records for Batch
          BRANCH    OVRCD,UCHNO900
          MATCH     APBMBCH,APIMBCH
          GOTO      UCHNO900 IF NOT EQUAL
          MATCH     "Cheque Print",APIMDOC
          GOTO      UCHNO100 IF NOT EQUAL
.
          PACK      KEY51,APIMBCH,APIMCRD,APIMREF,APIMDOC,SP70
          PACK      KEY40,APIMBCH,APIMCRD,APIMREF,APIMDOC,SP70
          CALL      RSAPIN1               * Loop Through Details
.
UCHNO200  CALL      RKAPIN1               
          BRANCH    OVRCD,UCHNO300
          PACK      KEY51,APINBCH,APINCRD,APINREF,APINDOC,SP70
          MATCH     KEY40,KEY51
          GOTO      UCHNO300 IF NOT EQUAL
.
          PACK      KEY51,APINBCH,APINCRD,APINREF,APINDOC,APINORD,APINLIN,SP70
          PACK      APINDOC,SP7,APIMTDT * Saved Cheque Number of Print
          CALL      UPAPIN1
          CALL      RDAPIN1
          GOTO      UCHNO200
.
UCHNO300  PACK      KEY40,APIMBCH,APIMCRD,APIMREF,APIMDOC
          PACK      APIMDOC,SP7,APIMTDT * Saved Cheque Number of Print
          PACK      APIMTDT,CCC,CYY,CMM,CDD 
          REP       " 0",APIMTDT
          CALL      UPAPIM1
          CALL      RDAPIM1
.
          PACK      KEY40,APIMDOC,APIMBCH,APIMCRD,APIMREF * write to chq file
          UNPACK    KEY40,APCLDOC,APCLBCH,APCLCRD,APCLREF
          CALL      RAAPCL1
          IF        1=OVRCD
            CALL      WRAPCL1
          ENDIF
          PACK      KEY40,APIMBCH,APIMCRD,APIMREF,APIMDOC
          GOTO      UCHNO100
.
UCHNO900  RETURN
.----------------------------------------------------------------------
. Update Batch Details
.----------------------------------------------------------------------
UPINV000  DISPLAY   *P1:24,*EL            * Clear Line for Display
          PACK      KEY40,APBMBCH,SP70
          CALL      RSAPIM1               * Main Loop through Invoice
UPINV100  CALL      RKAPIM1               * Header Records for Batch
          BRANCH    OVRCD,UPINV900
          MATCH     APBMBCH,APIMBCH
          GOTO      UPINV900 IF NOT EQUAL
          MATCH     "1",APIMUPD
          GOTO      UPINV100 IF EQUAL     * Already Updated
          PACK      SAVKEY40,APIMBCH,APIMCRD,APIMREF,APIMDOC
.
          PACK      KEY40,APIMBCH,APIMCRD,APIMREF,APIMDOC
          PACK      KEY51,APIMBCH,APIMCRD,APIMREF,APIMDOC,SP70
          CALL      RSAPIN1               * Loop Through Allocation Details
.
UPINV200  CALL      RKAPIN1               * Within The Invoice
          BRANCH    OVRCD,UPINV300
          PACK      SAVKEY51,APINBCH,APINCRD,APINREF,APINDOC,APINORD,APINLIN
          MATCH     SAVKEY40,SAVKEY51
          GOTO      UPINV300 IF NOT EQUAL
.
          MATCH     "1",APINUPD
          GOTO      UPINV200 IF EQUAL     * Already Updated
.
          MATCH     "~~",APIMCRD          * No Original Invoice Details
          GOTO      UPINV250 IF EQUAL     * for Non Specific Creditors
          MATCH     SP70,APIMREF          * No Original Invoice Details
          GOTO      UPINV250 IF EQUAL     * for Blank Invoice Ref.
.
.                             Bch Doc   Ord  Lin
          UNPACK    APINDES,KEY5,KEY15,KEY8,KEY3
          PACK      KEY40,KEY5,APINCRD,APINREF,KEY15
          CALL      RDAPIM1
          IF        OVRCD=0
            MATCH     "1",APIMTYP
            IF        @EQUAL
              ASSIGN    SEQ*APINAMT,PAYTOTAL
              ASSIGN    SEQ*APINGST,GSTTOTAL
            ELSE
              MOVE      APINAMT,PAYTOTAL
              MOVE      APINGST,GSTTOTAL
            ENDIF
            ASSIGN    APIMPAY+PAYTOTAL+GSTTOTAL,APIMPAY
            IF        APIMTOT+APIMGST-APIMDIS=APIMPAY
              MOVE      ZERO,APIMOUT
            ELSE 
              MOVE      ONE,APIMOUT
            ENDIF
            CALL      UPAPIM1
          ENDIF
.
          PACK      KEY51,KEY5,APINCRD,APINREF,KEY15,KEY8,KEY3
          CALL      RDAPIN1
          IF        OVRCD=0
            ASSIGN    APINPAY+PAYTOTAL+GSTTOTAL,APINPAY
            CALL      UPAPIN1
          ENDIF
.
.--- mark inp record as updated ----
.
UPINV250  MOVE      SAVKEY51,KEY51
          CALL      RDAPIN1
          IF        OVRCD=0
            MOVE      ONE,APINUPD       * Updated     = 1 Yes
            ASSIGN    APINAMT+APINGST,APINPAY
            CALL      UPAPIN1
          ENDIF
          GOTO      UPINV200
.
.---- end of inp loop ----
.
UPINV300  MOVE      SAVKEY40,KEY40
          CALL      RDAPIM1
          IF        OVRCD=0
            MOVE      ONE,APIMUPD       * Updated     = 1 Yes
            MOVE      ZERO,APIMOUT
            ASSIGN    APIMTOT+APIMGST,APIMPAY
            MOVE      ZERO,APIMDIS
            CALL      UPAPIM1
            UNPACK    APIMCRD,D2,D3
            MATCH     "~~",D2
            IF        @EQUAL
              PACK      KEY8,APIMBCH,D3,SP70
              CALL      RDAPNS1
              IF        OVRCD=0
                PROC      APSNKIUP
                MOVE      SAVKEY40,KEY40
                CALL      RDAPIM1
              ENDIF
            ENDIF
          ENDIF
          GOTO      UPINV100
.
UPINV900  RETURN
.**********************************************************************
. Check if cheque is to be printed for a particular creditor
.**********************************************************************
CHCHQ000  
          MOVE      ZERO,CREDCAL
          PACK      KEY40,APBMBCH,APIMCRD,SP70
          CALL      RSAPIM1
.
CHCHQ100  CALL      RKAPIM1
          BRANCH    OVRCD,CHCHQ900
          PACK      KEY10,APIMBCH,APIMCRD,SP70
          MATCH     KEY10,KEY40
          GOTO      CHCHQ900 IF NOT EQUAL
.
          ASSIGN    APIMTOT+APIMGST-APIMDIS+CREDCAL,CREDCAL
          GOTO      CHCHQ100
.
CHCHQ900
          IF        CREDCAL>0
            MOVE      ZERO,EXIT
          ELSE
            MOVE      ONE,EXIT
          ENDIF
.
CHCHQ999  RETURN
.----------------------------------------------------------------------
. Print Cheque at Top of Page (West Gippsland & Buderim Only)
.----------------------------------------------------------------------
CHQSTR00  MOVE      CREDCAL,DOLLARS
          MOVE      "1",SECTOR
          MOVE      DOLLARS,D13
          RESET     D13
          MOVE      D13,D5
          MOVE      ZERO,F5
          MOVE      D5,F5
          MOVE      D5,DHUNTH
          IF        F5<10
            ADD       ONE,F5
            LOAD      DHUNTH,F5,DSTARS,DONE,DTWO,DTHREE,DFOUR,DFIVE,DSIX,DSEVEN:
                      DEIGHT,DNINE
          ENDIF
          RESET     D13,6
.
CHQSTR20  MOVE      SP1,D1
          MOVE      D13,D1
          MATCH     SP1,D1
          GOTO      CHQSTR30 IF NOT EQUAL
          MOVE      DSTARS,NUMBER
          GOTO      CHQSTR40
.
CHQSTR30  MOVE      D1,F2
          ADD       ONE,F2
          LOAD      NUMBER,F2,DZERO,DONE,DTWO,DTHREE,DFOUR,DFIVE,DSIX,DSEVEN:
                    DEIGHT,DNINE
.
CHQSTR40  STORE     NUMBER,SECTOR,DTENTH,DTHOUS,DHUND,DTENS,DUNITS
          BUMP      D13
          ADD       "1",SECTOR
          COMPARE   "6",SECTOR
          GOTO      CHQSTR50 IF EQUAL
          GOTO      CHQSTR20
.
CHQSTR50  RESET     D13,12
          RESET     DCENTS
          CMOVE     D13,DCENTS
          RESET     D13,13
          RESET     DCENTS,2
          CMOVE     D13,DCENTS
          RESET     DCENTS
.
          MOVE      DOLLARS,D13
          REP       " *",D13
          MOVE      DOLLARS,DOLLARS1
          MOVE      DOLLARS1,D11
          REP       " *",D11
.
CHQSTR70  COMPARE   NINE,FMCOAPCH
          GOTO      CHQSTR80 IF EQUAL
          COMPARE   THREE,FMCOAPCH
          GOTO      CHQSTR75 IF EQUAL
          COMPARE   TEN7,FMCOAPCH
          GOTO      CHQSTR99 IF NOT EQUAL
.
          PRINT     *F,*N,*N,*N,*N:
                    *N,*N,*N:
                    *7,CDATE,*20,DHUNTH,SP2,DTENTH,SP1,DTHOUS,SP1,DHUND:
                    SP2,DTENS,SP2,DUNITS,SP1,DCENTS,*N,*N,*N,*62,D13:
                    *N,*10,APMACN1
          MATCH     SP70,APMACN2
          IF        !(@EQUAL)
            PRINT     *10,APMACN2
          ENDIF
          PRINT     *10,APMACA1:
                    *N,*10,APMACA2:
                    *N,*10,APMACA3,"  ",APMACPC:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N
          MATCH     SP70,APMACN2
          IF        @EQUAL
            PRINT     " "
          ENDIF
          MOVE      ZERO,DOLLARS
          GOTO      CHQSTR99
.
CHQSTR75  PRINT     *F,*N,*N,*N,*N:
                    *N,*66,CDATE,*N,*N,*N,*N:
                    *6,DHUNTH,SP3,DTENTH,SP2,DTHOUS,SP3,DHUND,SP3,DTENS:
                    SP3,DUNITS,SP3,DCENTS:
                    *N,*60,D13:
                    *N,*N,*10,APMACN1
          MATCH     SP70,APMACN2
          IF        !(@EQUAL)
            PRINT     *10,APMACN2
          ENDIF
          PRINT     *10,APMACA1:
                    *N,*10,APMACA2:
                    *N,*10,APMACA3,"  ",APMACPC:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N
          MATCH     SP70,APMACN2
          IF        @EQUAL
            PRINT     " "
          ENDIF
          MOVE      ZERO,DOLLARS
          GOTO      CHQSTR99
.
CHQSTR80  MATCH     "*****",DHUNTH
          IF        !@EQUAL
            REP       "* ",DHUNTH
          ENDIF
          MATCH     "*****",DTENTH
          IF        !@EQUAL
            REP       "* ",DTENTH
          ENDIF
          MATCH     "*****",DTHOUS
          IF        !@EQUAL
            REP       "* ",DTHOUS
          ENDIF
          MATCH     "*****",DHUND
          IF        !@EQUAL
            REP       "* ",DHUND
          ENDIF
          MATCH     "*****",DTENS
          IF        !@EQUAL
            REP       "* ",DTENS
          ENDIF
          MATCH     "*****",DUNITS
          IF        !@EQUAL
            REP       "* ",DUNITS
          ENDIF
          PRINT     *N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*4,CDATE:
                    *16,DHUNTH,SP1,DTENTH,SP1,DTHOUS,SP2,DHUND,SP1,DTENS:
                    SP1,DUNITS,SP2,DCENTS:
                    *N,*N,*61,D11:
                    *N,*12,APMACN1
          MATCH     SP70,APMACN2
          IF        !(@EQUAL)
            PRINT     *12,APMACN2
          ENDIF
          PRINT     *12,APMACA1:
                    *N,*12,APMACA2:
                    *N,*12,APMACA3,"  ",APMACPC
          MATCH     SP70,APMACN2
          IF        @EQUAL
            PRINT     " "
          ENDIF
          PRINT     *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *3,"INVOICE",*20,"AMOUNT",*28,"INVOICE",*45,"AMOUNT":
                    *54,"INVOICE",*72,"AMOUNT",*N
          MOVE      ZERO,DOLLARS
.
CHQSTR99  RETURN
.

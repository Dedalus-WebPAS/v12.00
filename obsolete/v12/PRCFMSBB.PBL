.******************************************************************************
.* System    :   Accounting System                                            *
.* Procedure :   PRCFMSBB                                                     *
.* Desc      :   Total Account Update for a single account budgets only       *
.* Used by   :   IBAFMS63 Initial Budget Creation                             *
.                IBAFMS68 Budget Linking                                      *
.*               IBAFMS82 Budget Modelling                                    *
.*               IBAFMS83 Budget by Account Maintenance                       *
.*               IBAFMS84 Budget by Cost Centre Maintenance                   *
.*               IBAFMS86 Statistical Budget Maintenance                      *
.*               PRCFMSAA Total Account Update                                *
.*                                                                            *
.******************************************************************************
.* Date      :   03.12.90                                                     *
.* Author    :   B.G.Ackland (IBA)                                            *
.* Mods      :   03.06.91  Neeriem Dye (IBA)                                  *
.*                         Modified for Budget Linking                        *
.*                                                                            *
.*               26.08.91  Neeriem Dye (IBA)                                  *
.*                         Modified to move zero to a var divided by zero     *
.*                                                                            *
.******************************************************************************
.$$$$$$
.    1. Open Files Required 
.          OPEN     FMSAMAA1,"fmsamaaf"
.          OPEN     FMSAMAA2,"fmsamaaf"
.          OPEN     FMSAMAA3,"fmsamaaf"
.          OPEN     FMSLMAA1,"fmslmaaf"
.          OPEN     FMSTCFA1,"fmstcfaf"
.          OPEN     FMSTCFA2,"fmstcfaf"
.          OPEN     FMSBUDA1,"fmsbxxxx" For Budget Required
.          OPEN     FMSSBUA1,"fmscxxxx" For Budget Required
.          OPEN     FMSLBUA2,"fmslxxxx" For Budget Required
.          OPEN     CONTROLF,"controlf"
.          CALL     RDFMCO51
.          CALL     RDFMCO52
.
.    2. Global Variables Required - LEDGER ACCOUNT
.                                   BUDTYPE  current budget type
.                                   LINKONLY update budget link data only 1=yes
.    3. For the LEDGER ACCOUNT Passed to this procedure the program will
.       Calculate and update a new total for all account that  the LEDGER
.       ACCOUNT Affect. Budgets Only.
.
.$$$$$$
.
.==============================================================================
.FILE DESCRIPTION INCLUDES
.-------------------------
          DEFPROC   FMSBB000
.
          INC       FMSTUPFD/INC
.
.==============================================================================
.LOCAL VARIABLE DEFINITION
.-------------------------
ACTFILE   DIM       8
F12P6     FORM      12.6
.
SAV01     FORM      12.6
SAV02     FORM      12.6
SAV03     FORM      12.6
SAV04     FORM      12.6
SAV05     FORM      12.6
SAV06     FORM      12.6
SAV07     FORM      12.6
SAV08     FORM      12.6
SAV09     FORM      12.6
SAV10     FORM      12.6
SAV11     FORM      12.6
SAV12     FORM      12.6
SAV13     FORM      12.6
.
SAVA01    FORM      12.2
SAVA02    FORM      12.2
SAVA03    FORM      12.2
SAVA04    FORM      12.2
SAVA05    FORM      12.2
SAVA06    FORM      12.2
SAVA07    FORM      12.2
SAVA08    FORM      12.2
SAVA09    FORM      12.2
SAVA10    FORM      12.2
SAVA11    FORM      12.2
SAVA12    FORM      12.2
SAVA13    FORM      12.2
.
SAVA01D   FORM      12
SAVA02D   FORM      12
SAVA03D   FORM      12
SAVA04D   FORM      12
SAVA05D   FORM      12
SAVA06D   FORM      12
SAVA07D   FORM      12
SAVA08D   FORM      12
SAVA09D   FORM      12
SAVA10D   FORM      12
SAVA11D   FORM      12
SAVA12D   FORM      12
SAVA13D   FORM      12
.
SAVA01T   FORM      9
SAVA02T   FORM      9
SAVA03T   FORM      9
SAVA04T   FORM      9
SAVA05T   FORM      9
SAVA06T   FORM      9
SAVA07T   FORM      9
SAVA08T   FORM      9
SAVA09T   FORM      9
SAVA10T   FORM      9
SAVA11T   FORM      9
SAVA12T   FORM      9
SAVA13T   FORM      9
.
STATFILE  DIM       8
SAVKEY18  DIM       18
SAVKEY14  DIM       14
.
SAVKEY33  DIM      33
S01KEY33  DIM      33
S02KEY33  DIM      33
S03KEY33  DIM      33
S04KEY33  DIM      33
S05KEY33  DIM      33
S06KEY33  DIM      33
S07KEY33  DIM      33
S08KEY33  DIM      33
S09KEY33  DIM      33
S10KEY33  DIM      33
S11KEY33  DIM      33
S12KEY33  DIM      33
S13KEY33  DIM      33
S14KEY33  DIM      33
S15KEY33  DIM      33
S16KEY33  DIM      33
S17KEY33  DIM      33
S18KEY33  DIM      33
S19KEY33  DIM      33
S20KEY33  DIM      33
S21KEY33  DIM      33
S22KEY33  DIM      33
S23KEY33  DIM      33
S24KEY33  DIM      33
S25KEY33  DIM      33
S26KEY33  DIM      33
S27KEY33  DIM      33
S28KEY33  DIM      33
S29KEY33  DIM      33
S30KEY33  DIM      33
S31KEY33  DIM      33
S32KEY33  DIM      33
S33KEY33  DIM      33
S34KEY33  DIM      33
S35KEY33  DIM      33
S36KEY33  DIM      33
S37KEY33  DIM      33
S38KEY33  DIM      33
S39KEY33  DIM      33
S40KEY33  DIM      33
SKEY20    DIM      20
COUNT     FORM     2
.**********************************************************************
. Routine to loop through the total calculation tree
.**********************************************************************
          OPEN     FMSTUPA1,"fmstupaf"
          UNPACK   SP70,FMTUPORT,FMTUSPEC,FMTUTLED,FMTUTACC,SKEY20
.
          BRANCH   LINKONLY,FMSBB500             * update for budget link only ?
          MOVE     ZERO,COUNT
          CALL     TOTL0000                      * up date for LEDGER/ACCOUNT
.
FMSBB500  CALL     UBUD0000                      * update for budget link
          GOTO     FMSBB999
.
.**********************************************************************
. TOTL - Do Calculation
.**********************************************************************
TOTL0000  PACK     KEY33,LEDGER,ACCOUNT,SP70
          ADD      ONE,COUNT
          COMPARE  "41",COUNT
          GOTO     TOTL9999 IF EQUAL
          CALL     RSFMTC2
TOTL1000  CALL     RKFMTC2
          BRANCH   OVRCD,TOTL9999             * Exit Routine when the account
          MATCH    LEDGER,FMTCSLED            * Does Not Add to Any More 
          GOTO     TOTL9999 IF NOT EQUAL      * Account codes.
          MATCH    ACCOUNT,FMTCSACC
          GOTO     TOTL9999 IF NOT EQUAL
.
          PACK     SAVKEY33,FMTCSLED,FMTCSACC,FMTCTLED,FMTCTACC,FMTCASEQ
          STORE    SAVKEY33,COUNT,S01KEY33,S02KEY33,S03KEY33,S04KEY33,S05KEY33:
                                  S06KEY33,S07KEY33,S08KEY33,S09KEY33,S10KEY33:
                                  S11KEY33,S12KEY33,S13KEY33,S14KEY33,S15KEY33:
                                  S16KEY33,S17KEY33,S18KEY33,S19KEY33,S20KEY33:
                                  S21KEY33,S22KEY33,S23KEY33,S24KEY33,S25KEY33:
                                  S26KEY33,S27KEY33,S28KEY33,S29KEY33,S30KEY33:
                                  S31KEY33,S32KEY33,S33KEY33,S34KEY33,S35KEY33:
                                  S36KEY33,S37KEY33,S38KEY33,S39KEY33,S40KEY33
.
          MOVE     FMTCTLED,LEDGER
          MOVE     FMTCTACC,ACCOUNT
.
          CALL     CALC0000      * Recalculate the total for this Total Account
.
          CALL     TOTL0000      * Update next level up the tree
.
          SUB      ONE,COUNT     * Walk Back Down The Tree
.
          LOAD     SAVKEY33,COUNT,S01KEY33,S02KEY33,S03KEY33,S04KEY33,S05KEY33:
                                  S06KEY33,S07KEY33,S08KEY33,S09KEY33,S10KEY33:
                                  S11KEY33,S12KEY33,S13KEY33,S14KEY33,S15KEY33:
                                  S16KEY33,S17KEY33,S18KEY33,S19KEY33,S20KEY33:
                                  S21KEY33,S22KEY33,S23KEY33,S24KEY33,S25KEY33:
                                  S26KEY33,S27KEY33,S28KEY33,S29KEY33,S30KEY33:
                                  S31KEY33,S32KEY33,S33KEY33,S34KEY33,S35KEY33:
                                  S36KEY33,S37KEY33,S38KEY33,S39KEY33,S40KEY33
.
          UNPACK   SAVKEY33,LEDGER,ACCOUNT,FMTCTLED,FMTCTACC,FMTCASEQ
          MOVE     SAVKEY33,KEY33
          CALL     RDFMTC2
.
          GOTO     TOTL1000
.
TOTL9999  
          RETURN
.******************************************************************************
.*  Calculate Total Account Total
.******************************************************************************
CALC0000  PACK      KEY14,LEDGER,ACCOUNT
          CALL      RDFMAM1
          BRANCH    OVRCD,CALC9999
          MATCH     "9",FMAMTYPE            * Statistical Total Account
          GOTO      CALC2000 IF EQUAL
          MATCH     "6",FMAMTYPE            * Normal Total Account
          GOTO      CALC9999 IF NOT EQUAL
.
          CALL      MZTS0000       * Move Zero to Save Variables
.
          CALL      CALF0000       * Calculate Financial Total
.
          PACK      KEY14,FMAMLEDG,FMAMACCT
          CALL      RDFMBU1
          BRANCH    OVRCD,CALC1200
.
          CALL      MSTA0000       * Move Save to File Variables
          CALL      UPFMBU1
          GOTO      CALC9999
.
CALC1200  MOVE      FMAMLEDG,FMBUCULD
          MOVE      FMAMACCT,FMBUCUAC
          MOVE      SP70,FMBUCUSP
          MOVE      SP70,FMBUCUPR
          CALL      MSTA0000       * Move Save to File Variables
          CALL      WRFMBU1
          GOTO      CALC9999
.
. Statistical Accounts
.
CALC2000  CALL      MZSS0000       * Move Zeros to Saved Amounts
.
          CALL      CALS0000       * Calculate Statistical Totals
.
          PACK      KEY14,FMAMLEDG,FMAMACCT
          CALL      RDFMST1
          BRANCH    OVRCD,CALC3200
          CALL      MSTF0000       * Move Saved Amounts to File Totals
          CALL      UPFMST1
          GOTO      CALC4000
.
CALC3200  MOVE      FMAMLEDG,FMSTCULD
          MOVE      FMAMACCT,FMSTCUAC
          MOVE      SP70,FMSTCUPR
          CALL      MSTF0000       * Move Saved Amounts to File Totals
          CALL      WRFMST1
.
.---- check for budget link ----
.
CALC4000  PACK      KEY28,FMAMLEDG,FMAMACCT,SP70
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          CALL      RSFMBL2       * go to start of budget link file (if open)
          TRAPCLR   IO
          BRANCH    OVRCD,CALC9999
.
CALC4100  CALL      RKFMBL2
          BRANCH    OVRCD,CALC9999
          PACK      KEY14,FMBLFLED,FMBLFACC,SP70
          MATCH     KEY14,KEY28
          GOTO      CALC9999 IF NOT EQUAL
.
          PACK      KEY14,FMBLTLED,FMBLTACC,SP70
          CALL      RDFMAM1
          BRANCH    OVRCD,CALC4100
.
          CALL      WRTU0000
          MATCH     "8",FMAMTYPE
          GOTO      CALC4200 IF NOT EQUAL   * stat posting ?
          UNPACK    KEY14,FMSTCULD,FMSTCUAC
          UNPACK    SP70,FMSTCUPR
          CALL      DEFMST1
          CALL      WRFMST1
          GOTO      CALC4100
.
CALC4200  MATCH     "6",FMAMTYPE
          GOTO      CALC4100 IF NOT LESS    * normal posting ?
          UNPACK    KEY14,FMBUCULD,FMBUCUAC
          UNPACK    SP70,FMBUCUPR
          CALL      GETS0000
          CALL      DEFMBU1
          CALL      WRFMBU1
          GOTO      CALC4100
.
CALC9999  RETURN
.**********************************************************************
.  WRTU - write total update for budget link           Called By CALC
.**********************************************************************
WRTU0000  PACK      KEY30,FMTUPORT,FMTUSPEC,FMTUTLED,FMTUTACC,SP70
          MOVE      "~~",KEY2
          PACK      KEY20,KEY2,BUDTYPE,FMBLTLED,FMBLTACC,SP70
          CALL      RDFMTU1            * record exists ?
          COMPARE   ZERO,OVRCD
          GOTO      WRTU9000 IF EQUAL
.
          UNPACK    KEY20,FMTUPORT,FMTUSPEC,FMTUTLED,FMTUTACC
          MOVE      SP70,FMTUSPAR
          CALL      WRFMTU1            * Flag For Total Account Update
.
WRTU9000  UNPACK    KEY30,KEY20
          CALL      RDFMTU1            * get current record
.
WRTU9999  RETURN
.**********************************************************************
.  GETS - move stat values to actuals                  Called By CALC
.**********************************************************************
GETS0000  
          MOVE      FMSTCA01,FMBUCA01
          MOVE      FMSTCA02,FMBUCA02
          MOVE      FMSTCA03,FMBUCA03
          MOVE      FMSTCA04,FMBUCA04
          MOVE      FMSTCA05,FMBUCA05
          MOVE      FMSTCA06,FMBUCA06
          MOVE      FMSTCA07,FMBUCA07
          MOVE      FMSTCA08,FMBUCA08
          MOVE      FMSTCA09,FMBUCA09
          MOVE      FMSTCA10,FMBUCA10
          MOVE      FMSTCA11,FMBUCA11
          MOVE      FMSTCA12,FMBUCA12
          MOVE      FMSTCA13,FMBUCA13
.
          MOVE      FMSTCA01,FMBUCB01
          MOVE      FMSTCA02,FMBUCB02
          MOVE      FMSTCA03,FMBUCB03
          MOVE      FMSTCA04,FMBUCB04
          MOVE      FMSTCA05,FMBUCB05
          MOVE      FMSTCA06,FMBUCB06
          MOVE      FMSTCA07,FMBUCB07
          MOVE      FMSTCA08,FMBUCB08
          MOVE      FMSTCA09,FMBUCB09
          MOVE      FMSTCA10,FMBUCB10
          MOVE      FMSTCA11,FMBUCB11
          MOVE      FMSTCA12,FMBUCB12
          MOVE      FMSTCA13,FMBUCB13
.
          MOVE      FMSTCA01,FMBUCC01
          MOVE      FMSTCA02,FMBUCC02
          MOVE      FMSTCA03,FMBUCC03
          MOVE      FMSTCA04,FMBUCC04
          MOVE      FMSTCA05,FMBUCC05
          MOVE      FMSTCA06,FMBUCC06
          MOVE      FMSTCA07,FMBUCC07
          MOVE      FMSTCA08,FMBUCC08
          MOVE      FMSTCA09,FMBUCC09
          MOVE      FMSTCA10,FMBUCC10
          MOVE      FMSTCA11,FMBUCC11
          MOVE      FMSTCA12,FMBUCC12
          MOVE      FMSTCA13,FMBUCC13
          DIV       "1000",FMBUCC01
          DIV       "1000",FMBUCC02
          DIV       "1000",FMBUCC03
          DIV       "1000",FMBUCC04
          DIV       "1000",FMBUCC05
          DIV       "1000",FMBUCC06
          DIV       "1000",FMBUCC07
          DIV       "1000",FMBUCC08
          DIV       "1000",FMBUCC09
          DIV       "1000",FMBUCC10
          DIV       "1000",FMBUCC11
          DIV       "1000",FMBUCC12
          DIV       "1000",FMBUCC13
.
GETS9999  RETURN
.**********************************************************************
.* Calculate Financial Total Account
.**********************************************************************
CALF0000  PACK      KEY33,FMAMLEDG,FMAMACCT
          PACK      SAVKEY14,FMAMLEDG,FMAMACCT
          CALL      RSFMTC1
CALF1000  CALL      RKFMTC1
          BRANCH    OVRCD,CALF9000
.
          UNPACK    SAVKEY14,FMAMLEDG,FMAMACCT
          MATCH     FMAMLEDG,FMTCTLED
          GOTO      CALF9000 IF NOT EQUAL
.
          MATCH     FMAMACCT,FMTCTACC
          GOTO      CALF9000 IF NOT EQUAL
.
          PACK      KEY14,FMTCSLED,FMTCSACC
          CALL      RDFMAM1            * Get Summary Details
          BRANCH    OVRCD,CALF1000
          CALL      RDFMBU1            * Get Summary Details
          BRANCH    OVRCD,CALF1000
.
          CALL      ADDF0000           * Add Sub total to Saved Totals
.
          GOTO      CALF1000
.
CALF9000  MOVE      SAVKEY14,KEY14     * Read back masterfile record and 
          CALL      RDFMAM1            * mult/div by constants
.
CALF9999  RETURN
.**********************************************************************
.* Calculate Statistical Total Account
.**********************************************************************
CALS0000  PACK      KEY33,FMAMLEDG,FMAMACCT
          PACK      SAVKEY14,FMAMLEDG,FMAMACCT
          CALL      RSFMTC1
CALS1000  CALL      RKFMTC1
          BRANCH    OVRCD,CALS9000
.
          UNPACK    SAVKEY14,FMAMLEDG,FMAMACCT
.
          MATCH     FMAMLEDG,FMTCTLED
          GOTO      CALS9000 IF NOT EQUAL
.
          MATCH     FMAMACCT,FMTCTACC
          GOTO      CALS9000 IF NOT EQUAL
.
          PACK      KEY14,FMTCSLED,FMTCSACC
          CALL      RDFMAM1
          BRANCH    OVRCD,CALS1000
.
          MATCH     "7",FMAMTYPE
          GOTO      CALS2000 IF NOT LESS   * stat record
.
          CALL      RDFMBU1
          BRANCH    OVRCD,CALS1000     * get data from nornal sub-account
          MOVE      FMBUCA01,FMSTCA01
          MOVE      FMBUCA02,FMSTCA02
          MOVE      FMBUCA03,FMSTCA03
          MOVE      FMBUCA04,FMSTCA04
          MOVE      FMBUCA05,FMSTCA05
          MOVE      FMBUCA06,FMSTCA06
          MOVE      FMBUCA07,FMSTCA07
          MOVE      FMBUCA08,FMSTCA08
          MOVE      FMBUCA09,FMSTCA09
          MOVE      FMBUCA10,FMSTCA10
          MOVE      FMBUCA11,FMSTCA11
          MOVE      FMBUCA12,FMSTCA12
          MOVE      FMBUCA13,FMSTCA13
.
          GOTO      CALS3000
.
CALS2000  CALL      RDFMST1
          BRANCH    OVRCD,CALS1000     * get data from stat sub-account
.
CALS3000  CALL      ADDS0000           * Add Sub total to Saved Totals (stats)
.
          GOTO      CALS1000
.
CALS9000  MOVE      SAVKEY14,KEY14     * Read back masterfile record and 
          CALL      RDFMAM1            * mult/div by constants
          BRANCH    OVRCD,CALS9999
          CALL      MAMT0000
.
CALS9999  RETURN
.**********************************************************************
.* Mult Amounts by Constant                                           *
.**********************************************************************
MAMT0000  MOVE      FMAMMULT,F12P6     * get constant
          MOVE      FMAMDIV,CDIV1
          MOVE      F12P6,CDIV2
          CALL      CDIV0000
          MOVE      CDIV2,F12P6
.
.
          MULT      F12P6,SAV01
          MULT      F12P6,SAV02
          MULT      F12P6,SAV03
          MULT      F12P6,SAV04
          MULT      F12P6,SAV05
          MULT      F12P6,SAV06
          MULT      F12P6,SAV07
          MULT      F12P6,SAV08
          MULT      F12P6,SAV09
          MULT      F12P6,SAV10
          MULT      F12P6,SAV11
          MULT      F12P6,SAV12
          MULT      F12P6,SAV13
.
MAMT9999  RETURN
.**********************************************************************
.* Add stats records to temps
.**********************************************************************
ADDS0000  MOVE      FMTCADDT,F1
          BRANCH    F1,ADDS2000,ADDS3000,ADDS4000 * 0=add,1=sub,2=div,3=mult
.
. add
.
ADDS1000  ADD       FMSTCA01,SAV01
          ADD       FMSTCA02,SAV02
          ADD       FMSTCA03,SAV03
          ADD       FMSTCA04,SAV04
          ADD       FMSTCA05,SAV05
          ADD       FMSTCA06,SAV06
          ADD       FMSTCA07,SAV07
          ADD       FMSTCA08,SAV08
          ADD       FMSTCA09,SAV09
          ADD       FMSTCA10,SAV10
          ADD       FMSTCA11,SAV11
          ADD       FMSTCA12,SAV12
          ADD       FMSTCA13,SAV13
          GOTO      ADDS9999
.
. sub
.
ADDS2000  SUB       FMSTCA01,SAV01
          SUB       FMSTCA02,SAV02
          SUB       FMSTCA03,SAV03
          SUB       FMSTCA04,SAV04
          SUB       FMSTCA05,SAV05
          SUB       FMSTCA06,SAV06
          SUB       FMSTCA07,SAV07
          SUB       FMSTCA08,SAV08
          SUB       FMSTCA09,SAV09
          SUB       FMSTCA10,SAV10
          SUB       FMSTCA11,SAV11
          SUB       FMSTCA12,SAV12
          SUB       FMSTCA13,SAV13
          GOTO      ADDS9999
.
. div
.
ADDS3000  MOVE      FMSTCA01,CDIV1
          MOVE      SAV01,CDIV2
          CALL      CDIV0000
          MOVE      CDIV2,SAV01
.
          MOVE      FMSTCA02,CDIV1
          MOVE      SAV02,CDIV2
          CALL      CDIV0000
          MOVE      CDIV2,SAV02
.
          MOVE      FMSTCA03,CDIV1
          MOVE      SAV03,CDIV2
          CALL      CDIV0000
          MOVE      CDIV2,SAV03
.
          MOVE      FMSTCA04,CDIV1
          MOVE      SAV04,CDIV2
          CALL      CDIV0000
          MOVE      CDIV2,SAV04
.
          MOVE      FMSTCA05,CDIV1
          MOVE      SAV05,CDIV2
          CALL      CDIV0000
          MOVE      CDIV2,SAV05
.
          MOVE      FMSTCA06,CDIV1
          MOVE      SAV06,CDIV2
          CALL      CDIV0000
          MOVE      CDIV2,SAV06
.
          MOVE      FMSTCA07,CDIV1
          MOVE      SAV07,CDIV2
          CALL      CDIV0000
          MOVE      CDIV2,SAV07
.
          MOVE      FMSTCA08,CDIV1
          MOVE      SAV08,CDIV2
          CALL      CDIV0000
          MOVE      CDIV2,SAV08
.
          MOVE      FMSTCA09,CDIV1
          MOVE      SAV09,CDIV2
          CALL      CDIV0000
          MOVE      CDIV2,SAV09
.
          MOVE      FMSTCA10,CDIV1
          MOVE      SAV10,CDIV2
          CALL      CDIV0000
          MOVE      CDIV2,SAV10
.
          MOVE      FMSTCA11,CDIV1
          MOVE      SAV11,CDIV2
          CALL      CDIV0000
          MOVE      CDIV2,SAV11
.
          MOVE      FMSTCA12,CDIV1
          MOVE      SAV12,CDIV2
          CALL      CDIV0000
          MOVE      CDIV2,SAV12
.
          MOVE      FMSTCA13,CDIV1
          MOVE      SAV13,CDIV2
          CALL      CDIV0000
          MOVE      CDIV2,SAV13
.
          GOTO      ADDS9999
.
. mult
.
ADDS4000  MULT      FMSTCA01,SAV01
          MULT      FMSTCA02,SAV02
          MULT      FMSTCA03,SAV03
          MULT      FMSTCA04,SAV04
          MULT      FMSTCA05,SAV05
          MULT      FMSTCA06,SAV06
          MULT      FMSTCA07,SAV07
          MULT      FMSTCA08,SAV08
          MULT      FMSTCA09,SAV09
          MULT      FMSTCA10,SAV10
          MULT      FMSTCA11,SAV11
          MULT      FMSTCA12,SAV12
          MULT      FMSTCA13,SAV13
          GOTO      ADDS9999
.
ADDS9999  RETURN
.**********************************************************************
. Move Zero to all stats Saved Amounts
.**********************************************************************
MZSS0000  MOVE      ZERO,SAV01
          MOVE      ZERO,SAV02
          MOVE      ZERO,SAV03
          MOVE      ZERO,SAV04
          MOVE      ZERO,SAV05
          MOVE      ZERO,SAV06
          MOVE      ZERO,SAV07
          MOVE      ZERO,SAV08
          MOVE      ZERO,SAV09
          MOVE      ZERO,SAV10
          MOVE      ZERO,SAV11
          MOVE      ZERO,SAV12
          MOVE      ZERO,SAV13
          RETURN
.**********************************************************************
. Move Save Stats to File
.**********************************************************************
MSTF0000  MOVE      SP70,FMSTCUSP
          MOVE      SAV01,FMSTCA01
          MOVE      SAV02,FMSTCA02
          MOVE      SAV03,FMSTCA03
          MOVE      SAV04,FMSTCA04
          MOVE      SAV05,FMSTCA05
          MOVE      SAV06,FMSTCA06
          MOVE      SAV07,FMSTCA07
          MOVE      SAV08,FMSTCA08
          MOVE      SAV09,FMSTCA09
          MOVE      SAV10,FMSTCA10
          MOVE      SAV11,FMSTCA11
          MOVE      SAV12,FMSTCA12
          MOVE      SAV13,FMSTCA13
          RETURN
.**********************************************************************
. Move Zero to sav variables for calculation
.**********************************************************************
MZTS0000  
          MOVE      ZERO,SAVA01
          MOVE      ZERO,SAVA02
          MOVE      ZERO,SAVA03
          MOVE      ZERO,SAVA04
          MOVE      ZERO,SAVA05
          MOVE      ZERO,SAVA06
          MOVE      ZERO,SAVA07
          MOVE      ZERO,SAVA08
          MOVE      ZERO,SAVA09
          MOVE      ZERO,SAVA10
          MOVE      ZERO,SAVA11
          MOVE      ZERO,SAVA12
          MOVE      ZERO,SAVA13
.
          MOVE      ZERO,SAVA01D
          MOVE      ZERO,SAVA02D
          MOVE      ZERO,SAVA03D
          MOVE      ZERO,SAVA04D
          MOVE      ZERO,SAVA05D
          MOVE      ZERO,SAVA06D
          MOVE      ZERO,SAVA07D
          MOVE      ZERO,SAVA08D
          MOVE      ZERO,SAVA09D
          MOVE      ZERO,SAVA10D
          MOVE      ZERO,SAVA11D
          MOVE      ZERO,SAVA12D
          MOVE      ZERO,SAVA13D
.
          MOVE      ZERO,SAVA01T
          MOVE      ZERO,SAVA02T
          MOVE      ZERO,SAVA03T
          MOVE      ZERO,SAVA04T
          MOVE      ZERO,SAVA05T
          MOVE      ZERO,SAVA06T
          MOVE      ZERO,SAVA07T
          MOVE      ZERO,SAVA08T
          MOVE      ZERO,SAVA09T
          MOVE      ZERO,SAVA10T
          MOVE      ZERO,SAVA11T
          MOVE      ZERO,SAVA12T
          MOVE      ZERO,SAVA13T
.
          RETURN
.
.**********************************************************************
. Move Save Totals to File Totals for Update
.**********************************************************************
MSTA0000 
          MOVE      SAVA01,FMBUCA01
          MOVE      SAVA02,FMBUCA02
          MOVE      SAVA03,FMBUCA03
          MOVE      SAVA04,FMBUCA04
          MOVE      SAVA05,FMBUCA05
          MOVE      SAVA06,FMBUCA06
          MOVE      SAVA07,FMBUCA07
          MOVE      SAVA08,FMBUCA08
          MOVE      SAVA09,FMBUCA09
          MOVE      SAVA10,FMBUCA10
          MOVE      SAVA11,FMBUCA11
          MOVE      SAVA12,FMBUCA12
          MOVE      SAVA13,FMBUCA13
.
          MOVE      SAVA01D,FMBUCB01
          MOVE      SAVA02D,FMBUCB02
          MOVE      SAVA03D,FMBUCB03
          MOVE      SAVA04D,FMBUCB04
          MOVE      SAVA05D,FMBUCB05
          MOVE      SAVA06D,FMBUCB06
          MOVE      SAVA07D,FMBUCB07
          MOVE      SAVA08D,FMBUCB08
          MOVE      SAVA09D,FMBUCB09
          MOVE      SAVA10D,FMBUCB10
          MOVE      SAVA11D,FMBUCB11
          MOVE      SAVA12D,FMBUCB12
          MOVE      SAVA13D,FMBUCB13
.
          MOVE      SAVA01T,FMBUCC01
          MOVE      SAVA02T,FMBUCC02
          MOVE      SAVA03T,FMBUCC03
          MOVE      SAVA04T,FMBUCC04
          MOVE      SAVA05T,FMBUCC05
          MOVE      SAVA06T,FMBUCC06
          MOVE      SAVA07T,FMBUCC07
          MOVE      SAVA08T,FMBUCC08
          MOVE      SAVA09T,FMBUCC09
          MOVE      SAVA10T,FMBUCC10
          MOVE      SAVA11T,FMBUCC11
          MOVE      SAVA12T,FMBUCC12
          MOVE      SAVA13T,FMBUCC13
          RETURN
.**********************************************************************
. Add Totals to Save Totals for Update
.**********************************************************************
ADDF0000  
          ADD       FMBUCA01,SAVA01
          ADD       FMBUCA02,SAVA02
          ADD       FMBUCA03,SAVA03
          ADD       FMBUCA04,SAVA04
          ADD       FMBUCA05,SAVA05
          ADD       FMBUCA06,SAVA06
          ADD       FMBUCA07,SAVA07
          ADD       FMBUCA08,SAVA08
          ADD       FMBUCA09,SAVA09
          ADD       FMBUCA10,SAVA10
          ADD       FMBUCA11,SAVA11
          ADD       FMBUCA12,SAVA12
          ADD       FMBUCA13,SAVA13
.
          MOVE      FMAMTYPE,F2
          BRANCH    F2,ADDF0500,ADDF0500,ADDF0500,ADDF0500,ADDF0500
          GOTO      ADDF1000
.
. Move Dollar & Cents fields to dollar and thousand 
.
ADDF0500  MOVE      FMBUCA01,FMBUCB01
          MOVE      FMBUCA02,FMBUCB02
          MOVE      FMBUCA03,FMBUCB03
          MOVE      FMBUCA04,FMBUCB04
          MOVE      FMBUCA05,FMBUCB05
          MOVE      FMBUCA06,FMBUCB06
          MOVE      FMBUCA07,FMBUCB07
          MOVE      FMBUCA08,FMBUCB08
          MOVE      FMBUCA09,FMBUCB09
          MOVE      FMBUCA10,FMBUCB10
          MOVE      FMBUCA11,FMBUCB11
          MOVE      FMBUCA12,FMBUCB12
          MOVE      FMBUCA13,FMBUCB13
.
          CALL      UPFMBU1
.
ADDF1000  
          ADD       FMBUCB01,SAVA01D
          ADD       FMBUCB02,SAVA02D
          ADD       FMBUCB03,SAVA03D
          ADD       FMBUCB04,SAVA04D
          ADD       FMBUCB05,SAVA05D
          ADD       FMBUCB06,SAVA06D
          ADD       FMBUCB07,SAVA07D
          ADD       FMBUCB08,SAVA08D
          ADD       FMBUCB09,SAVA09D
          ADD       FMBUCB10,SAVA10D
          ADD       FMBUCB11,SAVA11D
          ADD       FMBUCB12,SAVA12D
          ADD       FMBUCB13,SAVA13D
.
          ADD       FMBUCC01,SAVA01T
          ADD       FMBUCC02,SAVA02T
          ADD       FMBUCC03,SAVA03T
          ADD       FMBUCC04,SAVA04T
          ADD       FMBUCC05,SAVA05T
          ADD       FMBUCC06,SAVA06T
          ADD       FMBUCC07,SAVA07T
          ADD       FMBUCC08,SAVA08T
          ADD       FMBUCC09,SAVA09T
          ADD       FMBUCC10,SAVA10T
          ADD       FMBUCC11,SAVA11T
          ADD       FMBUCC12,SAVA12T
          ADD       FMBUCC13,SAVA13T
.
          RETURN
.**********************************************************************
.  UBUD - Calc for budget links                        Called By ML
.**********************************************************************
UBUD0000  MOVE      "~~",KEY2
          PACK      SKEY20,KEY2,BUDTYPE,SP70
.
UBUD1000  PACK      KEY20,SKEY20,SP70
          CALL      RSFMTU1
          CALL      RKFMTU1
          BRANCH    OVRCD,UBUD9999
          MATCH     "~~",FMTUPORT
          GOTO      UBUD9999 IF NOT EQUAL
          MATCH     BUDTYPE,FMTUSPEC
          GOTO      UBUD9999 IF NOT EQUAL
.
          PACK      SKEY20,FMTUPORT,FMTUSPEC,FMTUTLED,FMTUTACC,SP70
          PACK      KEY20,SKEY20,SP70
          CALL      DEFMTU1
.
          PACK      LEDGER,FMTUTLED,SP70
          PACK      ACCOUNT,FMTUTACC,SP70
          MOVE      ZERO,COUNT
          CALL      TOTL0000           * calc totals
          GOTO      UBUD1000
.
UBUD9999  RETURN
.******************************************************************************
.* INCLUDES                                                                   *
.******************************************************************************
.
          INC       FMSTUPIO/INC
          INC       IBAOVRIO/INC
FMSBB999  ENDPROC

.-------------------------------------------------------------------------------
.   System    :   FMS Financial System  
.                           
.   Program   :   FMSSTRFM 
.                            
.   Routines  :   KSTRFM00 Keyin Batch   - Returns a valid record
.                 ASTRFM00 Accept Batch  - Returns a key NOT on file
.   
.   Return    :   EXIT = 1 null entry EXIT = 2 EXITCHAR entered
.
.   Internal  :   HFMSRA00 Help Display for Batch  
.                            
.   Redisplay :   RSTRFM00 Screen Redisplay Called for Batch  
.-------------------------------------------------------------------------------
.   Mods      :    
.-------------------------------------------------------------------------------
. Normal Code Keyin - Code Must Exist Exit = 1 if Null Entry
.-------------------------------------------------------------------------------
KSTRFM00  MOVE      UNDLN70,FMSRBAT
          KEYIN     *PCCOL:CVERT,*EL,*DV,FMSRBAT:
                    *PCCOL:CVERT,*V2LON,*JR,*ZF,FMSRBAT: 
                    *PCCOL:CVERT,*EL,*DV,FMSRBAT
.
          ENDSET    FMSRBAT
          APPEND    SP70,FMSRBAT
          RESET     FMSRBAT
          MATCH     SP70,FMSRBAT             * System Code Spaces so exit set
          GOTO      KSTRFM90 IF EQUAL
          MATCH     "0000000000",FMSRBAT     * System Code Spaces so exit set
          GOTO      KSTRFM90 IF EQUAL
.
          UNPACK    FMSRBAT,ANS,ANS,ANS,ANS,ANS  * get last character
          CMATCH    EXITCHAR,ANS             * Exit Selected
          GOTO      KSTRFM95 IF EQUAL
.
          CMATCH    QUEST,ANS                * Help Required  
          GOTO      KSTRFM10 IF NOT EQUAL
          CALL      HFMSRA00                 * Display List Of FMSRBATs
          PACK      CDATASAV,FMSRBAT,SP70    * save data entered
          CALL      RSTRFM00                 * Redisplay Routine
          PACK      FMSRBAT,CDATASAV,SP70    * restore data entered
.
          ENDSET    FMSRBAT
          APPEND    SP70,FMSRBAT
          RESET     FMSRBAT
          MATCH     SP70,FMSRBAT             * System Code Spaces so exit set
          GOTO      KSTRFM00 IF EQUAL
.
KSTRFM10  PACK      KEY8,FMSRBAT,SP70
          CALL      RSFMSR1                                   
          CALL      RKFMSR1                                   
          BRANCH    OVRCD,KSTRFM80
          MATCH     KEY8,FMSRBAT
          GOTO      KSTRFM80 IF NOT EQUAL
          MOVE      ZERO,EXIT                 * no entry so exit is set
          GOTO      KSTRFM99
.
KSTRFM80  DISPLAY   *P1:24,*EL,*B,"Batch Does Not Exist - ";
          CALL      HITENTER
          GOTO      KSTRFM00
.
KSTRFM90  MOVE      ONE,EXIT                  * null entry so exit is set
          GOTO      KSTRFM99
.
KSTRFM95  MOVE      TWO,EXIT                  * Exit character entered    
.
KSTRFM99  RETURN
.-------------------------------------------------------------------------------
. Accept Code Keyin - Code Must Not Exist 
.-------------------------------------------------------------------------------
ASTRFM00  MOVE      UNDLN70,FMSRBAT
          KEYIN     *PCCOL:CVERT,*EL,*DV,FMSRBAT:
                    *PCCOL:CVERT,*V2LON,*JR,*ZF,FMSRBAT: 
                    *PCCOL:CVERT,*V2LON,*DV,FMSRBAT
.
          ENDSET    FMSRBAT
          APPEND    SP70,FMSRBAT
          RESET     FMSRBAT
          MATCH     SP70,FMSRBAT             * System Code Spaces so exit set
          GOTO      ASTRFM90 IF EQUAL
          MATCH     "0000000000",FMSRBAT     * System Code Spaces so exit set
          GOTO      ASTRFM90 IF EQUAL
.
          UNPACK    FMSRBAT,ANS,ANS,ANS,ANS,ANS  * get last character
          CMATCH    EXITCHAR,ANS             * Exit Selected
          GOTO      ASTRFM95 IF EQUAL
.
          CMATCH    QUEST,ANS                * Help Required  
          GOTO      ASTRFM10 IF NOT EQUAL
          CALL      HFMSRA00                  * Display List Of FMSRBATs
          CALL      RSTRFM00                  * Redisplay Routine
.
          ENDSET    FMSRBAT
          APPEND    SP70,FMSRBAT
          RESET     FMSRBAT
          MATCH     SP70,FMSRBAT             * System Code Spaces so exit set
          GOTO      ASTRFM00 IF EQUAL
.
ASTRFM10  MOVE      ZERO,EXIT
          PACK      KEY8,FMSRBAT,SP70
          CALL      RSFMSR1                                   
          CALL      RKFMSR1                                   
          BRANCH    OVRCD,KSTRFM99
          MATCH     KEY8,FMSRBAT
          GOTO      KSTRFM99 IF NOT EQUAL
.
          DISPLAY   *P1:24,*EL,*B,"Batch Already Exists - ";
          CALL      HITENTER
          GOTO      ASTRFM00
.
ASTRFM90  MOVE      ONE,EXIT                  * null entry so exit is set
          GOTO      ASTRFM99
.
ASTRFM95  MOVE      TWO,EXIT                  * Exit character entered    
.
ASTRFM99  RETURN
.------------------------------------------------------------------------------
. Display List of All Codes
.------------------------------------------------------------------------------
HFMSRA00
          MOVE      ZERO,CSCRSIZ
          IF        HTOP<3
            MOVE      "12",HTOP
            MOVE      "24",HBOT
            MOVE      "50",HLEF
            MOVE      "80",HRIG
          ENDIF
HFMSRA04
          CALL      GSCRN000
          BRANCH    EXIT,HFMSRA99
          MOVE      STDCOL00,STDCOL01
          ADD       " 5",STDCOL01
          DISPLAY   *PSTDCOL01:STDROW,*V2LON,*ULON,"Batch"             
.
          MOVE      STDCOL01,STDCOL02
          ADD       " 7",STDCOL02
          DISPLAY   *PSTDCOL02:STDROW,*V2LON,*ULON,"   Date"
.
          MOVE      STDCOL02,STDCOL03
          ADD       "36",STDCOL03
HFMSRA08
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          MOVE      SP70,FMSRBAT,FMSRUNIQ
          PACK      KEY8,FMSRBAT,FMSRUNIQ,SP70
          PACK      KEY5,FMSRBAT
.                                                                               
.                                                                               
          CALL      RSFMSR1 
HFMSRA10
          CALL      RKFMSR1 
          BRANCH    OVRCD,HFMSRA15
          MATCH     KEY5,FMSRBAT
          GOTO      HFMSRA10 IF EQUAL
          PACK      KEY5,FMSRBAT,SP70
          PACK      KEY8,FMSRBAT,FMSRUNIQ,SP70
.                                                                               
.                                                                               
          BRANCH    CSEARCH,HFMSRA12
          CALL      HFMSRA60
          BRANCH    OVRCD,HFMSRA10
HFMSRA12
          ADD       ONE,XITEMNO
          ADD       ONE,STDROW
          STORE     KEY8,XITEMNO,ST1,ST2,ST3,ST4,ST5:                            
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          DISPLAY   *PSTDCOL00:STDROW,SP1,*V2LON,XITEMNO,DOT
          DISPLAY   *PSTDCOL01:STDROW,FMSRBAT
          UNPACK    FMSRDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          DISPLAY   *PSTDCOL02:STDROW,CPCDATE
          COMPARE   MAXITEM,XITEMNO
          GOTO      HFMSRA10 IF NOT EQUAL
HFMSRA15
.                                                                               
          MOVE      ONE,DITEM
          MOVE      MINITEM,DROW
          ADD       ONE,DROW
          DISPLAY   *PSTDCOL00:DROW,*V2LON,*HON,SP1,DITEM,DOT
          CLIP
          FLUSH     HLEF,HTOP,HRIG,HBOT
.
HFMSRA20
          CALL      HSCRI000
          BRANCH    EXIT,HFMSRA30,HFMSRA35,HFMSRA40,HFMSRA45,HFMSRA04:
                              HFMSRA91,HFMSRA50
          GOTO      HFMSRA92
HFMSRA30
          CALL      RKFMSR1 
          BRANCH    OVRCD,HFMSRA85
          PACK      KEY8,FMSRBAT,FMSRUNIQ,SP70                                          
.                                                                               
.                                                                               
          CALL      RPFMSR1 
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMSRA10
HFMSRA35
          MOVE      ST1,KEY8 
          CALL      RDFMSR1 
          CALL      RPFMSR1 
          BRANCH    OVRCD,HFMSRA85
          PACK      KEY8,FMSRBAT,FMSRUNIQ,SP70                                          
.                                                                               
.                                                                               
.                                                                               
.                                                                               
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
HFMSRA36
          CALL      RPFMSR1 
          BRANCH    OVRCD,HFMSRA37
          PACK      KEY8,FMSRBAT,FMSRUNIQ,SP70                                          
.                                                                               
.                                                                               
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HFMSRA36 IF NOT EQUAL
HFMSRA37
          MOVE      ZERO,XITEMNO
          GOTO      HFMSRA10
HFMSRA40
          MOVE      ST1,KEY8 
          CALL      RDFMSR1 
          CALL      RPFMSR1 
          BRANCH    OVRCD,HFMSRA85
          PACK      KEY8,FMSRBAT,FMSRUNIQ,SP70                                          
.                                                                               
.                                                                               
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMSRA08
HFMSRA45
          CALL      RKFMSR1 
          BRANCH    OVRCD,HFMSRA85
          PACK      KEY8,FMSRBAT,FMSRUNIQ,SP70                                          
.                                                                               
.                                                                               
          SUSPEND
          CLIP      1,1,CRIG,24
.
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      ZERO,XITEMNO
          PACK      KEY8,Z70                                                    
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
          CALL      RSFMSR1 
HFMSRA46
          CALL      RPFMSR1 
          BRANCH    OVRCD,HFMSRA47
          PACK      KEY8,FMSRBAT,FMSRUNIQ,SP70                                          
.                                                                               
.                                                                               
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HFMSRA46 IF NOT EQUAL
HFMSRA47
          MOVE      ZERO,XITEMNO
          GOTO      HFMSRA10
HFMSRA50  COMPARE   ZERO,CSEARCH
          GOTO      HFMSRA55 IF EQUAL
          MOVE      ZERO,CSEARCH
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          ADD       ONE,STDROW
          UNPACK    SP70,SCHFLD01,SCHFLD02,SCHFLD03,SCHFLD04,SCHFLD05
          UNPACK    SP70,SCHFLD06,SCHFLD07,SCHFLD08,SCHFLD09,SCHFLD10
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          DISPLAY   *PSTDCOL00:STDROW,*V2LON,*HON,"Sch"
          KEYIN     *PSTDCOL01:STDROW,*V2LON,SCHFLD01
          RESET     SCHFLD01
.         KEYIN     *PSTDCOL02:STDROW,*V2LON,SCHFLD02
          RESET     SCHFLD02
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMSRA08
HFMSRA55  MOVE      ONE,CSEARCH
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMSRA08
HFMSRA60  MOVE      ZERO,OVRCD
          MATCH     SP70,SCHFLD01
          GOTO      HFMSRA61 IF EQUAL
          MATCH     SCHFLD01,FMSRBAT
          GOTO      HFMSRA72 IF NOT EQUAL
HFMSRA61
          MATCH     SP70,SCHFLD02
          GOTO      HFMSRA62 IF EQUAL
          MATCH     SCHFLD02,FMSRDATE
          GOTO      HFMSRA72 IF NOT EQUAL
HFMSRA62
HFMSRA63
HFMSRA64
HFMSRA65
HFMSRA66
HFMSRA67
HFMSRA68
HFMSRA69
HFMSRA70
          GOTO      HFMSRA75
HFMSRA72  MOVE      ONE,OVRCD
HFMSRA75  RETURN
HFMSRA85
          LOAD      KEY8,XITEMNO,ST1,ST2,ST3,ST4,ST5:                            
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY8,FMSRBAT,FMSRUNIQ
          CALL      RDFMSR1 
HFMSRA90
.                                                                               
          BEEP
          GOTO      HFMSRA20
HFMSRA91
          MOVE      SP70,FMSRLEDG
          MOVE      SP70,FMSRACCT
          MOVE      ZERO,FMSRDATE
          MOVE      SP70,FMSRREF
          MOVE      ZERO,FMSRUNIT
          MOVE      SP70,FMSRSPAR
          MOVE      SP70,KEY8 
          MOVE      SP70,FMSRBAT
          MOVE      SP70,FMSRUNIQ
          GOTO      HFMSRA96
HFMSRA92
          MOVE      SP70,KEY8 
          MOVE      SP70,FMSRBAT
          MOVE      SP70,FMSRUNIQ
          LOAD      KEY8,CCITEM,ST1,ST2,ST3,ST4,ST5:                            
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY8,FMSRBAT,FMSRUNIQ
HFMSRA96
          PUTSCR    CSSCRNUM,HLEF,HTOP,HRIG,HBOT
          CALL      FRESCR00
          MOVE      ZERO,HTOP
          MOVE      ZERO,HLEF
          MOVE      ZERO,HBOT
          MOVE      ZERO,HRIG
HFMSRA99
          RETURN
.

.******************************************************************************
.* System    :   Accounting System                                            *
.* Include   :   FMSENQ00    (include for IBAFMS21 & 22)                      *
.* Requires  :   PROGNO      (Program No. 2=IBAFMS21, 3=IBAFMS22)             *
.* Desc      :   Cash and Accrual Accounting Enquiries                        *
.******************************************************************************
.* Date      :   17.10.90                                                     *
.* Author    :   Neeriem Dye (IBA)                                            *
.* Mods      :                                                                *
.*                                                                            *
.* V9.02.01 26/03/2003  Mike Laming  CAR 37206                                *
.*          Change Variance & Percentage Variance fields to Display correctly *
.*          when FMCOBVAR = 1 - was altering calculations. Add calculation    *
.*          variables CALCVAR and CALCPVA for CALP0000                        *
.*                                                                            *
.* VF.00.01 23.11.1999  Charles Handaya                                       *
.*          Show cents for Print option                                       *
.*          srf 633977                                                        *
.*                                                                            *
.* V6.00.46 15.06.92 S.Barcham                                                *
.*          Display & print payment period description                        *
.*          srf 115085                                                        *
.*                                                                            *
.* V6.00.49 13.10.92 Neeriem Dye                                              *
.*          Make enquiry parameters ledger based                              *
.*          srf 114492                                                        *
.*                                                                            *
.* V6.00.54 21.10.93 Neeriem Dye                                              *
.*          Modified for new committed expenditure field                      *
.*          srf HWK                                                           *
.*                                                                            *
.* V6.00.55 24.08.94 Sandra Barcham                                           *
.*          Remove NORESET on TRAP as interpreter bug                         *
.*          srf 131526                                                        *
.*                                                                            *
.* V6.00.65 08.11.94 Robert Sumsion                                           *
.*          Added Committed Raised and Received.                              *
.*          srf 125513                                                        *
.*                                                                            *
.* V6.00.66 14.06.96 Sandra Barcham                                           *
.*          Change curpage and pageno from form 3 to form 4                   *
.*          srf 615648                                                        *
.*                                                                            *
.* V6.00.67 09.10.96 Sandra Barcham                                           *
.*          Remove use of credmsta use apsmasaf                               *
.*          srf 617329                                                        *
.*                                                                            *
.******************************************************************************
.
.==============================================================================
.FILE DESCRIPTION INCLUDES
.-------------------------
          INC       APSPPDFD/INC
          INC       APSMASFD/INC
          INC       APSCIOFD/INC       * committed expenditure
          INC       APSORDFD/INC       * committed expenditure
          INC       APSCEAFD/INC       * committed expenditure
          INC       APSCEBFD/INC       * committed expenditure
          INC       FMSAMAFD/INC       * account
          INC       FMSBNKFD/INC       * bank rec
          INC       FMSBTYFD/INC       * budget data
          INC       FMSBUDFD/INC       * budget data
          INC       FMSCHQFD/INC       * cheque
          INC       FMSCONFD/INC       * controlf
          INC       FMSCSAFD/INC
          INC       FMSDSFFD/INC       * dissection accrual summary file
          INC       FMSFPSFD/INC       * period summary file
          INC       FMSLMAFD/INC       * ledger
          INC       FMSLMCFD/INC       * ledger financial calendar
          INC       FMSSQUFD/INC       * enquiry security
          INC       FMSSBUFD/INC       * stat budget
          INC       FMSSMAFD/INC       * stat summary
          INC       FMSTRNFD/INC       * transaction
          INC       FMSUWPFD/INC       * wp file
          INC       FMSCODFD/INC       * codes file
          INC       FMSLMBFD/INC       * report
          INC       FMSONCFD/INC       * oncost code
          INC       FMSPRCFD/INC       * print code
          INC       FMSLEVFD/INC       * level code
          INC       FMSSTRFD/INC       * stats transactions
          INC       FMSTCFFD/INC       * total calc
          INC       FMSDISFD/INC       * dissection
          INC       FMSRESFD/INC       * responsibility
          INC       FMSRSFFD/INC       * report seq file
          INC       FMSCTRFD/INC       * cash transactions
          INC       FMSCCAFD/INC       * cost centre
          INC       FMSSBAFD/INC       * subjective
.
.==============================================================================
.LOCAL VARIABLE DEFINITION
.-------------------------
.
.
FMSTMP01  FILE      ASCII,FIXED=70     * WP Holding File Def'n 1
FILENAM1  DIM       8
NAME1     INIT      "fmstm1"
.
FMSTMP02  FILE      ASCII,FIXED=70     * WP Holding File Def'n 2
FILENAM2  DIM       8
NAME2     INIT      "fmstm2"
.
CP        INIT      "cp "              * word processor variables
TXT       INIT      ".txt "
.WP        INIT      "wp "
.WPDAT     INIT      ".txt 999 7 -1 70 14"
WPSTAT    FORM      2
.
FMSA      INIT      "fmsa"             * stat transaction file prefix
FMSB      INIT      "fmsb"             * budget file prefix
FMSC      INIT      "fmsc"             * stat budget file prefix
FMSD      INIT      "fmsd"             * dissection file prefix
FMSP      INIT      "fmsp"             * period file prefix
FMSS      INIT      "fmss"             * stat summary file prefix
FMST      INIT      "fmst"             * transaction file prefix
FMSR      INIT      "fmsr"             * cash transaction file prefix
FMSZ      INIT      "fmsz"             * cash transaction file prefix
.
ABPDESC   INIT      "                 "
ABPDESC0  INIT      "Dollars Only"
ABPDESC1  INIT      "Dollars and Cents"
APEBOVER  FORM      1
APODOVER  FORM      1
APEBSKEY  DIM       25
APODSKEY  DIM       25  * Not Include Receival number
.
RDAPEB    FORM      1
.
MAXITEMA  FORM      "19"               * maximum no. of items on screen A + 1
MAXITEMD  FORM      "14"               * maximum no. of items on screen D + 1
MAXITEME  FORM      "14"               * maximum no. of items on screen E + 1
MAXITEMH  FORM      "15"               * maximum no. of items on screen H + 1
MAXITEMI  FORM      "15"               * maximum no. of items on screen I + 1
MAXITEMP  FORM      "16"               * maximum no. of items on screen P + 1
MAXITEMY  FORM      "14"               * maximum no. of items on screen Y + 1
MAXITEMZ  FORM      "14"               * maximum no. of items on screen Z + 1
.
ADDT      INIT      "        "
ADDT0     INIT      "Add     "
ADDT1     INIT      "Subtract"
ADDT2     INIT      "Divide  "
ADDT3     INIT      "Multiply"
.
ACCEPT    FORM      1                  * accept mode (1=on)
ACTFILE   INIT      "        "         * current period file
ACTUAL    FORM     12.6                * store vars for actual period data
ACTUAL01  FORM     12.6  
ACTUAL02  FORM     12.6  
ACTUAL03  FORM     12.6  
ACTUAL04  FORM     12.6  
ACTUAL05  FORM     12.6  
ACTUAL06  FORM     12.6  
ACTUAL07  FORM     12.6  
ACTUAL08  FORM     12.6  
ACTUAL09  FORM     12.6  
ACTUAL10  FORM     12.6  
ACTUAL11  FORM     12.6  
ACTUAL12  FORM     12.6  
ACTUAL13  FORM     12.6  
ATYPE     FORM      2                  * account type
BRFWD     FORM     12.2                * brought forward
BUDFILE   INIT      "        "         * current budget file
BUDGET    FORM     12.6                * store vars for BUDGET period data
BUDGET01  FORM     12.6  
BUDGET02  FORM     12.6  
BUDGET03  FORM     12.6  
BUDGET04  FORM     12.6  
BUDGET05  FORM     12.6  
BUDGET06  FORM     12.6  
BUDGET07  FORM     12.6  
BUDGET08  FORM     12.6  
BUDGET09  FORM     12.6  
BUDGET10  FORM     12.6  
BUDGET11  FORM     12.6  
BUDGET12  FORM     12.6  
BUDGET13  FORM     12.6  
APCBSKEY  DIM      28
CALCPVA   FORM      5                                                  *I-f0901
CALCVAR   FORM     12.6                                                *I-f0901
COMMIT    FORM     12                  * committed expenditure
COMDESC   DIM      26
COMRAISD  FORM     12                  * committed expenditure
COMRECVD  FORM     12                  * committed expenditure
COMRASP2  FORM     12.2                * committed expenditure
COMRECP2  FORM     12.2                * committed expenditure
COMMITP2  FORM     12.2                * committed expenditure form 12.2
CREDIT    FORM     12.2                * credit amount
CURRDISP  DIM       5                  * current item for display (DATK & DATL)
CURPAGE   FORM      4                  * current page number
DEBCRED   FORM      1                  * 1=debit, 2=credit
DEBIT     FORM     12.2                * debit amount
DISPERR   FORM      1
DISFILE   INIT      "        "         * current dissection file
END       DIM       8                  * end date (for screen Z)
FILENAM   INIT      "        "         * filename
FORMAT    FORM      1                  * normal account format
FORMFLAG  FORM      1                  * to format or not to format !!
ITEMNUM   FORM      2                  * item number
LACTFILE  INIT      "        "         * current last year period file
LBUDFILE  INIT      "        "         * current last year budget file
LASACT    FORM     12.6                * last period totals
LASBUD    FORM     12.6  
LASPVA    FORM      5 
LASVAR    FORM     12.6  
LOMRAS    FORM     12.6  
LOMREC    FORM     12.6  
LMORE     FORM      1                  * pervious data (1=yes)
MORE      FORM      1                  * more data (1=yes)
OPTIONA   FORM      2                  * screen A selection keyin var
OPTIONB   FORM      2                  * screen B selection
OPTIONC   FORM      2                  * screen C selection
OPTIOND   FORM      2                  * screen D selection
OPTIONY   FORM      2                  * screen Y selection
OPTIONZ   FORM      2                  * screen Z selection
PAGENO    FORM      4                  * current page number
PERVAR    FORM      5                  * store vars for PERVAR period data
PERVAR01  FORM      5 
PERVAR02  FORM      5 
PERVAR03  FORM      5 
PERVAR04  FORM      5 
PERVAR05  FORM      5 
PERVAR06  FORM      5 
PERVAR07  FORM      5 
PERVAR08  FORM      5 
PERVAR09  FORM      5 
PERVAR10  FORM      5 
PERVAR11  FORM      5 
PERVAR12  FORM      5 
PERVAR13  FORM      5 
PERIODNO  FORM      2                  * current period number
PROACT    FORM     12.6                * projected totals
PROBUD    FORM     12.6  
PROPVA    FORM      5 
PROVAR    FORM     12.6  
PROHEAD1  DIM       20                 * Projection heading 1
PROHEAD2  DIM       20                 * Projection heading 2
REPNO     FORM      2                  * report number
SAVITEM   FORM      2                  * item number for Screen A
SAVTYPE   DIM       1                  * save for account type
SSAVTYPE  DIM       1                  * save for account type
SCRNO     FORM      1                  * screen number being executed
SKEY      DIM       35                 * key save for Screen A
SKEY14    DIM       14                 * key save for Screen A
SKEY1     DIM       35                 * key save for parameter
SRTDATZ   DIM       8                  * date search (for screen Z)
START     DIM       8                  * start date (for screen Z)
TEMPAMT   FORM     12.2                * Temporary Amount
TOTALACT  FORM     12.6                * total var for actual period data
TOTALBUD  FORM     12.6                * total var for budget period data
TOTALVAR  FORM     12.6                * total var for variance period data
TOTALPVA  FORM      5                  * total var for % variance data
TRANFILE  INIT      "        "         * current transaction file
TRANTYPE  DIM       12                 * transaction description
TWELVE    FORM     "12.00"
THIRTEEN  FORM     "13.00"
VARIAN    FORM     12.6                * store vars for VARIAN period data
VARIAN01  FORM     12.6  
VARIAN02  FORM     12.6  
VARIAN03  FORM     12.6  
VARIAN04  FORM     12.6  
VARIAN05  FORM     12.6  
VARIAN06  FORM     12.6  
VARIAN07  FORM     12.6  
VARIAN08  FORM     12.6  
VARIAN09  FORM     12.6  
VARIAN10  FORM     12.6  
VARIAN11  FORM     12.6  
VARIAN12  FORM     12.6  
VARIAN13  FORM     12.6  
XACTUAL   FORM     12.6                * store vars for ACTUAL period data
XBUDGET   FORM     12.6                * store vars for BUDGET period data
XPERVAR   FORM      5                  * store vars for PERVAR period data
XVARIAN   FORM     12.6                * store vars for VARIAN period data
YTDACT    FORM     12.6                * ytd totals
YTDBUD    FORM     12.6
YTDVAR    FORM     12.6
YTDPVA    FORM      5 
.
FORMATP0  INIT      "(999,999,999,999 "     * format variables
FORMATP1  INIT      "(9,999,999,999.9 "
FORMATP2  INIT      " (999,999,999.99 "
FORMATP3  INIT      "(999,999,999.999 "
FORMATP4  INIT      "(99,999,999.9999 "
FORMATP5  INIT      "(9,999,999.99999 "
FORMATP6  INIT      " (999,999.999999 "
.
ZORMATP0  INIT      "99999999999999999"     * format variables
ZORMATP1  INIT      "999999999999999.9"
ZORMATP2  INIT      "99999999999999.99"
ZORMATP3  INIT      "9999999999999.999"
ZORMATP4  INIT      "999999999999.9999"
ZORMATP5  INIT      "99999999999.99999"
ZORMATP6  INIT      "9999999999.999999"
.
FORMDAT2  INIT      "(999,999,999.99 "
ZORMDAT2  INIT      "9999999999999.99"
.
F17       FORM      17
F15P1     FORM      15.1
F14P2     FORM      14.2
F13P3     FORM      13.3
....F12P4     FORM      12.4
F11P5     FORM      11.5
F10P6     FORM      10.6
.
FA12      FORM      12
.
TYTDACT   FORM     11.6
TACTUAL   FORM     11.6
TBUDGET   FORM     11.6
TCOMMIT   FORM     12.2
TAMTRAS   FORM     12.2
TAMTREC   FORM     12.2
TCREDIT   FORM     12.2
TDEBIT    FORM     12.2
.
DTDACT    DIM       11
DTDACT2   DIM       16
DTDACT3   DIM       17
DTDBUD    DIM       11
DTDBUD3   DIM       17
DTDVAR    DIM       11
DTDVAR3   DIM       17
DASACT    DIM       12
DASACT3   DIM       17
DASBUD    DIM       12
DASBUD3   DIM       17
DASVAR    DIM       12
DASVAR3   DIM       17
DOMRAS    DIM       12
DOMREC    DIM       12
DROACT    DIM       12
DROACT3   DIM       17
DROBUD    DIM       12
DROBUD3   DIM       17
DROVAR    DIM       12
DROVAR3   DIM       17
DOMMIT    DIM       12
DOMMITP2  DIM       15
DOMRAISD  DIM       12                 * committed expenditure
DOMRECVD  DIM       12                 * committed expenditure
DOMRASP2  DIM       15                 * committed expenditure
DOMRECP2  DIM       15                 * committed expenditure
DCURASP2  DIM       15                 * committed expenditure
DCURECP2  DIM       15                 * committed expenditure
DPROPVA   DIM       5
DDEBIT    DIM       15
DCREDIT   DIM       15
DOTALACT  DIM       16
DOTALBUD  DIM       16
DOTALVAR  DIM       16
DCTUAL    DIM       12
DCTUAL3   DIM       17
DCTUAL01  DIM       16
DCTUAL02  DIM       16
DCTUAL03  DIM       16
DCTUAL04  DIM       16
DCTUAL05  DIM       16
DCTUAL06  DIM       16
DCTUAL07  DIM       16
DCTUAL08  DIM       16
DCTUAL09  DIM       16
DCTUAL10  DIM       16
DCTUAL11  DIM       16
DCTUAL12  DIM       16
DCTUAL13  DIM       16
DUDGET    DIM       12
DUDGET3   DIM       17
DUDGET01  DIM       16
DUDGET02  DIM       16
DUDGET03  DIM       16
DUDGET04  DIM       16
DUDGET05  DIM       16
DUDGET06  DIM       16
DUDGET07  DIM       16
DUDGET08  DIM       16
DUDGET09  DIM       16
DUDGET10  DIM       16
DUDGET11  DIM       16
DUDGET12  DIM       16
DUDGET13  DIM       16
DARIAN    DIM       12
DARIAN3   DIM       17
DARIAN01  DIM       16
DARIAN02  DIM       16
DARIAN03  DIM       16
DARIAN04  DIM       16
DARIAN05  DIM       16
DARIAN06  DIM       16
DARIAN07  DIM       16
DARIAN08  DIM       16
DARIAN09  DIM       16
DARIAN10  DIM       16
DARIAN11  DIM       16
DARIAN12  DIM       16
DARIAN13  DIM       16
XIM2      DIM       2
XIM4      DIM       4                  * general dim 4
XIM8      DIM       8 
XIM31     DIM       31
.
XIM11     DIM       11
XIM12     DIM       12
XIM13     DIM       13
XIM14     DIM       14
XIM15     DIM       15
XIM16     DIM       16
XIM17     DIM       17
XIM18     DIM       18
.
ZIM11     DIM       11
ZIM12     DIM       12
ZIM13     DIM       13
ZIM14     DIM       14
ZIM15     DIM       15
ZIM16     DIM       16
ZIM17     DIM       17
ZIM18     DIM       18
.
FMSTMP0A  IFILE     SQL, FIXED=15, KEY="U1-2,3-6"     * parameter variables
NAMEA     INIT      "fmstmA"
FILENAMA  DIM       8
KILLTMPA  DIM       80
MAKETMPA  DIM       80
.
TYPDESC   INIT      "                        "   * projection type
TYPDESC0  INIT      "Not Active"
TYPDESC1  INIT      "% Var Extrapolation"
TYPDESC2  INIT      "Simple Linear Projection"
.
.
BUDG1     DIM       4                  * budget 1
DESC1     DIM       28                 * description 1
KPERIOD   FORM      2                  * period number
MAXPERDS  FORM      2                  * maximum no. of periods
OPTIONP   FORM      2                  * screen selection keyin var
PERDDESC  DIM       20                 * period description
.
STATUS    INIT      "                      "  * status
STATUS0   INIT      "Open"
STATUS1   INIT      "Open for Journals Only"
STATUS2   INIT      "Closed"
.
NOADD     INIT      "No Add to Account Allocated        "
Z20       INIT      "ZZZZZZZZZZZZZZZZZZZZ"
.
ACCOUNT   DIM       12                 * account
AMOUNTNO  FORM      1                  * amount number (param for DAMT, GAMT)
AVYTD     FORM      1                  * average ytd ? (1=yes)
AVYTDD0   INIT      "Total  "
AVYTDD1   INIT      "Average"
AVYTDDIS  INIT      "       "
COSTCODE  DIM       12                 * cost centre
DACCOUNT  DIM       35                 * temp account description
OPTNO     FORM      2                  * option no.
SUBJCODE  DIM       12                 * subjective
TEMPDPLA  FORM      1                  * temp var for no. of decimal places
TEMPTYPE  DIM       1                  * temp var for account type
TOTPERS   FORM      2                  * total period number
TOTALTYP  FORM      1                  * 0=total, 1=subj, 2=cc
CURDIS    FORM      12.2
TCURDIS   FORM      12.2
TYTDDIS   FORM      12.2
YTDDIS    FORM      12.2
.
BANKNAME  DIM       35
CREDNAME  DIM       35
DEBTNAME  DIM       35
DISCNAME  DIM       35
PAYMNAME  DIM       35
AGSTNAME  DIM       35
CGSTNAME  DIM       35
.
.******************************************************************************
.*  MAINLINE - Controlling Logic                                              *
.******************************************************************************
ML0000    CALL      INIT0000           * display heading and open files
          UNPACK    SP70,CURYEAR
          MOVE      ZERO,PERIODNO
.
ML0100    
          CALL      KACC0000           * get account
          MATCH     SP70,CURYEAR
          GOTO      ML0150 IF NOT EQUAL
.
          MOVE      FMLACYRR,CURYEAR   * start at current year
          MOVE      FMLAPER,PERIODNO   * start at current period
.
ML0150    BRANCH    EXIT,ML9999        * exit program
.
ML0200    CALL      SELA0000           * perform screen A
          BRANCH    EXIT,ML0100        * exit program
.
ML1000    CALL      VSCR0000           * valid screen ?
          BRANCH    SCRNO,ML1100,ML1200,ML1300,ML1400:
                          ML1500,ML1600,ML1700,ML1800,ML1900
.
ML1100    CALL      SELB0000           * perform screen B - summary screen
          BRANCH    EXIT,ML0200        * return to screen A
          GOTO      ML1000             * display desired screen
.
ML1200    CALL      SELC0000           * perform screen C - analysis by period
          BRANCH    EXIT,ML0200        * return to screen A
          GOTO      ML1000             * display desired screen
.
ML1300    CALL      SELD0000           * perform screen D - ytd analysis screen
          BRANCH    EXIT,ML0200        * return to screen A
          GOTO      ML1000             * display desired screen
.
ML1400    CALL      SELE0000           * perform screen E - committed det screen
          BRANCH    EXIT,ML0200        * return to screen A
          GOTO      ML1000             * display desired screen
.
ML1500    CALL      SELG0000           * perform screen G - static details
          BRANCH    EXIT,ML0200        * return to screen A
          GOTO      ML1000             * display desired screen
.
ML1600    CALL      SELK0000           * perform screen K - dissection analysis
          BRANCH    EXIT,ML0200        * return to screen A
          GOTO      ML1000             * display desired screen
.
ML1700    CALL      SELL0000           * perform screen L - resp. analysis
          BRANCH    EXIT,ML0200        * return to screen A
          GOTO      ML1000             * display desired screen
.
ML1800    CALL      PRNT0000           * print all details
          GOTO      ML0200             * display desired screen
.
ML1900    CALL      SELP0000           * perform screen P - parameter screen
          GOTO      ML0200             * display desired screen
.
.
ML9999    CALL      CLOS0000 * close some files to stop I*M*024-0(pblog.log)
          PREP      FMSTMP01,FILENAM1  * delete temporary files
          PREP      FMSTMP02,FILENAM2
          CLOSE     FMSTMP01
          CLOSE     FMSTMP02
          CLOSE     FMSTMP0A
          EXECUTE   KILLTMPA,TASKID
.
          CLOCK      FORK,KEY2         * fork off !!
          MATCH      " 0",KEY2
          IF         @EQUAL
            CHAIN       PGM            * not forking
          ELSE
            STOP                       * forking
          ENDIF
.
.******************************************************************************
.* INIT - Open Files                             Called by ML0000             *
.******************************************************************************
INIT0000  CALL      DISPHEAD
.
          DISPLAY   *P56:24,"Opening controlf";  * control file
          OPEN      CONTROLF,"controlf"
          CALL      RDFMCO50
          CALL      RDFMCO51
          CALL      RDFMCO52
          CALL      RDFMCO65
          CALL      RDFMCO66
          LOAD      FMCOUST,PROGNO,FMCOUST,ZERO,ONE
.
          DISPLAY   *P64:24,"fmsamaaf";  * account
          OPEN      FMSAMAA1,"fmsamaaf"
          OPEN      FMSAMAA2,"fmsamaaf"
          OPEN      FMSAMAA3,"fmsamaaf"
.
          DISPLAY   *P64:24,"fmstcfaf";  * total calc
          OPEN      FMSTCFA1,"fmstcfaf"
          OPEN      FMSTCFA2,"fmstcfaf"
.
          DISPLAY   *P64:24,"fmssquaf";  * enquiry security
          OPEN      FMSSQUA1,"fmssquaf"
.
          DISPLAY   *P64:24,"fmslmaaf";  * ledger
          OPEN      FMSLMAA1,"fmslmaaf"
.
          DISPLAY   *P64:24,"fmslmcaf";  * ledger calendar
          OPEN      FMSLMCA1,"fmslmcaf"
.
          DISPLAY   *P64:24,"fmsbtyaf";  * budget file
          OPEN      FMSBTYA1,"fmsbtyaf"
.
          DISPLAY   *P64:24,"fmsuwpaf";  * wp file
          OPEN      FMSUWPA1,"fmsuwpaf"
.
          DISPLAY   *P64:24,"fmscodaf";  * codes file
          OPEN      FMSCODA1,"fmscodaf"
.
          DISPLAY   *P64:24,"fmslmbaf";  * report file
          OPEN      FMSLMBA1,"fmslmbaf"
.
          DISPLAY   *P64:24,"fmsoncaf";  * oncost file
          OPEN      FMSONCA1,"fmsoncaf"
.
          DISPLAY   *P64:24,"fmsprcaf";  * print code file
          OPEN      FMSPRCA1,"fmsprcaf"
.
          DISPLAY   *P64:24,"fmslevaf";  * level code file
          OPEN      FMSLEVA1,"fmslevaf"
.
          DISPLAY   *P64:24,"fmsdisaf";  * dissection file
          OPEN      FMSDISA1,"fmsdisaf"
.
          DISPLAY   *P64:24,"fmsrsfaf";  * report seq file
          OPEN      FMSRSFA1,"fmsrsfaf"
          OPEN      FMSRSFA2,"fmsrsfaf"
.
          DISPLAY   *P64:24,"fmsresaf";  * responsibility file
          OPEN      FMSRESA1,"fmsresaf"
.
          PACK      FMCOCOMT,FMCOCOMT,SP70
.
. ------- Open Committed Expenditure Files
          DISPLAY   *P64:24,"apsceaaf";  * commited expenditure file
          OPEN      APSCEAA1,"apsceaaf"
          DISPLAY   *P64:24,"apscebaf";  * commited expenditure file
          OPEN      APSCEBA2,"apscebaf"
.
          DISPLAY   *P64:24,"apscioaf";  * commited expenditure file
          OPEN      APSCIOA1,"apscioaf"
          DISPLAY   *P64:24,"apsordaf";  * commited expenditure file
          OPEN      APSORDA2,"apsordaf"
.
          DISPLAY   *P64:24,"fmsbnkaf";  * bank rec file
          OPEN      FMSBNKA2,"fmsbnkaf"
.
          DISPLAY   *P64:24,"fmschqaf";  * cheque account file
          OPEN      FMSCHQA1,"fmschqaf"
.
          DISPLAY   *P64:24,"fmscsaaf";
          OPEN      FMSCSAA1,"fmscsaaf"
.
          DISPLAY   *P64:24,"apsmasaf";
          OPEN      APSMASA1,"apsmasaf"
.
          DISPLAY   *P64:24,"fmsccaaf";  * cost centre file
          OPEN      FMSCCAA1,"fmsccaaf"
.
          DISPLAY   *P64:24,"fmssbaaf";  * subjective file
          OPEN      FMSSBAA1,"fmssbaaf"
.
          PACK      FILENAM1,NAME1,PORT
          REP       " 0",FILENAM1
.
          PACK      FILENAM2,NAME2,PORT
          REP       " 0",FILENAM2
.
          UNPACK    SP70,ACTFILE,BUDFILE,TRANFILE,LACTFILE,LBUDFILE *clear files
.
.
          PACK      FILENAMA,NAMEA,PORT
          REP       " 0",FILENAMA
.
          CLEAR     MAKETMPA
          APPEND    "isbuild ",MAKETMPA
          APPEND    FILENAMA,MAKETMPA
          APPEND    " 15 u1-2,3-6",MAKETMPA
          RESET     MAKETMPA
.
          CLEAR     KILLTMPA
          APPEND    "iserase ",KILLTMPA
          APPEND    FILENAMA,KILLTMPA
          RESET     KILLTMPA
.
          EXECUTE   KILLTMPA,TASKID
          EXECUTE   MAKETMPA,TASKID
          OPEN      FMSTMP0A,FILENAMA
.
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.******************************************************************************
.* SCRA - Display Screen A                       Called by SELA               *
.******************************************************************************
SCRA0000  DISPLAY   *P60:3,*V2LON,*EF,*HOFF:
                    *P1:4,"    Ledger/Account       : ":
                    *V2LON,FMAMLEDG,SLASH,FMAMACCT,SP2,*HOFF,FMAMDESC:
                    *P1:6,*V2LON," 0",*HOFF," = Exit";
.
          BRANCH    ATYPE,SCRA1000,SCRA1000,SCRA1000,SCRA1000,SCRA1000:
                          SCRA2000,SCRA5000,SCRA3000,SCRA4000
.
.---- posting account ----
.
SCRA1000  DISPLAY   *P1:7,*V2LON," 1",*HOFF," = Summary":
                    *P1:8,*V2LON," 2",*HOFF," = Analysis by Period":
                    *P1:9,*V2LON," 3",*HOFF," = Committed Expenditure":
                   *P1:10,*V2LON," 4",*HOFF," = Static Details";
          BRANCH    FMCOUST,SCRA1100   * accrued/cash
.
          DISPLAY  *P1:11,*V2LON," 5",*HOFF," = Dissection Analysis":
                   *P1:12,*V2LON," 6",*HOFF," = Responsibility Analysis":
                   *P1:13,*V2LON," 7",*HOFF," = Print All Details":
                   *P1:14,*V2LON," 8",*HOFF," = Enquiry Parameters"
          MOVE      "16",CVERT
          GOTO      SCRA9999
.
SCRA1100  DISPLAY  *P1:11,*V2LON," 5",*HOFF," = Print All Details":
                   *P1:12,*V2LON," 6",*HOFF," = Enquiry Parameters"
          MOVE      "14",CVERT
          GOTO      SCRA9999
.
.---- total account ----
.
SCRA2000  DISPLAY   *P1:7,*V2LON," 1",*HOFF," = Summary":
                    *P1:8,*V2LON," 2",*HOFF," = Analysis by Period":
                    *P1:9,*V2LON," 3",*HOFF," = Year to Date":
                   *P1:10,*V2LON," 4",*HOFF," = Committed Expenditure":
                   *P1:11,*V2LON," 5",*HOFF," = Static Details":
                   *P1:12,*V2LON," 6",*HOFF," = Print All Details":
                   *P1:13,*V2LON," 7",*HOFF," = Enquiry Parameters"
          MOVE      "15",CVERT
          GOTO      SCRA9999
.
.---- stat posting account ----
.
SCRA3000  DISPLAY   *P1:7,*V2LON," 1",*HOFF," = Summary":
                    *P1:8,*V2LON," 2",*HOFF," = Analysis by Period":
                    *P1:9,*V2LON," 3",*HOFF," = Static Details":
                   *P1:10,*V2LON," 4",*HOFF," = Print All Details":
                   *P1:11,*V2LON," 5",*HOFF," = Enquiry Parameters"
          MOVE      "13",CVERT
          GOTO      SCRA9999
.
.---- stat total account ----
.
SCRA4000  DISPLAY   *P1:7,*V2LON," 1",*HOFF," = Summary":
                    *P1:8,*V2LON," 2",*HOFF," = Analysis by Period":
                    *P1:9,*V2LON," 3",*HOFF," = Year to Date":
                   *P1:10,*V2LON," 4",*HOFF," = Static Details":
                   *P1:11,*V2LON," 5",*HOFF," = Print All Details":
                   *P1:12,*V2LON," 6",*HOFF," = Enquiry Parameters"
          MOVE      "14",CVERT
          GOTO      SCRA9999
.
.---- heading account ----
.
SCRA5000  DISPLAY   *P1:7,*V2LON," 1",*HOFF," = Static Details":
                    *P1:8,*V2LON," 2",*HOFF," = Print All Details":
                    *P1:9,*V2LON," 3",*HOFF," = Enquiry Parameters"
          MOVE      "11",CVERT
          GOTO      SCRA9999
.
SCRA9999  RETURN
.******************************************************************************
.* SELA - Perform Screen A                       Called By ML0000             *
.*       Requires : SKEY     (ledger/account selected)                        *
.*       Returns  : EXIT     (1=quit)                                         *
.******************************************************************************
SELA0000  MOVE      "0",SCRNO          * this is screen 0
          PACK      KEY14,SKEY
          CALL      RDFMAM1            * read account data
          MOVE      FMAMTYPE,ATYPE
          CALL      SCRA0000           * display Screen A
.
          DISPLAY   *P1:CVERT,"Select Option : ";
          MOVE      "17",CCOL
.
SELA0100  KEYIN     *PCCOL:CVERT,"_",*PCCOL:CVERT,*V2LON,OPTIONA
          COMPARE   ZERO,OPTIONA
          GOTO      SELA9500 IF EQUAL  * exit ?
          BRANCH    ATYPE,SELA1000,SELA1000,SELA1000,SELA1000,SELA1000:
                          SELA2000,SELA5000,SELA3000,SELA4000
.
.---- posting account ----
.
SELA1000  BRANCH    FMCOUST,SELA1100   * accrued/cash
          LOAD      SCRNO,OPTIONA,ONE,TWO,FOUR,FIVE,SIX,SEVEN,EIGHT,NINE
.
          BRANCH    OPTIONA,SELA9000,SELA9000,SELA9000,SELA9000:
                            SELA9000,SELA9000,SELA9000,SELA9000
          BEEP
          GOTO      SELA0100
.
SELA1100  LOAD      SCRNO,OPTIONA,ONE,TWO,FOUR,FIVE,EIGHT,NINE
.
          BRANCH    OPTIONA,SELA9000,SELA9000,SELA9000,SELA9000:
                            SELA9000,SELA9000
          BEEP
          GOTO      SELA0100
.
.---- total account ----
.
SELA2000  LOAD      SCRNO,OPTIONA,ONE,TWO,THREE,FOUR,FIVE,EIGHT,NINE
          BRANCH    OPTIONA,SELA9000,SELA9000,SELA9000,SELA9000:
                            SELA9000,SELA9000,SELA9000
          BEEP
          GOTO      SELA0100
.
.---- stat posting account ----
.
SELA3000  LOAD      SCRNO,OPTIONA,ONE,TWO,FIVE,EIGHT,NINE
          BRANCH    OPTIONA,SELA9000,SELA9000,SELA9000,SELA9000,SELA9000
          BEEP
          GOTO      SELA0100
.
.---- stat total account ----
.
SELA4000  LOAD      SCRNO,OPTIONA,ONE,TWO,THREE,FIVE,EIGHT,NINE
          BRANCH    OPTIONA,SELA9000,SELA9000,SELA9000:
                            SELA9000,SELA9000,SELA9000
          BEEP
          GOTO      SELA0100
.
.---- heading account ----
.
SELA5000  LOAD      SCRNO,OPTIONA,FIVE,EIGHT,NINE
          BRANCH    OPTIONA,SELA9000,SELA9000,SELA9000
          BEEP
          GOTO      SELA0100
.
.
SELA9000  MOVE      ZERO,EXIT          * continue
          GOTO      SELA9999
.
SELA9500  MOVE      ONE,EXIT           * quit
.
SELA9999  RETURN
.******************************************************************************
.* INCLUDES FOR I/O'S                                                         *
.******************************************************************************
.
          INC       APSPPDIO/INC
          INC       APSMASIO/INC
          INC       APSCIOIO/INC       * committed expenditure
          INC       APSORDIO/INC       * committed expenditure
          INC       APSCEAIO/INC       * committed expenditure
          INC       APSCEBIO/INC       * committed expenditure
          INC       FMSAMAIO/INC       * account
          INC       FMSBNKIO/INC       * bank rec
          INC       FMSBTYIO/INC       * budget data
          INC       FMSBUDIO/INC       * budget data
          INC       FMSCHQIO/INC       * cheque
          INC       FMSCONIO/INC       * controlf
          INC       FMSCSAIO/INC
          INC       FMSDSFIO/INC       * dissection accrual summary file
          INC       FMSFPSIO/INC       * period summary file
          INC       FMSLMAIO/INC       * ledger
          INC       FMSLMCIO/INC       * ledger financial calendar
          INC       FMSSQUIO/INC       * enquiry security
          INC       FMSSBUIO/INC       * stat budget
          INC       FMSSMAIO/INC       * stat summary
          INC       FMSTRNIO/INC       * transaction
          INC       FMSUWPIO/INC       * wp file
          INC       FMSCODIO/INC       * codes file
          INC       FMSLMBIO/INC       * report[
          INC       FMSONCIO/INC       * oncost code
          INC       FMSPRCIO/INC       * print code
          INC       FMSLEVIO/INC       * level code
          INC       FMSSTRIO/INC       * stats transactions
          INC       FMSTCFIO/INC       * total calc
          INC       FMSDISIO/INC       * dissection
          INC       FMSRESIO/INC       * responsibility
          INC       FMSRSFIO/INC       * report seq file
          INC       FMSCTRIO/INC       * cash transactions
          INC       FMSCCAIO/INC       * cost centre
          INC       FMSSBAIO/INC       * subjective
.
          INC       FMSAMAKY           * account
          INC       FMSBTYKY           * budget
          INC       FMSLMAKY           * ledger
          INC       FMSLMCKY           * ledger callendar
.
          INC       FMSENSCR           * enquiry screens
          INC       FMSSTDCD           * FMS standard include

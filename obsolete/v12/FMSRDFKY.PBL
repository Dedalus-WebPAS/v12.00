.-------------------------------------------------------------------------------
.   System    :   FMS Financial System  
.                           
.   Program   :   FMSRDFFM 
.                            
.   Routines  :   KRDFFM00 Keyin Report   - Returns a valid record
.                 ARDFFM00 Accept Report  - Returns a key NOT on file
.   
.   Return    :   EXIT = 1 null entry EXIT = 2 EXITCHAR entered
.
.   Internal  :   HFMRDA00 Help Display for Report  
.                            
.   Redisplay :   RRDFFM00 Screen Redisplay Called for Report  
.-------------------------------------------------------------------------------
.   Mods      :    
.-------------------------------------------------------------------------------
. Normal Code Keyin - Code Must Exist Exit = 1 if Null Entry
.-------------------------------------------------------------------------------
KRDFFM00  MOVE      UNDLN70,FMRDCOD
          KEYIN     *PCCOL:CVERT,*EL,*DV,FMRDCOD:
                    *PCCOL:CVERT,*V2LON,FMRDCOD: 
                    *PCCOL:CVERT,*EL,*DV,FMRDCOD
.
          ENDSET    FMRDCOD
          APPEND    SP70,FMRDCOD
          RESET     FMRDCOD
          MATCH     SP70,FMRDCOD             * System Code Spaces so exit set
          GOTO      KRDFFM90 IF EQUAL
.
          CMATCH    EXITCHAR,FMRDCOD         * Exit Selected
          GOTO      KRDFFM95 IF EQUAL
.
          CMATCH    QUEST,FMRDCOD            * Help Required  
          GOTO      KRDFFM10 IF NOT EQUAL
          CALL      HFMRDA00                  * Display List Of FMRDCODs
          PACK      CDATASAV,FMRDCOD,SP70    * save data entered
          CALL      RRDFFM00                  * Redisplay Routine
          PACK      FMRDCOD,CDATASAV,SP70    * restore data entered
.
          ENDSET    FMRDCOD
          APPEND    SP70,FMRDCOD
          RESET     FMRDCOD
          MATCH     SP70,FMRDCOD             * System Code Spaces so exit set
          GOTO      KRDFFM00 IF EQUAL
.
KRDFFM10  PACK      KEY3,FMRDCOD
          CALL      RDFMRD1                                   
          BRANCH    OVRCD,KRDFFM80
          MOVE      ZERO,EXIT                 * no entry so exit is set
          GOTO      KRDFFM99
.
KRDFFM80  DISPLAY   *P1:24,*EL,*B,"Report Does Not Exist - ";
          CALL      HITENTER
          GOTO      KRDFFM00
.
KRDFFM90  MOVE      ONE,EXIT                  * null entry so exit is set
          GOTO      KRDFFM99
.
KRDFFM95  MOVE      TWO,EXIT                  * Exit character entered    
.
KRDFFM99  RETURN
.-------------------------------------------------------------------------------
. Accept Code Keyin - Code Must Not Exist 
.-------------------------------------------------------------------------------
ARDFFM00  MOVE      UNDLN70,FMRDCOD
          KEYIN     *PCCOL:CVERT,*EL,*DV,FMRDCOD:
                    *PCCOL:CVERT,*V2LON,FMRDCOD: 
                    *PCCOL:CVERT,*V2LON,*DV,FMRDCOD
.
          ENDSET    FMRDCOD
          APPEND    SP70,FMRDCOD
          RESET     FMRDCOD
          MATCH     SP70,FMRDCOD             * System Code Spaces so exit set
          GOTO      ARDFFM90 IF EQUAL
.
          CMATCH    EXITCHAR,FMRDCOD         * Exit Selected
          GOTO      ARDFFM95 IF EQUAL
.
          CMATCH    QUEST,FMRDCOD            * Help Required  
          GOTO      ARDFFM10 IF NOT EQUAL
          CALL      HFMRDA00                  * Display List Of FMRDCODs
          CALL      RRDFFM00                  * Redisplay Routine
.
          ENDSET    FMRDCOD
          APPEND    SP70,FMRDCOD
          RESET     FMRDCOD
          MATCH     SP70,FMRDCOD             * System Code Spaces so exit set
          GOTO      ARDFFM00 IF EQUAL
.
ARDFFM10  PACK      KEY3,FMRDCOD
          MOVE      ZERO,EXIT                 * no entry so exit is set
          CALL      RDFMRD1                                   
          BRANCH    OVRCD,ARDFFM99
.
          DISPLAY   *P1:24,*EL,*B,"Report Already Exists - ";
          CALL      HITENTER
          GOTO      ARDFFM00
.
ARDFFM90  MOVE      ONE,EXIT                  * null entry so exit is set
          GOTO      ARDFFM99
.
ARDFFM95  MOVE      TWO,EXIT                  * Exit character entered    
.
ARDFFM99  RETURN
.------------------------------------------------------------------------------
. Display List of All Codes
.------------------------------------------------------------------------------
HFMRDA00
          MOVE      ZERO,CSCRSIZ
          IF        HTOP<3
            MOVE      "12",HTOP
            MOVE      "24",HBOT
            MOVE      "42",HLEF
            MOVE      "80",HRIG
          ENDIF
HFMRDA04
          CALL      GSCRN000
          BRANCH    EXIT,HFMRDA99
          MOVE      STDCOL00,STDCOL01
          ADD       " 5",STDCOL01
          DISPLAY   *PSTDCOL01:STDROW,*V2LON,*ULON,"Report"             
.
          MOVE      STDCOL01,STDCOL02
          ADD       " 7",STDCOL02
          DISPLAY   *PSTDCOL02:STDROW,*V2LON,*ULON,"Description"        
.
          MOVE      STDCOL02,STDCOL03
          ADD       "36",STDCOL03
HFMRDA08
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          MOVE      SP70,FMRDCOD
          PACK      KEY3,FMRDCOD,SP70                                          
.                                                                               
.                                                                               
          CALL      RSFMRD1 
HFMRDA10
          CALL      RKFMRD1 
          BRANCH    OVRCD,HFMRDA15
          PACK      KEY3,FMRDCOD,SP70                                          
.                                                                               
.                                                                               
          BRANCH    CSEARCH,HFMRDA12
          CALL      HFMRDA60
          BRANCH    OVRCD,HFMRDA10
HFMRDA12
          ADD       ONE,XITEMNO
          ADD       ONE,STDROW
          STORE     KEY3,XITEMNO,ST1,ST2,ST3,ST4,ST5:                            
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          DISPLAY   *PSTDCOL00:STDROW,SP1,*V2LON,XITEMNO,DOT
          DISPLAY   *PSTDCOL01:STDROW,FMRDCOD
          DISPLAY   *PSTDCOL02:STDROW,FMRDDES
          COMPARE   MAXITEM,XITEMNO
          GOTO      HFMRDA10 IF NOT EQUAL
HFMRDA15
.                                                                               
          MOVE      ONE,DITEM
          MOVE      MINITEM,DROW
          ADD       ONE,DROW
          DISPLAY   *PSTDCOL00:DROW,*V2LON,*HON,SP1,DITEM,DOT
          CLIP
          FLUSH     HLEF,HTOP,HRIG,HBOT
.
HFMRDA20
          CALL      HSCRI000
          BRANCH    EXIT,HFMRDA30,HFMRDA35,HFMRDA40,HFMRDA45,HFMRDA04:
                              HFMRDA91,HFMRDA50
          GOTO      HFMRDA92
HFMRDA30
          CALL      RKFMRD1 
          BRANCH    OVRCD,HFMRDA85
          PACK      KEY3,FMRDCOD,SP70                                          
.                                                                               
.                                                                               
          CALL      RPFMRD1 
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMRDA10
HFMRDA35
          MOVE      ST1,KEY3 
          CALL      RDFMRD1 
          CALL      RPFMRD1 
          BRANCH    OVRCD,HFMRDA85
          PACK      KEY3,FMRDCOD,SP70                                          
.                                                                               
.                                                                               
.                                                                               
.                                                                               
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
HFMRDA36
          CALL      RPFMRD1 
          BRANCH    OVRCD,HFMRDA37
          PACK      KEY3,FMRDCOD,SP70                                          
.                                                                               
.                                                                               
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HFMRDA36 IF NOT EQUAL
HFMRDA37
          MOVE      ZERO,XITEMNO
          GOTO      HFMRDA10
HFMRDA40
          MOVE      ST1,KEY3 
          CALL      RDFMRD1 
          CALL      RPFMRD1 
          BRANCH    OVRCD,HFMRDA85
          PACK      KEY3,FMRDCOD,SP70                                          
.                                                                               
.                                                                               
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMRDA08
HFMRDA45
          CALL      RKFMRD1 
          BRANCH    OVRCD,HFMRDA85
          PACK      KEY3,FMRDCOD,SP70                                          
.                                                                               
.                                                                               
          SUSPEND
          CLIP      1,1,CRIG,24
.
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      ZERO,XITEMNO
          PACK      KEY3,Z70                                                    
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
          CALL      RSFMRD1 
HFMRDA46
          CALL      RPFMRD1 
          BRANCH    OVRCD,HFMRDA47
          PACK      KEY3,FMRDCOD,SP70                                          
.                                                                               
.                                                                               
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HFMRDA46 IF NOT EQUAL
HFMRDA47
          MOVE      ZERO,XITEMNO
          GOTO      HFMRDA10
HFMRDA50  COMPARE   ZERO,CSEARCH
          GOTO      HFMRDA55 IF EQUAL
          MOVE      ZERO,CSEARCH
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          ADD       ONE,STDROW
          UNPACK    SP70,SCHFLD01,SCHFLD02,SCHFLD03,SCHFLD04,SCHFLD05
          UNPACK    SP70,SCHFLD06,SCHFLD07,SCHFLD08,SCHFLD09,SCHFLD10
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          DISPLAY   *PSTDCOL00:STDROW,*V2LON,*HON,"Sch"
          KEYIN     *PSTDCOL01:STDROW,*V2LON,SCHFLD01
          RESET     SCHFLD01
          KEYIN     *PSTDCOL02:STDROW,*V2LON,SCHFLD02
          RESET     SCHFLD02
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMRDA08
HFMRDA55  MOVE      ONE,CSEARCH
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMRDA08
HFMRDA60  MOVE      ZERO,OVRCD
          MATCH     SP70,SCHFLD01
          GOTO      HFMRDA61 IF EQUAL
          MATCH     SCHFLD01,FMRDCOD
          GOTO      HFMRDA72 IF NOT EQUAL
HFMRDA61
          MATCH     SP70,SCHFLD02
          GOTO      HFMRDA62 IF EQUAL
          MATCH     SCHFLD02,FMRDDES
          GOTO      HFMRDA72 IF NOT EQUAL
HFMRDA62
HFMRDA63
HFMRDA64
HFMRDA65
HFMRDA66
HFMRDA67
HFMRDA68
HFMRDA69
HFMRDA70
          GOTO      HFMRDA75
HFMRDA72  MOVE      ONE,OVRCD
HFMRDA75  RETURN
HFMRDA85
          LOAD      KEY3,XITEMNO,ST1,ST2,ST3,ST4,ST5:                            
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY3,FMRDCOD                                               
          CALL      RDFMRD1 
HFMRDA90
.                                                                               
          BEEP
          GOTO      HFMRDA20
HFMRDA91
          MOVE      SP70,FMRDDES
          MOVE      SP70,FMRDLED
          MOVE      ZERO,FMRDREP
          MOVE      SP70,FMRDRS 
          MOVE      SP70,FMRDPT 
          MOVE      SP70,FMRDLEV 
          MOVE      SP70,FMRDFPR 
          MOVE      SP70,FMRDTPR 
          MOVE      SP70,FMRDCBT 
          MOVE      SP70,FMRDPBT 
          MOVE      SP70,FMRDSUPP 
          MOVE      SP70,FMRDSHED 
          MOVE      SP70,FMRDSPAR
          MOVE      ZERO,FMRDCAS
          MOVE      ZERO,FMRDDOP
          MOVE      ZERO,FMRDZER
          MOVE      ZERO,FMRDPRJ
          MOVE      ZERO,FMRDSTAT
          MOVE      SP70,KEY3 
          MOVE      SP70,FMRDCOD
          GOTO      HFMRDA96
HFMRDA92
          MOVE      SP70,KEY3 
          MOVE      SP70,FMRDCOD
          LOAD      KEY3,CCITEM,ST1,ST2,ST3,ST4,ST5:                            
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY3,FMRDCOD                                               
HFMRDA96
          PUTSCR    CSSCRNUM,HLEF,HTOP,HRIG,HBOT
          CALL      FRESCR00
          MOVE      ZERO,HTOP
          MOVE      ZERO,HLEF
          MOVE      ZERO,HBOT
          MOVE      ZERO,HRIG
HFMRDA99
          RETURN


.******************************************************************************
.* System    :   Common                                                       *
.* Program   :   ECLUPLOD                                                     *
.* Desc      :   Load Eclipse data into IBA Allied Health                     *
.******************************************************************************
.* Date      :   13/09/2007                                                   *
.* Author    :   Mike Laming                                                  *
.* Mods      :                                                                *
.*                  Added ALSPQNTY and ALSPPRCE to CXALLSUP                   *
.******************************************************************************
.*        V11.02.01 07/02/2022  Thanh T       TSK 0896905                     *
.*                  Recompiled for ALLDEPFD changes                           *
.******************************************************************************
.*        V10.05.01 26/08/2014  Ania P        CAR 303210                      *
.*                  Populated MHHNURNO before write to mehhonaf               *
.*        V10.01.01 16/03/2010  J.Tan         CAR 233924                      *
.*                  Mods to set PTTRCLTY - claim type                         *
.*        V10.00.02 31/03/2010  Mike Laming   CAR 217575                      *
.*                  Recompiled for changes to MEHDIAFD                        *
.*        V10.00.01 25/03/2010  Ebon Clements CAR 208232                      *
.*                  Added ALSPQNTY and ALSPPRCE to CXALLSUP                   *
.******************************************************************************
.*        V9.11.02  06/02/2009  Mike Laming   CAR 179996                      *
.*                  Re-copied program from V9.10                              *
.*        V9.11.01  06/02/2009  Jill Habasque CAR 185179                      *
.*                  Mods to right justify PVISYST                             *
.******************************************************************************
.*        V9.10.15  12/11/2008  Mike Laming   CAR 179996                      *
.*                  Change CAT./Codes Mapping table to accept 7 chars in      *
.*                  Eclipse code - change table TEMPCAT1 to key 12            *
.*        V9.10.14  06/11/2008  Mike Laming   CAR 179996                      *
.*                  2 more fixes for Eric                                     *
.*        V9.10.13  29/10/2008  Mike Laming   CAR 179996                      *
.*                  Fix "RES" record Field 13 to Time (not Date)              *
.*        V9.10.12  15/10/2008  Mike Laming   CAR 179996                      *
.*                  Fix "LS" record as per e-mail 14/10/2008                  *
.*        V9.10.11  14/10/2008  Mike Laming   CAR 179996                      *
.*                  Fix "LS" record as per e-mail 14/10/2008                  *
.*        V9.10.10  03/10/2008  Mike Laming   CAR 179996                      *
.*                  Add output to "mehvi1af" at PDIA8000 as part of "mehdiaaf"*
.*        V9.10.09  30/09/2008  Mike Laming   CAR 179344                      *
.*                  Changes to CON record, fields alencont, alenhcp           *
.*        V9.10.08  23/09/2008  Mike Laming   CAR ......                      *
.*                  Correct MEHDIAaf key at PDIA8000 - as per e-mail          *
.*        V9.10.07  16/09/2008  Mike Laming   CAR ......                      *
.*                  Mods to MHHNAQ8A (DIM 1 should be Cat.Code "hb") per e-mail
.*        V9.10.06  28/08/2008  Mike Laming   CAR 176905                      *
.*                  Mods to NXTCON00 for hard loop (blamed on NXTSES00)       *
.*        V9.10.05  28/08/2008  Mike Laming   CAR 174535                      *
.*                  Further mods for V3.1 and comment out Codes Lock GETSLK00 *
.*        V9.10.04  30/07/2008  Mike Laming   CAR 174535                      *
.*                  Changes for V3.1 of the Eclipse Migration Document        *
.*        V9.10.03  29/07/2008  Mike Laming   CAR 174655/56/57/58/60          *
.*                  Correct errors as in Email from NZ                        *
.*        V9.10.02  22/07/2008  Mike Laming   CAR 174378                      *
.*                  Correct to handle "sinciaaf" Catalog Code based on Ind.   *
.*                  INCOCATE (SINCONFD - IBA Screen 1, Opt.8)                 *
.*        V9.10.01  17/07/2008  Mike Laming   CAR                             *
.*                  Correct EOC Field 55 (eoc ud01_num)                       *
.*        V9.10.00  11/07/2008  Mike Laming   CAR                             *
.*                  Copied to V9.10                                           *
.*        V9.09.01  09/07/2008  Mike Laming   CAR                             *
.*                  Minor changes to EDDAY000 and EDYN0000                    *
.*        V9.09.00  29/04/2008  Mike Laming   CAR 135503                      *
.*                  Ported to V9.09                                           *
.*                                                                            *
.******************************************************************************
+
          INC       STD001FD
.
          INC       ALLCONFD/INC            * A/H Control file      
          INC       ALLCASFD/INC            * A/H Caseteam Codes   
          INC       ALLDEPFD/INC            * A/H Department Table 
          INC       ALLENCFD/INC            * A/H Encounter Table
          INC       ALLGROFD/INC            * A/H Group Session Master
          INC       ALLGREFD/INC            * A/H Group Session Details
          INC       ALLGPAFD/INC            * A/H Group Encounter Details
          INC       ALLINCFD/INC            * A/H Dept. Intervention Codes
          INC       ALLITVFD/INC            * A/H Health Interventions
          INC       ALLREFFD/INC            * A/H Referral Table
          INC       ALLRLNFD/INC            * A/H Linked SACS Referrals
          INC       ALLRSAFD/INC            * A/H Residential Admissions
          INC       ALLSERFD/INC            * A/H Dept/Service Code
          INC       ALLSUPFD/INC            * A/H Encounter Supplies
          INC       MEHDIAFD/INC            * Mental Health Diagnosis History
          INC       MEHVI1FD/INC            * Mental Health Visit Table
          INC       MEHHLSFD/INC            * Mental Health Legal Status Header
          INC       MEHDLSFD/INC            * Mental Health Legal Status Detail
          INC       MEHHONFD/INC            * Mental Health MH HoNOS Reporting
.
          INC       PATCONFD/INC            * Patient Control file      
          INC       PATCODFD/INC            * Cat.Codes file
          INC       PATMA1FD/INC            * PMI Master
          INC       PATVISFD/INC            * Patient Visit Details
          INC       PMSVX1FD/INC            * Patient Visit Extension
          INC       PMSHCPFD/INC            * Patient Health Care Professional
          INC       PATWR1FD/INC            * Patient Ward/Bed       
          INC       PATMI1FD/INC            * Patient Admission Details
          INC       PATDSCFD/INC            * Patient Discharge details
          INC       PATTRNFD/INC            * Patient Transfer Records
          INC       PATNOBFD/INC            * Patient Ward with no Beds
          INC       SINCIAFD/INC            * Supply Cat. Codes 
          INC       WEBSECFD/INC            * Web Security / Web Users
.
. ----- Semi-temporary ECLUPLOD Memory table -----
.
TEMPMEM1  IFILE     SQL, FIXED=90, KEY="U1-3,4-11"               * KEY11
TMPMEM1   INIT      "tmeclmem 90 U1-3,4-11"
.
.Name     Type      Length   Physical   Start   Description
.----     ----      ------   --------   -----   -----------
MEMCODE   DIM       3        3          1       Code "001", "002", "003"       
MEMFNAME  DIM       8        8          4       File Name - 8 chars
MEMPATFN  DIM       60       60         12      Path & File Name
MEMSTAT   DIM       1        1          72      File Status - "P" = Processed
MEMSPAR   DIM       17       17         73
.                        Record length  90
.         
. ----- Semi-temporary ECLUPLOD EID_ID table -----
. 
TEMPEID1  IFILE     SQL, FIXED=70, KEY="U1-3,4-23"               * KEY23
TMPEID1   INIT      "tmecleid 70 U1-3,4-23"
.
.Name     Type      Length   Physical   Start   Description
.----     ----      ------   --------   -----   -----------
EIDIDCOD  DIM       3        3          1       Code "EOC", "HCE", "CON", "SES",
.                                                    "GRP", "RES", "REF"
EIDIDNO   DIM       20       20         4       eoc_Id or hce_Id or contact_id
EIDVISNO  DIM       8        8          24      PAS Visit No - "EOC" "HCE" "CON"
EIDENCNO  DIM       8        8          32      Encounter No - "CON"
EIDSESNO  DIM       8        8          40      Session No   - "SES" 
EIDCONNO  DIM       8        8          48      Contact No   - "CON"
EIDTEST   DIM       1        1          56      "T" if created in Option 1
EIDOOONO  DIM       8        8          57      mha_id for "REF"     
EIDSPAR   DIM       5        5          65
.                        Record length  70
. ----- Temp Mapping File Definitions -----
.
TEMPHCP1  IFILE     SQL, FIXED=30, KEY="U1-3,4-13"               * KEY13
TMPDEF1   INIT      "tmphcpmp 30 U1-3,4-13"
.
.Name     Type      Length   Physical   Start   Description
.----     ----      ------   --------   -----   -----------
HCPCODE   DIM       3        3          1       Code "HCP", "CTM", "USR"       
HCPECLCD  DIM       10       10         4       Eclipse Code
HCPIBACD  DIM       10       10         14      PAS HCP Code
HCPSPAR   DIM       7        7          24      Spare       
.
.
TEMPCAT1  IFILE     SQL, FIXED=30, KEY="U1-5,6-12"               * KEY12 *12/11
TMPDEF2   INIT      "tmpcatmp 30 U1-5,6-12"                             * 12/11
.
.Name     Type      Length   Physical   Start   Description
.----     ----      ------   --------   -----   -----------
CATECAT   DIM       5        5          1       Eclipse Category
CATECODE  DIM       7        7          6       Eclipse Code            * 12/11
CATPCAT   DIM       2        2          13      PAS Category
CATPCODE  DIM       10       10         15      PAS Cat.Code/PAS Code (only)
CATSPAR   DIM       5        5          25      Spare
.
. ----- Input Text File Definitions -----
.
INTEST01  FILE      ASCII, FIXED=2000       * used to test if file exists
INHCPTXT  FILE      HL7, FIXED=256          * input file for HCPs, Caseteam etc
INCATTXT  FILE      HL7, FIXED=256          * input file for Cat.Codes mapping
.
FLD10001  DIM       10
FLD10002  DIM       10
FLD10003  DIM       10
FLD10004  DIM       10

INECLTXT  FILE      HL7, FIXED=2000         * input file for Eclipse data
.
ECLRECID  DIM       3
FLD60001  DIM       60
FLD60002  DIM       60
FLD60003  DIM       60
FLD60004  DIM       60
FLD60005  DIM       60
FLD60006  DIM       60
FLD60007  DIM       60
FLD60008  DIM       60
FLD60009  DIM       60
FLD60010  DIM       60
FLD60011  DIM       60
FLD60012  DIM       60
FLD60013  DIM       60
FLD60014  DIM       60
FLD60015  DIM       60
FLD60016  DIM       60
FLD60017  DIM       60
FLD60018  DIM       60
FLD60019  DIM       60
FLD60020  DIM       60
FLD60021  DIM       60
FLD60022  DIM       60
FLD60023  DIM       60
FLD60024  DIM       60
FLD60025  DIM       60
FLD60026  DIM       60
FLD60027  DIM       60
FLD60028  DIM       60
FLD60029  DIM       60
FLD60030  DIM       60
FLD60031  DIM       60
FLD60032  DIM       60
FLD60033  DIM       60
FLD60034  DIM       60
FLD60035  DIM       60
FLD60036  DIM       60
FLD60037  DIM       60
FLD60038  DIM       60
FLD60039  DIM       60
FLD60040  DIM       60
FLD60041  DIM       60
FLD60042  DIM       60
FLD60043  DIM       60
FLD60044  DIM       60
FLD60045  DIM       60
FLD60046  DIM       60
FLD60047  DIM       60
FLD60048  DIM       60
FLD60049  DIM       60
FLD60050  DIM       60
FLD60051  DIM       60
FLD60052  DIM       60
FLD60053  DIM       60
FLD60054  DIM       60
FLD60055  DIM       60
FLD60056  DIM       60
FLD60057  DIM       60
FLD60058  DIM       60
FLD60059  DIM       60
FLD60060  DIM       60
FLD60061  DIM       10
FLD60062  DIM       10
FLD60063  DIM       10
FLD60064  DIM       10
FLD60065  DIM       10
FLD60066  DIM       10
FLD60067  DIM       10
FLD60068  DIM       10
FLD60069  DIM       10
FLD60070  DIM       10
FLD60071  DIM       10
FLD60072  DIM       10
FLD60073  DIM       10
FLD60074  DIM       10
FLD60075  DIM       10
FLD60076  DIM       10
FLD60077  DIM       10
FLD60078  DIM       10
FLD60079  DIM       10
FLD60080  DIM       10
FLD60081  DIM       10
FLD60082  DIM       10
FLD60083  DIM       10
FLD60084  DIM       10
FLD60085  DIM       10
FLD60086  DIM       10
FLD60087  DIM       60
FLD60088  DIM       60
FLD60089  DIM       10
FLD60090  DIM       10
FLD60091  DIM       10
FLD60092  DIM       10
FLD60093  DIM       10
FLD60094  DIM       10
FLD60095  DIM       10
.
. ----- Program Variables -----
.
CDATEIS   DIM       8
CMDLINE   DIM       60
ERRDATA   DIM       40
ERRMESS   DIM       75
COLTXT    DIM       3
ERRCOUNT  FORM      5
ALLENCXX  FORM      5
ALLGPAXX  FORM      5
ALLGREXX  FORM      5
ALLGROXX  FORM      5
ALLITVXX  FORM      5
ALLREFXX  FORM      5
ALLRLNXX  FORM      5
ALLRSAXX  FORM      5
ALLSUPXX  FORM      5
INCOCATE  FORM      1                       * Catalogue Code Type
MEHDIAXX  FORM      5
MEHVI1XX  FORM      5
MEHHLSXX  FORM      5
MEHDLSXX  FORM      5
MEHHONXX  FORM      5
PATVISXX  FORM      5
PMSVX1XX  FORM      5
PATMI1XX  FORM      5
PATDSCXX  FORM      5
PATTRNXX  FORM      5
PATNOBXX  FORM      5
RECIN     FORM      5
ERRIN     FORM      5
.
.
DCC       FORM      2
XDD       FORM      2
DDD       FORM      2
DHH       FORM      2
DMM       FORM      2
DSS       FORM      2
DYY       FORM      2
DIM1A     DIM       1
DIM1B     DIM       1
DIM2A     DIM       2
DIM2B     DIM       2
DIM2C     DIM       2
DIM2D     DIM       2
DIM3A     DIM       3
DIM3B     DIM       3
DIM5A     DIM       5
DIM5B     DIM       5
DIM6A     DIM       6
DIM6B     DIM       6
DIM7A     DIM       7
DIM7B     DIM       7
DIM8A     DIM       8
DIM8B     DIM       8
DIM9A     DIM       9
DIM10A    DIM       10
DIM10B    DIM       10
DIM12A    DIM       12
DIM20A    DIM       20
DIM30A    DIM       20
DONE      FORM      1
ECLIDNO   FORM      2
ECATCAT   DIM       5
ECATCOD   DIM       7                                                   * 12/11
EHCPCAT   DIM       3
EHCPCOD   DIM       10
FLDNO     DIM       2   
FNAMESHT  DIM       20
FNAMEIN   DIM       60
FNAMHCPI  DIM       60
FNAMCATI  DIM       60
FNAMECLI  DIM       60
FLD60IN   DIM       60
FLD60OUT  DIM       60
FNO       FORM      1
..F8        FORM      8
F12       FORM      12
HEADDES1  DIM       35
HEADDES2  DIM       60
LENGTH    FORM      3 
LENIN     FORM      3 
LENOUT    FORM      3 
LCATERRS  FORM      3 
LHCPERRS  FORM      3 
MHCNUNIQ  FORM      8
OUTTYP    FORM      1 
PCATCAT   DIM       2
PCATCOD   DIM       10
TMPVISNO  FORM      8
TMPSESNO  FORM      8
TMPCONNO  FORM      8
RESADMNO  FORM      8
UNIQUEID  DIM       20
VALUES    DIM       10
VISITNO   FORM      8
SESSNNO   FORM      8
CONTRNO   FORM      8
XS1       DIM       1
XS2       DIM       1
MHLESTAT  DIM       1                       * dummy
MHLEDATE  DIM       1                       * dummy
MHCJSTAT  DIM       1                       * dummy
.
. ----- Program Constants -----
.
ECLIDLST  INIT      "EOC"                   * search list of Eclipse Record Ids
ECLIDL02  INIT      "HCE"
ECLIDL03  INIT      "CON"
ECLIDL04  INIT      "SES"
ECLIDL05  INIT      "GRP"
ECLIDL06  INIT      "GCT"
ECLIDL07  INIT      "INT"
ECLIDL08  INIT      "SUP"
ECLIDL09  INIT      "RES"
ECLIDL10  INIT      "DIA"
ECLIDL11  INIT      "HON"              * HoNOS                        *I-174535
ECLIDL12  INIT      "REF"              * Legal Stat. Referral         *I-174535
ECLIDL13  INIT      "LS "              * Legal Stat. Section          *I-174535
ECLIDCNT  INIT      "13"               * no. of Eclipse Record Id.s   *I-174535
.
JAN       INIT      "31"
FEB       INIT      "29"
MAR       INIT      "31"
APR       INIT      "30"
MAY       INIT      "31"
JUN       INIT      "30"
JUL       INIT      "31"
AUG       INIT      "31"
SEP       INIT      "30"
OCT       INIT      "31"
NOV       INIT      "30"
DEC       INIT      "31"
.
RET       INIT      015                          * carriage return
HCP       INIT      "HCP"
CTM       INIT      "CTM"
USR       INIT      "USR"
VALIDCDS  INIT      "ECLHCP ECLCTM ECLUSR"       * valid HCP/Team codes
.                                                * valid Cat/Codes codes
VALCAT01  INIT      "OUTC  PTY   S     SOR   BLCL  EOC02 EOC03 EOC04 EOC05 "
VALCAT02  INIT      "TPEOC EOC01 HCLRC REFRS HCE01 HCE02 HCE03 HCE04 HCE05 "
VALCAT03  INIT      "CANRF TPHCE CONTC PLACT TPCON PCUBF CON02 TPPRG USPRG "
VALCAT04  INIT      "PGLOC GCST  LOFCA RSATY PROGM "
VALCAT05  INIT      "LS    ARO   3A    COLST CULT  FOC   MHSS  MODE  HONOS "
VALCOD01  INIT      "OUTCT TREAT SUPPY HSREQ RSHOS "
ZERO4     INIT      "0000"
.
PRGNAM    INIT      "Upload Eclipse data to A/H"
PRGID     INIT      "ECLUPLOD"
VERSION   INIT      "V12.00.00"
+
.******************************************************************************
.*                                   ML0000                                   *
.*                                 Main Module                                *
.******************************************************************************
ML0000    CALL      INIT0000                * Initialise variables & open files
          BRANCH    EXIT,ML9000
.
ML1000    CALL      OPTN0000                * Select Option          
          BRANCH    EXIT,ML9000
.
          CALL      LTMP0000                * Create Temp files for Mapping 
          CALL      LHCP0000                * Load HCP Mapping table
          CALL      LCAT0000                * Load Cat.Code Mapping table
          BRANCH    EXIT,ML1000
.
ML3000    CALL      OPEN0000                * Open files
          BRANCH    EXIT,ML1000
.
ML5000    CALL      PINP0000                * Process the input file
          GOTO      ML1000
.
ML9000    CALL      KILL0000                * delete temp files
          CALL      ECLEID00                * remove "test" records
          MATCH     SP8,PGM
          GOTO      ML9999 IF EQUAL
.
          CHAIN     PGM                     * Chain back to appropriate menu
ML9999    SHUTDOWN  ""
+
.******************************************************************************
.*                                  INIT0000                                  *
.*                      Initialise Variables & Open Files                     *
.******************************************************************************
INIT0000  CALL      DISPHEAD                * Display screen header
.
          MOVE      "99",CLNO               * force Report Header if errors
          MOVE      SP3,FLDNO 
          MOVE      SP3,COLTXT
          PACK      FNAMEIN,SP30,SP30
          MOVE      FNAMEIN,FNAMHCPI
          MOVE      FNAMEIN,FNAMCATI
          MOVE      FNAMEIN,FNAMECLI
.
          MOVE      ZERO,TMPVISNO
          MOVE      ZERO,TMPSESNO
          MOVE      ZERO,TMPCONNO
.
          MOVE      ZERO,ALLENCXX
          MOVE      ZERO,ALLGPAXX
          MOVE      ZERO,ALLGREXX
          MOVE      ZERO,ALLGROXX
          MOVE      ZERO,ALLITVXX
          MOVE      ZERO,ALLREFXX
          MOVE      ZERO,ALLRLNXX
          MOVE      ZERO,ALLRSAXX
          MOVE      ZERO,ALLSUPXX
          MOVE      ZERO,MEHDIAXX
          MOVE      ZERO,MEHVI1XX
          MOVE      ZERO,MEHHLSXX
          MOVE      ZERO,MEHDLSXX
          MOVE      ZERO,MEHHONXX
          MOVE      ZERO,PATVISXX
          MOVE      ZERO,PMSVX1XX
          MOVE      ZERO,PATMI1XX
          MOVE      ZERO,PATDSCXX
          MOVE      ZERO,PATTRNXX
          MOVE      ZERO,PATNOBXX
.
          MOVE      ZERO,MHCNUNIQ
.
          DISPLAY   *P64:24,"controlf";
          OPEN      CONTROLF,"controlf"
.
          DISPLAY   *P64:24,"patcodes";
          OPEN      PATCODE1,"patcodes"     
.
          DISPLAY   *P64:24,"allcasaf";
          OPEN      ALLCASA1,"allcasaf"     
.
          DISPLAY   *P64:24,"alldepaf";
          OPEN      ALLDEPA1,"alldepaf"     
.
          DISPLAY   *P64:24,"allseraf";
          OPEN      ALLSERA1,"allseraf"     
.
          DISPLAY   *P64:24,"allincaf";
          OPEN      ALLINCA1,"allincaf"     
.
          DISPLAY   *P64:24,"patma1af";
          OPEN      PATMA1A1,"patma1af"     
          OPEN      PATMX1A1,"patmx1af"     
.
          DISPLAY   *P64:24,"patwr1af";
          OPEN      PATWR1A1,"patwr1af"     
.
          DISPLAY   *P64:24,"pmshcpaf";
          OPEN      PMSHCPA1,"pmshcpaf"     
.
          DISPLAY   *P64:24,"sinciaaf";
          OPEN      SINCIAA1,"sinciaaf"     
.
          DISPLAY   *P64:24,"websecaf";
          OPEN      WEBSECA1,"websecaf"     
.
          READ      CONTROLF,SIXTY3;*67,INCOCATE
.
INIT1000  CALL      ECLMEM00                * load/read ECLIPLOD memory table
          CALL      ECLEID00                * load Eclipse_Id table
.
INIT9000  MOVE      ZERO,EXIT
          GOTO      INIT9999
.
INIT9500  MOVE      ONE,EXIT
INIT9999  RETURN
+
.******************************************************************************
.*                                  OPTN0000                                  *
.*                         Select option to run upload                        *
.******************************************************************************
OPTN0000  MOVE      ZERO,EXIT
          MOVE      ZERO,FNO         
          DISPLAY   *P1:3,*EF:
                    *P1:4,*V2LON," 0",*HOFF," = Exit":
                    *P1:5,*V2LON," 1",*HOFF," = Verify Eclipse Data only":
                    *P1:6,*V2LON," 2",*HOFF," = Upload Eclipse Data":
                    *P1:8,"Select Option : ";
.
OPTN1000  KEYIN     *P17:8,*V2LON,*DV,UNDLN2,*P17:8,OPTION;
          COMPARE   ZERO,OPTION
          GOTO      OPTN9500 IF EQUAL
.
          BRANCH    OPTION,OPTN5000,OPTN5000
          GOTO      OPTN1000 IF NOT EQUAL
.
.
OPTN5000  DISPLAY   *P8:10,"Enter Path and File Name for the following :":
                    *P33:10,"(eg.   /mnt/tmp/hcpmap01.txt   )    ":
                    *P8:11,"for the following :":
                    *P5:13,"HCP/Case team/User Mapping file - ":
                    *P5:14,FNAMHCPI:
                    *P5:16,"Cat/Code Mapping file -":
                    *P5:17,FNAMCATI:
                    *P5:19,"Eclipse data file -":
                    *P5:20,FNAMECLI;
          MOVE      FNAMHCPI,FNAMEIN
          MOVE      ONE,FNO
          MOVE      "14",CVERT
          CALL      KASCI000                * keyin first file name
          BRANCH    EXIT,OPTN0000
          MOVE      FNAMEIN,FNAMHCPI
.
          DISPLAY   *P33:10,"(eg.   /mnt/tmp/codmap01.txt   )   ";
          MOVE      FNAMCATI,FNAMEIN
          MOVE      TWO,FNO
          MOVE      "17",CVERT
          CALL      KASCI000                * keyin first file name
          BRANCH    EXIT,OPTN0000
          MOVE      FNAMEIN,FNAMCATI
.
.
          DISPLAY   *P33:10,"(eg.   /mnt/tmp/eclup001.txt   )   ";
          MOVE      FNAMECLI,FNAMEIN
          MOVE      THREE,FNO
          MOVE      "20",CVERT
          CALL      KASCI000                * keyin first file name
          BRANCH    EXIT,OPTN0000
          MOVE      FNAMEIN,FNAMECLI
.
          CALL      CHKMEM00                * check if file has been processed
          BRANCH    EXIT,OPTN0000           * if file has been processed
.
          CALL      CONTQST                 * Ok to Continue (Y/N/C) ?
          BRANCH    CEXIT,OPTN9000,OPTN0000,OPTN9500
.
OPTN9000  MOVE      ZERO,EXIT
          CALL      UPDMEM00                * save file names in Memory table
          GOTO      OPTN9999
.
OPTN9500  MOVE      ONE,EXIT
OPTN9999  RETURN
+
.******************************************************************************
.*                                 KASCI000                                   *
.*                            Keyin ASCI file                                 *
.* Returns: EXIT  0 = no file name entered                                    *
.*                1 = valid filename entered                                  *
.******************************************************************************
KASCI000  KEYIN     *P5:CVERT,*V2LON,*EL,*RV,FNAMEIN;
.
          PACK      FNAMEIN,FNAMEIN,SP20,SP20,SP20
.
          MATCH     SP70,FNAMEIN            * anything entered ?
          GOTO      KASCI950 IF EQUAL       * no
          CMATCH    "\",FNAMEIN             * "\" entered ?
          GOTO      KASCI950 IF EQUAL       * no
.
          SCAN      "/",FNAMEIN
          IF        @EQUAL
            SCAN      ".txt",FNAMEIN
            IF        !@EQUAL
              SQUEEZE   FNAMEIN
              ENDSET    FNAMEIN
              APPEND    ".txt",FNAMEIN      * add ".txt" if there is a path
              RESET     FNAMEIN
              DISPLAY   *P5:CVERT,*V2LON,*EL,FNAMEIN;
            ENDIF
          ELSE   
            RESET     FNAMEIN
            SCAN      ".txt",FNAMEIN
            GOTO      KASCI100 IF NOT EQUAL
            BUMP      FNAMEIN,-1            * remove ".txt" if just a file name
            APPEND    SP20,FNAMEIN
            RESET     FNAMEIN
            DISPLAY   *P5:CVERT,*V2LON,*EL,FNAMEIN;
          ENDIF
.
.                                           * get the 8 char file name
KASCI100  RESET     FNAMEIN
          MOVE      ZERO,DONE
          MOVE      FNAMEIN,FNAMESHT        * in case there is no path
          REPEAT
            SCAN      "/",FNAMEIN
            IF        @EQUAL
              BUMP      FNAMEIN
              PACK      FNAMESHT,FNAMEIN,SP20
            ELSE
              MOVE      ONE,DONE
            ENDIF
          UNTIL       DONE = 1
.
          RESET     FNAMEIN
.
          SQUEEZE   FNAMESHT
          SCAN      ".txt",FNAMESHT
          GOTO      KASCI200 IF NOT EQUAL
          BUMP      FNAMESHT,-1             * remove ".txt" if just a file name
          APPEND    SP20,FNAMESHT
.
KASCI200  RESET     FNAMESHT
          SQUEEZE   FNAMESHT
          MOVELPTR  FNAMESHT,LENGTH
          COMPARE   "9",LENGTH
          GOTO      KASCI500 IF LESS
          DISPLAY   *P1:23,*EL,"File name must not be more than 8 characters":
                    *P1:24,*EL," ";
          CALL      HITENTER
          DISPLAY   *P1:23,*EF
          GOTO      KASCI0000
.
.                                           * see if file exists
KASCI500  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      INTEST01,FNAMEIN        * open file
          TRAPCLR   IO
.
          IF        OVRCD = 0
            DISPLAY   *P68:CVERT,*HOFF,"file found";
          ELSE
            DISPLAY   *P1:24,*EL,*B,"File not found.  ";
            CALL      HITENTER
            GOTO      KASCI0000
          ENDIF
.
KASCI900  MOVE      ZERO,EXIT
          GOTO      KASCI999
.
KASCI950  MOVE      ONE,EXIT
.
KASCI999  RETURN
+
.******************************************************************************
.*                                  ECLMEM00              Called by: INIT0000 *
.*                   Load/read the ECLUPLOD memory file                       *
.******************************************************************************
ECLMEM00  MOVE      ZERO,EXIT
.                                           * open Eclipse upload memory table
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      TEMPMEM1,"tmeclmem"
          TRAPCLR   IO
.
.                                           * if file doesnt exist, build it
          IF        OVRCD = 1
            CLEAR     CMDLINE
            APPEND    "isbuild ",CMDLINE
            APPEND    TMPMEM1,CMDLINE
            RESET     CMDLINE
            EXECUTE   CMDLINE,TASKID
            OPEN      TEMPMEM1,"tmeclmem"
            GOTO      ECLMEM99
          ENDIF
.
ECLMEM20  MOVE      "001",DIM3A             * read "HCP" file name
          PACK      KEY11,DIM3A,SP20
          CALL      RDTMEM1
          BRANCH    OVRCD,ECLMEM30
          MOVE      MEMPATFN,FNAMHCPI
.
ECLMEM30  MOVE      "002",DIM3A             * read "CAT" file name
          PACK      KEY11,DIM3A,SP20
          CALL      RDTMEM1
          BRANCH    OVRCD,ECLMEM40
          MOVE      MEMPATFN,FNAMCATI
.
ECLMEM40  MOVE      "003",DIM3A             * read through "ECL" file names
          PACK      KEY11,DIM3A,SP20
          CALL      RSTMEM1
ECLMEM41  CALL      RKTMEM1
          BRANCH    OVRCD,ECLMEM50
.
          MATCH     "P",MEMSTAT
          GOTO      ECLMEM41 IF EQUAL
.
          MOVE      MEMPATFN,FNAMECLI
          GOTO      ECLMEM99
.
ECLMEM50  MOVE      ZERO,EXIT
.
.
ECLMEM99  RETURN
+
.******************************************************************************
.*                                  ECLEID00              Called by: INIT0000 *
.*                   Load/open the ECLUPLOD Eclipse_id table                  *
.******************************************************************************
ECLEID00  MOVE      ZERO,EXIT
.                                           * open Eclipse upload memory table
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      TEMPEID1,"tmecleid"
          TRAPCLR   IO
.
.                                           * if file doesn't exist, build it
          IF        OVRCD = 1
            CLEAR     CMDLINE
            APPEND    "isbuild ",CMDLINE
            APPEND    TMPEID1,CMDLINE
            RESET     CMDLINE
            EXECUTE   CMDLINE,TASKID
            OPEN      TEMPEID1,"tmecleid"
            GOTO      ECLEID99
          ENDIF
.
ECLEID50  PACK      KEY23,SP30
.
ECLEID51  CALL      RSTMEID1
.
ECLEID52  CALL      RKTMEID1
          BRANCH    OVRCD,ECLEID99
.
          MATCH     "T",EIDTEST
          GOTO      ECLEID52 IF NOT EQUAL
.
.                                           * delete all old "Test" records
          PACK      KEY23,EIDIDCOD,EIDIDNO,SP30
          CALL      DETMEID1
          GOTO      ECLEID51
.
ECLEID99  RETURN
+
.******************************************************************************
.*                                  CHKMEM00              Called by: INIT0000 *
.*                Check if Eclipse data file has been processed               *
.******************************************************************************
CHKMEM00  MOVE      ZERO,EXIT
.                                           * read Eclipse upload memory table
          MOVE      "003",DIM3A
          PACK      KEY11,DIM3A,FNAMESHT
          CALL      RDTMEM1
          BRANCH    OVRCD,CHKMEM50
.
          MATCH     "P",MEMSTAT
          GOTO      CHKMEM50 IF NOT EQUAL
.
          MOVE      FNAMESHT,DIM8A
          DISPLAY   *P1:23,*EL,"Eclipse data file '",DIM8A,"' has already ":
                          "been processed - DO NOT CONTINUE ",*P1:24," ";
          CALL      HITENTERR
          MOVE      ONE,EXIT
          GOTO      CHKMEM99
.
CHKMEM50
.
CHKMEM99  RETURN
+
.******************************************************************************
.*                                  UPDMEM00              Called by: INIT0000 *
.*                Update Memory table with latest file names                  *
.******************************************************************************
UPDMEM00  MOVE      ZERO,EXIT
.
UPDMEM10  MOVE      "001",DIM3A             * read "HCP" file name
          PACK      KEY11,DIM3A,SP20
          CALL      RDTMEM1
          IF        OVRCD = 1
            MOVE      DIM3A,MEMCODE
            MOVE      SP8,MEMFNAME
            PACK      MEMPATFN,FNAMHCPI,SP70
            UNPACK    SP70,MEMSTAT,MEMSPAR
            CALL      WRTMEM1
          ELSE
            PACK      MEMPATFN,FNAMHCPI,SP70
            CALL      UPTMEM1
          ENDIF
.
UPDMEM20  MOVE      "002",DIM3A             * read "CAT" file name
          PACK      KEY11,DIM3A,SP20
          CALL      RDTMEM1
          IF        OVRCD = 1
            MOVE      DIM3A,MEMCODE
            MOVE      SP8,MEMFNAME
            PACK      MEMPATFN,FNAMCATI,SP70
            UNPACK    SP70,MEMSTAT,MEMSPAR
            CALL      WRTMEM1
          ELSE
            PACK      MEMPATFN,FNAMCATI,SP70
            CALL      UPTMEM1
          ENDIF
.
UPDMEM30  MOVE      "003",DIM3A             * read "ECL" file name
          PACK      KEY11,DIM3A,FNAMESHT,SP20
          CALL      RDTMEM1
          IF        OVRCD = 1
            MOVE      DIM3A,MEMCODE
            PACK      MEMFNAME,FNAMESHT,SP10
            PACK      MEMPATFN,FNAMECLI,SP70
            UNPACK    SP70,MEMSTAT,MEMSPAR
            IF        OPTION = 2
              MOVE      "P",MEMSTAT
            ENDIF
            CALL      WRTMEM1
          ELSE
            PACK      MEMPATFN,FNAMECLI,SP70
            IF        OPTION = 2
              MOVE      "P",MEMSTAT
            ENDIF
            CALL      UPTMEM1
          ENDIF
.      
UPDMEM99  RETURN
.******************************************************************************
.*                                  LTMP0000              Called by: ML0000   *
.*                   Create Temp Files for Mapping Tables                     *
.******************************************************************************
LTMP0000  MOVE      ZERO,EXIT
          CALL      KILL0000
          CLEAR     CMDLINE
          APPEND    "isbuild ",CMDLINE
          APPEND    TMPDEF1,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
          OPEN      TEMPHCP1,"tmphcpmp"
.
          CLEAR     CMDLINE
          APPEND    "isbuild ",CMDLINE
          APPEND    TMPDEF2,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
          OPEN      TEMPCAT1,"tmpcatmp"
.
          CALL      CLER0000                * empty both files if Oracle
.
LTMP9999  RETURN
+
.******************************************************************************
.*                             KILL0000                  Called by:           *
.*                   erase temporary file                                     *
.******************************************************************************
KILL0000  CLOSE     TEMPHCP1
          CLEAR     CMDLINE
          APPEND    "iserase ",CMDLINE
          APPEND    "tmphcpmp",CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CLOSE     TEMPCAT1
          CLEAR     CMDLINE
          APPEND    "iserase ",CMDLINE
          APPEND    "tmpcatmp",CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
KILL9999  RETURN
+
.******************************************************************************
.*                             CLER0000                 Called by:            *
.*               close and erase the temporary file                           *
.******************************************************************************
.
CLER0000  PACK      KEY13,SP20
          CALL      RSTHCP1
          CALL      RKTHCP1
          BRANCH    OVRCD,CLER1000
.
          PACK      KEY13,HCPCODE,HCPECLCD
          CALL      DETHCP1
.
          GOTO      CLER0000
.
CLER1000  PACK      KEY12,SP20
          CALL      RSTCAT1
          CALL      RKTCAT1
          BRANCH    OVRCD,CLER9999
.
          PACK      KEY12,CATECAT,CATECODE
          CALL      DETCAT1
.
          GOTO      CLER0000
.
CLER9999  RETURN
+
.******************************************************************************
.*                                  LHCP0000              Called by: ML0000   *
.*                   Load HCP/Case Team/User Mapping Table                    *
.******************************************************************************
LHCP0000  MOVE      ZERO,EXIT
          MOVE      ZERO,ERRCOUNT
          MOVE      ZERO,RECIN
          MOVE      "99",CLNO               * force Report Header if errors
          MOVE      "HCP/Case Team/User Mapping data",HEADDES1
          PACK      HEADDES2,SP70
.
.                                           * open Eclipse HCP mapping input
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      INHCPTXT,FNAMHCPI       * open file
          TRAPCLR   IO
.
          IF        OVRCD = 1
            DISPLAY   *P1:24,*EL,*B,"HCP Mapping file is missing  ";
            CALL      HITENTER
            MOVE      ONE,EXIT
            GOTO      LHCP9999
          ENDIF
.
.                                           * read HCP/Team Mapping text record
LHCP1000  READ      INHCPTXT,SEQ;FLD10001,FLD10002,FLD10003,FLD10004
          GOTO      LHCP9900 IF OVER        * end of file
.
          ADD       ONE,RECIN
.
          PACK      DIM6A,FLD10001,SP10     * reformat input fields
          PACK      DIM10A,FLD10002,SP10
          PACK      DIM6B,FLD10003,SP10
          PACK      DIM10B,FLD10004,SP10
          PACK      ERRDATA,FLD10001,SP1,FLD10002,SP1,FLD10003,SP1:
                            FLD10004,SP70
.
          MATCH     SP10,DIM10B             * is webPAS value blank?
          IF        @EQUAL
            PACK      DIM10A,FLD10002,SP10  * yes - use Eclipse value
          ENDIF
.
          RESET     VALIDCDS
          SCAN      DIM6A,VALIDCDS          * one of "ECLHCP ECLCTM ECLUSR"
          GOTO      LHCP9000 IF NOT EQUAL
.
          UNPACK    DIM6A,DIM3B,DIM3A
          MATCH     SP10,DIM10A
          GOTO      LHCP9001 IF EQUAL
.
.
LHCP2000  MATCH     SP10,DIM10B             * is PAS code blank?
          GOTO      LHCP5000 IF EQUAL
.
          MATCH     "ELCHCP",DIM6A
          IF        @EQUAL
            PACK      KEY10,DIM10B,SP10
            CALL      RDPMHCP1
            COMPARE   ZERO,OVRCD
            GOTO      LHCP5000 IF EQUAL     * valid HCP code
            CLEAR     ERRMESS
            APPEND    "HCP code '",ERRMESS
            SQUEEZE   DIM10B
            APPEND    DIM10B,ERRMESS
            APPEND    "' not valid in webPAS (pmshcpaf)",ERRMESS
            CALL      PRNT0000
            GOTO      LHCP5000              * or LHCP1000 to bypass it
          ENDIF
.
          MATCH     "ELCCTM",DIM6A
          IF        @EQUAL
            PACK      KEY10,DIM10B,SP10
            CALL      RDALCAS1
            COMPARE   ZERO,OVRCD
            GOTO      LHCP5000 IF EQUAL     * valid Caseteam code
            CLEAR     ERRMESS
            APPEND    "Caseteam code '",ERRMESS
            SQUEEZE   DIM10B
            APPEND    DIM10B,ERRMESS
            APPEND    "' not valid in webPAS (allcasaf)",ERRMESS
            CALL      PRNT0000
            GOTO      LHCP5000              * or LHCP1000 to bypass it
          ENDIF
.
          MATCH     "ELCUSR",DIM6A
          IF        @EQUAL
            PACK      KEY10,DIM10B,SP10
            CALL      RDWBSE1 
            COMPARE   ZERO,OVRCD
            GOTO      LHCP5000 IF EQUAL     * valid HCP code
            CLEAR     ERRMESS
            APPEND    "User code '",ERRMESS
            SQUEEZE   DIM10B
            APPEND    DIM10B,ERRMESS
            APPEND    "' not valid in webPAS (websecaf)",ERRMESS
            CALL      PRNT0000
            GOTO      LHCP5000              * or LHCP1000 to bypass it
          ENDIF
.
.                                           * load data to Temp file
LHCP5000  PACK      KEY13,DIM3A,DIM10A,SP20
          CALL      RDTHCP1
          COMPARE   ZERO,OVRCD
          GOTO      LHCP9002 IF EQUAL
.
          MOVE      DIM3A,HCPCODE
          MOVE      DIM10A,HCPECLCD
          MOVE      DIM10B,HCPIBACD
          PACK      HCPSPAR,SP20
          CALL      WRTHCP1
          GOTO      LHCP1000
.
.                                           * error messages
LHCP9000  CLEAR     ERRMESS
          APPEND    DIM6A,ERRMESS
          APPEND    " Invalid Eclipse Mapping Type",ERRMESS
          GOTO      LHCP9009
.
LHCP9001  CLEAR     ERRMESS
          APPEND    "Eclipse ",ERRMESS
          APPEND    DIM3A,ERRMESS
          APPEND    " Id is blank",ERRMESS
          GOTO      LHCP9009
.
LHCP9002  CLEAR     ERRMESS
          APPEND    "Eclipse ",ERRMESS
          APPEND    DIM3A,ERRMESS
          APPEND    " Id is a duplicate",ERRMESS
          GOTO      LHCP9009
.
LHCP9009  CALL      PRNT0000
          GOTO      LHCP1000
.         
.
LHCP9900  MOVE      ERRCOUNT,LHCPERRS
          CLEAR     ERRMESS
          MOVE      LHCPERRS,DIM10A
          APPEND    DIM10A,ERRMESS
          APPEND    " Errors detected",ERRMESS
          CALL      PRLN0000  
.
LHCP9999  RETURN
+
.******************************************************************************
.*                                  LCAT0000              Called by: ML0000   *
.*                     Load Category Codes Mapping Table                      *
.******************************************************************************
LCAT0000  MOVE      ZERO,EXIT
          MOVE      ZERO,RECIN
          MOVE      ZERO,ERRCOUNT
          MOVE      "99",CLNO               * force Report Header if errors
          MOVE      "Category Codes Mapping data",HEADDES1
.                                           * open Eclipse Category mapping 
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      INCATTXT,FNAMCATI       * open file
          TRAPCLR   IO
.
          IF        OVRCD = 1
            DISPLAY   *P1:24,*EL,*B,"Category/Code Mapping file was not found";
            CALL      HITENTER
            MOVE      ONE,EXIT
            GOTO      LCAT9900
          ENDIF
.
.                                           * read Cat/Codes Mapping text record
LCAT1000  READ      INCATTXT,SEQ;FLD10001,FLD10002,FLD10003,FLD10004
          GOTO      LCAT9900 IF OVER        * end of file
.
          ADD       ONE,RECIN
.
          PACK      DIM5A,FLD10001,SP10     * reformat input text data
          PACK      DIM7B,FLD10002,SP10
          PACK      DIM2A,FLD10003,SP10
          PACK      DIM10A,FLD10004,SP10
          PACK      ERRDATA,FLD10001,SP1,FLD10002,SP1,FLD10003,SP1:
                            FLD10004,SP70
.
.                                           * validate Elcipse Categories
          RESET     VALCAT01
          SCAN      DIM5A,VALCAT01          * Cat/Codes
          GOTO      LCAT2000 IF EQUAL
          RESET     VALCAT02
          SCAN      DIM5A,VALCAT02
          GOTO      LCAT2000 IF EQUAL
          RESET     VALCAT03
          SCAN      DIM5A,VALCAT03
          GOTO      LCAT2000 IF EQUAL
          RESET     VALCAT04
          SCAN      DIM5A,VALCAT04
          GOTO      LCAT2000 IF EQUAL
          RESET     VALCAT05                                          *I-174535
          SCAN      DIM5A,VALCAT05          * Legal Status & HoNOS    *I-174535
          GOTO      LCAT2000 IF EQUAL                                 *I-174535
          RESET     VALCOD01
          SCAN      DIM5A,VALCOD01          * Codes only
          GOTO      LCAT4000 IF EQUAL
          GOTO      LCAT9000                * there must be an error
.
LCAT2000  MATCH     SP5,DIM7B               * check Field 2 for blank
          IF        @EQUAL
.                                                  * codes with blank allowed
            MOVE      "BLCL  RSHOS RSATY HONOD ",DIM20A               *C-174535
            SCAN      DIM5A,DIM20A
            GOTO      LCAT3000 IF EQUAL
            GOTO      LCAT9001
          ENDIF
.
.                                           * check PAS Cat/Codes exist
          PACK      KEY5,DIM2A,SP3   
          CALL      RDCODE1
          BRANCH    OVRCD,LCAT9002          * Category does not exist
          MATCH     SP3,DIM10A                     ???
          IF        @EQUAL
            PACK      DIM10A,DIM7B,SP10
            GOTO      LCAT5000              * blank Codes are allowed
          ENDIF
.
	  PACK      KEY5,DIM2A,DIM10A
          CALL      RDCODE1
          BRANCH    OVRCD,LCAT9003          * Cat/Code does not exist
.
          GOTO      LCAT5000                * valid code - write it to table
.
.
LCAT3000  MOVE      SP5,DIM7B               * blank Eclipse code field
          MATCH     "BLCL ",DIM5A
          IF        @EQUAL
            MOVE      "CL",DIM2A   
            MATCH     SP10,DIM10A
            IF        @EQUAL
              MOVE      "E  ",DIM10A    
            ENDIF
            GOTO      LCAT5000
          ENDIF
.
          MATCH     "RSHOS",DIM5A
          IF        @EQUAL
            MOVE      "  ",DIM2A
            MATCH     SP10,DIM10A
            IF        @EQUAL
              MOVE      "COM",DIM10A  
            ENDIF
            GOTO      LCAT5000
          ENDIF
.
          MATCH     "RSATY",DIM5A
          IF        @EQUAL
            MOVE      "A ",DIM2A
            MATCH     SP10,DIM10A
            IF        @EQUAL
              MOVE      "IM ",DIM10A  
            ENDIF
            GOTO      LCAT5000
          ENDIF
          GOTO      LCAT1000
.
.
LCAT4000  MATCH     SP10,DIM10A
          IF        @EQUAL
            PACK      DIM10A,FLD10003,SP20   * re-load fld.4 from fld.3
            MOVE      SP2,DIM2A
          ENDIF
.
          MATCH     "OUTCT",DIM5A
          IF        @EQUAL
            PACK      KEY8,SP10
            CALL      RSALSER1
LCAT4010    CALL      RKALSER1
            BRANCH    OVRCD,LCAT4020
            MATCH     ALSRSERV,DIM10A
            GOTO      LCAT5000 IF EQUAL
            GOTO      LCAT4010
.
LCAT4020    CLEAR     ERRMESS
            MOVE      DIM10A,DIM6A
            APPEND    "AH Service code '",ERRMESS
            APPEND    DIM6A,ERRMESS
            APPEND    "' not valid in webPAS (allseraf)",ERRMESS
            CALL      PRNT0000
            GOTO      LCAT5000
          ENDIF
.
LCAT4100  MATCH     "S    ",DIM5A
          IF        @EQUAL
            PACK      KEY3,DIM10A
            CALL      RDALDEP1
            BRANCH    OVRCD,LCAT4120
            GOTO      LCAT5000
.
LCAT4120    CLEAR     ERRMESS
            MOVE      DIM10A,DIM3A
            APPEND    "AH Department code '",ERRMESS
            APPEND    DIM3A,ERRMESS
            APPEND    "' not valid in webPAS (alldepaf)",ERRMESS
            CALL      PRNT0000
            GOTO      LCAT5000
          ENDIF
.
LCAT4200  MATCH     "TREAT",DIM5A
          IF        @EQUAL
            PACK      KEY12,SP20
            CALL      RSALINC1
LCAT4210    CALL      RKALINC1
            BRANCH    OVRCD,LCAT4220
            MATCH     ALINCODE,DIM10A
            GOTO      LCAT5000 IF EQUAL
            GOTO      LCAT4210
.
LCAT4220    CLEAR     ERRMESS
            MOVE      DIM10A,DIM9A
            APPEND    "AH Intervention code '",ERRMESS
            APPEND    DIM9A,ERRMESS
            APPEND    "' not valid in webPAS (allincaf)",ERRMESS
            CALL      PRNT0000
            GOTO      LCAT5000
          ENDIF
.
LCAT4300  MATCH     "SUPPY",DIM5A
          IF        @EQUAL
            COMPARE   ZERO,INCOCATE         * 0=Alpha left-justified
            IF        @EQUAL
              SQUEEZE   DIM10A
              PACK      DIM7A,DIM10A,SP10
            ELSE                            * 1=Numeric right-just no lead zeros
              MOVE      DIM10A,FLD60IN
              MOVE      "7",LENGTH
              CALL      RJUS0000            * right justify Catalogue No.
              MOVE      FLD60OUT,DIM7A
              TYPE      DIM7A
              GOTO      LCAT4340 IF NOT EQUAL
              MOVE      DIM7A,F7
              MOVE      F7,DIM7A
            ENDIF
....        PACK      DIM10A,DIM7A,SP10     * re-align output field
            PACK      KEY7,DIM7A,SP10
            CALL      RDSIIA1               * SIIACAT DIM 7
            BRANCH    OVRCD,LCAT4320
            GOTO      LCAT5000
.
LCAT4320    CLEAR     ERRMESS
            APPEND    "Supply Item code '",ERRMESS
            APPEND    DIM7A,ERRMESS
            APPEND    "' not valid in webPAS (sinciaaf)",ERRMESS
            CALL      PRNT0000
            GOTO      LCAT5000
.
LCAT4340    CLEAR     ERRMESS
            APPEND    "Supply Item code '",ERRMESS
            APPEND    DIM7A,ERRMESS
            APPEND    "' must be numeric (see Supply parameters)",ERRMESS
            CALL      PRNT0000
            GOTO      LCAT5000
          ENDIF
.
LCAT4400  MATCH     "HSREQ",DIM5A
          IF        @EQUAL
            PACK      KEY6,DIM10A,SP10
            CALL      RDWARD1
            BRANCH    OVRCD,LCAT4420
            GOTO      LCAT5000
.
LCAT4420    CLEAR     ERRMESS
            MOVE      DIM10A,DIM3A
            APPEND    "Ward code '",ERRMESS
            APPEND    DIM3A,ERRMESS
            APPEND    "' not valid in webPAS (patwr1af)",ERRMESS
            CALL      PRNT0000
            GOTO      LCAT5000
          ENDIF
.
.
.                                           * load data to Temp file
LCAT5000  PACK      KEY12,DIM5A,DIM7B,SP20
          CALL      RDTCAT1
          COMPARE   ZERO,OVRCD
          GOTO      LHCP9002 IF EQUAL
.
          MOVE      DIM5A,CATECAT
          MOVE      DIM7B,CATECODE
          MOVE      DIM2A,CATPCAT
          MOVE      DIM10A,CATPCODE
          PACK      CATSPAR,SP20
          CALL      WRTCAT1
          GOTO      LCAT1000
.
.
LCAT9000  CLEAR     ERRMESS
          APPEND    "Eclipse Category ",ERRMESS
          APPEND    DIM5A,ERRMESS
          APPEND    " is not valid",ERRMESS
          GOTO      LCAT9009
.
LCAT9001  CLEAR     ERRMESS
          APPEND    "Eclipse Cat.Code must not be blank",ERRMESS
          GOTO      LCAT9009
.
LCAT9002  CLEAR     ERRMESS
          APPEND    "webPAS Category does not exist",ERRMESS
          GOTO      LCAT5000                * accept it any way
...       GOTO      LCAT9009
.
LCAT9003  CLEAR     ERRMESS
          APPEND    "webPAS Category/Code does not exist",ERRMESS
          GOTO      LCAT5000                * accept it any way
...       GOTO      LCAT9009
.
.
LCAT9009  CALL      PRNT0000
          GOTO      LCAT1000
.
LCAT9900  MOVE      ERRCOUNT,LCATERRS
          CLEAR     ERRMESS
          MOVE      LCATERRS,DIM10A
          APPEND    DIM10A,ERRMESS
          APPEND    " Errors detected",ERRMESS
          CALL      PRLN0000  
.
          IF        LCATERRS = 0 & LHCPERRS = 0
            GOTO      LCAT9999
          ENDIF
          IF        LHCPERRS > 0
            MOVE      "Errors in HCP/Caseteam/User Mapping Table",ERRMESS
          ENDIF
          IF        LCATERRS > 0
            MOVE      "Errors in Category/Codes Mapping Table   ",ERRMESS
          ENDIF
          IF        LCATERRS > 0 & LHCPERRS > 0
            MOVE      "Errors in both Mapping Tables            ",ERRMESS
          ENDIF
.
          RESET     ERRMESS
          DISPLAY   *P1:23,ERRMESS
.
          CALL      CONTQST                 * Ok to Continue (Y/N/C) ?
          BRANCH    CEXIT,LCAT9999
          MOVE      ONE,EXIT
          
LCAT9999  RETURN
+
.******************************************************************************
.*                                  OPEN0000              Called by: ML0000   *
.*                                 Open Files                                 *
.******************************************************************************
OPEN0000  MOVE      ZERO,EXIT
.                                           * open Eclipse upload text file 
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      INECLTXT,FNAMECLI       * open file
          TRAPCLR   IO
.
          IF        OVRCD = 1
            DISPLAY   *P1:24,*EL,*B,"Eclipse upload file is missing  ";
            CALL      HITENTER
            MOVE      ONE,EXIT
            GOTO      OPEN9999
          ENDIF
.
. ----------------------------------------- * open IBA files -------------
.
          DISPLAY   *P64:24,"alldepaf";
          OPEN      ALLDEPA1,"alldepaf"     
.
          DISPLAY   *P64:24,"allencaf";
          OPEN      ALLENCA1,"allencaf"     
.
          DISPLAY   *P64:24,"allgroaf";
          OPEN      ALLGROA1,"allgroaf"     
.
          DISPLAY   *P64:24,"allgreaf";
          OPEN      ALLGREA1,"allgreaf"     
.
          DISPLAY   *P64:24,"allgpaaf";
          OPEN      ALLGPAA1,"allgpaaf"     
.
          DISPLAY   *P64:24,"allitvaf";
          OPEN      ALLITVA1,"allitvaf"     
.
          DISPLAY   *P64:24,"allrefaf";
          OPEN      ALLREFA1,"allrefaf"     
.
          DISPLAY   *P64:24,"allrlnaf";
          OPEN      ALLRLNA1,"allrlnaf"     
.
          DISPLAY   *P64:24,"allrsaaf";
          OPEN      ALLRSAA1,"allrsaaf"     
.
          DISPLAY   *P64:24,"allsupaf";
          OPEN      ALLSUPA1,"allsupaf"     
.
          DISPLAY   *P64:24,"mehdiaaf";
          OPEN      MEHDIAA1,"mehdiaaf"     
.
          DISPLAY   *P64:24,"mehvi1af";
          OPEN      MEHVI1A1,"mehvi1af"     
.
          DISPLAY   *P64:24,"mehhlsaf";
          OPEN      MEHHLSA1,"mehhlsaf"     
.
          DISPLAY   *P64:24,"mehdlsaf";
          OPEN      MEHDLSA1,"mehdlsaf"     
.
          DISPLAY   *P64:24,"mehhonaf";
          OPEN      MEHHONA1,"mehhonaf"     
.
          DISPLAY   *P64:24,"patma1af";
          OPEN      PATMA1A1,"patma1af"     
.
          DISPLAY   *P64:24,"patvisaf";
          OPEN      PATVISA1,"patvisaf"     
.
          DISPLAY   *P64:24,"pmsvx1af";
          OPEN      PMSVX1A1,"pmsvx1af"     
.
          DISPLAY   *P64:24,"patmi1af";
          OPEN      PATMI1A1,"patmi1af"     
.
          DISPLAY   *P64:24,"patdschf";
          OPEN      PATDSCH1,"patdschf"     
.
          DISPLAY   *P64:24,"pattranf";
          OPEN      PATTRAN1,"pattranf"     
.
          DISPLAY   *P64:24,"patnobef";
          OPEN      PATNOBE1,"patnobef"
.
.
OPEN9999  RETURN
.******************************************************************************
.*                                  PINP0000                                  *
.*                         Process The Input Text File                        *
.******************************************************************************
PINP0000  MOVE      ZERO,ERRCOUNT
          MOVE      ZERO,RECIN
          MOVE      ZERO,ERRIN    
          MOVE      ONE,OUTTYP
          MOVE      "Fld",COLTXT
          MOVE      "99",CLNO               * force Report Header if errors
          MOVE      "Eclipse upload data",HEADDES1
          PACK      HEADDES2,FNAMECLI
.
          IF        OPTION = 2
            CALL      ECLEID00              * clean up (remove) "test" records
          ENDIF
.
          CALL      IBACLOCK
          PACK      CDATEIS,CCC,CYY,CMM,CDD
          REP       " 0",CDATEIS
          DISPLAY   *P1:10,*EF:
                    *P1:10,"Processing ",*V2LON,FNAMECLI,*HOFF:
                    *P1:12,"Started  : ",*V2LON,CTIMEIS,*HOFF:
                    *P1:14,"Records read : ";
.
. ----- Read the input data file into temporary variables -----
.
PINP1000  READ      INECLTXT,SEQ;ECLRECID;  * read Eclipse record id
          GOTO      PINP9000 IF OVER        * end of file
.
          ADD       ONE,RECIN
          MOVE      ZERO,ECLIDNO            * identify the eclipse record id.
          MOVE      "  ",FLDNO
.                     
          MOVE      ECLIDCNT,F2             * number of Record Id.s
          SEARCH    ECLRECID,ECLIDLST,F2,ECLIDNO
          IF        ECLIDNO = 0 | ECLIDNO > F2        
            GOTO      PINP8000              * unknown record id. 
          ENDIF
.
.                                           * process the specific record id.
PINP2000  PERFORM   ECLIDNO,PEOC0000,PHCE0000,PCON0000,PSES0000,PGRP0000:
                            PGCT0000,PINT0000,PSUP0000,PRES0000,PDIA0000:
                            PHON0000,PREF0000,PLLS0000                *I-174535
.
          PACK      KEY20,ECLRECID,SP1,UNIQUEID
          IF        (RECIN%20)=0
            DISPLAY   *P16:14,RECIN,*P35:14,*V2LON,KEY20;
          ENDIF
.
          GOTO      PINP1000
.
.
PINP8000  UNPACK    SP70,FLD10001,FLD10002,FLD10003,FLD10004   * clear record
          READ      INECLTXT,SEQ;FLD10001,FLD10002,FLD10003,FLD10004 
.
          PACK      ERRDATA,ECLRECID,SP1,FLD10001,SP1,FLD10002,SP1:
                            FLD10003,SP1,FLD10004,SP70
.
          CLEAR     ERRMESS
          APPEND    "Unknown Record Id. '",ERRMESS
          SQUEEZE   ECLRECID
          APPEND    ECLRECID,ERRMESS
          APPEND    "'            - record bypassed *****",ERRMESS
          ADD       ONE,ERRIN
          CALL      PRNT0000
          GOTO      PINP1000;
.
. ----- Finished -----
.
PINP9000  CALL      IBACLOCK
          DISPLAY   *P1:14,*EF:
                    *P1:14,"Total records read                     : ",RECIN:
                    *P1:15,"      Records not processed (bypassed) : ",ERRIN:
                    *P1:16,"      warning messages issued          : ",ERRCOUNT:
                    *P1:17,"Total Referral records written         : ",ALLREFXX:
                    *P1:19,"Finished : ",*V2LON,CTIMEIS,*HOFF:
                    *P1:24,*EL,*B,"No more records.  ";
          CALL      HITENTER
.
          MOVE      RECIN,F5
          SUB       ERRIN,F5
          PRINT     *N,*1," Total Records read    : ",RECIN:
                    *40,"Records processed : ",F5:
                    *80,"Warning messages  : ",ERRCOUNT,*N,*N;
.
...       IF        OPTION = 2
            PRINT     *1," Records written to #"allrefaf#" : ",ALLREFXX:
                      *50," Records written to #"patvisaf#" : ",PATVISXX,*N:
                      *21,"#"allencaf#" : ",ALLENCXX:
                      *70,"#"pmsvx1af#" : ",PMSVX1XX,*N:
                      *21,"#"allgroaf#" : ",ALLGROXX:
                      *70,"#"patmi1af#" : ",PATMI1XX,*N:
                      *21,"#"allgreaf#" : ",ALLGREXX:
                      *70,"#"pattranf#" : ",PATTRNXX,*N:
                      *21,"#"allgpaaf#" : ",ALLGPAXX:
                      *70,"#"patdscaf#" : ",PATDSCXX,*N:
                      *21,"#"allitvaf#" : ",ALLITVXX:
                      *70,"#"patnobef#" : ",PATNOBXX,*N:
                      *21,"#"allrlnaf#" : ",ALLRLNXX,*N:
                      *21,"#"allrsaaf#" : ",ALLRSAXX:
                      *70,"#"mehdiaaf#" : ",MEHDIAXX,*N:
                      *21,"#"allsupaf#" : ",ALLSUPXX:
                      *70,"#"mehvi1af#" : ",MEHVI1XX,*N:
                      *70,"#"mehhlsaf#" : ",MEHHLSXX,*N:
                      *70,"#"mehhdsaf#" : ",MEHDLSXX,*N:
                      *70,"#"mehhonaf#" : ",MEHHONXX,*N
...       ENDIF
.
PINP9999  RETURN
+
.******************************************************************************
.*                                  PEOC0000                                  *
.*                     "EOC" Process Primary Referral                         *
.******************************************************************************
PEOC0000  MOVE      ZERO,EXIT
          CALL      CLEARALL                * clear all output records
          CALL      CLECL000                * clear Eclipse input variables
.
          READ      INECLTXT,SEQ;FLD60001,FLD60002,FLD60003,FLD60004,FLD60005:
                                 FLD60006,FLD60007,FLD60008,FLD60009,FLD60010:
                                 FLD60011,FLD60012,FLD60013,FLD60014,FLD60015:
                                 FLD60016,FLD60017,FLD60018,FLD60019,FLD60020:
                                 FLD60021,FLD60022,FLD60023,FLD60024,FLD60025:
                                 FLD60026,FLD60027,FLD60028,FLD60029,FLD60030:
                                 FLD60031,FLD60032,FLD60033,FLD60034,FLD60035:
                                 FLD60036,FLD60037,FLD60038,FLD60039,FLD60040:
                                 FLD60041,FLD60042,FLD60043,FLD60044,FLD60045:
                                 FLD60046,FLD60047,FLD60048,FLD60049,FLD60050:
                                 FLD60051,FLD60052,FLD60053,FLD60054,FLD60055:
                                 FLD60056
.
          PACK      ERRDATA,ECLRECID,SP1,FLD60001,SP1,FLD60002,SP1:
                            FLD60003,SP1,FLD60004,SP1,FLD60005,SP70
          PACK      UNIQUEID,FLD60004,SP20
          MATCH     SP20,UNIQUEID
          GOTO      PEOC7002 IF EQUAL
.
PEOC0500  MOVE      "EOC",DIM3A
          PACK      FLD60IN,FLD60004,SP70   * Fld. 4 - eoc_d_detail.eoc_id
          PACK      KEY23,DIM3A,FLD60IN
          CALL      RDTMEID1                * See if eoc_id has been processed 
          COMPARE   ZERO,OVRCD
          GOTO      PEOC7000 IF EQUAL
.
          CALL      NXTVIS00                * generate next PAS Visit No.
.
.                                           * set up "allrefaf"
PEOC1000  MOVE      VISITNO,ALREVISN
.
          MOVE      " 1",FLDNO
          MOVE      FLD60001,FLD60IN        * Fld 1 - UR Number 
          CALL      EDURNO00                * edit UR No.
          BRANCH    EXIT,PEOC9999
          MOVE      PURNO,ALREURNO
.
          MOVE      " 2",FLDNO
          PACK      DIM1A,FLD60002,SP1      * Fld. 2 - eoc_d_detail.status
          MOVE      DIM1A,ALRESTAT
          REP       "0-1-2-4-",DIM1A
          MATCH     "-",DIM1A
          IF        !@EQUAL
            CLEAR     ERRMESS
            APPEND    "Status '",ERRMESS
            APPEND    ALRESTAT,ERRMESS
            APPEND    "' is not valid (use 0, 1, 2 or 4)",ERRMESS
            CALL      PRNT0000
          ENDIF
.
          MOVE      " 3",FLDNO
          MOVE      FLD60003,FLD60IN        * Fld. 3 - cmh_d_contact.contact_dat
          CALL      EDDAT000
          MOVE      DIM8A,ALREDACT
.
          MOVE      " 5",FLDNO
          MOVE      "OUTC ",ECATCAT
          PACK      ECATCOD,FLD60005,SP10   * Fld. 5 - eoc_d_close.close_outcome
          CALL      EDCAT000
          MOVE      PCATCOD,ALRERCLO        * Cat."LL"
.
          MOVE      " 6",FLDNO
          MOVE      FLD60006,FLD60IN        * Fld. 6 - eoc_d_close.close_date
          CALL      EDDAT000
          MOVE      DIM8A,ALREDCLO
.
          MOVE      " 7",FLDNO
          MOVE      FLD60007,FLD60IN        * Fld. 7 - eoc_d_close.close_time
          CALL      EDTIM000
          MOVE      DIM8A,ALRETCLO
.
          MOVE      " 8",FLDNO
          MOVE      "USR",EHCPCAT
          PACK      EHCPCOD,FLD60008,SP10   * Fld. 8 - eoc_d_close.aw_user
          CALL      EDHCP000
          MOVE      HCPIBACD,ALREUCLO
.
          MOVE      " 9",FLDNO
          MOVE      "CANRF",ECATCAT
          PACK      ECATCOD,FLD60009,SP10   * Fld. 9 - eoc_d_cancel.cancel_reaso
          CALL      EDCAT000
          MOVE      PCATCOD,ALRERCAN        * Cat."LN"
.
          MOVE      "10",FLDNO
          MOVE      FLD60010,FLD60IN        * Fld. 10 - eoc_d_cancel.cancel_date
          CALL      EDDAT000
          MOVE      DIM8A,ALREDCAN
.
          MOVE      "11",FLDNO
          MOVE      FLD60011,FLD60IN        * Fld. 11 - eoc_d_cancel.cancel_time
          CALL      EDTIM000
          MOVE      DIM8A,ALRETCAN
.
          MOVE      "12",FLDNO
          MOVE      "USR",EHCPCAT
          PACK      EHCPCOD,FLD60012,SP10   * Fld. 12 - eoc_d_cancel.aw_user
          CALL      EDHCP000
          MOVE      HCPIBACD,ALREUCAN
.
          MOVE      "13",FLDNO
          MOVE      FLD60013,FLD60IN        * Fld. 13 - eoc_d_detail.ref_date
          CALL      EDDAT000
          MOVE      DIM8A,ALRERDAT
.
          MOVE      "14",FLDNO
          MOVE      "HCP",EHCPCAT
          PACK      EHCPCOD,FLD60014,SP10   * Fld. 14 - eoc_d_detail.ref_gp_fk
          CALL      EDHCP000
          MOVE      HCPIBACD,ALRERHCP
.
          MOVE      "15",FLDNO
          MOVE      "S    ",ECATCAT
          PACK      ECATCOD,FLD60015,SP10   * Fld. 15 - eoc_d_detail.rec_spec_cd
          CALL      EDCAT000
          MOVE      PCATCOD,ALREDEPT        * AH Depts
.
          MOVE      "15",FLDNO
          PACK      ALDEHOSP,SP3
          PACK      KEY3,ALREDEPT,SP3       * from Fld. 15 - see above
          MATCH     SP3,ALREDEPT
          IF        @EQUAL
            CLEAR     ERRMESS
            APPEND    "Dept. code '",ERRMESS
            APPEND    ALREDEPT,ERRMESS
            APPEND    "' is blank",ERRMESS
            CALL      PRNT0000
          ELSE
            CALL      RDALDEP1
            IF        OVRCD = 1
              CLEAR     ERRMESS
              APPEND    "Dept. code '",ERRMESS
              APPEND    ALREDEPT,ERRMESS
              APPEND    "' is not in A/H Department Table",ERRMESS
              CALL      PRNT0000
            ENDIF
          ENDIF
          MOVE      ALDEHOSP,ALREHOSN
.
          MOVE      "16",FLDNO
          MOVE      "PTY  ",ECATCAT
          PACK      ECATCOD,FLD60016,SP10   * Fld. 16 - eoc_d_detail.priority_cd
          CALL      EDCAT000
          MOVE      PCATCOD,ALREPRTY        * Cat."PR"
.
          MOVE      "17",FLDNO
          MOVE      "SOR  ",ECATCAT
          PACK      ECATCOD,FLD60017,SP10   * Fld. 17 - eoc_d_detail.rec_source_
          CALL      EDCAT000
          MOVE      PCATCOD,ALRESRCE        * Source (or Ref Source of OP Site)
.
          MOVE      "18",FLDNO
          MOVE      "BLCL ",ECATCAT
          PACK      ECATCOD,FLD60018,SP10   * Fld. 18 - eoc_d_feesch.claim_code_
          CALL      EDCAT000
          MOVE      PCATCOD,ALRECOMP        * Cat."CL"
.
          MOVE      "19",FLDNO
          MOVE      FLD60019,FLD60IN        * Fld. 19 - eoc_d_detail.next_rev_da
          CALL      EDDAT000
          MOVE      DIM8A,ALREDREV
.
          MOVE      "20",FLDNO
          MOVE      "HCP",EHCPCAT
          PACK      EHCPCOD,FLD60020,SP10   * Fld. 20 - eoc_d_detail.resp_hcp_fk
          CALL      EDHCP000
          MOVE      HCPIBACD,ALREHCP
.
          MOVE      "21",FLDNO
          MOVE      FLD60021,FLD60IN        * Fld. 21 - eoc_d_detail.date_let_re
          CALL      EDDAT000
          MOVE      DIM8A,ALREDREC
.
          MOVE      "22",FLDNO
          MOVE      "EOC02",ECATCAT
          PACK      ECATCOD,FLD60022,SP10   * Fld. 22 - eoc_d_detail.ud02_cd
          CALL      EDCAT000
          MOVE      PCATCOD,ALREUC01        * Cat."la"
.
          MOVE      "23",FLDNO
          MOVE      "EOC03",ECATCAT
          PACK      ECATCOD,FLD60023,SP10   * Fld. 23 - eoc_d_detail.ud03_cd
          CALL      EDCAT000
          MOVE      PCATCOD,ALREUC02        * Cat."lb"
.
          MOVE      "24",FLDNO
          MOVE      "EOC04",ECATCAT
          PACK      ECATCOD,FLD60024,SP10   * Fld. 24 - eoc_d_detail.ud04_cd
          CALL      EDCAT000
          MOVE      PCATCOD,ALREUC03        * Cat."lc"
.
          MOVE      "25",FLDNO
          MOVE      "EOC05",ECATCAT
          PACK      ECATCOD,FLD60025,SP10   * Fld. 25 - eoc_d_detail.ud05_cd
          CALL      EDCAT000
          MOVE      PCATCOD,ALREUC04        * Cat."ld"
.
          MOVE      "26",FLDNO
          PACK      DIM1A,FLD60026,SP1      * Fld. 26 - eoc_d_detail.ud01_yn
          CALL      EDYN0000
          MOVE      DIM1A,ALREUYN1
.
          MOVE      "27",FLDNO
          PACK      DIM1A,FLD60027,SP1      * Fld. 27 - eoc_d_detail.ud02_yn
          CALL      EDYN0000
          MOVE      DIM1A,ALREUYN2
.
          MOVE      "28",FLDNO
          PACK      DIM1A,FLD60028,SP1      * Fld. 28 - eoc_d_detail.ud03_yn
          CALL      EDYN0000
          MOVE      DIM1A,ALREUYN3
.
          MOVE      "29",FLDNO
          MOVE      "CTM",EHCPCAT
          PACK      EHCPCOD,FLD60029,SP10   * Fld. 29 - eoc_d_detail.case_team_f
          CALL      EDHCP000
          MOVE      HCPIBACD,ALREUHC4
.
          PACK      ALREUFR1,FLD60030,SP70  * Fld. 30 - eoc_d_detail.referral_re
          PACK      ALREUFR2,FLD60031,SP70  * Fld. 31 - eoc_d_detail.ud02_str
.
          MOVE      "32",FLDNO
          MOVE      FLD60032,FLD60IN        * Fld. 32 - eoc_d_detail.ud01_dt
          CALL      EDDAT000
          MOVE      DIM8A,ALREUDT1
.
          MOVE      "33",FLDNO
          MOVE      FLD60033,FLD60IN        * Fld. 33 - eoc_d_detail.ud01_tm
          CALL      EDTIM000
          MOVE      DIM8A,ALREUTM1
.
          MOVE      "34",FLDNO
          MOVE      FLD60034,FLD60IN        * Fld. 34 - eoc_d_detail.ud02_dt
          CALL      EDDAT000
          MOVE      DIM8A,ALREUDT2
.
          MOVE      "35",FLDNO
          MOVE      FLD60035,FLD60IN        * Fld. 35 - eoc_d_detail.ud02_tm
          CALL      EDTIM000
          MOVE      DIM8A,ALREUTM2
.
          MOVE      "36",FLDNO
          MOVE      FLD60036,FLD60IN        * Fld. 36 - eoc_d_detail.ud03_dt
          CALL      EDDAT000
          MOVE      DIM8A,ALREUDT3
.
          MOVE      "37",FLDNO
          MOVE      FLD60037,FLD60IN        * Fld. 37 - eoc_d_detail.ud03_tm
          CALL      EDTIM000
          MOVE      DIM8A,ALREUTM3
.
          MOVE      "38",FLDNO
          MOVE      FLD60038,FLD60IN        * Fld. 38 - eoc_d_detail.ud04_dt
          CALL      EDDAT000
          MOVE      DIM8A,ALREUDT4
.
          MOVE      "39",FLDNO
          MOVE      FLD60039,FLD60IN        * Fld. 39 - eoc_d_detail.ud04_tm
          CALL      EDTIM000
          MOVE      DIM8A,ALREUTM4
.
          MOVE      "40",FLDNO
          MOVE      FLD60040,FLD60IN        * Fld. 40 - eoc_d_detail.aw_date
          CALL      EDDAT000
          MOVE      DIM8A,ALRECDAT
.
          MOVE      "41",FLDNO
          MOVE      FLD60041,FLD60IN        * Fld. 41 - eoc_d_detail.aw_time
          CALL      EDTIM000
          MOVE      DIM8A,ALRECTIM
.
          MOVE      "42",FLDNO
          MOVE      "USR",EHCPCAT
          PACK      EHCPCOD,FLD60042,SP10   * Fld. 42 - eoc_d_detail.aw_user
          CALL      EDHCP000
          MOVE      HCPIBACD,ALRECUID
.
          PACK      ALREFHCP,FLD60043,SP70  * Fld. 43 - cmn_r_extagn.name
          PACK      ALREHCP1,FLD60044,SP70  * Fld. 44 - cmn_r_extagn.address
          PACK      ALREHCPC,FLD60045,SP20  * Fld. 45 - cmn_r_extagn.postcode
          PACK      ALREHCPB,FLD60046,SP20  * Fld. 46 - cmn_r_extagn.phone  
          PACK      ALREHCPF,FLD60047,SP20  * Fld. 47 - cmn_r_extagn.fax
          PACK      ALRECCOM,FLD60004,SP70  * Fld.  4 - eoc_d_detail.eoc_id
.
          MOVE      "48",FLDNO
          MOVE      "TPEOC",ECATCAT
          PACK      ECATCOD,FLD60048,SP10   * Fld. 48 - eoc_d_detail.eoc_type_cd
          CALL      EDCAT000
          MOVE      PCATCOD,ALRERTYP        * Cat."RI"
.
          MOVE      "49",FLDNO
          MOVE      FLD60049,FLD60IN        * Fld. 49 - eoc_d_detail.contact_exp
          CALL      EDDAT000
          MOVE      DIM8A,ALREMDAT
.
          MOVE      "50",FLDNO
          MOVE      FLD60050,FLD60IN        * Fld. 50 - eoc_d_detail.ud05_dt
          CALL      EDDAT000
          MOVE      DIM8A,ALREUDT5
.
          MOVE      "51",FLDNO
          MOVE      FLD60051,FLD60IN        * Fld. 51 - eoc_d_detail.ud05_tm
          CALL      EDTIM000
          MOVE      DIM8A,ALREUTM5
.
          MOVE      "52",FLDNO
          PACK      DIM1A,FLD60052,SP1      * Fld. 52 - eoc_d_detail.ud04_yn
          CALL      EDYN0000
          MOVE      DIM1A,ALREUYN5
.
          MOVE      "53",FLDNO
          PACK      DIM1A,FLD60053,SP1      * Fld. 53 - eoc_d_detail.ud05_yn
          CALL      EDYN0000
          MOVE      DIM1A,ALREUYN6
.
          MOVE      "54",FLDNO
          MOVE      "EOC01",ECATCAT
          PACK      ECATCOD,FLD60054,SP10   * Fld. 54 - eoc_d_detail.ud01_cd
          CALL      EDCAT000
          MOVE      PCATCOD,ALREPURC        * Cat."HP"
.
          MOVE      "55",FLDNO
          MOVE      FLD60055,FLD60IN        * Fld. 55 - eoc_d_detail.ud01_num
          MOVE      "6",LENGTH              * retrieve No and right justify
          CALL      RJUS0000                * right justify
          CALL      EDNUM000
          MOVE      FLD60OUT,ALRESCOR
.
          PACK      ALREMOHR,FLD60056,SP1   * Fld. 56 - ALREMOHR
.
.
.
.                                           * set up "patvisaf"
PEOC2000  MOVE      ALREURNO,PVIURNO        * UR No (from "allrefaf")
          PACK      PVIDATE,FLD60013,SP10   * Fld. 13 - eoc_d_detail.ref_date
          MOVE      VISITNO,PVIBILL
          MOVE      "9",PVITYPE
.
          MOVE      "20",FLDNO
          MOVE      "HCP",EHCPCAT
          PACK      EHCPCOD,FLD60020,SP10   * Fld. 20 - eoc_d_detail.resp_hcp_fk
          CALL      EDHCP000
          PACK      PVIDOCT,HCPIBACD,SP10
.
          MOVE      "2",PVISTAT
          MOVE      "1",PVITRAN
          MOVE      "9",PVITYPE
          MOVE      " 2",PVISYST
...       MOVE      "10",PTVITYPE           * done by STTYPE00 in IO module
.
.                                           * set up "pmsvx1af"
PEOC3000  MOVE      VISITNO,PMVXVISN
          PACK      PMVXVSDT,FLD60013,SP10  * Fld. 13 - eoc_d_detail.ref_date
          MOVE      PVIDOCT,PMVXDOCA        * Fld. 20 - eoc_d_detail.resp_hcp_fk
          PACK      PMVXCDTE,FLD60040,SP10  *
          PACK      PMVXCTIM,FLD60041,SP10
.
          MOVE      "40",FLDNO
          MOVE      FLD60040,FLD60IN        * Fld. 40 - eoc_d_detail.aw_date
          CALL      EDDAT000
          MOVE      DIM8A,PMVXCDTE
.
          MOVE      "41",FLDNO
          MOVE      FLD60041,FLD60IN        * Fld. 41 - eoc_d_detail.aw_time
          CALL      EDTIM000
          MOVE      DIM8A,PMVXCTIM
.
          MOVE      "42",FLDNO
          MOVE      "USR",EHCPCAT
          PACK      EHCPCOD,FLD60042,SP10   * Fld. 42 - eoc_d_detail.aw_user
          CALL      EDHCP000
          MOVE      HCPIBACD,PMVXWEBC
.
          MOVE      ALDEHOSP,PMVXMHOS
.
.                                           ***********************************
.
PEOC5000  UNPACK    SP70,EIDVISNO,EIDENCNO,EIDSESNO,EIDCONNO,EIDTEST
          UNPACK    SP70,EIDOOONO,EIDSPAR
          MOVE      "EOC",EIDIDCOD          * write "eoc_id" record
          PACK      EIDIDNO,FLD60004,SP20   * Fld. 4 - eoc_d_detail.eoc_id
          PACK      EIDVISNO,VISITNO        * store new Visit No.
          MOVE      "       0",EIDENCNO
          IF        OPTION = 1
            MOVE      "T",EIDTEST
          ENDIF
          PACK      KEY23,EIDIDCOD,EIDIDNO,SP30
          CALL      RATMEID1
          COMPARE   ZERO,OVRCD
          GOTO      PEOC7000 IF EQUAL
.
          CALL      WRTMEID1                * write EID_ID semi-temp file
.
          BRANCH    OPTION,PEOC9999,PEOC8000  * check if Edit or Upload
          GOTO      PEOC8000
.
.
PEOC7000  CLEAR     ERRMESS
          MOVE      "  ",FLDNO
          APPEND    "Referral Id. '",ERRMESS
          APPEND    FLD60004,ERRMESS
          APPEND    "' already processed - record bypassed",ERRMESS
          APPEND    " *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PEOC9999
.
PEOC7002  CLEAR     ERRMESS
          APPEND    "The link key field 'eoc_id' for '",ERRMESS
          APPEND    FLD60004,ERRMESS
          APPEND    "' is blank - record bypassed *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PEOC9999
.
.
.                                           * write the records
PEOC8000  MOVE      ZERO,EXIT
          PACK      KEY8,ALREVISN,SP8
          CALL      RDALREF1
          IF        OVRCD = 1
            CALL      WRALREF1              * write "allrefaf"
            ADD       ONE,ALLREFXX
          ENDIF
.
          CALL      RDPTVIS1
          IF        OVRCD = 1
            CALL      WRPTVIS1              * write "patvisaf"
            ADD       ONE,PATVISXX
          ENDIF
.
          CALL      RAPMVX11
          IF        OVRCD = 1
            CALL      WRPMVX11              * write "pmsvx1af"
            ADD       ONE,PMSVX1XX
          ENDIF
.
          GOTO      PEOC9999
.
PEOC9999  RETURN
+
.******************************************************************************
.*                                  PHCE0000                                  *
.*                     "HCE" Process Linked Referrals                         *
.******************************************************************************
PHCE0000  MOVE      ZERO,EXIT
         
          CALL      CLEARALL                * clear all output records
          CALL      CLECL000                * clear Eclipse input variables
.
          READ      INECLTXT,SEQ;FLD60001,FLD60002,FLD60003,FLD60004,FLD60005:
                                 FLD60006,FLD60007,FLD60008,FLD60009,FLD60010:
                                 FLD60011,FLD60012,FLD60013,FLD60014,FLD60015:
                                 FLD60016,FLD60017,FLD60018,FLD60019,FLD60020:
                                 FLD60021,FLD60022,FLD60023,FLD60024,FLD60025:
                                 FLD60026,FLD60027,FLD60028,FLD60029,FLD60030:
                                 FLD60031,FLD60032,FLD60033,FLD60034,FLD60035:
                                 FLD60036,FLD60037,FLD60038,FLD60039,FLD60040:
                                 FLD60041,FLD60042,FLD60043,FLD60044,FLD60045:
                                 FLD60046,FLD60047,FLD60048,FLD60049,FLD60050:
                                 FLD60051,FLD60052,FLD60053,FLD60054,FLD60055:
                                 FLD60056,FLD60057,FLD60058,FLD60059,FLD60060
.
.           
          PACK      ERRDATA,ECLRECID,SP1,FLD60001,SP1,FLD60002,SP1:
                            FLD60003,SP1,FLD60004,SP1,FLD60005,SP70
          PACK      UNIQUEID,FLD60004,SP20
          MATCH     SP20,UNIQUEID
          GOTO      PHCE7002 IF EQUAL
.
PHCE0500  MOVE      "HCE",DIM3A
          PACK      FLD60IN,FLD60004,SP70   * Fld. 4 - hce_d_detail.hce_id
          PACK      KEY23,DIM3A,FLD60IN
          CALL      RDTMEID1                * See if hce_id has been processed 
          COMPARE   ZERO,OVRCD
          GOTO      PHCE7000 IF EQUAL
.
          CALL      NXTVIS00                * generate next PAS Visit No.
.
.                                           * set up "allrefaf"
PHCE1000  MOVE      VISITNO,ALREVISN        * store new Visit No.
.
          MOVE      " 1",FLDNO
          MOVE      FLD60001,FLD60IN        * Fld 1 - UR Number
          CALL      EDURNO00                * edit UR No.
          BRANCH    EXIT,PHCE9999
          MOVE      PURNO,ALREURNO
.
          MOVE      " 2",FLDNO
          PACK      DIM1A,FLD60002,SP1      * Fld. 2 - eoc_d_detail.status
          MOVE      DIM1A,ALRESTAT
          REP       "0-1-2-4-",DIM1A
          MATCH     "-",DIM1A
          IF        !@EQUAL
            CLEAR     ERRMESS
            APPEND    "Status '",ERRMESS
            APPEND    ALRESTAT,ERRMESS
            APPEND    "' is not valid (use 0, 1, 2 or 4)",ERRMESS
            CALL      PRNT0000
          ENDIF
.
          MOVE      " 3",FLDNO
          MOVE      FLD60003,FLD60IN        * Fld. 3 - cmh_d_contact.contact_dat
          CALL      EDDAT000
          MOVE      DIM8A,ALREDACT
.
          MOVE      " 6",FLDNO
          MOVE      "OUTC ",ECATCAT
          PACK      ECATCOD,FLD60006,SP10   * Fld. 6 - hce_d_disch_cmh.close_rea
          CALL      EDCAT000
          MOVE      PCATCOD,ALRERCLO        * Cat."LL"
.
          MOVE      " 7",FLDNO
          MOVE      FLD60007,FLD60IN        * Fld. 7 - hce_d_disch_cmh.discharge
          CALL      EDDAT000
          MOVE      DIM8A,ALREDCLO
.
          MOVE      " 8",FLDNO
          MOVE      FLD60008,FLD60IN        * Fld. 8 - hce_d_disch_cmh.discharge
          CALL      EDTIM000
          MOVE      DIM8A,ALRETCLO
.
          MOVE      " 9",FLDNO
          MOVE      "USR",EHCPCAT
          PACK      EHCPCOD,FLD60009,SP10   * Fld. 9 - hce_d_disch_cmh.aw_user
          CALL      EDHCP000
          MOVE      HCPIBACD,ALREUCLO
.
          MOVE      "10",FLDNO
          MOVE      "CANRF",ECATCAT
          PACK      ECATCOD,FLD60010,SP10   * Fld. 10 - hce_d_cancel.cancel_reas
          CALL      EDCAT000
          MOVE      PCATCOD,ALRERCAN        * Cat."LN"
.
          MOVE      "11",FLDNO
          MOVE      FLD60011,FLD60IN        * Fld. 11 - hce_d_cancel.cancel_date
          CALL      EDDAT000
          MOVE      DIM8A,ALREDCAN
.
          MOVE      "12",FLDNO
          MOVE      FLD60012,FLD60IN        * Fld. 12 - hce_d_cancel.cancel_time
          CALL      EDTIM000
          MOVE      DIM8A,ALRETCAN
.
          MOVE      "13",FLDNO
          MOVE      "USR",EHCPCAT
          PACK      EHCPCOD,FLD60013,SP10   * Fld. 13 - hce_d_cancel.aw_user
          CALL      EDHCP000
          MOVE      HCPIBACD,ALREUCAN
.
          MOVE      "14",FLDNO
          MOVE      FLD60014,FLD60IN        * Fld. 14 - hce_d_detail.ref_date
          CALL      EDDAT000
          MOVE      DIM8A,ALRERDAT
.
          MOVE      "15",FLDNO
          MOVE      "HCP",EHCPCAT
          PACK      EHCPCOD,FLD60015,SP10   * Fld. 15 - eoc_d_detail.ref_gp_fk
          CALL      EDHCP000
          MOVE      HCPIBACD,ALRERHCP
.
          MOVE      "16",FLDNO
          MOVE      "S    ",ECATCAT
          PACK      ECATCOD,FLD60016,SP10   * Fld. 16 - eoc_d_detail.rec_spec_cd
          CALL      EDCAT000
          MOVE      PCATCOD,ALREDEPT        * AH Depts
.
          PACK      ALDEHOSP,SP3            * clear input field
          MATCH     SP3,ALREDEPT
          IF        @EQUAL
            CLEAR     ERRMESS
            APPEND    "Dept. code '",ERRMESS
            APPEND    ALREDEPT,ERRMESS
            APPEND    "' is blank",ERRMESS
            CALL      PRNT0000
          ELSE
            PACK      KEY3,ALREDEPT,SP3       * from Fld. 16 - see above
            CALL      RDALDEP1
            IF        OVRCD = 1
              CLEAR     ERRMESS
              APPEND    "Dept. code '",ERRMESS
              APPEND    ALREDEPT,ERRMESS
              APPEND    "' is not in A/H Department Table",ERRMESS
              CALL      PRNT0000
            ENDIF
          ENDIF
          MOVE      ALDEHOSP,ALREHOSN
.
          MOVE      "17",FLDNO
          MOVE      "PTY  ",ECATCAT
          PACK      ECATCOD,FLD60017,SP10   * Fld. 17 - eoc_d_detail.priority_cd
          CALL      EDCAT000
          MOVE      PCATCOD,ALREPRTY        * Cat."PR"
.         
          MOVE      "18",FLDNO
          MOVE      "SOR  ",ECATCAT
          PACK      ECATCOD,FLD60018,SP10   * Fld. 18 - eoc_d_detail.rec_source_
          CALL      EDCAT000
          MOVE      PCATCOD,ALRESRCE        * Source (or Ref Source of OP Site)
.
          MOVE      "19",FLDNO
          MOVE      "BLCL ",ECATCAT
          PACK      ECATCOD,FLD60019,SP10   * Fld. 19 - hce_d_feesch.claim_code_
          CALL      EDCAT000
          MOVE      PCATCOD,ALRECOMP        * Cat."CL"
.
          MOVE      "20",FLDNO
          MOVE      FLD60020,FLD60IN        * Fld. 20 - hce_d_detail.next_rev_da
          CALL      EDDAT000
          MOVE      DIM8A,ALREDREV
.
          MOVE      "21",FLDNO
          MOVE      "HCP",EHCPCAT
          PACK      EHCPCOD,FLD60021,SP10   * Fld. 21 - hce_d_detail.resp_hcp_fk
          CALL      EDHCP000
          MOVE      HCPIBACD,ALREHCP
.
          MOVE      "22",FLDNO
          MOVE      FLD60022,FLD60IN        * Fld. 22 - eoc_d_detail.date_let_re
          CALL      EDDAT000
          MOVE      DIM8A,ALREDREC
.
          MOVE      "23",FLDNO
          MOVE      "REFRS",ECATCAT
          PACK      ECATCOD,FLD60023,SP10   * Fld. 23 - hce_d_detail.ud02_cd
          CALL      EDCAT000
          MOVE      PCATCOD,ALREUC05        * Cat."le"
.
          MOVE      "24",FLDNO
          MOVE      "HCE01",ECATCAT
          PACK      ECATCOD,FLD60024,SP10   * Fld. 24 - hce_d_detail.ud01_cd
          CALL      EDCAT000
          MOVE      PCATCOD,ALREUC06        * Cat."lf"
.
          MOVE      "25",FLDNO
          MOVE      "HCE02",ECATCAT
          PACK      ECATCOD,FLD60025,SP10   * Fld. 25 - hce_d_detail.ud02_cd
          CALL      EDCAT000
          MOVE      PCATCOD,ALREUC07        * Cat."lg"
.
          MOVE      "26",FLDNO
          MOVE      "HCE03",ECATCAT
          PACK      ECATCOD,FLD60026,SP10   * Fld. 26 - hce_d_detail.ud03_cd
          CALL      EDCAT000
          MOVE      PCATCOD,ALREUC08        * Cat."lh"
.
          MOVE      "27",FLDNO
          MOVE      "HCE04",ECATCAT
          PACK      ECATCOD,FLD60027,SP10   * Fld. 27 - hce_d_detail.ud04_cd
          CALL      EDCAT000
          MOVE      PCATCOD,ALREUC09        * Cat."li"
.
          MOVE      "28",FLDNO
          MOVE      "HCE05",ECATCAT
          PACK      ECATCOD,FLD60028,SP10   * Fld. 28 - hce_d_detail.ud05_cd
          CALL      EDCAT000
          MOVE      PCATCOD,ALREUC10        * Cat."lj"
.
          MOVE      "29",FLDNO
          PACK      DIM1A,FLD60029,SP1      * Fld. 29 - hce_d_detail.ud01_yn
          CALL      EDYN0000
          MOVE      DIM1A,ALREUYN1
.
          MOVE      "30",FLDNO
          PACK      DIM1A,FLD60030,SP1      * Fld. 30 - hce_d_detail.ud02_yn
          CALL      EDYN0000
          MOVE      DIM1A,ALREUYN2
.
          MOVE      "31",FLDNO
          PACK      DIM1A,FLD60031,SP1      * Fld. 31 - hce_d_detail.ud03_yn
          CALL      EDYN0000
          MOVE      DIM1A,ALREUYN3
.
          MOVE      "32",FLDNO
          MOVE      "CTM",EHCPCAT
          PACK      EHCPCOD,FLD60032,SP10   * Fld. 32 - hce_d_detail.case_team_f
          CALL      EDHCP000
          MOVE      HCPIBACD,ALREUHC4
.
          PACK      ALREUFR1,FLD60033,SP70  * Fld. 33 - hce_d_detail.referral_re
          PACK      ALREUFR2,FLD60034,SP70  * Fld. 34 - hce_d_detail.ud01_str
.
          MOVE      "35",FLDNO
          MOVE      FLD60035,FLD60IN        * Fld. 35 - eoc_d_detail.ud01_dt
          CALL      EDDAT000
          MOVE      DIM8A,ALREUDT1
.
          MOVE      "36",FLDNO
          MOVE      FLD60036,FLD60IN        * Fld. 36 - hce_d_detail.ud01_tm
          CALL      EDTIM000
          MOVE      DIM8A,ALREUTM1
.
          MOVE      "37",FLDNO
          MOVE      FLD60037,FLD60IN        * Fld. 37 - hce_d_detail.ud02_dt
          CALL      EDDAT000
          MOVE      DIM8A,ALREUDT2
.
          MOVE      "38",FLDNO
          MOVE      FLD60038,FLD60IN        * Fld. 38 - hce_d_detail.ud02_tm
          CALL      EDTIM000
          MOVE      DIM8A,ALREUTM2
.
          MOVE      "39",FLDNO
          MOVE      FLD60039,FLD60IN        * Fld. 39 - hce_d_detail.ud03_dt
          CALL      EDDAT000
          MOVE      DIM8A,ALREUDT3
.
          MOVE      "40",FLDNO
          MOVE      FLD60040,FLD60IN        * Fld. 40 - hce_d_detail.ud03_tm
          CALL      EDTIM000
          MOVE      DIM8A,ALREUTM3
.
          MOVE      "41",FLDNO
          MOVE      FLD60041,FLD60IN        * Fld. 41 - hce_d_detail.ud04_dt
          CALL      EDDAT000
          MOVE      DIM8A,ALREUDT4
.
          MOVE      "42",FLDNO
          MOVE      FLD60042,FLD60IN        * Fld. 42 - hce_d_detail.ud04_tm
          CALL      EDTIM000
          MOVE      DIM8A,ALREUTM4
.
          MOVE      "43",FLDNO
          MOVE      FLD60043,FLD60IN        * Fld. 43 - hce_d_detail.aw_date
          CALL      EDDAT000
          MOVE      DIM8A,ALRECDAT
.
          MOVE      "44",FLDNO
          MOVE      FLD60044,FLD60IN        * Fld. 44 - hce_d_detail.aw_time
          CALL      EDTIM000
          MOVE      DIM8A,ALRECTIM
.
          MOVE      "45",FLDNO
          MOVE      "USR",EHCPCAT
          PACK      EHCPCOD,FLD60045,SP10   * Fld. 45 - hce_d_detail.aw_user
          CALL      EDHCP000
          MOVE      HCPIBACD,ALRECUID
.
          PACK      ALREFHCP,FLD60046,SP70  * Fld. 46 - cmn_r_extagn.name
          PACK      ALREHCP1,FLD60047,SP70  * Fld. 47 - cmn_r_extagn.address
          PACK      ALREHCPC,FLD60048,SP20  * Fld. 48 - cmn_r_extagn.postcode
          PACK      ALREHCPB,FLD60049,SP20  * Fld. 49 - cmn_r_extagn.phone
          PACK      ALREHCPF,FLD60050,SP20  * Fld. 50 - cmn_r_extagn.fax
          PACK      ALRECCOM,FLD60004,SP70  * Fld.  4 - hce_d_detail.hce_id
.
          MOVE      "51",FLDNO
          MOVE      "TPHCE",ECATCAT
          PACK      ECATCOD,FLD60051,SP10   * Fld. 51 - hce_d_detail.hce_type_cd
          CALL      EDCAT000
          MOVE      PCATCOD,ALRERTYP        * Cat."RI"
.
          MOVE      "52",FLDNO
          MOVE      FLD60052,FLD60IN        * Fld. 52 - eoc_d_detail.contact_exp
          CALL      EDDAT000
          MOVE      DIM8A,ALREMDAT
.
          MOVE      "53",FLDNO
          MOVE      FLD60053,FLD60IN        * Fld. 53 - hce_d_detail.ud05_dt
          CALL      EDDAT000
          MOVE      DIM8A,ALREUDT5
.
          MOVE      "54",FLDNO
          MOVE      FLD60054,FLD60IN        * Fld. 54 - hce_d_detail.ud05_tm
          CALL      EDTIM000
          MOVE      DIM8A,ALREUTM5
.
          MOVE      "55",FLDNO
          PACK      DIM1A,FLD60055,SP1      * Fld. 55 - hce_d_detail.ud04_yn
          CALL      EDYN0000
          MOVE      DIM1A,ALREUYN5
.
          MOVE      "56",FLDNO
          PACK      DIM1A,FLD60056,SP1      * Fld. 56 - hce_d_detail.ud05_yn
          CALL      EDYN0000
          MOVE      DIM1A,ALREUYN6
.
          MOVE      "57",FLDNO
          MOVE      "EOC01",ECATCAT
          PACK      ECATCOD,FLD60057,SP10   * Fld. 57 - eoc_d_detail.ud01_cd
          CALL      EDCAT000
          MOVE      PCATCOD,ALREPURC        * Cat."HP"
.
          MOVE      "58",FLDNO
          MOVE      "CONTC",ECATCAT
          PACK      ECATCOD,FLD60059,SP10   * Fld. 58 - eoc_d_detail.ud01_cd
          CALL      EDCAT000
          MOVE      PCATCOD,ALRECONT        * Cat."gb"
.
          MOVE      "59",FLDNO
          MOVE      FLD60058,FLD60IN        * Fld. 59 - eoc_d_detail.ud01_num
          MOVE      "6",LENGTH              * retrieve No and right justify
          CALL      RJUS0000                * right justify UR No.
          CALL      EDNUM000
          MOVE      FLD60OUT,ALRESCOR
.
          PACK      ALREMOHR,FLD60060       * Fld. 60 - ALREMOHR
.
.
.
.                                           * set up "patvisaf"
PHCE2000  MOVE      ALREURNO,PVIURNO        * UR No (from "allrefaf")
          PACK      PVIDATE,FLD60014,SP10   * Fld. 14 - hce_d_detail.ref_date
          MOVE      VISITNO,PVIBILL         * store new Visit No.
          MOVE      "9",PVITYPE
.
          MOVE      "21",FLDNO
          MOVE      "HCP",EHCPCAT
          PACK      EHCPCOD,FLD60021,SP10   * Fld. 21 - eoc_d_detail.resp_hcp_fk
          CALL      EDHCP000
          PACK      PVIDOCT,HCPIBACD,SP10
.
          MOVE      "2",PVISTAT
          MOVE      "1",PVITRAN
          MOVE      " 2",PVISYST
          MOVE      "9",PVITYPE
...       MOVE      "10",PTVITYPE           * done by STTYPE00 in IO module
.
.                                           * set up "pmsvx1af"
PHCE3000  MOVE      VISITNO,PMVXVISN        * store new Visit No.
          PACK      PMVXVSDT,FLD60014,SP10  * Fld. 14 - hce_d_detail.ref_date
          MOVE      PVIDOCT,PMVXDOCA        * Fld. 21 - hce_d_detail.resp_hcp_fk
.
          MOVE      "43",FLDNO
          MOVE      FLD60043,FLD60IN        * Fld. 43 - hce_d_detail.aw_date
          CALL      EDDAT000
          MOVE      DIM8A,PMVXCDTE
.
          MOVE      "44",FLDNO
          MOVE      FLD60044,FLD60IN        * Fld. 44 - hce_d_detail.aw_time
          CALL      EDTIM000
          MOVE      DIM8A,PMVXCTIM
.
          MOVE      "45",FLDNO
          MOVE      "USR",EHCPCAT
          PACK      EHCPCOD,FLD60045,SP10   * Fld. 45 - hce_d_detail.aw_user
          CALL      EDHCP000
          MOVE      HCPIBACD,PMVXWEBC
.
          MOVE      ALDEHOSP,PMVXMHOS
.
.                                           * set up "allrlnaf"
PHCE4000  MOVE      "EOC",DIM3A
          PACK      KEY23,DIM3A,FLD60005,SP70  * Fld.  5 - eoc_d_detail.eoc_id
          CALL      RDTMEID1                * find "parent" eoc_id and VISIT NO
          BRANCH    OVRCD,PHCE7001
.
          MOVE      EIDVISNO,ALRLVISN
          MOVE      VISITNO,ALRLLNKV        * store new Visit No.
.
          MOVE      "43",FLDNO
          MOVE      FLD60043,FLD60IN        * Fld. 43 - hce_d_detail.aw_date
          CALL      EDDAT000
          MOVE      DIM8A,ALRLCDAT
.
          MOVE      "44",FLDNO
          MOVE      FLD60044,FLD60IN        * Fld. 44 - hce_d_detail.aw_time
          CALL      EDTIM000
          MOVE      DIM8A,ALRLCTIM
.
          MOVE      "45",FLDNO
          MOVE      "USR",EHCPCAT
          PACK      EHCPCOD,FLD60045,SP10   * Fld. 45 - hce_d_detail.aw_user
          CALL      EDHCP000
          MOVE      HCPIBACD,ALRLCUID
.
.
.                                           ***********************************
.
PHCE5000  UNPACK    SP70,EIDVISNO,EIDENCNO,EIDSESNO,EIDCONNO,EIDTEST
          UNPACK    SP70,EIDOOONO,EIDSPAR
          MOVE      "HCE",EIDIDCOD          * write "hce_id" record
          PACK      EIDIDNO,FLD60004,SP20
          PACK      EIDVISNO,VISITNO        * store new Visit No.
          MOVE      "       0",EIDENCNO
          IF        OPTION = 1
            MOVE      "T",EIDTEST
          ENDIF
          PACK      KEY23,EIDIDCOD,EIDIDNO,SP30
          CALL      RATMEID1
          COMPARE   ZERO,OVRCD
          GOTO      PHCE7000 IF EQUAL
.
          CALL      WRTMEID1                * write EID_ID semi-temp file
.
          BRANCH    OPTION,PHCE9999,PHCE8000  * check if Edit or Upload
          GOTO      PHCE8000
.
.
.
PHCE7000  CLEAR     ERRMESS
          MOVE      "  ",FLDNO
          APPEND    "Referral Id. '",ERRMESS
          APPEND    FLD60004,ERRMESS
          APPEND    "' already processed - record bypassed",ERRMESS
          APPEND    " *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PHCE9999
.
.
PHCE7001  CLEAR     ERRMESS
          MOVE      "  ",FLDNO
          APPEND    "Parent Visit No. for eoc_id '",ERRMESS
          APPEND    FLD60004,ERRMESS
          APPEND    "' not found - record bypassed *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PHCE9999
.
PHCE7002  CLEAR     ERRMESS
          APPEND    "The link key field 'eoc_id' for '",ERRMESS
          APPEND    FLD60004,ERRMESS
          APPEND    "' is blank - record bypassed *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PHCE9999
.
.
.
.                                           * write the records
PHCE8000  PACK      KEY8,ALREVISN,SP8
          CALL      RDALREF1
          IF        OVRCD = 1
            CALL      WRALREF1              * write "allrefaf"
            ADD       ONE,ALLREFXX
          ENDIF
.
          CALL      RDPTVIS1
          IF        OVRCD = 1
            CALL      WRPTVIS1              * write "patvisaf"
            ADD       ONE,PATVISXX
          ENDIF
.
          CALL      RAPMVX11
          IF        OVRCD = 1
            CALL      WRPMVX11              * write "pmsvx1af"
            ADD       ONE,PMSVX1XX
          ENDIF
.
          CALL      RAALRLN1
          IF        OVRCD = 1
            CALL      WRALRLN1              * write "allrlnaf"
            ADD       ONE,ALLRLNXX
          ENDIF
.
.
PHCE9999  RETURN
+
.******************************************************************************
.*                                  PCON0000                                  *
.*                       "CON" Process Enounters                              *
.******************************************************************************
PCON0000  MOVE      ZERO,EXIT
          CALL      CLALLENC
          CALL      CLECL000                * clear Eclipse input variables
.
          READ      INECLTXT,SEQ;FLD60001,FLD60002,FLD60003,FLD60004,FLD60005:
                                 FLD60006,FLD60007,FLD60008,FLD60009,FLD60010:
                                 FLD60011,FLD60012,FLD60013,FLD60014,FLD60015:
                                 FLD60016,FLD60017,FLD60018,FLD60019,FLD60020:
                                 FLD60021,FLD60022,FLD60023,FLD60024,FLD60025:
                                 FLD60026,FLD60027,FLD60028,FLD60029,FLD60030:
                                 FLD60031,FLD60032,FLD60033,FLD60034
.
.                                   
          PACK      ERRDATA,ECLRECID,SP1,FLD60001,SP1,FLD60002,SP1:           
                            FLD60003,SP1,FLD60004,SP1,FLD60005,SP70
          PACK      UNIQUEID,FLD60019,SP20
          MATCH     SP20,UNIQUEID
          GOTO      PCON7002 IF EQUAL
.
PCON0500  MOVE      "CON",DIM3A
          PACK      FLD60IN,FLD60018,SP30   * Fld. 18 - cmh_d_contact.contact_id
          PACK      KEY23,DIM3A,FLD60IN
          CALL      RATMEID1                * see if contact_id has been process
          COMPARE   ZERO,OVRCD
          GOTO      PCON7001 IF EQUAL       * already processed
.
          MOVE      "EOC",DIM3A             * check the initial referral "EOC"
          PACK      FLD60IN,FLD60019,SP30   * Fld. 19 - hce_d_detail.hce_id
          PACK      KEY23,DIM3A,FLD60IN
          CALL      RDTMEID1                * See if eoc_id has been processed
          IF        OVRCD = 1
            MOVE      "HCE",DIM3A           * check the "HCE" linked referrals
            PACK      KEY23,DIM3A,FLD60IN
            CALL      RDTMEID1              * See if hce_id has been processed
            BRANCH    OVRCD,PCON7000
          ENDIF
          MOVE      EIDENCNO,F8
          ADD       ONE,F8
          MOVE      F8,EIDENCNO
          CALL      UPTMEID1                * update the Encounter No.
.
.                                           * set up "allencaf"
PCON1000  MOVE      EIDVISNO,ALENVISN       * from "EOC" or "HCE" record
          MOVE      EIDENCNO,ALENENCT
.
.
          MOVE      " 1",FLDNO
          MOVE      "HCP",EHCPCAT
          PACK      EHCPCOD,FLD60001,SP10   * Fld. 1  - cmh_d_contact.resp_hcp_f
          CALL      EDHCP000
          MOVE      HCPIBACD,ALENHCP                 * (was ALENCMT1) *C-179344
.
          MOVE      " 2",FLDNO
          MOVE      FLD60002,FLD60IN        * Fld. 2  - cmh_d_contact.contact_da
          CALL      EDDAT000
          MOVE      DIM8A,ALENSDAT
.
          MOVE      " 3",FLDNO
          MOVE      FLD60003,FLD60IN        * Fld. 3  - cmh_d_contact.contact_ti
          CALL      EDTIM000
          MOVE      DIM8A,ALENSTIM
.
          MOVE      " 4",FLDNO
          MOVE      "PLACT",ECATCAT
          PACK      ECATCOD,FLD60004,SP10   * Fld. 4  - cmh_d_cont_patient.conta
          CALL      EDCAT000
          MOVE      PCATCOD,ALENLOCA        * Cat."LD"
.
          MOVE      " 5",FLDNO
          MOVE      "OUTCT",ECATCAT
          PACK      ECATCOD,FLD60005,SP10   * Fld. 5  - cmh_d_cont_patient.outco
          CALL      EDCAT000
          MOVE      PCATCOD,ALENSERV        * AH Department
.
          MOVE      FLD60006,FLD60IN        * Fld.  6 - cmh_d_contact.duration
          MOVE      "6",LENGTH              * retrieve No and right justify
          CALL      RJUS0000                * right justify duration
          CALL      EDNUM000
          MOVE      FLD60OUT,ALENDIUN
.
          PACK      DIM1A,FLD60007,SP10     * Fld.  7 - alenrsta
          MATCH     "1",DIM1A
          IF        !@EQUAL
            MOVE      "0",DIM1A
          ENDIF
          MOVE      DIM1,ALENRSTA
.
          MOVE      " 8",FLDNO
          MOVE      FLD60008,FLD60IN        * Fld. 8  - cmh_d_cont_patient.ud01_
          CALL      EDDAT000
          MOVE      DIM8A,ALENUDT1
.
          MOVE      " 9",FLDNO
          MOVE      FLD60009,FLD60IN        * Fld. 9  - cmh_d_cont_patient.ud01_
          CALL      EDTIM000
          MOVE      DIM8A,ALENUTM1
.
          MOVE      "10",FLDNO
          MOVE      FLD60010,FLD60IN        * Fld. 10 - cmh_d_cont_patient.ud02_
          CALL      EDDAT000
          MOVE      DIM8A,ALENUDT2
.
          MOVE      "11",FLDNO
          MOVE      FLD60011,FLD60IN        * Fld. 11 - cmh_d_cont_patient.ud02_
          CALL      EDTIM000
          MOVE      DIM8A,ALENUTM2
.
          MOVE      "12",FLDNO
          MOVE      "HCP",EHCPCAT
          PACK      EHCPCOD,FLD60012,SP10   * Fld. 12 - cmh_d_xtrastaff.hcp_id
          CALL      EDHCP000
          MOVE      HCPIBACD,ALENUHC1
.
          MOVE      "13",FLDNO
          MOVE      "HCP",EHCPCAT
          PACK      EHCPCOD,FLD60013,SP10   * Fld. 13 - cmh_d_xtrastaff.hcp_id
          CALL      EDHCP000
          MOVE      HCPIBACD,ALENUHC2
.
          MOVE      "14",FLDNO
          MOVE      "HCP",EHCPCAT
          PACK      EHCPCOD,FLD60014,SP10   * Fld. 14 - cmh_d_xtrastaff.hcp_id
          CALL      EDHCP000
          MOVE      HCPIBACD,ALENUHC3
.
          MOVE      "15",FLDNO
          MOVE      "HCP",EHCPCAT
          PACK      EHCPCOD,FLD60015,SP10   * Fld. 15 - cmh_d_xtrastaff.hcp_id
          CALL      EDHCP000
          MOVE      HCPIBACD,ALENUHC4
.
          PACK      ALENUFF1,FLD60016,SP70  * Fld. 16 - cmh_d_cont_patient.ud01_
          PACK      ALENUFF2,FLD60017,SP70  * Fld. 17 - cmh_d_cont_patient.ud02_
          PACK      ALENUFF3,FLD60018,SP70  * Fld. 18 - cmh_d_contact.contact_id
.
          MOVE      "20",FLDNO
          MOVE      "TPCON",ECATCAT
          PACK      ECATCOD,FLD60020,SP10   * Fld. 20 - cmh_d_contact.contact_ty
          CALL      EDCAT000
          MOVE      PCATCOD,ALENUC01        * Cat. "zb"
.
          MOVE      "21",FLDNO
          MOVE      "PCUBF",ECATCAT
          PACK      ECATCOD,FLD60021,SP10   * Fld. 21 - cmh_d_cont_patient.ud01_
          CALL      EDCAT000
          MOVE      PCATCOD,ALENUC02        * Cat. "zb"
.   
          MOVE      "22",FLDNO
          MOVE      "CON02",ECATCAT
          PACK      ECATCOD,FLD60022,SP10   * Fld. 22 - cmh_d_cont_patient.ud02_
          CALL      EDCAT000
          MOVE      PCATCOD,ALENUC03        * Cat. "zc"
.
          MOVE      FLD60023,FLD60IN        * Fld. 23 - cmh_d_cont_patient.trave
          MOVE      "8",LENGTH              * retrieve No and right justify
          CALL      RJUS0000                * right justify duration
          CALL      EDNUM000
          MOVE      FLD60OUT,ALENUF11
.
          MOVE      FLD60024,FLD60IN        * Fld. 24 - cmh_d_cont_patient.trave
          MOVE      "8",LENGTH              * retrieve No and right justify
          CALL      RJUS0000                * right justify duration
          CALL      EDNUM000
          MOVE      FLD60OUT,ALENUF12
.
          MOVE      FLD60025,FLD60IN        * Fld. 25 - cmh_d_cont_patient.ud01_
          MOVE      "8",LENGTH              * retrieve No and right justify
          CALL      RJUS0000                * right justify duration
          CALL      EDNUM000
          MOVE      FLD60OUT,ALENUF13
.
          MOVE      FLD60026,FLD60IN        * Fld. 26 - cmh_d_cont_patient.ud02_
          MOVE      "8",LENGTH              * retrieve No and right justify
          CALL      RJUS0000                * right justify duration
          CALL      EDNUM000
          MOVE      FLD60OUT,ALENUF14
.
          MOVE      "27",FLDNO
          MOVE      "HCP",EHCPCAT
          PACK      EHCPCOD,FLD60027,SP10   * Fld. 27 - cmh_d_cont_patient.actua
          CALL      EDHCP000
          MOVE      HCPIBACD,ALENUF15
.
.                                           * moved from Fld.2        *M-179355
          MOVE      "28",FLDNO              * Fld. 28 - cmh_d_cont_patient.item_
          MOVE      FLD60028,FLD60IN
          MOVE      "8",LENGTH              * retrieve No and right justify
          CALL      RJUS0000                * right justify duration
          CALL      EDNUM000
          MOVE      FLD60OUT,ALENUF16                                 *C-179344
.
          MOVE      "29",FLDNO
          MOVE      FLD60029,FLD60IN        * Fld. 29 - cmh_d_cont_patient.au_da
          CALL      EDDAT000
          MOVE      DIM8A,ALENCDAT
.
          MOVE      "30",FLDNO
          MOVE      FLD60030,FLD60IN        * Fld. 30 - cmh_d_cont_patient.au_ti
          CALL      EDTIM000
          MOVE      DIM8A,ALENCTIM
.
          MOVE      "31",FLDNO
          MOVE      "USR",EHCPCAT
          PACK      EHCPCOD,FLD60031,SP10   * Fld. 31 - cmh_d_cont_patient.au_us
          CALL      EDHCP000
          MOVE      HCPIBACD,ALENCUID
.   
          MOVE      "32",FLDNO
          MOVE      "BLCL ",ECATCAT
          PACK      ECATCOD,FLD60032,SP10   * Fld. 32 - hce_d_feesch.claim_code_
          CALL      EDCAT000
          MOVE      PCATCOD,ALENCOMP        * Cat. "CL"
.   
          MOVE      "33",FLDNO
          MOVE      "EOC01",ECATCAT
          PACK      ECATCOD,FLD60033,SP10   * Fld. 33 - eoc_d_detail.ud01_cd
          CALL      EDCAT000
          MOVE      PCATCOD,ALENPURC        * Cat. "HP"
.   
          MOVE      "34",FLDNO
          MOVE      "CONTC",ECATCAT
          PACK      ECATCOD,FLD60034,SP10   * Fld. 34 - hce_d_detail.contract_cd
          CALL      EDCAT000
          MOVE      PCATCOD,ALENCONT        * Cat. "gb"
.
          MOVE      "1",ALENMOHR
.
.                                           ***********************************
.
.                                           * setup "CON" links in EID_ID table
PCON5000  UNPACK    SP70,EIDVISNO,EIDENCNO,EIDSESNO,EIDCONNO,EIDTEST
          UNPACK    SP70,EIDOOONO,EIDSPAR
          MOVE      "CON",EIDIDCOD
          PACK      EIDIDNO,FLD60018,SP30   * Fld. 18 - cmh_d_contact.contact_id
          MOVE      ALENVISN,EIDVISNO
          MOVE      ALENENCT,EIDENCNO
          IF        OPTION = 1
            MOVE      "T",EIDTEST
          ENDIF
          PACK      KEY23,EIDIDCOD,EIDIDNO,SP30
          CALL      RATMEID1
          COMPARE   ZERO,OVRCD
          GOTO      PCON7001 IF EQUAL
.
          CALL      WRTMEID1                * write EID_ID semi-temp file
.
.
PCON5500  BRANCH    OPTION,PCON9999,PCON8000  * check if Edit or Upload
          GOTO      PCON8000
.                                           
.
PCON7000  CLEAR     ERRMESS
          MOVE      "  ",FLDNO
          APPEND    "Referral recd. not found for Id. '",ERRMESS
          APPEND    FLD60019,ERRMESS
          APPEND    "' - record bypassed *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PCON9999
.
PCON7001  CLEAR     ERRMESS
          MOVE      "  ",FLDNO
          APPEND    "Encounter No. '",ERRMESS
          SQUEEZE   EIDIDNO
          APPEND    EIDIDNO,ERRMESS
          APPEND    "' already processed - record bypassed",ERRMESS
          APPEND    " *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PCON9999
.
PCON7002  CLEAR     ERRMESS
          APPEND    "The link key field 'hce_id' for '",ERRMESS
          SQUEEZE   EIDIDNO
          APPEND    EIDIDNO,ERRMESS
          APPEND    "' is blank - record bypassed *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PCON9999
.
.
.                                           * write the record
PCON8000  PACK      KEY16,ALENVISN,ALENENCT,SP20
          CALL      RDALENC1
          IF        OVRCD = 1
            CALL      WRALENC1              * write "allencaf"
            ADD       ONE,ALLENCXX
          ENDIF
.
PCON9999  RETURN
+
.******************************************************************************
.*                                  PINT0000                                  *
.*                     "INT" Process Interventions                            *
.******************************************************************************
PINT0000  MOVE      ZERO,EXIT
          CALL      CXALLITV
          CALL      CLECL000                * clear Eclipse input variables
.
          READ      INECLTXT,SEQ;FLD60001,FLD60002,FLD60003,FLD60004,FLD60005:
                                 FLD60006
.           
.              
          PACK      ERRDATA,ECLRECID,SP1,FLD60001,SP1,FLD60002,SP1:
                            FLD60003,SP1,FLD60004,SP1,FLD60005,SP70
          PACK      UNIQUEID,FLD60001,SP20
          MATCH     SP20,UNIQUEID
          GOTO      PINT7002 IF EQUAL
.
PINT0500  MOVE      "CON",DIM3A             * check the contact_id in "EID" tabl
          PACK      FLD60IN,FLD60001,SP30   * Fld. 1 - cmh_d_treatment.cont_id
          PACK      KEY23,DIM3A,FLD60IN
          CALL      RDTMEID1                * See if cont_id has been processed
          BRANCH    OVRCD,PINT7000
.
.                                           * set up "allitvaf"
PINT1000  MOVE      EIDVISNO,ALIVVISN
          MOVE      EIDENCNO,ALIVENCT
.
          MOVE      " 2",FLDNO
          MOVE      FLD60002,FLD60IN        * Fld.  2 - alvicnt
          MOVE      "8",LENGTH              * retrieve No and right justify
          CALL      RJUS0000                * right justify count  
          CALL      EDNUM000
          MOVE      FLD60OUT,ALIVICNT
.   
          MOVE      " 3",FLDNO
          MOVE      "TREAT",ECATCAT
          PACK      ECATCOD,FLD60003,SP10   * Fld.  3 - cmh_d_treatment.treatmen
          CALL      EDCAT000
          MOVE      PCATCOD,ALIVCODE        * "allincaf"
.
          MOVE      " 4",FLDNO
          MOVE      FLD60004,FLD60IN        * Fld.  4 - cmh_d_treatment.aw_dat
          CALL      EDDAT000
          MOVE      DIM8A,ALIVCDAT
.
          MOVE      " 5",FLDNO
          MOVE      FLD60005,FLD60IN        * Fld.  5 - cmh_d_treatment.aw_time
          CALL      EDTIM000
          MOVE      DIM8A,ALIVCTIM
.
          MOVE      " 6",FLDNO
          MOVE      "USR",EHCPCAT
          PACK      EHCPCOD,FLD60006,SP10   * Fld.  6 - cmh_d_treatment.aw_user
          CALL      EDHCP000
          MOVE      HCPIBACD,ALIVCUID
.
.                                           ***********************************
.
          BRANCH    OPTION,PINT9999,PINT8000  * check if Edit or Upload
          GOTO      PINT8000
.
.
PINT7000  CLEAR     ERRMESS
          MOVE      "  ",FLDNO
          APPEND    "Encounter recd. not found for Id. '",ERRMESS
          APPEND    FLD60001,ERRMESS
          APPEND    "' - record bypassed *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PINT9999
.
PINT7002  CLEAR     ERRMESS
          APPEND    "The link key field 'cont_id' ",ERRMESS
          APPEND    "is blank - record bypassed *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PINT9999
.
.
.                                           * write the records
PINT8000  PACK      KEY24,ALIVVISN,ALIVENCT,ALIVICNT,SP20
          CALL      RDALITV1
          IF        OVRCD = 1
            CALL      WRALITV1              * write "allitvaf"
            ADD       ONE,ALLITVXX
          ENDIF
.
.
PINT9999  RETURN
+
.******************************************************************************
.*                                  PSUP0000                                  *
.*                        "SUP" Process Supplies                              *
.******************************************************************************
PSUP0000  MOVE      ZERO,EXIT
          CALL      CXALLSUP
          CALL      CLECL000                * clear Eclipse input variables
.
          READ      INECLTXT,SEQ;FLD60001,FLD60002,FLD60003,FLD60004,FLD60005:
                                 FLD60006
.
.
          PACK      ERRDATA,ECLRECID,SP1,FLD60001,SP1,FLD60002,SP1:
                            FLD60003,SP1,FLD60004,SP1,FLD60005,SP70
          PACK      UNIQUEID,FLD60001,SP20
          MATCH     SP20,UNIQUEID
          GOTO      PSUP7002 IF EQUAL
.
PSUP0500  MOVE      "CON",DIM3A             * check the contact_id in "EID" tabl
          PACK      FLD60IN,FLD60001,SP30   * Fld. 1 - cmh_d_supply.contact_id
          PACK      KEY23,DIM3A,FLD60IN
          CALL      RDTMEID1                * See if cont_id has been processed
          BRANCH    OVRCD,PSUP7000
.
.                                           * set up "allsupaf"
PSUP1000  MOVE      EIDVISNO,ALSPVISN
          MOVE      EIDENCNO,ALSPENCT
.
          MOVE      " 2",FLDNO
          MOVE      FLD60002,FLD60IN        * Fld.  2 - cmh_d_supply.quantity
          MOVE      "8",LENGTH              * retrieve No and right justify
          CALL      RJUS0000                * right justify quantity
          CALL      EDNUM000
          MOVE      FLD60OUT,ALSPSCNT
.
          MOVE      " 3",FLDNO
          MOVE      "SUPPY",ECATCAT
          PACK      ECATCOD,FLD60003,SP10   * Fld.  3 - cmh_d_supply.supply_cd
          CALL      EDCAT000
          MOVE      PCATCOD,ALSPSCOD        * "sinciaaf"
.
          MOVE      " 4",FLDNO
          MOVE      FLD60004,FLD60IN        * Fld.  4 - cmh_d_supply.aw_dat
          CALL      EDDAT000
          MOVE      DIM8A,ALSPCDAT
.
          MOVE      " 5",FLDNO
          MOVE      FLD60005,FLD60IN        * Fld.  5 - cmh_d_supply.aw_time
          CALL      EDTIM000
          MOVE      DIM8A,ALSPCTIM
.
          MOVE      " 6",FLDNO
          MOVE      "USR",EHCPCAT
          PACK      EHCPCOD,FLD60006,SP10   * Fld.  6 - cmh_d_supply.aw_user
          CALL      EDHCP000
          MOVE      HCPIBACD,ALSPCUID
.
.                                           ***********************************
.
          BRANCH    OPTION,PSUP9999,PSUP8000  * check if Edit or Upload
          GOTO      PSUP8000
.
.
PSUP7000  CLEAR     ERRMESS
          MOVE      "  ",FLDNO
          APPEND    "Encounter recd. not found for Id. '",ERRMESS
          APPEND    FLD60001,ERRMESS
          APPEND    "' - record bypassed *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PSUP9999
.
PSUP7002  CLEAR     ERRMESS
          APPEND    "The link key field 'contact_id' ",ERRMESS
          APPEND    "is blank - record bypassed *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PSUP9999
.
.
.                                           * write the records
PSUP8000  PACK      KEY24,ALSPVISN,ALSPENCT,ALSPSCNT,SP20
          CALL      RDALSUP1
          IF        OVRCD = 1
            CALL      WRALSUP1              * write "allsupaf"
            ADD       ONE,ALLSUPXX
          ENDIF
.
PSUP9999  RETURN
+
.******************************************************************************
.*                                  PSES0000                                  *
.*                "SES" Process Group Session Maintenance                     *
.******************************************************************************
PSES0000  MOVE      ZERO,EXIT       
          CALL      CXALLGRO
          CALL      CLECL000                * clear Eclipse input variables
.
          READ      INECLTXT,SEQ;FLD60001,FLD60002,FLD60003,FLD60004,FLD60005:
                                 FLD60006,FLD60007,FLD60008,FLD60009
.
.
          PACK      ERRDATA,ECLRECID,SP1,FLD60001,SP1,FLD60002,SP1:
                            FLD60003,SP1,FLD60004,SP1,FLD60005,SP70
          PACK      UNIQUEID,FLD60008,SP20
          MATCH     SP20,UNIQUEID
          GOTO      PSES7002 IF EQUAL
.
PSES0500  MOVE      "SES",DIM3A
          PACK      FLD60IN,FLD60008,SP30   * Fld. 8 - cmh_r_program.program_id
          PACK      KEY23,DIM3A,FLD60IN
          CALL      RATMEID1
          COMPARE   ZERO,OVRCD
          GOTO      PSES7000 IF EQUAL
.
          CALL      NXTSES00                * get next Session number
          MOVE      SESSNNO,ALGRSESN
.
.                                           * set up "allgroaf"
PSES1000  PACK      ALGRNAME,FLD60001,SP70  * Fld. 1 - cmh_r_program.description
.         
          MOVE      " 2",FLDNO
          MOVE      "TPPRG",ECATCAT
          PACK      ECATCOD,FLD60002,SP10   * Fld. 2 - cmh_r_program.type_cd
          CALL      EDCAT000                
          MOVE      PCATCOD,ALGRSEST        * Cat. "gy"
.         
          MOVE      " 3",FLDNO
          MOVE      "PGLOC",ECATCAT
          PACK      ECATCOD,FLD60003,SP10   * Fld. 3 - cmh_r_program.location_cd
          CALL      EDCAT000                
          MOVE      PCATCOD,ALGRLOCN        * Cat. "PO"
.
          MOVE      " 4",FLDNO
          MOVE      FLD60004,FLD60IN        * Fld.  4 - cmh_d_program.start_dat
          CALL      EDDAT000
          MOVE      DIM8A,ALGRSDAT
.
          MOVE      " 5",FLDNO
          MOVE      FLD60005,FLD60IN        * Fld.  5 - cmh_d_program.start_time
          CALL      EDTIM000
          MOVE      DIM8A,ALGRSTIM
.
          MOVE      " 6",FLDNO
          PACK      DIM1A,FLD60006,SP1      * Fld. 6 - cmh_r_program.weekday
          MOVE      DIM1A,F1
          IF        F1 < 1 | F1 > 7
            APPEND    "Day Number is not valid - '",ERRMESS
            APPEND    DIM1A,ERRMESS
            APPEND    "'",ERRMESS
            CALL      PRNT0000
          ENDIF
          MOVE      DIM1A,ALGRDAYI
.         
          MOVE      " 7",FLDNO
          MOVE      "PROGM",ECATCAT
          PACK      ECATCOD,FLD60007,SP10   * Fld. 7 - cmh_r_program.freq_descri
          CALL      EDCAT000                
          MOVE      PCATCOD,ALGRFREQ        * Cat. "fr"
.
....      PACK      ALGRSPAR,FLD60008,SP70  * Fld. 8 - cmh_r_program.program_id
          PACK      ALGRSPAR,SP70
          PACK      ALGRACTV,FLD60009,SP10  * Fld. 9 - Active/Inactive
.
.                                           ***********************************
.
.                                           * setup "SES" links in EID_ID table
PSES5000  UNPACK    SP70,EIDVISNO,EIDENCNO,EIDSESNO,EIDCONNO,EIDTEST
          UNPACK    SP70,EIDOOONO,EIDSPAR
          MOVE      "SES",EIDIDCOD
          PACK      EIDIDNO,FLD60008,SP20   * Fld. 8 - cmh_r_program.program_id
          MOVE      ALGRSESN,EIDSESNO
          IF        OPTION = 1
            MOVE      "T",EIDTEST
          ENDIF
          PACK      KEY23,EIDIDCOD,EIDIDNO,SP30
          CALL      RATMEID1
          COMPARE   ZERO,OVRCD
          GOTO      PSES7000 IF EQUAL
.
          CALL      WRTMEID1                * write EID_ID semi-temp file
.
.
          BRANCH    OPTION,PSES9999,PSES8000  * check if Edit or Upload
          GOTO      PSES8000
.
.
PSES7000  CLEAR     ERRMESS
          MOVE      "  ",FLDNO
          APPEND    "Group Session program '",ERRMESS
          SQUEEZE   EIDIDNO
          APPEND    EIDIDNO,ERRMESS
          APPEND    "' already processed - record bypassed",ERRMESS
          APPEND    " *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PSES9999
.
PSES7002  CLEAR     ERRMESS
          APPEND    "The link key field 'program_id' for '",ERRMESS
          SQUEEZE   EIDIDNO
          APPEND    EIDIDNO,ERRMESS
          APPEND    "' is blank - record bypassed *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PSES9999
.
.                                           * write the records
PSES8000  PACK      KEY8,ALGRSESN,SP20
          CALL      RDALGRO1
          IF        OVRCD = 1
            CALL      WRALGRO1              * write "allgroaf"
            ADD       ONE,ALLGROXX
          ENDIF
.
PSES9999  RETURN
+
.******************************************************************************
.*                                  PGRP0000                                  *
.*               "GRP" Process Group Encounters - Session Details             *
.******************************************************************************
PGRP0000  MOVE      ZERO,EXIT
          CALL      CXALLGRE
          CALL      CLECL000                * clear Eclipse input variables
.
          READ      INECLTXT,SEQ;FLD60001,FLD60002,FLD60003,FLD60004,FLD60005:
                                 FLD60006,FLD60007,FLD60008,FLD60009
.
.
          PACK      ERRDATA,ECLRECID,SP1,FLD60001,SP1,FLD60002,SP1:
                            FLD60003,SP1,FLD60004,SP1,FLD60005,SP70
          PACK      UNIQUEID,FLD60009,SP20
          MATCH     SP20,UNIQUEID
          GOTO      PGRP7002 IF EQUAL
.
PGRP0500  MOVE      "GRP",DIM3A             * check if already processed
          PACK      FLD60IN,FLD60009,SP30   * Fld. 9 - cmh_r_group_contact.grp_c
          PACK      KEY23,DIM3A,FLD60IN
          CALL      RATMEID1
          COMPARE   ZERO,OVRCD
          GOTO      PGRP7001 IF EQUAL
.
          PACK      FLD60IN,FLD60001,SP70   * Fld. 1 - cmh_d_program.program_id
          MOVE      "SES",DIM3A             * check the program_id in "SES" tabl
          PACK      KEY23,DIM3A,FLD60IN
          CALL      RDTMEID1                * See if prgm_id has been processed
          BRANCH    OVRCD,PGRP7000
.
          CALL      NXTCON00                * get next Contact number
.
.                                           * set up "allgreaf"
PGRP1000  MOVE      CONTRNO,ALGECONT        * from next Contact number
          MOVE      EIDSESNO,ALGESESN       * from "SES" EID record
.
          MOVE      " 2",FLDNO
          MOVE      "PGLOC",ECATCAT
          PACK      ECATCOD,FLD60002,SP10   * Fld. 2 - cmh_r_group_contact.locat
          CALL      EDCAT000
          MOVE      PCATCOD,ALGELOCN        * Cat. "PO"
.
          MOVE      " 3",FLDNO
          MOVE      FLD60003,FLD60IN        * Fld.  3 - cmh_d_group_contact.sess
          CALL      EDDAT000
          MOVE      DIM8A,ALGEGDTE
.
          MOVE      " 4",FLDNO
          MOVE      FLD60004,FLD60IN        * Fld.  4 - cmh_d_group_contact.sess
          CALL      EDTIM000
          MOVE      DIM8A,ALGEGTIM
.
          MOVE      " 5",FLDNO
          MOVE      FLD60005,FLD60IN        * Fld.  5 - cmh_d_group_contact.dura
          MOVE      "3",LENGTH              * retrieve no. and right justify
          CALL      RJUS0000                * right justify quantity
          CALL      EDNUM000
          MOVE      FLD60OUT,ALGEDURN
.
          MOVE      " 6",FLDNO
          MOVE      FLD60006,FLD60IN        * Fld.  6 - cmh_d_group_contact.aw_d
          CALL      EDDAT000
          MOVE      DIM8A,ALGECDAT
.         
          MOVE      " 7",FLDNO
          MOVE      FLD60007,FLD60IN        * Fld.  7 - cmh_d_group_contact.aw_t
          CALL      EDTIM000
          MOVE      DIM8A,ALGECTIM
.                                           
          MOVE      " 8",FLDNO
          MOVE      "USR",EHCPCAT
          PACK      EHCPCOD,FLD60008,SP10   * Fld.  8 - cmh_d_group_contact.aw_u
          CALL      EDHCP000
          MOVE      HCPIBACD,ALGECUID
.
.                                           ***********************************
.
.                                           * setup "GRP" links in EID_ID table
PGRP5000  UNPACK    SP70,EIDVISNO,EIDENCNO,EIDSESNO,EIDCONNO,EIDTEST
          UNPACK    SP70,EIDOOONO,EIDSPAR
          MOVE      "GRP",EIDIDCOD
          PACK      EIDIDNO,FLD60009,SP20   * Fld. 9 - cmh_r_group_contact.grp_c
          MOVE      ALGESESN,EIDSESNO
          MOVE      ALGECONT,EIDCONNO
          IF        OPTION = 1
            MOVE      "T",EIDTEST
          ENDIF
          PACK      KEY23,EIDIDCOD,EIDIDNO,SP30
          CALL      RATMEID1
          COMPARE   ZERO,OVRCD
          GOTO      PGRP7001 IF EQUAL
.
          CALL      WRTMEID1                * write EID_ID semi-temp file
.
.
          BRANCH    OPTION,PGRP9999,PGRP8000  * check if Edit or Upload
          GOTO      PGRP8000
.
.
PGRP7000  CLEAR     ERRMESS
          MOVE      "  ",FLDNO
          APPEND    "Group Session Program Id. '",ERRMESS
          APPEND    FLD60001,ERRMESS
          APPEND    "' not found - record bypassed *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PGRP9999
.
.
PGRP7001  CLEAR     ERRMESS
          MOVE      "  ",FLDNO
          APPEND    "Group Session Contact '",ERRMESS
          SQUEEZE   EIDIDNO
          APPEND    EIDIDNO,ERRMESS
          APPEND    "' already processed - record bypassed",ERRMESS
          APPEND    " *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PGRP9999
.
PGRP7002  CLEAR     ERRMESS
          APPEND    "The link key field 'group_cont_id' for '",ERRMESS
          SQUEEZE   EIDIDNO
          APPEND    EIDIDNO,ERRMESS
          APPEND    "' is blank - record bypassed *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PGRP9999
.                                           * write the record 
PGRP8000  PACK      KEY8,ALGECONT,SP20
          CALL      RDALGRE1
          IF        OVRCD = 1
            CALL      WRALGRE1              * write "allgreaf"
            ADD       ONE,ALLGREXX
          ENDIF
.
PGRP9999  RETURN
+
.******************************************************************************
.*                                  PGCT0000                                  *
.*                "GCT" Process Group Encounters - Patient Details            *
.******************************************************************************
PGCT0000  MOVE      ZERO,EXIT       
          CALL      CXALLGPA
          CALL      CLECL000                * clear Eclipse input variables
.
          READ      INECLTXT,SEQ;FLD60001,FLD60002,FLD60003,FLD60004,FLD60005:
                                 FLD60006,FLD60007,FLD60008,FLD60009
.
.
          PACK      ERRDATA,ECLRECID,SP1,FLD60001,SP1,FLD60002,SP1:
                            FLD60003,SP1,FLD60004,SP1,FLD60005,SP70
          PACK      UNIQUEID,FLD60009,SP20
          MATCH     SP20,UNIQUEID
          GOTO      PGCT7002 IF EQUAL
.
.
PGCT0500  MOVE      "EOC",DIM3A             * check the initial referral "EOC"
          PACK      FLD60IN,FLD60002,SP30   * Fld. 2  - hce_d_detail.hce_id
          PACK      KEY23,DIM3A,FLD60IN
          CALL      RDTMEID1                * See if eoc_id has been processed
          IF        OVRCD = 1
            MOVE      "HCE",DIM3A           * check the "HCE" linked referrals
            PACK      KEY23,DIM3A,FLD60IN
            CALL      RDTMEID1              * See if hce_id has been processed
            BRANCH    OVRCD,PGCT7000
          ENDIF
.
.                                           * set up "allgpaaf"
PGCT1000  MOVE      EIDVISNO,ALGAREFN
.
          MOVE      "GRP",DIM3A             * check the contact_id in "EID" tabl
          PACK      FLD60IN,FLD60009,SP70   * Fld. 9 - cmh_d_gc_hce.grp_cont_id
          PACK      KEY23,DIM3A,FLD60IN
          CALL      RDTMEID1                * See if cont_id has been processed
          BRANCH    OVRCD,PGCT7001
.
          MOVE      EIDCONNO,ALGACONT
.
          MOVE      " 1",FLDNO
          MOVE      FLD60001,FLD60IN        * Fld 1 - pmi_d_altid.altid_value
          CALL      EDURNO00                * edit UR No.
          BRANCH    EXIT,PGCT9999
          MOVE      PURNO,ALGAURNO
.
          MOVE      " 3",FLDNO
          PACK      DIM1A,FLD60003,SP1      * Fld. 3 - cmh_d_gc_hce.current_inpa
          CALL      EDYN0000
          MOVE      DIM1A,ALGACURP
.
          MOVE      " 4",FLDNO
          MOVE      "GCST ",ECATCAT
          PACK      ECATCOD,FLD60004,SP10   * Fld. 4 - cmh_d_gc_hce.status_cd
          CALL      EDCAT000
          MOVE      PCATCOD,ALGAPSTA        * Cat. "GA"
.
          MOVE      " 5",FLDNO
          PACK      DIM1A,FLD60005,SP1      * Fld. 5 - cmh_d_group_contac.meals_
          CALL      EDYN0000
          MOVE      DIM1A,ALGAMEAL
.
          MOVE      "1",ALGAMOHX
.
          MOVE      " 6",FLDNO
          MOVE      FLD60006,FLD60IN        * Fld. 6 - cmh_d_group_contact.aw_da
          CALL      EDDAT000
          MOVE      DIM8A,ALGACDAT
.
          MOVE      " 7",FLDNO
          MOVE      FLD60007,FLD60IN        * Fld. 7 - cmh_d_group_contact.aw_ti
          CALL      EDTIM000
          MOVE      DIM8A,ALGACTIM
.                                           
          MOVE      " 8",FLDNO
          MOVE      "USR",EHCPCAT
          PACK      EHCPCOD,FLD60008,SP10   * Fld.  8 - cmh_d_group_contact.aw_u
          CALL      EDHCP000
          MOVE      HCPIBACD,ALGACUID
.
.                                           ***********************************
.
          BRANCH    OPTION,PGCT9999,PGCT8000  * check if Edit or Upload
          GOTO      PGCT8000
.                             
.         
PGCT7000  CLEAR     ERRMESS
          MOVE      "  ",FLDNO
          APPEND    "Referral recd. not found for Id. '",ERRMESS
          APPEND    FLD60002,ERRMESS
          APPEND    "' - record bypassed *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PGCT9999
.         
PGCT7001  CLEAR     ERRMESS
          MOVE      "  ",FLDNO
          APPEND    "Group Contact recd. not found for Id. '",ERRMESS
          APPEND    FLD60009,ERRMESS
          APPEND    "' - record bypassed *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PGCT9999
.
PGCT7002  CLEAR     ERRMESS
          APPEND    "The link key field 'grp_cont_id' ",ERRMESS
          APPEND    "is blank - record bypassed *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PGCT9999
.
.
.                                           * write the records
PGCT8000  PACK      KEY16,ALGACONT,ALGAREFN,SP20
          CALL      RDALGPA1
          IF        OVRCD = 1
            CALL      WRALGPA1              * write "allgpaaf"
            ADD       ONE,ALLGPAXX
          ENDIF
.
PGCT9999  RETURN    
+
.******************************************************************************
.*                                  PRES0000                                  *
.*                  "RES" Process Residential Admissions                      *
.******************************************************************************
PRES0000  MOVE      ZERO,EXIT
          CALL      CLPATMIS
          CALL      CXALLRSA
          CALL      CLPATDSC
          CALL      CLPATTRN
          CALL      CLPATVIS
          CALL      CLPMSVX1
          CALL      CLECL000                * clear Eclipse input variables
.
          READ      INECLTXT,SEQ;FLD60001,FLD60002,FLD60003,FLD60004,FLD60005:
                                 FLD60006,FLD60007,FLD60008,FLD60009,FLD60010:
                                 FLD60011,FLD60012,FLD60013,FLD60014,FLD60015
.
.
          PACK      ERRDATA,ECLRECID,SP1,FLD60001,SP1,FLD60002,SP1:
                            FLD60003,SP1,FLD60004,SP1,FLD60005,SP70
          PACK      UNIQUEID,FLD60004,SP20
          MATCH     SP20,UNIQUEID
          GOTO      PRES7002 IF EQUAL
.
.
PRES0500  MOVE      "EOC",DIM3A             * check the initial referral "EOC"
          PACK      FLD60IN,FLD60004,SP30   * Fld. 4 - hce_d_resi_admit.hce_id
          PACK      KEY23,DIM3A,FLD60IN
          CALL      RDTMEID1                * See if eoc_id has been processed
          IF        OVRCD = 1
            MOVE      "HCE",DIM3A           * check the "HCE" linked referrals
            PACK      KEY23,DIM3A,FLD60IN
            CALL      RDTMEID1              * See if hce_id has been processed
            BRANCH    OVRCD,PRES7000
          ENDIF
.
          MOVE      "RES",DIM3A             * check if Residential Admis. done
          PACK      KEY23,DIM3A,FLD60IN
          CALL      RDTMEID1                * See if eoc_id has been processed
          IF        OVRCD = 0
            GOTO      PRES7001
          ENDIF
.
.                                           * set up "allrsaaf"
PRES1000  MOVE      EIDVISNO,ALRAVISN
          CALL      NXTVIS00                * get new Visit/Admission No.
          MOVE      VISITNO,RESADMNO        * save admission no.
          MOVE      VISITNO,ALRALADM
.
          MOVE      " 1",FLDNO
          MOVE      FLD60001,FLD60IN        * Fld. 1 - hce_d_resi_admit.aw_date
          CALL      EDDAT000
          MOVE      DIM8A,ALRACDAT
.
          MOVE      " 2",FLDNO
          MOVE      FLD60002,FLD60IN        * Fld. 2 - hce_d_resi_admit.aw_time 
          CALL      EDTIM000
          MOVE      DIM8A,ALRACTIM
.                                           
          MOVE      " 3",FLDNO
          MOVE      "USR",EHCPCAT
          PACK      EHCPCOD,FLD60003,SP10   * Fld. 3 - hce_d_resi_admit.aw_user
          CALL      EDHCP000
          MOVE      HCPIBACD,ALRACUID
.
.                                           * set up "patmi1af"
PRES2000  MOVE      RESADMNO,AADMNO
.
          MOVE      "12",FLDNO
          MOVE      FLD60012,FLD60IN        * Fld. 12 - hce_d_resi_disch.disch_d
          CALL      EDDAT000
          MATCH     SP8,DIM8A
          IF        @EQUAL
            MOVE      "2",ASTAT             * currently admitted
          ELSE
            MOVE      "3",ASTAT             * discharged
            MOVE      "1",AELIG
            MOVE      DIM8A,ACODDTE
          ENDIF
.
          MOVE      "15",FLDNO
          MOVE      FLD60015,FLD60IN        * Fld 15 - UR Number
          CALL      EDURNO00                * edit UR No.
          BRANCH    EXIT,PRES9999
          MOVE      PURNO,AURNO
.
          MOVE      " 9",FLDNO
          IF        ASTAT = 2
            MOVE      "HSREQ",ECATCAT       * currently admitted
            PACK      ECATCOD,FLD60009,SP10 * Fld. 9 - hce_d_resi_admit.house_re
            CALL      EDCAT000
            MOVE      PCATCOD,AWARD           * "patwr1af"
          ENDIF
.
          MOVE      " 5",FLDNO
          MOVE      FLD60005,FLD60IN        * Fld. 5 - hce_d_resi_admit.admit_da
          CALL      EDDAT000
          MOVE      DIM8A,ADATE
.
          MOVE      " 6",FLDNO
          MOVE      FLD60006,FLD60IN        * Fld. 6 - hce_d_resi_admit.admit_ti
          CALL      EDTIM000
          MOVE      DIM8A,ATIME
.
          MOVE      " 7",FLDNO
          MOVE      "LOFCA",ECATCAT
          PACK      ECATCOD,FLD60007,SP10   * Fld. 7 - hce_d_resi_admit.level_of
          CALL      EDCAT000
          MOVE      PCATCOD,ACLSS           * Cat."P "  
.
          MOVE      " 8",FLDNO
          MOVE      "SOR  ",ECATCAT
          PACK      ECATCOD,FLD60008,SP10   * Fld. 8 - eoc_d_detail.ref_source_c
          CALL      EDCAT000
          MOVE      PCATCOD,ASRCE           * Cat."S "   
.
          MOVE      "IM ",ATYPE              * Cat."A "   
          MOVE      "RSATY       ",KEY12                                * 12/11
          CALL      RDTCAT1                 * read the Category Mapping table
          IF        OVRCD = 0
            MOVE      PCATCOD,ATYPE
          ENDIF
.
          MOVE      "10",FLDNO
          MOVE      "HCP",EHCPCAT
          PACK      EHCPCOD,FLD60010,SP10   * Fld. 10 - hce_d_detail.resp_hcp_fk
          CALL      EDHCP000
          MOVE      HCPIBACD,ADOCTA
.
          MOVE      "11",FLDNO
          MOVE      "BLCL ",ECATCAT
          PACK      ECATCOD,FLD60011,SP10   * Fld. 11 - hce_d_feesch.claim_code_
          CALL      EDCAT000
          MOVE      PCATCOD,ACLAIM          * Cat."CL"
.
.
PRES3000  COMPARE   "3",ASTAT
          GOTO      PRES4000 IF NOT EQUAL
.                                           * set up "patdscaf"
          MOVE      RESADMNO,DADMNO
          MOVE      AURNO,DURNO
.
          MOVE      "12",FLDNO
          MOVE      FLD60012,FLD60IN        * Fld. 12 - hce_d_resi_disch.disch_d
          CALL      EDDAT000
          MATCH     SP8,DIM8A
          IF        !@EQUAL
            MOVE      DIM8A,DDATE
          ENDIF
.
          MOVE      "13",FLDNO
          MOVE      FLD60013,FLD60IN        * Fld. 13 - hce_d_resi_disch.disch_d
          CALL      EDTIM000
          MATCH     SP8,DIM8A
          IF        !@EQUAL
            MOVE      DIM8A,DTIME
          ENDIF
.
          MOVE      "14",FLDNO
          MOVE      "HSREQ",ECATCAT
          PACK      ECATCOD,FLD60014,SP10   * Fld. 14 - hce_d_feesch.claim_code_
          CALL      EDCAT000
          MOVE      PCATCOD,PTDSDWRD        * "patwd1af"
.
.                                           * set up "pattranf" "A"
PRES4000  MOVE      " 9",FLDNO
          MOVE      "A",TMOVE
          MOVE      "HSREQ",ECATCAT
          PACK      ECATCOD,FLD60009,SP10   * Fld. 9 - hce_d_resi_admit.house_re
          CALL      EDCAT000
          MOVE      PCATCOD,TWARD           * "patwr1af"
.
          MOVE      " 5",FLDNO
          MOVE      FLD60005,FLD60IN        * Fld. 5 - hce_d_resi_admit.admit_da
          CALL      EDDAT000
          MOVE      DIM8A,TDATE
.
          MOVE      " 6",FLDNO
          MOVE      FLD60006,FLD60IN        * Fld. 6 - hce_d_resi_admit.admit_ti
          CALL      EDTIM000
          MOVE      DIM8A,TTIME
.
          MOVE      AURNO,TURNO
          MOVE      RESADMNO,TADMN
.
          MOVE      "IM ",TATYPE            * Cat."A "   
          MOVE      "RSATY       ",KEY12                               * 12/11
          CALL      RDTCAT1                 * read the Category Mapping table
          IF        OVRCD = 0
            MOVE      PCATCOD,TATYPE
          ENDIF
.
          MOVE      "10",FLDNO
          MOVE      "HCP",EHCPCAT
          PACK      EHCPCOD,FLD60010,SP10   * Fld. 10 - hce_d_detail.resp_hcp_fk
          CALL      EDHCP000
          MOVE      HCPIBACD,TADOCT
.
.                                           * set up "patvisaf"
PRES4200  MOVE      AURNO,PVIURNO
          MOVE      ADATE,PVIDATE
          MOVE      RESADMNO,PVIBILL
          MOVE      "3",PVITYPE
          MOVE      "2",PVISTAT
          MOVE      "2",PVITRAN
          IF        ASTAT = 3
            MOVE      "3",PVITRAN
          ENDIF
          MOVE      ADOCTA,PVIDOCT
          MOVE      " 3",PTVITYPE
.
.                                           * set up "pmsvx1af"
PRES4400  MOVE      RESADMNO,PMVXVISN
          MOVE      ADATE,PMVXVSDT
          MOVE      ADOCTA,PMVXDOCA
.
          MOVE      "COM",PMVXMHOS
          MOVE      "RSHOS       ",KEY12                                * 12/11
          CALL      RDTCAT1                 * read the Category Mapping table
          IF        OVRCD = 0
            MOVE      PCATCOD,PMVXMHOS
          ENDIF
.
.                                           * set up "patnobaf"
          IF        ASTAT = 2
            MOVE      AWARD,NBWARD
            MOVE      RESADMNO,DNBADMNO
          ENDIF
.
.                                           ***********************************
.
.                                           * setup "GRP" links in EID_ID table
PRES5000  UNPACK    SP70,EIDVISNO,EIDENCNO,EIDSESNO,EIDCONNO,EIDTEST,EIDSPAR
          UNPACK    SP70,EIDOOONO,EIDSPAR
          MOVE      "RES",EIDIDCOD
          PACK      EIDIDNO,FLD60004,SP20   * Fld. 4 - hce_d_resi_admit.hce_id
          IF        OPTION = 1
            MOVE      "T",EIDTEST
          ENDIF
          PACK      KEY23,EIDIDCOD,EIDIDNO,SP30
          CALL      RATMEID1
          COMPARE   ZERO,OVRCD
          GOTO      PRES7001 IF EQUAL
.
          CALL      WRTMEID1                * write EID_ID semi-temp file
.
.
          BRANCH    OPTION,PRES9999,PRES8000  * check if Edit or Upload
          GOTO      PRES8000
.
.
PRES7000  CLEAR     ERRMESS
          MOVE      "  ",FLDNO
          APPEND    "Referral recd. not found for Id. '",ERRMESS
          APPEND    FLD60004,ERRMESS
          APPEND    "' - record bypassed *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PRES9999
.         
PRES7001  CLEAR     ERRMESS
          MOVE      "  ",FLDNO
          APPEND    "Res. Admission for Id. '",ERRMESS
          SQUEEZE   EIDIDNO
          APPEND    EIDIDNO,ERRMESS
          APPEND    "' already processed - record bypassed",ERRMESS
          APPEND    " *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PRES9999
.
PRES7002  CLEAR     ERRMESS
          APPEND    "The link key field 'hce_id' for '",ERRMESS
          APPEND    FLD60004,ERRMESS
          APPEND    "' is blank - record bypassed *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PRES9999
.                             
.         
.                                           * write the records
PRES8000  MOVE      ZERO,EXIT
          PACK      KEY16,ALRAVISN,ALRALADM,SP20
          CALL      RDALRSA1
          IF        OVRCD = 1
            CALL      WRALRSA1              * write "allrsaaf"
            ADD       ONE,ALLRSAXX
          ENDIF
.
          PACK      KEY8,RESADMNO
          CALL      RAPTMIS1
          IF        OVRCD = 1
            CALL      WRMISS1               * write "patmi1af"
            ADD       ONE,PATMI1XX
          ENDIF
.
          PACK      KEY8,RESADMNO
          CALL      RAPTVIS1
          IF        OVRCD = 1
            CALL      WRPTVIS1              * write "patvisaf"
            ADD       ONE,PATVISXX
          ENDIF
.
          PACK      KEY8,RESADMNO
          CALL      RAPMVX11
          IF        OVRCD = 1
            CALL      WRPMVX11              * write "pmsvx1af"
            ADD       ONE,PMSVX1XX
          ENDIF
.
          PACK      KEY20,TWARD,TBED,TDATE,TTIME,RESADMNO
          CALL      RDTRAN1
          IF        OVRCD = 1
            MOVE      ACLAIM,PTTRCLTY
            PACK      PTTRCDAT,CCC,CYY,CMM,CDD
            REP       " 0",PTTRCDAT
            CLOCK     TIME,PTTRCTIM
            MOVE      WBSEUID,PTTRUCID
            UNPACK    SP70,TRCDATE,TRCTIME,PTTRUUID
            CALL      WRTRAN1               * write "pattranf" "A" record
            ADD       ONE,PATTRNXX
          ENDIF
.
          IF        ASTAT = 2
            PACK      KEY13,NBWARD,RESADMNO,SP20
            CALL      RANOBE1
            IF        OVRCD = 1
              CALL      WRNOBE1             * write "patnobef"
              ADD       ONE,PATNOBXX
            ENDIF
          ENDIF
.
          IF        ASTAT = 3
            PACK      KEY8,RESADMNO
            CALL      RDADSCH1
            IF        OVRCD = 1
              CALL      WRDSCH1             * write "patdschf"
              ADD       ONE,PATDSCXX
            ENDIF
            MOVE    DDATE,TDATE
            MOVE    DTIME,TTIME
            MOVE    "D",TMOVE
            PACK      KEY20,TWARD,TBED,TDATE,TTIME,RESADMNO
            CALL      RDTRAN1
            IF        OVRCD = 1
              MOVE      ACLAIM,PTTRCLTY
              PACK      PTTRCDAT,CCC,CYY,CMM,CDD
              REP       " 0",PTTRCDAT
              CLOCK     TIME,PTTRCTIM
              MOVE      WBSEUID,PTTRUCID
              UNPACK    SP70,TRCDATE,TRCTIME,PTTRUUID
              CALL      WRTRAN1             * write "pattranf" "D" record
              ADD       ONE,PATTRNXX
            ENDIF
          ENDIF
.
PRES9999  RETURN
+
.******************************************************************************
.*                                  PDIA0000                                  *
.*                       "DIA"  Process Diagnosis                             *
.******************************************************************************
PDIA0000  MOVE      ZERO,EXIT
          CALL      CLECL000                * clear Eclipse input variables
.
          READ      INECLTXT,SEQ;FLD60001,FLD60002,FLD60003,FLD60004,FLD60005:
                                 FLD60006,FLD60007,FLD60008,FLD60009,FLD60010:
                                 FLD60011,FLD60012,FLD60013,FLD60014,FLD60015:
                                 FLD60016
.
.
          PACK      ERRDATA,ECLRECID,SP1,FLD60001,SP1,FLD60002,SP1:
                            FLD60003,SP1,FLD60004,SP1,FLD60005,SP70
          PACK      UNIQUEID,FLD60016,SP20
          MATCH     SP20,UNIQUEID
          GOTO      PDIA7002 IF EQUAL
.
.
PDIA0500  MOVE      "EOC",DIM3A             * check the initial referral "EOC"
          PACK      FLD60IN,FLD60016,SP30   * Fld. 16 - eoc_d_diagnosis1.eoc_id
          PACK      KEY23,DIM3A,FLD60IN
          CALL      RDTMEID1                * See if eoc_id has been processed
          IF        OVRCD = 1
            MOVE      "HCE",DIM3A           * check the "HCE" linked referrals
            PACK      KEY23,DIM3A,FLD60IN
            CALL      RDTMEID1              * See if hce_id has been processed
            BRANCH    OVRCD,PDIA7000
          ENDIF
.
PDIA1000  MOVE      EIDVISNO,MHDIADMN
.
          MOVE      " 1",FLDNO
          MOVE      FLD60001,FLD60IN        * Fld. 1 - eoc_d_diag1.diagnosis_dat
          CALL      EDDAT000
          MOVE      DIM8A,MHDIDATE 
          MOVE      DIM8A,MHDIXDAT                   * added 06/11/08
.
          PACK      MHDIX1CA,FLD60002,SP10  * Fld. 2 - eoc_d_diag1.diag1_prim
          PACK      MHDIX1CB,FLD60003,SP10  * Fld. 3 - eoc_d_diag1.diag2_prim
          PACK      MHDIX1CC,FLD60004,SP10  * Fld. 4 - eoc_d_diag1.diag3_prim
.
          PACK      MHDIX1DA,FLD60005,SP10  * Fld. 5 - cmn_r_dsm4.description1
          PACK      MHDIX1DB,FLD60006,SP10  * Fld. 6 - cmn_r_dsm4.description2
          PACK      MHDIX1DC,FLD60007,SP10  * Fld. 7 - cmn_r_dsm4.description3
.
          PACK      MHDIX2CA,FLD60008,SP10  * Fld. 8 - eoc_d_diag1.diag1_other
          PACK      MHDIX2CB,FLD60009,SP10  * Fld. 9 - eoc_d_diag1.diag2_other
          PACK      MHDIX2CC,FLD60010,SP10  * Fld.10 - eoc_d_diag1.diag3_other
.
          PACK      MHDIX2DA,FLD60011,SP10  * Fld.11 - cmn_r_dsm4.description1
          PACK      MHDIX2DB,FLD60012,SP10  * Fld.12 - cmn_r_dsm4.description2
          PACK      MHDIX2DC,FLD60013,SP10  * Fld.13 - cmn_r_dsm4.description3
.
          PACK      MHDIX3DS,FLD60014,SP10  * Fld.14 - cmn_r_dsm4.maj_treatff1
.                                           
          MOVE      "15",FLDNO
          MOVE      "USR",EHCPCAT
          PACK      EHCPCOD,FLD60015,SP10   * Fld.15 - eoc_d_diag1.aw_user
          CALL      EDHCP000
          MOVE      HCPIBACD,ALRACUID
          MOVE      "2",MHDISUP1            * 1=Yes 2=No
          MOVE      "2",MHDISUP2
.           
.                                           ***********************************
.         
          BRANCH    OPTION,PDIA9999,PDIA8000  * check if Edit or Upload
          GOTO      PDIA8000
.         
.         
PDIA7000  CLEAR     ERRMESS
          MOVE      "  ",FLDNO
          APPEND    "Referral recd. not found for Id. '",ERRMESS
          APPEND    FLD60016,ERRMESS
          APPEND    "' - record bypassed *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PDIA9999
.
PDIA7002  CLEAR     ERRMESS
          APPEND    "The link key field 'eoc_id' ",ERRMESS
          APPEND    "is blank - record bypassed *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PDIA9999
.                                           
.           
.                                           * write the records
PDIA8000  MOVE      ZERO,EXIT
          PACK      KEY16,MHDIADMN,MHDIDATE,SP20
          CALL      RAMHDIA1
          IF        OVRCD = 1
            CALL      WRMHDIA1              * write "mehdiaaf"
            ADD       ONE,MEHDIAXX
          ENDIF
.
          PACK      KEY8,MHDIADMN,SP20
          CALL      RAMHVIS1
          IF        OVRCD = 1
            PACK      KEY8,MHDIADMN           * get UR No. from PATVISaf
            CALL      RDPTVIS1
            IF        OVRCD = 0
              CALL      CLMEHVIS            * set up the MEHVI1af data
              MOVE      MHDIADMN,MHVIADMN
              MOVE      "7",MHVISTAT
              MOVE      PVIURNO,MHVIURNO
              CALL      WRMHVIS1            * write "mehvi1af"
              ADD       ONE,MEHVI1XX
            ENDIF
          ENDIF
.
.
.
PDIA9999  RETURN
+
.******************************************************************************
.*                                  PHON0000                                  *
.*                       "HON"  Process HoNOS data                            *
.******************************************************************************
PHON0000  MOVE      ZERO,EXIT
          CALL      CLRMEH00                * clear Mental Health tables
          CALL      CLECL000                * clear Eclipse input variables
.
          READ      INECLTXT,SEQ;FLD60001,FLD60002,FLD60003,FLD60004,FLD60005:
                                 FLD60006,FLD60007,FLD60008,FLD60009,FLD60010:
                                 FLD60011,FLD60012,FLD60013,FLD60014,FLD60015:
                                 FLD60016,FLD60017,FLD60018,FLD60019,FLD60020:
                                 FLD60021,FLD60022,FLD60023,FLD60024,FLD60025:
                                 FLD60026,FLD60027,FLD60028,FLD60029,FLD60030:
                                 FLD60031,FLD60032,FLD60033,FLD60034,FLD60035:
                                 FLD60036,FLD60037,FLD60038,FLD60039,FLD60040:
                                 FLD60041,FLD60042,FLD60043,FLD60044,FLD60045:
                                 FLD60046,FLD60047,FLD60048,FLD60049,FLD60050:
                                 FLD60051,FLD60052,FLD60053,FLD60054,FLD60055:
                                 FLD60056,FLD60057,FLD60058,FLD60059,FLD60060:
                                 FLD60061,FLD60062,FLD60063,FLD60064,FLD60065:
                                 FLD60066,FLD60067,FLD60068,FLD60069,FLD60070:
                                 FLD60071,FLD60072,FLD60073,FLD60074,FLD60075:
                                 FLD60076,FLD60077,FLD60078,FLD60079,FLD60080:
				 FLD60081,FLD60082,FLD60083,FLD60084,FLD60085:
                                 FLD60086,FLD60087
.
.
          PACK      ERRDATA,ECLRECID,SP1,FLD60001,SP1,FLD60002,SP1:
                            FLD60003,SP1,FLD60004,SP1,FLD60005,SP70
.
          MOVE      FLD60001,DIM8A
          MOVE      FLD60002,DIM8B
          PACK      UNIQUEID,DIM8A,SP1,DIM8B,SP20
          MATCH     SP20,UNIQUEID
          GOTO      PHON7002 IF EQUAL
.
PHON0500  MOVE      "EOC",DIM3A
          PACK      FLD60IN,FLD60001,SP70   * Fld. 1 - ass_d_assessment.eoc_id
          PACK      KEY23,DIM3A,FLD60IN
          CALL      RDTMEID1                * See if eoc_id has been processed
          COMPARE   ZERO,OVRCD
          GOTO      PHON7000 IF NOT EQUAL
.
PHON1000  MOVE      EIDVISNO,MHHNVISN       * from "EOC" record
.
          MOVE      " 2",FLDNO
          MOVE      FLD60002,FLD60IN        * Fld.  2 - 
          MOVE      "8",LENGTH              * retrieve No. and right justify
          CALL      RJUS0000                * right justify
          CALL      EDNUM000
          MOVE      FLD60OUT,MHHNUNIQ
.
          MOVE      " 3",FLDNO
          MOVE      "HONOS",ECATCAT
          PACK      DIM10A,FLD60003,SP10    * Fld. 3  - 
          UNPACK    DIM10A,ECATCOD,DIM5A
          CALL      EDCAT000
          MOVE      PCATCOD,MHHNHOTY        * Cat."hs"
.
          MOVE      " 4",FLDNO
          PACK      DIM1A,FLD60004,SP1      * Fld. 4 - 
          CALL      EDYN0000
          MOVE      DIM1A,MHHNACTV
.
          MOVE      " 5",FLDNO
          PACK      DIM1A,FLD60005,SP1      * Fld. 5 - 
          CALL      EDYN0000
          MOVE      DIM1A,MHHNSENT
.
          MOVE      " 6",FLDNO
          MOVE      FLD60006,FLD60IN        * Fld. 6 - 
          CALL      EDDAT000
          MOVE      DIM8A,MHHNHDAT
.
	  MOVE      " 7",FLDNO
	  MOVE      "MHSS ",ECATCAT
          PACK      ECATCOD,FLD60007,SP10   * Fld. 7  -
	  CALL      EDCAT000
	  MOVE      PCATCOD,MHHNSSET        * Cat."ss"
.
          MOVE      " 8",FLDNO
          MOVE      "ARO  ",ECATCAT
          PACK      ECATCOD,FLD60008,SP10   * Fld. 8  -
          CALL      EDCAT000
          MOVE      PCATCOD,MHHNREAS        * Cat."hp"
.
          MOVE      " 9",FLDNO
          MOVE      "HCP",EHCPCAT
          PACK      EHCPCOD,FLD60009,SP10   * Fld. 9  - 
          CALL      EDHCP000
          MOVE      HCPIBACD,MHHNRHCP
.
          MOVE      "10",FLDNO
          MOVE      "CTM",EHCPCAT
          PACK      EHCPCOD,FLD60010,SP10   * Fld. 10 - 
          CALL      EDHCP000
          MOVE      HCPIBACD,MHHNCAST
.
          MOVE      "11",FLDNO
          MOVE      "HCP",EHCPCAT
          PACK      EHCPCOD,FLD60011,SP10   * Fld. 11 - 
          CALL      EDHCP000
          MOVE      HCPIBACD,MHHNPHCP
.
          MOVE      "12",FLDNO
          MOVE      "USR",EHCPCAT
          PACK      EHCPCOD,FLD60012,SP10   * Fld. 12 - 
          CALL      EDHCP000
          MOVE      HCPIBACD,MHHNWEBC
.
          MOVE      "13",FLDNO
          MOVE      FLD60013,FLD60IN        * Fld. 13 -
          CALL      EDDAT000
          MOVE      DIM8A,MHHNCDTE
.
          MOVE      "14",FLDNO
          MOVE      FLD60014,FLD60IN        * Fld. 14 - 
          CALL      EDTIM000
          MOVE      DIM8A,MHHNCTIM
.
          MOVE      "15",FLDNO
          PACK      DIM1A,FLD60015,SP1      * Fld. 15 -
          CALL      EDYN0000
          MOVE      DIM1A,MHHNCOMP
.
          MOVE      "16",FLDNO
          MOVE      "USR",EHCPCAT
          PACK      EHCPCOD,FLD60016,SP10   * Fld. 16 - 
          CALL      EDHCP000
          MOVE      HCPIBACD,MHHNWEBF
.
          MOVE      "17",FLDNO
          MOVE      FLD60017,FLD60IN        * Fld. 17 -
          CALL      EDDAT000
          MOVE      DIM8A,MHHNDATF
.
          MOVE      "18",FLDNO
          MOVE      FLD60018,FLD60IN        * Fld. 18 - 
          CALL      EDTIM000
          MOVE      DIM8A,MHHNTIMF
.
          MOVE      "19",FLDNO
          MOVE      "USR",EHCPCAT
          PACK      EHCPCOD,FLD60019,SP10   * Fld. 19 - 
          CALL      EDHCP000
          MOVE      HCPIBACD,MHHNWEBU
.
          MOVE      "20",FLDNO
          MOVE      FLD60020,FLD60IN        * Fld. 20 -
          CALL      EDDAT000
          MOVE      DIM8A,MHHNDATU
.
          MOVE      "21",FLDNO
          MOVE      FLD60021,FLD60IN        * Fld. 21 - 
          CALL      EDTIM000
          MOVE      DIM8A,MHHNTIMU
.
	  MOVE      "22",FLDNO
	  MOVE      "FOC  ",ECATCAT
          PACK      ECATCOD,FLD60022,SP10   * Fld. 22 -
	  CALL      EDCAT000
	  MOVE      PCATCOD,MHHNFOCU        * Cat."hf"
.
	  MOVE      "23",FLDNO
	  MOVE      "CULT ",ECATCAT
          PACK      ECATCOD,FLD60023,SP10   * Fld. 23 -
	  CALL      EDCAT000
	  MOVE      PCATCOD,MHHNCULS        * Cat."hc"
.
          MOVE      "24",FLDNO
          PACK      DIM1A,FLD60025,SP1      * Fld. 24 -
          CALL      EDYN0000
          MOVE      DIM1A,MHHNNGOS
.
          MOVE      "25",FLDNO
          PACK      DIM1A,FLD60025,SP1      * Fld. 25 -
          CALL      EDYN0000
          MOVE      DIM1A,MHHNNGOA
.
          MOVE      "26",FLDNO
          PACK      DIM1A,FLD60026,SP1      * Fld. 26 -
          CALL      EDYN0000
          MOVE      DIM1A,MHHNNGOW
.
          MOVE      "27",FLDNO
          PACK      DIM1A,FLD60027,SP1      * Fld. 27 -
          CALL      EDYN0000
          MOVE      DIM1A,MHHNVOCA
.
          MOVE      "28",FLDNO
          PACK      DIM1A,FLD60028,SP1      * Fld. 28 - 
          CALL      EDYN0000
          MOVE      DIM1A,MHHNNSNG
.
	  MOVE      "29",FLDNO
	  MOVE      "COLST",ECATCAT
          PACK      ECATCOD,FLD60029,SP10   * Fld. 29 -
	  CALL      EDCAT000
	  MOVE      PCATCOD,MHHNCOLS        * Cat."ht"
.
	  MOVE      "30",FLDNO
	  MOVE      "MODE ",ECATCAT
          PACK      ECATCOD,FLD60030,SP10   * Fld. 30 -
	  CALL      EDCAT000
	  MOVE      PCATCOD,MHHNMODA        * Cat."hm"
.
	  MOVE      "31",FLDNO
	  MOVE      FLD60031,FLD60OUT       * Fld. 31 -
          CALL      EDNUM000
          MOVE      FLD60031,MHHNADQ1
.
	  MOVE      "32",FLDNO
	  MOVE      FLD60032,FLD60OUT       * Fld. 32 -
          CALL      EDNUM000
          MOVE      FLD60032,MHHNADQ2
.
	  MOVE      "33",FLDNO
	  MOVE      FLD60033,FLD60OUT       * Fld. 33 -
          CALL      EDNUM000
          MOVE      FLD60033,MHHNADQ3
.
	  MOVE      "34",FLDNO
	  MOVE      FLD60034,FLD60OUT       * Fld. 34 -
          CALL      EDNUM000
          MOVE      FLD60034,MHHNADQ4
.
	  MOVE      "35",FLDNO
	  MOVE      FLD60035,FLD60OUT       * Fld. 35 -
          CALL      EDNUM000
          MOVE      FLD60035,MHHNADQ5
.
	  MOVE      "36",FLDNO
	  MOVE      FLD60036,FLD60OUT       * Fld. 36 -
          CALL      EDNUM000
          MOVE      FLD60036,MHHNADQ6
.
	  MOVE      "37",FLDNO
	  MOVE      FLD60037,FLD60OUT       * Fld. 37 -
          CALL      EDNUM000
          MOVE      FLD60037,MHHNADQ7
.
	  MOVE      "38",FLDNO
	  MOVE      FLD60038,FLD60OUT       * Fld. 38 -
          CALL      EDNUM000
          MOVE      FLD60038,MHHNADQ8
.
	  MOVE      "39",FLDNO
...       MOVE      "XXXXX",ECATCAT                            * not defined
...       PACK      ECATCOD,FLD60039,SP10   * Fld. 39 -
...       CALL      EDCAT000
...       MOVE      PCATCOD,MHHNAQ8A        * Cat."hb"
          MOVE      FLD60039,MHHNAQ8A
.
          PACK      MHHNFREE,FLD60040,SP70  * Fld. 40
.
          MOVE      "41",FLDNO
          MOVE      FLD60041,FLD60OUT       * Fld. 41 -
          CALL      EDNUM000
          MOVE      FLD60041,MHHNADQ9
.
          MOVE      "42",FLDNO
          MOVE      FLD60042,FLD60OUT       * Fld. 42 -
          CALL      EDNUM000
          MOVE      FLD60042,MHHNAQ10
.
          MOVE      "43",FLDNO
          MOVE      FLD60043,FLD60OUT       * Fld. 43 -
          CALL      EDNUM000
          MOVE      FLD60043,MHHNAQ11
.
          MOVE      "44",FLDNO
          MOVE      FLD60044,FLD60OUT       * Fld. 44 -
          CALL      EDNUM000
          MOVE      FLD60044,MHHNAQ12
.
          MOVE      "45",FLDNO
          MOVE      FLD60045,FLD60OUT       * Fld. 45 -
          CALL      EDNUM000
          MOVE      FLD60045,MHHNCYQ1
.
          MOVE      "46",FLDNO
          MOVE      FLD60046,FLD60OUT       * Fld. 46 -
          CALL      EDNUM000
          MOVE      FLD60046,MHHNCYQ2
.
          MOVE      "47",FLDNO
          MOVE      FLD60047,FLD60OUT       * Fld. 47 -
          CALL      EDNUM000
          MOVE      FLD60047,MHHNCYQ3
.
          MOVE      "48",FLDNO
          MOVE      FLD60048,FLD60OUT       * Fld. 48 -
          CALL      EDNUM000
          MOVE      FLD60048,MHHNCYQ4
.
          MOVE      "49",FLDNO
          MOVE      FLD60049,FLD60OUT       * Fld. 49 -
          CALL      EDNUM000
          MOVE      FLD60049,MHHNCYQ5
.
          MOVE      "50",FLDNO
          MOVE      FLD60050,FLD60OUT       * Fld. 50 -
          CALL      EDNUM000
          MOVE      FLD60050,MHHNCYQ6
.         
          MOVE      "51",FLDNO
          MOVE      FLD60051,FLD60OUT       * Fld. 51 -
          CALL      EDNUM000
          MOVE      FLD60051,MHHNCYQ7
.         
          MOVE      "52",FLDNO
          MOVE      FLD60052,FLD60OUT       * Fld. 52 -
          CALL      EDNUM000
          MOVE      FLD60052,MHHNCYQ8
.         
          MOVE      "53",FLDNO
          MOVE      FLD60053,FLD60OUT       * Fld. 53 -
          CALL      EDNUM000
          MOVE      FLD60053,MHHNCYQ9
.
          MOVE      "54",FLDNO
          MOVE      FLD60054,FLD60OUT       * Fld. 54 -
          CALL      EDNUM000
          MOVE      FLD60054,MHHNCQ10
.
          MOVE      "55",FLDNO
          MOVE      FLD60055,FLD60OUT       * Fld. 55 -
          CALL      EDNUM000
          MOVE      FLD60055,MHHNCQ11
.
          MOVE      "56",FLDNO
          MOVE      FLD60056,FLD60OUT       * Fld. 56 -
          CALL      EDNUM000
          MOVE      FLD60056,MHHNCQ12
.
          MOVE      "57",FLDNO
          MOVE      FLD60057,FLD60OUT       * Fld. 57 -
          CALL      EDNUM000
          MOVE      FLD60057,MHHNCQ13
.
          MOVE      "58",FLDNO
          MOVE      FLD60058,FLD60OUT       * Fld. 58 -
          CALL      EDNUM000
          MOVE      FLD60058,MHHNCQ14
.
          MOVE      "59",FLDNO
          MOVE      FLD60059,FLD60OUT       * Fld. 59 -
          CALL      EDNUM000
          MOVE      FLD60059,MHHNCQ15
.
          MOVE      "60",FLDNO
          MOVE      FLD60060,FLD60OUT       * Fld. 60 -
          CALL      EDNUM000
          MOVE      FLD60060,MHHNLDQ1
.
          MOVE      "61",FLDNO
          MOVE      FLD60061,FLD60OUT       * Fld. 61 -
          CALL      EDNUM000
          MOVE      FLD60061,MHHNLDQ2
.
          MOVE      "62",FLDNO
          MOVE      FLD60062,FLD60OUT       * Fld. 62 -
          CALL      EDNUM000
          MOVE      FLD60062,MHHNLDQ3
.
          MOVE      "63",FLDNO
          MOVE      FLD60063,FLD60OUT       * Fld. 63 -
          CALL      EDNUM000
          MOVE      FLD60063,MHHNLDQ4
.
          MOVE      "64",FLDNO
          MOVE      FLD60064,FLD60OUT       * Fld. 64 -
          CALL      EDNUM000
          MOVE      FLD60064,MHHNLDQ5
.
          MOVE      "65",FLDNO
          MOVE      FLD60065,FLD60OUT       * Fld. 65 -
          CALL      EDNUM000
          MOVE      FLD60065,MHHNLDQ6
.
          MOVE      "66",FLDNO
          MOVE      FLD60066,FLD60OUT       * Fld. 66 -
          CALL      EDNUM000
          MOVE      FLD60066,MHHNLDQ7
.
          MOVE      "67",FLDNO
          MOVE      FLD60067,FLD60OUT       * Fld. 67 -
          CALL      EDNUM000
          MOVE      FLD60067,MHHNLDQ8
.
          MOVE      "68",FLDNO
          MOVE      FLD60068,FLD60OUT       * Fld. 68 -
          CALL      EDNUM000
          MOVE      FLD60068,MHHNLDQ9
.
          MOVE      "69",FLDNO
          MOVE      FLD60069,FLD60OUT       * Fld. 69 -
          CALL      EDNUM000
          MOVE      FLD60069,MHHNLQ10
.
          MOVE      "70",FLDNO
          MOVE      FLD60070,FLD60OUT       * Fld. 70 -
          CALL      EDNUM000
          MOVE      FLD60070,MHHNLQ11
.
          MOVE      "71",FLDNO
          MOVE      FLD60071,FLD60OUT       * Fld. 71 -
          CALL      EDNUM000
          MOVE      FLD60071,MHHNLQ12
.
          MOVE      "72",FLDNO
          MOVE      FLD60072,FLD60OUT       * Fld. 72 -
          CALL      EDNUM000
          MOVE      FLD60072,MHHNLQ13
.
          MOVE      "73",FLDNO
          MOVE      FLD60073,FLD60OUT       * Fld. 73 -
          CALL      EDNUM000
          MOVE      FLD60073,MHHNLQ14
.
          MOVE      "74",FLDNO
          MOVE      FLD60074,FLD60OUT       * Fld. 74 -
          CALL      EDNUM000
          MOVE      FLD60074,MHHNLQ15
.
          MOVE      "75",FLDNO
          MOVE      FLD60075,FLD60OUT       * Fld. 75 -
          CALL      EDNUM000
          MOVE      FLD60075,MHHNLQ16
.
          MOVE      "76",FLDNO
          MOVE      FLD60076,FLD60OUT       * Fld. 76 -
          CALL      EDNUM000
          MOVE      FLD60076,MHHNLQ17
.
          MOVE      "77",FLDNO
          MOVE      FLD60077,FLD60OUT       * Fld. 77 -
          CALL      EDNUM000
          MOVE      FLD60077,MHHNLQ18
.
          MOVE      "78",FLDNO
          MOVE      FLD60078,FLD60OUT       * Fld. 78 -
          CALL      EDNUM000
          MOVE      FLD60078,MHHNSCQ1
.
          MOVE      "79",FLDNO
          MOVE      FLD60079,FLD60OUT       * Fld. 79 -
          CALL      EDNUM000
          MOVE      FLD60079,MHHNSCQ2
.         
          MOVE      "80",FLDNO
          MOVE      FLD60080,FLD60OUT       * Fld. 80 -
          CALL      EDNUM000
          MOVE      FLD60080,MHHNSCQ3
.         
          MOVE      "81",FLDNO
          MOVE      FLD60081,FLD60OUT       * Fld. 81 -
          CALL      EDNUM000
          MOVE      FLD60081,MHHNSCQ4
.         
          MOVE      "82",FLDNO
          MOVE      FLD60082,FLD60OUT       * Fld. 82 -
          CALL      EDNUM000
          MOVE      FLD60082,MHHNSCQ5
.         
          MOVE      "83",FLDNO
          MOVE      FLD60083,FLD60OUT       * Fld. 83 -
          CALL      EDNUM000
          MOVE      FLD60083,MHHNSCQ6
.
          MOVE      "84",FLDNO
          MOVE      FLD60084,FLD60OUT       * Fld. 84 -
          CALL      EDNUM000
          MOVE      FLD60084,MHHNSCQ7
.
...ML...  MOVE      "85",FLDNO
...ML...  MOVE      "XXXXX",ECATCAT                       * ******* not defined
...ML...  PACK      ECATCOD,FLD60085,SP10   * Fld. 85 -
...ML...  CALL      EDCAT000
...ML...  MOVE      PCATCOD,MHHNHVER        * Cat."hv"
          MOVE      "012",MHHNHVER          * Cat."hv"    * 
.
          MOVE      "86",FLDNO
          MOVE      "3A   ",ECATCAT
          PACK      ECATCOD,FLD60086,SP10   * Fld. 86 -
          CALL      EDCAT000
          MOVE      PCATCOD,MHHNLD3A        * Cat."hl"
.
          MOVE      "87",FLDNO
          MOVE      FLD60087,FLD60IN        * Fld. 87 - Review date
          CALL      EDDAT000
          MOVE      DIM8A,MHHNRDAT
.         
.         
          BRANCH    OPTION,PHON9999,PHON8000  * check if Edit or Upload
          GOTO      PHON8000
.
.
PHON7000  CLEAR     ERRMESS
          MOVE      "  ",FLDNO
          APPEND    "Parent Visit No. for eoc_id '",ERRMESS
          APPEND    FLD60001,ERRMESS
          APPEND    "' not found - record bypassed *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PHON9999
.
PHON7002  CLEAR     ERRMESS
          APPEND    "The link key field 'eoc_id' ",ERRMESS
          APPEND    "is blank - record bypassed *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PHON9999
.
.                                           * write the records
PHON8000  PACK      KEY8,MHHNVISN,SP70
          CALL      RDVISA1
          IF        OVRCD=1
            PACK      MHHNURNO,SP70
          ELSE
            PACK      MHHNURNO,PVIURNO,SP70
          ENDIF
.
          PACK      KEY16,MHHNVISN,MHHNUNIQ,SP8
          CALL      RDMHHON1
          IF        OVRCD = 1
            CALL      WRMHHON1              * write "mehhonaf"
            ADD       ONE,MEHHONXX
          ENDIF
.
PHON9999  RETURN
+
.******************************************************************************
.*                                  PREF0000                                  *
.*                       "REF"  Process Legal Status Referral                 *
.******************************************************************************
PREF0000  MOVE      ZERO,EXIT
          CALL      CLRMEH00                * clear Mental Health tables
          CALL      CLECL000                * clear Eclipse input variables
.
          READ      INECLTXT,SEQ;FLD60001,FLD60002,FLD60003,FLD60004,FLD60005:
                                 FLD60006,FLD60007,FLD60008,FLD60009,FLD60010
.
          PACK      ERRDATA,ECLRECID,SP1,FLD60001,SP1,FLD60002,SP1:
                            FLD60003,SP1,FLD60004,SP1,FLD60005,SP70
.
          PACK      UNIQUEID,FLD60010,SP20  * Fld 10 - pmi_ls_mha_header.mha_id
          MATCH     SP20,UNIQUEID
          GOTO      PREF7002 IF EQUAL
.
PREF0500  MOVE      "REF",DIM3A
          PACK      FLD60IN,FLD60010,SP70   * Fld 10 - pmi_ls_mha_header.mha_id
          PACK      KEY23,DIM3A,FLD60IN
          CALL      RDTMEID1                * See if mha_id has been processed
          COMPARE   ZERO,OVRCD
          GOTO      PREF7000 IF EQUAL
.
          MOVE      " 1",FLDNO
          MOVE      FLD60001,FLD60IN
          MOVE      "8",LENGTH              * retrieve No. and right justify
          CALL      RJUS0000                * right justify
          MOVE      FLD60OUT,MHHLURNO
.
          MOVE      "  ",FLDNO
          CALL      ADDREF00                * generate unique no. for MHHLUNIQ
          MOVE      MHCNUNIQ,MHHLUNIQ
.
          MOVE      " 2",FLDNO
          MOVE      FLD60002,FLD60IN        * Fld.  2 - Start date 
          CALL      EDDAT000
          MOVE      DIM8A,MHHLSDAT
.
          MOVE      " 3",FLDNO
          MOVE      FLD60003,FLD60IN        * Fld.  3 - 
          CALL      EDTIM000
          MOVE      DIM8A,MHHLSTIM
.
          MOVE      " 4",FLDNO
          MOVE      FLD60004,FLD60IN        * Fld.  4 - End date   
          CALL      EDDAT000
          MOVE      DIM8A,MHHLEDAT
.
          MOVE      " 5",FLDNO
          MOVE      FLD60005,FLD60IN        * Fld.  5 - 
          CALL      EDTIM000
          MOVE      DIM8A,MHHLETIM
.
          MOVE      " 6",FLDNO
          PACK      DIM1A,FLD60006,SP1      * Fld.  6 -
          MOVE      "01",VALUES             * set valid values
          CALL      ED09N000
          MOVE      DIM1A,MHHLSTAT   
.
          MOVE      " 7",FLDNO
          MOVE      "USR",EHCPCAT
          PACK      EHCPCOD,FLD60007,SP10   * Fld. 7 - aw_user
          CALL      EDHCP000
          MOVE      HCPIBACD,MHHLCUID
.
          MOVE      " 8",FLDNO
          MOVE      FLD60008,FLD60IN        * Fld.  8 - 
          CALL      EDDAT000
          MOVE      DIM8A,MHHLCDAT
.
          MOVE      " 9",FLDNO
          MOVE      FLD60009,FLD60IN        * Fld.  9 - 
          CALL      EDTIM000
          MOVE      DIM8A,MHHLCTIM
.
.                                           ***********************************
.
PREF5000  UNPACK    SP70,EIDVISNO,EIDENCNO,EIDSESNO,EIDCONNO,EIDTEST
          UNPACK    SP70,EIDOOONO,EIDSPAR
          MOVE      "REF",EIDIDCOD          * write "mha_id" record
          PACK      EIDIDNO,FLD60010,SP20   * Fld 10 - pmi_ls_mha_header.mha_id
          PACK      EIDOOONO,MHHLUNIQ,SP20
          IF        OPTION = 1
            MOVE      "T",EIDTEST
          ENDIF
          PACK      KEY23,EIDIDCOD,EIDIDNO,SP30
          CALL      RATMEID1
          COMPARE   ZERO,OVRCD
          GOTO      PREF7001 IF EQUAL
.
          CALL      WRTMEID1                * write EID_ID semi-temp file
.
.
          BRANCH    OPTION,PREF9999,PREF8000  * check if Edit or Upload
          GOTO      PREF8000
.
.
PREF7000  CLEAR     ERRMESS
          MOVE      "  ",FLDNO
          APPEND    "The LS referral for Id. '",ERRMESS
          SQUEEZE   EIDIDNO
          APPEND    EIDIDNO,ERRMESS
          APPEND    "' already processed - record bypassed",ERRMESS
          APPEND    " *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PREF9999
.
PREF7001  CLEAR     ERRMESS
          GOTO      PREF9999
.
PREF7002  CLEAR     ERRMESS
          APPEND    "The link key field 'mha_id' for '",ERRMESS
          SQUEEZE   EIDIDNO
          APPEND    EIDIDNO,ERRMESS
          APPEND    "' is blank - record bypassed *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PREF9999
.
.                                           * write the records
PREF8000  PACK      KEY16,MHHLURNO,MHHLUNIQ,SP8
          CALL      RDMHHLS1
          IF        OVRCD = 1
            CALL      WRMHHLS1              * write "mehhlsaf"
            ADD       ONE,MEHHLSXX
          ENDIF
.
.
PREF9999  RETURN
+
.******************************************************************************
.*                                  PLLS0000                                  *
.*                       "LS "  Process Legal Status record                   *
.******************************************************************************
PLLS0000  MOVE      ZERO,EXIT
          CALL      CLRMEH00                * clear Mental Health tables
          CALL      CLECL000                * clear Eclipse input variables
.
          READ      INECLTXT,SEQ;FLD60001,FLD60002,FLD60003,FLD60004,FLD60005:
                                 FLD60006,FLD60007,FLD60008,FLD60009,FLD60010:
                                 FLD60011,FLD60012,FLD60013,FLD60014,FLD60015
.
          PACK      ERRDATA,ECLRECID,SP1,FLD60001,SP1,FLD60002,SP1:
                            FLD60003,SP1,FLD60004,SP1,FLD60005,SP70
.
          PACK      UNIQUEID,FLD60015,SP20  * Fld 10 - pmi_ls_mha_detail.mha_id
          MATCH     SP10,UNIQUEID
          GOTO      PLLS7002 IF EQUAL
.         
PLLS0500  MOVE      "REF",DIM3A             
          PACK      FLD60IN,FLD60015,SP70   * Fld 10 - pmi_ls_mha_detail.mha_id
          PACK      KEY23,DIM3A,FLD60IN
          CALL      RDTMEID1                * See if mha_id has been processed
          COMPARE   ZERO,OVRCD
          GOTO      PLLS7000 IF NOT EQUAL
.
          MOVE      " 1",FLDNO      
          MOVE      FLD60001,FLD60IN
          MOVE      "8",LENGTH              * retrieve No. and right justify
          CALL      RJUS0000                * right justify
          MOVE      FLD60OUT,MHDLURNO       
.
          MOVE      EIDOOONO,MHDLUNIQ       * retrieve "REF" unique Id.
.
          MOVE      " 2",FLDNO
          MOVE      FLD60002,FLD60IN        * Fld.  2 - start_date
          CALL      EDDAT000
          MOVE      DIM8A,MHDLSDAT
.
          MOVE      " 3",FLDNO
          MOVE      FLD60003,FLD60IN        * Fld.  3 - start_time
          CALL      EDTIM000
          MOVE      DIM8A,MHDLSTIM
.
          MOVE      " 4",FLDNO
          MOVE      "LS   ",ECATCAT
          PACK      ECATCOD,FLD60004,SP10   * Fld.  4 - section_cd
          CALL      EDCAT000
          MOVE      PCATCOD,MHDLSCOD        * Cat."LS"
. 
          MOVE      " 5",FLDNO
          PACK      DIM1A,FLD60005,SP1      * Fld.  5 - status
...       MOVE      "01",VALUES             * set valid values
...       CALL      ED09N000
...       MOVE      "1",DIM1A                             * taken out 06/11/08
          PACK      MHDLSTAT,DIM1A,SP2
.
          MOVE      " 6",FLDNO
          MOVE      FLD60006,FLD60IN        * Fld.  6 - last_date
          CALL      EDDAT000
          MOVE      DIM8A,MHDLRDAT
.
          MOVE      " 7",FLDNO
          MOVE      FLD60007,FLD60IN        * Fld.  7 - last_time
          CALL      EDTIM000
          MOVE      DIM8A,MHDLRTIM
.
          MOVE      " 8",FLDNO
          MOVE      "HCP",EHCPCAT
          PACK      EHCPCOD,FLD60008,SP10   * Fld.  8 - pmi_is_mha_details.
          CALL      EDHCP000                *                     review_hcp_id
          MOVE      HCPIBACD,MHDLHCPC
.
          MOVE      " 9",FLDNO
          MOVE      "PGLOC",ECATCAT
          PACK      ECATCOD,FLD60009,SP10   * Fld.  9 - pmi_is_mha_details.
          CALL      EDCAT000                *                    review_locn_id
          MOVE      PCATCOD,MHDLPOCC        * Cat."PO"
.
          MOVE      "10",FLDNO
          MOVE      "USR",EHCPCAT
          PACK      EHCPCOD,FLD60010,SP10   * Fld. 10 - aw_user
          CALL      EDHCP000
          MOVE      HCPIBACD,MHDLCUID
.
          MOVE      "11",FLDNO
          MOVE      FLD60011,FLD60IN        * Fld. 11 - aw_date
          CALL      EDDAT000
          MOVE      DIM8A,MHDLCDAT
.
          MOVE      "12",FLDNO
          MOVE      FLD60012,FLD60IN        * Fld. 12 - aw_time
          CALL      EDTIM000
          MOVE      DIM8A,MHDLCTIM
.
          MOVE      "13",FLDNO
          MOVE      FLD60013,FLD60IN        * Fld. 13 - last_date
          CALL      EDDAT000
          MOVE      DIM8A,MHDLEDAT
.
          MOVE      "14",FLDNO
          MOVE      FLD60014,FLD60IN        * Fld. 14 - last_time
          CALL      EDTIM000
          MOVE      DIM8A,MHDLETIM
.
.
          BRANCH    OPTION,PLLS9999,PLLS8000  * check if Edit or Upload
          GOTO      PLLS8000
.
.
PLLS7000  CLEAR     ERRMESS
          MOVE      "  ",FLDNO
          APPEND    "Parent Referral No. for mha_id '",ERRMESS
          APPEND    FLD60001,ERRMESS
          APPEND    "' not found - record bypassed *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PLLS9999
.
PLLS7002  CLEAR     ERRMESS
          MOVE      "15",FLDNO
          APPEND    "The link 'mha_id' field for '",ERRMESS
          APPEND    FLD60001,ERRMESS
          APPEND    "' is blank - record bypassed *****",ERRMESS
          CALL      PRNT0000
          ADD       ONE,ERRIN
          GOTO      PLLS9999
.
.                                           * write the records
PLLS8000  PACK      KEY16,MHHLURNO,MHHLUNIQ,SP8
          CALL      RDMHDLS1
          IF        OVRCD = 1
            CALL      WRMHDLS1              * write "mehdlsaf"
            ADD       ONE,MEHDLSXX
          ENDIF     
.
.
PLLS9999  RETURN
+
.******************************************************************************
.*                                  ADDREF00                                  *
.*             Get Unique No. for "REF" record (code from MEHWEB01)           *
.******************************************************************************
ADDREF00  MOVE      ZERO,EXIT
          IF        OPTION = 2
            READ      CONTROLF,SIXTY9;*86,MHCNUNIQ
            MOVE      MHCNUNIQ,F8
            ADD       ONE,MHCNUNIQ
            WRITAB    CONTROLF,SIXTY9;*86,MHCNUNIQ
            MOVE      F8,MHCNUNIQ
          ELSE
            ADD       ONE,MHCNUNIQ          * verifying - re-start at 1
          ENDIF
.
ADDREF99  RETURN
.******************************************************************************
.*                                  RJUS0000                                  *
.*                         Right Justify a field                              *
.******************************************************************************
RJUS0000  MOVE      SP70,FLD60OUT
          SQUEEZE   FLD60IN
          IF        @EOS
            MOVE      "0",FLD60IN
          ENDIF
          MOVELPTR  FLD60IN,LENIN
          MOVE      LENGTH,LENOUT
          COMPARE   LENIN,LENOUT
          IF        @EQUAL
            MOVE      FLD60IN,FLD60OUT
            GOTO      RJUS9999
          ENDIF
.
          SUB       LENIN,LENOUT
          SUB       ONE,LENOUT
          BUMP      FLD60OUT,LENOUT
          APPEND    FLD60IN,FLD60OUT
          RESET     FLD60OUT
.
RJUS9999  RETURN
.
.******************************************************************************
.*                                  EDDAT000                                  *
.*                              Edit Date field                               *
.******************************************************************************
EDDAT000  PACK      DIM8A,FLD60IN,SP10
          MATCH     SP8,DIM8A
          GOTO      EDDAT999 IF EQUAL
.
          UNPACK    DIM8A,DIM2A,DIM2B,DIM2C,DIM2D
          TYPE      DIM2A
          GOTO      EDDAT900 IF NOT EQUAL
          TYPE      DIM2B
          GOTO      EDDAT900 IF NOT EQUAL
          TYPE      DIM2C
          GOTO      EDDAT900 IF NOT EQUAL
          TYPE      DIM2D
          GOTO      EDDAT900 IF NOT EQUAL
.
          MOVE      DIM2A,DCC
          MOVE      DIM2B,DYY
          MOVE      DIM2C,DMM
          MOVE      DIM2D,DDD
          IF        DCC <> 19 & DCC <> 20
            GOTO      EDDAT900
          ENDIF
...       IF        DCC = 20 & DYY > CYY 
...         GOTO      EDDAT900
...       ENDIF
          MOVE      ZERO,XDD
          LOAD      XDD,DMM,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          IF        DDD = 0 | DDD > XDD
            GOTO      EDDAT900
          ENDIF
.
          GOTO      EDDAT999
.
EDDAT900  CLEAR     ERRMESS
          APPEND    "Date field is invalid  - '",ERRMESS
          APPEND    DIM8A,ERRMESS
          APPEND    "'",ERRMESS
          CALL      PRNT0000
.
EDDAT999  RETURN
.
.******************************************************************************
.*                                  EDTIM000                                  *
.*                              Edit Time field                               *
.******************************************************************************
EDTIM000  PACK      DIM8A,FLD60IN,SP10
          MATCH     SP8,DIM8A
          GOTO      EDTIM999 IF EQUAL
.
          UNPACK    DIM8A,DIM2A,XS1,DIM2B,XS2,DIM2C
          TYPE      DIM2A
          GOTO      EDTIM900 IF NOT EQUAL
          TYPE      DIM2B
          GOTO      EDTIM900 IF NOT EQUAL
          TYPE      DIM2C
          GOTO      EDTIM900 IF NOT EQUAL
.
          MATCH     ":",XS1
          IF        !@EQUAL
            GOTO      EDTIM900
          ENDIF
          MATCH     ":",XS2
          IF        !@EQUAL
            GOTO      EDTIM900
          ENDIF
.
          MOVE      DIM2A,DHH
          MOVE      DIM2B,DMM
          MOVE      DIM2C,DSS
          IF        DHH > 23 | DMM > 59 | DSS >59
            GOTO      EDTIM900
          ENDIF
.
          GOTO      EDTIM999
.
EDTIM900  CLEAR     ERRMESS
          APPEND    "Time field is invalid  - '",ERRMESS
          APPEND    DIM8A,ERRMESS
          APPEND    "'",ERRMESS
          CALL      PRNT0000
.
EDTIM999  RETURN
.
.******************************************************************************
.*                                  EDYN0000                                  *
.*                            Edit Yes/No fields                              *
.******************************************************************************
EDYN0000  MATCH     SP1,DIM1A
          GOTO      EDYN9999 IF EQUAL
.
          REP       "N0Y1",DIM1A
          MOVE      DIM1A,DIM1B
          REP       "0-1-",DIM1B
          MATCH     "-",DIM1B
          GOTO      EDYN9999 IF EQUAL
.
EDYN1000  CLEAR     ERRMESS
          APPEND    "Yes/No field has an invalid value - '",ERRMESS
          APPEND    DIM1A,ERRMESS
          APPEND    "'",ERRMESS
          CALL      PRNT0000
.
EDYN9999  RETURN
.
.******************************************************************************
.*                                  ED09N000                                  *
.*                            Edit "0" to "9" fields                             *
.******************************************************************************
ED09N000  TYPE      DIM1A
          GOTO      ED09N400 IF NOT EQUAL
          GOTO      ED09N990 IF EOS
.
          SCAN      DIM1A,VALUES
          GOTO      ED09N999 IF EQUAL
.
ED09N400  CLEAR     ERRMESS
          APPEND    "Numeric field has an invalid value - '",ERRMESS
          APPEND    DIM1A,ERRMESS
          APPEND    "'",ERRMESS
          CALL      PRNT0000
          GOTO      ED09N999
.
ED09N990  MOVE      SP1,DIM1A
.
ED09N999  MOVE      SP10,VALUES
          RETURN
.
.******************************************************************************
.*                                  EDHCP000                                  *
.*                      Map and Edit HCP/CaseTeam/Users codes                 *
.******************************************************************************
EDHCP000  UNPACK    SP70,HCPCODE,HCPECLCD,HCPIBACD,HCPSPAR   * table flds.
.
          MATCH     SP10,EHCPCOD            * is input record field blank?
          GOTO      EDHCP999 IF EQUAL
.
.                                           * read the Category Mapping table
          PACK      KEY13,EHCPCAT,EHCPCOD,SP20
          CALL      RDTHCP1
          BRANCH    OVRCD,EDHCP900
.
          GOTO      EDHCP999
.
EDHCP900  CLEAR     ERRMESS
          MATCH     "HCP",EHCPCAT
          GOTO      EDHCP901 IF NOT EQUAL
.
          APPEND    "HCP code '",ERRMESS
          SQUEEZE   EHCPCOD
          APPEND    EHCPCOD,ERRMESS
          APPEND    "' not found on HCP Mapping table",ERRMESS
          CALL      PRNT0000
          GOTO      EDHCP999
.
EDHCP901  MATCH     "CTM",EHCPCAT
          GOTO      EDHCP902 IF NOT EQUAL
.
          APPEND    "Caseteam code '",ERRMESS
          SQUEEZE   EHCPCOD
          APPEND    EHCPCOD,ERRMESS
          APPEND    "' not found on CTM Mapping table",ERRMESS
          CALL      PRNT0000
          GOTO      EDHCP999
.
EDHCP902  MATCH     "USR",EHCPCAT
          GOTO      EDHCP999 IF NOT EQUAL
.
          APPEND    "User code '",ERRMESS
          SQUEEZE   EHCPCOD
          APPEND    EHCPCOD,ERRMESS
          APPEND    "' not found on USR Mapping table",ERRMESS
          CALL      PRNT0000
          GOTO      EDHCP999
.
.
EDHCP999  RETURN
.
.******************************************************************************
.*                                  EDCAT000                                  *
.*                      Map and Edit Category Codes                           *
.******************************************************************************
EDCAT000  UNPACK    SP70,CATECAT,CATECODE,CATPCAT,CATPCODE,CATSPAR * table flds
          UNPACK    SP70,PCATCOD            * result field
.
          MATCH     SP10,ECATCOD            * is input record field blank?
          GOTO      EDCAT999 IF EQUAL
.
.                                           * read the Category Mapping table
          PACK      KEY12,ECATCAT,ECATCOD,SP20
          CALL      RDTCAT1
          BRANCH    OVRCD,EDCAT900
.
          MATCH     SP2,CATPCAT             * is webPAS Cat.map blank?
          IF        @EQUAL
            RESET     VALCOD01
            SCAN      ECATCAT,VALCOD01
            GOTO      EDCAT200 IF EQUAL     * not a Cat/Code - use Code value
          ENDIF
.
.                                           * validate the PAS Category Code
          MATCH     SP3,CATPCODE
          GOTO      EDCAT999 IF EQUAL       * blank webPAS Code - bypass
.
          PACK      KEY5,CATPCAT,CATPCODE,SP10
          CALL      RDCODE1
          BRANCH    OVRCD,EDCAT901          * Code not found - error
.
          MOVE      CATPCODE,PCATCOD
          GOTO      EDCAT999
.
.
.
EDCAT200  MOVE      CATPCODE,PCATCOD        * ******* Codes search ********
          GOTO      EDCAT999
.
EDCAT900  CLEAR     ERRMESS
          APPEND    "Eclipse Cat/Code '",ERRMESS
          SQUEEZE   ECATCAT
          APPEND    ECATCAT,ERRMESS
          APPEND    "/",ERRMESS
          SQUEEZE   ECATCOD
          APPEND    ECATCOD,ERRMESS
          APPEND    "' not on Category Mapping table",ERRMESS
          CALL      PRNT0000
          GOTO      EDCAT999
.
EDCAT901  CLEAR     ERRMESS
          APPEND    "webPAS Cat/Code '",ERRMESS
          SQUEEZE   CATPCAT
          APPEND    CATPCAT,ERRMESS
          APPEND    "/",ERRMESS
          SQUEEZE   CATPCODE
          APPEND    CATPCODE,ERRMESS
          APPEND    "' not on Cat/Codes table",ERRMESS
          CALL      PRNT0000
          GOTO      EDCAT999
.
EDCAT999  RETURN
+
.******************************************************************************
.*                                  EDURNO00                                  *
.*                        Edit UR Number                                      *
.******************************************************************************
EDURNO00  MOVE      ZERO,EXIT
          PACK      PURNO,FLD60IN,SP8
          MOVE      "8",LENGTH              * retrieve UR No and right justify
          CALL      RJUS0000                * right justify UR No.
          PACK      KEY8,FLD60OUT 
.
          CALL      RDMAST1
          BRANCH    OVRCD,EDURNO50
          GOTO      EDURNO99
.
EDURNO50  CLEAR     ERRMESS
          APPEND    "UR Number '",ERRMESS
          APPEND    KEY8,ERRMESS
          APPEND    "' not on webPAS PMI Master - record bypassed",ERRMESS
          APPEND    " *****",ERRMESS
          CALL      PRNT0000
.
EDURNO99  RETURN
+
.******************************************************************************
.*                                  EDNUM000                                  *
.*                              Edit Numeric field                            *
.******************************************************************************
EDNUM000  TYPE      FLD60OUT 
          GOTO      EDNUM999 IF EQUAL
          GOTO      EDNUM990 IF EOS
.
EDNUM100  CLEAR     ERRMESS
          APPEND    "Numeric field is invalid - '",ERRMESS
          APPEND    FLD60OUT,ERRMESS
          APPEND    "'",ERRMESS
          CALL      PRNT0000
...       GOTO      EDNUM999
.
EDNUM990  MOVE      SP1,FLD60OUT
.
EDNUM999  RETURN
.
.******************************************************************************
.*                                  HEAD0000                                  *
.*                           Print The Report Header                          *
.******************************************************************************
HEAD0000  MOVE      ONE,CNOUNDLN
          MOVE      "- Error report",CPHDROPT
          CALL      HEAD132                 * Print the report header
          PRINT     *1,HEADDES1,*36,HEADDES2,*N:
                    *1,"Input data string",*42,"Rec.No.",*50,COLTXT:
                    *55,"Error",*N;
          PRINT     *N;
HEAD9999  RETURN
+
.******************************************************************************
.*                                  PRNT0000                                  *
 *                            Print An Error Report                           *
.******************************************************************************
PRNT0000  COMPARE   "56",CLNO
          CALL      HEAD0000 IF NOT LESS    * Print the report header
.
          RESET     ERRDATA
          RESET     ERRMESS
          PRINT     *1,ERRDATA,*43,RECIN,*50,FLDNO,*55,ERRMESS
.
          ADD       ONE,CLNO
          ADD       ONE,ERRCOUNT
          PACK      ERRDATA,SP70
          PACK      ERRMESS,SP70
.
PRNT9999  RETURN
+
.******************************************************************************
.*                                  PRLN0000                                  *
 *                            Print a message line                            *
.******************************************************************************
PRLN0000  COMPARE   "54",CLNO
          CALL      HEAD0000 IF NOT LESS    * Print the report header
.
          RESET     ERRMESS
          PRINT     *N,*N,*1,ERRMESS,*N,*N
.
          ADD       ONE,CLNO
          PACK      ERRMESS,SP70
.
PRLN9999  RETURN
+
.******************************************************************************
.                                   NXTVIS00
.               Get Next Admission/Visit Number -  From PATPRG31
.******************************************************************************
NXTVIS00  COMPARE   TWO,OPTION
          GOTO      NXTVIS10 IF EQUAL
.
.                                           * Option=1 - use temp Visit No.
          ADD       ONE,TMPVISNO            * allocate temporary Visit No.
          MOVE      TMPVISNO,VISITNO
          GOTO      NXTVIS99
.
NXTVIS10  MOVE      " 10",PRXCODE           * Option=2 - Upload to webPAS
          CALL      GETSLK00
          READ      CONTROLF,TEN;*1,AADMNO
          ADD       ONE,AADMNO
          WRITAB    CONTROLF,TEN;*1,AADMNO
          CALL      RELSLK00
          SUB       ONE,AADMNO
          MOVE      AADMNO,VISITNO
.
. Check with visit file, make sure it does not exist already
.
          MOVE      AADMNO,PVIBILL
          MOVE      PVIBILL,KEY8
          CALL      RDAVISA1
          COMPARE   ZERO,OVRCD
          GOTO      NXTVIS10 IF EQUAL       * get the next Admission Number
.
          CALL      RDAMISS1
          COMPARE   ZERO,OVRCD
          GOTO      NXTVIS10 IF EQUAL       * get the next Admission Number
.
NXTVIS99  RETURN
+
.******************************************************************************
.                                   NXTSES00
.               Get Next Session No - Lifted from ALLWEB06-SESS1000
.******************************************************************************
NXTSES00  COMPARE   TWO,OPTION
          GOTO      NXTSES10 IF EQUAL
.
.                                           * Option=1 - use temp Session No.
          ADD       ONE,TMPSESNO            * allocate temporary Session No.
          MOVE      TMPSESNO,ALGRSESN
          GOTO      NXTSES99
.
.
NXTSES10  MOVE      "106",PRXCODE           * Option=2 - Upload to webPAS
          CALL      GETSLK00
          READ      CONTROLF,HUND06;*185,ALCNSESN
          ADD       ONE,ALCNSESN
          WRITAB    CONTROLF,HUND06;*185,ALCNSESN
          CALL      RELSLK00
.
          SUB       ONE,ALCNSESN
          MOVE      ALCNSESN,ALGRSESN
.
          PACK      KEY8,ALGRSESN,SP70
          CALL      RAALGRO1
          COMPARE   ZERO,OVRCD
          GOTO      NXTSES10 IF EQUAL
.
NXTSES99  MOVE      ALGRSESN,SESSNNO
          RETURN
.
.******************************************************************************
.                                   NXTCON00
.               Get Next Contact No - Lifted from ALLWEB06-CONT1000
.******************************************************************************
NXTCON00  COMPARE   TWO,OPTION
          GOTO      NXTCON10 IF EQUAL
.
.                                           * Option=1 - use temp Contact No.
          ADD       ONE,TMPCONNO            * allocate temporary Contact No.
          MOVE      TMPCONNO,ALGECONT
          GOTO      NXTCON99
.
.
NXTCON10  MOVE      "106",PRXCODE           * Option=2 - Upload to webPAS
          CALL      GETSLK00
          READ      CONTROLF,HUND06;*193,ALCNCONT
          ADD       ONE,ALCNCONT
          WRITAB    CONTROLF,HUND06;*193,ALCNCONT
          CALL      RELSLK00
.
          SUB       ONE,ALCNCONT
          MOVE      ALCNCONT,ALGECONT
.
          PACK      KEY8,ALGECONT,SP70
          CALL      RAALGRE1
          COMPARE   ZERO,OVRCD
          GOTO      NXTCON10 IF EQUAL
.
NXTCON99  MOVE      ALGECONT,CONTRNO
          RETURN
.******************************************************************************
.*                                  CLEARALL                                  *
.*                         Clear Eclipse variables                            *
.******************************************************************************
CLEARALL  MOVE      ZERO,EXIT
.
          CALL      CXALLITV
          CALL      CXALLGRE
          CALL      CXALLGRO
          CALL      CXALLGPA
          CALL      CXALLRLN
          CALL      CXALLRSA
          CALL      CXALLSUP
          CALL      CXPATNOB
.
          CALL      CLALLREF
          CALL      CLALLENC
          CALL      CLMEHDIA
          CALL      CLPATDSC
          CALL      CLPATMIS
          CALL      CLPATTRN
          CALL      CLPATVIS
          CALL      CLPMSVX1
.
CLEAR999  RETURN
.
.------------------------------------------------------------------------------
.
CLRMEH00  MOVE      ZERO,EXIT
CLRHLS00  MOVE      SP70,MHHLURNO           * Legal Status Header
          MOVE      SP70,MHHLUNIQ
          MOVE      SP70,MHHLSDAT
          MOVE      SP70,MHHLSTIM
          MOVE      SP70,MHHLEDAT
          MOVE      SP70,MHHLETIM
          MOVE      SP70,MHHLSTAT
          MOVE      SP70,MHHLSREF
          MOVE      SP70,MHHLORCD
          MOVE      SP70,MHHLHCPC
          MOVE      SP70,MHHLRNAM
          MOVE      SP70,MHHLRAD1
          MOVE      SP70,MHHLRAD2
          MOVE      SP70,MHHLRAD3
          MOVE      SP70,MHHLRAD4
          MOVE      SP70,MHHLRPOS
          MOVE      SP70,MHHLRTEL
          MOVE      SP70,MHHLLAWY
          MOVE      SP70,MHHLCURR
          MOVE      SP70,MHHLPRIS
          MOVE      SP70,MHHLESDT
          MOVE      SP70,MHHLMDAT
          MOVE      SP70,MHHLMTIM
          MOVE      SP70,MHHLMUID
.
CLRDLS00  MOVE      SP70,MHDLURNO           * Legal Status Detail
          MOVE      SP70,MHDLUNIQ
          MOVE      SP70,MHDLSDAT
          MOVE      SP70,MHDLSTIM
          MOVE      SP70,MHDLSCOD
          MOVE      SP70,MHDLSTAT
          MOVE      SP70,MHDLRDAT
          MOVE      SP70,MHDLRTIM
          MOVE      SP70,MHDLHCPC
          MOVE      SP70,MHDLCASE
          MOVE      SP70,MHDLPOCC
          MOVE      SP70,MHDLREMD
          MOVE      SP70,MHDLDRIV
          MOVE      SP70,MHDLRESD
          MOVE      SP70,MHDLRCOD
          MOVE      SP70,MHDLACTV
          MOVE      SP70,MHDLCMNT
          MOVE      SP70,MHDLMDAT
          MOVE      SP70,MHDLMTIM
          MOVE      SP70,MHDLMUID
          MOVE      SP70,MHDLSENT
          MOVE      SP70,MHDLEDAT
          MOVE      SP70,MHDLETIM
.
CLRHON00  PACK      MHHNVISN,SP70           * Mental Health MH HONOS Reporting
          PACK      MHHNUNIQ,SP70
          PACK      MHHNHOTY,SP70
          PACK      MHHNACTV,SP70
          PACK      MHHNSENT,SP70
          PACK      MHHNHDAT,SP70
          PACK      MHHNSSET,SP70
          PACK      MHHNREAS,SP70
          PACK      MHHNRHCP,SP70
          PACK      MHHNCAST,SP70
          PACK      MHHNPHCP,SP70
          PACK      MHHNWEBC,SP70
          PACK      MHHNCDTE,SP70
          PACK      MHHNCTIM,SP70
          PACK      MHHNCOMP,SP70
          PACK      MHHNWEBF,SP70
          PACK      MHHNDATF,SP70
          PACK      MHHNTIMF,SP70
          PACK      MHHNWEBU,SP70
          PACK      MHHNDATU,SP70
          PACK      MHHNTIMU,SP70
          PACK      MHHNFOCU,SP70
          PACK      MHHNCULS,SP70
          PACK      MHHNNGOS,SP70
          PACK      MHHNNGOA,SP70
          PACK      MHHNNGOW,SP70
          PACK      MHHNVOCA,SP70
          PACK      MHHNNSNG,SP70
          PACK      MHHNCOLS,SP70
          PACK      MHHNMODA,SP70
          PACK      MHHNADQ1,SP70
          PACK      MHHNADQ2,SP70
          PACK      MHHNADQ3,SP70
          PACK      MHHNADQ4,SP70
          PACK      MHHNADQ5,SP70
          PACK      MHHNADQ6,SP70
          PACK      MHHNADQ7,SP70
          PACK      MHHNADQ8,SP70
          PACK      MHHNAQ8A,SP70
          PACK      MHHNFREE,SP70
          PACK      MHHNADQ9,SP70
          PACK      MHHNAQ10,SP70
          PACK      MHHNAQ11,SP70
          PACK      MHHNAQ12,SP70
          PACK      MHHNCYQ1,SP70
          PACK      MHHNCYQ2,SP70
          PACK      MHHNCYQ3,SP70
          PACK      MHHNCYQ4,SP70
          PACK      MHHNCYQ5,SP70
          PACK      MHHNCYQ6,SP70
          PACK      MHHNCYQ7,SP70
          PACK      MHHNCYQ8,SP70
          PACK      MHHNCYQ9,SP70
          PACK      MHHNCQ10,SP70
          PACK      MHHNCQ11,SP70
          PACK      MHHNCQ12,SP70
          PACK      MHHNCQ13,SP70
          PACK      MHHNCQ14,SP70
          PACK      MHHNCQ15,SP70
          PACK      MHHNLDQ1,SP70
          PACK      MHHNLDQ2,SP70
          PACK      MHHNLDQ3,SP70
          PACK      MHHNLDQ4,SP70
          PACK      MHHNLDQ5,SP70
          PACK      MHHNLDQ6,SP70
          PACK      MHHNLDQ7,SP70
          PACK      MHHNLDQ8,SP70
          PACK      MHHNLDQ9,SP70
          PACK      MHHNLQ10,SP70
          PACK      MHHNLQ11,SP70
          PACK      MHHNLQ12,SP70
          PACK      MHHNLQ13,SP70
          PACK      MHHNLQ14,SP70
          PACK      MHHNLQ15,SP70
          PACK      MHHNLQ16,SP70
          PACK      MHHNLQ17,SP70
          PACK      MHHNLQ18,SP70
          PACK      MHHNSCQ1,SP70
          PACK      MHHNSCQ2,SP70
          PACK      MHHNSCQ3,SP70
          PACK      MHHNSCQ4,SP70
          PACK      MHHNSCQ5,SP70
          PACK      MHHNSCQ6,SP70
          PACK      MHHNSCQ7,SP70
          PACK      MHHNHVER,SP70
          PACK      MHHNLD3A,SP70
.
CLRMEH99  RETURN
.
.******************************************************************************
.*                                  CXALLITV                                  *
.******************************************************************************
CXALLITV  MOVE      ZERO,EXIT
          MOVE      SP70,ALIVVISN
          MOVE      SP70,ALIVENCT
          MOVE      SP70,ALIVICNT
          MOVE      SP70,ALIVCODE
          MOVE      SP70,ALIVDURA
          MOVE      SP70,ALIVCDAT
          MOVE      SP70,ALIVCTIM
          MOVE      SP70,ALIVCUID
          MOVE      SP70,ALIVUDAT
          MOVE      SP70,ALIVUTIM
          MOVE      SP70,ALIVUUID
          MOVE      SP70,ALIVSPAR
CXITV999  RETURN
.
.******************************************************************************
.*                                  CXALLGRO                                  *
.******************************************************************************
CXALLGRO  MOVE      ZERO,EXIT
          MOVE      SP70,ALGRSESN
          MOVE      SP70,ALGRNAME
          MOVE      SP70,ALGRSEST
          MOVE      SP70,ALGRLOCN
          MOVE      SP70,ALGRDAYI
          MOVE      SP70,ALGRSDAT
          MOVE      SP70,ALGRSTIM
          MOVE      SP70,ALGRDURN
          MOVE      SP70,ALGRDEPT
          MOVE      SP70,ALGRFREQ
          MOVE      SP70,ALGRACTV
          MOVE      SP70,ALGRCDAT
          MOVE      SP70,ALGRCTIM
          MOVE      SP70,ALGRCUID
          MOVE      SP70,ALGRUDAT
          MOVE      SP70,ALGRUTIM
          MOVE      SP70,ALGRUUID
          MOVE      SP70,ALGRSPAR
CXGRO999  RETURN
.
.******************************************************************************
.*                                  CXALLGRE                                  *
.******************************************************************************
CXALLGRE  MOVE      ZERO,EXIT
          MOVE      SP70,ALGECONT
          MOVE      SP70,ALGESESN
          MOVE      SP70,ALGELOCN
          MOVE      SP70,ALGEGDTE
          MOVE      SP70,ALGEGTIM
          MOVE      SP70,ALGEDURN
          MOVE      SP70,ALGECDAT
          MOVE      SP70,ALGECTIM
          MOVE      SP70,ALGECUID
          MOVE      SP70,ALGEUDAT
          MOVE      SP70,ALGEUTIM
          MOVE      SP70,ALGEUUID
          MOVE      SP70,ALGESPAR
.
CXGRE999  RETURN
.
.******************************************************************************
.*                                  CXALLGPA                                  *
.******************************************************************************
CXALLGPA  MOVE      ZERO,EXIT
          MOVE      SP70,ALGACONT
          MOVE      SP70,ALGAURNO
          MOVE      SP70,ALGAREFN
          MOVE      SP70,ALGACURP
          MOVE      SP70,ALGAPSTA
          MOVE      SP70,ALGAMEAL
          MOVE      SP70,ALGAMOHX
          MOVE      SP70,ALGACDAT
          MOVE      SP70,ALGACTIM
          MOVE      SP70,ALGACUID
          MOVE      SP70,ALGAUDAT
          MOVE      SP70,ALGAUTIM
          MOVE      SP70,ALGAUUID
          MOVE      SP70,ALGASPAR
.
CXGPA999  RETURN
.
.******************************************************************************
.*                                  CXALLRLN                                  *
.******************************************************************************
CXALLRLN  MOVE      ZERO,EXIT
          MOVE      SP70,ALRLVISN
          MOVE      SP70,ALRLLNKV
          MOVE      SP70,ALRLCDAT
          MOVE      SP70,ALRLCTIM
          MOVE      SP70,ALRLCUID
          MOVE      SP70,ALRLSPAR
CXRLN999  RETURN
.
.******************************************************************************
.*                                  CXALLRSA                                  *
.******************************************************************************
CXALLRSA  MOVE      ZERO,EXIT
          MOVE      SP70,ALRAVISN
          MOVE      SP70,ALRALADM
          MOVE      SP70,ALRACDAT
          MOVE      SP70,ALRACTIM
          MOVE      SP70,ALRACUID
          MOVE      SP70,ALRAUDAT
          MOVE      SP70,ALRAUTIM
          MOVE      SP70,ALRAUUID
          MOVE      SP70,ALRASPAR
CXRSA999  RETURN
.
.******************************************************************************
.*                                  CXALLSUP                                  *
.******************************************************************************
CXALLSUP  MOVE      ZERO,EXIT
          MOVE      SP70,ALSPVISN
          MOVE      SP70,ALSPENCT
          MOVE      SP70,ALSPSCNT
          MOVE      SP70,ALSPSCOD
          MOVE      SP70,ALSPCDAT
          MOVE      SP70,ALSPCTIM
          MOVE      SP70,ALSPCUID
          MOVE      SP70,ALSPUDAT
          MOVE      SP70,ALSPUTIM
          MOVE      SP70,ALSPUUID
          MOVE      ZERO,ALSPQNTY
          MOVE      ZERO,ALSPPRCE
          MOVE      SP70,ALSPSPAR
CXSUP999  RETURN
+
.******************************************************************************
.*                                  CLECL000                                  *
.*                         Clear Eclipse variables                            *
.******************************************************************************
CLECL000  MOVE      SP70,FLD60001
          MOVE      SP70,FLD60001
          MOVE      SP70,FLD60002
          MOVE      SP70,FLD60003
          MOVE      SP70,FLD60004
          MOVE      SP70,FLD60005
          MOVE      SP70,FLD60006
          MOVE      SP70,FLD60007
          MOVE      SP70,FLD60008
          MOVE      SP70,FLD60009
          MOVE      SP70,FLD60010
          MOVE      SP70,FLD60011
          MOVE      SP70,FLD60012
          MOVE      SP70,FLD60013
          MOVE      SP70,FLD60014
          MOVE      SP70,FLD60015
          MOVE      SP70,FLD60016
          MOVE      SP70,FLD60017
          MOVE      SP70,FLD60018
          MOVE      SP70,FLD60019
          MOVE      SP70,FLD60020
          MOVE      SP70,FLD60021
          MOVE      SP70,FLD60022
          MOVE      SP70,FLD60023
          MOVE      SP70,FLD60024
          MOVE      SP70,FLD60025
          MOVE      SP70,FLD60026
          MOVE      SP70,FLD60027
          MOVE      SP70,FLD60028
          MOVE      SP70,FLD60029
          MOVE      SP70,FLD60030
          MOVE      SP70,FLD60031
          MOVE      SP70,FLD60032
          MOVE      SP70,FLD60033
          MOVE      SP70,FLD60034
          MOVE      SP70,FLD60035
          MOVE      SP70,FLD60036
          MOVE      SP70,FLD60037
          MOVE      SP70,FLD60038
          MOVE      SP70,FLD60039
          MOVE      SP70,FLD60040
          MOVE      SP70,FLD60041
          MOVE      SP70,FLD60042
          MOVE      SP70,FLD60043
          MOVE      SP70,FLD60044
          MOVE      SP70,FLD60045
          MOVE      SP70,FLD60046
          MOVE      SP70,FLD60047
          MOVE      SP70,FLD60048
          MOVE      SP70,FLD60049
          MOVE      SP70,FLD60050
          MOVE      SP70,FLD60051
          MOVE      SP70,FLD60052
          MOVE      SP70,FLD60053
          MOVE      SP70,FLD60054
          MOVE      SP70,FLD60055
          MOVE      SP70,FLD60056
          MOVE      SP70,FLD60057
          MOVE      SP70,FLD60058
          MOVE      SP70,FLD60059
          MOVE      SP70,FLD60060
.
CLECL999  RETURN
.
.******************************************************************************
.*                                  CXPATNOB                                  *
.******************************************************************************
CXPATNOB  MOVE      ZERO,EXIT
          MOVE      SP70,NBWARD
          MOVE      SP70,DNBADMNO
          MOVE      SP70,DNBPLUR
          MOVE      SP70,NBROOM
          MOVE      SP70,NBSPARE
.
CXNOB999  RETURN
+
.==============================================================================
.                Tempfile I/O
.==============================================================================
RSTMEM1   RESET     KEY11
          READ      TEMPMEM1,KEY11;;
          RETURN
.
RKTMEM1   MOVE      ZERO,OVRCD
          READKS    TEMPMEM1;MEMCODE,MEMFNAME,MEMPATFN,MEMSTAT,MEMSPAR
          GOTO      OVERCOND IF OVER
          RETURN
.                                           
RPTMEM1   MOVE      ZERO,OVRCD
          READKP    TEMPMEM1;MEMCODE,MEMFNAME,MEMPATFN,MEMSTAT,MEMSPAR
          GOTO      OVERCOND IF OVER
          RETURN
.
RDTMEM1   MOVE      ZERO,OVRCD
          RESET     KEY11
          READ      TEMPMEM1,KEY11;MEMCODE,MEMFNAME,MEMPATFN,MEMSTAT,MEMSPAR
          GOTO      OVERCOND IF OVER
          RETURN
.
WRTMEM1   RESET     KEY11
          WRITE     TEMPMEM1,KEY11;MEMCODE,MEMFNAME,MEMPATFN,MEMSTAT,MEMSPAR
          RETURN
.
UPTMEM1   
          UPDATE    TEMPMEM1;MEMCODE,MEMFNAME,MEMPATFN,MEMSTAT,MEMSPAR
          RETURN
.
.                   -------------------------------------
RSTMEID1  RESET     KEY23
          READ      TEMPEID1,KEY23;;
          RETURN
.
RATMEID1  RESET     KEY23
          MOVE      ZERO,OVRCD
          READ      TEMPEID1,KEY23;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
RKTMEID1  MOVE      ZERO,OVRCD
          READKS    TEMPEID1;EIDIDCOD,EIDIDNO,EIDVISNO,EIDENCNO,EIDSESNO:
                                   EIDCONNO,EIDTEST,EIDOOONO,EIDSPAR
          GOTO      OVERCOND IF OVER
          RETURN
.
RDTMEID1  MOVE      ZERO,OVRCD
          RESET     KEY23
          READ      TEMPEID1,KEY23;EIDIDCOD,EIDIDNO,EIDVISNO,EIDENCNO,EIDSESNO:
                                   EIDCONNO,EIDTEST,EIDOOONO,EIDSPAR
          GOTO      OVERCOND IF OVER
          RETURN
.
WRTMEID1  RESET     KEY23
          WRITE     TEMPEID1,KEY23;EIDIDCOD,EIDIDNO,EIDVISNO,EIDENCNO,EIDSESNO:
                                   EIDCONNO,EIDTEST,EIDOOONO,EIDSPAR
          RETURN
.
UPTMEID1  
          UPDATE    TEMPEID1;EIDIDCOD,EIDIDNO,EIDVISNO,EIDENCNO,EIDSESNO:
                                   EIDCONNO,EIDTEST,EIDOOONO,EIDSPAR
          RETURN
.
DETMEID1  RESET     KEY23
          DELETE    TEMPEID1,KEY23
          RETURN
.
.                   -------------------------------------
.
RSTHCP1   RESET     KEY13
          READ      TEMPHCP1,KEY13;;
          RETURN
.
RKTHCP1   MOVE      ZERO,OVRCD
          READKS    TEMPHCP1;HCPCODE,HCPECLCD,HCPIBACD,HCPSPAR
          GOTO      OVERCOND IF OVER
          RETURN
.
RPTHCP1   MOVE      ZERO,OVRCD
          READKP    TEMPHCP1;HCPCODE,HCPECLCD,HCPIBACD,HCPSPAR
          GOTO      OVERCOND IF OVER
          RETURN
.
RDTHCP1   MOVE      ZERO,OVRCD
          RESET     KEY13
          READ      TEMPHCP1,KEY13;HCPCODE,HCPECLCD,HCPIBACD,HCPSPAR
          GOTO      OVERCOND IF OVER
          RETURN
.
WRTHCP1   RESET     KEY13
          WRITE     TEMPHCP1,KEY13;HCPCODE,HCPECLCD,HCPIBACD,HCPSPAR
          RETURN
.
DETHCP1   RESET     KEY13
          DELETE    TEMPHCP1,KEY13
          RETURN
.
.                   -------------------------------------
.
.                                           * Category/Codes temp file
RSTCAT1   RESET     KEY12
          READ      TEMPCAT1,KEY12;;
          RETURN
.
RKTCAT1   MOVE      ZERO,OVRCD
          READKS    TEMPCAT1;CATECAT,CATECODE,CATPCAT,CATPCODE,CATSPAR
          GOTO      OVERCOND IF OVER
          RETURN
.
RPTCAT1   MOVE      ZERO,OVRCD
          READKP    TEMPCAT1;CATECAT,CATECODE,CATPCAT,CATPCODE,CATSPAR
          GOTO      OVERCOND IF OVER
          RETURN
.
RDTCAT1   MOVE      ZERO,OVRCD
          RESET     KEY12
          READ      TEMPCAT1,KEY12;CATECAT,CATECODE,CATPCAT,CATPCODE,CATSPAR
          GOTO      OVERCOND IF OVER
          RETURN
.
WRTCAT1   RESET     KEY12
          WRITE     TEMPCAT1,KEY12;CATECAT,CATECODE,CATPCAT,CATPCODE,CATSPAR
          RETURN
.
DETCAT1   RESET     KEY12
          DELETE    TEMPCAT1,KEY12
          RETURN
.
.==============================================================================
.
          INC       STD001IO
          INC       CLALLREF
          INC       CLALLENC
          INC       CLMEHDIA
          INC       CLMEHVIS
          INC       CLPATDSC
          INC       CLPATMIS
          INC       CLPATTRN
          INC       CLPATVIS
          INC       CLPMSVX1
.
          INC       ALLCASIO/INC            * A/H Caseteam codes  
          INC       ALLDEPIO/INC            * A/H Department Table
          INC       ALLENCIO/INC            * A/H Encounter Table
          INC       ALLGROIO/INC            * A/H Group Session Master
          INC       ALLGREIO/INC            * A/H Group Session Details
          INC       ALLGPAIO/INC            * A/H Group Encounter Details
          INC       ALLINCIO/INC            *DA/H Health Interventions
          INC       ALLITVIO/INC            * A/H Health Interventions
          INC       ALLREFIO/INC            * A/H Referral Table
          INC       ALLRLNIO/INC            * A/H Linked SACS Referrals
          INC       ALLRSAIO/INC            * A/H Residential Admissions
          INC       ALLSERIO/INC            * 
          INC       ALLSUPIO/INC            * A/H Encounter Supplies
          INC       MEHDIAIO/INC            * Mental Health Diagnosis History
          INC       MEHHLSIO/INC            * Mental Health Legal Status Header
          INC       MEHDLSIO/INC            * Mental Health Legal Status Detail
          INC       MEHHONIO/INC            * Mental Health MH HoNOS Reporting
          INC       MEHVI1IO/INC            * Mental Health Visit Table
          INC       PATCODIO/INC
          INC       PATMA1IO/INC            * PMI Master
          INC       PATVISIO/INC            * Patient Visit Details
          INC       PMSVX1IO/INC            * Patient Visit Extension
          INC       PMSHCPIO/INC            * Patient HCP
          INC       PATMI1IO/INC            * Patient Admission Details
          INC       PATDSCIO/INC            * Patient Discharge details
          INC       PATTRNIO/INC            * Patient Transfer Records
          INC       PATWR1IO/INC            * Patient Ward/Bed          
          INC       PATNOBIO/INC            * Patient Ward with no Beds
          INC       SINCIAIO/INC            * 
          INC       WEBSECIO/INC            * 
+

.------------------------------------------------------
. Inventory System File Opens/Closes
.------------------------------------------------------
APISOPN1  PACK      LASTISYS,LASTISYS,SP70       * save current inv sys
.
          READ      CONTROLF,TWENTY3;*95,HACCNT
          COMPARE   ZERO,HACCNT                  * skip if no interface
          GOTO      APISOPN9 IF EQUAL
.
          MATCH     APISISC,SP70
          IF        @EQUAL
            GOTO      APISOPN9
          ELSE
            MATCH     APISISC,LASTISYS
            IF        @EQUAL
              GOTO      APISOPN9
            ELSE
              PACK      LASTISYS,APISISC,SP70
            ENDIF
          ENDIF
.
          CLOSE     CONTROLF                     * open control file
          CLEAR     KEY80
          APPEND    APISDIR,KEY80
          APPEND    "controlf.txt",KEY80
          RESET     KEY80
          SQUEEZE   KEY80
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      CONTROLF,KEY80               * inventory controlf exists ?
          TRAPCLR   IO
          IF        OVRCD=1
            OPEN      CONTROLF,"controlf"
            READ      CONTROLF,TWENTY3;*248,HAVGCOST
            READ      CONTROLF,TWENTY4;*165,HLASTCIN
            READ      CONTROLF,SIXTY3;*85,INCOSTYP,*240,SNCOPURC
          ELSE
            READ      CONTROLF,TWENTY3;*248,HAVGCOST
            READ      CONTROLF,TWENTY4;*165,HLASTCIN
            READ      CONTROLF,SIXTY3;*85,INCOSTYP,*240,SNCOPURC
            CLOSE     CONTROLF
            OPEN      CONTROLF,"controlf"
          ENDIF
.
          BRANCH     INCOSTYP,APISOPN5                * 0=inv, 1=sin
          GOTO       APISOPN9
.
APISOPN5  MOVE       "sinpoaaf",KEY8
          PACK       KEY80,APISDIR,KEY8
          SQUEEZE    KEY80
          OPEN       SINPOAA1,KEY80
.
          MOVE       "sinpocaf",KEY8
          PACK       KEY80,APISDIR,KEY8
          SQUEEZE    KEY80
          OPEN       SINPOCA1,KEY80
.
          MOVE       "sinpofaf",KEY8
          PACK       KEY80,APISDIR,KEY8
          SQUEEZE    KEY80
          OPEN       SINPOFA1,KEY80
.
          MOVE       "sinciaaf",KEY8
          PACK       KEY80,APISDIR,KEY8
          SQUEEZE    KEY80
          OPEN       SINCIAA1,KEY80
.
          MOVE       "sincieaf",KEY8
          PACK       KEY80,APISDIR,KEY8
          SQUEEZE    KEY80
          OPEN       SINCIEA1,KEY80
.
          MOVE       "sincicaf",KEY8
          PACK       KEY80,APISDIR,KEY8
          SQUEEZE    KEY80
          OPEN       SINCICA1,KEY80
.
          MOVE       "sinfacaf",KEY8
          PACK       KEY80,APISDIR,KEY8
          SQUEEZE    KEY80
          OPEN       SINFACA1,KEY80
.
          MOVE       "sinperaf",KEY8
          PACK       KEY80,APISDIR,KEY8
          SQUEEZE    KEY80
          OPEN       SINPERA1,KEY80
          OPEN       SINPERA2,KEY80
.
          MOVE       "sinoriaf",KEY8
          PACK       KEY80,APISDIR,KEY8
          SQUEEZE    KEY80
          OPEN       SINORIA1,KEY80
.
          MOVE       "sincgbaf",KEY8
          PACK       KEY80,APISDIR,KEY8
          SQUEEZE    KEY80
          OPEN       SINCGBA1,KEY80
.
          MOVE       "sinsuaaf",KEY8
          PACK       KEY80,APISDIR,KEY8
          SQUEEZE    KEY80
          OPEN       SINSUAA1,KEY80
.
          MOVE       "sinsubaf",KEY8
          PACK       KEY80,APISDIR,KEY8
          SQUEEZE    KEY80
          OPEN       SINSUBA1,KEY80
.
          MOVE       "sincihaf",KEY8
          PACK       KEY80,APISDIR,KEY8
          SQUEEZE    KEY80
          OPEN       SINCIHA1,KEY80
.
          MOVE       "sinwaraf",KEY8
          PACK       KEY80,APISDIR,KEY8
          SQUEEZE    KEY80
          OPEN       SINWARA1,KEY80
.
APISOPN9  RETURN
.
.---- close files ----
.
APISCLS1  PACK       LASTISYS,SP70                    * clear last inventory sys
          COMPARE    ZERO,HACCNT                      * skip if no interface
          GOTO       APISCLS9 IF EQUAL
.
          BRANCH     INCOSTYP,APISCLS5                * 0=inv, 1=sin
          GOTO       APISCLS9
.
APISCLS5  CLOSE      SINCIAA1
          CLOSE      SINCICA1
          CLOSE      SINFACA1
          CLOSE      SINPOAA1
          CLOSE      SINPOCA1
          CLOSE      SINPOFA1
          CLOSE      SINPERA1
          CLOSE      SINPERA2
          CLOSE      SINORIA1
          CLOSE      SINCGBA1
          CLOSE      SINSUAA1
          CLOSE      SINSUBA1
          CLOSE      SINCIHA1
          CLOSE      SINWARA1
.
APISCLS9  RETURN

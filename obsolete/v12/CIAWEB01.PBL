.-------------------------------------------------------------------------------
. Program       : CIAWEB01 
.
. Function      : Casemix Enquiries Server 
.                 Report 1: Display Casemix Details   
.                 Report 2: Casemix Extract Web Security Maintanence
.                 Report 3: Casemix Extract Code Search Maintanence
.                 Report 4: Maintain Casemix Types
.                 Report 5: Maintain Casemix Type Codes
.                 Report 6: Age Range Maintenance       
.                 Report 7: Time Period Maintenance       
.                 Report 8: Area Analysis Maintenance       
.                 Report 9: Income Component Mapping Maintenance.       
.
. Modfications  :
.    V11.03.01    05/01/2023  Bella Turco   TSK 0921957
.                 Added NOMORE00 - Display "No more records" at end of list
.                 Added PTCNNRTD - Displays number of rows set by parameter 
.                 value
.    V10.04.01    31.03.2014  B.G.Ackland  CAR 299363
.                 Replace META Tag Redirect with Javascript in Common RDIREC00
.                 Routine
.-------------------------------------------------------------------------------
.    V10.01.01    15/12/2010  Mike Laming   CAR 233046
.                 Mods to Misc.Charges PATMCHFD - incl. new routine PATMCHRD
.    V10.00.01    29/04/2010  J.Tan        CAR 220887
.                 Checking for Active/Inactive of Misc.charge
.    V9.05.01     09/03/2006  Ebon Clements CAR 78533
.                 Mods for PATCODTM - Hospital specific category codes
.    V9.05.B01    30.01.2006  Ebon Clements CAR 93186
.                 Mods for REDIRECT length change. Recompiled for IBAWEBDF
.    V9.04.01     01.10.2004  Ebon Clements   CAR 52623
.                 Removed scheduling of load casemix types - CASTYP50
.                 30.09.2004  Lina Vo         CAR 53798
.                 Changed program to use PTHSDCLM instead of PTCNDCLM for 
.                 Multi Hospital.
.    V9.03.07     04.05.2004  Davin           CAR 49542
.                 Changed "Post Code" to "Postcode"
.    V9.03.06     05.04.2004  Ebon Clements   CAR 48697
.                 Added selection list for casemix type summary code
.    V9.03.05     26.02.2004  Sylvek Litewka  CAR 46508
.                 Recompiled for CCSEPSFD changes.
.    V9.03.04     27.11.2003  Lina Vo     CAR 45465   
.                 Added report 9 - Income Component Mapping Maintenance.     
.    V9.03.03     25.11.2003  Lina Vo     CAR 45466   
.                 Added report 8 - Area Analysis Maintenance.              
.    V9.03.02     24.11.2003  Lina Vo     CAR 45464   
.                 Added report 7 - Time Period Maintenance.              
.    V9.03.01     17.11.2003  Lina Vo     CAR 45459, 45461 & 45462   
.                 Added report 4 - Casemix Type Maintenance.              
.                 Added report 5 - Casemix Type Code Maintenance.              
.                 Added Report 6 - Age Range Maintenance       
.    V9.02.01     09.11.2001  Glenn Saunders
.                 Apply casemix changes ported from 6.09-> 5.09 -> 9.00 
.    V9.00.B01    date u/kwn  Jagath,HPS
.                 Opened the file "ccscebaf"
.    V6.07.00     02.06.2000  Bronko Sosic
.                 Added option 2 and 3
.    V6.06.01     30.03.2000  Pat Dirito 
.                 Compiled to create an Object. 
.    V6.06.00     31.03.1999  K.C.Nelson
.                 Port from 6.05 to 6.06 
.    V6.05.01     16.02.1998  B.G.Ackland
.                 Changed to Dollars Only Output for Cost & Income
.    V6.05.00     20.01.1998  B.G.Ackland
.                 New Program
.
.------------------------------------------------------------------------
.
          INC       IBAWEBDF    
          INC       RSHWEBDF
          INC       CCSAADFD/INC
          INC       CCSAGEFD/INC
          INC       CCSCEAFD/INC
          INC       CCSCEBFD/INC
          INC       CCSCECFD/INC
          INC       CCSCEDFD/INC
          INC       CCSCEEFD/INC
          INC       CCSCONFD/INC            
          INC       CCSIMCFD/INC
          INC       CCSSTYFD/INC
          INC       CCSTIMFD/INC
          INC       CCSWSEFD/INC
          INC       CCSXHDFD/INC

          INC       CCSCEXFD/INC
          INC       CCSEPSFD/INC
.
          INC       PATCONFD/INC            * Patient Control file
          INC       PATHSPFD/INC            
          INC       PATMCHFD/INC            * Miscellaneous Charges file
          INC       PATWR1FD/INC
.
CCSTMPAF  FILE      ASCII, FIXED=80
LEVLCODE  DIM       3
.
NEXTPAGE  FORM      1         * Nextpage parameter
UPDTTYPE  DIM       1         * Update Type (A)dd,(U)pdate,(D)elete,Blank=disp
STARTKEY  DIM       10        * Starting Key
WEBUSEID  DIM       10        * User ID
LNK2PRT   FORM      1         * Update parent
VALIDATE  FORM      1         * Used to validate code before displaying.
.
DIM3A     DIM       3
DIM3B     DIM       3
DIM3C     DIM       3
DIM26     DIM       26
DIM26A    DIM       26
DISINC    FORM      12       * Dollars Only
DISCST    FORM      12       * Dollars Only
DISBED    FORM      10
DISALS    FORM      10.1
.
KEY21A    DIM       21
.
CURRDATE  DIM       8        
CURRTYPE  DIM       3        * Current casemix type for Next & Prev pages
TYPEDESC  DIM       35       * Current casemix type desc for Next & Prev pages
EXTRFLAG  FORM      1
CEXTRACT  DIM       4
CEXLEVEL  DIM       1
CEXTRKEY  DIM       30
.
CASEC001  DIM       4        * Extract ID
CASEC002  DIM       10       * Web User ID
CASEC003  DIM       1        * Start Level
CASEC004  DIM       10       * Start Code
CASEC005  DIM       3        * Template
.
CAEXT001   DIM       4        * Extract ID
CAEXT002   DIM       35       * Description
CAEXT003   DIM       2        * Hospital  
CAEXT004   DIM       8        * From Discharge Date
CAEXT005   DIM       8        * To Discharge Date
CAEXT006   DIM       8        * From Admission Date
CAEXT007   DIM       8        * To Admission Date
CAEXT008   DIM       1        * Include Incomplete Episodes 0=No
CAEXT009   DIM       1        * Visit Type (0=All)
CAEXT010   DIM       1        * Include Day Case 0=No
CAEXT011   DIM       4        * From Cost Model (blank = Actuals)
CAEXT012   DIM       4        * From Year 
CAEXT013   DIM       4        * To Cost Model
CAEXT014   DIM       4        * To Year   
CAEXT015   DIM       1        * Create Resource Usage Analysis
CAEXT016   DIM       3        * Level 1 Casemix Type
CAEXT017   DIM       3        * Level 2 Casemix Type
CAEXT018   DIM       3        * Level 3 Casemix Type
CAEXT019   DIM       1        * Update Statistics Min, Max&Var 0=No
CAEXT020   DIM       1        * Replace Income with Payment Model X
CAEXT021   DIM       1        * Replace Cost with Payment Model X
CAEXT022   DIM       1        * Replace Inc. with Theatre Time X
CAEXT023   DIM       1        * Replace Cost with Theatre Time X
.
CATYP001  DIM       3        * Casemix Type
CATYP002  DIM       35       * Description
CATYP003  DIM       3        * Field Length
CATYP004  DIM       1        * Justify Right 0=No
CATYP005  DIM       1        * Zero Fill 0=No
CATYP006  DIM       1        * Digit Entry 0=No
CATYP007  FORM      2        * Load From option    
CATYP008  DIM       40       * Load File           
.
CACOD001  DIM       3        * Casemix Type
CACOD002  DIM       10       * Casemix Code
CACOD003  DIM       35       * Description 
CACOD004  DIM       10       * Summary Casemix   
.
CAAGE001  DIM       1        * Range Definition Number 1-9
CAAGE002  DIM       3        * Group Code
CAAGE003  DIM       35       * Description 
CAAGE004  DIM       3        * To Age            
.
CAPRD001  DIM       1        * Period Definition Number 1-9
CAPRD002  DIM       8        * Period Ending Date
CAPRD003  DIM       35       * Description 
CAPRD004  DIM       10       * Level 3           
CAPRD005  DIM       10       * Level 2           
CAPRD006  DIM       10       * Level 1           
.
CAAAD001  DIM       1        * Area Analysis Definition Number 1-9
CAAAD002  DIM       10       * Postcode
CAAAD003  DIM       30       * Description 
CAAAD004  DIM       10       * Level 3           
CAAAD005  DIM       10       * Level 2           
CAAAD006  DIM       10       * Level 1           
.
CAINC001  DIM       1        * Map Type                           
.                              1 = Miscellaneous Group
.                              2 = Miscellaneous Code
.                              3 = Journal
.                              4 = Ward
.                              5 = Admission Type
.                              6 = Bed Type
CAINC002  DIM       9        * Map Code 
CAINC003  FORM      1        * Income Type 0-9
.
CODEA     INIT      "A "
CODEBT    INIT      "BT"
CODEFI    INIT      "FI"
CODEJ     INIT      "J "
.
ICACCOTH  INIT      "Acc. Other"
ICMISOTH  INIT      "Misc Other"
ICTHEATR  INIT      "Theatre"
.
MTYPMSCG  INIT      "Miscellaneous Groups (Category FI)"
MTYPMSCC  INIT      "Miscellaneous Codes"
MTYPJRNL  INIT      "Journal Codes (Category J)"
MTYPWARD  INIT      "Wards"
MTYPADMT  INIT      "Admission Types (Category A)"
MTYPBEDT  INIT      "Bed Types (Category BT)"
.
SAVHSTY   DIM       3        * Save Casemix Type
SAVHKEY   DIM       10       * Save Casemix Code
SAVHSUM   DIM       10       * Save Summary Casemix
.
NBSP      INIT      "&nbsp;"
TWOHUND   FORM      "200"
.
.*****************************************************************************
PRGID     INIT      "CIAWEB01"
VERSION   INIT      "V12.00.00"
PRGNAM    INIT      "Casemix Enquiries Server"
.*****************************************************************************
.
          CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID & Set Para
.
          COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400,MAIN1500:
                             MAIN1600,MAIN1700,MAIN1800,MAIN1900
          MOVE      "Invalid Option",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      CASEXT00
          GOTO      MAIN1000
.
MAIN1200  CALL      CIAWSE00           * Casemix Extract Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000           * next page
          GOTO      MAIN1000
.
MAIN1300  CALL      CIAEXT00           * Extract Code Search Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000           * next page
          GOTO      MAIN1000
.
MAIN1400  CALL      CASTYP00           * Maintain Casemix Types          
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000           * next page
          GOTO      MAIN1000
.
MAIN1500  CALL      CASCOD00           * Maintain Casemix Type Codes         
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000           * next page
          GOTO      MAIN1000
.
MAIN1600  CALL      AGERNG00           * Age Range Maintenance              
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000           * next page
          GOTO      MAIN1000
.
MAIN1700  CALL      TMEPRD00           * Time Period Maintenance              
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000           * next page
          GOTO      MAIN1000
.
MAIN1800  CALL      AREANL00           * Area Analysis Maintenance              
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000           * next page
          GOTO      MAIN1000
.
MAIN1900  CALL      INCMAP00           * Income Component Mapping Maintenance   
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000           * next page
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.-------------------------------------------------------------------------------
.  Next Page URL
.-------------------------------------------------------------------------------
NXTPG000  IF        NEXTPAGE=0
            CALL      WINCLS00      * Refresh parent and close window
          ENDIF

          IF        NEXTPAGE=1
            CALL      RDIREC00      * Redirect URL
          ENDIF
.
          IF        NEXTPAGE=2
            CALL      GOBACK00      * Go Back 1 html page
          ENDIF
.
          IF        NEXTPAGE=3
            CALL      DAH20000      * Go Back 2 html pages
          ENDIF
.
NXTPG999  RETURN
.-------------------------------------------------------------------------------
.  Goes back 1 page
.-------------------------------------------------------------------------------
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
          WRITE     HTMLFILE;"<script language=#"JavaScript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
                             "    self.close();":
                             "    opener.history.go(-1);":
                             "}":
                             "</script>"
          CALL      CLOSHTML
GOBACK99  RETURN
.------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------
INIT0000  OPEN      CCSXHDA1,"ccsxhdaf"
          OPEN      CCSXHDA3,"ccsxhdaf"
          OPEN      CCSSTYA1,"ccsstyaf" 
          OPEN      CCSSTYA2,"ccsstyaf" 
          OPEN      CCSAGEA1,"ccsageaf" 
          OPEN      CCSCEAA1,"ccsceaaf"
          OPEN      CCSWSEA1,"ccswseaf"
          OPEN      CCSWSEA2,"ccswseaf"
          OPEN      CCSEPSA1,"ccsepsaf"
          OPEN      CCSCEXA1,"ccscexaf"
          OPEN      CCSCEBA1,"ccscebaf"
          OPEN      CCSTIMA1,"ccstimaf"
          OPEN      CCSAADA1,"ccsaadaf"
          OPEN      CCSIMCA1,"ccsimcaf"
.
          OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE2,"patcodes"
          OPEN      PATHSPA1,"pathspaf"
          OPEN      PATMCHG1,"patmchgf"
          OPEN      PATWR1A1,"patwr1af"
          OPEN      PATWR1A3,"patwr1af"
.
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,TWENTY;*193,PTCNDCLM
          READ      CONTROLF,HUND25;*238,PTCNNRTD
.
          MOVE      ZERO,F2
          MOVE      PTCNNRTD,F2
          IF        F2 = 0
            MOVE      "10",PTCNNRTD
          ENDIF
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
.
          MATCH     SP3,PTCNDCLM
          IF        @EQUAL
            PACK    PTCNDCLM,ZERO,SP2
          ENDIF
.
          READ      CONTROLF,SIXTY4;*109,CCCOIA1,CCCOIA2,CCCOIA3:
                                    *139,CCCOIM1,CCCOIM2,CCCOIM3
.
          RETURN
.------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------
CLRPAR00  MOVE      ZERO,REPORTNO
          MOVE      SP70,TEMPLATE
          MOVE      SP70,CEXTRACT
          MOVE      SP70,CEXLEVEL
          MOVE      SP70,CEXTRKEY
          MOVE      ZERO,NORECORD
          MOVE      SP70,UPDTTYPE
          MOVE      ZERO,NEXTPAGE
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          MOVE      ZERO,STARTNUM
          MOVE      ZERO,NORECORD
          MOVE      SP70,STARTKEY
          MOVE      SP70,WEBUSEID
          MOVE      SP70,CURRTYPE
          MOVE      SP70,TYPEDESC
          MOVE      ZERO,VALIDATE
.
          MOVE      SP70,CASEC001
          MOVE      SP70,CASEC002
          MOVE      SP70,CASEC003
          MOVE      SP70,CASEC004
          MOVE      SP70,CASEC005
.
          MOVE      SP70,CAEXT001
          MOVE      SP70,CAEXT002
          MOVE      SP70,CAEXT003
          MOVE      SP70,CAEXT004
          MOVE      SP70,CAEXT005
          MOVE      SP70,CAEXT006
          MOVE      SP70,CAEXT007
          MOVE      SP70,CAEXT008
          MOVE      SP70,CAEXT009
          MOVE      SP70,CAEXT010
          MOVE      SP70,CAEXT011
          MOVE      SP70,CAEXT012
          MOVE      SP70,CAEXT013
          MOVE      SP70,CAEXT014
          MOVE      SP70,CAEXT015
          MOVE      SP70,CAEXT016
          MOVE      SP70,CAEXT017
          MOVE      SP70,CAEXT018
          MOVE      SP70,CAEXT019
          MOVE      SP70,CAEXT020
          MOVE      SP70,CAEXT021
          MOVE      SP70,CAEXT022
          MOVE      SP70,CAEXT023
.
          MOVE      SP70,CATYP001
          MOVE      SP70,CATYP002
          MOVE      SP70,CATYP003
          MOVE      ZERO,CATYP004
          MOVE      ZERO,CATYP005
          MOVE      ZERO,CATYP006
          MOVE      ZERO,CATYP007
          MOVE      SP70,CATYP008
.
          MOVE      SP70,CACOD001
          MOVE      SP70,CACOD002
          MOVE      SP70,CACOD003
          MOVE      SP70,CACOD004
.
          MOVE      SP70,CAAGE001
          MOVE      SP70,CAAGE002
          MOVE      SP70,CAAGE003
          MOVE      SP70,CAAGE004
.
          MOVE      SP70,CAPRD001
          MOVE      SP70,CAPRD002
          MOVE      SP70,CAPRD003
          MOVE      SP70,CAPRD004
          MOVE      SP70,CAPRD005
          MOVE      SP70,CAPRD006
.
          MOVE      SP70,CAAAD001
          MOVE      SP70,CAAAD002
          MOVE      SP70,CAAAD003
          MOVE      SP70,CAAAD004
          MOVE      SP70,CAAAD005
          MOVE      SP70,CAAAD006
.
          MOVE      SP70,CAINC001
          MOVE      SP70,CAINC002
          MOVE      ZERO,CAINC003
.
CLRPAR99  RETURN
.------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cextract=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CEXTRACT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cexlevel=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CEXLEVEL
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cextrkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CEXTRKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTKEY
            PACK      STARTKEY,STARTKEY,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "norecord=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NORECORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "webuseid=",QRYNAME
          IF        @EQUAL
            PACK      WEBUSEID,QRYDATA,SP70        * v9.02.01
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "casec",QRYNAME
          IF        @EQUAL
            GOTO      STSEC000
          ENDIF
.
          MATCH     "caext",QRYNAME
          IF        @EQUAL
            GOTO      STEXT000
          ENDIF
.
          MATCH     "catyp",QRYNAME
          IF        @EQUAL
            GOTO      STTYP000
          ENDIF
.
          MATCH     "cacod",QRYNAME
          IF        @EQUAL
            GOTO      STCOD000
          ENDIF
.
          MATCH     "cacod",QRYNAME
          IF        @EQUAL
            GOTO      STCOD000
          ENDIF
.
          MATCH     "caage",QRYNAME
          IF        @EQUAL
            GOTO      STAGE000
          ENDIF
.
          MATCH     "validate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALIDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "caprd",QRYNAME
          IF        @EQUAL
            GOTO      STPRD000
          ENDIF
.
          MATCH     "caaad",QRYNAME
          IF        @EQUAL
            GOTO      STAAD000
          ENDIF
.
          MATCH     "cainc",QRYNAME
          IF        @EQUAL
            GOTO      STINC000
          ENDIF
.
SETPAR99  RETURN
+
.-------------------------------------------------------------------------------
. Set Parameters for Casemix Type                 
.-------------------------------------------------------------------------------
STTYP000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STTYP001,STTYP002,STTYP003,STTYP004,STTYP005:
                       STTYP006,STTYP007,STTYP008
.
          GOTO      STTYP999
.
STTYP001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,CATYP001
          PACK      CATYP001,CATYP001,SP70
          GOTO      STTYP999
.
STTYP002  MOVE      QRYDATA,CATYP002
          PACK      CATYP002,CATYP002,SP70
          GOTO      STTYP999
.
STTYP003  MOVE      QRYDATA,CATYP003
          GOTO      STTYP999            
.
STTYP004  MOVE      QRYDATA,CATYP004
          GOTO      STTYP999            
.
STTYP005  MOVE      QRYDATA,CATYP005
          GOTO      STTYP999            
.
STTYP006  MOVE      QRYDATA,CATYP006
          GOTO      STTYP999            
.
STTYP007  MOVE      QRYDATA,CATYP007
          GOTO      STTYP999            
.
STTYP008  MOVE      QRYDATA,CATYP008
          GOTO      STTYP999            
.
STTYP999  RETURN
+
.-------------------------------------------------------------------------------
. Set Parameters for Casemix Code 
.-------------------------------------------------------------------------------
STCOD000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STCOD001,STCOD002,STCOD003,STCOD004
.
          GOTO      STCOD999
.
STCOD001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,CACOD001
          PACK      CACOD001,CACOD001,SP70
          GOTO      STCOD999
.
STCOD002  SQUEEZE   QRYDATA
          MOVE      QRYDATA,CACOD002
          PACK      CACOD002,CACOD002,SP70
          GOTO      STCOD999
.
STCOD003  MOVE      QRYDATA,CACOD003
          GOTO      STCOD999            
.
STCOD004  MOVE      QRYDATA,CACOD004
          GOTO      STCOD999            
.
STCOD999  RETURN
+
.-------------------------------------------------------------------------------
. Set Parameters for Age Range Code 
.-------------------------------------------------------------------------------
STAGE000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STAGE001,STAGE002,STAGE003,STAGE004
.
          GOTO      STAGE999
.
STAGE001  MOVE      QRYDATA,CAAGE001
          GOTO      STAGE999
.
STAGE002  SQUEEZE   QRYDATA
          MOVE      QRYDATA,CAAGE002
          PACK      CAAGE002,CAAGE002,SP70
          GOTO      STAGE999
.
STAGE003  MOVE      QRYDATA,CAAGE003
          PACK      CAAGE003,CAAGE003,SP70
          GOTO      STAGE999            
.
STAGE004  MOVE      QRYDATA,CAAGE004
          GOTO      STAGE999            
.
STAGE999  RETURN
+
.-------------------------------------------------------------------------------
. Set Parameters for Time Period    
.-------------------------------------------------------------------------------
STPRD000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STPRD001,STPRD002,STPRD003,STPRD004,STPRD005:
                       STPRD006
.
          GOTO      STPRD999
.
STPRD001  MOVE      QRYDATA,CAPRD001
          GOTO      STPRD999
.
STPRD002  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00            * Set CMON from MTHNAM3
          PACK      CAPRD002,CCENT,CYEAR,CMON,CDAY
          GOTO      STPRD999
.
STPRD003  MOVE      QRYDATA,CAPRD003
          PACK      CAPRD003,CAPRD003,SP70
          GOTO      STPRD999            
.
STPRD004  MOVE      QRYDATA,CAPRD004
          PACK      CAPRD004,CAPRD004,SP70
          GOTO      STPRD999            
.
STPRD005  MOVE      QRYDATA,CAPRD005
          PACK      CAPRD005,CAPRD005,SP70
          GOTO      STPRD999            
.
STPRD006  MOVE      QRYDATA,CAPRD006
          PACK      CAPRD006,CAPRD006,SP70
          GOTO      STPRD999            
.
STPRD999  RETURN
+
.-------------------------------------------------------------------------------
. Set Parameters for Area Analysis    
.-------------------------------------------------------------------------------
STAAD000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STAAD001,STAAD002,STAAD003,STAAD004,STAAD005:
                       STAAD006
.
          GOTO      STAAD999
.
STAAD001  MOVE      QRYDATA,CAAAD001
          GOTO      STAAD999
.
STAAD002  MOVE      QRYDATA,CAAAD002
          PACK      CAAAD002,CAAAD002,SP70
          GOTO      STAAD999
.
STAAD003  MOVE      QRYDATA,CAAAD003
          PACK      CAAAD003,CAAAD003,SP70
          GOTO      STAAD999            
.
STAAD004  MOVE      QRYDATA,CAAAD004
          PACK      CAAAD004,CAAAD004,SP70
          GOTO      STAAD999            
.
STAAD005  MOVE      QRYDATA,CAAAD005
          PACK      CAAAD005,CAAAD005,SP70
          GOTO      STAAD999            
.
STAAD006  MOVE      QRYDATA,CAAAD006
          PACK      CAAAD006,CAAAD006,SP70
          GOTO      STAAD999            
.
STAAD999  RETURN
+
.-------------------------------------------------------------------------------
. Set Parameters for Income Component Mapping
.-------------------------------------------------------------------------------
STINC000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STINC001,STINC002,STINC003
.
          GOTO      STINC999
.
STINC001  MOVE      QRYDATA,CAINC001
          GOTO      STINC999
.
STINC002  MOVE      QRYDATA,CAINC002
          PACK      CAINC002,CAINC002,SP70
          GOTO      STINC999
.
STINC003  MOVE      QRYDATA,CAINC003
          GOTO      STINC999
.
STINC999  RETURN
.------------------------------------------------------------
. Display Casemix Details
.------------------------------------------------------------
CASEXT00  MATCH     SP70,CEXTRACT
          IF        @EQUAL
            MOVE      ONE,EXTRFLAG
            MOVE      "Casemix Extract Enquiries",WEBTITLE
          ELSE
            CALL      CCSCOPCL
            MOVE      ZERO,EXTRFLAG
            PACK      KEY14,WBSEUID,CEXTRACT,SP70
            CALL      RDCCWS2  
            BRANCH    OVRCD,CASEXT90
            MATCH     SP70,CCWSTEM
            IF        !@EQUAL
              MOVE      CCWSTEM,TEMPLATE
            ENDIF
            PACK      KEY4,CEXTRACT,SP70
            CALL      RDCCEA1  
            BRANCH    OVRCD,CASEXT95
            MOVE      CCEADES,WEBTITLE
            CALL      CCSCOPEN
            BRANCH    OVRCD,CASEXT96
          ENDIF
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,CASEXT99
.
          CALL      WEBBOD00   * Process Web Body
.
          CALL      WEBEND00   * Process End of HTML File
.
          GOTO      CASEXT99
.
CASEXT90  MOVE      "Invalid Security",WEBTITLE
          CALL      WEBERR00   * Output Error
          GOTO      CASEXT99
.
CASEXT95  MOVE      "Invalid Casemix Extract",WEBTITLE
          CALL      WEBERR00   * Output Error
          GOTO      CASEXT99
.
CASEXT96  MOVE      "Can't Open Casemix Extract",WEBTITLE
          CALL      WEBERR00   * Output Error
.
CASEXT99  RETURN

.-------------------------------------------------------------------------------
. Option 2 - Set Parameters for Casemix Extract Web Security
.-------------------------------------------------------------------------------
STSEC000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STSEC001,STSEC002,STSEC003,STSEC004,STSEC005
.
          GOTO      STSEC999
.
STSEC001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,CASEC001
          PACK      CASEC001,CASEC001,SP70
          GOTO      STSEC999
.
STSEC002  SQUEEZE   QRYDATA
          MOVE      QRYDATA,CASEC002
          PACK      CASEC002,CASEC002,SP70
          GOTO      STSEC999
.
STSEC003  MOVE      QRYDATA,CASEC003
          GOTO      STSEC999            
.
STSEC004  MOVE      QRYDATA,CASEC004
          GOTO      STSEC999            
.
STSEC005  MOVE      QRYDATA,CASEC005
          GOTO      STSEC999            
.
STSEC999  RETURN
.-------------------------------------------------------------------------------
. Option 3 - Set Parameters for Casemix Extract Code Search 
.-------------------------------------------------------------------------------
STEXT000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STEXT001,STEXT002,STEXT003,STEXT004,STEXT005,STEXT006:
                       STEXT007,STEXT008,STEXT009,STEXT010,STEXT011,STEXT012:
                       STEXT013,STEXT014,STEXT015,STEXT016,STEXT017,STEXT018:
                       STEXT019,STEXT020,STEXT021,STEXT022,STEXT023
.
          GOTO      STEXT999
.
STEXT001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,CAEXT001
          PACK      CAEXT001,CAEXT001,SP70
          GOTO      STEXT999
.
STEXT002  MOVE      QRYDATA,CAEXT002
          GOTO      STEXT999            
.
STEXT003  MOVE      QRYDATA,CAEXT003
          GOTO      STEXT999            
.
STEXT004  MATCH     SP70,QRYDATA
          IF        !@EQUAL
            MATCH     "Start",QRYDATA
            IF        @EQUAL
              MOVE      SP70,QRYDATA
            ENDIF
          ENDIF
          MOVE      QRYDATA,KEY11   * Change Date as format is (DD MON CCYY)
          PACK      KEY11,KEY11,SP70
          MATCH     SP70,KEY11
          IF        !@EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      CAEXT004,CCENT,CYEAR,CMON,CDAY
            REP       " 0",CAEXT004
          ENDIF
          GOTO      STEXT999
.
STEXT005  MATCH     SP70,QRYDATA
          IF        !@EQUAL
            MATCH     "Finish",QRYDATA
            IF        @EQUAL
              MOVE      SP70,QRYDATA
            ENDIF
          ENDIF
          MOVE      QRYDATA,KEY11   * Change Date as format is (DD MON CCYY)
          PACK      KEY11,KEY11,SP70
          MATCH     SP70,KEY11
          IF        !@EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      CAEXT005,CCENT,CYEAR,CMON,CDAY
            REP       " 0",CAEXT005
          ENDIF
          GOTO      STEXT999
.
STEXT006  MATCH     SP70,QRYDATA
          IF        !@EQUAL
            MATCH     "Start",QRYDATA
            IF        @EQUAL
              MOVE      SP70,QRYDATA
            ENDIF
          ENDIF
          MOVE      QRYDATA,KEY11   * Change Date as format is (DD MON CCYY)
          PACK      KEY11,KEY11,SP70
          MATCH     SP70,KEY11
          IF        !@EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      CAEXT006,CCENT,CYEAR,CMON,CDAY
            REP       " 0",CAEXT006
          ENDIF
          GOTO      STEXT999
.
STEXT007  MATCH     SP70,QRYDATA
          IF        !@EQUAL
            MATCH     "Finish",QRYDATA
            IF        @EQUAL
              MOVE      SP70,QRYDATA
            ENDIF
          ENDIF
          MOVE      QRYDATA,KEY11   * Change Date as format is (DD MON CCYY)
          PACK      KEY11,KEY11,SP70
          MATCH     SP70,KEY11
          IF        !@EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      CAEXT007,CCENT,CYEAR,CMON,CDAY
            REP       " 0",CAEXT007
          ENDIF
          GOTO      STEXT999
.
STEXT008  MOVE      QRYDATA,CAEXT008
          GOTO      STEXT999            
.
STEXT009  MOVE      QRYDATA,CAEXT009
          GOTO      STEXT999            
.
STEXT010  MOVE      QRYDATA,CAEXT010
          GOTO      STEXT999            
.
STEXT011  MOVE      QRYDATA,CAEXT011
          GOTO      STEXT999            
.
STEXT012  MOVE      QRYDATA,CAEXT012
          GOTO      STEXT999            
.
STEXT013  MOVE      QRYDATA,CAEXT013
          GOTO      STEXT999            
.
STEXT014  MOVE      QRYDATA,CAEXT014
          GOTO      STEXT999            
.
STEXT015  MOVE      QRYDATA,CAEXT015
          GOTO      STEXT999            
.
STEXT016  MOVE      QRYDATA,CAEXT016
          GOTO      STEXT999            
.
STEXT017  MOVE      QRYDATA,CAEXT017
          GOTO      STEXT999            
.
STEXT018  MOVE      QRYDATA,CAEXT018
          GOTO      STEXT999            
.
STEXT019  MOVE      QRYDATA,CAEXT019
          GOTO      STEXT999            
.
STEXT020  MOVE      QRYDATA,CAEXT020
          GOTO      STEXT999            
.
STEXT021  MOVE      QRYDATA,CAEXT021
          GOTO      STEXT999            
.
STEXT022  MOVE      QRYDATA,CAEXT022
          GOTO      STEXT999            
.
STEXT023  MOVE      QRYDATA,CAEXT023
          GOTO      STEXT999            
.
STEXT999  RETURN
.------------------------------------------------------------
. Casemix Extract Web Security Maintanence: Display,Add,Update,Delete
.------------------------------------------------------------
CIAWSE00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      CIAWSE40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      CIAWSE10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      CIAWSE20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      CIAWSE30 IF EQUAL
.
          GOTO      CIAWSE93
.
.         ************ ADD FORMACTION ***********
.
CIAWSE10  CALL      CHKWSE00  * Checks mandatory fields & checks for blank
          BRANCH    EXIT,CIAWSE99
.
          PACK      KEY14,CASEC001,CASEC002,SP70
          CALL      RDCCWS1
          COMPARE   ZERO,OVRCD
          GOTO      CIAWSE92 IF EQUAL
.
          CALL      WSESAV00      * Moves input variables to file variables
          PACK      KEY14,CASEC001,CASEC002,SP70
          CALL      WRCCWS1       * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      CIAWSE99
.
.         ************ UPDATE FORMACTION **********
.
CIAWSE20  PACK      KEY14,CASEC001,CASEC002,SP70
          CALL      RDCCWS1
          BRANCH    OVRCD,CIAWSE91
.
          CALL      CHKWSE00      * Checks mandatory fields
          BRANCH    EXIT,CIAWSE99
.
          CALL      WSESAV00      * Moves input variables to file variables
          PACK      KEY14,CASEC001,CASEC002,SP70
          CALL      UPCCWS1       * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      CIAWSE99
.
.         ************ DELETE FORMACTION **********
.
CIAWSE30  PACK      KEY14,CASEC001,CASEC002,SP70
          CALL      RDCCWS1
          BRANCH    OVRCD,CIAWSE91
          CALL      DECCWS1       * Deletes the data
.
          MOVE      ZERO,EXIT
          GOTO      CIAWSE99
.
.         ************ DISPLAY FORMACTION **********
.
CIAWSE40  PACK      KEY14,CASEC001,CASEC002,SP70
          CALL      RDCCWS1
          IF        OVRCD=1
            CALL      CLRWSE00                * Clear all the file variables
            MOVE      SP70,CASEC001           * v9.02.01
            MOVE      SP70,CASEC002           * v9.02.01
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Casemix Extract Web Security Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,CIAWSE99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      CIAWSE99
.
CIAWSE91  MOVE      "Extract ID does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CIAWSE99
.
CIAWSE92  MOVE      "Extract ID exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CIAWSE99
.
CIAWSE93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CIAWSE99
.
CIAWSE99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRWSE00  MOVE      SP70,CCWSEID      * Extract ID 
          MOVE      SP70,CCWSWPC      * Web User ID                 
          MOVE      SP70,CCWSSLV      * Start Level                 
          MOVE      SP70,CCWSSCD      * Start Code                  
          MOVE      SP70,CCWSTEM      * Template                    
.
CLRWSE99  RETURN
.------------------------------------------------------------
. Moves cgi variables into file variables
.------------------------------------------------------------
WSESAV00  MOVE      CASEC001,CCWSEID 
          MOVE      CASEC002,CCWSWPC
          MOVE      CASEC003,CCWSSLV
          MOVE      CASEC004,CCWSSCD
          MOVE      CASEC005,CCWSTEM
.
WSESAV99  RETURN
.------------------------------------------------------------------
. * Checks mandatory fields
.------------------------------------------------------------------
CHKWSE00  RESET     CASEC001
          MATCH     SP70,CASEC001
          GOTO      CHKWSE90 IF EQUAL
.
          RESET     CASEC002
          MATCH     SP70,CASEC002
          GOTO      CHKWSE91 IF EQUAL
.
          GOTO      CHKWSE98
.
CHKWSE90  MOVE      "Extract ID cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKWSE99
.
CHKWSE91  MOVE      "Web User Cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKWSE99
.
CHKWSE98  MOVE      ZERO,EXIT
CHKWSE99  RETURN
.------------------------------------------------------------
. Casemix Extract Code Search Maintanence: Display,Add,Update,Delete
.------------------------------------------------------------
CIAEXT00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      CIAEXT40 IF EQUAL
.
. All extract id maintenence is now in CIAWEB02
.
          GOTO      CIAEXT93
.
.         ************ DISPLAY FORMACTION **********
.
CIAEXT40  PACK      KEY4,CAEXT001,SP70
          CALL      RDCCEA1
          IF        OVRCD=1
            CALL      CLREXT00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Casemix Extract Code Search/Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,CIAEXT99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      CIAEXT99
.
CIAEXT91  MOVE      "Extract ID does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CIAEXT99
.
CIAEXT92  MOVE      "Extract ID exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CIAEXT99
.
CIAEXT93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CIAEXT99
.
CIAEXT99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLREXT00  MOVE      SP70,CCEAEID      * Extract ID 
          MOVE      SP70,CCEADES      * Description                 
          MOVE      SP70,CCEAHCD      * Hospital                    
          MOVE      SP70,CCEAFDD      * From Discharge Date         
          MOVE      SP70,CCEATDD      * To Discharge Date           
          MOVE      SP70,CCEAFAD
          MOVE      SP70,CCEATAD
          MOVE      SP70,CCEAINC
          MOVE      SP70,CCEAVIS
          MOVE      SP70,CCEADAY
          MOVE      SP70,CCEAFCM
          MOVE      SP70,CCEAFYR
          MOVE      SP70,CCEATCM
          MOVE      SP70,CCEATYR
          MOVE      SP70,CCEARUA
          MOVE      SP70,CCEALV1
          MOVE      SP70,CCEALV2
          MOVE      SP70,CCEALV3
          MOVE      SP70,CCEAUST
          MOVE      SP70,CCEAIMOD
          MOVE      SP70,CCEACMOD
          MOVE      SP70,CCEAITHE
          MOVE      SP70,CCEACTHE
.
CLREXT99  RETURN
.------------------------------------------------------------
. Moves cgi variables into file variables
.------------------------------------------------------------
EXTSAV00  MOVE      CAEXT001,CCEAEID      * Extract ID 
          MOVE      CAEXT002,CCEADES      * Description                 
          MOVE      CAEXT003,CCEAHCD      * Hospital                    
          MOVE      CAEXT004,CCEAFDD      * From Discharge Date         
          MOVE      CAEXT005,CCEATDD      * To Discharge Date           
          MOVE      CAEXT006,CCEAFAD
          MOVE      CAEXT007,CCEATAD
.
          MATCH     "2",CAEXT008     * 0 = No 
          IF        @EQUAL
            MOVE      ONE,CCEAINC
          ELSE
            MOVE      ZERO,CCEAINC
          ENDIF
.
          MOVE      CAEXT009,CCEAVIS
          MOVE      CAEXT010,CCEADAY
          MOVE      CAEXT011,CCEAFCM
          MOVE      CAEXT012,CCEAFYR
          MOVE      CAEXT013,CCEATCM
          MOVE      CAEXT014,CCEATYR
.
          MATCH     "2",CAEXT015     * 0 = No     
          IF        @EQUAL
            MOVE      ONE,CCEARUA 
          ELSE
            MOVE      ZERO,CCEARUA 
          ENDIF
.
          MOVE      CAEXT016,CCEALV1
          MOVE      CAEXT017,CCEALV2
          MOVE      CAEXT018,CCEALV3
.
          MATCH     "2",CAEXT019     * 0 = No 
          IF        @EQUAL
            MOVE      ONE,CCEAUST
          ELSE
            MOVE      ZERO,CCEAUST
          ENDIF
.
          MATCH     "2",CAEXT020     * 1=Active   
          IF        @EQUAL
            MOVE      ONE,CCEAIMOD
          ELSE
            MOVE      ZERO,CCEAIMOD
          ENDIF
.
          MATCH     "2",CAEXT021     * 1=Active   
          IF        @EQUAL
            MOVE      ONE,CCEACMOD
          ELSE
            MOVE      ZERO,CCEACMOD
          ENDIF
.
          MATCH     "2",CAEXT022     * 1=Active   
          IF        @EQUAL
            MOVE      ONE,CCEAITHE
          ELSE
            MOVE      ZERO,CCEAITHE
          ENDIF
.
          MATCH     "2",CAEXT023     * 1=Active   
          IF        @EQUAL
            MOVE      ONE,CCEACTHE
          ELSE
            MOVE      ZERO,CCEACTHE
          ENDIF
.
EXTSAV99  RETURN
.------------------------------------------------------------------
. * Checks mandatory fields
.------------------------------------------------------------------
CHKEXT00  RESET     CAEXT001
          MATCH     SP70,CAEXT001
          GOTO      CHKEXT90 IF EQUAL
.
          GOTO      CHKEXT98
.
CHKEXT90  MOVE      "Extract ID cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKEXT99
.
CHKEXT98  MOVE      ZERO,EXIT
CHKEXT99  RETURN
+
.------------------------------------------------------------
. Casemix Types Maintanence: Display,Add,Update,Delete
.------------------------------------------------------------
CASTYP00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      CASTYP40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      CASTYP10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      CASTYP20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete All Related Codes formaction
          GOTO      CASTYP30 IF EQUAL
.
          GOTO      CASTYP93
.
.         ************ ADD FORMACTION ***********
.
CASTYP10  PACK      KEY3,CATYP001,SP70
          CALL      RDCCST1
          COMPARE   ZERO,OVRCD
          GOTO      CASTYP92 IF EQUAL
.
          CALL      TYPSAV00      * Moves input variables to file variables
          PACK      KEY3,CATYP001,SP70
          CALL      WRCCST1       * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      CASTYP99
.
.         ************ UPDATE FORMACTION **********
.
CASTYP20  PACK      KEY3,CATYP001,SP70
          CALL      RDCCST1
          BRANCH    OVRCD,CASTYP91
.
          CALL      TYPSAV00      * Moves input variables to file variables
          PACK      KEY3,CATYP001,SP70
          CALL      UPCCST1       * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      CASTYP99
.
.         ************ DELETE FORMACTION **********
.
CASTYP30  PACK      KEY3,CATYP001,SP70
          CALL      RDCCST1
          BRANCH    OVRCD,CASTYP91
.
CASTYP31  PACK      KEY13,CATYP001,SP70
          CALL      RSCCXH1
          CALL      RKCCXH1
          BRANCH    OVRCD,CASTYP39
          MATCH     CCXHSTY,CATYP001
          GOTO      CASTYP39 IF NOT EQUAL
          PACK      KEY13,CCXHSTY,CCXHKEY
          CALL      DECCXH1       * Deletes the data
          GOTO      CASTYP31
.
CASTYP39  MOVE      ZERO,EXIT
          GOTO      CASTYP99
.
.         ************ DISPLAY FORMACTION **********
.
CASTYP40  PACK      KEY3,CATYP001,SP70
          CALL      RDCCST1
          IF        OVRCD=1
            BRANCH    VALIDATE,CASTYP91
            CALL      CLRTYP00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Casemix Type Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,CASTYP99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      CASTYP99
.
CASTYP91  MOVE      "Casemix Type does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ZERO,EXIT         * need to refresh scren
          GOTO      CASTYP99
.
CASTYP92  MOVE      "Casemix Type already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CASTYP99
.
CASTYP93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CASTYP99
.
CASTYP94  MOVE      "File Not Found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CASTYP99
.
CASTYP99  RETURN
+
.------------------------------------------------------------
. Save Casemix type fields           
.------------------------------------------------------------
TYPSAV00  MOVE      CATYP001,CCSTSTY
          MOVE      CATYP002,CCSTDES
          MOVE      CATYP003,CCSTLEN
          MOVE      CATYP004,CCSTJR 
          MOVE      CATYP005,CCSTZF 
          MOVE      CATYP005,CCSTDE 
          MOVE      SP70,CCSTSPA 
.
TYPSAV99  RETURN
+
.------------------------------------------------------------
. Clear Casemix type fields           
.------------------------------------------------------------
CLRTYP00  MOVE      SP70,CCSTSTY
          MOVE      SP70,CCSTDES
          MOVE      SP70,CCSTLEN
          MOVE      SP70,CCSTJR 
          MOVE      SP70,CCSTZF 
          MOVE      SP70,CCSTDE
          MOVE      SP70,CCSTSPA 
.
CLRTYP99  RETURN
.
.------------------------------------------------------------
. Casemix Type Code Maintanence: Display,Add,Update,Delete
.------------------------------------------------------------
CASCOD00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      CASCOD40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      CASCOD10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      CASCOD20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      CASCOD30 IF EQUAL
.
          GOTO      CASCOD93
.
.         ************ ADD FORMACTION ***********
.
CASCOD10  PACK      KEY13,CACOD001,CACOD002,SP70
          CALL      RDCCXH1
          COMPARE   ZERO,OVRCD
          GOTO      CASCOD92 IF EQUAL
.
          CALL      CODSAV00      * Moves input variables to file variables
          PACK      KEY13,CACOD001,CACOD002,SP70
          CALL      WRCCXH1       * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      CASCOD99
.
.         ************ UPDATE FORMACTION **********
.
CASCOD20  PACK      KEY13,CACOD001,CACOD002,SP70
          CALL      RDCCXH1
          BRANCH    OVRCD,CASCOD91
.
          CALL      CODSAV00      * Moves input variables to file variables
          PACK      KEY13,CACOD001,CACOD002,SP70
          CALL      UPCCXH1       * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      CASCOD99
.
.         ************ DELETE FORMACTION **********
.
CASCOD30  PACK      KEY13,CACOD001,CACOD002,SP70
          CALL      RDCCXH1
          BRANCH    OVRCD,CASCOD91
.
          PACK      KEY13,CACOD001,CACOD002,SP70
          CALL      DECCXH1       * Deletes the data
.
          MOVE      ZERO,EXIT
          GOTO      CASCOD99
.
.         ************ DISPLAY FORMACTION **********
.
CASCOD40  PACK      KEY3,CACOD001,SP70
          CALL      RDCCST1
          BRANCH    OVRCD,CASCOD94
          MOVE      CCSTSTY,CURRTYPE    * Current Type for Next & Prev pages
          MOVE      CCSTDES,TYPEDESC    * Current Description
.
          PACK      KEY13,CACOD001,CACOD002,SP70
          CALL      RDCCXH1
          IF        OVRCD=1
            BRANCH    VALIDATE,CASCOD91
            CALL      CLRCOD00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Casemix Code Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,CASCOD99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      CASCOD99
.
CASCOD91  MOVE      "Casemix Code does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ZERO,EXIT       * need to refresh screen
          GOTO      CASCOD99
.
CASCOD92  MOVE      "Casemix Code already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CASCOD99
.
CASCOD93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CASCOD99
.
CASCOD94  MOVE      "Invalid Type.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CASCOD99
.
CASCOD99  RETURN
+
.------------------------------------------------------------
. Save Casemix type fields           
.------------------------------------------------------------
CODSAV00  MOVE      CACOD001,CCXHSTY
          MOVE      CACOD002,CCXHKEY
          MOVE      CACOD003,CCXHDES
          MOVE      CACOD004,CCXHSUM
          MOVE      SP70,CCXHSPA 
.
CODSAV99  RETURN
+
.------------------------------------------------------------
. Clear Casemix type fields           
.------------------------------------------------------------
CLRCOD00  MOVE      SP70,CCXHSTY
          MOVE      SP70,CCXHKEY
          MOVE      SP70,CCXHDES
          MOVE      SP70,CCXHSUM
          MOVE      SP70,CCXHSPA 
.
CLRCOD99  RETURN
+
.------------------------------------------------------------
. Age Range Maintanence: Display,Add,Update,Delete
.------------------------------------------------------------
AGERNG00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      AGERNG40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      AGERNG10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      AGERNG20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      AGERNG30 IF EQUAL
.
          GOTO      AGERNG93
.
.         ************ ADD FORMACTION ***********
.
AGERNG10  PACK      KEY4,CAAGE001,CAAGE002,SP70
          CALL      RDCCAG1
          COMPARE   ZERO,OVRCD
          GOTO      AGERNG92 IF EQUAL
.
          CALL      AGESAV00      * Moves input variables to file variables
          PACK      KEY4,CAAGE001,CAAGE002,SP70
          CALL      WRCCAG1       * Writes away the data
.
.         Write Age range to Casemix codes
.
          MOVE      CCAGDEF,F3
          ADD       "35",F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
          PACK      KEY13,KEY3,CCAGGRP,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          MOVE      CCAGDES,CCXHDES
          CALL      RACCXH1
          IF        OVRCD=0
            CALL      UPCCXH1
          ELSE
            CALL      WRCCXH1
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      AGERNG99
.
.         ************ UPDATE FORMACTION **********
.
AGERNG20  PACK      KEY4,CAAGE001,CAAGE002,SP70
          CALL      RDCCAG1
          BRANCH    OVRCD,AGERNG91
.
          CALL      AGESAV00      * Moves input variables to file variables
          PACK      KEY4,CAAGE001,CAAGE002,SP70
          CALL      UPCCAG1       * Writes away the data
.
.         Write Age range to Casemix codes
.
          MOVE      CCAGDEF,F3
          ADD       "35",F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
          PACK      KEY13,KEY3,CCAGGRP,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          MOVE      CCAGDES,CCXHDES
          CALL      RACCXH1
          IF        OVRCD=0
            CALL      UPCCXH1
          ELSE
            CALL      WRCCXH1
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      AGERNG99
.
.         ************ DELETE FORMACTION **********
.
AGERNG30  PACK      KEY4,CAAGE001,CAAGE002,SP70
          CALL      RDCCAG1
          BRANCH    OVRCD,AGERNG91
.
          PACK      KEY4,CAAGE001,CAAGE002,SP70
          CALL      DECCAG1       * Deletes the data
.
.         Delete Age range from Casemix codes
.
          MOVE      CCAGDEF,F3
          ADD       "35",F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
          PACK      KEY13,KEY3,CCAGGRP,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          MOVE      CCAGDES,CCXHDES
          CALL      RACCXH1
          IF        OVRCD=0
            CALL      DECCXH1
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      AGERNG99
.
.         ************ DISPLAY FORMACTION **********
.
AGERNG40  MATCH     CAAGE001,SP1
          IF        !@EQUAL
            MOVE      CAAGE001,F3
            ADD       "35",F3
            MOVE      F3,KEY3
            REP       " 0",KEY3
            CALL      RDCCST1
            BRANCH    OVRCD,AGERNG94
            MOVE      CCSTDES,TYPEDESC    * Current Description
          ENDIF
.
          PACK      KEY4,CAAGE001,CAAGE002,SP70
          CALL      RDCCAG1
          IF        OVRCD=1
            BRANCH    VALIDATE,AGERNG91
            CALL      CLRAGE00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Age Range Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,AGERNG99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      AGERNG99
.
AGERNG91  MOVE      "Age Range code does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ZERO,EXIT         * need to refresh scren
          GOTO      AGERNG99
.
AGERNG92  MOVE      "Age Range code already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      AGERNG99
.
AGERNG93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      AGERNG99
.
AGERNG94  CLEAR     WEBTITLE
          APPEND    "Invalid Type - ",WEBTITLE
          APPEND    KEY3,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      AGERNG99
.
AGERNG99  RETURN
+
.------------------------------------------------------------
. Save Age Range fields
.------------------------------------------------------------
AGESAV00  MOVE      CAAGE001,CCAGDEF
          MOVE      CAAGE002,CCAGGRP
          MOVE      CAAGE003,CCAGDES
          MOVE      CAAGE004,CCAGTAGE
          MOVE      SP70,CCAGSPA
.
AGESAV99  RETURN
+
.------------------------------------------------------------
. Clear Age Range fields
.------------------------------------------------------------
CLRAGE00  MOVE      SP70,CCAGDEF
          MOVE      SP70,CCAGGRP
          MOVE      SP70,CCAGDES
          MOVE      SP70,CCAGTAGE
          MOVE      SP70,CCAGSPA
.
CLRAGE99  RETURN
+
.------------------------------------------------------------
. Time Period Maintanence: Display,Add,Update,Delete
.------------------------------------------------------------
TMEPRD00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      TMEPRD40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      TMEPRD10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      TMEPRD20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      TMEPRD30 IF EQUAL
.
          GOTO      TMEPRD93
.
.         ************ ADD FORMACTION ***********
.
TMEPRD10  PACK      KEY9,CAPRD001,CAPRD002,SP70
          CALL      RDCCTM1
          COMPARE   ZERO,OVRCD
          GOTO      TMEPRD92 IF EQUAL
.
          CALL      TMESAV00      * Moves input variables to file variables
          PACK      KEY9,CAPRD001,CAPRD002,SP70
          CALL      WRCCTM1       * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      TMEPRD99
.
.         ************ UPDATE FORMACTION **********
.
TMEPRD20  PACK      KEY9,CAPRD001,CAPRD002,SP70
          CALL      RDCCTM1
          BRANCH    OVRCD,TMEPRD91
.
          CALL      TMESAV00      * Moves input variables to file variables
          PACK      KEY9,CAPRD001,CAPRD002,SP70
          CALL      UPCCTM1       * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      TMEPRD99
.
.         ************ DELETE FORMACTION **********
.
TMEPRD30  PACK      KEY9,CAPRD001,CAPRD002,SP70
          CALL      RDCCTM1
          BRANCH    OVRCD,TMEPRD91
.
          PACK      KEY9,CAPRD001,CAPRD002,SP70
          CALL      DECCTM1       * Deletes the data
.
          MOVE      ZERO,EXIT
          GOTO      TMEPRD99
.
.         ************ DISPLAY FORMACTION **********
.
TMEPRD40  PACK      KEY9,CAPRD001,CAPRD002,SP70
          CALL      RDCCTM1
          IF        OVRCD=1
            CALL      CLRTME00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Time Period Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,TMEPRD99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      TMEPRD99
.
TMEPRD91  MOVE      "Time Period does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT        
          GOTO      TMEPRD99
.
TMEPRD92  MOVE      "Time Period already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      TMEPRD99
.
TMEPRD93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      TMEPRD99
.
TMEPRD99  RETURN
+
.------------------------------------------------------------
. Save Time Period fields
.------------------------------------------------------------
TMESAV00  MOVE      CAPRD001,CCTMDEF
          MOVE      CAPRD002,CCTMDAT
          MOVE      CAPRD003,CCTMDES
          MOVE      CAPRD004,CCTMLV4 
          MOVE      CAPRD005,CCTMLV3 
          MOVE      CAPRD006,CCTMLV2 
          MOVE      SP70,CCTMSPA
.
TMESAV99  RETURN
+
.------------------------------------------------------------
. Clear Time Period fields
.------------------------------------------------------------
CLRTME00  MOVE      SP70,CCTMDEF
          MOVE      SP70,CCTMDAT
          MOVE      SP70,CCTMDES
          MOVE      SP70,CCTMLV4 
          MOVE      SP70,CCTMLV3 
          MOVE      SP70,CCTMLV2 
          MOVE      SP70,CCTMSPA
.
CLRTME99  RETURN
+
.------------------------------------------------------------
. Area Analysis Maintanence: Display,Add,Update,Delete
.------------------------------------------------------------
AREANL00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      AREANL40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      AREANL10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      AREANL20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      AREANL30 IF EQUAL
.
          GOTO      AREANL93
.
.         ************ ADD FORMACTION ***********
.
AREANL10  PACK      KEY11,CAAAD001,CAAAD002,SP70
          CALL      RDCCAD1
          COMPARE   ZERO,OVRCD
          GOTO      AREANL92 IF EQUAL
.
          CALL      ARESAV00      * Moves input variables to file variables
          PACK      KEY11,CAAAD001,CAAAD002,SP70
          CALL      WRCCAD1       * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      AREANL99
.
.         ************ UPDATE FORMACTION **********
.
AREANL20  PACK      KEY11,CAAAD001,CAAAD002,SP70
          CALL      RDCCAD1
          BRANCH    OVRCD,AREANL91
.
          CALL      ARESAV00      * Moves input variables to file variables
          PACK      KEY11,CAAAD001,CAAAD002,SP70
          CALL      UPCCAD1       * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      AREANL99
.
.         ************ DELETE FORMACTION **********
.
AREANL30  PACK      KEY11,CAAAD001,CAAAD002,SP70
          CALL      RDCCAD1
          BRANCH    OVRCD,AREANL91
.
          PACK      KEY11,CAAAD001,CAAAD002,SP70
          CALL      DECCAD1       * Deletes the data
.
          MOVE      ZERO,EXIT
          GOTO      AREANL99
.
.         ************ DISPLAY FORMACTION **********
.
AREANL40  PACK      KEY11,CAAAD001,CAAAD002,SP70
          CALL      RDCCAD1
          IF        OVRCD=1
            BRANCH    VALIDATE,AREANL91
            CALL      CLRARE00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Area Analysis Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,AREANL99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      AREANL99
.
AREANL91  MOVE      "Area Analysis Postcode does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ZERO,EXIT        * need to refresh screen
          GOTO      AREANL99
.
AREANL92  MOVE      "Area Analysis Postcode already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      AREANL99
.
AREANL93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      AREANL99
.
AREANL99  RETURN
+
.------------------------------------------------------------
. Save Area Analysis fields
.------------------------------------------------------------
ARESAV00  MOVE      CAAAD001,CCADDEF
          MOVE      CAAAD002,CCADPC
          MOVE      CAAAD003,CCADDES
          MOVE      CAAAD004,CCADLV4 
          MOVE      CAAAD005,CCADLV3 
          MOVE      CAAAD006,CCADLV2 
          MOVE      SP70,CCTMSPA
.
ARESAV99  RETURN
+
.------------------------------------------------------------
. Clear Area Analysis fields
.------------------------------------------------------------
CLRARE00  MOVE      SP70,CCADDEF
          MOVE      SP70,CCADPC
          MOVE      SP70,CCADDES
          MOVE      SP70,CCADLV4 
          MOVE      SP70,CCADLV3 
          MOVE      SP70,CCADLV2 
          MOVE      SP70,CCADSPA
.
CLRARE99  RETURN
+
.------------------------------------------------------------
. Income Component Mapping Maintanence: Display,Add,Update,Delete
.------------------------------------------------------------
INCMAP00  CALL      CHKCOD00                    * check map code is correct size
          RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      INCMAP40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      INCMAP10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      INCMAP20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      INCMAP30 IF EQUAL
.
          GOTO      INCMAP93
.
.         ************ ADD FORMACTION ***********
.
INCMAP10  PACK      KEY10,CAINC001,CAINC002,SP70
          CALL      RDCCIM1
          COMPARE   ZERO,OVRCD
          GOTO      INCMAP92 IF EQUAL
.
          CALL      INCSAV00      * Moves input variables to file variables
          PACK      KEY10,CAINC001,CAINC002,SP70
          CALL      WRCCIM1       * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      INCMAP99
.
.         ************ UPDATE FORMACTION **********
.
INCMAP20  PACK      KEY10,CAINC001,CAINC002,SP70
          CALL      RDCCIM1
          BRANCH    OVRCD,INCMAP91
.
          CALL      INCSAV00      * Moves input variables to file variables
          PACK      KEY10,CAINC001,CAINC002,SP70
          CALL      UPCCIM1       * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      INCMAP99
.
.         ************ DELETE FORMACTION **********
.
INCMAP30  PACK      KEY10,CAINC001,CAINC002,SP70
          CALL      RDCCIM1
          BRANCH    OVRCD,INCMAP91
.
          PACK      KEY10,CAINC001,CAINC002,SP70
          CALL      DECCIM1       * Deletes the data
.
          MOVE      ZERO,EXIT
          GOTO      INCMAP99
.
.         ************ DISPLAY FORMACTION **********
.
INCMAP40  PACK      KEY10,CAINC001,CAINC002,SP70
          CALL      RDCCIM1
          IF        OVRCD=1
            BRANCH    VALIDATE,INCMAP91
            CALL      CLRINC00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Income Component Mapping Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,INCMAP99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      INCMAP99
.
INCMAP91  MOVE      "Income Component Mapping does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ZERO,EXIT        * need to refresh screen
          GOTO      INCMAP99
.
INCMAP92  MOVE      "Income Componet Mapping already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      INCMAP99
.
INCMAP93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      INCMAP99
.
INCMAP99  RETURN
+
.------------------------------------------------------------
. Check Map Code is correct size for Map Type.
.------------------------------------------------------------
CHKCOD00  MATCH     SP1,CAINC001    
          GOTO      CHKCOD90 IF EQUAL
          MATCH     "2",CAINC001   
          GOTO      CHKCOD99 IF EQUAL
.
          UNPACK    CAINC002,KEY3,KEY10
          PACK      CAINC002,KEY3,SP10
          GOTO      CHKCOD99
.
CHKCOD90  MOVE      SP10,CAINC002
CHKCOD99  RETURN
.------------------------------------------------------------
. Save Income Component fields
.------------------------------------------------------------
INCSAV00  MOVE      CAINC001,CCIMTYP
          MOVE      CAINC002,CCIMCOD
          MOVE      CAINC003,CCIMITY
          MOVE      SP70,CCTMSPA
.
INCSAV99  RETURN
+
.------------------------------------------------------------
. Clear Income Component fields
.------------------------------------------------------------
CLRINC00  MOVE      SP70,CCIMTYP
          MOVE      SP70,CCIMCOD
          MOVE      ZERO,CCIMITY
          MOVE      SP70,CCADSPA
.
CLRINC99  RETURN
+
.------------------------------------------------------------
. Process Fields from Template Body
.------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20,PROFLD30,PROFLD40,PROFLD50:
                             PROFLD60,PROFLD70,PROFLD80,PROFLD90
          GOTO      PROFLD99
.
PROFLD10  CALL      CASF0000      * Casemix Fields
          GOTO      PROFLD99
.
PROFLD20  CALL      WSEC0000      * Casemix Extract Web Security 
          GOTO      PROFLD99
.
PROFLD30  CALL      WEXT0000      * Casemix Extract Code Search & Maintanence 
          GOTO      PROFLD99
.
PROFLD40  BRANCH    FLDSETNO,PROFLD41
          GOTO      PROFLD99
.
PROFLD41  CALL      CTYP0000      * Casemix Type Fields
          GOTO      PROFLD99
.
PROFLD50  BRANCH    FLDSETNO,PROFLD51
          GOTO      PROFLD99
.
PROFLD51  CALL      CCOD0000      * Casemix Type Fields
          GOTO      PROFLD99
.
PROFLD60  BRANCH    FLDSETNO,PROFLD61
          GOTO      PROFLD99
.
PROFLD61  CALL      ARNG0000      * Age Range Fields
          GOTO      PROFLD99
.
PROFLD70  BRANCH    FLDSETNO,PROFLD71
          GOTO      PROFLD99
.
PROFLD71  CALL      TPRD0000      * Time Period Fields
          GOTO      PROFLD99
.
PROFLD80  BRANCH    FLDSETNO,PROFLD81
          GOTO      PROFLD99
.
PROFLD81  CALL      AANL0000      * Area Analysis Fields
          GOTO      PROFLD99
.
PROFLD90  BRANCH    FLDSETNO,PROFLD91
          GOTO      PROFLD99
.
PROFLD91  CALL      IMAP0000      * Income Componet Mapping
          GOTO      PROFLD99
.
PROFLD99  RETURN
.------------------------------------------------------------
. Casemix Enquiries
.------------------------------------------------------------
CASF0000  BRANCH    FLDITMNO,CASF0100,CASF0200
          BRANCH    EXTRFLAG,CASF9999
          BRANCH    FLDITMNO,CASF0100,CASF0200,CASF0300,CASF0400,CASF0500:
                             CASF0600,CASF0700,CASF0800,CASF0900,CASF1000:
                             CASF1100,CASF1200,CASF1300
          GOTO      CASF9999
.
CASF0100  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          WRITE     HTMLFILE;LINKPRG,".pbl?reportno=",LINKREP:
                                 "&template=",LINKTEM;
          MATCH     SP70,CEXTRACT
          IF        !@EQUAL
            WRITE     HTMLFILE;"&cextract=",CEXTRACT;
          ENDIF
          MATCH     SP70,CEXLEVEL
          IF        !@EQUAL
            WRITE     HTMLFILE;"&cexlevel=",CEXLEVEL;
          ENDIF
          MATCH     SP70,CEXTRKEY
          IF        !@EQUAL
            WRITE     HTMLFILE;"&cextrkey=",CEXTRKEY;
          ENDIF
          GOTO      CASF9999   
.
CASF0200  PACK      KEY14,WBSEUID,SP70
          CALL      RSCCWS2
CASF0210  CALL      RKCCWS2
          BRANCH    OVRCD,CASF0290  
          MATCH     WBSEUID,CCWSWPC
          GOTO      CASF0290 IF NOT EQUAL
          MOVE      CCWSEID,KEY4
          CALL      RDCCEA1
          BRANCH    OVRCD,CASF0210  
          MATCH     CEXTRACT,CCWSEID
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",CCEAEID,"#" selected>":
                               CCEADES,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",CCEAEID,"#">":
                               CCEADES,"</option>"
          ENDIF
          GOTO      CASF0210  
.
CASF0290  PACK      KEY4,CEXTRACT,SP70
          CALL      RDCCEA1
          PACK      KEY14,WBSEUID,CEXTRACT,SP70
          CALL      RDCCWS2
          GOTO      CASF9999  
. 
CASF0300  WRITE     HTMLFILE;CCEAEID;
          GOTO      CASF9999
. 
CASF0400  WRITE     HTMLFILE;CCEADES;
          GOTO      CASF9999
. 
CASF0500  MATCH     SP70,CCEAFDD 
          IF        @EQUAL
            WRITE     HTMLFILE;"Start";
          ELSE
            UNPACK    CCEAFDD,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          GOTO      CASF9999
.
CASF0600  MATCH     "99999999",CCEATDD 
          IF        @EQUAL
            WRITE     HTMLFILE;"Finish";
          ELSE
            UNPACK    CCEATDD,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          GOTO      CASF9999
.
CASF0700  MATCH     SP70,CCEAFAD 
          IF        @EQUAL
            WRITE     HTMLFILE;"Start";
          ELSE
            UNPACK    CCEAFAD,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          GOTO      CASF9999
.
CASF0800  MATCH     "99999999",CCEATAD 
          IF        @EQUAL
            WRITE     HTMLFILE;"Finish";
          ELSE
            UNPACK    CCEATAD,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          GOTO      CASF9999
.
CASF0900  UNPACK    DIM127,D1,KEY1,DIM127
          MATCH     "0",KEY1
          IF        @EQUAL
            WRITE     HTMLFILE;CCEALV1;
          ELSE
            MOVE     CCEALV1,KEY3
            CALL     RDCCST1
            WRITE    HTMLFILE;CCSTDES;
          ENDIF
.
CASF1000  UNPACK    DIM127,D1,KEY1,DIM127
          MATCH     SP70,CCEALV2
          GOTO      CASF9999 IF EQUAL
          MATCH     "0",KEY1
          IF        @EQUAL
            WRITE     HTMLFILE;CCEALV2;
          ELSE
            MOVE     CCEALV2,KEY3
            CALL     RDCCST1
            WRITE    HTMLFILE;CCSTDES;
          ENDIF
.
CASF1100  UNPACK    DIM127,D1,KEY1,DIM127
          MATCH     SP70,CCEALV3
          GOTO      CASF9999 IF EQUAL
          MATCH     "0",KEY1
          IF        @EQUAL
            WRITE     HTMLFILE;CCEALV3;
          ELSE
            MOVE     CCEALV3,KEY3
            CALL     RDCCST1
            WRITE    HTMLFILE;CCSTDES;
          ENDIF
          GOTO      CASF9999
.
CASF1200  CALL      CCEXT000
          GOTO      CASF9999
. 
CASF1300  MOVE      CEXLEVEL,F1
          UNPACK    CEXTRKEY,CCEBLV1,CCEDLV2,CCEELV3
          BRANCH    F1,CASF1310,CASF1320,CASF1330
          WRITE     HTMLFILE;CCEADES;
          GOTO      CASF9999
.
CASF1310  MOVE      CCEALV1,KEY3
          CALL      RDCCST1
          STRIP     CCSTDES
          MOVELPTR  CCSTDES,LENGTH
          SFORMAT   VAR,LENGTH
          MOVE      CCSTDES,VAR
          WRITE     HTMLFILE;VAR," - ";
          SFORMAT   VAR,127
.
          PACK      KEY13,CCEALV1,CCEBLV1,SP70
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      KEY13,CCXHDES
            MATCH     "~~~~~~~~~~",CCEBLV1
            IF        @EQUAL
              MOVE      "Other",CCXHDES
            ENDIF
          ENDIF
.
          STRIP     CCXHDES
          MOVELPTR  CCXHDES,LENGTH
          SFORMAT   VAR,LENGTH
          MOVE      CCXHDES,VAR
          WRITE     HTMLFILE;VAR;
          SFORMAT   VAR,127
          GOTO      CASF9999
.
CASF1320  MOVE      CCEALV2,KEY3
          CALL      RDCCST1
          STRIP     CCSTDES
          MOVELPTR  CCSTDES,LENGTH
          SFORMAT   VAR,LENGTH
          MOVE      CCSTDES,VAR
          WRITE     HTMLFILE;VAR," - ";
          SFORMAT   VAR,127
.
          PACK      KEY13,CCEALV2,CCEDLV2,SP70
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      KEY13,CCXHDES
            MATCH     "~~~~~~~~~~",CCEDLV2
            IF        @EQUAL
              MOVE      "Other",CCXHDES
            ENDIF
          ENDIF
.
          STRIP     CCXHDES
          MOVELPTR  CCXHDES,LENGTH
          SFORMAT   VAR,LENGTH
          MOVE      CCXHDES,VAR
          WRITE     HTMLFILE;VAR;
          SFORMAT   VAR,127
          GOTO      CASF9999
.
CASF1330  MOVE      CCEALV3,KEY3
          CALL      RDCCST1
          STRIP     CCSTDES
          MOVELPTR  CCSTDES,LENGTH
          SFORMAT   VAR,LENGTH
          MOVE      CCSTDES,VAR
          WRITE     HTMLFILE;VAR," - ";
          SFORMAT   VAR,127
.
          PACK      KEY13,CCEALV3,CCEELV3,SP70
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      KEY13,CCXHDES
            MATCH     "~~~~~~~~~~",CCEELV3
            IF        @EQUAL
              MOVE      "Other",CCXHDES
            ENDIF
          ENDIF
.
          STRIP     CCXHDES
          MOVELPTR  CCXHDES,LENGTH
          SFORMAT   VAR,LENGTH
          MOVE      CCXHDES,VAR
          WRITE     HTMLFILE;VAR;
          SFORMAT   VAR,127
          GOTO      CASF9999
.
CASF9999  RETURN
.-----------------------------------------------------------------------------
. Extract Data
.-----------------------------------------------------------------------------
CCEXT000  MOVE     ZERO,F1
          MOVE     CEXLEVEL,F1
          BRANCH   F1,CCEXT100,CCEXT200,CCEXT999
          CALL     EXTEB000
          GOTO     CCEXT999
.
CCEXT100  CALL     EXTED000
          GOTO     CCEXT999
.
CCEXT200  CALL     EXTEE000
          GOTO     CCEXT999
.
.CCEXT300  CALL     EXTEC000
.          GOTO     CCEXT999
.
CCEXT999  RETURN
.----------------------------------------------------------------------
. Extract Level 1
.----------------------------------------------------------------------
EXTEB000  MOVE      ZERO,SECTOR
          PACK      KEY10,SP70
          CALL      RSCCEB1
EXTEB100  CALL      RKCCEB1
          BRANCH    OVRCD,EXTEB999
          ADD       ONE,SECTOR
          COMPARE   "100",SECTOR
          GOTO      EXTEB900 IF EQUAL
.
          PACK      KEY13,CCEALV1,CCEBLV1,SP70
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      KEY13,CCXHDES
            MATCH     "~~~~~~~~~~",CCEBLV1
            IF        @EQUAL
              MOVE      "Other",CCXHDES
            ENDIF
          ENDIF
.
          STRIP     CCXHDES
          MOVELPTR  CCXHDES,LENGTH
          SFORMAT   VAR,LENGTH
          MOVE      CCXHDES,VAR
          MOVE      CCEBFTC,DISINC
          MOVE      CCEBTTC,DISCST  
          MOVE      CCEBLTO,DISBED
          ASSIGN    CCEBLTO/CCEBNEP,DISALS
          WRITE     HTMLFILE;"t.addRow(",QUOTE,VAR,QUOTE,COMMA:
                                         QUOTE,CCEBLV1,QUOTE,COMMA:
                                         QUOTE,CCEBNEP,QUOTE,COMMA:
                                         QUOTE,DISINC,QUOTE,COMMA:
                                         QUOTE,DISCST,QUOTE,COMMA:
                                         QUOTE,DISBED,QUOTE,COMMA:
                                         QUOTE,DISALS,QUOTE,COMMA:
                                         QUOTE,ONE,QUOTE,");"
          SFORMAT   VAR,127
          GOTO     EXTEB100
.
EXTEB900  MOVE     ZERO,DISINC
          MOVE     ZERO,DISCST  
          MOVE     ZERO,DISBED
          MOVE     ZERO,DISALS
          WRITE    HTMLFILE;"t.addRow(",QUOTE,"Too Many Records",QUOTE,COMMA:
                                         QUOTE,CCEBLV1,QUOTE,COMMA:
                                         QUOTE,CCEBNEP,QUOTE,COMMA:
                                         QUOTE,DISINC,QUOTE,COMMA:
                                         QUOTE,DISCST,QUOTE,COMMA:
                                         QUOTE,DISBED,QUOTE,COMMA:
                                         QUOTE,DISALS,QUOTE,COMMA:
                                         QUOTE,ONE,QUOTE,");"
EXTEB999  RETURN
.-----------------------------------------------------------------------------
. CCSCOPCD - Open or Close Casemix Extract Files
.-----------------------------------------------------------------------------
. Open Files - Returns Exit = 1 if files unavailable
.-----------------------------------------------------------------------------
CCSCOPEN  MOVE     ZERO,F1
          MOVE     CEXLEVEL,F1
.
          BRANCH   F1,CCSCO100,CCSCO200,CCSCO300
          CALL     CCSCOPEB
.
          GOTO     CCSCO999
.
CCSCO100  CALL     CCSCOPED
          GOTO     CCSCO999
.
CCSCO200  CALL     CCSCOPEE
          GOTO     CCSCO999
.
CCSCO300  CALL     CCSCOPEC
          GOTO     CCSCO999
.
CCSCO999  RETURN
.
CCSCOPEB  MOVE     "cceb",KEY4
          PACK     FILENAME,KEY4,CCEAEID
          REP      " 0",FILENAME
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCEBA1,FILENAME
          TRAPCLR  IO
          RETURN
.
CCSCOPEC  MOVE     "ccec",KEY4
          PACK     FILENAME,KEY4,CCEAEID
          REP      " 0",FILENAME
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCECA1,FILENAME
          TRAPCLR  IO
.
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCECA2,FILENAME
          TRAPCLR  IO
.
          RETURN
.
CCSCOPED  MOVE     "cced",KEY4
          PACK     FILENAME,KEY4,CCEAEID
          REP      " 0",FILENAME
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCEDA1,FILENAME
          TRAPCLR  IO
          RETURN
.
CCSCOPEE  MOVE     "ccee",KEY4
          PACK     FILENAME,KEY4,CCEAEID
          REP      " 0",FILENAME
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCEEA1,FILENAME
          TRAPCLR  IO
          RETURN
.------------------------------------------------------------
. Casemix Extract Web Security Maintenance
.------------------------------------------------------------
WSEC0000  BRANCH    FLDITMNO,WSEC0100,WSEC0200,WSEC0300,WSEC0400,WSEC0500:
                             WSEC0600,WSEC0700,WSEC0800,WSEC0900,WSEC1000
.                                              option 10 added v9.02.01
          GOTO      WSEC9999
.
WSEC0100  WRITE     HTMLFILE;CCWSEID;
          GOTO      WSEC9999
.
WSEC0200  WRITE     HTMLFILE;CCWSWPC;
          GOTO      WSEC9999
.
WSEC0300  WRITE     HTMLFILE;CCWSSLV;
          GOTO      WSEC9999
.
WSEC0400  WRITE     HTMLFILE;CCWSSCD;
          GOTO      WSEC9999
.
WSEC0500  WRITE     HTMLFILE;CCWSTEM;
          GOTO      WSEC9999
.
WSEC0600  
          GOTO      WSEC9999              * remove NEXT option v9.02.01
.
WSEC0700  
          GOTO      WSEC9999              * remove PREV option v9.02.01
.
WSEC0800  CALL      WSETB000              * Table of Web Security
          GOTO      WSEC9999
.
WSEC0900  MATCH     SP70,WEBUSEID         * only output if not blank v9.02.01
          GOTO      WSEC9999 IF EQUAL
          WRITE     HTMLFILE;WEBUSEID;
          GOTO      WSEC9999
.
WSEC1000  MATCH     SP70,WEBUSEID         * new option v9.02.01
          GOTO      WSEC9999 IF EQUAL
          MOVE      WEBUSEID,KEY10
          CALL      RDWBSE1
          BRANCH    OVRCD,WSEC1010
.
          WRITE     HTMLFILE;WBSENAM;
          GOTO      WSEC1020
.
WSEC1010  WRITE     HTMLFILE;"Invalid User ID";
.
WSEC1020  MOVE      USERID,KEY10
          CALL      RDWBSE1
          GOTO      WSEC9999
.
WSEC9999  RETURN
.------------------------------------------------------------
. Casemix Extract Code Search & Maintenance
.------------------------------------------------------------
WEXT0000  BRANCH    FLDITMNO,WEXT0100,WEXT0200,WEXT0300,WEXT0400,WEXT0500:
                             WEXT0600,WEXT0700,WEXT0800,WEXT0900,WEXT1000:
                             WEXT1100,WEXT1200,WEXT1300,WEXT1400,WEXT1500:
                             WEXT1600,WEXT1700,WEXT1800,WEXT1900,WEXT2000:
                             WEXT2100,WEXT2200,WEXT2300,WEXT2400,WEXT2500:
                             WEXT2600,WEXT2700
          GOTO      WEXT9999
.
WEXT0100  WRITE     HTMLFILE;CCEAEID;
          GOTO      WEXT9999
.
WEXT0200  MATCH     SP70,CCEADES
          GOTO      WEXT9999 IF EQUAL
          WRITE     HTMLFILE;CCEADES;
          GOTO      WEXT9999
.

WEXT0300  MATCH     SP70,CCEADES
          GOTO      WEXT9999 IF EQUAL
          WRITE     HTMLFILE;CCEAHCD;
          GOTO      WEXT9999
.
WEXT0400  MATCH     SP70,CCEAFDD
          GOTO      WEXT9999 IF EQUAL
          UNPACK    CCEAFDD,CCENT,CYEAR,CMON,CDAY   * To Date in (DD MON CCYY)
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY12,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;KEY12;
          GOTO      WEXT9999
.
WEXT0500  MATCH     SP70,CCEATDD
          GOTO      WEXT9999 IF EQUAL
          UNPACK    CCEATDD,CCENT,CYEAR,CMON,CDAY   * To Date in (DD MON CCYY)
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY12,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;KEY12;
          GOTO      WEXT9999
.
WEXT0600  MATCH     SP70,CCEAFAD
          GOTO      WEXT9999 IF EQUAL
          UNPACK    CCEAFAD,CCENT,CYEAR,CMON,CDAY   * To Date in (DD MON CCYY)
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY12,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;KEY12;
          GOTO      WEXT9999
.
WEXT0700  MATCH     SP70,CCEATAD
          GOTO      WEXT9999 IF EQUAL
          UNPACK    CCEATAD,CCENT,CYEAR,CMON,CDAY   * To Date in (DD MON CCYY)
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY12,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;KEY12;
          GOTO      WEXT9999
.
WEXT0800  WRITE     HTMLFILE;CCEAINC;
          GOTO      WEXT9999
.
WEXT0900  UNPACK    DIM127,D1,ANS,DIM127
          MOVE      ANS,F1
          BRANCH    F1,WEXT0910,WEXT0920
.
          MOVE      CCEAVIS,F1
          BRANCH    F1,WEXT0901,WEXT0902,WEXT0903
          WRITE     HTMLFILE;"All";
          GOTO      WEXT9999
.
WEXT0901  WRITE     HTMLFILE;"Emergency";
          GOTO      WEXT9999
.
WEXT0902  WRITE     HTMLFILE;"Outpatients";
          GOTO      WEXT9999
.
WEXT0903  WRITE     HTMLFILE;"Inpatients";
          GOTO      WEXT9999
.
WEXT0910  WRITE     HTMLFILE;CCEAVIS;
          GOTO      WEXT9999
.
WEXT0920  CALL      VISSEL00
          GOTO      WEXT9999
.
WEXT1000  UNPACK    DIM127,D1,ANS,DIM127
          MOVE      ANS,F1
          BRANCH    F1,WEXT1010,WEXT1020
.
          MOVE      CCEADAY,F1
          BRANCH    F1,WEXT1001,WEXT1002
          WRITE     HTMLFILE;"Exclude Day Cases";
          GOTO      WEXT9999
.
WEXT1001  WRITE     HTMLFILE;"Include Day Cases";
          GOTO      WEXT9999
.
WEXT1002  WRITE     HTMLFILE;"Day Cases Only";
          GOTO      WEXT9999
.
WEXT1010  WRITE     HTMLFILE;CCEADAY;
          GOTO      WEXT9999
.
WEXT1020  CALL      DAYSEL00
          GOTO      WEXT9999
.
WEXT1100  WRITE     HTMLFILE;CCEAFCM;
          GOTO      WEXT9999
.
WEXT1200  WRITE     HTMLFILE;CCEAFYR;
          GOTO      WEXT9999
.
WEXT1300  WRITE     HTMLFILE;CCEATCM;
          GOTO      WEXT9999
.
WEXT1400  WRITE     HTMLFILE;CCEATYR;
          GOTO      WEXT9999
.
WEXT1500  WRITE     HTMLFILE;CCEARUA;
          GOTO      WEXT9999
.
WEXT1600  MOVE      CCEALV1,LEVLCODE
          CALL      CEALEV00
          GOTO      WEXT9999
.
WEXT1700  MOVE      CCEALV2,LEVLCODE
          CALL      CEALEV00
          GOTO      WEXT9999
.
WEXT1800  MOVE      CCEALV3,LEVLCODE
          CALL      CEALEV00
          GOTO      WEXT9999
.
WEXT1900  WRITE     HTMLFILE;CCEAUST;
          GOTO      WEXT9999
.
WEXT2000  WRITE     HTMLFILE;CCEAIMOD;
          GOTO      WEXT9999
.
WEXT2100  WRITE     HTMLFILE;CCEACMOD;
          GOTO      WEXT9999
.
WEXT2200  WRITE     HTMLFILE;CCEAITHE;
          GOTO      WEXT9999
.
WEXT2300  WRITE     HTMLFILE;CCEACTHE;
          GOTO      WEXT9999
.
WEXT2400  MOVE      ONE,LNK2PRT
          CALL      EXTTB000      * Table of Web Security
          GOTO      WEXT9999
.
WEXT2500  MOVE      TWO,LNK2PRT
          CALL      EXTTB000      * Update Parent        
          GOTO      WEXT9999
.
WEXT2600  CALL      NEXTGR00      * Link to Next Group
          GOTO      WEXT9999
.
WEXT2700  CALL      PREVGR00      * Link to Last Group
          GOTO      WEXT9999
.
WEXT9999  RETURN
.----------------------------------------------------------------------------
. Casemix Extract Analysis Measures
.----------------------------------------------------------------------------
CEALEV00  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,CEALEV10,CEALEV20
          WRITE     HTMLFILE;LEVLCODE;
          GOTO      CEALEV99
.
CEALEV10  MOVE      LEVLCODE,KEY3
          CALL      RDCCST1
          WRITE     HTMLFILE;CCSTDES;
          GOTO      CEALEV99
.
CEALEV20  PACK      KEY3,SP70
          CALL      RSCCST1
CEALEV30  CALL      RKCCST1
          BRANCH    OVRCD,CEALEV99
          MATCH     LEVLCODE,CCSTSTY
          WRITE     HTMLFILE;"<option value='",CCSTSTY,"'";
          IF        @EQUAL
            WRITE     HTMLFILE;" selected";
          ENDIF
          WRITE     HTMLFILE;">",CCSTDES,"</option>"
          GOTO      CEALEV30
CEALEV99  RETURN
.
.------------------------------------------------------------
. Option List for Day Cases
.------------------------------------------------------------
DAYSEL00  WRITE     HTMLFILE;"<option value=0";
          MATCH     "0",CCEADAY
          IF        @EQUAL
            WRITE     HTMLFILE;" selected";
          ENDIF
          WRITE     HTMLFILE;">Exclude Day Cases</option>"
.
          WRITE     HTMLFILE;"<option value=1";
          MATCH     "1",CCEADAY
          IF        @EQUAL
            WRITE     HTMLFILE;" selected";
          ENDIF
          WRITE     HTMLFILE;">Include Day Cases</option>"
.
          WRITE     HTMLFILE;"<option value=2";
          MATCH     "2",CCEADAY
          IF        @EQUAL
            WRITE     HTMLFILE;" selected";
          ENDIF
          WRITE     HTMLFILE;">Day Cases Only</option>"
.
          RETURN
.------------------------------------------------------------
. Option List for Visit Type
.------------------------------------------------------------
VISSEL00  WRITE     HTMLFILE;"<option value=0";
          MATCH     "0",CCEAVIS
          IF        @EQUAL
            WRITE     HTMLFILE;" selected";
          ENDIF
          WRITE     HTMLFILE;">All</option>"
.
          WRITE     HTMLFILE;"<option value=1";
          MATCH     "1",CCEAVIS
          IF        @EQUAL
            WRITE     HTMLFILE;" selected";
          ENDIF
          WRITE     HTMLFILE;">Emergency</option>"
.
          WRITE     HTMLFILE;"<option value=2";
          MATCH     "2",CCEAVIS
          IF        @EQUAL
            WRITE     HTMLFILE;" selected";
          ENDIF
          WRITE     HTMLFILE;">Outpatients</option>"
.
          WRITE     HTMLFILE;"<option value=3";
          MATCH     "3",CCEAVIS
          IF        @EQUAL
            WRITE     HTMLFILE;" selected";
          ENDIF
          WRITE     HTMLFILE;">Inpatients</option>"
.
          RETURN
.------------------------------------------------------------
. Casemic Extract Web Security Table Maintenance
.------------------------------------------------------------
WSETB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          PACK      KEY14,WEBUSEID,SP70
          CALL      RSCCWS2
WSETB100  CALL      RKCCWS2
          BRANCH    OVRCD,WSETB999
.
          MATCH     CCWSWPC,WEBUSEID
          GOTO      WSETB999 IF NOT EQUAL
.
          CALL      WSERW000

          GOTO      WSETB100
.
WSETB999  RETURN
.
.                                         * WSEHD000 routine removed   v9.02.01
.                                         * (headings now in template) v9.02.01
.------------------------------------------------------------
. Casemix Extract Web Security Table Maintenance (TABLE ROW)
.------------------------------------------------------------
WSERW000  MATCH     SP70,CCWSSLV
          IF        @EQUAL
            MOVE      "&nbsp;",KEY5
          ELSE
            MOVE      CCWSSLV,KEY5
          ENDIF
.
          MATCH     SP70,CCWSSCD
          IF        @EQUAL
            MOVE      "&nbsp;",CCWSSCD
          ENDIF
.
          MATCH     SP70,CCWSTEM
          IF        @EQUAL
            MOVE      "&nbsp;",KEY6
          ELSE
            MOVE      CCWSTEM,KEY6
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail02":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&casec001=",CCWSEID:
                             "&casec002=",CCWSWPC,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             CCWSEID,"</td>":
                             "<td>",KEY5,"</td>":
                             "<td>",CCWSSCD,"</td>":
                             "<td>",KEY6,"</td>":
                             "</tr>"
.
WSERW999 RETURN
.------------------------------------------------------------
. Casemic Extract Code Search Table Maintenance
.------------------------------------------------------------
EXTTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      EXTHD000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "13",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY4,STARTKEY,SP70
          CALL      RDCCEA1 
          IF        OVRCD=0
            CALL      RPCCEA1 
          ENDIF
EXTTB100  CALL      RKCCEA1 
          BRANCH    OVRCD,EXTTB999
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      EXTTB100
          ENDIF
.
          CALL      EXTRW000      * Table Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      EXTTB100 IF NOT EQUAL
.
EXTTB999  RETURN
.------------------------------------------------------------
. Casemix Extract Code Search Table Maintenance (TABLE HEADING)
.------------------------------------------------------------
EXTHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=35%>":
                               "<b>Extract ID</b></td>":
                               "<td class=HeadingCell>":
                               "<b>Description</b></td>":
                             "</tr>"
.
EXTHD999  RETURN
.------------------------------------------------------------
. Casemix Extract Code Search Table Maintenance (TABLE ROW)
.------------------------------------------------------------
EXTRW000  BRANCH    LNK2PRT,EXTRW100,EXTRW200
          GOTO      EXTRW999
.
EXTRW100  MATCH     SP70,CCEADES
          IF        @EQUAL
            MOVE      "&nbsp;",CCEADES
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail03":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&caext001=",CCEAEID,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             CCEAEID,"</td>":
                             "<td>",CCEADES,"</td>":
                             "</tr>"
.
          GOTO      EXTRW999
.
EXTRW200  MATCH     SP70,CCEADES
          IF        @EQUAL
            MOVE      "&nbsp;",CCEADES
          ENDIF
.
          WRITE     HTMLFILE;"<tr valign=top>":
                             "<td><a href=#"#" ":
                             "OnClick=#"updateParent('",CCEADES:
                             "','",CCEAEID,"')#">":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             CCEAEID,"</td>":
                             "<td>",CCEADES,"</td>":
                             "</tr>"
.
EXTRW999 RETURN
.------------------------------------------------------------
. Link to Next
.------------------------------------------------------------
NEXTGR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
          REP       " +",STARTKEY
.
          WRITE     HTMLFILE;"ciaweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&startkey=",STARTKEY:
                                 "&webuseid=",WEBUSEID:
                                 "&casec002=",WEBUSEID:
                                 "&keywords=",KEYWORDS;
.
          REP       "+ ",STARTKEY
.
NEXTGR99  RETURN
.-------------------------------------------------------------------------------
. Link to previous set of Health Funds
.-------------------------------------------------------------------------------
PREVGR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE    ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
          REP       " +",STARTKEY
.
          WRITE     HTMLFILE;"ciaweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&startkey=",STARTKEY:
                                 "&webuseid=",WEBUSEID:
                                 "&casec002=",WEBUSEID:
                                 "&keywords=",KEYWORDS;
.
          REP       "+ ",STARTKEY
.
PREVGR99  RETURN
+
.------------------------------------------------------------
. Casemix Types
.------------------------------------------------------------
CTYP0000  BRANCH    FLDITMNO,CTYP0100,CTYP0200,CTYP0300,CTYP0400,CTYP0500:
                             CTYP0600,CTYP0700,CTYP0800,CTYP0900,CTYP1000:
                             CTYP1100
          GOTO      CTYP9999
.
CTYP0100  WRITE     HTMLFILE;CCSTSTY;
          GOTO      CTYP9999
.
CTYP0200  WRITE     HTMLFILE;CCSTDES;
          GOTO      CTYP9999
.
CTYP0300  WRITE     HTMLFILE;CCSTLEN;
          GOTO      CTYP9999
.
CTYP0400  WRITE     HTMLFILE;CCSTJR;
          GOTO      CTYP9999
.
CTYP0500  WRITE     HTMLFILE;CCSTZF;
          GOTO      CTYP9999
.
CTYP0600  WRITE     HTMLFILE;CCSTDE;
          GOTO      CTYP9999
.
CTYP0700  MOVE      ZERO,LNK2PRT
          CALL      CATYP000
          GOTO      CTYP9999
.
CTYP0800  MOVE      ZERO,LNK2PRT
          CALL      CADSC000
          GOTO      CTYP9999
.
CTYP0900  CALL      NEXTCA00
          GOTO      CTYP9999
.
CTYP1000  CALL      PREVCA00
          GOTO      CTYP9999
.
CTYP1100  PACK      KEY3,SP10
          CALL      RSCCST1
CTYP1110  CALL      RKCCST1
          BRANCH    OVRCD,CTYP9999
          WRITE     HTMLFILE;"<option value=",CCSTSTY,">":
                               CCSTDES,"</option>"
          GOTO      CTYP1110
.
CTYP9999  RETURN
+
.------------------------------------------------------------
. Table of Casemix Type by code
.------------------------------------------------------------
CATYP000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      CTHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY3,STARTKEY,SP70
          CALL      RDCCST1 
          IF        OVRCD=0
            CALL      RPCCST1 
          ENDIF
CATYP100  CALL      RKCCST1 
          BRANCH    OVRCD,CATYP900
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      CATYP100
          ENDIF
.
          CALL      CTROW000      * Display Category Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      CATYP100 IF NOT EQUAL
          GOTO      CATYP999
.
CATYP900  CALL      NOMORE00      * Display No More Records Message
.
CATYP999  RETURN
.------------------------------------------------------------
. Table of Casemix Types by Description
.------------------------------------------------------------
CADSC000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      CTHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "13",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY38,STARTKEY,SP70
          CALL      RDCCST2 
          IF        OVRCD=0
            CALL      RPCCST2 
          ENDIF
CADSC100  CALL      RKCCST2 
          BRANCH    OVRCD,CADSC999
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      CADSC100
          ENDIF
.
          CALL      CTROW000      * Display Category Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      CADSC100 IF NOT EQUAL
.
CADSC999  RETURN
.------------------------------------------------------------
. Casemix Type Maintenance (TABLE HEADING)
.------------------------------------------------------------
CTHED000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=20%>Type":
                             "</td>":
                             "<td class=HeadingCell width=40%>Description":
                             "</td>":
                             "<td class=HeadingCell width=10% align=center>":
                             "Field Length":
                             "</td>":
                             "<td class=HeadingCell width=10% align=center>":
                             "Right Justify":
                             "</td>":
                             "<td class=HeadingCell width=10% align=center>":
                             "Zero Fill":
                             "</td>":
                             "<td class=HeadingCell width=10% align=center>":
                             "Numeric Only":
                             "</td>":
                             "</tr>"
.
CTHED999  RETURN
.------------------------------------------------------------
. Category Maintenance (TABLE ROW)
.------------------------------------------------------------
CTROW000  MATCH     SP70,CCSTDES
          IF        @EQUAL
            MOVE      "&nbsp;",CCSTDES
          ENDIF
.
          MATCH     "0",CCSTJR
          IF        @EQUAL
            MOVE      "No",DIM3A
          ELSE
            MOVE      "Yes",DIM3A
          ENDIF
.
          MATCH     "0",CCSTZF
          IF        @EQUAL
            MOVE      "No",DIM3B
          ELSE
            MOVE      "Yes",DIM3B
          ENDIF
.
          MATCH     "0",CCSTDE
          IF        @EQUAL
            MOVE      "No",DIM3C
          ELSE
            MOVE      "Yes",DIM3C
          ENDIF
.
          BRANCH    LNK2PRT,CTROW100
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail04":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&catyp001=",CCSTSTY,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             CCSTSTY,"</td>":
                             "<td>",CCSTDES,"</td>":
                             "<td align=center>",CCSTLEN,"</td>":
                             "<td align=center>",DIM3A,"</td>":
                             "<td align=center>",DIM3B,"</td>":
                             "<td align=center>",DIM3C,"</td>":
                             "</tr>"
.
          GOTO      CTROW999
.
CTROW100  WRITE     HTMLFILE;"<tr valign=top>":
                              "<td><a href=#"#" ":
                              "OnClick=#"UpdateParent04('",CCSTSTY:
                              "','",CCSTDES,"')#">":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              CCSTSTY,"</td>":
                              "<td>",CCSTDES,"</td>":
                              "<td align=center>",CCSTLEN,"</td>":
                             "<td align=center>",DIM3A,"</td>":
                             "<td align=center>",DIM3B,"</td>":
                             "<td align=center>",DIM3C,"</td>":
                              "</tr>"
.
CTROW999  RETURN
+
.------------------------------------------------------------
. Casemix Type Code
.------------------------------------------------------------
CCOD0000  BRANCH    FLDITMNO,CCOD0100,CCOD0200,CCOD0300,CCOD0400,CCOD0500:
                             CCOD0600,CCOD0700,CCOD0800,CCOD0900,CCOD1000:
                             CCOD1100
          GOTO      CCOD9999
.
CCOD0100  WRITE     HTMLFILE;CCXHSTY;
          GOTO      CCOD9999
.
CCOD0200  WRITE     HTMLFILE;CCXHKEY;
          GOTO      CCOD9999
.
CCOD0300  WRITE     HTMLFILE;CCXHDES;
          GOTO      CCOD9999
.
CCOD0400  WRITE     HTMLFILE;CCXHSUM;
          GOTO      CCOD9999
.
CCOD0500  MOVE      ZERO,LNK2PRT
          CALL      CACOD000
          GOTO      CCOD9999
.
CCOD0600  MOVE      ZERO,LNK2PRT
          CALL      CACDS000
          GOTO      CCOD9999
.
CCOD0700  CALL      NEXTCA00
          GOTO      CCOD9999
.
CCOD0800  CALL      PREVCA00
          GOTO      CCOD9999
.
CCOD0900  WRITE     HTMLFILE;CURRTYPE;
          GOTO      CCOD9999
.
CCOD1000  WRITE     HTMLFILE;TYPEDESC;
          GOTO      CCOD9999
.
CCOD1100  CALL      SUMS0000                * Summary code selection list
          GOTO      CCOD9999
.
CCOD9999  RETURN
+
.------------------------------------------------------------
. Table of Casemix Codes by Code
.------------------------------------------------------------
CACOD000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      CDHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY13,CACOD001,STARTKEY,SP70
          CALL      RSCCXH1
          IF        OVRCD=0
            CALL      RPCCXH1
          ENDIF
CACOD100  CALL      RKCCXH1
          BRANCH    OVRCD,CACOD900
          MATCH     CACOD001,CCXHSTY
          GOTO      CACOD900 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      CACOD100
          ENDIF
.
          CALL      CDROW000      * Display Category Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      CACOD100 IF NOT EQUAL
          GOTO      CACOD999
.
CACOD900  CALL      NOMORE00      * Display No More Records Message
.
CACOD999  RETURN
.------------------------------------------------------------
. Table of Casemix Codes by Description
.------------------------------------------------------------
CACDS000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      CDHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "13",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY48,CACOD001,STARTKEY,SP70
          CALL      RSCCXH3
          IF        OVRCD=0
            CALL      RPCCXH3
          ENDIF
CACDS100  CALL      RKCCXH3
          BRANCH    OVRCD,CACDS999
          MATCH     CACOD001,CCXHSTY
          GOTO      CACDS999 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      CACDS100
          ENDIF
.
          CALL      CDROW000      * Display Category Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      CACDS100 IF NOT EQUAL
.
CACDS999  RETURN
.------------------------------------------------------------
. Code Record Maintenance (TABLE HEADING)
.------------------------------------------------------------
CDHED000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=10%>Code":
                             "</td>":
                             "<td class=HeadingCell width=30%>Description":
                             "</td>":
                             "<td class=HeadingCell width=10%>Summary Code":
                             "</td>":
                             "</tr>"
.
CDHED999  RETURN
.------------------------------------------------------------
. Code Record Maintenance (TABLE ROW)
.------------------------------------------------------------
CDROW000  MATCH     SP70,CCXHDES
          IF        @EQUAL
            MOVE      "&nbsp;",CCXHDES
          ENDIF
.
          MATCH     SP70,CCXHSUM
          IF        @EQUAL
            MOVE      "&nbsp;",CCXHSUM
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail05":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&cacod001=",CCXHSTY:
                             "&cacod002=",CCXHKEY,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             CCXHKEY,"</td>":
                             "<td>",CCXHDES,"</td>":
                             "<td>",CCXHSUM,"</td>":
                             "</tr>"
.
CDROW999 RETURN
.-----------------------------------------------------------
. Link to Next Group
.-----------------------------------------------------------
NEXTCA00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",STARTKEY
          REP       " +",CURRTYPE
          REP       " +",CAAGE001
          REP       " +",CAPRD001
          REP       " +",CAAAD001
          REP       " +",CAINC001
          REP       "'~",STARTKEY
.
          WRITE     HTMLFILE;"ciaweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&startkey=",STARTKEY:
                                 "&cacod001=",CURRTYPE:
                                 "&caage001=",CAAGE001:
                                 "&caprd001=",CAPRD001:
                                 "&caaad001=",CAAAD001:
                                 "&cainc001=",CAINC001;
.
          REP       "+ ",STARTKEY
          REP       "+ ",CURRTYPE
          REP       "+ ",CAAGE001
          REP       "+ ",CAPRD001
          REP       "+ ",CAAAD001
          REP       "+ ",CAINC001
          REP       "~'",STARTKEY
.
NEXTCA99  RETURN
.-------------------------------------------------------------
. Link to Prev Group
.-------------------------------------------------------------
PREVCA00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",STARTKEY
          REP       " +",CURRTYPE
          REP       " +",CAAGE001
          REP       " +",CAPRD001
          REP       " +",CAAAD001
          REP       " +",CAINC001
          REP       "'~",STARTKEY
.
          WRITE     HTMLFILE;"ciaweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&startkey=",STARTKEY:
                                 "&cacod001=",CURRTYPE:
                                 "&caage001=",CAAGE001:
                                 "&caprd001=",CAPRD001:
                                 "&caaad001=",CAAAD001:
                                 "&cainc001=",CAINC001;
.
          REP       "+ ",STARTKEY
          REP       "+ ",CURRTYPE
          REP       "+ ",CAAGE001
          REP       "+ ",CAPRD001
          REP       "~'",STARTKEY
.
PREVCA99  RETURN
+
.------------------------------------------------------------
. Age Range Fields  
.------------------------------------------------------------
ARNG0000  BRANCH    FLDITMNO,ARNG0100,ARNG0200,ARNG0300,ARNG0400,ARNG0500:
                             ARNG0600,ARNG0700,ARNG0800,ARNG0900,ARNG1000
          GOTO      ARNG9999
.
ARNG0100  WRITE     HTMLFILE;CCAGDEF;
          GOTO      ARNG9999
.
ARNG0200  WRITE     HTMLFILE;CCAGGRP;
          GOTO      ARNG9999
.
ARNG0300  WRITE     HTMLFILE;CCAGDES;
          GOTO      ARNG9999
.
ARNG0400  WRITE     HTMLFILE;CCAGTAGE;
          GOTO      ARNG9999
.
ARNG0500  CALL      ARNGE000             * List of Age Range
          GOTO      ARNG9999
.
ARNG0600  CALL      ARNCD000             * List of Age Range codes
          GOTO      ARNG9999
.
ARNG0700  CALL      NEXTCA00
          GOTO      ARNG9999
.
ARNG0800  CALL      PREVCA00
          GOTO      ARNG9999
.
ARNG0900  WRITE     HTMLFILE;CAAGE001;
          GOTO      ARNG9999
.
ARNG1000  WRITE     HTMLFILE;TYPEDESC;
          GOTO      ARNG9999
.
ARNG9999  RETURN
.------------------------------------------------------------
. Table of Age Range               
.------------------------------------------------------------
ARNGE000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=30%>Code":
                             "</td>":
                             "<td class=HeadingCell width=70%>Description":
                             "</td>":
                             "</tr>"
.
          MOVE      ONE,FORM1
ARNGE100  IF        FORM1=0
            GOTO      ARNGE999
          ENDIF
.
          MOVE      FORM1,F3
          ADD       "35",F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
          CALL      RDCCST1
          IF        OVRCD=1
            MOVE      "Unknown",CCSTDES
          ENDIF
.          
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowList06":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&caage001=",FORM1,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             FORM1,"</td>":
                             "<td>",CCSTDES,"</td>":
                             "</tr>"
.
          ADD       ONE,FORM1
          GOTO      ARNGE100
.
ARNGE999  RETURN
+
.------------------------------------------------------------
. Table of Age Range Codes
.------------------------------------------------------------
ARNCD000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=20%>Code":
                             "</td>":
                             "<td class=HeadingCell width=50%>Description":
                             "</td>":
                             "<td class=HeadingCell width=30%>Age <=":
                             "</td>":
                             "</tr>"
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY4,CAAGE001,STARTKEY,SP70
          CALL      RSCCAG1
          IF        OVRCD=0
            CALL      RPCCAG1
          ENDIF
ARNCD100  CALL      RKCCAG1
          BRANCH    OVRCD,ARNCD900
          MATCH     CAAGE001,CCAGDEF
          GOTO      ARNCD900 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ARNCD100
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail06":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&caage001=",CCAGDEF:
                             "&caage002=",CCAGGRP,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             CCAGGRP,"</td>":
                             "<td>",CCAGDES,"</td>":
                             "<td>",CCAGTAGE,"</td>":
                             "</tr>"
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ARNCD100 IF NOT EQUAL
          GOTO      ARNCD999
.
ARNCD900  CALL      NOMORE00     * Display No More Records Message
.
ARNCD999  RETURN
+
.------------------------------------------------------------
. Time Period Fields  
.------------------------------------------------------------
TPRD0000  BRANCH    FLDITMNO,TPRD0100,TPRD0200,TPRD0300,TPRD0400,TPRD0500:
                             TPRD0600,TPRD0700,TPRD0800,TPRD0900,TPRD1000:
                             TPRD1100
          GOTO      TPRD9999
.
TPRD0100  WRITE     HTMLFILE;CCTMDEF;
          GOTO      TPRD9999
.
TPRD0200  MATCH     SP70,CCTMDAT
          GOTO      TPRD9999 IF EQUAL
          GOTO      TPRD9999 IF EOS
          UNPACK    CCTMDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          MATCH     "00",CDAY
          GOTO      TPRD9999 IF EQUAL
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      TPRD9999
.
TPRD0300  WRITE     HTMLFILE;CCTMDES;
          GOTO      TPRD9999
.
TPRD0400  WRITE     HTMLFILE;CCTMLV4;
          GOTO      TPRD9999
.
TPRD0500  WRITE     HTMLFILE;CCTMLV3;
          GOTO      TPRD9999
.
TPRD0600  WRITE     HTMLFILE;CCTMLV2;
          GOTO      TPRD9999
.
TPRD0700  CALL      TMPRD000             * List of Time Period
          GOTO      TPRD9999
.
TPRD0800  CALL      TPEND000             * List of Time Period Ending
          GOTO      TPRD9999
.
TPRD0900  CALL      NEXTCA00
          GOTO      TPRD9999
.
TPRD1000  CALL      PREVCA00
          GOTO      TPRD9999
.
TPRD1100  WRITE     HTMLFILE;CAPRD001;
          GOTO      TPRD9999
.
TPRD9999  RETURN
.------------------------------------------------------------
. Table of Time Period             
.------------------------------------------------------------
TMPRD000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=30%>Code":
                             "</td>":
                             "<td class=HeadingCell width=70%>Description":
                             "</td>":
                             "</tr>"
.
          MOVE      ONE,FORM1
TMPRD100  IF        FORM1=0
            GOTO      TMPRD999
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowList07":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&caprd001=",FORM1,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             FORM1,"</td>":
                             "<td>Time Period Definition ",FORM1,"</td>":
                             "</tr>"
.
          ADD       ONE,FORM1
          GOTO      TMPRD100
.
TMPRD999  RETURN
+
.------------------------------------------------------------
. Table of Time Period Ending
.------------------------------------------------------------
TPEND000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=70%>Description":
                             "</td>":
                             "<td class=HeadingCell width=30%>Period End Date":
                             "</td>":
                             "</tr>"
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY9,CAPRD001,Z70
          CALL      RSCCTM1
TPEND100  CALL      RPCCTM1
          BRANCH    OVRCD,TPEND900
          MATCH     CAPRD001,CCTMDEF
          GOTO      TPEND900 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      TPEND100
          ENDIF
.
          MOVE      SP70,KEY11
          MATCH     SP70,CCTMDAT
          IF        !@EQUAL
            UNPACK    CCTMDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            MATCH     "00",CDAY
            GOTO      TPRD9999 IF EQUAL
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF

          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail07":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&caprd001=",CCTMDEF:
                             "&caprd002=",KEY11,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             CCTMDES,"</td>":
                             "<td>",KEY11,"</td>":
                             "</tr>"
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      TPEND100 IF NOT EQUAL
          GOTO      TPEND999
.
TPEND900  CALL      NOMORE00      * Display No More Records Message
.
TPEND999  RETURN
+
.------------------------------------------------------------
. Area Analysis Fields  
.------------------------------------------------------------
AANL0000  BRANCH    FLDITMNO,AANL0100,AANL0200,AANL0300,AANL0400,AANL0500:
                             AANL0600,AANL0700,AANL0800,AANL0900,AANL1000:
                             AANL1100
          GOTO      AANL9999
.
AANL0100  WRITE     HTMLFILE;CCADDEF;
          GOTO      AANL9999
.
AANL0200  WRITE     HTMLFILE;CCADPC;
          GOTO      AANL9999
.
AANL0300  WRITE     HTMLFILE;CCADDES;
          GOTO      AANL9999
.
AANL0400  WRITE     HTMLFILE;CCADLV4;
          GOTO      AANL9999
.
AANL0500  WRITE     HTMLFILE;CCADLV3;
          GOTO      AANL9999
.
AANL0600  WRITE     HTMLFILE;CCADLV2;
          GOTO      AANL9999
.
AANL0700  CALL      AANAL000             * List of Area Analysis
          GOTO      AANL9999
.
AANL0800  CALL      AANPC000             * List of Area Analysis Postcode
          GOTO      AANL9999
.
AANL0900  CALL      NEXTCA00
          GOTO      AANL9999
.
AANL1000  CALL      PREVCA00
          GOTO      AANL9999
.
AANL1100  WRITE     HTMLFILE;CAAAD001;
          GOTO      AANL9999
.
AANL9999  RETURN
.------------------------------------------------------------
. Table of Area Analysis             
.------------------------------------------------------------
AANAL000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=30%>Code":
                             "</td>":
                             "<td class=HeadingCell width=70%>Description":
                             "</td>":
                             "</tr>"
.
          MOVE      ONE,FORM1
AANAL100  IF        FORM1=0
            GOTO      AANAL999
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowList08":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&caaad001=",FORM1,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             FORM1,"</td>":
                             "<td>Area Analysis Definition ",FORM1,"</td>":
                             "</tr>"
.
          ADD       ONE,FORM1
          GOTO      AANAL100
.
AANAL999  RETURN
+
.------------------------------------------------------------
. Table of Area Analysis Postcode
.------------------------------------------------------------
AANPC000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=30%>Postcode":
                             "</td>":
                             "<td class=HeadingCell width=70%>Description":
                             "</td>":
                             "</tr>"
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY11,CAAAD001,STARTKEY,SP70
          CALL      RSCCAD1
AANPC100  CALL      RKCCAD1
          BRANCH    OVRCD,AANPC900
          MATCH     CAAAD001,CCADDEF
          GOTO      AANPC900 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      AANPC100
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail08":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&caaad001=",CCADDEF:
                             "&caaad002=",CCADPC,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             CCADPC,"</td>":
                             "<td>",CCADDES,"</td>":
                             "</tr>"
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      AANPC100 IF NOT EQUAL
          GOTO      AANPC999
.
AANPC900  CALL      NOMORE00     * Display No More Records Message
.
AANPC999  RETURN
+
.------------------------------------------------------------
. Income Component Mapping Fields  
.------------------------------------------------------------
IMAP0000  BRANCH    FLDITMNO,IMAP0100,IMAP0200,IMAP0300,IMAP0400,IMAP0500:
                             IMAP0600,IMAP0700,IMAP0800,IMAP0900,IMAP1000:
                             IMAP1100,IMAP1200,IMAP1300
          GOTO      IMAP9999
.
IMAP0100  WRITE     HTMLFILE;CCIMTYP;
          GOTO      IMAP9999
.
IMAP0200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,IMAP0210
          WRITE     HTMLFILE;CCIMCOD;
          GOTO      IMAP9999
.
IMAP0210  MOVE      NBSP,KEY30
          CALL      MAPDSC00
          WRITE     HTMLFILE;KEY30;
          GOTO      IMAP9999
.
IMAP0300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,IMAP0310
          WRITE     HTMLFILE;CCIMITY;
          GOTO      IMAP9999
.
IMAP0310  WRITE     HTMLFILE;"<option value=1>",ICTHEATR,"</option>":
                             "<option value=2>",CCCOIA1,"</option>":
                             "<option value=3>",CCCOIA2,"</option>":
                             "<option value=4>",CCCOIA3,"</option>":
                             "<option value=5>",ICACCOTH,"</option>":
                             "<option value=6>",CCCOIM1,"</option>":
                             "<option value=7>",CCCOIM2,"</option>":
                             "<option value=8>",CCCOIM3,"</option>":
                             "<option value=9>",ICMISOTH,"</option>"
          GOTO      IMAP9999
.
IMAP0400  MOVE      CODEFI,CATEGORY            * Misc Item Group
          MOVE      CCIMCOD,CODE
          CALL      CODITM00
          GOTO      IMAP9999
.
IMAP0500  MOVE      CODEJ,CATEGORY            * Journal code
          MOVE      CCIMCOD,CODE
          CALL      CODITM00
          GOTO      IMAP9999
.
IMAP0600  PACK      KEY6,SP70
          CALL      RDSWARD3
IMAP0610  CALL      RDKWARD3
          BRANCH    OVRCD,IMAP9999
          MATCH     SP70,WBED
          GOTO      IMAP9999 IF NOT EQUAL
          COMPARE   WACTIVE,ZERO                 *List only active wards
          GOTO      IMAP0610 IF NOT EQUAL
.
          PACK      KEY5,QUOTE,WWARD,QUOTE
          MATCH     WWARD,CCIMCOD
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5,"selected>",WBDESC,"   (":
                               WWARD,")</option>";
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",WBDESC,"   (",WWARD:
                               ")</option>";
          ENDIF
          GOTO      IMAP0610
.
IMAP0700  MOVE      CODEA,CATEGORY            * Admission type
          MOVE      CCIMCOD,CODE
          CALL      CODITM00
          GOTO      IMAP9999
.
IMAP0800  MOVE      CODEBT,CATEGORY            * Bed type
          MOVE      CCIMCOD,CODE
          CALL      CODITM00
          GOTO      IMAP9999
.
IMAP0900  CALL      IMLST000             * List of Income Component Mapping
          GOTO      IMAP9999
.
IMAP1000  CALL      NEXTCA00
          GOTO      IMAP9999
.
IMAP1100  CALL      PREVCA00
          GOTO      IMAP9999
.
IMAP1200  WRITE     HTMLFILE;CAINC001;
          GOTO      IMAP9999
.
IMAP1300  MOVE      ZERO,F1
          MOVE      NBSP,KEY40
          MOVE      CAINC001,F1
          LOAD      KEY40,F1,MTYPMSCG,MTYPMSCC,MTYPJRNL,MTYPWARD,MTYPADMT:
                             MTYPBEDT
          WRITE     HTMLFILE;KEY40;
          GOTO      IMAP9999
.
IMAP9999  RETURN
+
.------------------------------------------------------------
. Table of Income Component Mapping
.------------------------------------------------------------
IMLST000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=20%>Code":
                             "</td>":
                             "<td class=HeadingCell width=50%>Description":
                             "</td>":
                             "<td class=HeadingCell width=30%>Income Component":
                             "</td>":
                             "</tr>"
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY10,CAINC001,STARTKEY,SP70
          CALL      RSCCIM1
IMLST100  CALL      RKCCIM1
          BRANCH    OVRCD,IMLST900
          MATCH     CAINC001,CCIMTYP
          GOTO      IMLST900 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      IMLST100
          ENDIF
.
          MOVE      NBSP,KEY30
          CALL      MAPDSC00
.
          MOVE      "Ignore Income",KEY20
          LOAD      KEY20,CCIMITY,ICTHEATR,CCCOIA1,CCCOIA2,CCCOIA3,ICACCOTH:
                                  CCCOIM1,CCCOIM2,CCCOIM3,ICMISOTH
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail09":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&cainc001=",CCIMTYP:
                             "&cainc002=",CCIMCOD,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             CCIMCOD,"</td>":
                             "<td>",KEY30,"</td>":
                             "<td>",KEY20,"</td>":
                             "</tr>"
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      IMLST100 IF NOT EQUAL
          GOTO      IMLST999
.
IMLST900  CALL      NOMORE00     * Display No More Records Message
.
IMLST999  RETURN
+
.-----------------------------------------------------------------------------
. Get Mapping Description
.-----------------------------------------------------------------------------
MAPDSC00  MOVE      ZERO,F1          
          MOVE      CCIMTYP,F1
          BRANCH    F1,MAPDSC10,MAPDSC20,MAPDSC30,MAPDSC40,MAPDSC50:
                       MAPDSC60
          MOVE      "Unknown",KEY30
          GOTO      MAPDSC99 
.
MAPDSC10  PACK      KEY5,CODEFI,CCIMCOD
          CALL      RDCODE1
          IF        OVRCD=0
            MOVE      TDESC,KEY30
          ELSE
            MOVE      "Unknown",KEY30
          ENDIF
          GOTO      MAPDSC99 
.
MAPDSC20  MOVE      ZERO,EXIT
          IF        IBCNMHOS=1
            PACK      KEY3,SP10
            CALL      RSPTHSP1
            CALL      RKPTHSP1
            BRANCH    OVRCD,MAPDSC29
            PACK      KEY29,PTHSDCLM,SP6,SP8,CCIMCOD,CURRDATE,SP10
          ELSE
            PACK      KEY29,PTCNDCLM,SP6,SP8,CCIMCOD,CURRDATE,SP10
          ENDIF
MAPDSC22  CALL      PATMCHRD                * read Misc.Charges file 
          COMPARE   ZERO,EXIT
          GOTO      MAPDSC99 IF EQUAL
.
MAPDSC27  IF        IBCNMHOS=1
            CALL      RKPTHSP1
            BRANCH    OVRCD,MAPDSC29
            PACK      KEY29,PTHSDCLM,SP6,SP8,CCIMCOD,CURRDATE,SP10
            GOTO      MAPDSC22 
          ENDIF
.
MAPDSC29  MOVE      "Unknown",KEY30
          GOTO      MAPDSC99 
.
MAPDSC30  PACK      KEY5,CODEJ,CCIMCOD
          CALL      RDCODE1
          IF        OVRCD=0
            MOVE      TDESC,KEY30
          ELSE
            MOVE      "Unknown",KEY30
          ENDIF
          GOTO      MAPDSC99 
.
MAPDSC40  PACK      KEY6,CCIMCOD,SP70
          CALL      RDWARD1
          IF        OVRCD=0
            MOVE      WBDESC,KEY30
          ELSE
            MOVE      "Unknown",KEY30
          ENDIF
          GOTO      MAPDSC99 
.
MAPDSC50  PACK      KEY5,CODEA,CCIMCOD
          CALL      RDCODE1
          IF        OVRCD=0
            MOVE      TDESC,KEY30
          ELSE
            MOVE      "Unknown",KEY30
          ENDIF
          GOTO      MAPDSC99 
.
MAPDSC60  PACK      KEY5,CODEBT,CCIMCOD
          CALL      RDCODE1
          IF        OVRCD=0
            MOVE      TDESC,KEY30
          ELSE
            MOVE      "Unknown",KEY30
          ENDIF
          GOTO      MAPDSC99 
.
MAPDSC90  MOVE      MDESC,KEY30
.
.                 * EXIT is set - 0=OK, 1=invalid, inactive or not in date range
MAPDSC99  RETURN
+
.----------------------------------------------------------------------
. Extract Level 2
.----------------------------------------------------------------------
EXTED000  MOVE      ZERO,SECTOR
          PACK      KEY10,CEXTRKEY,SP70
          PACK      KEY20,KEY10,SP70
          CALL      RSCCED1
EXTED100  CALL      RKCCED1
          BRANCH    OVRCD,EXTED999
          PACK      KEY10,CEXTRKEY,SP70
          MATCH     KEY10,CCEDLV1
          GOTO      EXTED999 IF NOT EQUAL
.
          ADD       ONE,SECTOR
          COMPARE   "100",SECTOR
          GOTO      EXTED900 IF EQUAL
.
          PACK      KEY13,CCEALV2,CCEDLV2,SP70
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      KEY13,CCXHDES
            MATCH     "~~~~~~~~~~",CCEDLV2
            IF        @EQUAL
              MOVE      "Other",CCXHDES
            ENDIF
          ENDIF
.
          STRIP     CCXHDES
          MOVELPTR  CCXHDES,LENGTH
          SFORMAT   VAR,LENGTH
          MOVE      CCXHDES,VAR
          MOVE      CCEDFTC,DISINC
          MOVE      CCEDTTC,DISCST  
          MOVE      CCEDLTO,DISBED
          ASSIGN    CCEDLTO/CCEDNEP,DISALS
          WRITE     HTMLFILE;"t.addRow(",QUOTE,VAR,QUOTE,COMMA:
                                         QUOTE,CCEDLV1,CCEDLV2,QUOTE,COMMA:
                                         QUOTE,CCEDNEP,QUOTE,COMMA:
                                         QUOTE,DISINC,QUOTE,COMMA:
                                         QUOTE,DISCST,QUOTE,COMMA:
                                         QUOTE,DISBED,QUOTE,COMMA:
                                         QUOTE,DISALS,QUOTE,COMMA:
                                         QUOTE,TWO,QUOTE,");"
          SFORMAT   VAR,127
          GOTO     EXTED100
.
EXTED900  MOVE     ZERO,DISINC
          MOVE     ZERO,DISCST  
          MOVE     ZERO,DISBED
          MOVE     ZERO,DISALS
          WRITE    HTMLFILE;"t.addRow(",QUOTE,"Too Many Records",QUOTE,COMMA:
                                         QUOTE,CCEDLV1,QUOTE,COMMA:
                                         QUOTE,CCEDNEP,QUOTE,COMMA:
                                         QUOTE,DISINC,QUOTE,COMMA:
                                         QUOTE,DISCST,QUOTE,COMMA:
                                         QUOTE,DISBED,QUOTE,COMMA:
                                         QUOTE,DISALS,QUOTE,COMMA:
                                         QUOTE,TWO,QUOTE,");"
EXTED999  RETURN
.
.----------------------------------------------------------------------
. Extract Level 3
.----------------------------------------------------------------------
EXTEE000  MOVE      ZERO,SECTOR
          PACK      KEY20,CEXTRKEY,SP70
          PACK      KEY30,KEY20,SP70
          CALL      RSCCEE1
EXTEE100  CALL      RKCCEE1
          BRANCH    OVRCD,EXTEE999
          PACK      KEY20,CCEELV1,CCEELV2,SP70
          MATCH     CEXTRKEY,KEY20
          GOTO      EXTEE999 IF NOT EQUAL
.
          ADD       ONE,SECTOR
          COMPARE   "100",SECTOR
          GOTO      EXTEE900 IF EQUAL
.
          PACK      KEY13,CCEALV3,CCEELV3,SP70
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      KEY13,CCXHDES
            MATCH     "~~~~~~~~~~",CCEELV3
            IF        @EQUAL
              MOVE      "Other",CCXHDES
            ENDIF
          ENDIF
.
          STRIP     CCXHDES
          MOVELPTR  CCXHDES,LENGTH
          SFORMAT   VAR,LENGTH
          MOVE      CCXHDES,VAR
          MOVE      CCEEFTC,DISINC
          MOVE      CCEETTC,DISCST  
          MOVE      CCEELTO,DISBED
          ASSIGN    CCEELTO/CCEENEP,DISALS
          WRITE     HTMLFILE;"t.addRow(",QUOTE,VAR,QUOTE,COMMA:
                                         QUOTE,CCEELV1,CCEELV2,CCEELV3,QUOTE,COMMA:
                                         QUOTE,CCEENEP,QUOTE,COMMA:
                                         QUOTE,DISINC,QUOTE,COMMA:
                                         QUOTE,DISCST,QUOTE,COMMA:
                                         QUOTE,DISBED,QUOTE,COMMA:
                                         QUOTE,DISALS,QUOTE,COMMA:
                                         QUOTE,THREE,QUOTE,");"
          SFORMAT   VAR,127
          GOTO     EXTEE100
.
EXTEE900  MOVE     ZERO,DISINC
          MOVE     ZERO,DISCST  
          MOVE     ZERO,DISBED
          MOVE     ZERO,DISALS
          WRITE    HTMLFILE;"t.addRow(",QUOTE,"Too Many Records",QUOTE,COMMA:
                                         QUOTE,CCEELV1,QUOTE,COMMA:
                                         QUOTE,CCEENEP,QUOTE,COMMA:
                                         QUOTE,DISINC,QUOTE,COMMA:
                                         QUOTE,DISCST,QUOTE,COMMA:
                                         QUOTE,DISBED,QUOTE,COMMA:
                                         QUOTE,DISALS,QUOTE,COMMA:
                                         QUOTE,THREE,QUOTE,");"
EXTEE999  RETURN
.
.
.------------------------------------------------------------
. Selection list of casemix type summary codes.
.-----------------------------------------------------------
SUMS0000  MOVE      CCXHSTY,SAVHSTY         * Save casemix type
          MOVE      CCXHKEY,SAVHKEY         * Save casemix code
          MOVE      CCXHSUM,SAVHSUM         * Save summary code
.
          MOVE      ZERO,F3                 * Add 200 to get summary code
          MOVE      CURRTYPE,F3
          ADD       TWOHUND,F3
          MOVE      F3,D3
.
          PACK      KEY13,D3,SP70
          CALL      RSCCXH1
SUMS1000  CALL      RKCCXH1  
          BRANCH    OVRCD,SUMS9000
.
          MATCH     D3,CCXHSTY
          GOTO      SUMS9000 IF NOT EQUAL
.
          MATCH     SAVHSUM,CCXHKEY
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",CCXHKEY,"#" selected>":
                               CCXHDES,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",CCXHKEY,"#">":
                               CCXHDES,"</option>"
          ENDIF
          GOTO      SUMS1000
.
SUMS9000  PACK      KEY13,SAVHSTY,SAVHKEY,SP70   * re-position on correct record
          CALL      RDCCXH1
          IF        OVRCD=1
            CALL      CLRCOD00    * Clear all the file variables
          ENDIF
.
SUMS9999  RETURN
.------------------------------------------------------------
. NOMORE00 - Display "No more records" at end of list
.------------------------------------------------------------
NOMORE00  WRITE     HTMLFILE;"<tr>":
                             "<td class=RedCell colspan=20 align=center>":
                             "No more records</td>"
.
NOMORE99  RETURN
+
.-----------------------------------------------------------------------------
. Close Files
.-----------------------------------------------------------------------------
CCSCOPCL  CLOSE    CCSCEBA1
          CLOSE    CCSCECA1
          CLOSE    CCSCECA2
          CLOSE    CCSCEDA1
          CLOSE    CCSCEEA1
          RETURN   
          

          INC       CCSAADIO/INC
          INC       CCSAGEIO/INC
          INC       CCSCEAIO/INC
          INC       CCSCEBIO/INC
          INC       CCSCECIO/INC
          INC       CCSCEDIO/INC
          INC       CCSCEEIO/INC
          INC       CCSIMCIO/INC
          INC       CCSSTYIO/INC
          INC       CCSTIMIO/INC
          INC       CCSWSEIO/INC
          INC       CCSXHDIO/INC
          INC       NAMSTRCD
          INC       IBAWEBCD
          INC       RSHWEBCD
          INC       PATMCHRD                * Miscellaneous Charges read routine

          INC       CCSCEXIO/INC
          INC       CCSEPSIO/INC
.
          INC       PATHSPIO/INC
          INC       PATMCHIO/INC            * Miscellaneous Charges file
          INC       PATWR1IO/INC

.******************************************************************************
.* System         : Accident and Emergency                                    *
.*                                                                            *
.* Include Name   : AAEDISDX.PBL                                              *
.*                                                                            *
.* Function       : Display variables for A&E discharges                      *
.*                                                                            *
.* Author         : Justin Coates      09/02/1993                             *
.*                                                                            *
.* ---- NOTE ---- : dont change FIELDNO in this or related includes           *
.*                                                                            *
.* Modifications  :                                                           *
.*        V5.09.B01 10/01/2001  Greg Horvat                                   *
.*                  Replaced DIM1A with KEY1                                  *
.*                  28/09/2000 Jill Habasque                                  *
.*                  Added ADAPRTY - Priority                                  *
.*                  09/08/1999  Davin                                         *
.*                  Removed references to constants (CATxx & CODExx)          *
.******************************************************************************
.*                  15/09/93   Whirlpool       SRF 125162                     *
.*                  Added display for U1 & A1 - A5                            *
.*                  20/09/1993    Justin 'The Pom' Coates  (DUDLEY changes)   *
.*                  added new fields and changed for new file layout          *
.*                  12/04/1994  Rob Leonard   Taranaki Mods (3.5.1)           *
.*                  Added display of AEDAPRTM - triage/priority time          *
.*                  20/09/1994  Max WHite     Taranaki Contract Mods          *
.*                  Added user defined fields AEDSUSR6, AEDSUSR7 & AEDSUSR8.  *
.*                  11/04/1996  Whirlpool      (NZ 5.04 Mods)                 *
.*                  Added claim code/chargeable status ADACOMP  (CL)          *
.*                  10/04/1997  Howellsy       SRF 642547                     *
.*                  Added PTVKCXMP - needed for claim code                    *
.******************************************************************************
AAEDISDX  MOVE      SCPSITM,FORM5
          PACK      VAR,SP30,SP30,SP20
          BRANCH    FORM5,DAEDS001,DAEDS002,DAEDS003,DAEDS004,DAEDS005:
                          DAEDS006,DAEDS007,DAEDS008,DAEDS009,DAEDS010:   10
                          DAEDS011,DAEDS012,DAEDS013,DAEDS014,DAEDS015:
                          DAEDS016,DAEDS017,DAEDS018,DAEDS019,DAEDS020:   20
                          DAEDS021,DAEDS022,DAEDS023,DAEDS024,DAEDS025:
                          DAEDS026,DAEDS027,DAEDS028,DAEDS029,DAEDS030:   30
                          DAEDS031,DAEDS032,DAEDS033,DAEDS034,DAEDS035:
                          DAEDS036,DAEDS037,DAEDS038,DAEDS039,DAEDS040:   40
                          DAEDS041,DAEDS042,DAEDS043,DAEDS044,DAEDS045:
                          DAEDS046,DAEDS047,DAEDS048,DAEDS049,DAEDS050:   50
                          DAEDS051,DAEDS052,DAEDS053,DAEDS054,DAEDS055:
                          DAEDS056,DAEDS057,DAEDS058,DAEDS059,DAEDS060:   60
                          DAEDS061,DAEDS062,DAEDS063,DAEDS064,DAEDS065:
                          DAEDS066,DAEDS067,DAEDS068                      70
          GOTO      DAEDS999
.
. date actually seen
.
DAEDS001  UNPACK    ADASDTE,CCENT,CYEAR,CMON,CDAY
          CALL      DAEDSDAT
          GOTO      DAEDS995
.
. time actually seen
.
DAEDS002  PACK      VAR,ADASEEN,SP30,SP30,SP20
          GOTO      DAEDS995
.
. waiting time
.
DAEDS003  PACK      VAR,ADADURN,SP30,SP30,SP20
          GOTO      DAEDS995
.
. doctor allocated
.
DAEDS004  PACK      VAR,ADADOCT,SP30,SP30,SP20
          GOTO      DAEDS995
DAEDS005  MOVE      ADADOCT,KEY6
          CALL      DXPATDOC
          GOTO      DAEDS999
.
. discharge date
.
DAEDS006  UNPACK    ADSDATE,CCENT,CYEAR,CMON,CDAY
          CALL      DAEDSDAT
          GOTO      DAEDS995
.
. discharge time
.
DAEDS007  PACK      VAR,ADSTIME,SP30,SP30,SP20
          GOTO      DAEDS995
.
. assesment
.
DAEDS008  PACK      VAR,ADSSSES,SP30,SP30,SP20
          GOTO      DAEDS995
.
. situation
.
DAEDS009  PACK      VAR,ADASIT,SP30,SP30,SP20
          GOTO      DAEDS995
DAEDS010  PACK      TCODE,ANSE,ANSS
          MOVE      ADASIT,ACODE
          CALL      DXPATCOD
          GOTO      DAEDS999
.
. completion code
.
DAEDS011  PACK      VAR,ADAWAIT,SP30,SP30,SP20
          GOTO      DAEDS995
DAEDS012  PACK      TCODE,ANSE,ANSW
          MOVE      ADAWAIT,ACODE
          CALL      DXPATCOD
          GOTO      DAEDS999
.
. discharge status
.
DAEDS013  MOVE      SP1,TCINDC1
          PACK      KEY5,ANSE,ANSD,ADSDISC
          CALL      RDCODE1
          MOVE      TCINDC1,IND1ED          * set up indicator
          PACK      VAR,ADSDISC,SP30,SP30,SP20
          GOTO      DAEDS995
DAEDS014  PACK      TCODE,ANSE,ANSD
          MOVE      ADSDISC,ACODE
          CALL      DXPATCOD
          GOTO      DAEDS999
.
. free format diagnosis
.
DAEDS015  PACK      VAR,ADSDIAG,SP30,SP30,SP20
          GOTO      DAEDS995
.
. coded diagnosis - I
.
DAEDS016  UNPACK    ADSDIAG,KEY1,DIM2B,DIM2C,DIM2D
          PACK      VAR,KEY1,SP30,SP30,SP20
          GOTO      DAEDS995
DAEDS017  MOVE      ADSDIAG,KEY1
          OPEN      AAEDG1A1,"aaedg1af"
          PACK      AED1DESC,SP20,SP20
          PACK      KEY2,KEY1,SP1
          CALL      RDAEDG11                * Check for a valid code
          CLOSE     AAEDG1A1
          PACK      VAR,AED1DESC,SP30,SP30,SP20
          GOTO      DAEDS995
.
. coded diagnosis - II
.
DAEDS018  UNPACK    ADSDIAG,KEY1,DIM2B,DIM2C,DIM2D
          PACK      VAR,DIM2B,SP30,SP30,SP20
          GOTO      DAEDS995
DAEDS019  UNPACK    ADSDIAG,KEY1,DIM2B,DIM2C,DIM2D
          OPEN      AAEDG2A1,"aaedg2af"
          PACK      KEY3,AED1BOX1,DIM2B
          PACK      AED2DESC,SP20,SP20
          CALL      RDAEDG21                   * Check for a valid code
          CLOSE     AAEDG2A1
          PACK      VAR,AED2DESC,SP30,SP30,SP20
          GOTO      DAEDS995
.
. coded diagnosis - III
.
DAEDS020  UNPACK    ADSDIAG,KEY1,DIM2B,DIM2C,DIM2D
          PACK      VAR,DIM2C,SP30,SP30,SP20
          GOTO      DAEDS995
DAEDS021  UNPACK    ADSDIAG,KEY1,DIM2B,DIM2C,DIM2D
          OPEN      AAEDG3A1,"aaedg3af"
          PACK      KEY3,AED2BOX2,DIM2C
          PACK      AED3DESC,SP20,SP20
          CALL      RDAEDG31                   * Check for a valid code
          CLOSE     AAEDG3A1
          PACK      VAR,AED3DESC,SP30,SP30,SP20
          GOTO      DAEDS995
.
. coded diagnosis - IV
.
DAEDS022  UNPACK    ADSDIAG,KEY1,DIM2B,DIM2C,DIM2D
          PACK      VAR,DIM2D,SP30,SP30,SP20
          GOTO      DAEDS995
DAEDS023  UNPACK    ADSDIAG,KEY1,DIM2B,DIM2C,DIM2D
          OPEN      AAEASSA1,"aaeassaf"
          PACK      KEY3,AED3BOX3,DIM2D
          PACK      AED4DESC,SP20,SP20
          CALL      RDAEASS1                   * Check for a valid code
          CLOSE     AAEASSA1
          PACK      VAR,AED4DESC,SP30,SP30,SP20
          GOTO      DAEDS995
.
.  Consultation Time
.
DAEDS024  PROC      CCTIM000                   * Calculate Cons. Time
          PACK      VAR,FORM4,SP30,SP30,SP20
          GOTO      DAEDS995
.
.  Initial Diagnosis
.
DAEDS025  PACK      VAR,ADADIAG,SP30,SP30,SP20
          GOTO      DAEDS995
.
.  Arrival Date
.
DAEDS026  UNPACK    ADADATE,CCENT,CYEAR,CMON,CDAY
          CALL      DAEDSDAT
          GOTO      DAEDS995
.
.  Arrival Time
.
DAEDS027  PACK      VAR,ADATIME,SP30,SP30,SP20
          GOTO      DAEDS995
.
. User defined field 1    
.
DAEDS028  PACK      VAR,ADAUSR1,SP30,SP30,SP20
          GOTO      DAEDS995
DAEDS029  MOVE      "A1",TCODE
          MOVE      ADAUSR1,ACODE
          CALL      DXPATCOD
          GOTO      DAEDS999
.
. User defined field 2    
.
DAEDS030  PACK      VAR,ADAUSR2,SP30,SP30,SP20
          GOTO      DAEDS995
DAEDS031  MOVE      "A2",TCODE
          MOVE      ADAUSR2,ACODE
          CALL      DXPATCOD
          GOTO      DAEDS999
.
. User defined field 3      
.
DAEDS032  PACK      VAR,ADAUSR3,SP30,SP30,SP20
          GOTO      DAEDS995
DAEDS033  MOVE      "A3",TCODE
          MOVE      ADAUSR3,ACODE
          CALL      DXPATCOD
          GOTO      DAEDS999
.
. User defined field 4      
.
DAEDS034  PACK      VAR,ADAUSR4,SP30,SP30,SP20
          GOTO      DAEDS995
DAEDS035  MOVE      "A4",TCODE
          MOVE      ADAUSR4,ACODE
          CALL      DXPATCOD
          GOTO      DAEDS999
.
. User defined field 5   
.
DAEDS036  PACK      VAR,ADAUSR5,SP30,SP30,SP20
          GOTO      DAEDS995
DAEDS037  MOVE      "A5",TCODE
          MOVE      ADAUSR5,ACODE
          CALL      DXPATCOD
          GOTO      DAEDS999
.
. Insurance status ? - Cat U1
.
DAEDS038  PACK      VAR,ADAINSUR,SP30,SP30,SP20
          GOTO      DAEDS995
DAEDS039  MOVE      "U1",TCODE
          MOVE      ADAINSUR,ACODE
          CALL      DXPATCOD
          GOTO      DAEDS999
.
. consultant on take
.
DAEDS040  PACK      VAR,AEDACONS,SP70,SP10             * consultant on take
          GOTO      DAEDS995
.
DAEDS041  MOVE      AEDACONS,KEY6
          CALL      DXPATDOC
          GOTO      DAEDS999
.
.  initial assessment date
.
DAEDS042  UNPACK    AEDADIAS,CCENT,CYEAR,CMON,CDAY
          CALL      DAEDSDAT
          GOTO      DAEDS995
.
.  initial assessment time
.
DAEDS043  PACK      VAR,AEDATIAS,SP30,SP30,SP20
          GOTO      DAEDS995
.
.  called for treatment date
.
DAEDS044  UNPACK    AEDSDCFT,CCENT,CYEAR,CMON,CDAY
          CALL      DAEDSDAT
          GOTO      DAEDS995
.
.  called for treatment time
.
DAEDS045  PACK      VAR,AEDSTCFT,SP30,SP30,SP20
          GOTO      DAEDS995
.
.  conclusion date
.
DAEDS046  UNPACK    AEDSDCON,CCENT,CYEAR,CMON,CDAY
          CALL      DAEDSDAT
          GOTO      DAEDS995
.
.  conclusion time
.
DAEDS047  PACK      VAR,AEDSTCON,SP30,SP30,SP20
          GOTO      DAEDS995
.
.  decision to admit date
.
DAEDS048  UNPACK    AEDSDDTA,CCENT,CYEAR,CMON,CDAY
          CALL      DAEDSDAT
          GOTO      DAEDS995
.
.  decision to admit time
.
DAEDS049  PACK      VAR,AEDADTAT,SP30,SP30,SP20
          GOTO      DAEDS995
.
.  admission date
.
DAEDS050  UNPACK    AEDSDADM,CCENT,CYEAR,CMON,CDAY
          CALL      DAEDSDAT
          GOTO      DAEDS995
.
.  admission time
.
DAEDS051  PACK      VAR,AEDSTADM,SP30,SP30,SP20
          GOTO      DAEDS995
.
. doctor allocated - A&E only
.
DAEDS052  PACK      VAR,ADADOCT,SP30,SP30,SP20
          GOTO      DAEDS995
DAEDS053  MOVE      ADADOCT,KEY6
          CALL      DXPATDOC
          GOTO      DAEDS999
.
DAEDS054  PACK      VAR,AEDAPRTM,SP30,SP30,SP20
          GOTO      DAEDS995
.
. User defined field 6 - Cat A6
.
DAEDS055  PACK      VAR,AEDSUSR6,SP30,SP30,SP20
          GOTO      DAEDS995
DAEDS056  MOVE      "A6",TCODE
          MOVE      AEDSUSR6,ACODE
          CALL      DXPATCOD
          GOTO      DAEDS999
.
. User defined field 7 - Cat A7
.
DAEDS057  PACK      VAR,AEDSUSR7,SP30,SP30,SP20
          GOTO      DAEDS995
DAEDS058  MOVE      "A7",TCODE
          MOVE      AEDSUSR7,ACODE
          CALL      DXPATCOD
          GOTO      DAEDS999
.
. User defined field 8 - Cat A8
.
DAEDS059  PACK      VAR,AEDSUSR8,SP30,SP30,SP20
          GOTO      DAEDS995
DAEDS060  MOVE      "A8",TCODE
          MOVE      AEDSUSR8,ACODE
          CALL      DXPATCOD
          GOTO      DAEDS999
.
DAEDS061  PACK      VAR,AEDSOPER,SP70,SP10    * security code         
          GOTO      DAEDS995
.
DAEDS062  MOVE      SP70,SECUSER
          MATCH     SP4,AEDSOPER
          IF        !@EQUAL
            CALL      OPPASS1
            PACK      KEY4,AEDSOPER,SP6
            CALL      RDPASS1  
          ENDIF
          PACK      VAR,SECUSER,SP70,SP10
          GOTO      DAEDS995
.
DAEDS063  PACK      VAR,ADACOMP,SP30,SP30,SP20
          GOTO      DAEDS995
DAEDS064  MOVE      "CL",TCODE
          MOVE      ADACOMP,ACODE
          CALL      DXPATCOD
          GOTO      DAEDS999
.
DAEDS065  PACK      VAR,PTVKCXMP,SP30,SP30,SP20
          GOTO      DAEDS995
.
DAEDS066  PACK      TCODE,ANSX,ANSM
          MOVE      PTVKCXMP,ACODE
          CALL      DXPATCOD
          GOTO      DAEDS999
.
DAEDS067  PACK      VAR,ADAPRTY,SP70
          GOTO      DAEDS995
.
DAEDS068  MOVE      "AA",TCODE
          MOVE      ADAPRTY,ACODE
          CALL      DXPATCOD
          GOTO      DAEDS999
.
DAEDS995  CALL      DISPITEM
DAEDS999  RETURN
+
.*********************************************************************
.         set up for a date
.*********************************************************************
DAEDSDAT  CALL      PACDATE
          IF        SCPSLEN = EIGHT
            PACK      VAR,CPDATE,SP30,SP30,SP20
          ELSE
            PACK      VAR,CPCDATE,SP30,SP30,SP20
          ENDIF
          RETURN
+
.*********************************************************************
.         calculate time waiting
.*********************************************************************
          DEFPROC   CCTIM000           * Calculate duration OF CONSULTATION
.
FORM5E    FORM      5
.
CALSDUR   UNPACK    ADADATE WITH CCENT,CYEAR,CMON,CDAY
          UNPACK    ADASEEN WITH CHOUR,ANS,CMIN
          MOVE      CHOUR,IHOUR
          MOVE      IHOUR,FORM4
          MULT      "60",FORM4
          MOVE      CMIN,IMIN
          ADD       IMIN,FORM4                      * Start time in minutes
.
          UNPACK    ADSTIME WITH CHOUR,ANS,CMIN
          MOVE      CHOUR,IHOUR
          MOVE      IHOUR,FORM5E
          MULT      "60",FORM5E
          MOVE      CMIN,IMIN
          ADD       IMIN,FORM5E                     * End time in minutes
.
          SUB       FORM4,FORM5E                  * duration in minutes
.
          MOVE      ZERO,FORM4                    * initialise ADADURN
.
NEXTDY    COMPARE   ZERO,FORM5E                     * negative duration ?
          GOTO      DSPSDUR IF NOT LESS             * On same day
.
          ADD       "1440",FORM5E                   * Next day
          GOTO      NEXTDY
.
DSPSDUR   MOVE      FORM5E,FORM4
          ENDPROC
+

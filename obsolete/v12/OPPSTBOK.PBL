.******************************************************************************
.* System         : Theatre System                                            *
.* Include name   : OPPSTBOK.PBL                                              *
.* Description    : Post the booking details to the BOKRC1FD                  *
.******************************************************************************
.* Date           : 08/11/1990                                                *
.* Author         : Paul Marshall                                             *
.* Function       : Post the booking details to the BOKRC1FD file.            *
.******************************************************************************
.* Parameters     : Booking details                                           *
.*                  Booking number                                            *
.*                  OPCNDFAD      Sector 42 Position 92                       *
.*                  SURINCH       the surgeon in charge of session            *
.******************************************************************************
.* Returns        : EXIT = 1      booking record already exists               *
.******************************************************************************
.* Modifications  :                                                           *
.* V10.01.01 02/02/2011  Steve Armstrong   CAR 237520                         *
.*           Mods to remove Detente interface (PATDETNT)                      *
.******************************************************************************
.* V9.03.01  10/10/2003  Sandra Barcham     43422                             *
.*           Added write to bokrx1af when writing bokrecaf                    *
.******************************************************************************
.* V5.08.00  17/08/2000  Jill Habasque                                        *
.*           Detente mods - added call to PATDETNT                            *
.*           18/02/91 Graeme Williams                                         *
.*           Added the booking date audit file (BOKBUDFD)                     *
.*           15/10/1991    Justin Coates                                      *
.*           Check if to default attending doctor to surgeon in charge        *
.*           25/10/92 J.Tan  SRF 117585                                       *
.*           Added a system parameter for booking date audit file             *
.*           13/01/93 J.Tan  SRF 119861                                       *
.*           Changed the indicator for booking date audit                     *
.*           11/04/1993  Graeme Williams                                      *
.*           Write to CONRUDFD file if using contracting                      *
.*           06/07/1994  Rob Leonard  SRF 440935                              *
.*           Set episode number to one not zero for contracting               *
.*           05/10/1995  MATT                                                 *
.*           Changed CONTROLF Def to SFILE                                    *
.******************************************************************************
OPPSTBOK  PACK      KEY8,BKREBOOK
          CALL      RABKREC1
          BRANCH    OVRCD,OPOSB200
          GOTO      OPOSB900
.
OPOSB200  CALL      IBACLOCK
          PACK      BKREADAT,CCC,CYY,CMM,CDD
          REP       " 0",BKREADAT           * date of booking
.
.         see if to default attending doctor to surgeon in charge
.
          COMPARE   ONE,OPCNDFAD
          GOTO      OPOSB400 IF NOT EQUAL   * not using default att. doc
.
          MATCH     SP6,BKREADOC
          GOTO      OPOSB400 IF NOT EQUAL   * doctor entered
.
          MOVE      SURINCH,BKREADOC        * set up attending doctor
.
OPOSB400  CALL      WRBKREC1                * write record to booking file
          CALL      CLBOKRX1
          MOVE      BKREBOOK,BKRXBNUM
          CALL      WRBKRX11
.
          COMPARE   ONE,OPCNBKBD
          GOTO      OPOSB460 IF NOT EQUAL   * no booking date audit
          OPEN      BOKBUDA1,"bokbudaf"     * open booking date audit file
          CALL      RABKBUD1                * see if record exists
          COMPARE   ZERO,OVRCD
          GOTO      OPOSB450 IF EQUAL       * record exist
.
          CALL      WRBKBUD1                * write to booking date audit file
.
OPOSB450  CLOSE     BOKBUDA1
.
.
OPOSB460  
.
          MOVE      ZERO,EXIT
          GOTO      OPOSB999
.
OPOSB900  MOVE      ONE,EXIT                * booking already exists
.
OPOSB999  RETURN
...............................................................................

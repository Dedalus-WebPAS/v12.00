.-------------------------------------------------------------------------------
.   System    :   FMS Accounting System  
.                           
.   Program   :   FMSONCFM 
.                            
.   Routines  :   KONCFM00 Keyin On Cost Code   - Returns a valid record
.                 AONCFM00 Accept On Cost Code  - Returns a key NOT on file
.   
.   Return    :   EXIT = 1 null entry EXIT = 2 EXITCHAR entered
.
.   Internal  :   HFMONA00 Help Display for On Cost Code  
.                            
.   Redisplay :   RONCFM00 Screen Redisplay Called for On Cost Code  
.-------------------------------------------------------------------------------
.   Mods      :    
.-------------------------------------------------------------------------------
. Normal Code Keyin - Code Must Exist Exit = 1 if Null Entry
.-------------------------------------------------------------------------------
KONCFM00  MOVE      UNDLN70,FMONCODE
          KEYIN     *PCCOL:CVERT,*EL,*DV,FMONCODE:
                    *PCCOL:CVERT,*V2LON,FMONCODE: 
                    *PCCOL:CVERT,*EL,*DV,FMONCODE
.
          ENDSET    FMONCODE
          APPEND    SP70,FMONCODE
          RESET     FMONCODE
          MATCH     SP70,FMONCODE             * System Code Spaces so exit set
          GOTO      KONCFM90 IF EQUAL
.
          CMATCH    EXITCHAR,FMONCODE         * Exit Selected
          GOTO      KONCFM95 IF EQUAL
.
          CMATCH    QUEST,FMONCODE            * Help Required  
          GOTO      KONCFM10 IF NOT EQUAL
          CALL      HFMONA00                  * Display List Of FMONCODEs
          PACK      CDATASAV,FMONCODE,SP70    * save data
          CALL      RONCFM00                  * Redisplay Routine
          PACK      FMONCODE,CDATASAV,SP70    * restore data
.
          ENDSET    FMONCODE
          APPEND    SP70,FMONCODE
          RESET     FMONCODE
          MATCH     SP70,FMONCODE             * System Code Spaces so exit set
          GOTO      KONCFM00 IF EQUAL
.
KONCFM10  PACK      KEY3,FMONCODE
          CALL      RDFMON1                                   
          BRANCH    OVRCD,KONCFM80
          MOVE      ZERO,EXIT                 * no entry so exit is set
          GOTO      KONCFM99
.
KONCFM80  DISPLAY   *P1:24,*EL,*B,"On Cost Code Does Not Exist - ";
          CALL      HITENTER
          GOTO      KONCFM00
.
KONCFM90  MOVE      ONE,EXIT                  * null entry so exit is set
          GOTO      KONCFM99
.
KONCFM95  MOVE      TWO,EXIT                  * Exit character entered    
.
KONCFM99  RETURN
.-------------------------------------------------------------------------------
. Accept Code Keyin - Code Must Not Exist 
.-------------------------------------------------------------------------------
AONCFM00  MOVE      UNDLN70,FMONCODE
          KEYIN     *PCCOL:CVERT,*EL,*DV,FMONCODE:
                    *PCCOL:CVERT,*V2LON,FMONCODE: 
                    *PCCOL:CVERT,*EL,*DV,FMONCODE
.
          ENDSET    FMONCODE
          APPEND    SP70,FMONCODE
          RESET     FMONCODE
          MATCH     SP70,FMONCODE             * System Code Spaces so exit set
          GOTO      AONCFM90 IF EQUAL
.
          CMATCH    EXITCHAR,FMONCODE         * Exit Selected
          GOTO      AONCFM95 IF EQUAL
.
          CMATCH    QUEST,FMONCODE            * Help Required  
          GOTO      AONCFM10 IF NOT EQUAL
          CALL      HFMONA00                  * Display List Of FMONCODEs
          PACK      CDATASAV,FMONCODE,SP70    * save data
          CALL      RONCFM00                  * Redisplay Routine
          PACK      FMONCODE,CDATASAV,SP70    * restore data
.
          ENDSET    FMONCODE
          APPEND    SP70,FMONCODE
          RESET     FMONCODE
          MATCH     SP70,FMONCODE             * System Code Spaces so exit set
          GOTO      AONCFM00 IF EQUAL
.
AONCFM10  PACK      KEY3,FMONCODE
          MOVE      ZERO,EXIT                 * no entry so exit is set
          CALL      RDFMON1                                   
          BRANCH    OVRCD,AONCFM99
.
          DISPLAY   *P1:24,*EL,*B,"On Cost Code Already Exists - ";
          CALL      HITENTER
          GOTO      AONCFM00
.
AONCFM90  MOVE      ONE,EXIT                  * null entry so exit is set
          GOTO      AONCFM99
.
AONCFM95  MOVE      TWO,EXIT                  * Exit character entered    
.
AONCFM99  RETURN
.------------------------------------------------------------------------------
. Display List of All Codes
.------------------------------------------------------------------------------
HFMONA00
          MOVE      ZERO,CSCRSIZ
          IF        HTOP<3
            MOVE      "12",HTOP
            MOVE      "24",HBOT
            MOVE      "40",HLEF
            MOVE      "80",HRIG
          ENDIF
HFMONA04
          CALL      GSCRN000
          BRANCH    EXIT,HFMONA99
          MOVE      STDCOL00,STDCOL01
          ADD       " 5",STDCOL01
          DISPLAY   *PSTDCOL01:STDROW,*V2LON,*ULON,"Code"             
.
          MOVE      STDCOL01,STDCOL02
          ADD       " 7",STDCOL02
          DISPLAY   *PSTDCOL02:STDROW,*V2LON,*ULON,"Description"        
.
          MOVE      STDCOL02,STDCOL03 
          ADD       "36",STDCOL03
          DISPLAY   *PSTDCOL03:STDROW,*V2LON,*ULON,"Percentage"        
          MOVE      STDCOL03,STDCOL04
          ADD       " 9",STDCOL03
HFMONA08
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          MOVE      SP70,FMONCODE
          PACK      KEY3,FMONCODE,SP70                                          
.                                                                               
.                                                                               
          CALL      RSFMON1 
HFMONA10
          CALL      RKFMON1 
          BRANCH    OVRCD,HFMONA15
          PACK      KEY3,FMONCODE,SP70                                          
.                                                                               
.                                                                               
          BRANCH    CSEARCH,HFMONA12
          CALL      HFMONA60
          BRANCH    OVRCD,HFMONA10
HFMONA12
          ADD       ONE,XITEMNO
          ADD       ONE,STDROW
          STORE     KEY3,XITEMNO,ST1,ST2,ST3,ST4,ST5:                            
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          DISPLAY   *PSTDCOL00:STDROW,SP1,*V2LON,XITEMNO,DOT
          DISPLAY   *PSTDCOL01:STDROW,FMONCODE
          DISPLAY   *PSTDCOL02:STDROW,FMONDESC
          DISPLAY   *PSTDCOL03:STDROW,FMONPERC
          COMPARE   MAXITEM,XITEMNO
          GOTO      HFMONA10 IF NOT EQUAL
HFMONA15
.                                                                               
          MOVE      ONE,DITEM
          MOVE      MINITEM,DROW
          ADD       ONE,DROW
          DISPLAY   *PSTDCOL00:DROW,*V2LON,*HON,SP1,DITEM,DOT
          CLIP
          FLUSH     HLEF,HTOP,HRIG,HBOT
.
HFMONA20
          CALL      HSCRI000
          BRANCH    EXIT,HFMONA30,HFMONA35,HFMONA40,HFMONA45,HFMONA04:
                              HFMONA91,HFMONA50
          GOTO      HFMONA92
HFMONA30
          CALL      RKFMON1 
          BRANCH    OVRCD,HFMONA85
          PACK      KEY3,FMONCODE,SP70                                          
.                                                                               
.                                                                               
          CALL      RPFMON1 
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMONA10
HFMONA35
          MOVE      ST1,KEY3 
          CALL      RDFMON1 
          CALL      RPFMON1 
          BRANCH    OVRCD,HFMONA85
          PACK      KEY3,FMONCODE,SP70                                          
.                                                                               
.                                                                               
.                                                                               
.                                                                               
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
HFMONA36
          CALL      RPFMON1 
          BRANCH    OVRCD,HFMONA37
          PACK      KEY3,FMONCODE,SP70                                          
.                                                                               
.                                                                               
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HFMONA36 IF NOT EQUAL
HFMONA37
          MOVE      ZERO,XITEMNO
          GOTO      HFMONA10
HFMONA40
          MOVE      ST1,KEY3 
          CALL      RDFMON1 
          CALL      RPFMON1 
          BRANCH    OVRCD,HFMONA85
          PACK      KEY3,FMONCODE,SP70                                          
.                                                                               
.                                                                               
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMONA08
HFMONA45
          CALL      RKFMON1 
          BRANCH    OVRCD,HFMONA85
          PACK      KEY3,FMONCODE,SP70                                          
.                                                                               
.                                                                               
          SUSPEND
          CLIP      1,1,CRIG,24
.
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      ZERO,XITEMNO
          PACK      KEY3,Z70                                                    
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
          CALL      RSFMON1 
HFMONA46
          CALL      RPFMON1 
          BRANCH    OVRCD,HFMONA47
          PACK      KEY3,FMONCODE,SP70                                          
.                                                                               
.                                                                               
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HFMONA46 IF NOT EQUAL
HFMONA47
          MOVE      ZERO,XITEMNO
          GOTO      HFMONA10
HFMONA50  COMPARE   ZERO,CSEARCH
          GOTO      HFMONA55 IF EQUAL
          MOVE      ZERO,CSEARCH
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          ADD       ONE,STDROW
          UNPACK    SP70,SCHFLD01,SCHFLD02,SCHFLD03,SCHFLD04,SCHFLD05
          UNPACK    SP70,SCHFLD06,SCHFLD07,SCHFLD08,SCHFLD09,SCHFLD10
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          DISPLAY   *PSTDCOL00:STDROW,*V2LON,*HON,"Sch"
          KEYIN     *PSTDCOL01:STDROW,*V2LON,SCHFLD01
          RESET     SCHFLD01
          KEYIN     *PSTDCOL02:STDROW,*V2LON,SCHFLD02
          RESET     SCHFLD02
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMONA08
HFMONA55  MOVE      ONE,CSEARCH
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMONA08
HFMONA60  MOVE      ZERO,OVRCD
          MATCH     SP70,SCHFLD01
          GOTO      HFMONA61 IF EQUAL
          MATCH     SCHFLD01,FMONCODE
          GOTO      HFMONA72 IF NOT EQUAL
HFMONA61
          MATCH     SP70,SCHFLD02
          GOTO      HFMONA62 IF EQUAL
          MATCH     SCHFLD02,FMONDESC
          GOTO      HFMONA72 IF NOT EQUAL
HFMONA62
HFMONA63
HFMONA64
HFMONA65
HFMONA66
HFMONA67
HFMONA68
HFMONA69
HFMONA70
          GOTO      HFMONA75
HFMONA72  MOVE      ONE,OVRCD
HFMONA75  RETURN
HFMONA85
          LOAD      KEY3,XITEMNO,ST1,ST2,ST3,ST4,ST5:                            
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY3,FMONCODE                                               
          CALL      RDFMON1 
HFMONA90
.                                                                               
          BEEP
          GOTO      HFMONA20
HFMONA91
          MOVE      SP70,FMONDESC
          MOVE      SP70,FMONSPAR
          MOVE      SP70,KEY3 
          MOVE      SP70,FMONCODE
          MOVE      ZERO,FMONPERC
          GOTO      HFMONA96
HFMONA92
          MOVE      SP70,KEY3 
          MOVE      SP70,FMONCODE
          LOAD      KEY3,CCITEM,ST1,ST2,ST3,ST4,ST5:                            
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY3,FMONCODE                                               
HFMONA96
          PUTSCR    CSSCRNUM,HLEF,HTOP,HRIG,HBOT
          CALL      FRESCR00
          MOVE      ZERO,HTOP
          MOVE      ZERO,HLEF
          MOVE      ZERO,HBOT
          MOVE      ZERO,HRIG
HFMONA99
          RETURN

.-----------------------------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.00.00"
.-------------------------------------------------------
. V9.02.00  03.05.2002  Glenn Saunders
.           Export to new release i.e. v9.02 from vf.09
.-----------------------------------------------------------------------------
. VF.09.01  28.02.2002  Glenn Saunders   srf 15126
.           Re-compile for changes in DEBDKIKY
.-----------------------------------------------------------------------------
. VF.01.00  06.03.2000 Charles Handaya
.           Add in Standard Export File  srf 638148
.-----------------------------------------------------------------------------
. VF.00.01  12.04.1999 Sandra Barcham
.           Stop report only printing zero values
.           srf 631084
.-----------------------------------------------------------------------------
EXPORTFL  FILE      ASCII, FIXED=400     * Export File (Adjust Length to Suit)
EXPORTFN  DIM       8                    * Export File Name
TABDELM   EQU       0x09                 * Tab Delimiter
.
DEPTOTFL  FORM      1       * Department Totals Flag
DEQTYLAS  FORM      12.2
DEQTYPER  FORM      12.2    * Department Totals
DEQTYYTD  FORM      12.2
DETOTLAS  FORM      12.2
DETOTPER  FORM      12.2
DETOTYTD  FORM      12.2
DEPTCODE  DIM       8
DEPTDESC  DIM       35
FALLDEP   FORM      1
FALLITM   FORM      1
FALLNAM   FORM      1
FALLPTY   FORM      1
ENDDAT    DIM       8
ENDDEP    DIM       8
ENDITM    DIM       8
ENDNAM    DIM       35
ENDPTY    DIM       8
LASQTY    DIM       13
LASTOT    DIM       18
PERQTY    DIM       13
PERTOT    DIM       18
PTQTYLAS  FORM      12.2
PTQTYPER  FORM      12.2    * Product type Totals
PTQTYYTD  FORM      12.2
PTTOTLAS  FORM      12.2
PTTOTPER  FORM      12.2
PTTOTYTD  FORM      12.2
QTYLAS    FORM      12.2
QTYPER    FORM      12.2    * Sales Item Totals
QTYYTD    FORM      12.2
REQTYLAS  FORM      12.2
REQTYPER  FORM      12.2    * Report Totals
REQTYYTD  FORM      12.2
RETOTLAS  FORM      12.2
RETOTPER  FORM      12.2
RETOTYTD  FORM      12.2
SLITSTS   DIM       8
STARTLAS  DIM       8
STRDAT    DIM       8
STRDEP    DIM       8
STRITM    DIM       8
STRNAM    DIM       35
STRPTY    DIM       8
TOTLAS    FORM      12.2
TOTPER    FORM      12.2
TOTYTD    FORM      12.2
YTDQTY    DIM       13
YTDTOT    DIM       18
.-----------------------------------------------------------------------------
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBADEB63
.   Function      :   Item Sales Analysis                     
.   Generated  On :   13/12/2005
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       DEBCODFD/INC
          INC       DEBCONFD/INC
          INC       DEBDBTFD/INC
          INC       DEBDEPFD/INC
          INC       DEBDKIFD/INC
          INC       DEBFDTFD/INC
          INC       DEBITMFD/INC
          INC       DEBOUTDF    
          INC       DEBPTYFD/INC
.=========================
.Local Variable Definition
.-------------------------
FROMNAM   DIM      40 * Scr 00 Fld     4
TONAM     DIM      40 * Scr 00 Fld     5
FROMDEP   DIM      40 * Scr 00 Fld     6
TODEP     DIM      40 * Scr 00 Fld     7
FROMPTY   DIM      40 * Scr 00 Fld     8
TOPTY     DIM      40 * Scr 00 Fld     9
REPTSEQ   FORM      1 * Scr 00 Fld    10
SEQDESC   DIM      30 * Scr 00 Fld    11
FROMITM   DIM      40 * Scr 00 Fld    12
TOITM     DIM      40 * Scr 00 Fld    13
STARTYRR  DIM       8 * Scr 00 Fld    14
REPTACT   FORM      1 * Scr 00 Fld    15
FROMDAT   DIM      10 * Scr 00 Fld    16
TODAT     DIM      10 * Scr 00 Fld    17
EXPORTYN  FORM      1 * Scr 00 Fld    18
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBADEB63"
PRGNAM    INIT      "Item Sales Analysis                     "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          MOVE      PORT,PARENTID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      SC00L000
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          MOVE      "   81",AUDTSECT
          MOVE      "  9",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening debaudcd";
            OPEN      DEBAUDCD,"debaudcd"
          ENDIF
          MOVE      "   81",AUDTSECT
          MOVE      " 10",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening debauddb";
            OPEN      DEBAUDDB,"debauddb"
          ENDIF
          MOVE      "   81",AUDTSECT
          MOVE      " 11",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening debaudde";
            OPEN      DEBAUDDE,"debaudde"
          ENDIF
          MOVE      "   81",AUDTSECT
          MOVE      " 12",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening debaudit";
            OPEN      DEBAUDIT,"debaudit"
          ENDIF
          MOVE      "   81",AUDTSECT
          MOVE      " 13",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening debaudpt";
            OPEN      DEBAUDPT,"debaudpt"
          ENDIF
          DISPLAY   *P56:24,"Opening debcodaf";
          OPEN      DEBCODA1,"debcodaf"
          DISPLAY   *P56:24,"Opening debcodaf";
          OPEN      DEBCODA2,"debcodaf"
          DISPLAY   *P56:24,"Opening debdbtaf";
          OPEN      DEBDBTA1,"debdbtaf"
          DISPLAY   *P56:24,"Opening debdbtaf";
          OPEN      DEBDBTA2,"debdbtaf"
          DISPLAY   *P56:24,"Opening debdbtaf";
          OPEN      DEBDBTA3,"debdbtaf"
          DISPLAY   *P56:24,"Opening debdbtaf";
          OPEN      DEBDBTA4,"debdbtaf"
          DISPLAY   *P56:24,"Opening debdepaf";
          OPEN      DEBDEPA1,"debdepaf"
          DISPLAY   *P56:24,"Opening debdepaf";
          OPEN      DEBDEPA2,"debdepaf"
          DISPLAY   *P56:24,"Opening debdkiaf";
          OPEN      DEBDKIA1,"debdkiaf"
          DISPLAY   *P56:24,"Opening debdkiaf";
          OPEN      DEBDKIA2,"debdkiaf"
          DISPLAY   *P56:24,"Opening debfdtaf";
          OPEN      DEBFDTA1,"debfdtaf"
          DISPLAY   *P56:24,"Opening debfdtaf";
          OPEN      DEBFDTA2,"debfdtaf"
          DISPLAY   *P56:24,"Opening debfdtaf";
          OPEN      DEBFDTA3,"debfdtaf"
          DISPLAY   *P56:24,"Opening debfdtaf";
          OPEN      DEBFDTA4,"debfdtaf"
          DISPLAY   *P56:24,"Opening debfdtaf";
          OPEN      DEBFDTA5,"debfdtaf"
          DISPLAY   *P56:24,"Opening debfdtaf";
          OPEN      DEBFDTA6,"debfdtaf"
          DISPLAY   *P56:24,"Opening debfdtaf";
          OPEN      DEBFDTA7,"debfdtaf"
          DISPLAY   *P56:24,"Opening debfdtaf";
          OPEN      DEBFDTA8,"debfdtaf"
          DISPLAY   *P56:24,"Opening debitmaf";
          OPEN      DEBITMA1,"debitmaf"
          DISPLAY   *P56:24,"Opening debitmaf";
          OPEN      DEBITMA2,"debitmaf"
          DISPLAY   *P56:24,"Opening debitmaf";
          OPEN      DEBITMA3,"debitmaf"
          DISPLAY   *P56:24,"Opening debptyaf";
          OPEN      DEBPTYA1,"debptyaf"
          DISPLAY   *P56:24,"Opening debptyaf";
          OPEN      DEBPTYA2,"debptyaf"
          DISPLAY   *P56:24,"Opening debptyaf";
          OPEN      DEBPTYA3,"debptyaf"
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "00",SCRID
          IF         @EQUAL
            CALL       PS00L000   * Report Options                     
          ENDIF
          RETURN
.--------------------------------
. Screen - Report Options                     
.--------------------------------
SC00L000
SC00L100
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC00L200
          CALL      CF00L000 * Clear Fields
          CALL      DEFPAR00
SC00L300
          CALL      KY00L000 * Enter Key Fields
          BRANCH    EXIT,SC00L999,SC00L999
SC00L400
          CALL      WP00L000 * Load any WP Details
SC00L500
          CALL      LM00L000 * Load any Batch Details
SC00L600
          CALL      DF00L000 * Display Fields
SC00L700
          CALL      SF00L000 * Select Fields
          BRANCH    EXIT,SC00L100,SC00L100,SC00L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC00L800
SC00L900
SC00L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Report Options                     
.-------------------------------------------------------
CF00L000
          MOVE      SP70,FROMNAM 
          MOVE      SP70,TONAM   
          MOVE      SP70,FROMDEP 
          MOVE      SP70,TODEP   
          MOVE      SP70,FROMPTY 
          MOVE      SP70,TOPTY   
          MOVE      ZERO,REPTSEQ 
          MOVE      SP70,SEQDESC 
          MOVE      SP70,FROMITM 
          MOVE      SP70,TOITM   
          MOVE      SP70,STARTYRR
          MOVE      ZERO,REPTACT 
          MOVE      SP70,FROMDAT 
          MOVE      SP70,TODAT   
          MOVE      ZERO,EXPORTYN
CF00L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Report Options                     
.--------------------------------------------------------
KY00L000
          MOVE      ZERO,EXIT
          GOTO      KY00L999
.
KY00L900  MOVE      ONE,EXIT
KY00L999  RETURN
.---------------------------------------------------------
. Load WP files for : Report Options                     
.---------------------------------------------------------
WP00L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Report Options                     
.---------------------------------------------------------
LM00L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Report Options                     
.---------------------------------------------------------
DF00L000
          BRANCH   ACCEPT,DF00L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF00L900
          MATCH    PRGID,SCPSPID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF00L010 IF NOT EQUAL
.
          CALL     PS00L000 * Display Field
          GOTO     DF00L010
DF00L900
DF00L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Report Options                     
.---------------------------------------------------------
PS00L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS00L999,PS00L999,PS00L999,PS00L101:
                            PS00L102,PS00L103,PS00L104,PS00L105:
                            PS00L106,PS00L107,PS00L108,PS00L109:
                            PS00L110,PS00L111,PS00L112,PS00L113:
                            PS00L114,PS00L115
          GOTO     PS00L999
.
PS00L101
          MOVE      FROMNAM,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L102
          MOVE      TONAM,VAR        
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L103
          MOVE      FROMDEP,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L104
          MOVE      TODEP,VAR        
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L105
          MOVE      FROMPTY,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L106
          MOVE      TOPTY,VAR        
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L107
          MOVE      REPTSEQ,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L108
          MOVE      SEQDESC,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L109
          MOVE      FROMITM,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L110
          MOVE      TOITM,VAR        
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L111
          UNPACK    STARTYRR,CCENT,CYEAR,CMON,CDAY          
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L112
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      REPTACT,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L113
          MOVE      FROMDAT,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L114
          MOVE      TODAT,VAR        
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L115
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      EXPORTYN,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS00L999
PS00L999
          RETURN
.---------------------------------------------------------
. Selections for : Report Options                     
.---------------------------------------------------------
SF00L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF00L001  BRANCH   ACCEPT,SF00L020
.
SF00L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L006,SF00L101,SF00L102,SF00L103:
                            SF00L006,SF00L104,SF00L006,SF00L105:
                            SF00L006,SF00L106,SF00L006,SF00L107:
                            SF00L006,SF00L108,SF00L109,SF00L110:
                            SF00L006,SF00L111
SF00L006  BEEP
          GOTO     SF00L005
SF00L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF00L090
          MATCH    PRGID,SCSLPID
          GOTO     SF00L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF00L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L020,SF00L020,SF00L020,SF00L103:
                            SF00L020,SF00L104,SF00L020,SF00L105:
                            SF00L020,SF00L106,SF00L020,SF00L107:
                            SF00L020,SF00L108,SF00L109,SF00L110:
                            SF00L020,SF00L111
          GOTO     SF00L020
SF00L090  MOVE     ZERO,ACCEPT
          GOTO     SF00L001
.
SF00L101
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L102
          CALL      REPT0000
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L103
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TONAM   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   17",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TODAT   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      RNAM0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L103
            ENDIF
            BRANCH    EXIT,SF00L103,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      FROMNAM,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TONAM,VAR        
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   17",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TODAT,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L104
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TODEP   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      RDEP0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L104
            ENDIF
            BRANCH    EXIT,SF00L104,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      FROMDEP,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TODEP,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L105
.
.
          MOVE      "    9",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOPTY   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      RPTY0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L105
            ENDIF
            BRANCH    EXIT,SF00L105,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      FROMPTY,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    9",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOPTY,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L106
.
.
          MOVE      "   11",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SEQDESC 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KRSEQ000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L106
            ENDIF
            BRANCH    EXIT,SF00L106,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      REPTSEQ,VAR      
          CALL      DISPITEM
.
.
          MOVE      "   11",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SEQDESC,VAR      
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L107
.
.
          MOVE      "   13",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOITM   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      RITM0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L107
            ENDIF
            BRANCH    EXIT,SF00L107,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      FROMITM,VAR      
          CALL      DISPITEM
.
.
          MOVE      "   13",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOITM,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L108
          CALL      DEFDATE1
          CALL     SELECTED
          CALL      KEYDATE
          PACK      STARTYRR,CCENT,CYEAR,CMON,CDAY          
          UNPACK    STARTYRR,CCENT,CYEAR,CMON,CDAY          
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L109
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,REPTACT 
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      REPTACT,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L110
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      RDAT0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L110
            ENDIF
            BRANCH    EXIT,SF00L110,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      FROMDAT,VAR      
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L111
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,EXPORTYN
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      EXPORTYN,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF00L001
SF00L990  MOVE      FOUR,EXIT * Exit Char Exit
SF00L999  RETURN
.@@@@@ Function Restart Point @@@@@
.---------------------------------------
. Setup Defaults
.---------------------------------------
DEFPAR00  MOVE      "Start    ",FROMITM
          MOVE      "Start    ",FROMDEP
          MOVE      "Start    ",FROMPTY
          MOVE      "Start    ",FROMNAM
          MOVE      "Finish   ",TOITM
          MOVE      "Finish   ",TODEP
          MOVE      "Finish   ",TOPTY
          MOVE      "Finish   ",TONAM
          MOVE      SP70,STRITM
          MOVE      SP70,STRDEP
          MOVE      SP70,STRPTY
          MOVE      SP70,STRNAM
          MOVE      Z70,ENDITM
          MOVE      Z70,ENDDEP
          MOVE      Z70,ENDPTY
          MOVE      Z70,ENDNAM
          MOVE      ONE,REPTSEQ
          MOVE      ONE,REPTACT
.
          MOVE      "01",CDAY
          MOVE      CMM,CMON
          MOVE      CYY,CYEAR
          MOVE      CCC,CCENT
          PACK      STRDAT,CCENT,CYEAR,CMON,CDAY
          REP       " 0",STRDAT
          UNPACK    STRDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPCDATE,FROMDAT
.
          CALL      DEFDAT00
          CALL      PACDATE
          MOVE      CPCDATE,TODAT
          PACK      ENDDAT,CCENT,CYEAR,CMON,CDAY
          REP       " 0",ENDDAT
.
          READ      CONTROLF,EIGHTY1;CFDBPASS,*77,CFDBSQLA,CFDBSQLB:
                                                   CFDBFDAT,CFDBTDAT,CFDBSTYR
          MOVE      CFDBSTYR,STARTYRR
.
          CALL      GRSEQ000
.
          RETURN
.------------------------------------------------------------
. Get Default End Date from Start Date
.------------------------------------------------------------
DEFDAT00  UNPACK    STRDAT,CCENT,CYEAR,CMON
          MOVE      CMON,IMON
          BRANCH    IMON,DEFDAT31,DEFDAT28,DEFDAT31,DEFDAT30,DEFDAT31,DEFDAT30:
                         DEFDAT31,DEFDAT31,DEFDAT30,DEFDAT31,DEFDAT30,DEFDAT31
.
DEFDAT28  MOVE        "28",CDAY
          MOVE        CYEAR,IYEAR
          MOVE        CYEAR,CLYEAR
          DIVIDE      FOUR,CLYEAR
          MULT        FOUR,CLYEAR
          COMPARE     IYEAR,CLYEAR
          GOTO        DEFDAT50 IF NOT EQUAL
          MOVE        "29",CDAY
          GOTO        DEFDAT50
.
DEFDAT30  MOVE       "30",CDAY
          GOTO        DEFDAT50
.
DEFDAT31  MOVE       "31",CDAY
          GOTO        DEFDAT50
.
DEFDAT50  REP       " 0",CCENT
          REP       " 0",CYEAR
          REP       " 0",CMON
          REP       " 0",CDAY
          RETURN
.
DEFDATE1  MOVE     CCC,CCENT
          MOVE     CYY,CYEAR
          MOVE     CMM,CMON
          MOVE     CDD,CDAY
          REP      " 0",CCENT
          REP      " 0",CYEAR
          REP      " 0",CMON
          REP      " 0",CDAY
          RETURN
.-----------------------------
. Print Report
.-----------------------------
REPT0000  MOVE      ZERO,CPAGENO
          CLOCK     TIME,CTIMEIS
          MOVE      "99",CLNO
          CALL      CLRTOT00
          CALL      CHKRAN00
          STRIP     STRNAM
          STRIP     ENDNAM
.
          CALL      MAKEXP00
.
          BRANCH    REPTSEQ,REPT1000,REPT2000,REPT3000,REPT4000
.
REPT1000  CALL      SEQA0000
          GOTO      REPT9000
.
REPT2000  CALL      SEQB0000
          GOTO      REPT9000
.
REPT3000  CALL      SEQC0000
          GOTO      REPT9000
.
REPT4000  CALL      SEQD0000
          GOTO      REPT9000
.
REPT9000  CALL      PEND0000
.
REPT9999  RETURN
.------------------------------------------------------------
. Report By Code
.------------------------------------------------------------
SEQA0000  PACK      KEY8,STRITM,SP70
          CALL      RDDBIT1
          IF        OVRCD=0
            CALL      RPDBIT1
          ENDIF
SEQA1000  CALL      RKDBIT1
          BRANCH    OVRCD,SEQA9000
          MATCH     DBITITM,ENDITM
          GOTO      SEQA9000 IF LESS
          MOVE      DBITPTY,KEY8
          CALL      RDDBPT1
          CALL      RANGE000
          BRANCH    EXIT,SEQA1000
.
          CALL      PLIN0000
          GOTO      SEQA1000
.
SEQA9000
          RETURN
.------------------------------------------------------------
. Report By Description
.------------------------------------------------------------
SEQB0000  PACK      KEY43,STRNAM,SP70
          CALL      RDDBIT2
          IF        OVRCD=0
            CALL      RPDBIT2
          ENDIF
.
SEQB1000  CALL      RKDBIT2
          BRANCH    OVRCD,SEQB9000
          MATCH     DBITDES,ENDNAM
          GOTO      SEQB9000 IF LESS
          MOVE      DBITPTY,KEY8
          CALL      RDDBPT1
          CALL      RANGE000
          BRANCH    EXIT,SEQB1000
.
          CALL      PLIN0000
          GOTO      SEQB1000
.
SEQB9000  RETURN
.------------------------------------------------------------
. Report By Product Type
.------------------------------------------------------------
SEQC0000  PACK      KEY8,STRPTY,SP70
          CALL      RDDBPT1
          IF        OVRCD=0
            CALL      RPDBPT1
          ENDIF
.
SEQC1000  CALL      RKDBPT1
          BRANCH    OVRCD,SEQC9000
          MATCH     DBPTPTY,ENDPTY
          GOTO      SEQC9000 IF LESS
          MATCH     STRDEP,DBPTDEP    * Department Range
          GOTO      SEQC1000 IF LESS
          MATCH     DBPTDEP,ENDDEP
          GOTO      SEQC1000 IF LESS
.
          MOVE      "99",CLNO
.
          PACK      KEY16,DBPTPTY,SP70
          CALL      RDDBIT3
          IF        OVRCD=0
            CALL      RPDBIT3
          ENDIF
.
SEQC2000  CALL      RKDBIT3
          BRANCH    OVRCD,SEQC2900
          MATCH     DBITPTY,DBPTPTY
          GOTO      SEQC2900 IF NOT EQUAL
.
          CALL      RANGE000
          BRANCH    EXIT,SEQC2000
.
          CALL      PLIN0000
          GOTO      SEQC2000
.
SEQC2900  COMPARE   "99",CLNO            * If 99 then Not Line Items Prints
          GOTO      SEQC1000 IF EQUAL    * So don't print Totals
          CALL      TOTPTY00
          GOTO      SEQC1000
.
SEQC9000  RETURN
.------------------------------------------------------------
. Report By Department
.------------------------------------------------------------
SEQD0000  PACK      KEY8,STRDEP,SP70
          CALL      RDDBDE1
          IF        OVRCD=0
            CALL      RPDBDE1
          ENDIF
.
SEQD1000  CALL      RKDBDE1
          BRANCH    OVRCD,SEQD9000
          MATCH     DBDEDEP,ENDDEP
          GOTO      SEQD9000 IF LESS
          MOVE      ZERO,DEPTOTFL        * Flag Department Totals Required-No
.
          PACK      KEY16,DBDEDEP,SP70
          CALL      RSDBPT2
SEQD2000  CALL      RKDBPT2
          BRANCH    OVRCD,SEQD4000
          MATCH     DBPTDEP,DBDEDEP
          GOTO      SEQD4000 IF NOT EQUAL
          MATCH     STRPTY,DBPTPTY
          GOTO      SEQD2000 IF LESS
          MATCH     DBPTPTY,ENDPTY
          GOTO      SEQD2000 IF LESS
.
          MOVE      "99",CLNO
.
          PACK      KEY16,DBPTPTY,SP70
          CALL      RSDBIT3
.
SEQD3000  CALL      RKDBIT3
          BRANCH    OVRCD,SEQD3900
          MATCH     DBITPTY,DBPTPTY
          GOTO      SEQD3900 IF NOT EQUAL
          CALL      RANGE000
          BRANCH    EXIT,SEQD3000
.
          CALL      PLIN0000
          MOVE      ONE,DEPTOTFL         * Flag Department Totals Required -Yes
          GOTO      SEQD3000
.
SEQD3900  COMPARE   "99",CLNO            * If 99 then Not Line Items Prints
          GOTO      SEQD2000 IF EQUAL    * So don't print Totals
          CALL      TOTPTY00
          GOTO      SEQD2000
.
SEQD4000  COMPARE   ZERO,DEPTOTFL
          GOTO      SEQD1000 IF EQUAL
          CALL      TOTDEP00
          GOTO      SEQD1000
.
SEQD9000  RETURN
.--------------------------------------------------------
. Print Debtor Details
.--------------------------------------------------------
PLIN0000  IF        REPTACT=1
            COMPARE   ONE,DBITACT
            GOTO      PLIN9999 IF NOT EQUAL
          ENDIF
          COMPARE   "55",CLNO
          CALL      PHED0000 IF NOT LESS
.
          CALL      CALIT000
          MOVE      NO,YESNO
          LOAD      YESNO,DBITACT,YES
          MOVE      "99,999,999.99",PERQTY
          MOVE      "99,999,999.99",YTDQTY
          MOVE      "99,999,999.99",LASQTY
          MOVE      "999,999,999,999.99",PERTOT
          MOVE      "999,999,999,999.99",YTDTOT
          MOVE      "999,999,999,999.99",LASTOT
          FEDIT     QTYPER,PERQTY
          FEDIT     QTYYTD,YTDQTY
          FEDIT     QTYLAS,LASQTY
          FEDIT     TOTPER,PERTOT
          FEDIT     TOTYTD,YTDTOT
          FEDIT     TOTLAS,LASTOT
.
          MOVE      DBITDES,KEY24
          MOVE      "Active  ",SLITSTS
          BRANCH    DBITACT,PLIN0100
          MOVE      "Inactive",SLITSTS
PLIN0100  CALL      WRTEXP00
.
          PRINT     DBITITM,SP1,KEY24,SP1,PERQTY,SP1,PERTOT,SP1,YTDQTY:
                    SP1,YTDTOT,SP1,LASQTY,SP1,LASTOT
          ADD       ONE,CLNO
.
          ADD       QTYPER,DEQTYPER
          ADD       QTYYTD,DEQTYYTD
          ADD       QTYLAS,DEQTYLAS
          ADD       TOTPER,DETOTPER
          ADD       TOTYTD,DETOTYTD
          ADD       TOTLAS,DETOTLAS
.
          ADD       QTYPER,PTQTYPER
          ADD       QTYYTD,PTQTYYTD
          ADD       QTYLAS,PTQTYLAS
          ADD       TOTPER,PTTOTPER
          ADD       TOTYTD,PTTOTYTD
          ADD       TOTLAS,PTTOTLAS
.
          ADD       QTYPER,REQTYPER
          ADD       QTYYTD,REQTYYTD
          ADD       QTYLAS,REQTYLAS
          ADD       TOTPER,RETOTPER
          ADD       TOTYTD,RETOTYTD
          ADD       TOTLAS,RETOTLAS
.
PLIN9999  RETURN
.------------------------------------------------------------
. Print End of Report
.------------------------------------------------------------
PEND0000  COMPARE   ZERO,CPAGENO
          CALL      PHED0000 IF EQUAL
          CALL      UND132
          MOVE      "99,999,999.99",PERQTY
          MOVE      "99,999,999.99",YTDQTY
          MOVE      "99,999,999.99",LASQTY
          MOVE      "999,999,999,999.99",PERTOT
          MOVE      "999,999,999,999.99",YTDTOT
          MOVE      "999,999,999,999.99",LASTOT
          FEDIT     REQTYPER,PERQTY
          FEDIT     REQTYYTD,YTDQTY
          FEDIT     REQTYLAS,LASQTY
          FEDIT     RETOTPER,PERTOT
          FEDIT     RETOTYTD,YTDTOT
          FEDIT     RETOTLAS,LASTOT
.
          PRINT     "Report Total ",SP20,SP1:
                    PERQTY,SP1,PERTOT,SP1,YTDQTY,SP1,YTDTOT:
                    SP1,LASQTY,SP1,LASTOT
          CALL      UND132
          PRINT     *50,"*** End of Report ***"
          CALL      TRAN0000
.
          RETURN
.------------------------------------------------------------
. Print Total For Product Type
.------------------------------------------------------------
TOTPTY00  CALL      UND132
          MOVE      "99,999,999.99",PERQTY
          MOVE      "99,999,999.99",YTDQTY
          MOVE      "99,999,999.99",LASQTY
          MOVE      "999,999,999,999.99",PERTOT
          MOVE      "999,999,999,999.99",YTDTOT
          MOVE      "999,999,999,999.99",LASTOT
          FEDIT     PTQTYPER,PERQTY
          FEDIT     PTQTYYTD,YTDQTY
          FEDIT     PTQTYLAS,LASQTY
          FEDIT     PTTOTPER,PERTOT
          FEDIT     PTTOTYTD,YTDTOT
          FEDIT     PTTOTLAS,LASTOT
.
          MOVE      DBPTDES,KEY24
          PRINT     DBPTPTY,SP1,KEY24:
                    SP1,PERQTY,SP1,PERTOT,SP1,YTDQTY,SP1,YTDTOT:
                    SP1,LASQTY,SP1,LASTOT
          MOVE      ZERO,PTQTYPER
          MOVE      ZERO,PTQTYYTD
          MOVE      ZERO,PTQTYLAS
          MOVE      ZERO,PTTOTPER
          MOVE      ZERO,PTTOTYTD
          MOVE      ZERO,PTTOTLAS
          RETURN
.----------------------------------------------------------------------
. Print Total For Department
.------------------------------------------------------------
TOTDEP00  CALL      UND132
          MOVE      "99,999,999.99",PERQTY
          MOVE      "99,999,999.99",YTDQTY
          MOVE      "99,999,999.99",LASQTY
          MOVE      "999,999,999,999.99",PERTOT
          MOVE      "999,999,999,999.99",YTDTOT
          MOVE      "999,999,999,999.99",LASTOT
          FEDIT     DEQTYPER,PERQTY
          FEDIT     DEQTYYTD,YTDQTY
          FEDIT     DEQTYLAS,LASQTY
          FEDIT     DETOTPER,PERTOT
          FEDIT     DETOTYTD,YTDTOT
          FEDIT     DETOTLAS,LASTOT
.
          MOVE      DBDEDES,KEY24
          PRINT     DBDEDEP,SP1,KEY24:
                    SP1,PERQTY,SP1,PERTOT,SP1,YTDQTY,SP1,YTDTOT:
                    SP1,LASQTY,SP1,LASTOT
          MOVE      ZERO,DEQTYPER
          MOVE      ZERO,DEQTYYTD
          MOVE      ZERO,DEQTYLAS
          MOVE      ZERO,DETOTPER
          MOVE      ZERO,DETOTYTD
          MOVE      ZERO,DETOTLAS
          RETURN
.----------------------------------------------------------------------
. PHED0000 - Print Page Heading
.----------------------------------------------------------------------
PHED0000  CALL      HEAD132
          DISPLAY   *P1:24,*EL,"Printing Page ... ",CPAGENO
          IF        FALLITM=0
            PRINT     "Item Code  From  : ",FROMITM," to ",TOITM
            ADD       ONE,CLNO
          ENDIF
          IF        FALLDEP=0
            PRINT     "Department From  : ",FROMDEP," to ",TODEP
            ADD       ONE,CLNO
          ENDIF
          IF        FALLPTY=0
            PRINT     "Prod. Type From  : ",FROMPTY," to ",TOPTY
            ADD       ONE,CLNO
          ENDIF
          IF        FALLNAM=0
            PRINT     "Item Name  From  : ",FROMNAM," to ",TONAM
            ADD       ONE,CLNO
          ENDIF
          MOVE      NO,YESNO
          LOAD      YESNO,REPTACT,YES
          PRINT     "Report Sequence  : ",SEQDESC:
                    "   Active Only      : ",YESNO
          IF        REPTSEQ=3
            PRINT     "Product Type     : ",DBPTPTY,SP1,DBPTDES
            ADD       ONE,CLNO
          ENDIF
          IF        REPTSEQ=4
            PRINT     "Department       : ",DBDEDEP,SP1,DBDEDES
            PRINT     "Product Type     : ",DBPTPTY,SP1,DBPTDES
            ADD       TWO,CLNO
          ENDIF
.
          UNPACK    STARTYRR,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     "Start of Year    : ",CPCDATE,"      ":
                    "                 Analysis Period  : ",FROMDAT," to ",TODAT
          CALL      UND132
          PRINT     "Sales Item                          ":
                    "-------- Period Total --------   ":
                    "--------Year to Date ---------   ":
                    "--------- Last Year ----------"
          PRINT     "                                       ":
                    "Quantity            Dollars      ":
                    "Quantity            Dollars      ":
                    "Quantity            Dollars"
          CALL      UND132
          ADD       THREE,CLNO
          RETURN
.--------------------------------------------------------
. Check Ranges
.--------------------------------------------------------
RANGE000  MATCH     STRITM,DBITITM    * Item Code Range
          GOTO      RANGE900 IF LESS
          MATCH     DBITITM,ENDITM
          GOTO      RANGE900 IF LESS
          MATCH     STRNAM,DBITDES    * Item Description Range
          GOTO      RANGE900 IF LESS
          MATCH     DBITDES,ENDNAM
          GOTO      RANGE900 IF LESS
          MATCH     STRPTY,DBITPTY    * Product Type Range
          GOTO      RANGE900 IF LESS
          MATCH     DBITPTY,ENDPTY
          GOTO      RANGE900 IF LESS
          MATCH     STRDEP,DBPTDEP    * Department Range
          GOTO      RANGE900 IF LESS
          MATCH     DBPTDEP,ENDDEP
          GOTO      RANGE900 IF LESS
.
          MOVE      "Department Code Missing            ",DEPTDESC
          PACK      DEPTCODE,DBPTDEP
          PACK      KEY8,DEPTCODE,KEY8
          CALL      RDDBDE1
          BRANCH    OVRCD,RANGE100
          PACK      DEPTDESC,DBDEDES
.
RANGE100  MOVE      ZERO,EXIT
          GOTO      RANGE999
.
RANGE900  MOVE      ONE,EXIT
.
RANGE999  RETURN
.--------------------------------------------------
. Check Ranges and set "ALL" flag for each range
.--------------------------------------------------
CHKRAN00  MOVE      ZERO,FALLDEP
          MOVE      ZERO,FALLPTY
          MOVE      ZERO,FALLITM
          MOVE      ZERO,FALLNAM
          MATCH     SP70,STRDEP
          IF        @EQUAL
            MATCH     Z70,ENDDEP
            IF        @EQUAL
              MOVE      ONE,FALLDEP
            ENDIF
          ENDIF
.
          MATCH     SP70,STRPTY
          IF        @EQUAL
            MATCH     Z70,ENDPTY
            IF        @EQUAL
              MOVE      ONE,FALLPTY
            ENDIF
          ENDIF
.
          MATCH     SP70,STRITM
          IF        @EQUAL
            MATCH     Z70,ENDITM
            IF        @EQUAL
              MOVE      ONE,FALLITM
            ENDIF
          ENDIF
.
          MATCH     SP70,STRNAM
          IF        @EQUAL
            MATCH     Z70,ENDNAM
            IF        @EQUAL
              MOVE      ONE,FALLNAM
            ENDIF
          ENDIF
.
          RETURN
. ------------------------------------------------------------
. Calculate Totals For a Sales Item
.------------------------------------------------------------
CALIT000  MOVE      ZERO,QTYPER
          MOVE      ZERO,QTYYTD
          MOVE      ZERO,QTYLAS
          MOVE      ZERO,TOTPER
          MOVE      ZERO,TOTYTD
          MOVE      ZERO,TOTLAS
          PACK      KEY40,DBITITM,SP70
          CALL      RSDBFD4
CALIT100  CALL      RKDBFD4
          BRANCH    OVRCD,CALIT999
          MATCH     DBITITM,DBFDITM
          GOTO      CALIT999 IF NOT EQUAL
          MATCH     "1",DBFDDTY
          GOTO      CALIT110 IF EQUAL
          MATCH     "2",DBFDDTY
          GOTO      CALIT102 IF EQUAL
          MATCH     "4",DBFDDTY
          GOTO      CALIT105 IF EQUAL
          MATCH     "5",DBFDDTY
          GOTO      CALIT100 IF NOT EQUAL
.
CALIT102  MULT      SEQ,DBFDQTY                * Credit Note
          MULT      SEQ,DBFDTAX
          MULT      SEQ,DBFDTOT
.
          MOVE      DBFDPDAT,DBFDIDAT
          GOTO      CALIT110
.
CALIT105  MOVE      DBFDPDAT,DBFDIDAT
.
CALIT110  MATCH     STRDAT,DBFDIDAT
          GOTO      CALIT200 IF LESS
          MATCH     DBFDIDAT,ENDDAT
          GOTO      CALIT100 IF LESS
          ADD       DBFDQTY,QTYPER
          ADD       DBFDTOT,TOTPER
          ADD       DBFDTAX,TOTPER
          ADD       DBFDQTY,QTYYTD
          ADD       DBFDTOT,TOTYTD
          ADD       DBFDTAX,TOTYTD
          GOTO      CALIT100
.
CALIT200  MATCH     STARTYRR,DBFDIDAT
          GOTO      CALIT300 IF LESS
          ADD       DBFDQTY,QTYYTD
          ADD       DBFDTOT,TOTYTD
          ADD       DBFDTAX,TOTYTD
          GOTO      CALIT100
.
CALIT300  MATCH     STARTLAS,DBFDIDAT
          GOTO      CALIT100 IF LESS
          ADD       DBFDQTY,QTYLAS
          ADD       DBFDTOT,TOTLAS
          ADD       DBFDTAX,TOTLAS
          GOTO      CALIT100
.
CALIT999  RETURN
.------------------------------------------------------------
. Clear All Totals
.------------------------------------------------------------
CLRTOT00  MOVE      ZERO,REQTYPER
          MOVE      ZERO,REQTYYTD
          MOVE      ZERO,REQTYLAS
          MOVE      ZERO,RETOTPER
          MOVE      ZERO,RETOTYTD
          MOVE      ZERO,RETOTLAS
.
          MOVE      ZERO,PTQTYPER
          MOVE      ZERO,PTQTYYTD
          MOVE      ZERO,PTQTYLAS
          MOVE      ZERO,PTTOTPER
          MOVE      ZERO,PTTOTYTD
          MOVE      ZERO,PTTOTLAS
.
          MOVE      ZERO,DEQTYPER
          MOVE      ZERO,DEQTYYTD
          MOVE      ZERO,DEQTYLAS
          MOVE      ZERO,DETOTPER
          MOVE      ZERO,DETOTYTD
          MOVE      ZERO,DETOTLAS
          UNPACK    STARTYRR,CCENT,CYEAR,CMON,CDAY
          MOVE      CYEAR,IYEAR
          SUB       ONE,IYEAR
          PACK      STARTLAS,CCENT,IYEAR,CMON,CDAY
          REP       " 0",STARTYRR
          REP       " 0",STARTLAS
.
          RETURN
.------------------------------------------------------------
. File       : casetran
.
. Functions  : This file contains standard routines for
.              creating and transfering TAB delimited
.              export files to a PC using the unix script
.              keatran.
.
. Routines   : MAKEXP00  - Create the Export File and Headings
.              WRTEXP00  - Write Export details Record to File
.              TRAN0000  - Transfer file to PC using script keatran
.
. Note       : The Variable EXPORTYN is used to determine if a
.              export file is to be created. 0=No, 1=Yes.
.
. Variables to be Declared
. ------------------------
. EXPORTFL  FILE      ASCII, FIXED=400     * Export File (Adjust Length to Suit)
. EXPORTFN  DIM       8                    * Export File Name
. TABDELM   EQU       0x09                 * Tab Delimiter
.------------------------------------------------------------
. Create Export File
.------------------------------------------------------------
MAKEXP00  COMPARE   ONE,EXPORTYN
          GOTO      MAKEXP99 IF NOT EQUAL
          MOVE      "EXPORT",KEY6
          PACK      EXPORTFN,KEY6,PORT
          REP       " 0",EXPORTFN
          PREP      EXPORTFL,EXPORTFN
.
          WRITE     EXPORTFL,SEQ;"Department Code",TABDELM:
                                 "Department Description",TABDELM:
                                 "Product Type",TABDELM:
                                 "Product Type Description",TABDELM:
                                 "Sales Item Code",TABDELM:
                                 "Sales Item Description",TABDELM:
                                 "Status",TABDELM:
                                 "Period Total Quantity",TABDELM:
                                 "Period Total Value",TABDELM:
                                 "Year to Date Quantity",TABDELM:
                                 "Year to Date Value",TABDELM:
                                 "Last Year Quantity",TABDELM:
                                 "Last Year Value"
.
MAKEXP99  RETURN
.------------------------------------------------------------
. Write to Export File
.------------------------------------------------------------
WRTEXP00  COMPARE   ONE,EXPORTYN
          GOTO      WRTEXP99 IF NOT EQUAL
.
          WRITE     EXPORTFL,SEQ;DBPTDEP,TABDELM:
                                 DBDEDES,TABDELM:
                                 DBITPTY,TABDELM:
                                 DBPTDES,TABDELM:
                                 DBITITM,TABDELM:
                                 DBITDES,TABDELM:
                                 SLITSTS,TABDELM:
                                 QTYPER,TABDELM:
                                 TOTPER,TABDELM:
                                 QTYYTD,TABDELM:
                                 TOTYTD,TABDELM:
                                 QTYLAS,TABDELM:
                                 TOTLAS
.
WRTEXP99  RETURN
.------------------------------------------------------------
. Execute Transfer Script eg softerm
.------------------------------------------------------------
TRAN0000  COMPARE   ONE,EXPORTYN
          GOTO      TRAN9999 IF NOT EQUAL
          MOVE      YES,DEFYESNO
          CLOSE     EXPORTFL
          DISPLAY   *P1:24,*EL,"Execute Transfer Now (":
                               *V2LON,"Y",*HOFF,"/":
                               *V2LON,"N",*HOFF,") ? "
          MOVE      "24",CVERT
          MOVE      "30",CCOL
          CALL      YORN0000
          COMPARE   ZERO,FYESNO
          GOTO      TRAN9999 IF EQUAL   *  No Transfer
.
          MOVE      ZERO,HLEF
          CALL      GETSCR00
.
          CLEAR     KEY80
          APPEND    "keatran ",KEY80
          APPEND    EXPORTFN,KEY80
          APPEND    ".txt",KEY80
          RESET     KEY80
          EXECUTE   KEY80,TASKID
.
          CALL      PUTSCR00
.
          DISPLAY   *P1:24,*EL,"Transfer Completed Ok (":
                               *V2LON,"Y",*HOFF,"/":
                               *V2LON,"N",*HOFF,") ? "
          MOVE      "24",CVERT
          MOVE      "31",CCOL
          CALL      YORN0000
          COMPARE   ZERO,FYESNO
          GOTO      TRAN0000 IF EQUAL   *  Not ok
.
          PREP      EXPORTFL,EXPORTFN
          CLOSE     EXPORTFL
.
TRAN9999  RETURN
.
.--------------------------------------------------
. Enter Name Range
.--------------------------------------------------
RNAM0000   MOVE     "    4",FLDID
           CALL     GETPOSIT
           MOVE     SP70,STRNAM
           STRIP    STRNAM
           SFORMAT  VAR,SCPSLEN
           MOVE     STRNAM,VAR
           KEYIN    *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
           MOVE     VAR,STRNAM
           SFORMAT  VAR,127
           ENDSET   STRNAM
           APPEND   SP70,STRNAM
           RESET    STRNAM
           CMATCH   EXITCHAR,STRNAM
           GOTO     RNAM0999 IF EQUAL
           MATCH    SP70,STRNAM
           GOTO     RNAM0100 IF EQUAL
           PACK     FROMNAM,STRNAM,SP70
           GOTO     RNAM0140
RNAM0100   MOVE     "Start             ",FROMNAM
           MOVE     SP70,STRNAM
.
RNAM0140   MOVE     FROMNAM,VAR
           CALL     DISPITEM
.
RNAM0150   MOVE     "    5",FLDID
           CALL     GETPOSIT
           MOVE     SP70,ENDNAM
           STRIP    ENDNAM
           SFORMAT  VAR,SCPSLEN
           MOVE     ENDNAM,VAR
           KEYIN    *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
           MOVE     VAR,ENDNAM
           SFORMAT  VAR,127
           ENDSET   ENDNAM
           APPEND   SP70,ENDNAM
           RESET    ENDNAM
           CMATCH   EXITCHAR,ENDNAM
           GOTO     RNAM0999 IF EQUAL
           MATCH    SP70,ENDNAM
           GOTO     RNAM0200 IF EQUAL
           PACK     TONAM,ENDNAM,SP70
           MATCH    STRNAM,ENDNAM
           GOTO     RNAM0999 IF EQUAL
           GOTO     RNAM0999 IF NOT LESS
           BEEP
           MOVE     "To Name Must Be > From Name - ",DISPMSG
           CALL     MESSAGE1
           GOTO     RNAM0000
.
RNAM0200   MOVE     "Finish             ",TONAM
           MOVE     Z70,ENDNAM
.
RNAM0999   MOVE     "    4",FLDID
           CALL     GETPOSIT
           RETURN
.
.--------------------------------------------------
. Enter Department Range
.--------------------------------------------------
RDEP0000   MOVE     "    6",FLDID
           CALL     GETPOSIT
           CALL     KDBDEA00
           BRANCH   EXIT,RDEP0100,RDEP0999
           MOVE     DBDEDEP,STRDEP
           PACK     FROMDEP,DBDEDEP,SP1,DBDEDES
           GOTO     RDEP0140
RDEP0100   MOVE     "Start             ",FROMDEP
           MOVE     SP70,STRDEP
.
RDEP0140   MOVE     FROMDEP,VAR
           CALL     DISPITEM
.
RDEP0150   MOVE     "    7",FLDID
           CALL     GETPOSIT
           CALL     KDBDEA00
           BRANCH   EXIT,RDEP0200,RDEP0999
           MOVE     DBDEDEP,ENDDEP
           PACK     TODEP,DBDEDEP,SP1,DBDEDES
           MATCH    STRDEP,ENDDEP
           GOTO     RDEP0999 IF EQUAL
           GOTO     RDEP0999 IF NOT LESS
           BEEP
           MOVE     "To Department Must Be > From Department - ",DISPMSG
           CALL     MESSAGE1
           GOTO     RDEP0000
.
RDEP0200   MOVE     "Finish             ",TODEP
           MOVE     Z70,ENDDEP
.
RDEP0999   MOVE     "    6",FLDID
           CALL     GETPOSIT
           RETURN
.--------------------------------------------------
. Enter PTYartment Range
.--------------------------------------------------
RPTY0000   MOVE     "    8",FLDID
           CALL     GETPOSIT
           CALL     KDBPTA00
           BRANCH   EXIT,RPTY0100,RPTY0999
           MOVE     DBPTPTY,STRPTY
           PACK     FROMPTY,DBPTPTY,SP1,DBPTDES
           GOTO     RPTY0140
RPTY0100   MOVE     "Start             ",FROMPTY
           MOVE     SP70,STRPTY
.
RPTY0140   MOVE     FROMPTY,VAR
           CALL     DISPITEM
.
RPTY0150   MOVE     "    9",FLDID
           CALL     GETPOSIT
           CALL     KDBPTA00
           BRANCH   EXIT,RPTY0200,RPTY0999
           MOVE     DBPTPTY,ENDPTY
           PACK     TOPTY,DBPTPTY,SP1,DBPTDES
           MATCH    STRPTY,ENDPTY
           GOTO     RPTY0999 IF EQUAL
           GOTO     RPTY0999 IF NOT LESS
           BEEP
           MOVE     "To Product Type Must Be > From Product Type - ",DISPMSG
           CALL     MESSAGE1
           GOTO     RPTY0000
.
RPTY0200   MOVE     "Finish             ",TOPTY
           MOVE     Z70,ENDPTY
.
RPTY0999   MOVE     "    8",FLDID
           CALL     GETPOSIT
           RETURN
.------------------------------------------------------------
. Input Report Layout
.------------------------------------------------------------
KRSEQ000   CALL      DRSEQ000
           MOVE      ONE,REPTSEQ
.
KRSEQ001   KEYIN     *PCCOL:CVERT,*V2LON,*RV,REPTSEQ
           BRANCH    REPTSEQ,KRSEQ010,KRSEQ010,KRSEQ010,KRSEQ010
           BEEP
           GOTO      KRSEQ001
.
KRSEQ010   CALL      GRSEQ000
KRSEQ999   CALL      PUTSCR00
           RETURN
.
DRSEQ000  MOVE      "17",HTOP
          MOVE      "55",HLEF
          MOVE      "24",HBOT
          MOVE      "80",HRIG
          CALL      GETSCR00
.
          BOXCLR    HLEF,HTOP,HRIG,HBOT
          BOX       16,HLEF,HTOP,HRIG,HBOT
          DISPLAY   *P60:18,*V2LON,*ULON,"Report Sequence",*HOFF:
                    *P57:19,*V2LON,"1. ",*HOFF,"Sales Item Code":
                    *P57:20,*V2LON,"2. ",*HOFF,"Sales Item Name":
                    *P57:21,*V2LON,"3. ",*HOFF,"Product Type":
                    *P57:22,*V2LON,"4. ",*HOFF,"Department"
          RETURN
.
GRSEQ000   BRANCH    REPTSEQ,GRSEQ010,GRSEQ020,GRSEQ030,GRSEQ040
.
GRSEQ010   MOVE      "Sales Item Code",SEQDESC
           GOTO      GRSEQ999
.
GRSEQ020   MOVE      "Sales Item Name",SEQDESC
           GOTO      GRSEQ999
.
GRSEQ030   MOVE      "Product Type   ",SEQDESC
           GOTO      GRSEQ999
.
GRSEQ040   MOVE      "Department     ",SEQDESC
           GOTO      GRSEQ999
.
GRSEQ999   RETURN
.
.--------------------------------------------------
. Enter Item Range
.--------------------------------------------------
RITM0000   MOVE     "   12",FLDID
           CALL     GETPOSIT
           CALL     KDBITA00
           BRANCH   EXIT,RITM0100,RITM0999
           MOVE     DBITITM,STRITM
           PACK     FROMITM,DBITITM,SP1,DBITDES
           GOTO     RITM0140
RITM0100   MOVE     "Start             ",FROMITM
           MOVE     SP70,STRITM
.
RITM0140   MOVE     FROMITM,VAR
           CALL     DISPITEM
.
RITM0150   MOVE     "   13",FLDID
           CALL     GETPOSIT
           CALL     KDBITA00
           BRANCH   EXIT,RITM0200,RITM0999
           MOVE     DBITITM,ENDITM
           PACK     TOITM,DBITITM,SP1,DBITDES
           MATCH    STRITM,ENDITM
           GOTO     RITM0999 IF EQUAL
           GOTO     RITM0999 IF NOT LESS
           BEEP
           MOVE     "To Item Must Be > From Item - ",DISPMSG
           CALL     MESSAGE1
           GOTO     RITM0000
.
RITM0200   MOVE     "Finish             ",TOITM
           MOVE     Z70,ENDITM
.
RITM0999   MOVE     "   12",FLDID
           CALL     GETPOSIT
           RETURN
.
.----------------------------------------
. Enter Service Date Range
.----------------------------------------
RDAT0000   MOVE     "   16",FLDID
           CALL     GETPOSIT
           MOVE     "01",CDAY
           MOVE     CMM,CMON
           MOVE     CYY,CYEAR
           MOVE     CCC,CCENT
           CALL     KEYDATE
           BRANCH   OVRCD,RDAT0100
           MATCH    SP2,CDAY
           GOTO     RDAT0100 IF EQUAL
           PACK     STRDAT,CCENT,CYEAR,CMON,CDAY
           REP      " 0",STRDAT
           CALL     PACDATE
           MOVE     CPCDATE,FROMDAT
           GOTO     RDAT0140
RDAT0100   MOVE     "Start             ",FROMDAT
           MOVE     SP70,STRDAT
.
RDAT0140   MOVE     FROMDAT,VAR
           CALL     DISPITEM
.
RDAT0150   MOVE     "   17",FLDID
           CALL     GETPOSIT
           CALL     DEFDAT00
           CALL     KEYDATE
           BRANCH   OVRCD,RDAT0200
           MATCH    SP2,CDAY
           GOTO     RDAT0200 IF EQUAL
           PACK     ENDDAT,CCENT,CYEAR,CMON,CDAY
           REP      " 0",ENDDAT
           CALL     PACDATE
           MOVE     CPCDATE,TODAT
           MATCH    STRDAT,ENDDAT
           GOTO     RDAT0999 IF EQUAL
           GOTO     RDAT0999 IF NOT LESS
           BEEP
           MOVE     "To Date Must Be > From Date - ",DISPMSG
           CALL     MESSAGE1
           GOTO     RDAT0000
.
RDAT0200   MOVE     "Finish             ",TODAT
           MOVE     "99999999",ENDDAT
.
RDAT0999   MOVE     "   16",FLDID
           CALL     GETPOSIT
           RETURN
.
.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       DEBCODIO/INC
          INC       DEBDBTIO/INC
          INC       DEBDBTKY    
          INC       DEBDEPIO/INC
          INC       DEBDEPKY    
          INC       DEBDKIIO/INC
          INC       DEBDKIKY    
          INC       DEBDKIPR    
          INC       DEBFDTIO/INC
          INC       DEBITMIO/INC
          INC       DEBITMKY    
          INC       DEBPTYIO/INC
          INC       DEBPTYKY    
.
          INC       STDGENCD
.

.*****************************************************************************
.*  EOCM0000  :  Fork to Episode of Care Maintenance - IBAEOC01              *
.*               Parameters : KEY20 - U/R Number/Event Number                *
.*               
.*        V5.07  27/10/1999  J Habasque 
.*               Added INPFLAG
.*****************************************************************************
EOCM0000
.
. ------- Pass IBAEOC01 with the U/R Number and Visit Number -----------
. 
          CALL      CLOS0000                * close files
          CALL      GETSCR00                * Save Screen
          MOVE      KEY20,ERROR
          FORK      "IBAEOC01",ANS
          PACK      ERROR,SP20              * Clear Error Field
          PACK      FNM,SP20              * Clear Error Field
          CALL      PUTSCR00                * Put Screen
          DISPLAY   *P1:24,*EL
          CALL      OPEN0000                * close files
.
EOCM9999  RETURN
.*****************************************************************************
.*  EOCE0000  :  Fork to Episode of Care Maintenance - IBAEOC01              *
.*               Parameters : KEY20 - U/R Number/Event Number                *
.*****************************************************************************
EOCE0000
.
. ------- Pass IBAEOC02 with the U/R Number
. 
          CALL      CLOS0000                * close files
          CALL      GETSCR00                * Save Screen
          MOVE      KEY8,ERROR
          FORK      "IBAEOC02",ANS
          PACK      ERROR,SP20              * Clear Error Field
          PACK      FNM,SP20              * Clear Error Field
          CALL      PUTSCR00                * Put Screen
          DISPLAY   *P1:24,*EL
          CALL      OPEN0000                * close files
.
EOCE9999  RETURN
.***************************************************************************
.* CHKFOREC - check whether to automatically fork to IBAEOC01
.*            Parameters : KEY8 - Event Number   
.***************************************************************************
          DEFPROC   CHKFOREC
.
          INC       EOCLNKFD/INC
.
CFOR0000  MOVE      ZERO,EXIT 
          OPEN      EOCLNKA2,"eoclnkaf"
          OPEN      CONTROLF,"controlf"
.
          READ      CONTROLF,TEN;*244,CHOSPNUM
.
          COMPARE   ZERO,PTCNLMAN                * Linking Visit Mandatory?
          GOTO      CFOR9500 IF EQUAL            * no
.
          PACK      KEY10,CHOSPNUM,KEY8,SP20
          CALL      RDECLNK2
          COMPARE   ZERO,OVRCD
          GOTO      CFOR9500 IF EQUAL
.
. ------- Pass IBAEOC01 with the U/R Number and Visit Number -----------
.
          PACK      KEY20,PURNO,KEY8,INPFLAG,SP20
          CALL      EOCM0000                * fork to IBAEOC01
          GOTO      CFOR9999
.
CFOR9500  MOVE      ONE,EXIT
.
CFOR9999  GOTO      ENDCHKFO
.
          INC       EOCLNKIO/INC
          INC       IBAOVRIO/INC
.
ENDCHKFO  ENDPROC
.
.****************************************************************************
.* AECO0000 - Ask to see EOC details
.****************************************************************************
AECO0000  COMPARE   ONE,PTCNUEOC
          GOTO      AECO9999 IF NOT EQUAL 
.
          DISPLAY   *P1:24,"Do You Want to Maintain Episode of Care Details ":
                    "(Y/N) ? ",*EL,*V2LON,*P50:24,"Y",*P52:24,"N";
.
AECO3100  KEYIN     *P57:24,*DV,UNDLN1,*P57:24,*V2LON,ANS;
          REP       UPPLOW,ANS
.
          MATCH     "Y",ANS
          GOTO      AECO9000 IF EQUAL       * Yes
.
          MATCH     "N",ANS
          GOTO      AECO9500 IF EQUAL       * No 
.
          BEEP
          GOTO      AECO3100
.
AECO9000  MOVE      ZERO,EXIT
          GOTO      AECO9999
.
AECO9500  MOVE      ONE,EXIT
.
AECO9999  RETURN

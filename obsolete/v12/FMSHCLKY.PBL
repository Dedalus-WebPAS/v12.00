.-------------------------------------------------------------------------------
.   System    :   FMS Financial System  
.                           
.   Program   :   FMSHCLFM 
.                            
.   Routines  :   KHCLFM00 Keyin Institution Code   - Returns a valid record
.                 AHCLFM00 Accept Institution Code  - Returns a key NOT on file
.   
.   Return    :   EXIT = 1 null entry EXIT = 2 EXITCHAR entered
.
.   Internal  :   HFMHLA00 Help Display for Institution Code  
.                            
.   Redisplay :   RHCLFM00 Screen Redisplay Called for Institution Code  
.-------------------------------------------------------------------------------
.   Mods      :    
.-------------------------------------------------------------------------------
. Normal Code Keyin - Code Must Exist Exit = 1 if Null Entry
.-------------------------------------------------------------------------------
KHCLFM00  MOVE      UNDLN70,FMHLINST
          KEYIN     *PCCOL:CVERT,*EL,*DV,FMHLINST:
                    *PCCOL:CVERT,*V2LON,FMHLINST: 
                    *PCCOL:CVERT,*EL,*DV,FMHLINST
.
          ENDSET    FMHLINST
          APPEND    SP70,FMHLINST
          RESET     FMHLINST
          MATCH     SP70,FMHLINST             * System Code Spaces so exit set
          GOTO      KHCLFM90 IF EQUAL
.
          CMATCH    EXITCHAR,FMHLINST         * Exit Selected
          GOTO      KHCLFM95 IF EQUAL
.
          CMATCH    QUEST,FMHLINST            * Help Required  
          GOTO      KHCLFM10 IF NOT EQUAL
          CALL      HFMHLA00                  * Display List Of FMHLINSTs
          PACK      CDATASAV,FMHLINST,SP70    * save data entered
          CALL      RHCLFM00                  * Redisplay Routine
          PACK      FMHLINST,CDATASAV,SP70    * restore data entered
.
          ENDSET    FMHLINST
          APPEND    SP70,FMHLINST
          RESET     FMHLINST
          MATCH     SP70,FMHLINST             * System Code Spaces so exit set
          GOTO      KHCLFM00 IF EQUAL
.
KHCLFM10  PACK      KEY3,FMHLINST
          CALL      RDFMHL1                                   
          BRANCH    OVRCD,KHCLFM80
          MOVE      ZERO,EXIT                 * no entry so exit is set
          GOTO      KHCLFM99
.
KHCLFM80  DISPLAY   *P1:24,*EL,*B,"Institution Code Does Not Exist - ";
          CALL      HITENTER
          GOTO      KHCLFM00
.
KHCLFM90  MOVE      ONE,EXIT                  * null entry so exit is set
          GOTO      KHCLFM99
.
KHCLFM95  MOVE      TWO,EXIT                  * Exit character entered    
.
KHCLFM99  RETURN
.-------------------------------------------------------------------------------
. Accept Code Keyin - Code Must Not Exist 
.-------------------------------------------------------------------------------
AHCLFM00  MOVE      UNDLN70,FMHLINST
          KEYIN     *PCCOL:CVERT,*EL,*DV,FMHLINST:
                    *PCCOL:CVERT,*V2LON,FMHLINST: 
                    *PCCOL:CVERT,*V2LON,*DV,FMHLINST
.
          ENDSET    FMHLINST
          APPEND    SP70,FMHLINST
          RESET     FMHLINST
          MATCH     SP70,FMHLINST             * System Code Spaces so exit set
          GOTO      AHCLFM90 IF EQUAL
.
          CMATCH    EXITCHAR,FMHLINST         * Exit Selected
          GOTO      AHCLFM95 IF EQUAL
.
          CMATCH    QUEST,FMHLINST            * Help Required  
          GOTO      AHCLFM10 IF NOT EQUAL
          CALL      HFMHLA00                  * Display List Of FMHLINSTs
          CALL      RHCLFM00                  * Redisplay Routine
.
          ENDSET    FMHLINST
          APPEND    SP70,FMHLINST
          RESET     FMHLINST
          MATCH     SP70,FMHLINST             * System Code Spaces so exit set
          GOTO      AHCLFM00 IF EQUAL
.
AHCLFM10  PACK      KEY3,FMHLINST
          MOVE      ZERO,EXIT                 * no entry so exit is set
          CALL      RDFMHL1                                   
          BRANCH    OVRCD,AHCLFM99
.
          DISPLAY   *P1:24,*EL,*B,"Institution Code Already Exists - ";
          CALL      HITENTER
          GOTO      AHCLFM00
.
AHCLFM90  MOVE      ONE,EXIT                  * null entry so exit is set
          GOTO      AHCLFM99
.
AHCLFM95  MOVE      TWO,EXIT                  * Exit character entered    
.
AHCLFM99  RETURN
.------------------------------------------------------------------------------
. Display List of All Codes
.------------------------------------------------------------------------------
HFMHLA00
          MOVE      ZERO,CSCRSIZ
          IF        HTOP<3
            MOVE      "12",HTOP
            MOVE      "24",HBOT
            MOVE      "40",HLEF
            MOVE      "80",HRIG
          ENDIF
HFMHLA04
          CALL      GSCRN000
          BRANCH    EXIT,HFMHLA99
          MOVE      STDCOL00,STDCOL01
          ADD       " 5",STDCOL01
          DISPLAY   *PSTDCOL01:STDROW,*V2LON,*ULON,"Inst."             
.
          MOVE      STDCOL01,STDCOL02
          ADD       " 7",STDCOL02
          DISPLAY   *PSTDCOL02:STDROW,*V2LON,*ULON,"Description"        
.
          MOVE      STDCOL02,STDCOL03
          ADD       "36",STDCOL03
HFMHLA08
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          MOVE      SP70,FMHLINST
          PACK      KEY3,FMHLINST,SP70                                          
.                                                                               
.                                                                               
          CALL      RSFMHL1 
HFMHLA10
          CALL      RKFMHL1 
          BRANCH    OVRCD,HFMHLA15
          PACK      KEY3,FMHLINST,SP70                                          
.                                                                               
.                                                                               
          BRANCH    CSEARCH,HFMHLA12
          CALL      HFMHLA60
          BRANCH    OVRCD,HFMHLA10
HFMHLA12
          ADD       ONE,XITEMNO
          ADD       ONE,STDROW
          STORE     KEY3,XITEMNO,ST1,ST2,ST3,ST4,ST5:                            
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          DISPLAY   *PSTDCOL00:STDROW,SP1,*V2LON,XITEMNO,DOT
          DISPLAY   *PSTDCOL01:STDROW,FMHLINST
          DISPLAY   *PSTDCOL02:STDROW,FMHLDESC
          COMPARE   MAXITEM,XITEMNO
          GOTO      HFMHLA10 IF NOT EQUAL
HFMHLA15
.                                                                               
          MOVE      ONE,DITEM
          MOVE      MINITEM,DROW
          ADD       ONE,DROW
          DISPLAY   *PSTDCOL00:DROW,*V2LON,*HON,SP1,DITEM,DOT
          CLIP
          FLUSH     HLEF,HTOP,HRIG,HBOT
.
HFMHLA20
          CALL      HSCRI000
          BRANCH    EXIT,HFMHLA30,HFMHLA35,HFMHLA40,HFMHLA45,HFMHLA04:
                              HFMHLA91,HFMHLA50
          GOTO      HFMHLA92
HFMHLA30
          CALL      RKFMHL1 
          BRANCH    OVRCD,HFMHLA85
          PACK      KEY3,FMHLINST,SP70                                          
.                                                                               
.                                                                               
          CALL      RPFMHL1 
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMHLA10
HFMHLA35
          MOVE      ST1,KEY3 
          CALL      RDFMHL1 
          CALL      RPFMHL1 
          BRANCH    OVRCD,HFMHLA85
          PACK      KEY3,FMHLINST,SP70                                          
.                                                                               
.                                                                               
.                                                                               
.                                                                               
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
HFMHLA36
          CALL      RPFMHL1 
          BRANCH    OVRCD,HFMHLA37
          PACK      KEY3,FMHLINST,SP70                                          
.                                                                               
.                                                                               
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HFMHLA36 IF NOT EQUAL
HFMHLA37
          MOVE      ZERO,XITEMNO
          GOTO      HFMHLA10
HFMHLA40
          MOVE      ST1,KEY3 
          CALL      RDFMHL1 
          CALL      RPFMHL1 
          BRANCH    OVRCD,HFMHLA85
          PACK      KEY3,FMHLINST,SP70                                          
.                                                                               
.                                                                               
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMHLA08
HFMHLA45
          CALL      RKFMHL1 
          BRANCH    OVRCD,HFMHLA85
          PACK      KEY3,FMHLINST,SP70                                          
.                                                                               
.                                                                               
          SUSPEND
          CLIP      1,1,CRIG,24
.
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      ZERO,XITEMNO
          PACK      KEY3,Z70                                                    
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
          CALL      RSFMHL1 
HFMHLA46
          CALL      RPFMHL1 
          BRANCH    OVRCD,HFMHLA47
          PACK      KEY3,FMHLINST,SP70                                          
.                                                                               
.                                                                               
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HFMHLA46 IF NOT EQUAL
HFMHLA47
          MOVE      ZERO,XITEMNO
          GOTO      HFMHLA10
HFMHLA50  COMPARE   ZERO,CSEARCH
          GOTO      HFMHLA55 IF EQUAL
          MOVE      ZERO,CSEARCH
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          ADD       ONE,STDROW
          UNPACK    SP70,SCHFLD01,SCHFLD02,SCHFLD03,SCHFLD04,SCHFLD05
          UNPACK    SP70,SCHFLD06,SCHFLD07,SCHFLD08,SCHFLD09,SCHFLD10
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          DISPLAY   *PSTDCOL00:STDROW,*V2LON,*HON,"Sch"
          KEYIN     *PSTDCOL01:STDROW,*V2LON,SCHFLD01
          RESET     SCHFLD01
          KEYIN     *PSTDCOL02:STDROW,*V2LON,SCHFLD02
          RESET     SCHFLD02
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMHLA08
HFMHLA55  MOVE      ONE,CSEARCH
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMHLA08
HFMHLA60  MOVE      ZERO,OVRCD
          MATCH     SP70,SCHFLD01
          GOTO      HFMHLA61 IF EQUAL
          MATCH     SCHFLD01,FMHLINST
          GOTO      HFMHLA72 IF NOT EQUAL
HFMHLA61
          MATCH     SP70,SCHFLD02
          GOTO      HFMHLA62 IF EQUAL
          MATCH     SCHFLD02,FMHLDESC
          GOTO      HFMHLA72 IF NOT EQUAL
HFMHLA62
HFMHLA63
HFMHLA64
HFMHLA65
HFMHLA66
HFMHLA67
HFMHLA68
HFMHLA69
HFMHLA70
          GOTO      HFMHLA75
HFMHLA72  MOVE      ONE,OVRCD
HFMHLA75  RETURN
HFMHLA85
          LOAD      KEY3,XITEMNO,ST1,ST2,ST3,ST4,ST5:
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY3,FMHLINST                                               
          CALL      RDFMHL1 
HFMHLA90
.                                                                               
          BEEP
          GOTO      HFMHLA20
HFMHLA91
          MOVE      SP70,FMHLDESC
          UNPACK    SP70,FMHLPILE,FMHLPIS1,FMHLPIS2,FMHLPIS3,FMHLPIS4
          UNPACK    SP70,FMHLPIS5,FMHLPIC1,FMHLPIC2,FMHLPIB1,FMHLPIB2
          UNPACK    SP70,FMHLPIRS,FMHLPIDS,FMHLPIP1,FMHLPIP2,FMHLPITD
          MOVE      SP70,FMHLSPAR
          MOVE      SP70,KEY3 
          MOVE      SP70,FMHLINST
          GOTO      HFMHLA96
HFMHLA92
          MOVE      SP70,KEY3 
          MOVE      SP70,FMHLINST
          LOAD      KEY3,CCITEM,ST1,ST2,ST3,ST4,ST5:                            
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY3,FMHLINST                                               
HFMHLA96
          PUTSCR    CSSCRNUM,HLEF,HTOP,HRIG,HBOT
          CALL      FRESCR00
          MOVE      ZERO,HTOP
          MOVE      ZERO,HLEF
          MOVE      ZERO,HBOT
          MOVE      ZERO,HRIG
HFMHLA99
          RETURN

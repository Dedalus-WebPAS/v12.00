.-------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.00.00"
.-------------------------------------------------------
. V9.02.00  03.05.2002  Glenn Saunders
.           Export to new release i.e. v9.02 from vf.09
.-------------------------------------------------------
LOADFILE  FILE      ASCII, FIXED=80
.
LOADREG   DIM       2
LOADASS   DIM       12
LOADBLD   DIM       3
LOADLOC   DIM       6
LOADCOM   DIM       30
LOADMESS  DIM       52
.-------------------------------------------------------
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBAAMS64
.   Function      :   Stocktake Processing                    
.   Generated  On :   13/12/2005
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       AMSCODFD/INC
          INC       AMSCONFD/INC
          INC       AMSLOCFD/INC
          INC       AMSLOHFD/INC
          INC       AMSMASFD/INC
          INC       AMSSTMFD/INC
          INC       AMSSTPFD/INC
          INC       IBAPASFD/INC
.=========================
.Local Variable Definition
.-------------------------
ENDKEY    DIM     127 * Scr 00 Fld    10
LASTBLD   DIM       3 * Scr 00 Fld    11
LASTLOC   DIM       6 * Scr 00 Fld    12
FIRSTIND  FORM      1 * Scr 00 Fld    13
FROMBLD   DIM      45 * Scr 01 Fld     4
TOBLD     DIM      45 * Scr 01 Fld     5
FROMLOC   DIM      45 * Scr 01 Fld     6
TOLOC     DIM      45 * Scr 01 Fld     7
FROMTYP   DIM      45 * Scr 01 Fld     8
TOTYP     DIM      45 * Scr 01 Fld     9
FROMDPT   DIM      45 * Scr 01 Fld    10
TODPT     DIM      45 * Scr 01 Fld    11
FROMDATE  DIM      10 * Scr 01 Fld    12
TODATE    DIM      10 * Scr 01 Fld    13
BLDDESC   DIM      35 * Scr 03 Fld     4
LOADNAME  DIM      40 * Scr 05 Fld     5
ABORTFLG  FORM      1 * Scr PD Fld    17
CHECKYN   FORM      1 * Scr PD Fld    18
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBAAMS64"
PRGNAM    INIT      "Stocktake Processing                    "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          MOVE      PORT,PARENTID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      SC00L000
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          MOVE      "    3",AUDTSECT
          MOVE      " 10",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening amsaudma";
            OPEN      AMSAUDMA,"amsaudma"
          ENDIF
          DISPLAY   *P56:24,"Opening amscodaf";
          OPEN      AMSCODA1,"amscodaf"
          DISPLAY   *P56:24,"Opening amscodaf";
          OPEN      AMSCODA2,"amscodaf"
          DISPLAY   *P56:24,"Opening amslocaf";
          OPEN      AMSLOCA1,"amslocaf"
          DISPLAY   *P56:24,"Opening amslohaf";
          OPEN      AMSLOHA1,"amslohaf"
          DISPLAY   *P56:24,"Opening amsmasaf";
          OPEN      AMSMASA1,"amsmasaf"
          DISPLAY   *P56:24,"Opening amsmasaf";
          OPEN      AMSMASA2,"amsmasaf"
          DISPLAY   *P56:24,"Opening amsmasaf";
          OPEN      AMSMASA3,"amsmasaf"
          DISPLAY   *P56:24,"Opening amsmasaf";
          OPEN      AMSMASA4,"amsmasaf"
          DISPLAY   *P56:24,"Opening amsmasaf";
          OPEN      AMSMASA5,"amsmasaf"
          DISPLAY   *P56:24,"Opening amsmasaf";
          OPEN      AMSMASA6,"amsmasaf"
          DISPLAY   *P56:24,"Opening amsmasaf";
          OPEN      AMSMASA7,"amsmasaf"
          DISPLAY   *P56:24,"Opening amsmasaf";
          OPEN      AMSMASA8,"amsmasaf"
          DISPLAY   *P56:24,"Opening amsstmaf";
          OPEN      AMSSTMA1,"amsstmaf"
          DISPLAY   *P56:24,"Opening amsstpaf";
          OPEN      AMSSTPA1,"amsstpaf"
          DISPLAY   *P56:24,"Opening amsstpaf";
          OPEN      AMSSTPA2,"amsstpaf"
          DISPLAY   *P56:24,"Opening  ihapassf           ";
          OPEN      IHAPASS1,"ihapassf"          
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "00",SCRID
          IF         @EQUAL
            CALL       PS00L000   * Options                            
          ENDIF
          MATCH     "01",SCRID
          IF         @EQUAL
            CALL       PS01L000   * Stocktake Generation               
          ENDIF
          MATCH     "02",SCRID
          IF         @EQUAL
            CALL       PS02L000   * Print Stocktake Report             
          ENDIF
          MATCH     "03",SCRID
          IF         @EQUAL
            CALL       PS03L000   * Process Stocktake                  
          ENDIF
          MATCH     "04",SCRID
          IF         @EQUAL
            CALL       PS04L000   * Abort Stocktake                    
          ENDIF
          MATCH     "05",SCRID
          IF         @EQUAL
            CALL       PS05L000   * Load Bar Code ASCII File           
          ENDIF
          MATCH     "PD",SCRID
          IF         @EQUAL
            CALL       PSPDL000   * Processing Details Screen          
          ENDIF
          RETURN
.--------------------------------
. Screen - Options                            
.--------------------------------
SC00L000
SC00L100
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC00L200
          CALL      CF00L000 * Clear Fields
SC00L300
          CALL      KY00L000 * Enter Key Fields
          BRANCH    EXIT,SC00L999,SC00L999
SC00L400
          CALL      WP00L000 * Load any WP Details
SC00L500
          CALL      LM00L000 * Load any Batch Details
SC00L600
          CALL      DF00L000 * Display Fields
SC00L700
          CALL      SF00L000 * Select Fields
          BRANCH    EXIT,SC00L100,SC00L100,SC00L200
SC00L800
SC00L900
SC00L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Options                            
.-------------------------------------------------------
CF00L000
CF00L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Options                            
.--------------------------------------------------------
KY00L000
          MOVE      ZERO,EXIT
          GOTO      KY00L999
.
KY00L900  MOVE      ONE,EXIT
KY00L999  RETURN
.---------------------------------------------------------
. Load WP files for : Options                            
.---------------------------------------------------------
WP00L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Options                            
.---------------------------------------------------------
LM00L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Options                            
.---------------------------------------------------------
DF00L000
          BRANCH   ACCEPT,DF00L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF00L900
          MATCH    PRGID,SCPSPID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF00L010 IF NOT EQUAL
.
          CALL     PS00L000 * Display Field
          GOTO     DF00L010
DF00L900
DF00L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Options                            
.---------------------------------------------------------
PS00L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS00L999,PS00L999,PS00L999,PS00L999:
                            PS00L999,PS00L999,PS00L999,PS00L999:
                           PS00L999,PS00L101,PS00L102,PS00L103:
                            PS00L104
          GOTO     PS00L999
.
PS00L101
          MOVE      ENDKEY,VAR       
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L102
          MOVE      LASTBLD,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L103
          MOVE      LASTLOC,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L104
          MOVE      FIRSTIND,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
PS00L999
          RETURN
.---------------------------------------------------------
. Selections for : Options                            
.---------------------------------------------------------
SF00L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF00L001  BRANCH   ACCEPT,SF00L020
.
SF00L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L006,SF00L101,SF00L102,SF00L103:
                            SF00L104,SF00L105,SF00L106,SF00L006:
                           SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006
SF00L006  BEEP
          GOTO     SF00L005
SF00L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF00L090
          MATCH    PRGID,SCSLPID
          GOTO     SF00L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF00L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                           SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020
          GOTO     SF00L020
SF00L090  MOVE     ZERO,ACCEPT
          GOTO     SF00L001
.
SF00L101
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L102
          CALL      SC01L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L103
          CALL      SC02L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L104
          CALL      SC03L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L105
          CALL      SC04L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L106
          CALL      SC05L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
SF00L990  MOVE      ONE,EXIT * Exit Char Restart
SF00L999  RETURN
.--------------------------------
. Screen - Stocktake Generation               
.--------------------------------
SC01L000
SC01L100
          MOVE      "01",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "   30",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC01L200
          CALL      CF01L000 * Clear Fields
SC01L300
          CALL      KY01L000 * Enter Key Fields
          BRANCH    EXIT,SC01L999,SC01L999
SC01L400
          CALL      WP01L000 * Load any WP Details
SC01L500
          CALL      LM01L000 * Load any Batch Details
SC01L600
          CALL      DF01L000 * Display Fields
SC01L700
          CALL      SF01L000 * Select Fields
          BRANCH    EXIT,SC01L100,SC01L100,SC01L200
SC01L800
SC01L900
SC01L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Stocktake Generation               
.-------------------------------------------------------
CF01L000
          MOVE      SP70,AMSMOPR 
          MOVE      SP70,FROMBLD 
          MOVE      SP70,FROMLOC 
          MOVE      SP70,FROMTYP 
          MOVE      SP70,FROMDPT 
          MOVE      SP70,FROMDATE
          MOVE      SP70,AMSMCOM 
          MOVE      SP70,AMSMUR1 
          MOVE      SP70,AMSMUR2 
          MOVE      SP70,AMSMUD1 
          MOVE      SP70,AMSMUD2 
          MOVE      SP70,AMSMUY1 
          MOVE      SP70,AMSMUY2 
CF01L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Stocktake Generation               
.--------------------------------------------------------
KY01L000
.
KY01L110
.
.
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,AMSMDAT 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    2",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,AMSMTIM 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   21",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SECUSER 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          MOVE      "    3",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "1",CKEYTYP
          CALL      KPASS000
          BRANCH    EXIT,KY01L900,KY01L900
          MOVE      ONE,ACCEPT
          MOVE      AMSMOPR,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            UNPACK    AMSMDAT,CCENT,CYEAR,CMON,CDAY           
            CALL      PACDATE
            MOVE      CPCDATE,VAR
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    2",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      AMSMTIM,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   21",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SECUSER,VAR      
            CALL      DISPITEM
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      KY01L999
.
KY01L900  MOVE      ONE,EXIT
KY01L999  RETURN
.---------------------------------------------------------
. Load WP files for : Stocktake Generation               
.---------------------------------------------------------
WP01L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Stocktake Generation               
.---------------------------------------------------------
LM01L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Stocktake Generation               
.---------------------------------------------------------
DF01L000
          BRANCH   ACCEPT,DF01L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF01L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF01L900
          MATCH    PRGID,SCPSPID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF01L010 IF NOT EQUAL
.
          CALL     PS01L000 * Display Field
          GOTO     DF01L010
DF01L900
DF01L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Stocktake Generation               
.---------------------------------------------------------
PS01L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS01L101,PS01L102,PS01L999,PS01L103:
                            PS01L104,PS01L105,PS01L106,PS01L107:
                            PS01L108,PS01L109,PS01L110,PS01L111:
                            PS01L112,PS01L113,PS01L114,PS01L115:
                            PS01L116,PS01L117,PS01L118,PS01L119:
                            PS01L120,PS01L999,PS01L999,PS01L999:
                           PS01L999,PS01L999,PS01L999,PS01L999:
                           PS01L999,PS01L999,PS01L999,PS01L999
          GOTO     PS01L999
.
PS01L101
          UNPACK    AMSMDAT,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L102
          MOVE      AMSMTIM,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L103
          MOVE      FROMBLD,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L104
          MOVE      TOBLD,VAR        
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L105
          MOVE      FROMLOC,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L106
          MOVE      TOLOC,VAR        
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L107
          MOVE      FROMTYP,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L108
          MOVE      TOTYP,VAR        
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L109
          MOVE      FROMDPT,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L110
          MOVE      TODPT,VAR        
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L111
          MOVE      FROMDATE,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L112
          MOVE      TODATE,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L113
          MOVE      AMSMCOM,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L114
          MOVE      AMSMUR1,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L115
          MOVE      AMSMUR2,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L116
          UNPACK    AMSMUD1,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L117
          UNPACK    AMSMUD2,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L118
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      AMSMUY1,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L119
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      AMSMUY2,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L120
          MOVE      SECUSER,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
PS01L999
          RETURN
.---------------------------------------------------------
. Selections for : Stocktake Generation               
.---------------------------------------------------------
SF01L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF01L001  BRANCH   ACCEPT,SF01L020
.
SF01L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L006,SF01L006,SF01L006,SF01L101:
                            SF01L006,SF01L102,SF01L006,SF01L103:
                            SF01L006,SF01L104,SF01L006,SF01L105:
                            SF01L006,SF01L106,SF01L107,SF01L108:
                            SF01L109,SF01L110,SF01L111,SF01L112:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                           SF01L006,SF01L006,SF01L006,SF01L006:
                           SF01L006,SF01L006,SF01L113,SF01L114
SF01L006  BEEP
          GOTO     SF01L005
SF01L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF01L090
          MATCH    PRGID,SCSLPID
          GOTO     SF01L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF01L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L020,SF01L020,SF01L020,SF01L101:
                            SF01L020,SF01L102,SF01L020,SF01L103:
                            SF01L020,SF01L104,SF01L020,SF01L105:
                            SF01L020,SF01L106,SF01L107,SF01L108:
                            SF01L109,SF01L110,SF01L111,SF01L112:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                           SF01L020,SF01L020,SF01L020,SF01L020:
                           SF01L020,SF01L020,SF01L020,SF01L020
          GOTO     SF01L020
SF01L090  MOVE     ZERO,ACCEPT
          GOTO     SF01L001
.
SF01L101
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOBLD   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      RBLD0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF01L101
            ENDIF
            BRANCH    EXIT,SF01L101,SF01L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF01L990 IF EQUAL
          ENDIF
          MOVE      FROMBLD,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOBLD,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF01L001
.
SF01L102
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOLOC   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      RLOC0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF01L102
            ENDIF
            BRANCH    EXIT,SF01L102,SF01L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF01L990 IF EQUAL
          ENDIF
          MOVE      FROMLOC,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOLOC,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF01L001
.
SF01L103
.
.
          MOVE      "    9",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOTYP   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      RTYP0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF01L103
            ENDIF
            BRANCH    EXIT,SF01L103,SF01L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF01L990 IF EQUAL
          ENDIF
          MOVE      FROMTYP,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    9",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOTYP,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF01L001
.
SF01L104
.
.
          MOVE      "   11",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TODPT   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      RDPT0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF01L104
            ENDIF
            BRANCH    EXIT,SF01L104,SF01L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF01L990 IF EQUAL
          ENDIF
          MOVE      FROMDPT,VAR      
          CALL      DISPITEM
.
.
          MOVE      "   11",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TODPT,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF01L001
.
SF01L105
.
.
          MOVE      "   13",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TODATE  
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      RDAT0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF01L105
            ENDIF
            BRANCH    EXIT,SF01L105,SF01L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF01L990 IF EQUAL
          ENDIF
          MOVE      FROMDATE,VAR     
          CALL      DISPITEM
.
.
          MOVE      "   13",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TODATE,VAR       
            CALL      DISPITEM
          ENDIF
          GOTO     SF01L001
.
SF01L106
          CALL     SELECTED
          STRIP     AMSMCOM 
          SFORMAT   VAR,SCPSLEN
          MOVE      AMSMCOM,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,AMSMCOM 
          SFORMAT   VAR,127
          ENDSET    AMSMCOM 
          APPEND    SP70,AMSMCOM 
          RESET     AMSMCOM 
          CMATCH    EXITCHAR,AMSMCOM 
          GOTO      SF01L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,AMSMCOM 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF01L106
            ENDIF
          ENDIF
          MOVE      AMSMCOM,VAR      
          CALL      DISPITEM
          GOTO     SF01L001
.
SF01L107
          CALL     SELECTED
          STRIP     AMSMUR1 
          SFORMAT   VAR,SCPSLEN
          MOVE      AMSMUR1,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,AMSMUR1 
          SFORMAT   VAR,127
          ENDSET    AMSMUR1 
          APPEND    SP70,AMSMUR1 
          RESET     AMSMUR1 
          CMATCH    EXITCHAR,AMSMUR1 
          GOTO      SF01L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,AMSMUR1 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF01L107
            ENDIF
          ENDIF
          MOVE      AMSMUR1,VAR      
          CALL      DISPITEM
          GOTO     SF01L001
.
SF01L108
          CALL     SELECTED
          STRIP     AMSMUR2 
          SFORMAT   VAR,SCPSLEN
          MOVE      AMSMUR2,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,AMSMUR2 
          SFORMAT   VAR,127
          ENDSET    AMSMUR2 
          APPEND    SP70,AMSMUR2 
          RESET     AMSMUR2 
          CMATCH    EXITCHAR,AMSMUR2 
          GOTO      SF01L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,AMSMUR2 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF01L108
            ENDIF
          ENDIF
          MOVE      AMSMUR2,VAR      
          CALL      DISPITEM
          GOTO     SF01L001
.
SF01L109
          CALL     SELECTED
          CALL      KEYDATE
          PACK      AMSMUD1,CCENT,CYEAR,CMON,CDAY           
          UNPACK    AMSMUD1,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     SF01L001
.
SF01L110
          CALL     SELECTED
          CALL      KEYDATE
          PACK      AMSMUD2,CCENT,CYEAR,CMON,CDAY           
          UNPACK    AMSMUD2,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     SF01L001
.
SF01L111
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,AMSMUY1 
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      AMSMUY1,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF01L001
.
SF01L112
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,AMSMUY2 
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      AMSMUY2,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF01L001
.
SF01L113
          MOVE      ZERO,EXIT
          GOTO      SF01L999
.
SF01L114
          CALL      GENER000
          MOVE      ZERO,EXIT
          GOTO      SF01L999
SF01L990  MOVE      ONE,EXIT * Exit Char Restart
SF01L999  RETURN
.--------------------------------
. Screen - Print Stocktake Report             
.--------------------------------
SC02L000
SC02L100
          MOVE      "02",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "   30",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC02L200
          CALL      CF02L000 * Clear Fields
SC02L300
          CALL      KY02L000 * Enter Key Fields
          BRANCH    EXIT,SC02L999,SC02L999
SC02L400
          CALL      WP02L000 * Load any WP Details
SC02L500
          CALL      LM02L000 * Load any Batch Details
SC02L600
          CALL      DF02L000 * Display Fields
SC02L700
          CALL      SF02L000 * Select Fields
          BRANCH    EXIT,SC02L100,SC02L100,SC02L200
SC02L800
SC02L900
SC02L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Print Stocktake Report             
.-------------------------------------------------------
CF02L000
          MOVE      SP70,AMSMSTK 
CF02L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Print Stocktake Report             
.--------------------------------------------------------
KY02L000
.
KY02L110
.
.
          MOVE      "   21",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SECUSER 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          MOVE      "    3",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      ESTOK000
          BRANCH    EXIT,KY02L900,KY02L900
          MOVE      ZERO,ACCEPT
          MOVE      AMSMSTK,VAR      
          CALL      DISPITEM
.
.
          MOVE      "   21",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SECUSER,VAR      
            CALL      DISPITEM
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      KY02L999
.
KY02L900  MOVE      ONE,EXIT
KY02L999  RETURN
.---------------------------------------------------------
. Load WP files for : Print Stocktake Report             
.---------------------------------------------------------
WP02L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Print Stocktake Report             
.---------------------------------------------------------
LM02L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Print Stocktake Report             
.---------------------------------------------------------
DF02L000
          BRANCH   ACCEPT,DF02L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF02L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF02L900
          MATCH    PRGID,SCPSPID
          GOTO     DF02L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF02L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF02L010 IF NOT EQUAL
.
          CALL     PS02L000 * Display Field
          GOTO     DF02L010
DF02L900
DF02L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Print Stocktake Report             
.---------------------------------------------------------
PS02L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS02L101,PS02L102,PS02L999,PS02L103:
                            PS02L104,PS02L105,PS02L106,PS02L107:
                            PS02L108,PS02L109,PS02L110,PS02L111:
                            PS02L112,PS02L113,PS02L114,PS02L115:
                            PS02L116,PS02L117,PS02L118,PS02L119:
                            PS02L120,PS02L999,PS02L999,PS02L999:
                           PS02L999,PS02L999,PS02L999,PS02L999:
                           PS02L999,PS02L999,PS02L999,PS02L999
          GOTO     PS02L999
.
PS02L101
          UNPACK    AMSMDAT,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L102
          MOVE      AMSMTIM,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L103
          MOVE      FROMBLD,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L104
          MOVE      TOBLD,VAR        
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L105
          MOVE      FROMLOC,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L106
          MOVE      TOLOC,VAR        
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L107
          MOVE      FROMTYP,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L108
          MOVE      TOTYP,VAR        
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L109
          MOVE      FROMDPT,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L110
          MOVE      TODPT,VAR        
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L111
          MOVE      FROMDATE,VAR     
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L112
          MOVE      TODATE,VAR       
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L113
          MOVE      AMSMCOM,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L114
          MOVE      AMSMUR1,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L115
          MOVE      AMSMUR2,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L116
          UNPACK    AMSMUD1,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L117
          UNPACK    AMSMUD2,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L118
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      AMSMUY1,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L119
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      AMSMUY2,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L120
          MOVE      SECUSER,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
PS02L999
          RETURN
.---------------------------------------------------------
. Selections for : Print Stocktake Report             
.---------------------------------------------------------
SF02L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF02L001  BRANCH   ACCEPT,SF02L020
.
SF02L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF02L006,SF02L006,SF02L006,SF02L006:
                            SF02L006,SF02L006,SF02L006,SF02L006:
                            SF02L006,SF02L006,SF02L006,SF02L006:
                            SF02L006,SF02L006,SF02L006,SF02L006:
                            SF02L006,SF02L006,SF02L006,SF02L006:
                            SF02L006,SF02L006,SF02L006,SF02L006:
                           SF02L006,SF02L006,SF02L006,SF02L006:
                           SF02L006,SF02L006,SF02L101,SF02L102
SF02L006  BEEP
          GOTO     SF02L005
SF02L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF02L090
          MATCH    PRGID,SCSLPID
          GOTO     SF02L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF02L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF02L020,SF02L020,SF02L020,SF02L020:
                            SF02L020,SF02L020,SF02L020,SF02L020:
                            SF02L020,SF02L020,SF02L020,SF02L020:
                            SF02L020,SF02L020,SF02L020,SF02L020:
                            SF02L020,SF02L020,SF02L020,SF02L020:
                            SF02L020,SF02L020,SF02L020,SF02L020:
                           SF02L020,SF02L020,SF02L020,SF02L020:
                           SF02L020,SF02L020,SF02L020,SF02L020
          GOTO     SF02L020
SF02L090  MOVE     ZERO,ACCEPT
          GOTO     SF02L001
.
SF02L101
          MOVE      ZERO,EXIT
          GOTO      SF02L999
.
SF02L102
          CALL      PRINT000
          MOVE      ZERO,EXIT
          GOTO      SF02L999
SF02L990  MOVE      ONE,EXIT * Exit Char Restart
SF02L999  RETURN
.--------------------------------
. Screen - Process Stocktake                  
.--------------------------------
SC03L000
SC03L100
          MOVE      "03",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          CALL      SBACK000 * Display Background
.
SC03L200
          CALL      CF03L000 * Clear Fields
SC03L300
          CALL      KY03L000 * Enter Key Fields
          BRANCH    EXIT,SC03L999,SC03L999
SC03L400
          CALL      WP03L000 * Load any WP Details
SC03L500
          CALL      LM03L000 * Load any Batch Details
SC03L600
          CALL      DF03L000 * Display Fields
SC03L700
          CALL      SF03L000 * Select Fields
          BRANCH    EXIT,SC03L100,SC03L100,SC03L200
SC03L800
SC03L900
SC03L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Process Stocktake                  
.-------------------------------------------------------
CF03L000
          MOVE      SP70,AMSTSTK 
          MOVE      SP70,AMSTBLD 
          MOVE      SP70,AMSTLOC 
CF03L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Process Stocktake                  
.--------------------------------------------------------
KY03L000
.
KY03L110
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      KAMSMA00
          MOVE      AMSMSTK,AMSTSTK
          BRANCH    EXIT,KY03L900,KY03L900
          MOVE      ZERO,ACCEPT
          MOVE      AMSTSTK,VAR      
          CALL      DISPITEM
.
KY03L120
.
.
          MOVE      "    4",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,BLDDESC 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          MOVE      "    2",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      EBLD0000
          BRANCH    EXIT,KY03L110,KY03L900
          MOVE      ZERO,ACCEPT
          MOVE      AMSTBLD,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    4",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      BLDDESC,VAR      
            CALL      DISPITEM
          ENDIF
.
KY03L130
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,AMLODES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          MOVE      "    3",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      ELOC0000
          BRANCH    EXIT,KY03L120,KY03L900
          MOVE      ZERO,ACCEPT
          MOVE      AMSTLOC,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      AMLODES,VAR      
            CALL      DISPITEM
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      KY03L999
.
KY03L900  MOVE      ONE,EXIT
KY03L999  RETURN
.---------------------------------------------------------
. Load WP files for : Process Stocktake                  
.---------------------------------------------------------
WP03L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Process Stocktake                  
.---------------------------------------------------------
LM03L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Process Stocktake                  
.---------------------------------------------------------
DF03L000
          BRANCH   ACCEPT,DF03L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF03L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF03L900
          MATCH    PRGID,SCPSPID
          GOTO     DF03L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF03L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF03L010 IF NOT EQUAL
.
          CALL     PS03L000 * Display Field
          GOTO     DF03L010
DF03L900
DF03L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Process Stocktake                  
.---------------------------------------------------------
PS03L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS03L999,PS03L999,PS03L999,PS03L101:
                            PS03L102
          GOTO     PS03L999
.
PS03L101
          MOVE      BLDDESC,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L102
          MOVE      AMLODES,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
PS03L999
          RETURN
.---------------------------------------------------------
. Selections for : Process Stocktake                  
.---------------------------------------------------------
SF03L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF03L001  BRANCH   ACCEPT,SF03L020
.
SF03L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF03L006,SF03L006,SF03L006,SF03L006:
                            SF03L006
SF03L006  BEEP
          GOTO     SF03L005
SF03L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF03L090
          MATCH    PRGID,SCSLPID
          GOTO     SF03L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF03L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF03L020,SF03L020,SF03L020,SF03L020:
                            SF03L020
          GOTO     SF03L020
SF03L090  MOVE     ZERO,ACCEPT
          GOTO     SF03L001
SF03L990  MOVE      ONE,EXIT * Exit Char Restart
SF03L999  RETURN
.--------------------------------
. Screen - Abort Stocktake                    
.--------------------------------
SC04L000
SC04L100
          MOVE      "04",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "   30",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC04L200
          CALL      CF04L000 * Clear Fields
SC04L300
          CALL      KY04L000 * Enter Key Fields
          BRANCH    EXIT,SC04L999,SC04L999
SC04L400
          CALL      WP04L000 * Load any WP Details
SC04L500
          CALL      LM04L000 * Load any Batch Details
SC04L600
          CALL      DF04L000 * Display Fields
SC04L700
          CALL      SF04L000 * Select Fields
          BRANCH    EXIT,SC04L100,SC04L100,SC04L200
SC04L800
SC04L900
SC04L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Abort Stocktake                    
.-------------------------------------------------------
CF04L000
          MOVE      SP70,AMSMSTK 
CF04L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Abort Stocktake                    
.--------------------------------------------------------
KY04L000
.
KY04L110
.
.
          MOVE      "   21",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SECUSER 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          MOVE      "    3",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      ESTOK000
          BRANCH    EXIT,KY04L900,KY04L900
          MOVE      ZERO,ACCEPT
          MOVE      AMSMSTK,VAR      
          CALL      DISPITEM
.
.
          MOVE      "   21",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SECUSER,VAR      
            CALL      DISPITEM
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      KY04L999
.
KY04L900  MOVE      ONE,EXIT
KY04L999  RETURN
.---------------------------------------------------------
. Load WP files for : Abort Stocktake                    
.---------------------------------------------------------
WP04L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Abort Stocktake                    
.---------------------------------------------------------
LM04L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Abort Stocktake                    
.---------------------------------------------------------
DF04L000
          BRANCH   ACCEPT,DF04L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF04L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF04L900
          MATCH    PRGID,SCPSPID
          GOTO     DF04L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF04L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF04L010 IF NOT EQUAL
.
          CALL     PS04L000 * Display Field
          GOTO     DF04L010
DF04L900
DF04L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Abort Stocktake                    
.---------------------------------------------------------
PS04L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS04L101,PS04L102,PS04L999,PS04L103:
                            PS04L104,PS04L105,PS04L106,PS04L107:
                            PS04L108,PS04L109,PS04L110,PS04L111:
                            PS04L112,PS04L113,PS04L114,PS04L115:
                            PS04L116,PS04L117,PS04L118,PS04L119:
                            PS04L120,PS04L999,PS04L999,PS04L999:
                           PS04L999,PS04L999,PS04L999,PS04L999:
                           PS04L999,PS04L999,PS04L999,PS04L999
          GOTO     PS04L999
.
PS04L101
          UNPACK    AMSMDAT,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L102
          MOVE      AMSMTIM,VAR      
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L103
          MOVE      FROMBLD,VAR      
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L104
          MOVE      TOBLD,VAR        
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L105
          MOVE      FROMLOC,VAR      
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L106
          MOVE      TOLOC,VAR        
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L107
          MOVE      FROMTYP,VAR      
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L108
          MOVE      TOTYP,VAR        
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L109
          MOVE      FROMDPT,VAR      
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L110
          MOVE      TODPT,VAR        
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L111
          MOVE      FROMDATE,VAR     
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L112
          MOVE      TODATE,VAR       
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L113
          MOVE      AMSMCOM,VAR      
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L114
          MOVE      AMSMUR1,VAR      
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L115
          MOVE      AMSMUR2,VAR      
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L116
          UNPACK    AMSMUD1,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L117
          UNPACK    AMSMUD2,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L118
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      AMSMUY1,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L119
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      AMSMUY2,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L120
          MOVE      SECUSER,VAR      
          CALL      DISPITEM
          GOTO     PS04L999
PS04L999
          RETURN
.---------------------------------------------------------
. Selections for : Abort Stocktake                    
.---------------------------------------------------------
SF04L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF04L001  BRANCH   ACCEPT,SF04L020
.
SF04L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF04L006,SF04L006,SF04L006,SF04L006:
                            SF04L006,SF04L006,SF04L006,SF04L006:
                            SF04L006,SF04L006,SF04L006,SF04L006:
                            SF04L006,SF04L006,SF04L006,SF04L006:
                            SF04L006,SF04L006,SF04L006,SF04L006:
                            SF04L006,SF04L006,SF04L006,SF04L006:
                           SF04L006,SF04L006,SF04L006,SF04L006:
                           SF04L006,SF04L006,SF04L101,SF04L102
SF04L006  BEEP
          GOTO     SF04L005
SF04L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF04L090
          MATCH    PRGID,SCSLPID
          GOTO     SF04L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF04L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF04L020,SF04L020,SF04L020,SF04L020:
                            SF04L020,SF04L020,SF04L020,SF04L020:
                            SF04L020,SF04L020,SF04L020,SF04L020:
                            SF04L020,SF04L020,SF04L020,SF04L020:
                            SF04L020,SF04L020,SF04L020,SF04L020:
                            SF04L020,SF04L020,SF04L020,SF04L020:
                           SF04L020,SF04L020,SF04L020,SF04L020:
                           SF04L020,SF04L020,SF04L020,SF04L020
          GOTO     SF04L020
SF04L090  MOVE     ZERO,ACCEPT
          GOTO     SF04L001
.
SF04L101
          MOVE      ZERO,EXIT
          GOTO      SF04L999
.
SF04L102
          CALL      ABORT000
          MOVE      ZERO,EXIT
          GOTO      SF04L999
SF04L990  MOVE      ONE,EXIT * Exit Char Restart
SF04L999  RETURN
.--------------------------------
. Screen - Load Bar Code ASCII File           
.--------------------------------
SC05L000
SC05L100
          MOVE      "05",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC05L200
          CALL      CF05L000 * Clear Fields
          CALL      MVACCEPT
SC05L300
          CALL      KY05L000 * Enter Key Fields
          BRANCH    EXIT,SC05L999,SC05L999
SC05L400
          CALL      WP05L000 * Load any WP Details
SC05L500
          CALL      LM05L000 * Load any Batch Details
SC05L600
          CALL      DF05L000 * Display Fields
SC05L700
          CALL      SF05L000 * Select Fields
          BRANCH    EXIT,SC05L100,SC05L100,SC05L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC05L800
SC05L900
SC05L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Load Bar Code ASCII File           
.-------------------------------------------------------
CF05L000
          MOVE      SP70,AMSTSTK 
          MOVE      SP70,LOADNAME
CF05L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Load Bar Code ASCII File           
.--------------------------------------------------------
KY05L000
          MOVE      ZERO,EXIT
          GOTO      KY05L999
.
KY05L900  MOVE      ONE,EXIT
KY05L999  RETURN
.---------------------------------------------------------
. Load WP files for : Load Bar Code ASCII File           
.---------------------------------------------------------
WP05L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Load Bar Code ASCII File           
.---------------------------------------------------------
LM05L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Load Bar Code ASCII File           
.---------------------------------------------------------
DF05L000
          BRANCH   ACCEPT,DF05L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF05L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF05L900
          MATCH    PRGID,SCPSPID
          GOTO     DF05L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF05L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF05L010 IF NOT EQUAL
.
          CALL     PS05L000 * Display Field
          GOTO     DF05L010
DF05L900
DF05L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Load Bar Code ASCII File           
.---------------------------------------------------------
PS05L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS05L999,PS05L999,PS05L999,PS05L101:
                            PS05L102
          GOTO     PS05L999
.
PS05L101
          MOVE      AMSTSTK,VAR      
          CALL      DISPITEM
          GOTO     PS05L999
.
PS05L102
          MOVE      LOADNAME,VAR     
          CALL      DISPITEM
          GOTO     PS05L999
PS05L999
          RETURN
.---------------------------------------------------------
. Selections for : Load Bar Code ASCII File           
.---------------------------------------------------------
SF05L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF05L001  BRANCH   ACCEPT,SF05L020
.
SF05L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF05L006,SF05L101,SF05L102,SF05L103:
                            SF05L104
SF05L006  BEEP
          GOTO     SF05L005
SF05L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF05L090
          MATCH    PRGID,SCSLPID
          GOTO     SF05L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF05L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF05L020,SF05L020,SF05L020,SF05L103:
                            SF05L104
          GOTO     SF05L020
SF05L090  MOVE     ZERO,ACCEPT
          GOTO     SF05L001
.
SF05L101
          MOVE      ZERO,EXIT
          GOTO      SF05L999
.
SF05L102
          CALL      LOAD0000
          MOVE      ZERO,EXIT
          GOTO      SF05L999
.
SF05L103
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KAMSMA00
          MOVE      AMSMSTK,AMSTSTK
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF05L103
            ENDIF
            BRANCH    EXIT,SF05L103,SF05L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF05L990 IF EQUAL
          ENDIF
          MOVE      AMSTSTK,VAR      
          CALL      DISPITEM
          GOTO     SF05L001
.
SF05L104
          CALL     SELECTED
          STRIP     LOADNAME
          SFORMAT   VAR,SCPSLEN
          MOVE      LOADNAME,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,LOADNAME
          SFORMAT   VAR,127
          ENDSET    LOADNAME
          APPEND    SP70,LOADNAME
          RESET     LOADNAME
          CMATCH    EXITCHAR,LOADNAME
          GOTO      SF05L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,LOADNAME
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF05L104
            ENDIF
          ENDIF
          MOVE      LOADNAME,VAR     
          CALL      DISPITEM
          GOTO     SF05L001
SF05L990  MOVE      FOUR,EXIT * Exit Char Exit
SF05L999  RETURN
.--------------------------------
. Screen - Processing Details Screen          
.--------------------------------
SCPDL000
SCPDL100
          MOVE      "PD",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "   27",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          MOVE      "  1",CLEF
          MOVE      " 80",CRIG
          MOVE      " 7",CTOP
          MOVE      "24",CBOT
          CALL      VBACK000 * Display Background
          MOVE      ZERO,CLEF
          MOVE      ZERO,CTOP
          MOVE      ZERO,CRIG
          MOVE      ZERO,CBOT
.
SCPDL200
          CALL      CFPDL000 * Clear Fields
SCPDL300
          CALL      KYPDL000 * Enter Key Fields
          BRANCH    EXIT,SCPDL999,SCPDL999
SCPDL400
          CALL      WPPDL000 * Load any WP Details
SCPDL500
          CALL      LMPDL000 * Load any Batch Details
SCPDL600
          CALL      DFPDL000 * Display Fields
SCPDL700
          CALL      SFPDL000 * Select Fields
          BRANCH    EXIT,SCPDL100,SCPDL100,SCPDL200
SCPDL800
SCPDL900
SCPDL999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Processing Details Screen          
.-------------------------------------------------------
CFPDL000
CFPDL999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Processing Details Screen          
.--------------------------------------------------------
KYPDL000
          MOVE      ZERO,EXIT
          GOTO      KYPDL999
.
KYPDL900  MOVE      ONE,EXIT
KYPDL999  RETURN
.---------------------------------------------------------
. Load WP files for : Processing Details Screen          
.---------------------------------------------------------
WPPDL000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Processing Details Screen          
.---------------------------------------------------------
LMPDL000
          RETURN
.---------------------------------------------------------
. Display Fields for : Processing Details Screen          
.---------------------------------------------------------
DFPDL000
          BRANCH   ACCEPT,DFPDL999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DFPDL010
          CALL     RKSCPS1
          BRANCH   OVRCD,DFPDL900
          MATCH    PRGID,SCPSPID
          GOTO     DFPDL900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DFPDL900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DFPDL010 IF NOT EQUAL
.
          CALL     PSPDL000 * Display Field
          GOTO     DFPDL010
DFPDL900
DFPDL999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Processing Details Screen          
.---------------------------------------------------------
PSPDL000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PSPDL101,PSPDL102,PSPDL103,PSPDL104:
                            PSPDL105,PSPDL106,PSPDL107,PSPDL108:
                            PSPDL109,PSPDL110,PSPDL111,PSPDL112:
                            PSPDL113,PSPDL114,PSPDL115,PSPDL116:
                            PSPDL117,PSPDL118,PSPDL999,PSPDL999:
                            PSPDL119,PSPDL120,PSPDL121,PSPDL122:
                            PSPDL123,PSPDL124,PSPDL999,PSPDL999:
                            PSPDL125,PSPDL126
          GOTO     PSPDL999
.
PSPDL101
          MOVE      AMSTREG,VAR      
          CALL      DISPITEM
          GOTO     PSPDL999
.
PSPDL102
          MOVE      AMSTASS,VAR      
          CALL      DISPITEM
          GOTO     PSPDL999
.
PSPDL103
          UNPACK    AMSTGDT,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PSPDL999
.
PSPDL104
          UNPACK    AMSTPDT,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PSPDL999
.
PSPDL105
          MOVE      AMSTCBY,VAR      
          CALL      DISPITEM
          GOTO     PSPDL999
.
PSPDL106
          MOVE      AMSTCOM,VAR      
          CALL      DISPITEM
          GOTO     PSPDL999
.
PSPDL107
          MOVE      AMSTLCM,VAR      
          CALL      DISPITEM
          GOTO     PSPDL999
.
PSPDL108
          MOVE      AMSTPOP,VAR      
          CALL      DISPITEM
          GOTO     PSPDL999
.
PSPDL109
          UNPACK    AMSTPDA,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PSPDL999
.
PSPDL110
          MOVE      AMSTPTM,VAR      
          CALL      DISPITEM
          GOTO     PSPDL999
.
PSPDL111
          MOVE      AMSTUR1,VAR      
          CALL      DISPITEM
          GOTO     PSPDL999
.
PSPDL112
          MOVE      AMSTUR2,VAR      
          CALL      DISPITEM
          GOTO     PSPDL999
.
PSPDL113
          UNPACK    AMSTUD1,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PSPDL999
.
PSPDL114
          UNPACK    AMSTUD2,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PSPDL999
.
PSPDL115
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      AMSTUY1,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PSPDL999
.
PSPDL116
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      AMSTUY2,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PSPDL999
.
PSPDL117
          MOVE      ABORTFLG,VAR     
          CALL      DISPITEM
          GOTO     PSPDL999
.
PSPDL118
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      CHECKYN,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PSPDL999
.
PSPDL119
          MOVE      AMMADES,VAR      
          CALL      DISPITEM
          GOTO     PSPDL999
.
PSPDL120
          MOVE      AMMATYP,VAR      
          CALL      DISPITEM
          GOTO     PSPDL999
.
PSPDL121
          MOVE      AMMADPT,VAR      
          CALL      DISPITEM
          GOTO     PSPDL999
.
PSPDL122
          UNPACK    AMMASDT,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PSPDL999
.
PSPDL123
          UNPACK    AMMAAQD,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PSPDL999
.
PSPDL124
          UNPACK    AMMADDT,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PSPDL999
.
PSPDL125
          MOVE      AMSTLOC,VAR      
          CALL      DISPITEM
          GOTO     PSPDL999
.
PSPDL126
          MOVE      AMLODES,VAR      
          CALL      DISPITEM
          GOTO     PSPDL999
PSPDL999
          RETURN
.---------------------------------------------------------
. Selections for : Processing Details Screen          
.---------------------------------------------------------
SFPDL000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SFPDL001  BRANCH   ACCEPT,SFPDL020
.
SFPDL005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SFPDL006,SFPDL006,SFPDL006,SFPDL101:
                            SFPDL102,SFPDL103,SFPDL006,SFPDL006:
                            SFPDL006,SFPDL006,SFPDL104,SFPDL105:
                            SFPDL106,SFPDL107,SFPDL108,SFPDL109:
                            SFPDL006,SFPDL110,SFPDL111,SFPDL112:
                            SFPDL006,SFPDL006,SFPDL006,SFPDL006:
                            SFPDL006,SFPDL006,SFPDL006,SFPDL113:
                            SFPDL006,SFPDL006
SFPDL006  BEEP
          GOTO     SFPDL005
SFPDL020  CALL     RKSCSL1
          BRANCH   OVRCD,SFPDL090
          MATCH    PRGID,SCSLPID
          GOTO     SFPDL090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SFPDL090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SFPDL020,SFPDL020,SFPDL020,SFPDL101:
                            SFPDL102,SFPDL103,SFPDL020,SFPDL020:
                            SFPDL020,SFPDL020,SFPDL104,SFPDL105:
                            SFPDL106,SFPDL107,SFPDL108,SFPDL109:
                            SFPDL020,SFPDL110,SFPDL020,SFPDL020:
                            SFPDL020,SFPDL020,SFPDL020,SFPDL020:
                            SFPDL020,SFPDL020,SFPDL020,SFPDL020:
                            SFPDL020,SFPDL020
          GOTO     SFPDL020
SFPDL090  MOVE     ZERO,ACCEPT
          GOTO     SFPDL001
.
SFPDL101
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      EPDT0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SFPDL101
            ENDIF
            BRANCH    EXIT,SFPDL101,SFPDL990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SFPDL990 IF EQUAL
          ENDIF
          UNPACK    AMSTPDT,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     SFPDL001
.
SFPDL102
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      ECBY0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SFPDL102
            ENDIF
            BRANCH    EXIT,SFPDL102,SFPDL990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SFPDL990 IF EQUAL
          ENDIF
          MOVE      AMSTCBY,VAR      
          CALL      DISPITEM
          GOTO     SFPDL001
.
SFPDL103
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      ECOM0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SFPDL103
            ENDIF
            BRANCH    EXIT,SFPDL103,SFPDL990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SFPDL990 IF EQUAL
          ENDIF
          MOVE      AMSTCOM,VAR      
          CALL      DISPITEM
          GOTO     SFPDL001
.
SFPDL104
          CALL     SELECTED
          STRIP     AMSTUR1 
          SFORMAT   VAR,SCPSLEN
          MOVE      AMSTUR1,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,AMSTUR1 
          SFORMAT   VAR,127
          ENDSET    AMSTUR1 
          APPEND    SP70,AMSTUR1 
          RESET     AMSTUR1 
          CMATCH    EXITCHAR,AMSTUR1 
          GOTO      SFPDL990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,AMSTUR1 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SFPDL104
            ENDIF
          ENDIF
          MOVE      AMSTUR1,VAR      
          CALL      DISPITEM
          GOTO     SFPDL001
.
SFPDL105
          CALL     SELECTED
          STRIP     AMSTUR2 
          SFORMAT   VAR,SCPSLEN
          MOVE      AMSTUR2,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,AMSTUR2 
          SFORMAT   VAR,127
          ENDSET    AMSTUR2 
          APPEND    SP70,AMSTUR2 
          RESET     AMSTUR2 
          CMATCH    EXITCHAR,AMSTUR2 
          GOTO      SFPDL990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,AMSTUR2 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SFPDL105
            ENDIF
          ENDIF
          MOVE      AMSTUR2,VAR      
          CALL      DISPITEM
          GOTO     SFPDL001
.
SFPDL106
          CALL     SELECTED
          CALL      KEYDATE
          PACK      AMSTUD1,CCENT,CYEAR,CMON,CDAY           
          UNPACK    AMSTUD1,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     SFPDL001
.
SFPDL107
          CALL     SELECTED
          CALL      KEYDATE
          PACK      AMSTUD2,CCENT,CYEAR,CMON,CDAY           
          UNPACK    AMSTUD2,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     SFPDL001
.
SFPDL108
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,AMSTUY1 
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      AMSTUY1,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SFPDL001
.
SFPDL109
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,AMSTUY2 
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      AMSTUY2,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SFPDL001
.
SFPDL110
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      ECYN0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SFPDL110
            ENDIF
            BRANCH    EXIT,SFPDL110,SFPDL990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SFPDL990 IF EQUAL
          ENDIF
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      CHECKYN,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SFPDL001
.
SFPDL111
          CALL      CANC0000
          MOVE      ZERO,EXIT
          GOTO      SFPDL999
.
SFPDL112
          CALL      ALOC0000
          MOVE      ZERO,EXIT
          GOTO      SFPDL999
.
SFPDL113
          CALL      POST0000
          MOVE      ZERO,EXIT
          GOTO      SFPDL999
SFPDL990  MOVE      ONE,EXIT * Exit Char Restart
SFPDL999  RETURN
.@@@@@ Function Restart Point @@@@@
.---------------------------------------------------------------------
. Get Passcode Detials etc.
.--------------------------
. NB. Zero Length Passcode allows field to be placed on the screen
.     for operational requirements but not seen for security reasons.
.---------------------------------------------------------------------
KPASS000  MOVE     PASSCODE,AMSMOPR
          MOVE     PASSCODE,KEY4
          CALL     RDPASS1
          PACK     AMSMDAT,CCC,CYY,CMM,CDD
          REP      " 0",AMSMDAT
          CLOCK    TIME,CTIMEIS
          MOVE     CTIMEIS,AMSMTIM
          MOVE     ONE,ACCEPT
          MOVE     ZERO,EXIT
          MOVE     ONE,OVRCD
          RETURN
RBLD0000   MOVE     "    4",FLDID
           CALL     GETPOSIT
           MOVE     SP70,VAR
           CALL     DISPITEM
           MOVE     "BL",AMCDCAT
           CALL     KAMCDA00
           BRANCH   EXIT,RBLD0100,RBLD0999
           MOVE     AMCDCOD,AMSMFBLD
           PACK     FROMBLD,AMCDCOD,SP1,AMCDDES
           GOTO     RBLD0150
RBLD0100   MOVE     "Start             ",FROMBLD
           MOVE     SP70,AMSMFBLD
.
RBLD0150   MOVE     "    5",FLDID
           CALL     GETPOSIT
           MOVE     SP70,VAR
           CALL     DISPITEM
           MOVE     "BL",AMCDCAT
           CALL     KAMCDA00
           BRANCH   EXIT,RBLD0200,RBLD0999
           MOVE     AMCDCOD,AMSMTBLD
           PACK     TOBLD,AMCDCOD,SP1,AMCDDES
           MATCH    AMSMFBLD,AMSMTBLD
           GOTO     RBLD0999 IF EQUAL
           GOTO     RBLD0999 IF NOT LESS
           BEEP
           MOVE     "To Building Must Be > From Building - ",DISPMSG
           CALL     MESSAGE1
           GOTO     RBLD0000
RBLD0200   MOVE     "Finish             ",TOBLD
           MOVE     "ZZZ",AMSMTBLD
.
RBLD0999   MOVE     "    4",FLDID
           CALL     GETPOSIT
           RETURN
RLOC0000   MOVE     "    6",FLDID
           CALL     GETPOSIT
           MOVE     SP70,VAR
           CALL     DISPITEM
           MATCH    AMSMFBLD,AMSMTBLD
           GOTO     RLOC0900 IF NOT EQUAL
.
           MOVE     AMSMFBLD,AMLOBLD
           CALL     KAMLOA00
           BRANCH   EXIT,RLOC0100,RLOC0999
           MOVE     AMLOLOC,AMSMFLOC
           PACK     FROMLOC,AMLOLOC,SP1,AMLODES
           GOTO     RLOC0150
RLOC0100   MOVE     "Start             ",FROMLOC
           MOVE     SP70,AMSMFLOC
.
RLOC0150   MOVE     "    7",FLDID
           CALL     GETPOSIT
           MOVE     SP70,VAR
           CALL     DISPITEM
           MOVE     AMSMFBLD,AMLOBLD
           CALL     KAMLOA00
           BRANCH   EXIT,RLOC0200,RLOC0999
           MOVE     AMLOLOC,AMSMTLOC
           PACK     TOLOC,AMLOLOC,SP1,AMLODES
           MATCH    AMSMFLOC,AMSMTLOC
           GOTO     RLOC0999 IF EQUAL
           GOTO     RLOC0999 IF NOT LESS
           BEEP
           MOVE     "To Location Must Be > From Location - ",DISPMSG
           CALL     MESSAGE1
           GOTO     RLOC0000
RLOC0200   MOVE     "Finish             ",TOLOC
           MOVE     "ZZZ",AMSMTLOC
           GOTO     RLOC0999
.
RLOC0900   MOVE     "Finish             ",TOLOC
           MOVE     "ZZZ",AMSMTLOC
           MOVE     "Start             ",FROMLOC
           MOVE     SP70,AMSMFLOC
           GOTO     RLOC0999
.
RLOC0999   MOVE     "    6",FLDID
           CALL     GETPOSIT
           RETURN
RTYP0000   MOVE     "    8",FLDID
           CALL     GETPOSIT
           MOVE     SP70,VAR
           CALL     DISPITEM
           MOVE     "AT",AMCDCAT
           CALL     KAMCDA00
           BRANCH   EXIT,RTYP0100,RTYP0999
           MOVE     AMCDCOD,AMSMFTYP
           PACK     FROMTYP,AMCDCOD,SP1,AMCDDES
           GOTO     RTYP0150
RTYP0100   MOVE     "Start             ",FROMTYP
           MOVE     SP70,AMSMFTYP
.
RTYP0150   MOVE     "    9",FLDID
           CALL     GETPOSIT
           MOVE     SP70,VAR
           CALL     DISPITEM
           MOVE     "AT",AMCDCAT
           CALL     KAMCDA00
           BRANCH   EXIT,RTYP0200,RTYP0999
           MOVE     AMCDCOD,AMSMTTYP
           PACK     TOTYP,AMCDCOD,SP1,AMCDDES
           MATCH    AMSMFTYP,AMSMTTYP
           GOTO     RTYP0999 IF EQUAL
           GOTO     RTYP0999 IF NOT LESS
           BEEP
           MOVE     "To Asset Type Must Be > From Asset Type - ",DISPMSG
           CALL     MESSAGE1
           GOTO     RTYP0000
RTYP0200   MOVE     "Finish             ",TOTYP
           MOVE     "ZZZ",AMSMTTYP
.
RTYP0999   MOVE     "    8",FLDID
           CALL     GETPOSIT
           RETURN
RDPT0000   MOVE     "   10",FLDID
           CALL     GETPOSIT
           MOVE     SP70,VAR
           CALL     DISPITEM
           MOVE     "DP",AMCDCAT
           CALL     KAMCDA00
           BRANCH   EXIT,RDPT0100,RDPT0999
           MOVE     AMCDCOD,AMSMFDPT
           PACK     FROMDPT,AMCDCOD,SP1,AMCDDES
           GOTO     RDPT0150
RDPT0100   MOVE     "Start             ",FROMDPT
           MOVE     SP70,AMSMFDPT
.
RDPT0150   MOVE     "   11",FLDID
           CALL     GETPOSIT
           MOVE     SP70,VAR
           CALL     DISPITEM
           MOVE     "DP",AMCDCAT
           CALL     KAMCDA00
           BRANCH   EXIT,RDPT0200,RDPT0999
           MOVE     AMCDCOD,AMSMTDPT
           PACK     TODPT,AMCDCOD,SP1,AMCDDES
           MATCH    AMSMFDPT,AMSMTDPT
           GOTO     RDPT0999 IF EQUAL
           GOTO     RDPT0999 IF NOT LESS
           BEEP
           MOVE     "To Department Must Be > From Department - ",DISPMSG
           CALL     MESSAGE1
           GOTO     RDPT0000
RDPT0200   MOVE     "Finish             ",TODPT
           MOVE     "ZZZ",AMSMTDPT
.
RDPT0999   MOVE     "   10",FLDID
           CALL     GETPOSIT
           RETURN
RDAT0000   MOVE     "   12",FLDID
           CALL     GETPOSIT
           MOVE     SP70,VAR
           CALL     DISPITEM
           MOVE     SP70,CDAY
           MOVE     CMM,CMON
           MOVE     CYY,CYEAR
           MOVE     CCC,CCENT
           CALL     KEYDATE
           BRANCH   OVRCD,RDAT0100
           MATCH    SP2,CDAY
           GOTO     RDAT0100 IF EQUAL
           PACK     AMSMFSDT,CCENT,CYEAR,CMON,CDAY
           REP      " 0",AMSMFSDT
           CALL     PACDATE
           MOVE     CPCDATE,FROMDATE
           GOTO     RDAT0140
RDAT0100   MOVE     "Start             ",FROMDATE
           MOVE     SP70,AMSMFSDT
.
RDAT0140   MOVE     FROMDATE,VAR
           CALL     DISPITEM
.
RDAT0150   MOVE     "   13",FLDID
           CALL     GETPOSIT
           MOVE     SP70,VAR
           CALL     DISPITEM
           MOVE     SP70,CDAY
           MOVE     CMM,CMON
           MOVE     CYY,CYEAR
           MOVE     CCC,CCENT
           CALL     KEYDATE
           BRANCH   OVRCD,RDAT0200
           MATCH    SP2,CDAY
           GOTO     RDAT0200 IF EQUAL
           PACK     AMSMTSDT,CCENT,CYEAR,CMON,CDAY
           REP      " 0",AMSMTSDT
           CALL     PACDATE
           MOVE     CPCDATE,TODATE
           MATCH    AMSMFSDT,AMSMTSDT
           GOTO     RDAT0900 IF EQUAL
           GOTO     RDAT0900 IF NOT LESS
           BEEP
           MOVE     "To Date Must Be > From Date - ",DISPMSG
           CALL     MESSAGE1
           GOTO     RDAT0000
.
RDAT0200   MOVE     "Finish             ",TODATE
           MOVE     "99999999",AMSMTSDT
.
RDAT0900   MOVE     TODATE,VAR
           CALL     DISPITEM
.
RDAT0999   MOVE     "   12",FLDID
           CALL     GETPOSIT
           RETURN
.---------------------------------------------------------------------
. Generate Stocktake
.---------------------------------------------------------------------
GENER000
.
. Get Next Stocktake Number from Control File and Update
.--------------------------------------------------------
          MOVE      THREE,AUDTSECT
          READ      CONTROLF,AUDTSECT;CFAMSRUN
          ADD       ONE,CFAMSRUN
          WRITAB    CONTROLF,AUDTSECT;CFAMSRUN
          SUB       ONE,CFAMSRUN
          PACK      KEY5,CFAMSRUN
          CALL      RAAMSM1
          COMPARE   ZERO,OVRCD
          GOTO      GENER000 IF EQUAL
          MOVE      CFAMSRUN,AMSMSTK
          CALL      WRAMSM1
.
          DISPLAY   *P1:24,*EL,"Generating Stocktake Number : ",*V2LON,CFAMSRUN:
                    *P50:24,"Asset :"
.
. Extract Assets from Asset Masterfile
.--------------------------------------
          PACK      KEY23,AMSMFBLD,SP70
          CALL      RSAMMA2
GENER100  CALL      RKAMMA2
          BRANCH    OVRCD,GENER900
          MATCH     AMMABLD,AMSMTBLD
          GOTO      GENER900 IF LESS
.
          CALL      RANGE000
          BRANCH    EXIT,GENER100
.
          MATCH     SP70,AMMADDT
          GOTO      GENER100 IF NOT EQUAL
.
          DISPLAY   *P60:24,*V2LON,AMMAREG,"/",AMMAASS
          PACK      KEY28,CFAMSRUN,AMMABLD,AMMALOC,AMMAREG,AMMAASS
          UNPACK    KEY28,AMSTSTK,AMSTBLD,AMSTLOC,AMSTREG,AMSTASS
          CALL      RDAMST1
          IF        OVRCD=1
            MOVE      AMSMDAT,AMSTGDT
            MOVE      AMMALCM,AMSTLCM
            MOVE      SP70,AMSTPDT
            MOVE      SP70,AMSTCBY
            MOVE      SP70,AMSTCOM
            MOVE      SP70,AMSTPDT
            MOVE      SP70,AMSTUR1
            MOVE      SP70,AMSTUR2
            MOVE      SP70,AMSTUD1
            MOVE      SP70,AMSTUD2
            MOVE      ZERO,AMSTUY1
            MOVE      ZERO,AMSTUY2
            MOVE      SP70,AMSTSPA
            CALL      WRAMST1
          ENDIF
          GOTO      GENER100
.
GENER900  DISPLAY   *P1:24,*EL,"Stocktake No. : ",*V2LON,CFAMSRUN:
                    *HOFF,"  Extract Complete. ";
          CALL      HITENTER
          RETURN
.
RANGE000  MOVE      ZERO,EXIT
          MATCH     AMSMFDPT,AMMADPT
          GOTO      RANGE900 IF LESS
          MATCH     AMMADPT,AMSMTDPT
          GOTO      RANGE900 IF LESS
.
          MATCH     SP70,AMSMFSDT
          GOTO      RANGE100 IF EQUAL
          MATCH     AMSMFSDT,AMMASDT
          GOTO      RANGE900 IF LESS
          MATCH     AMMASDT,AMSMTSDT
          GOTO      RANGE900 IF LESS
.
RANGE100  MATCH     AMSMFLOC,AMMALOC
          GOTO      RANGE900 IF LESS
          MATCH     AMMALOC,AMSMTLOC
          GOTO      RANGE900 IF LESS
.
          MATCH     AMSMFTYP,AMMATYP
          GOTO      RANGE900 IF LESS
          MATCH     AMMATYP,AMSMTTYP
          GOTO      RANGE900 IF LESS
.
          GOTO      RANGE999
.
RANGE900  MOVE      ONE,EXIT  * Out of Range
RANGE999  RETURN
.-------------------------------------------------
. Enter Stocktake No.
.-------------------------------------------------
ESTOK000  MOVE     ZERO,CKEYTYP
          CALL     KAMSMA00
          BRANCH   EXIT,ESTOK999,ESTOK999
.
          MOVE     AMSMOPR,KEY4
          CALL     RDPASS1
.
          MATCH    AMSMFBLD,AMSMTBLD
          GOTO     ESTOK100 IF NOT EQUAL
.
          MATCH    SP70,AMSMFLOC
          IF       @EQUAL
            MOVE      "Start     ",FROMLOC
          ELSE
            PACK      KEY9,AMSMFBLD,AMSMFLOC
            CALL      RDAMLO1
            PACK      FROMLOC,AMLOLOC,SP1,AMLODES
          ENDIF
.
          MATCH    "ZZZZZZ",AMSMTLOC
          IF       @EQUAL
            MOVE      "Finish    ",TOLOC
          ELSE
            PACK      KEY9,AMSMFBLD,AMSMTLOC
            CALL      RDAMLO1
            PACK      TOLOC,AMLOLOC,SP1,AMLODES
          ENDIF
.
          GOTO     ESTOK200
ESTOK100  MOVE      "Start     ",FROMLOC
          MOVE      "Finish    ",TOLOC
ESTOK200
          MATCH    SP70,AMSMFBLD
          IF       @EQUAL
            MOVE      "Start     ",FROMBLD
          ELSE
            MOVE      "BL",AMCDCAT
            PACK      AMCDCAT,AMSMFBLD
            CALL      RDAMCD1
            PACK      FROMBLD,AMCDCOD,SP1,AMCDDES
          ENDIF
.
          MATCH    "ZZZ",AMSMTBLD
          IF       @EQUAL
            MOVE      "Finish    ",TOBLD
          ELSE
            MOVE      "BL",AMCDCAT
            PACK      AMCDCAT,AMSMTBLD
            CALL      RDAMCD1
            PACK      TOBLD,AMCDCOD,SP1,AMCDDES
          ENDIF
.
          MATCH    SP70,AMSMFTYP
          IF       @EQUAL
            MOVE      "Start     ",FROMTYP
          ELSE
            MOVE      "AT",AMCDCAT
            PACK      AMCDCAT,AMSMFTYP
            CALL      RDAMCD1
            PACK      FROMTYP,AMCDCOD,SP1,AMCDDES
          ENDIF
.
          MATCH    "ZZZ",AMSMTTYP
          IF       @EQUAL
            MOVE      "Finish    ",TOTYP
          ELSE
            MOVE      "AT",AMCDCAT
            PACK      AMCDCAT,AMSMTTYP
            CALL      RDAMCD1
            PACK      TOTYP,AMCDCOD,SP1,AMCDDES
          ENDIF
.
          MATCH    SP70,AMSMFDPT
          IF       @EQUAL
            MOVE      "Start     ",FROMDPT
          ELSE
            MOVE      "DP",AMCDCAT
            PACK      AMCDCAT,AMSMFDPT
            CALL      RDAMCD1
            PACK      FROMDPT,AMCDCOD,SP1,AMCDDES
          ENDIF
.
          MATCH    "ZZZ",AMSMTDPT
          IF       @EQUAL
            MOVE      "Finish    ",TODPT
          ELSE
            MOVE      "DP",AMCDCAT
            PACK      AMCDCAT,AMSMTDPT
            CALL      RDAMCD1
            PACK      TODPT,AMCDCOD,SP1,AMCDDES
          ENDIF
.
          MATCH    SP70,AMSMFSDT
          IF       @EQUAL
            MOVE      "Start     ",FROMDATE
          ELSE
            UNPACK    AMSMFSDT,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
            PACK      FROMDATE,CPCDATE
          ENDIF
.
          MATCH    "99999999",AMSMTSDT
          IF       @EQUAL
            MOVE      "Finish    ",TODATE
          ELSE
            UNPACK    AMSMTSDT,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
            PACK      TODATE,CPCDATE
          ENDIF
.
ESTOK999  RETURN
.-------------------------------------------------
. Print Stocktake Report
.-------------------------------------------------
PRINT000  DISPLAY   *P1:24,*EL,"Printing Building/Location : "
          MOVE      ZERO,CPAGENO
          CLOCK     TIME,CTIMEIS
          MOVE      "99",CLNO
          MOVE      SP70,LASTBLD
          MOVE      SP70,LASTLOC
          PACK      KEY28,AMSMSTK,SP70
          CALL      RSAMST1
PRINT100  CALL      RKAMST1
          BRANCH    OVRCD,PRINT900
          MATCH     AMSTSTK,AMSMSTK
          GOTO      PRINT900 IF NOT EQUAL
.
          PACK      KEY14,AMSTREG,AMSTASS
          CALL      RDAMMA1
          BRANCH    OVRCD,PRINT100
.
          MATCH     AMSTBLD,LASTBLD
          IF        !@EQUAL
            MOVE      "99",CLNO
            MOVE      AMSTBLD,LASTBLD
          ENDIF
.
          MATCH     AMSTLOC,LASTLOC
          IF        !@EQUAL
            MOVE      "99",CLNO
            MOVE      AMSTBLD,LASTBLD
            MOVE      AMSTLOC,LASTLOC
          ENDIF
          COMPARE   "55",CLNO
          CALL      HEAD0000 IF NOT LESS
          ADD       "4",CLNO
          CALL      UND132
          MOVE      SP70,CPCDATE
          MATCH     SP70,AMSTPDT
          IF        !@EQUAL
            UNPACK    AMSTPDT,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
          ENDIF
          UNPACK    AMSTCOM,KEY20,KEY10
          PRINT     AMSTREG,"/",AMSTASS,SP1,AMMADES,SP1,AMSTLCM,"| ":
                    AMSTCBY," | ",CPCDATE," | ",KEY20
.
          MOVE      SP70,AMCDDES
          MOVE      "AT",AMCDCAT
          PACK      KEY5,AMCDCAT,AMMATYP
          CALL      RDAMCD1
          PRINT     *13,AMMATYP,SP1,AMCDDES,SP1,AMMASER:
                    "|            |            |",KEY10
          MOVE      SP70,AMCDDES
          MOVE      "DP",AMCDCAT
          PACK      KEY5,AMCDCAT,AMMADPT
          CALL      RDAMCD1
          MOVE      SP70,CPCDATE
          MATCH     SP70,AMMASDT
          IF        !@EQUAL
            UNPACK    AMMASDT,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
          ENDIF
          PRINT     *13,AMMADPT,SP1,AMCDDES," Last Stocktake : ",CPCDATE:
                    *83,"|            |            |"
.
          GOTO      PRINT100
.
PRINT900  CALL      UND132
          PRINT     *45,"*** End of Report ***"
.
PRINT999  RETURN
.
HEAD0000  CALL      HEAD132
          MOVE      "BL",AMCDCAT
          PACK      KEY5,AMCDCAT,AMSTBLD
          CALL      RDAMCD1
          PACK      KEY9,AMSTBLD,AMSTLOC
          CALL      RDAMLO1
          PRINT     "Stocktake Run : ",AMSMSTK
          PRINT     "Building      : ",AMSTBLD,SP4,AMCDDES
          PRINT     "Location      : ",AMSTLOC,SP1,AMLODES
          CALL      UND132
          PRINT     "Register/Asset                                      ":
                    "Location Comment              | Check By   ":
                    "|   Date     |  Comments"
          PRINT     "            Asset Type                              ":
                    "Serial Number                 |            ":
                    "|            |"
          PRINT     "            Department                              ":
                    "                              |            ":
                    "|            |"
          MOVE      "10",CLNO
          RETURN
.
.---------------------------------
. Setup Category and Enter Code
.---------------------------------
EBLD0000  MOVE    ZERO,CKEYTYP
          MOVE    "BL",AMCDCAT
          CALL    KAMCDA00
          BRANCH  EXIT,EBLD9999,EBLD9999
          MOVE    AMCDCOD,AMSTBLD
          MOVE    AMCDDES,BLDDESC
EBLD9999  RETURN
.----------------------------------------------
. Enter Location Code (Blank for All)
.----------------------------------------------
ELOC0000  MOVE     ZERO,CKEYTYP
          MOVE     AMSTBLD,AMLOBLD
          CALL     KAMLOA00
          BRANCH   EXIT,ELOC1000,ELOC9999
          MOVE     AMLOLOC,AMSTLOC
          GOTO     ELOC2000
ELOC1000  MOVE     ZERO,EXIT
          MOVE     SP70,AMLOLOC
          MOVE     AMLOLOC,AMSTLOC
          MOVE     "All Locations",AMLODES
ELOC2000  MOVE     "    5",FLDID
          CALL     GETPOSIT
          IF       EXIT=0
            MOVE     AMLODES,VAR
            CALL     DISPITEM
          ENDIF
.
          PACK     ENDKEY,AMSTSTK,AMSTBLD,AMSTLOC,SP70
          SETLPTR  ENDKEY,14
          MATCH    SP70,AMSTLOC
          IF       @EQUAL
            SETLPTR  ENDKEY,8
          ENDIF
.
          MOVE     PASSCODE,KEY4
          CALL     RDPASS1
.
          MOVE     ZERO,FIRSTIND
          PACK     KEY28,AMSTSTK,AMSTBLD,AMSTLOC,SP70
          CALL     RSAMST1
ELOC3000  CALL     RKAMST1
          BRANCH   OVRCD,ELOC4000
          PACK     KEY28,AMSTSTK,AMSTBLD,AMSTLOC,SP70
          MATCH    ENDKEY,KEY28
          GOTO     ELOC4000 IF NOT EQUAL
.
          PACK     KEY14,AMSTREG,AMSTASS
          CALL     RLAMMA1
          BRANCH   OVRCD,ELOC3000,ELOC3000
.
          PACK     KEY9,AMSTBLD,AMSTLOC
          CALL     RDAMLO1
.
          MATCH    SP70,AMSTPDT
          GOTO     ELOC3000 IF NOT EQUAL
          MOVE     ONE,CHECKYN
          MOVE     SECUSER,AMSTCBY
          PACK     AMSTPDT,CCC,CYY,CMM,CDD
          REP      " 0",AMSTPDT
          MOVE     SP70,AMSTCOM
          MOVE     ZERO,ACCEPT
          MOVE     ZERO,ABORTFLG
.
          MOVE     ONE,FIRSTIND
          CALL     SCPDL000            * Enter Details
.
          BRANCH   ABORTFLG,ELOC4000
          GOTO     ELOC3000
.
ELOC4000
          IF        FIRSTIND=0
            MOVE      "No Items to be Checked for Location. - ",DISPMSG
            BEEP
            CALL      MESSAGE1
          ENDIF
          MOVE      "03",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          CALL      SBACK000
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          MOVE      AMSTSTK,VAR
          CALL      DISPITEM
          MOVE      ONE,EXIT
.
ELOC9999  RETURN
.-------------------------------------------------
. ABORT Stocktake Report
.-------------------------------------------------
ABORT000  DISPLAY   *P1:24,*EL,"Removing Stocktake : ",*V2LON,AMSMSTK
          PACK      KEY28,AMSMSTK,SP70
          CALL      RSAMST1
ABORT100  CALL      RKAMST1
          BRANCH    OVRCD,ABORT200
          MATCH     AMSTSTK,AMSMSTK
          GOTO      ABORT200 IF NOT EQUAL
          MATCH     SP70,AMSTPDT
          GOTO      ABORT800 IF NOT EQUAL
          GOTO      ABORT100
ABORT200
          MOVE      THREE,AUDTSECT
          READ      CONTROLF,AUDTSECT;CFAMSRUN
          SUB       ONE,CFAMSRUN
          MOVE      CFAMSRUN,KEY5
          MATCH     KEY5,AMSMSTK
          IF        @EQUAL
            WRITAB    CONTROLF,AUDTSECT;CFAMSRUN
          ENDIF
.
          PACK      KEY5,AMSMSTK,SP70
          CALL      RDAMSM1
          IF        OVRCD=0
            CALL      DEAMSM1
          ENDIF
          PACK      KEY28,AMSMSTK,SP70
          CALL      RSAMST1
ABORT300  CALL      RKAMST1
          BRANCH    OVRCD,ABORT900
          MATCH     AMSTSTK,AMSMSTK
          GOTO      ABORT900 IF NOT EQUAL
          PACK      KEY28,AMSTSTK,AMSTBLD,AMSTLOC,AMSTREG,AMSTASS,SP70
          CALL      RDAMST1
          IF        OVRCD=0
            CALL      DEAMST1
          ENDIF
          GOTO      ABORT100
.
ABORT800  BEEP
          DISPLAY   *P1:24,*EL,"Stocktake Processing Has Begun.":
                    " Abort Denied. - ";
          CALL      HITENTER
          GOTO      ABORT999
ABORT900  DISPLAY   *P1:24,*EL,*B,"Stocktake Aborted. - ";
          CALL      HITENTER
.
ABORT999  RETURN

.----------------------------------------
. Move one to accept to for insert mode
.----------------------------------------
MVACCEPT  MOVE      ONE,ACCEPT
          RETURN
.----------------------------------------------------------------------
. Load ASCII File
.----------------------------------------------------------------------
LOAD0000  MOVE      "90",CLNO
          MOVE      "0",CPAGENO
          CLOCK     TIME,CTIMEIS
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      LOADFILE,LOADNAME
          TRAPCLR   IO
          BRANCH    OVRCD,LOAD9100
.
          MOVE      ZERO,SECTOR
.
LOAD1000  ADD       ONE,SECTOR
          TRAPCLR   FORMAT
          READ      LOADFILE,SEQ;LOADREG,LOADASS,LOADBLD,LOADLOC,LOADCOM
          GOTO      LOAD9900 IF OVER
          TRAPCLR   FORMAT
          BRANCH    OVRCD,LOAD3000
.
          PACK      KEY14,LOADREG,LOADASS
          CALL      RDAMMA1
          BRANCH    OVRCD,LOAD3100
.
          IF        (SECTOR%100=0)
            DISPLAY   *P1:24,*EL,"Records Processed : ",*V2LON,SECTOR
          ENDIF
.
          PACK     KEY17,AMSMSTK,LOADREG,LOADASS
          CALL     RDAMST2
          BRANCH   OVRCD,LOAD1300
.
          MATCH    AMSTBLD,LOADBLD
          GOTO     LOAD1100 IF NOT EQUAL
          MATCH    AMSTLOC,LOADLOC
          GOTO     LOAD1200 IF EQUAL
.
. Transfer Location
.----------------------
LOAD1100  CALL     LOCHIS00     * Write to Location Transfer File
.
          MOVE     LOADCOM,AMSTCOM
          CLOCK    TIME,CTIMEIS
          MOVE     CTIMEIS,AMSTPTM
          PACK     AMSTPDA,CCC,CYY,CMM,CDD
          REP      " 0",AMSTPDA
          MOVE     PASSCODE,AMSTPOP
.
          CLEAR    LOADMESS
          APPEND   "Stocktake Updated Transfer from Bld/Loc. ",LOADMESS
          APPEND   AMSTBLD,LOADMESS
          APPEND   "/",LOADMESS
          APPEND   AMSTLOC,LOADMESS
          RESET    LOADMESS
.
          MOVE     LOADBLD,AMSTBLD
          MOVE     LOADLOC,AMSTLOC
          CALL     UPAMST2
          MOVE     LOADBLD,AMMABLD
          MOVE     LOADLOC,AMMALOC
          MOVE     AMSTPDT,AMMASDT
          CALL     UPAMMA1
.
          CALL     PLIN0000
          GOTO     LOAD1000
.
. NO Transfer of Location
.--------------------------
LOAD1200  MOVE     LOADCOM,AMSTCOM
          CLOCK    TIME,CTIMEIS
          MOVE     CTIMEIS,AMSTPTM
          PACK     AMSTPDA,CCC,CYY,CMM,CDD
          REP      " 0",AMSTPDA
          MOVE     PASSCODE,AMSTPOP
          CALL     UPAMST2
          MOVE     AMSTPDT,AMMASDT
          CALL     UPAMMA1
          MOVE     "Stocktake Updated",LOADMESS
          CALL     PLIN0000
          GOTO     LOAD1000
.
. Not On Stock Take File
.--------------------------
LOAD1300  MOVE     AMMABLD,AMSTBLD
          MOVE     AMMALOC,AMSTLOC
          MATCH    AMSTBLD,LOADBLD
          GOTO     LOAD1400 IF NOT EQUAL
          MATCH    AMSTLOC,LOADLOC
          GOTO     LOAD1500 IF EQUAL
.
LOAD1400  CALL     LOCHIS00    * Write to Location Transfer File
.
          CLEAR    LOADMESS
          APPEND   "Added to Stocktake Transfer from Bld/Loc. ",LOADMESS
          APPEND   AMSTBLD,LOADMESS
          APPEND   "/",LOADMESS
          APPEND   AMSTLOC,LOADMESS
          RESET    LOADMESS
.
          PACK     KEY17,AMSMSTK,LOADREG,LOADASS
          UNPACK   KEY17,AMSTSTK,AMSTREG,AMSTASS
          MOVE     LOADBLD,AMSTBLD
          MOVE     LOADLOC,AMSTLOC
          PACK     AMSTGDT,CCC,CYY,CMM,CDD
          REP      " 0",AMSTGDT
          PACK     AMSTPDT,CCC,CYY,CMM,CDD
          REP      " 0",AMSTPDT
          MOVE     LOADCOM,AMSTCOM
          CLOCK    TIME,CTIMEIS
          MOVE     CTIMEIS,AMSTPTM
          PACK     AMSTPDA,CCC,CYY,CMM,CDD
          REP      " 0",AMSTPDA
          MOVE     PASSCODE,AMSTPOP
          CALL     WRAMST2
.
          MOVE     LOADBLD,AMMABLD
          MOVE     LOADLOC,AMMALOC
          MOVE     AMSTPDT,AMMASDT
          CALL     UPAMMA1
.
          CALL     PLIN0000
          GOTO     LOAD1000
.
LOAD1500  PACK     KEY17,AMSMSTK,LOADREG,LOADASS
          UNPACK   KEY17,AMSTSTK,AMSTREG,AMSTASS
          MOVE     LOADBLD,AMSTBLD
          MOVE     LOADLOC,AMSTLOC
          PACK     AMSTGDT,CCC,CYY,CMM,CDD
          REP      " 0",AMSTGDT
          PACK     AMSTPDT,CCC,CYY,CMM,CDD
          REP      " 0",AMSTPDT
          MOVE     LOADCOM,AMSTCOM
          CLOCK    TIME,CTIMEIS
          MOVE     CTIMEIS,AMSTPTM
          PACK     AMSTPDA,CCC,CYY,CMM,CDD
          REP      " 0",AMSTPDA
          MOVE     PASSCODE,AMSTPOP
          CALL     WRAMST2
.
          MOVE     AMSTPDT,AMMASDT
          CALL     UPAMMA1
.
          MOVE     "Added to Stocktake File",LOADMESS
          CALL     PLIN0000
          GOTO     LOAD1000
.
. Error in Format
.-----------------
LOAD3000  DISPLAY   *P1:24,*EL,"Format Error in Record Number ",*V2LON,SECTOR:
                    *HOFF,". Continue (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? "
          MOVE      "55",CCOL
          MOVE      "24",CVERT
          MOVE      "Format Error this Record",LOADMESS
          CALL      PLIN0000
.
          CALL      YORN0000
          BRANCH    FYESNO,LOAD1000
          MOVE      TWO,EXIT
          GOTO      LOAD9999
.
. Error Asset Does Not Exist
.----------------------------
LOAD3100  DISPLAY   *P1:24,*EL,"ERROR Record Number ",*V2LON,SECTOR:
                    *HOFF," Invalid Asset ",LOADREG,"/",LOADASS:
                    " Continue (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? "
          MOVE      "74",CCOL
          MOVE      "24",CVERT
          MOVE      "Invalid Asset Code",LOADMESS
          CALL      PLIN0000
          CALL      YORN0000
          BRANCH    FYESNO,LOAD1000
          MOVE      TWO,EXIT
          GOTO      LOAD9999
.
LOAD9100  MOVE      "Unable to Open ASCII File - ",DISPMSG
          CALL      MESSAGE1
          MOVE      "2",EXIT
          GOTO      LOAD9999
.
LOAD9900  IF        !(CPAGENO=0)
            CALL       UND132
            PRINT      *50,"***** End of Report *****"
          ENDIF
          MOVE      "0",EXIT
          GOTO      LOAD9999
.
LOAD9999  RETURN
.--------------------------------------------------------------
. Print Heading
.--------------------------------------------------------------
LHED0000  CALL      HEAD132
          PRINT     "Stocktake Number : ",AMSMSTK,"  ASCII Barcode File Load ":
                    LOADNAME
          CALL      UND132
          PRINT     "Record No.  Register/Asset Code  Comment"
          CALL      UND132
          MOVE      "6",CLNO
          RETURN
.--------------------------------------------------------------
. Print Load Detail Line
.--------------------------------------------------------------
PLIN0000  ADD      ONE,CLNO
          COMPARE  "55",CLNO
          CALL     LHED0000 IF NOT LESS
          PRINT    *3,SECTOR,*13,LOADREG,"/",LOADASS,*34,LOADMESS
          RETURN
.--------------------------------------------------------------
. Update Location History File
.--------------------------------------------------------------
LOCHIS00  PACK      AMLHDAT,CCC,CYY,CMM,CDD
          REP       " 0",AMLHDAT
          PACK      KEY22,LOADREG,LOADASS,AMLHDAT
          UNPACK    KEY22,AMLHREG,AMLHASS,AMLHDAT
          CALL      RDAMLH1
          IF        OVRCD=1
            MOVE      AMMABLD,AMLHFBLD
            MOVE      AMMALOC,AMLHFLOC
            MOVE      LOADBLD,AMLHTBLD
            MOVE      LOADLOC,AMLHTLOC
            CLEAR     AMLHCOM
            APPEND    "Stocktake Transfer ",AMLHCOM
            APPEND    AMSMSTK,AMLHCOM
            RESET     AMLHCOM
            CALL      WRAMLH1
          ELSE
            MOVE      LOADBLD,AMLHTBLD
            MOVE      LOADLOC,AMLHTLOC
            CLEAR     AMLHCOM
            APPEND    "Stocktake Transfer ",AMLHCOM
            APPEND    AMSMSTK,AMLHCOM
            RESET     AMLHCOM
            CALL      UPAMLH1
          ENDIF
          RETURN
.
EPDT0000  COMPARE  ZERO,CHECKYN
          GOTO     EPDT9999 IF EQUAL
.
          MOVE     CCC,CCENT
          MOVE     CYY,CYEAR
          MOVE     CMM,CMON
          MOVE     CDD,CDAY
          CALL     KEYDATE
          PACK     AMSTPDT,CCENT,CYEAR,CMON,CDAY
EPDT9999  RETURN
ECBY0000  COMPARE  ZERO,CHECKYN
          GOTO     ECBY9999 IF EQUAL
.
          STRIP     AMSTCBY
          SFORMAT   VAR,SCPSLEN
          MOVE      AMSTCBY,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,AMSTCBY
          ENDSET    AMSTCBY
          APPEND    SP70,AMSTCBY
          RESET     AMSTCBY
.
ECBY9999  RETURN
ECOM0000  COMPARE  ZERO,CHECKYN
          GOTO     ECOM9999 IF EQUAL
.
          STRIP     AMSTCOM
          SFORMAT   VAR,SCPSLEN
          MOVE      AMSTCOM,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,AMSTCOM
          ENDSET    AMSTCOM
          APPEND    SP70,AMSTCOM
          RESET     AMSTCOM
.
ECOM9999  RETURN
ECYN0000  IF       CHECKYN=0
            MOVE     ONE,CHECKYN
            MOVE     ONE,ACCEPT
          ELSE
            MOVE     ZERO,CHECKYN
            MOVE     SP70,AMSTPDT
            MOVE     SP70,AMSTCOM
            MOVE     SP70,AMSTCBY
          ENDIF
          RETURN
CANC0000  CALL     UUAMMA1
          RETURN
.
.----------------------------------------------
. Abort Location Code Being Processed
.----------------------------------------------
ALOC0000  MOVE     ONE,ABORTFLG
          CALL     UUAMMA1
          RETURN
POST0000  COMPARE  ZERO,CHECKYN
          GOTO     POST9999 IF EQUAL
.
          CLOCK    TIME,CTIMEIS
          MOVE     CTIMEIS,AMSTPTM
          PACK     AMSTPDA,CCC,CYY,CMM,CDD
          REP      " 0",AMSTPDA
          MOVE     PASSCODE,AMSTPOP
          CALL     UPAMST1
          MOVE     AMSTPDT,AMMASDT
          CALL     UPAMMA1
POST9999  CALL     UUAMMA1
          RETURN
.
.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       AMSCODIO/INC
          INC       AMSCODKY    
          INC       AMSLOCIO/INC
          INC       AMSLOCKY    
          INC       AMSLOHIO/INC
          INC       AMSMASIO/INC
          INC       AMSSTMIO/INC
          INC       AMSSTMKY    
          INC       AMSSTPIO/INC
          INC       IBAPASIO/INC
.
          INC       STDGENCD
.

.-------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.00.00"
.-------------------------------------------------------
. V9.02.00  03.05.2002  Glenn Saunders
.           Export to new release i.e. v9.02 from vf.09
.-------------------------------------------------------
. VF.00.01  11.01.2000 Charles Handaya
.           Recompiled for Audit Files date
.-------------------------------------------------------
F14P2     FORM      14.2
.-------------------------------------------------------
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBAAPS77
.   Function      :   General Ledger Costing Extract          
.   Generated  On :   13/12/2005
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       APS77TFD    
          INC       FMSAMAFD/INC
          INC       FMSBTYFD/INC
          INC       FMSBUDFD/INC
          INC       FMSCONFD/INC
          INC       FMSCSAFD/INC
          INC       FMSFPSFD/INC
          INC       FMSLMAFD/INC
          INC       FMSLMCDF    
          INC       FMSLMCFD/INC
.=========================
.Local Variable Definition
.-------------------------
LEDGER    DIM       2 * Scr 00 Fld     5
FROMPER   FORM      2 * Scr 00 Fld     8
TOPER     FORM      2 * Scr 00 Fld     9
SENDACT   FORM      1 * Scr 00 Fld    10
SENDBUD   FORM      1 * Scr 00 Fld    11
EXPTNAME  DIM      40 * Scr 00 Fld    12
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBAAPS77"
PRGNAM    INIT      "General Ledger Costing Extract          "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          MOVE      PORT,PARENTID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      SC00L000
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          DISPLAY   *P56:24,"Opening fmsamaaf";
          OPEN      FMSAMAA1,"fmsamaaf"
          DISPLAY   *P56:24,"Opening fmsamaaf";
          OPEN      FMSAMAA4,"fmsamaaf"
          DISPLAY   *P56:24,"Opening fmsbtyaf";
          OPEN      FMSBTYA1,"fmsbtyaf"
          DISPLAY   *P56:24,"Opening fmscsaaf";
          OPEN      FMSCSAA1,"fmscsaaf"
          DISPLAY   *P56:24,"Opening fmslmaaf";
          OPEN      FMSLMAA1,"fmslmaaf"
          DISPLAY   *P56:24,"Opening fmslmcaf";
          OPEN      FMSLMCA1,"fmslmcaf"
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "00",SCRID
          IF         @EQUAL
            CALL       PS00L000   * Options                            
          ENDIF
          RETURN
.--------------------------------
. Screen - Options                            
.--------------------------------
SC00L000
SC00L100
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          MOVE      "  1",CLEF
          MOVE      " 80",CRIG
          MOVE      " 3",CTOP
          MOVE      "24",CBOT
          CALL      VBACK000 * Display Background
          MOVE      ZERO,CLEF
          MOVE      ZERO,CTOP
          MOVE      ZERO,CRIG
          MOVE      ZERO,CBOT
.
SC00L200
          CALL      CF00L000 * Clear Fields
          CALL      MVACCEPT
SC00L300
          CALL      KY00L000 * Enter Key Fields
          BRANCH    EXIT,SC00L999,SC00L999
SC00L400
          CALL      WP00L000 * Load any WP Details
SC00L500
          CALL      LM00L000 * Load any Batch Details
SC00L600
          CALL      DF00L000 * Display Fields
SC00L700
          CALL      SF00L000 * Select Fields
          BRANCH    EXIT,SC00L100,SC00L100,SC00L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC00L800
SC00L900
SC00L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Options                            
.-------------------------------------------------------
CF00L000
          MOVE      SP70,LEDGER  
          MOVE      SP70,EXPTHID 
          MOVE      SP70,FMLCYEAR
          MOVE      ZERO,FROMPER 
          MOVE      ZERO,SENDACT 
          MOVE      ZERO,SENDBUD 
          MOVE      SP70,EXPTNAME
          MOVE      SP70,FMBTCODE
CF00L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Options                            
.--------------------------------------------------------
KY00L000
          MOVE      ZERO,EXIT
          GOTO      KY00L999
.
KY00L900  MOVE      ONE,EXIT
KY00L999  RETURN
.---------------------------------------------------------
. Load WP files for : Options                            
.---------------------------------------------------------
WP00L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Options                            
.---------------------------------------------------------
LM00L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Options                            
.---------------------------------------------------------
DF00L000
          BRANCH   ACCEPT,DF00L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF00L900
          MATCH    PRGID,SCPSPID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF00L010 IF NOT EQUAL
.
          CALL     PS00L000 * Display Field
          GOTO     DF00L010
DF00L900
DF00L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Options                            
.---------------------------------------------------------
PS00L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS00L999,PS00L999,PS00L999,PS00L999:
                           PS00L101,PS00L102,PS00L103,PS00L104:
                            PS00L105,PS00L106,PS00L107,PS00L108:
                            PS00L109,PS00L110,PS00L111
          GOTO     PS00L999
.
PS00L101
          MOVE      LEDGER,VAR       
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L102
          MOVE      EXPTHID,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L103
          MOVE      FMLCYEAR,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L104
          MOVE      FROMPER,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L105
          MOVE      TOPER,VAR        
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L106
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      SENDACT,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L107
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      SENDBUD,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L108
          MOVE      EXPTNAME,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L109
          MOVE      FMBTCODE,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L110
          MOVE      FMBTDESC,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L111
          MOVE      FMLADESC,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
PS00L999
          RETURN
.---------------------------------------------------------
. Selections for : Options                            
.---------------------------------------------------------
SF00L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF00L001  BRANCH   ACCEPT,SF00L020
.
SF00L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L006,SF00L101,SF00L102,SF00L006:
                           SF00L103,SF00L104,SF00L105,SF00L106:
                            SF00L006,SF00L107,SF00L108,SF00L109:
                            SF00L110,SF00L006,SF00L006
SF00L006  BEEP
          GOTO     SF00L005
SF00L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF00L090
          MATCH    PRGID,SCSLPID
          GOTO     SF00L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF00L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L020,SF00L020,SF00L020,SF00L020:
                           SF00L103,SF00L104,SF00L105,SF00L106:
                            SF00L020,SF00L107,SF00L108,SF00L109:
                            SF00L110,SF00L020,SF00L020
          GOTO     SF00L020
SF00L090  MOVE     ZERO,ACCEPT
          GOTO     SF00L001
.
SF00L101
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L102
            MOVE      ZERO,HLEF
            CALL      GETSCR00
          CALL      CRET0000
          MOVE      EXIT,SECTOR
          IF        SECTOR=0
            CALL      FRESCR00
            GOTO      SF00L999
          ENDIF
          IF        SECTOR=1
            CALL      FRESCR00
            MOVE      ZERO,EXIT
            GOTO      SF00L001
          ENDIF
          IF        SECTOR=2
            CALL      FRESCR00
            MOVE      ONE,EXIT
            GOTO      SF00L999
          ENDIF
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      PUTSCR00
          IF        SECTOR=4
            CALL      DF00L000
          ENDIF
          GOTO      SF00L001
.
SF00L103
.
.
          MOVE      "   15",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,FMLADESC
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      ELEDG000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L103
            ENDIF
            BRANCH    EXIT,SF00L103,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      LEDGER,VAR       
          CALL      DISPITEM
.
.
          MOVE      "   15",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      FMLADESC,VAR     
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L104
          CALL     SELECTED
          STRIP     EXPTHID 
          SFORMAT   VAR,SCPSLEN
          MOVE      EXPTHID,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,EXPTHID 
          SFORMAT   VAR,127
          ENDSET    EXPTHID 
          APPEND    SP70,EXPTHID 
          RESET     EXPTHID 
          CMATCH    EXITCHAR,EXPTHID 
          GOTO      SF00L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,EXPTHID 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L104
            ENDIF
          ENDIF
          MOVE      EXPTHID,VAR      
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L105
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KFMLCA00
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L105
            ENDIF
            BRANCH    EXIT,SF00L105,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      FMLCYEAR,VAR     
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L106
.
.
          MOVE      "    9",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOPER   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      EPERD000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L106
            ENDIF
            BRANCH    EXIT,SF00L106,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      FROMPER,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    9",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOPER,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L107
          CALL      DEFAULTY
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,SENDACT 
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      SENDACT,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L108
          CALL      DEFAULTY
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,SENDBUD 
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      SENDBUD,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L109
          CALL     SELECTED
          STRIP     EXPTNAME
          SFORMAT   VAR,SCPSLEN
          MOVE      EXPTNAME,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,EXPTNAME
          SFORMAT   VAR,127
          ENDSET    EXPTNAME
          APPEND    SP70,EXPTNAME
          RESET     EXPTNAME
          CMATCH    EXITCHAR,EXPTNAME
          GOTO      SF00L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,EXPTNAME
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L109
            ENDIF
          ENDIF
          MOVE      EXPTNAME,VAR     
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L110
.
.
          MOVE      "   14",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,FMBTDESC
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      EBUDT000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L110
            ENDIF
            BRANCH    EXIT,SF00L110,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      FMBTCODE,VAR     
          CALL      DISPITEM
.
.
          MOVE      "   14",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      FMBTDESC,VAR     
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
SF00L990  MOVE      FOUR,EXIT * Exit Char Exit
SF00L999  RETURN
.@@@@@ Function Restart Point @@@@@
.----------------------------------------
. Move one to accept to for insert mode
.----------------------------------------
MVACCEPT  MOVE      ONE,ACCEPT
          RETURN
DEFAULTY    MOVE     ANSY,DEFYESNO
            RETURN
.------------------------------------------------------------
. Create Transition Export File
.------------------------------------------------------------
CRET0000  IF        ((SENDACT=0)&(SENDBUD=0))
            BEEP
            MOVE      "Either Budget Actual or Both Must be Selected - ",DISPMSG
            CALL      MESSAGE1
            MOVE      "3",EXIT
            GOTO      CRET9999
          ENDIF
.
          IF        SENDBUD=1
            MATCH     SP70,FMBTCODE
            IF        @EQUAL
              BEEP
              MOVE      "Budget Type Must be Specified. - ",DISPMSG
              CALL      MESSAGE1
              MOVE      "3",EXIT
              GOTO      CRET9999
            ENDIF
          ENDIF
.
          CALL      RDFMCO50
          CALL      RDFMCO51
          CALL      RDFMCO52
.
          CALL      OPEN0000
          IF        EXIT=1
            MOVE      "3",EXIT
            GOTO      CRET9999
          ENDIF
.
          REP       "/.",EXPTNAME
          DISPLAY   *P1:24,*EL,"Creating File : ",EXPTNAME
.
          MOVE      "ALB",EXPTREC         * Hard Coded Values as per Req.
          MOVE      "GL          ",EXPTFED
.
          UNPACK    FMLCYEAR,KEY2,EXPTFYR * Fiscal Year
.
          MOVE      ZERO,SECTOR
          PACK      KEY18,ONE,SP70
          CALL      RSFMAM4
CRET1000  CALL      RKFMAM4
          BRANCH    OVRCD,CRET9000
          MOVE      FMAMTYPE,F1
          IF        F1>2
            GOTO      CRET9000
          ENDIF
.
          MATCH     SP70,LEDGER
          GOTO      CRET1050 IF EQUAL
.
          MATCH     LEDGER,FMAMLEDG
          GOTO      CRET1000 IF NOT EQUAL
.
CRET1050  ADD       ONE,SECTOR
          IF        (SECTOR%100=0)
            DISPLAY   *P64:24,*EL," Scanning : ",*V2LON,SECTOR
          ENDIF
.
          MOVE      "R",EXPTATY           * Account Type Revenue
          MATCH     "1",FMAMTYPE
          GOTO      CRET1100 IF EQUAL     * Yes
.
          MOVE      "E",EXPTATY           * Account Type Expense
          MATCH     "2",FMAMTYPE
          GOTO      CRET1000 IF NOT EQUAL * No
.
CRET1100  IF        SENDACT=1
            CALL      WRTA0000
          ENDIF
          IF        SENDBUD=1
            CALL      WRTB0000
          ENDIF
          GOTO      CRET1000
.
CRET9000  DISPLAY   *P1:24,*EL
          MOVE      "Export Complete - ",DISPMSG
          CALL      MESSAGE1
          CALL      TRAN0000
          MOVE      ZERO,EXIT
.
CRET9999  RETURN
.------------------------------------------------------------
. Open/Create Export File
.------------------------------------------------------------
OPEN0000  IF        SENDACT=1
            MOVE      "fmsp",KEY4
            PACK      KEY8,KEY4,FMLCYEAR,SP70
            REP       " 0",KEY8
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      FMSFPSA1,KEY8
            TRAPCLR   IO
            IF        OVRCD=1
              BEEP
              MOVE      "Unable to Open File for Year Specified - ",DISPMSG
              CALL      MESSAGE1
              MOVE      ONE,EXIT
              GOTO      OPEN9999
            ENDIF
          ENDIF
.
          IF        SENDBUD=1
            MOVE      "fmsb",KEY4
            PACK      KEY8,KEY4,FMBTCODE,SP70
            REP       " 0",KEY8
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      FMSBUDA1,KEY8
            TRAPCLR   IO
            IF        OVRCD=1
              BEEP
              MOVE      "Unable to Open File for Budget Specified - ",DISPMSG
              CALL      MESSAGE1
              MOVE      ONE,EXIT
              GOTO      OPEN9999
            ENDIF
          ENDIF
.
          REP       "./",EXPTNAME
          ENDSET    EXPTNAME
          APPEND    SP70,EXPTNAME
          RESET     EXPTNAME
          MATCH     SP70,EXPTNAME
          GOTO      OPEN9000 IF EQUAL
.
          STRIP     EXPTNAME
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      EXPTFILE,EXPTNAME
          TRAPCLR   IO
          BRANCH    OVRCD,OPEN1000
.
OPEN0100  BEEP
          KEYIN     *P1:24,*EL,"Export File Already Exists. Overwrite (":
                    *V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,ANS
          REP       UPPLOW,ANS
          MOVE      ONE,EXIT
          MATCH     "N",ANS
          GOTO      OPEN9999 IF EQUAL
          MATCH     "Y",ANS
          GOTO      OPEN0100 IF NOT EQUAL
          CLOSE     EXPTFILE,DELETE
.
OPEN1000  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          PREP      EXPTFILE,EXPTNAME
          TRAPCLR   IO
          BRANCH    OVRCD,OPEN9100
          MOVE      ZERO,EXIT
          GOTO      OPEN9999
.
OPEN9000  BEEP
          MOVE      "Export Filename MUST be Specified - ",DISPMSG
          CALL      MESSAGE1
          MOVE      ONE,EXIT
          GOTO      OPEN9999
.
OPEN9100  BEEP
          MOVE      "Unable to Create Export File - ",DISPMSG
          CALL      MESSAGE1
          MOVE      ONE,EXIT
          GOTO      OPEN9999
.
OPEN9999  RETURN
.----------------------------------------------------------------------
. Write Actual Value If Not ZERO
.----------------------------------------------------------------------
WRTA0000  PACK      KEY14,FMAMLEDG,FMAMACCT
          CALL      RDFMFP1
          BRANCH    OVRCD,WRTA9999
          MOVE      FROMPER,F2
.
WRTA1000  LOAD      F12P2,F2,FMFPA01,FMFPA02,FMFPA03,FMFPA04,FMFPA05,FMFPA06:
                             FMFPA07,FMFPA08,FMFPA09,FMFPA10,FMFPA11,FMFPA12:
                             FMFPA13
          COMPARE   ZERO,F12P2
          GOTO      WRTA1900 IF EQUAL
.
          MOVE      F2,EXPTFPR
          REP       " 0",EXPTFPR    * Setup Period
.
          MOVE      "A",EXPTTYP     * Actual Amount
.
          ASSIGN    F12P2*100.0,F14P2
          MOVE      F14P2,F14
.
          CALL      WRITE000        * Write Export Record
.
WRTA1900  ADD       ONE,F2
          IF        F2>TOPER
            GOTO      WRTA9999
          ENDIF
          GOTO      WRTA1000
.
WRTA9999  RETURN
.----------------------------------------------------------------------
. Write Budget Value If Not ZERO
.----------------------------------------------------------------------
WRTB0000  PACK      KEY14,FMAMLEDG,FMAMACCT
          CALL      RDFMBU1
          BRANCH    OVRCD,WRTB9999
          MOVE      FROMPER,F2
.
WRTB1000  LOAD      F12P2,F2,FMBUCA01,FMBUCA02,FMBUCA03,FMBUCA04,FMBUCA05:
                             FMBUCA06,FMBUCA07,FMBUCA08,FMBUCA09,FMBUCA10:
                             FMBUCA11,FMBUCA12,FMBUCA13
.
          COMPARE   ZERO,F12P2
          GOTO      WRTB1900 IF EQUAL
.
          MOVE      F2,EXPTFPR
          REP       " 0",EXPTFPR    * Setup Period
.
          MOVE      "A",EXPTTYP     * Actual Amount
.
          ASSIGN    F12P2*100.0,F14P2
          MOVE      F14P2,F14
.
          CALL      WRITE000        * Write Export Record
.
WRTB1900  ADD       ONE,F2
          IF        F2>TOPER
            GOTO      WRTB9999
          ENDIF
          GOTO      WRTB1000
.
WRTB9999  RETURN
.------------------------------------------------------------
. Write Export Record
.------------------------------------------------------------
WRITE000  MOVE      FMAMACCT,ACCOUNT
          CALL      GCOD0000
          STRIP     COSTCODE
          MATCH     SP70,LEDGER
          IF        @EQUAL
            PACK      EXPTACC,FMAMLEDG,COSTCODE,SUBJCODE,SP70
            PACK      EXPTCST,FMAMLEDG,COSTCODE,SP70
            PACK      EXPTSUB,SUBJCODE,SP70
          ELSE
            PACK      EXPTACC,COSTCODE,SUBJCODE,SP70
            PACK      EXPTCST,COSTCODE,SP70
            PACK      EXPTSUB,SUBJCODE,SP70
          ENDIF
.
          MOVE      "0",EXPTSIG     * Positive Amount as Default
          IF        F14<0
            MOVE      "-",EXPTSIG   * Change Sign
            MULT      "-1",F14      * Make Amount Positive
          ENDIF
          MOVE      F14,EXPTAMT
          REP       " 0",EXPTAMT    * Zero Fill Amount Field
.
          WRITE     EXPTFILE,SEQ;EXPTREC,EXPTHID,EXPTFYR,EXPTFPR,EXPTTYP:
                                 EXPTACC,EXPTFED,EXPTCST,EXPTSUB,EXPTATY:
                                 EXPTSIG,EXPTAMT
          RETURN
.****************************************************************************
.  GCOD - get subjective and cost codes from account code    Called by lots
.        Requires - ACCOUNT   (account code)
.                   FMSUUD2A  (separate CC/Subj 1=yes)
.                   FMSUUD4A  (cost centre code length)
.        Returns  - SUBJCODE  (subjective code)
.                   COSTCODE  (cost centre code)
.****************************************************************************
GCOD0000  UNPACK    SP70,SUBJCODE,COSTCODE       * clear old vars
          BRANCH    FMSUUD4A,GCOD0100,GCOD0200,GCOD0300,GCOD0400:
                             GCOD0500,GCOD0600,GCOD0700,GCOD0800:
                             GCOD0900,GCOD1000,GCOD1100,GCOD1200
.
GCOD0100  IF        FMSUUD2A=0
            UNPACK    ACCOUNT,KEY1,SUBJCODE
          ELSE
            UNPACK    ACCOUNT,KEY1,ANS,SUBJCODE
          ENDIF
          PACK      COSTCODE,KEY1,SP70
          GOTO      GCOD90000
.
GCOD0200  IF        FMSUUD2A=0
            UNPACK    ACCOUNT,KEY2,SUBJCODE
          ELSE
            UNPACK    ACCOUNT,KEY2,ANS,SUBJCODE
          ENDIF
          PACK      COSTCODE,KEY2,SP70
          GOTO      GCOD90000
.
GCOD0300  IF        FMSUUD2A=0
            UNPACK    ACCOUNT,KEY3,SUBJCODE
          ELSE
            UNPACK    ACCOUNT,KEY3,ANS,SUBJCODE
          ENDIF
          PACK      COSTCODE,KEY3,SP70
          GOTO      GCOD90000
.
GCOD0400  IF        FMSUUD2A=0
            UNPACK    ACCOUNT,KEY4,SUBJCODE
          ELSE
            UNPACK    ACCOUNT,KEY4,ANS,SUBJCODE
          ENDIF
          PACK      COSTCODE,KEY4,SP70
          GOTO      GCOD90000
.
GCOD0500  IF        FMSUUD2A=0
            UNPACK    ACCOUNT,KEY5,SUBJCODE
          ELSE
            UNPACK    ACCOUNT,KEY5,ANS,SUBJCODE
          ENDIF
          PACK      COSTCODE,KEY5,SP70
          GOTO      GCOD90000
.
GCOD0600  IF        FMSUUD2A=0
            UNPACK    ACCOUNT,KEY6,SUBJCODE
          ELSE
            UNPACK    ACCOUNT,KEY6,ANS,SUBJCODE
          ENDIF
          PACK      COSTCODE,KEY6,SP70
          GOTO      GCOD90000
.
GCOD0700  IF        FMSUUD2A=0
            UNPACK    ACCOUNT,KEY7,SUBJCODE
          ELSE
            UNPACK    ACCOUNT,KEY7,ANS,SUBJCODE
          ENDIF
          PACK      COSTCODE,KEY7,SP70
          GOTO      GCOD90000
.
GCOD0800  IF        FMSUUD2A=0
            UNPACK    ACCOUNT,KEY8,SUBJCODE
          ELSE
            UNPACK    ACCOUNT,KEY8,ANS,SUBJCODE
          ENDIF
          PACK      COSTCODE,KEY8,SP70
          GOTO      GCOD90000
.
GCOD0900  IF        FMSUUD2A=0
            UNPACK    ACCOUNT,KEY9,SUBJCODE
          ELSE
            UNPACK    ACCOUNT,KEY9,ANS,SUBJCODE
          ENDIF
          PACK      COSTCODE,KEY9,SP70
          GOTO      GCOD90000
.
GCOD1000  IF        FMSUUD2A=0
            UNPACK    ACCOUNT,KEY10,SUBJCODE
          ELSE
            UNPACK    ACCOUNT,KEY10,ANS,SUBJCODE
          ENDIF
          PACK      COSTCODE,KEY10,SP70
          GOTO      GCOD90000
.
GCOD1100  IF        FMSUUD2A=0
            UNPACK    ACCOUNT,KEY11,SUBJCODE
          ELSE
            UNPACK    ACCOUNT,KEY11,ANS,SUBJCODE
          ENDIF
          PACK      COSTCODE,KEY11,SP70
          GOTO      GCOD90000
.
GCOD1200  IF        FMSUUD2A=0
            UNPACK    ACCOUNT,KEY12,SUBJCODE
          ELSE
            UNPACK    ACCOUNT,KEY12,ANS,SUBJCODE
          ENDIF
          PACK      COSTCODE,KEY12,SP70
          GOTO      GCOD90000
.
GCOD9000  PACK      SUBJCODE,SUBJCODE,SP70
          PACK      COSTCODE,COSTCODE,SP70
.
GCOD9999  RETURN
.------------------------------------------------------------
. Execute Transfer Script eg softerm
.------------------------------------------------------------
TRAN0000  MOVE     YES,DEFYESNO
          CLOSE    EXPTFILE
          DISPLAY  *P1:24,*EL,"Execute Transfer Now (":
                              *V2LON,"Y",*HOFF,"/":
                              *V2LON,"N",*HOFF,") ? "
          MOVE     "24",CVERT
          MOVE     "30",CCOL
          CALL     YORN0000
          COMPARE  ZERO,FYESNO,
          GOTO     TRAN9999 IF EQUAL   *  No Transfer
.
          MOVE     ZERO,HLEF
          CALL     GETSCR00
.
          CLEAR    KEY80
          APPEND   "ibaaps77.us1 ",KEY80
          APPEND   EXPTNAME,KEY80
          RESET    KEY80
          EXECUTE  KEY80,TASKID
.
          DISPLAY  *P1:24,*EL,"Transfer Completed Ok (":
                              *V2LON,"Y",*HOFF,"/":
                              *V2LON,"N",*HOFF,") ? "
          MOVE     "24",CVERT
          MOVE     "31",CCOL
          CALL     YORN0000
.
          CALL     PUTSCR00
.
          COMPARE  ZERO,FYESNO,
          GOTO     TRAN0000 IF EQUAL   *  Not ok
.
..          PREP     EXPORTFL,EXPORTFN
..          CLOSE    EXPORTFL
.
TRAN9999  RETURN
.
.---------------------------------------------------------------
. Enter Ledger Enter for All
.---------------------------------------------------------------
ELEDG000  MOVE     ZERO,CKEYTYP
          CALL     KFMLAA00
          BRANCH   EXIT,ELEDG100,ELEDG999
          MOVE     FMLALEDG,LEDGER
          MOVE     FMLALEDG,FMLCLEDG    * Setup for Financial Year Keyin
          GOTO     ELEDG999
ELEDG100  PACK     KEY2,SP70
          CALL     RSFMLA1
          CALL     RKFMLA1
          MOVE     FMLALEDG,FMLCLEDG    * Setup for Financial Year Keyin
.
          MOVE     "All Ledgers",FMLADESC
          MOVE     SP70,LEDGER
          MOVE     SP70,FMLALEDG
.
ELEDG999  RETURN
EPERD000   MOVE     "    8",FLDID
           CALL     GETPOSIT
.
EPERD100   KEYIN    *PCCOL:CVERT,*V2LON,FROMPER
.
           IF       FROMPER<1
             BEEP
             GOTO     EPERD100
           ENDIF
           IF       (FROMPER>(12+FMLAPERS))
             BEEP
             GOTO     EPERD100
           ENDIF

EPERD150   MOVE     "    9",FLDID
           CALL     GETPOSIT
.
EPERD200   KEYIN    *PCCOL:CVERT,*V2LON,TOPER
.
           IF       TOPER<1
             BEEP
             GOTO     EPERD100
           ENDIF
           IF       (TOPER>(12+FMLAPERS))
             BEEP
             GOTO     EPERD100
           ENDIF
.
           IF      FROMPER>TOPER
             MOVE     "To Period Must Be >= From Period - ",DISPMSG
             CALL     MESSAGE1
             GOTO     EPERD200
           ENDIF
.
EPERD999   MOVE     "    8",FLDID
           CALL     GETPOSIT
           RETURN
.------------------------------------------------------------
. Enter Budget Type
.------------------------------------------------------------
EBUDT000 IF        SENDBUD=0
           MOVE      SP70,FMBTCODE
           MOVE      SP70,FMBTDESC
           GOTO      EBUDT999      * Budget Type Not Req.
         ENDIF
.
         MOVE      ZERO,CKEYTYP
         CALL      KFMBTA00
         BRANCH    EXIT,EBUDT999,EBUDT999
.
EBUDT999 RETURN
.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       FMSAMAIO/INC
          INC       FMSBTYIO/INC
          INC       FMSBTYKY    
          INC       FMSBUDIO/INC
          INC       FMSCONIO/INC
          INC       FMSCSAIO/INC
          INC       FMSFPSIO/INC
          INC       FMSLMAIO/INC
          INC       FMSLMAKY    
          INC       FMSLMCIO/INC
          INC       FMSLMCKY    
.
          INC       STDGENCD
.

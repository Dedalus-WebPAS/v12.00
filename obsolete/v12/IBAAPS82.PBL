.-------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.00.00"
.-------------------------------------------------------
. V9.02.00 03.05.2002  Glenn Saunders
.          Export to new release i.e. v9.02 from vf.09
.-------------------------------------------------------
BUDFILE   DIM       8
FMSB      INIT      "fmsb"
BUDTYPE   DIM       8
WRKAMT    FORM      12.2
LNO       FORM      "60"
EDIT20    DIM       20
EDIT25    DIM       25
SCRN25    DIM       25
LEDGER    DIM       2
ACCOUNT   DIM       12
UTYPE     DIM       4
TOTLEDG   DIM       2
TOTACCNT  DIM       12
.
ACCTYPE   DIM       12
ACCTYPE1  DIM       12
ACCTYPE2  DIM       12
ACCTYPE3  DIM       12
ACCTYPE4  DIM       12
ACCTYPE5  DIM       12
ACCTYPE6  DIM       12
ACCTYPE7  DIM       12
ACCTYPE8  DIM       12
ACCTYPE9  DIM       12
CACCTIND  FORM      1
.-------------------------------------------------------
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBAAPS82
.   Function      :   Budget by Account Code                  
.   Generated  On :   13/12/2005
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       FMSAMAFD/INC
          INC       FMSBPFFD/INC
          INC       FMSBTYFD/INC
          INC       FMSBUDFD/INC
          INC       FMSBZAFD/INC
          INC       FMSCONFD/INC
          INC       FMSLMAFD/INC
          INC       FMSLMCFD/INC
          INC       FMSTCFFD/INC
          INC       FMSTUPFD/INC
.=========================
.Local Variable Definition
.-------------------------
BUDGPERI  DIM       2 * Scr 00 Fld     3
BUDGPDSC  DIM      10 * Scr 00 Fld     8
.
.    Multi Item Key Fields Scr 00 Fld     9
.-------------------------------------------------------
FMBZ1NAM  INIT      "FMBZ1"
FMBZ1LEN  FORM      "95"
FMBZ1IDX  INIT      "DC1-5 UC6-17"
FMBZ1FNM  DIM       8  * Filename
FMBZ1AFL  FORM      1  * End Accept Mode
FMBZ1END  FORM      1  * End Display
FMBZ1SNO  FORM      5  * Number of Items on the Screen
FMBZ1NXT  DIM         17
FMBZ1FL1  IFILE     SQL, FIXED=95,  KEY="D1-5"
FMBZ1FL2  IFILE     SQL, FIXED=95, KEY="U6-17"
FMBZ1CNT  FORM      3  * Number of Items on Screen
BUDGTOT   FORM     16.2 * Scr 00 Fld    23
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBAAPS82"
PRGNAM    INIT      "Budget by Account Code                  "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          MOVE      PORT,PARENTID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      SC00L000
          CLOSE     FMBZ1FL2
          CLOSE     FMBZ1FL1,DELETE
.
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          DISPLAY   *P56:24,"Opening fmsamaaf";
          OPEN      FMSAMAA1,"fmsamaaf"
          DISPLAY   *P56:24,"Opening fmsamaaf";
          OPEN      FMSAMAA2,"fmsamaaf"
          DISPLAY   *P56:24,"Opening fmsamaaf";
          OPEN      FMSAMAA3,"fmsamaaf"
          DISPLAY   *P56:24,"Opening fmsamaaf";
          OPEN      FMSAMAA4,"fmsamaaf"
          MOVE      "   51",AUDTSECT
          MOVE      " 43",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening fmsaudam";
            OPEN      FMSAUDAM,"fmsaudam"
          ENDIF
          DISPLAY   *P56:24,"Opening  fmsaudbp           ";
          OPEN      FMSAUDBP,"fmsaudbp"          
          MOVE      "   51",AUDTSECT
          MOVE      " 49",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening fmsaudbu";
            OPEN      FMSAUDBU,"fmsaudbu"
          ENDIF
          MOVE      "   51",AUDTSECT
          MOVE      " 46",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening fmsaudla";
            OPEN      FMSAUDLA,"fmsaudla"
          ENDIF
          DISPLAY   *P56:24,"Opening fmsbpfaf";
          OPEN      FMSBPFA1,"fmsbpfaf"
          DISPLAY   *P56:24,"Opening fmsbtyaf";
          OPEN      FMSBTYA1,"fmsbtyaf"
          DISPLAY   *P56:24,"Opening fmsbzaaf";
          OPEN      FMSBZAA1,"fmsbzaaf"
          DISPLAY   *P56:24,"Opening fmslmaaf";
          OPEN      FMSLMAA1,"fmslmaaf"
          DISPLAY   *P56:24,"Opening fmslmcaf";
          OPEN      FMSLMCA1,"fmslmcaf"
          DISPLAY   *P56:24,"Opening  fmstcfaf           ";
          OPEN      FMSTCFA2,"fmstcfaf"          
          DISPLAY   *P56:24,"Opening  fmstupaf           ";
          OPEN      FMSTUPA1,"fmstupaf"          
.--------------------------------------------------------
. Initialise Batch Screen Account Code                       
.--------------------------------------------------------
          MOVE     ZERO,FMBZ1SNO
          MOVE     "00    9",KEY7
          PACK     KEY15,PRGID,KEY7,SP70
          PACK     KEY20,PRGID,KEY7,SP70
          CALL     RSSCPS2
          CALL     RKSCPS2
          IF       OVRCD=0
            PACK     KEY20,SCPSPID,SCPSSID,SCPSITM
            MATCH    KEY15,KEY20
            IF       @EQUAL
              MOVE     SCPSNOR,FMBZ1SNO
            ENDIF
          ENDIF
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "00",SCRID
          IF         @EQUAL
            CALL       PS00L000   * Main Screen                        
          ENDIF
          RETURN
.--------------------------------
. Screen - Main Screen                        
.--------------------------------
SC00L000
SC00L100
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    4",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC00L200
          CALL      CF00L000 * Clear Fields
SC00L300
          CALL      KY00L000 * Enter Key Fields
          BRANCH    EXIT,SC00L999,SC00L999
SC00L400
          CALL      WP00L000 * Load any WP Details
SC00L500
          CALL      LM00L000 * Load any Batch Details
SC00L600
          CALL      DF00L000 * Display Fields
SC00L700
          CALL      SF00L000 * Select Fields
          BRANCH    EXIT,SC00L100,SC00L100,SC00L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC00L800
SC00L900
SC00L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Main Screen                        
.-------------------------------------------------------
CF00L000  COMPARE   ZERO,ACCEPT
              GOTO      CF00L999 IF EQUAL
          MOVE      SP70,FMBTCODE
          MOVE      SP70,FMLALEDG
          MOVE      SP70,BUDGPERI
          MOVE      SP70,FMBTDESC
          MOVE      SP70,FMLADESC
          MOVE      SP70,BUDGPDSC
          MOVE      SP70,FMBZACCT
          MOVE      SP70,FMAMDESC
          MOVE      ZERO,FMBZAMT 
          MOVE      ZERO,BUDGTOT 
CF00L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Main Screen                        
.--------------------------------------------------------
KY00L000
.
KY00L110
.
.
          MOVE      "    6",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,FMBTDESC
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      EBUD0000
          BRANCH    EXIT,KY00L900,KY00L900
          MOVE      ZERO,ACCEPT
          MOVE      FMBTCODE,VAR     
          CALL      DISPITEM
.
.
          MOVE      "    6",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      FMBTDESC,VAR     
            CALL      DISPITEM
          ENDIF
.
KY00L120
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,FMLADESC
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          MOVE      "    2",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      KFMLAA00
          BRANCH    EXIT,KY00L110,KY00L900
          MOVE      ZERO,ACCEPT
          MOVE      FMLALEDG,VAR     
          CALL      DISPITEM
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      FMLADESC,VAR     
            CALL      DISPITEM
          ENDIF
.
KY00L130
          CALL      PERDSC00
.
.
          MOVE      "    8",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,BUDGPDSC
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          MOVE      "    3",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,*JR,*ZF,BUDGPERI:
                    *PCCOL:CVERT
          MATCH     "0000000000000000000",BUDGPERI
          GOTO      KY00L120 IF EQUAL
          ENDSET    BUDGPERI
          CMATCH    EXITCHAR,BUDGPERI
          GOTO      KY00L900 IF EQUAL
          RESET     BUDGPERI
          MOVE      ZERO,ACCEPT
          CALL      VALDP000
          MOVE      BUDGPERI,VAR     
          CALL      DISPITEM
          CALL      PERDSC00
.
.
          MOVE      "    8",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      BUDGPDSC,VAR     
            CALL      DISPITEM
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      KY00L999
.
KY00L900  MOVE      ONE,EXIT
KY00L999  RETURN
.---------------------------------------------------------
. Load WP files for : Main Screen                        
.---------------------------------------------------------
WP00L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Main Screen                        
.---------------------------------------------------------
LM00L000
.---------------------------------------------------------
. Load for :     9 Account Code                       
.---------------------------------------------------------
          UNPACK    SP70,FMBZPORT,FMBZACCT
          PACK      FMBZ1FNM,ANST,FMBZ1NAM,PORT
          REP       " 0",FMBZ1FNM
          MOVE      ZERO,FMBZ1AFL
          CLOSE     FMBZ1FL2
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      FMBZ1FL1,FMBZ1FNM
          TRAPCLR   IO
          IF        OVRCD=0
            CLOSE     FMBZ1FL1,DELETE
          ENDIF
          PACK      KEY80,SGENISB,FMBZ1FNM,SP1,FMBZ1LEN,SP1,FMBZ1IDX
          DISPLAY   *P1:3;
          EXECUTE   KEY80,TASKID
          OPEN      FMBZ1FL1,FMBZ1FNM
          OPEN      FMBZ1FL2,FMBZ1FNM
          PACK      KEY14,PORT,SP70
          MOVE      KEY14,SAVKEY80
          SETLPTR   SAVKEY80,2 
          CALL      RDFMBZ1 
          IF        OVRCD=0
            CALL      RPFMBZ1 
          ENDIF
LM00L100
          CALL      RKFMBZ1 
          BRANCH    OVRCD,LM00L105
          PACK      KEY14,FMBZPORT,FMBZACCT
          MATCH     SAVKEY80,KEY14   
          GOTO      LM00L105 IF NOT EQUAL
          RESET     KEY14,3
          MOVE      KEY14,KEY12
          MOVE      SP70,SCTMROW
          MOVE      SP70,SCTMCOL
          CALL      TAFMBZ12
          IF        OVRCD=0
            CALL      TUFMBZ12
          ELSE
            CALL      TWFMBZ12
          ENDIF
          GOTO     LM00L100
LM00L105
          MOVE     SP70,KEY12  
          CALL     TSFMBZ12
          RETURN
.---------------------------------------------------------
. Batch Item Selected Screen : Main Screen                        
.---------------------------------------------------------
SM00L000
          MOVE      ZERO,STDGSFLG
          MOVE      SCPSITM,FIRSTITM
          MOVE      SCPSROW,SCTMROW
          MOVE      SCPSCOL,SCTMCOL
          PACK      KEY15,PRGID,SCRID,SCPSROW,SCPSCOL
          MOVE      KEY15,SKSCPS15
          CALL      RDSCPS1
          COMPARE   ZERO,ACCEPT
          GOTO      SM00L010 IF EQUAL
SM00L005
          MOVE      SCPSROW,CVERT
          MOVE      SCPSCOL,CCOL
          MOVE      SCPSITM,FIELDNO
          MOVE      ONE,STDGSFLG
          BRANCH    FIELDNO,SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L101,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010
SM00L006
          CALL      RKSCPS1
          BRANCH    OVRCD,SM00L007
          MATCH     PRGID,SCPSPID
          GOTO      SM00L007 IF NOT EQUAL
          MATCH     SCRID,SCPSSID
          GOTO      SM00L007 IF NOT EQUAL
          MATCH     FIRSTITM,SCPSITM
          GOTO      SM00L007 IF EQUAL
          MATCH     NAMSSFFI,SCPSMTY
          GOTO      SM00L006 IF NOT EQUAL
          GOTO      SM00L005
SM00L007
          MOVE      ZERO,STDGSFLG
          MOVE      SKSCPS15,KEY15
          CALL      RDSCPS1
SM00L010
          BRANCH    STDGSFLG,SM00L006
          CALL      RKSCPS1
          BRANCH    OVRCD,SM00L900
          MATCH     PRGID,SCPSPID
          GOTO      SM00L900 IF NOT EQUAL
          MATCH     SCRID,SCPSSID
          GOTO      SM00L900 IF NOT EQUAL
          MATCH     FIRSTITM,SCPSITM
          GOTO      SM00L900 IF EQUAL
          MATCH     NAMSSFFI,SCPSMTY
          GOTO      SM00L010 IF NOT EQUAL
          MOVE      SCPSROW,CVERT
          MOVE      SCPSCOL,CCOL
          MOVE      SCPSITM,FIELDNO
          BRANCH    FIELDNO,SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L102,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010
          GOTO      SM00L010
.
SM00L101
          MOVE     ZERO,FMBZ1AFL
          CALL      EACC0000
          BRANCH    EXIT,SM00L990,SM00L990
          PACK     KEY14,FMBZPORT,FMBZACCT                                                         
          RESET    KEY14,3
          MOVE     KEY14,KEY12
          CALL      TAFMBZ12
          IF        OVRCD=0
            MOVE      "Record Already On File - ",DISPMSG
            CALL      MESSAGE1
            GOTO      SM00L101
          ENDIF
          MOVE      FMBZACCT,VAR     
          CALL      DISPITEM
          CALL      ACCDES00
.
.
          MOVE      "   10",FLDID
          CALL      GETMLPOS
          IF        EXIT=0
            MOVE      FMAMDESC,VAR     
            CALL      DISPITEM
          ENDIF
          GOTO     SM00L010
.
SM00L102
          CALL      CLRFLD00
          MOVE      SP70,VAR
          CALL      DISPITEM
          KEYIN     *PCCOL:CVERT,*V2LON,*NOMASK,*RV,FMBZAMT 
          IF        SCPSMAN=1
            COMPARE   ZERO,FMBZAMT 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SM00L102
            ENDIF
          ENDIF
          CALL      BUDGT000
          MOVE      FMBZAMT,VAR      
          CALL      DISPITEM
          GOTO     SM00L010
SM00L900
          MATCH    "FMBZ1",NAMSSFFI
          IF       @EQUAL
            PACK     KEY14,FMBZPORT,FMBZACCT
            RESET    KEY14,3
            MOVE     KEY14,KEY12
            CALL      TAFMBZ12
            IF        OVRCD=0
              CALL      TUFMBZ12
            ELSE
              CALL      TWFMBZ12
            ENDIF
            GOTO      SM00L999
          ENDIF
          GOTO      SM00L999
SM00L990
          MATCH    "FMBZ1",NAMSSFFI
          IF       @EQUAL
            MOVE     ONE,FMBZ1AFL
          ENDIF
SM00L999
          RETURN
.--------------------------------------------------------
. Display Current Page of Multi Items
.--------------------------------------------------------
DP00L000
          MOVE     ZERO,FMBZ1CNT
          MOVE     ZERO,FMBZ1END
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DP00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DP00L600
          MATCH    PRGID,SCPSPID
          GOTO     DP00L600 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DP00L600 IF NOT EQUAL
          MATCH    NAMSSFFI,SCPSMTY
          GOTO     DP00L010 IF NOT EQUAL
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,DP00L010,DP00L010,DP00L010,DP00L010:
                            DP00L010,DP00L010,DP00L010,DP00L010:
                            DP00L101,DP00L102,DP00L103,DP00L010:
                            DP00L010,DP00L010,DP00L010,DP00L010:
                            DP00L010,DP00L010,DP00L010,DP00L010:
                            DP00L010,DP00L010,DP00L010
          GOTO      DP00L010
.
DP00L101
          IF        FMBZ1END=0
            CALL      TKFMBZ12
            IF        OVRCD=1
              MOVE      ONE,FMBZ1END
            ELSE
              MOVE      ZERO,FMBZ1END
              MOVE      SCPSROW,SCTMROW
              MOVE      SCPSCOL,SCTMCOL
              CALL      TUFMBZ12
              MOVE      FMBZACCT,VAR     
              CALL      DISPITEM
          CALL      ACCDES00
            ENDIF
          ENDIF
          IF        FMBZ1END=1
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP00L010
.
DP00L102
          IF        FMBZ1END=0
            MOVE      FMAMDESC,VAR     
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP00L010
.
DP00L103
          IF        FMBZ1END=0
            MOVE      FMBZAMT,VAR      
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP00L010
DP00L600
          MATCH    "FMBZ1",NAMSSFFI
          GOTO     DP00L605 IF NOT EQUAL
          GOTO     DP00L999
DP00L605
DP00L999
          RETURN
.--------------------------------------------------------
. Display First Page of Multi Items
.--------------------------------------------------------
FP00L000
.
          CALL     CT00L000
          MATCH    "FMBZ1",NAMSSFFI
          GOTO     FP00L105 IF NOT EQUAL
          MOVE     SP70,KEY12  
          CALL     TSFMBZ12 * Start
          CALL     DP00L000
          GOTO     FP00L999
FP00L105
FP00L999  RETURN
.--------------------------------------------------------
. Display Last Page of Multi Items
.--------------------------------------------------------
LP00L000
.
          CALL     CT00L000
          MATCH    "FMBZ1",NAMSSFFI
          GOTO     LP00L105 IF NOT EQUAL
          PACK     KEY12,Z70
          CALL     TSFMBZ12
          IF       OVRCD=1
            CALL     TPFMBZ12 * End
          ENDIF
          MOVE     ZERO,SECTOR
          WHILE    SECTOR<FMBZ1SNO
            CALL     TPFMBZ12
            ADD      ONE,SECTOR
          DO
          CALL     DP00L000
          GOTO     LP00L999
LP00L105
LP00L999  RETURN
.--------------------------------------------------------
. Display Previous Page  
.--------------------------------------------------------
PP00L000
.
PP00L100
          MATCH    "FMBZ1",NAMSSFFI
          GOTO     PP00L115 IF NOT EQUAL
PP00L105
          MOVE     SP70,FMBZ1NXT
          PACK     KEY5,SP1,ONE,SP70
          CALL     TSFMBZ11
          CALL     TKFMBZ11 * First on Page
          MOVE     KEY12,FMBZ1NXT
          CALL     TSFMBZ12
          CALL     TPFMBZ12 * Get Key
          IF       OVRCD=1
            BEEP
            GOTO      PP00L999
          ENDIF
.
          CALL     CT00L000
.
. Position and Display Page
.--------------------------
PP00L110
          MOVE     FMBZ1NXT,KEY12  
          CALL     TSFMBZ12
          MOVE     ZERO,SECTOR
          WHILE    SECTOR<=FMBZ1SNO
            CALL     TPFMBZ12
            ADD      ONE,SECTOR
          DO
          CALL     DP00L000
          GOTO     PP00L999
PP00L115
PP00L999  RETURN
.--------------------------------------------------------
. Display Next Page of Multi Items
.--------------------------------------------------------
NP00L000
          MATCH    "FMBZ1",NAMSSFFI
          GOTO     NP00L115 IF NOT EQUAL
NP00L105
          MOVE     SP70,FMBZ1NXT
          PACK     KEY5,Z70
          CALL     TSFMBZ11
          CALL     TPFMBZ11
          MOVE     KEY12,FMBZ1NXT
          CALL     TSFMBZ12
          CALL     TKFMBZ12
          IF       OVRCD=1
            BEEP
            GOTO      NP00L999
          ENDIF
.
          CALL     CT00L000
.
. Position and Display Page
.--------------------------
NP00L110
          MOVE     FMBZ1NXT,KEY12  
          CALL     TSFMBZ12
          CALL     DP00L000
          GOTO     NP00L999
NP00L115
NP00L999  RETURN
.--------------------------------------------------------
. Clear Page of Multi Items from Temp File
.--------------------------------------------------------
CT00L000
          MATCH    "FMBZ1",NAMSSFFI
          GOTO     CT00L115 IF NOT EQUAL
CT00L105
          PACK     KEY5,SP1,ONE,SP70
          CALL     TSFMBZ11
          CALL     TKFMBZ11
          BRANCH   OVRCD,CT00L110
          CALL     TRFMBZ12
          MOVE     SP70,SCTMROW
          MOVE     SP70,SCTMCOL
          CALL     TUFMBZ12
          GOTO     CT00L105
CT00L110
          GOTO     CT00L999
CT00L115
CT00L999  RETURN
.----------------------------------
. Clear Pages of Multi Items 
.----------------------------------
CP00L000
          CALL     CT00L000
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
CP00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,CP00L999
          MATCH    PRGID,SCPSPID
          GOTO     CP00L999 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     CP00L999 IF NOT EQUAL
          MATCH    NAMSSFFI,SCPSMTY
          GOTO     CP00L010 IF NOT EQUAL
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,CP00L010,CP00L010,CP00L010,CP00L010:
                            CP00L010,CP00L010,CP00L010,CP00L010:
                            CP00L100,CP00L100,CP00L100,CP00L010:
                            CP00L010,CP00L010,CP00L010,CP00L010:
                            CP00L010,CP00L010,CP00L010,CP00L010:
                            CP00L010,CP00L010,CP00L010
.
CP00L100
          PACK     VAR,SP70,SP70
          CALL     DISPITEM  * Display Blank Item
          GOTO     CP00L010
CP00L999  RETURN
.---------------------------------------------------------
. Add Items
.---------------------------------------------------------
AD00L000
          CALL      CP00L000 * Clear Screen of Items
          PACK      KEY20,PRGID,SCRID,ITMSSFFI,SP70
          CALL      RSSCPS2
AD00L010  CALL      RKSCPS2
          BRANCH    OVRCD,AD00L000
          MATCH     PRGID,SCPSPID
          GOTO      AD00L000 IF NOT EQUAL
          MATCH     SCRID,SCPSSID
          GOTO      AD00L000 IF NOT EQUAL
          MATCH     ITMSSFFI,SCPSITM
          GOTO      AD00L000 IF NOT EQUAL
          PACK      SKSCPS20,SCPSPID,SCPSSID,SCPSITM,SCPSROW,SCPSCOL
          MOVE      ACCEPT,SACCEPT
          MOVE      ONE,ACCEPT
          CALL      SM00L000
          MOVE      SACCEPT,ACCEPT
          MOVE      SKSCPS20,KEY20
          CALL      RDSCPS2
          MATCH     "FMBZ1",NAMSSFFI
          IF        @EQUAL
            COMPARE   ZERO,FMBZ1AFL
            GOTO      AD00L010 IF EQUAL
            CALL      FP00L000
            GOTO      AD00L999
          ENDIF
AD00L999
          RETURN
.---------------------------------------------------------
. Delete Items
.---------------------------------------------------------
DL00L000  
          MOVE      SCSLDES,DISPMSG
          CALL      MESSAGE2
DL00L005  
          CALL      MDELQ000
          BRANCH    EXIT,DL00L900,DL00L900
          MOVE      SCSLITM,FIELDNO
          MATCH     ITMSSFFI,SCSLITM
          GOTO      DL00L100 IF NOT EQUAL
          CALL      SELECTED
          MATCH     "FMBZ1",SCPSMTY
          IF        @EQUAL
            PACK      KEY5,SCSLROW,SCSLCOL
            CALL      TRFMBZ11
            IF        OVRCD=0
              CALL      TDFMBZ12
            ELSE
              BEEP
              GOTO      DL00L005
            ENDIF
            PACK      KEY5,SP1,ONE,SP70
            CALL      TSFMBZ11
            CALL      TKFMBZ11
            MOVE     KEY12,FMBZ1NXT
            CALL      CT00L000
            MOVE      FMBZ1NXT,KEY12  
            CALL      TSFMBZ12
            CALL      TPFMBZ12
            CALL      DP00L000
            GOTO      DL00L005
          ENDIF
DL00L100  MOVE      "Invalid Selection. - ",DISPMSG
          CALL      MESSAGE1
          GOTO      DL00L005
DL00L900  CALL      MESSAGE3
          RETURN
.---------------------------------------------------------
. Batch IO for Screen : Main Screen                        
.---------------------------------------------------------
.---------------------------------------------------------
. Batch IO for :     9 Account Code                       
.---------------------------------------------------------
TSFMBZ11  RESET     KEY5
          READ      FMBZ1FL1,KEY5;;
          RETURN
.
TSFMBZ12  RESET     KEY12  
          READ      FMBZ1FL2,KEY12;;
          RETURN
.
TAFMBZ12  RESET     KEY12  
          MOVE      ZERO,OVRCD
          READ      FMBZ1FL2,KEY12;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
TDFMBZ11  RESET     KEY5
          DELETE    FMBZ1FL1,KEY5
          RETURN
.
TDFMBZ12  RESET     KEY12
          DELETE    FMBZ1FL2,KEY12
          RETURN
.
TKFMBZ11  MOVE      ZERO,OVRCD
          READKS    FMBZ1FL1;SCTMROW,SCTMCOL,KEY12:
                        FMBZPORT,FMBZACCT,FMBZAMT,FMBZDESC,FMBZSPA              
          GOTO      OVERCOND IF OVER
          RETURN
.
TKFMBZ12  MOVE      ZERO,OVRCD
          READKS    FMBZ1FL2;SCTMROW,SCTMCOL,KEY12:
                        FMBZPORT,FMBZACCT,FMBZAMT,FMBZDESC,FMBZSPA              
          GOTO      OVERCOND IF OVER
          RETURN
.
TPFMBZ11  MOVE      ZERO,OVRCD
          READKP    FMBZ1FL1;SCTMROW,SCTMCOL,KEY12:
                        FMBZPORT,FMBZACCT,FMBZAMT,FMBZDESC,FMBZSPA              
          GOTO      OVERCOND IF OVER
          RETURN
.
TPFMBZ12  MOVE      ZERO,OVRCD
          READKP    FMBZ1FL2;SCTMROW,SCTMCOL,KEY12:
                        FMBZPORT,FMBZACCT,FMBZAMT,FMBZDESC,FMBZSPA              
          GOTO      OVERCOND IF OVER
          RETURN
.
TRFMBZ11  RESET     KEY5
          MOVE      ZERO,OVRCD
          READ      FMBZ1FL1,KEY5;SCTMROW,SCTMCOL,KEY12:
                        FMBZPORT,FMBZACCT,FMBZAMT,FMBZDESC,FMBZSPA              
          GOTO      OVERCOND IF OVER
          RETURN
.
TRFMBZ12  RESET     KEY12  
          MOVE      ZERO,OVRCD
          READ      FMBZ1FL2,KEY12;SCTMROW,SCTMCOL,KEY12:
                        FMBZPORT,FMBZACCT,FMBZAMT,FMBZDESC,FMBZSPA              
          GOTO      OVERCOND IF OVER
          RETURN
.
TUFMBZ11  UPDATE    FMBZ1FL1;SCTMROW,SCTMCOL,KEY12:
                        FMBZPORT,FMBZACCT,FMBZAMT,FMBZDESC,FMBZSPA              
          RETURN
.
TUFMBZ12
          UPDATE    FMBZ1FL2;SCTMROW,SCTMCOL,KEY12:
                        FMBZPORT,FMBZACCT,FMBZAMT,FMBZDESC,FMBZSPA              
          RETURN
.
TWFMBZ12  RESET     KEY12  
          WRITE     FMBZ1FL2,KEY12;SCTMROW,SCTMCOL,KEY12:
                        FMBZPORT,FMBZACCT,FMBZAMT,FMBZDESC,FMBZSPA              
          RETURN
.---------------------------------------------------------
. Display Fields for : Main Screen                        
.---------------------------------------------------------
DF00L000
          BRANCH   ACCEPT,DF00L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF00L900
          MATCH    PRGID,SCPSPID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF00L010 IF NOT EQUAL
.
          CALL     PS00L000 * Display Field
          GOTO     DF00L010
DF00L900
          MOVE      "FMBZ1",NAMSSFFI
          MOVE      "    9",ITMSSFFI
          CALL      FP00L000
DF00L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Main Screen                        
.---------------------------------------------------------
PS00L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS00L999,PS00L999,PS00L999,PS00L999:
                            PS00L999,PS00L101,PS00L102,PS00L103:
                            PS00L999,PS00L999,PS00L999,PS00L999:
                            PS00L999,PS00L999,PS00L999,PS00L999:
                            PS00L999,PS00L999,PS00L999,PS00L999:
                            PS00L999,PS00L999,PS00L104
          GOTO     PS00L999
.
PS00L101
          MOVE      FMBTDESC,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L102
          MOVE      FMLADESC,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L103
          CALL      PERDSC00
          MOVE      BUDGPDSC,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L104
          MOVE      BUDGTOT,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
PS00L999
          RETURN
.---------------------------------------------------------
. Selections for : Main Screen                        
.---------------------------------------------------------
SF00L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF00L001  BRANCH   ACCEPT,SF00L020
.
SF00L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L101,SF00L006,SF00L006,SF00L006:
                            SF00L102,SF00L006,SF00L006,SF00L103:
                            SF00L104,SF00L006,SF00L006,SF00L105:
                            SF00L106,SF00L107,SF00L108,SF00L109:
                            SF00L110,SF00L111,SF00L006
SF00L006  BEEP
          GOTO     SF00L005
SF00L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF00L090
          MATCH    PRGID,SCSLPID
          GOTO     SF00L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF00L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L102,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020
          GOTO     SF00L020
SF00L090  MOVE     ZERO,ACCEPT
          MOVE      "FMBZ1",NAMSSFFI
          MOVE      "    9",ITMSSFFI
          CALL      FP00L000
          GOTO     SF00L001
.
SF00L101
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L102
          CALL      SELECTED
          BRANCH    EXIT,SF00L001
          MOVE      "FMBZ1",NAMSSFFI
          MOVE      SCPSITM,ITMSSFFI
          IF        ACCEPT=0
            PACK      KEY5,SCPSROW,SCPSCOL
            CALL      TRFMBZ11
            BRANCH    OVRCD,SF00L001
            MATCH     SCTMROW,SCSLROW
            GOTO      SF00L001 IF NOT EQUAL
            MATCH     SCTMCOL,SCSLCOL
            GOTO      SF00L001 IF NOT EQUAL
            CALL      SM00L000 * Change Line
          ELSE
            IF        FMBZ1AFL=0
              MOVE      "FMBZ1",NAMSSFFI
              MOVE     "    9",ITMSSFFI
              CALL      AD00L000 * Add Line
            ENDIF
          ENDIF
          GOTO     SF00L001
.
SF00L103
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L104
            MOVE      ZERO,HLEF
            CALL      GETSCR00
          CALL      PRNT0000
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    4",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      PUTSCR00
          CALL      DF00L000
          GOTO      SF00L001
.
SF00L105
          MOVE      "FMBZ1",NAMSSFFI
          MOVE      "    9",ITMSSFFI
          CALL      NP00L000
          GOTO     SF00L001
.
SF00L106
          MOVE      "FMBZ1",NAMSSFFI
          MOVE      "    9",ITMSSFFI
          CALL      PP00L000
          GOTO     SF00L001
.
SF00L107
          MOVE      "FMBZ1",NAMSSFFI
          MOVE      "    9",ITMSSFFI
          CALL      AD00L000
          GOTO     SF00L001
.
SF00L108
          CALL      DLAC0000
          GOTO      SF00L001
.
SF00L109
          MOVE      "FMBZ1",NAMSSFFI
          MOVE      "    9",ITMSSFFI
          CALL      FP00L000
          GOTO     SF00L001
.
SF00L110
          MOVE      "FMBZ1",NAMSSFFI
          MOVE      "    9",ITMSSFFI
          CALL      LP00L000
          GOTO     SF00L001
.
SF00L111
            MOVE      ZERO,HLEF
            CALL      GETSCR00
          CALL      POST0000
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    4",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      PUTSCR00
          CALL      DF00L000
          GOTO      SF00L001
SF00L990  MOVE      FOUR,EXIT * Exit Char Exit
SF00L999  RETURN
.@@@@@ Function Restart Point @@@@@
.*-----------------------------------------------------------
.* Validate Budget Period
.*-----------------------------------------------------------
VALDP000  MOVE      BUDGPERI,F2
          IF        F2 < 1 | F2 > 13
            DISPLAY *P1:22,*EL,"Invalid period. Must be 1-13. "
            GOTO    KY00L130
          ELSE
            DISPLAY *P1:22,*EL
          ENDIF
VALDP999  RETURN
.*------------------------------------------------------------------------*
.* Display period name
.*------------------------------------------------------------------------*
PERDSC00  PACK      KEY6,FMLALEDG,FMBTCODE
          CALL      RDFMLC1
          MOVE      BUDGPERI,F2
          LOAD      BUDGPDSC,F2,FMLC01DE,FMLC02DE,FMLC03DE,FMLC04DE,FMLC05DE:
                                FMLC06DE,FMLC07DE,FMLC08DE,FMLC09DE,FMLC10DE:
                                FMLC11DE,FMLC12DE,FMLC13DE
PERDSC99  RETURN
.*------------------------------------------------------------------------*
.* Read Account Description
.*------------------------------------------------------------------------*
ACCDES00  PACK      KEY14,FMLALEDG,FMBZACCT,SP70
          CALL      RDFMAM1
          MOVE      FMAMDESC,FMBZDESC
ACCDES99  RETURN
.------------------------------------------------------------
. Clear amount field prior to displaying line
.------------------------------------------------------------
CLRFLD00  IF        ACCEPT = 0
            SUBTRACT FMBZAMT,BUDGTOT
          ENDIF
          MOVE     ZERO,FMBZAMT
CLRFLD99  RETURN
.------------------------------------------------------------
. Accumulate hash total of all budget amounts entered
.------------------------------------------------------------
BUDGT000  ADD       FMBZAMT,BUDGTOT
          MOVE      "(9999,999,999,999,999.99 ",SCRN25
          FEDIT     BUDGTOT,SCRN25
          DISPLAY   *P55:5,*EL,SCRN25
BUDGT999  RETURN
.*-----------------------------------------------------------------
.* Determine budget file for this budget type
.*-----------------------------------------------------------------
EBUD0000  CALL      KBTYFM00           * keyin budget type code
          BRANCH    EXIT,EBUD9000,EBUD9000
.
          MATCH     "2",FMBTSTAT
          GOTO      EBUD8500 IF EQUAL
.
.** open the budget file for this budget type
.
          PACK      BUDTYPE,FMBTCODE,SP70
          CLEAR     BUDFILE
          APPEND    FMSB,BUDFILE
          APPEND    FMBTCODE,BUDFILE
          RESET     BUDFILE
          REP       " 0",BUDFILE
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      FMSBUDA1,BUDFILE
          TRAPCLR   IO
          BRANCH    OVRCD,EBUD8100
          GOTO      EBUD9999
.
EBUD8100  DISPLAY   *P1:24,*EL,*B,"Budget File ",BUDFILE:
                    " Not Available - ";
          CALL      HITENTER
          GOTO      EBUD0000
.
EBUD8500  DISPLAY   *P1:24,*EL,*B,"Budget File Locked. No Maintenance ":
                    "Allowed - ";
          CALL      HITENTER
          GOTO      EBUD0000
.
EBUD9000  MOVE      ONE,EXIT
.
EBUD9999  RETURN
.*------------------------------------------------------------------------*
.* Enter Account Code
.*------------------------------------------------------------------------*
EACC0000  CALL      KAMAFM00              * keyin account code
          BRANCH    EXIT,EACC9999,EACC9999
          MOVE      ZERO,EXIT
          MOVE      FMAMTYPE,FORM1
          BRANCH    FORM1,EACC1000,EACC1000,EACC1000,EACC1000,EACC1000
          MOVE      "Invalid Account Type. Must be 1,2,3,4 or 5",DISPMSG
          CALL      MESSAGE1
          GOTO      EACC0000
.
EACC1000  MOVE      FMAMACCT,FMBZACCT
          GOTO      EACC9999
.
EACC2000  PACK      FMBPCODE,SP70
          BRANCH    OPTION,EACC9999  * not present - must be in insert mode
.
          DISPLAY   *P1:24,*EL,"Budget not on file. ";
          BEEP
          CALL      HITENTER
          GOTO      EACC0000
.
EACC9000  MOVE      ONE,EXIT
.
EACC9999  RETURN
.*-----------------------------------------------------------
.* Print Budget Details
.*-----------------------------------------------------------
PRNT0000  CLOCK     TIME,CTIMEIS
          MOVE      ONE,CNOUNDLN

          PACK      KEY12,SP70
          CALL      TSFMBZ12     ** - start file from beginning

PRNT1000  CALL      TKFMBZ12     ** - read 1st record
          BRANCH    OVRCD,PRNT9997 ** - temporary file empty no printing !
          GOTO      PRNT3000

PRNT2000  CALL      TKFMBZ12     ** - read next record
          BRANCH    OVRCD,PRNT9998 ** - end of file

PRNT3000  IF        LNO > 54
            CALL      HEAD80
            PRINT     SP70,SP70
            PRINT     "Budget Type: ",FMBTCODE,SP2,FMBTDESC
            PRINT     "Ledger     : ",FMLALEDG,SP4,FMLADESC
            PRINT     "Period     : ",BUDGPERI,SP4,BUDGPDSC
            PRINT     SP70,SP70
            PRINT     SP5,*ULON,"Account     ",*HOFF,SP2:
                      *ULON,"Description                        ",*HOFF,SP2:
                      SP5,*ULON,"         Amount",*HOFF
            PRINT     SP70,SP70
            MOVE      "10",LNO
          ENDIF

          CLEAR     EDIT20
          MOVE      "(999,999,999,999.99 ",EDIT20
          FEDIT     FMBZAMT,EDIT20
          PRINT     SP5,FMBZACCT,SP2,FMBZDESC,SP2,EDIT20
          ADD       "1",LNO
          GOTO      PRNT2000

PRNT9997  DISPLAY   *P1:24,*EL,"No Budget Data to print - ";
          CALL      HITENTER
          GOTO      PRNT9999

PRNT9998  PRINT     SP70,SP70
          CLEAR     EDIT25
          MOVE      "(9999,999,999,999,999.99 ",EDIT25
          FEDIT     BUDGTOT,EDIT25
          PRINT     SP30,SP6," Budget Total: ",EDIT25
          DISPLAY   *P1:24,*EL,"Budgets Printed - ";
          CALL      HITENTER
          GOTO      PRNT9999

PRNT9999  RETURN
.-----------------------------------------------------------------------
. Delete Item
.----------------------------------------------------------------------
DLAC0000  MOVE      SCSLDES,DISPMSG
          CALL      MESSAGE2

DLAC0005  CALL      MDELQ000
          BRANCH    EXIT,DLAC9999,DLAC9999
          MOVE      SCSLITM,FIELDNO
          MATCH     ITMSSFFI,SCSLITM
          GOTO      DLAC1000 IF NOT EQUAL
          CALL      SELECTED
          MATCH     "FMBZ1",SCPSMTY
          IF        @EQUAL
            PACK    KEY5,SCSLROW,SCSLCOL
            CALL    TRFMBZ11
            IF      OVRCD=0
              SUBTRACT FMBZAMT,BUDGTOT
              MOVE  "(9999,999,999,999,999.99 ",SCRN25
              FEDIT BUDGTOT,SCRN25
              DISPLAY  *P55:5,*EL,SCRN25
              CALL  TDFMBZ12
            ELSE
              BEEP
              GOTO  DLAC0005
            ENDIF
          PACK      KEY5,SP1,ONE,SP70
          CALL      TSFMBZ11
          CALL      TKFMBZ11
          MOVE      KEY12,FMBZ1NXT
          CALL      CT00L000
          MOVE      FMBZ1NXT,KEY12
          CALL      TSFMBZ11
          CALL      TPFMBZ12
          CALL      DP00L000
          GOTO      DLAC0005
         ENDIF
DLAC1000 MOVE       "Invalid Selection. - ",DISPMSG
         CALL       MESSAGE1
         GOTO       DLAC0005
DLAC9999 CALL       MESSAGE3
         CALL       FP00L000
         RETURN

.*-----------------------------------------------------------
.* Save Budgets
.*-----------------------------------------------------------
POST0000  PACK      KEY12,SP70
          CALL      TSFMBZ12        ** - start file from beginning

POST1000  CALL      TKFMBZ12        ** - read next record
          BRANCH    OVRCD,POST9997  ** - temporary file empty no posting!!
          GOTO      POST3000

POST2000  CALL      TKFMBZ12        ** - read next record
          BRANCH    OVRCD,POST9998  ** - end of file

POST3000  PACK      KEY14,FMLALEDG,FMBZACCT
          CALL      RDFMBU1
          BRANCH    OVRCD,POST5000  ** - not on budget file

POST4000  MOVE      TWO,AUDTTYPE   ** - before change audit image
          CALL      WAFMBU00       ** - write audit
          PROC      POPBUD00       ** - setup budget data for given period
          MOVE      THREE,AUDTTYPE ** - after change audit image
          CALL      WAFMBU00       ** - write audit
          CALL      UPFMBU1        ** - update existing budget record
          GOTO      POST6000

POST5000  PROC      CLRBUD00    ** - clear budget record i-o area
          DISPLAY   *P1:22,*EL,*V2LON,*ULON,FMBZACCT,*HOFF,*V2LON:
                               " not on budget file. Being created. ":
                               *HOFF;
          CALL      HITENTER
          PACK      KEY14,FMLALEDG,FMBZACCT
          MOVE      FMLALEDG,FMBUCULD
          MOVE      FMBZACCT,FMBUCUAC
          PROC      POPBUD00       ** - setup budget data for given period
          MOVE      ONE,AUDTTYPE   ** - new audit image
          CALL      WAFMBU00       ** - write audit
          CALL      WRFMBU1        ** - write new budget record
          GOTO      POST6000

POST6000  MOVE      FMBUCULD,LEDGER
          MOVE      FMBUCUAC,ACCOUNT
          PACK      UTYPE,FMBTCODE,SP70
          PROC      FMSUA000
          GOTO      POST2000

POST9997  DISPLAY   *P1:24,*EL,"No Budget Data to post - ";
          CALL      HITENTER
          GOTO      POST9999

POST9998  DISPLAY   *P1:22,*EL
          DISPLAY   *P1:24,*EL,"Budgets Updated - ";
          CALL      HITENTER
          GOTO      POST9999

          DEFPROC   CLRBUD00
CLRBUD01  MOVE      SP2,FMBUCULD
          MOVE      SP20,FMBUCUAC
          MOVE      SP3,FMBUCUPR

          MOVE      ZERO,FMBUCA01
          MOVE      ZERO,FMBUCA02
          MOVE      ZERO,FMBUCA03
          MOVE      ZERO,FMBUCA04
          MOVE      ZERO,FMBUCA05
          MOVE      ZERO,FMBUCA06
          MOVE      ZERO,FMBUCA07
          MOVE      ZERO,FMBUCA08
          MOVE      ZERO,FMBUCA09
          MOVE      ZERO,FMBUCA10
          MOVE      ZERO,FMBUCA11
          MOVE      ZERO,FMBUCA12
          MOVE      ZERO,FMBUCA13

          MOVE      ZERO,FMBUCB01
          MOVE      ZERO,FMBUCB02
          MOVE      ZERO,FMBUCB03
          MOVE      ZERO,FMBUCB04
          MOVE      ZERO,FMBUCB05
          MOVE      ZERO,FMBUCB06
          MOVE      ZERO,FMBUCB07
          MOVE      ZERO,FMBUCB08
          MOVE      ZERO,FMBUCB09
          MOVE      ZERO,FMBUCB10
          MOVE      ZERO,FMBUCB11
          MOVE      ZERO,FMBUCB12
          MOVE      ZERO,FMBUCB13

          MOVE      ZERO,FMBUCC01
          MOVE      ZERO,FMBUCC02
          MOVE      ZERO,FMBUCC03
          MOVE      ZERO,FMBUCC04
          MOVE      ZERO,FMBUCC05
          MOVE      ZERO,FMBUCC06
          MOVE      ZERO,FMBUCC07
          MOVE      ZERO,FMBUCC08
          MOVE      ZERO,FMBUCC09
          MOVE      ZERO,FMBUCC10
          MOVE      ZERO,FMBUCC11
          MOVE      ZERO,FMBUCC12
          MOVE      ZERO,FMBUCC13

CLRBUD99  ENDPROC

          DEFPROC   POPBUD00
POPBUD01  MOVE      BUDGPERI,F2
          STORE     FMBZAMT,F2,FMBUCA01,FMBUCA02,FMBUCA03,FMBUCA04:
                               FMBUCA05,FMBUCA06,FMBUCA07,FMBUCA08:
                               FMBUCA09,FMBUCA10,FMBUCA11,FMBUCA12:
                               FMBUCA13

          STORE     FMBZAMT,F2,FMBUCB01,FMBUCB02,FMBUCB03,FMBUCB04:
                               FMBUCB05,FMBUCB06,FMBUCB07,FMBUCB08:
                               FMBUCB09,FMBUCB10,FMBUCB11,FMBUCB12:
                               FMBUCB13

          MOVE      FMBZAMT,WRKAMT
          DIVIDE    "1000",WRKAMT
          STORE     WRKAMT,F2,FMBUCC01,FMBUCC02,FMBUCC03,FMBUCC04:
                               FMBUCC05,FMBUCC06,FMBUCC07,FMBUCC08:
                               FMBUCC09,FMBUCC10,FMBUCC11,FMBUCC12:
                               FMBUCC13

POPBUD99  ENDPROC

POST9999  RETURN
.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       FMSAMAIO/INC
          INC       FMSAMAKY    
          INC       FMSBPFIO/INC
          INC       FMSBPFKY    
          INC       FMSBTYIO/INC
          INC       FMSBTYKY    
          INC       FMSBUDIO/INC
          INC       FMSBZAIO/INC
          INC       FMSCONIO/INC
          INC       FMSLMAIO/INC
          INC       FMSLMAKY    
          INC       FMSLMCIO/INC
          INC       FMSTCFIO/INC
          INC       FMSTUPIO/INC
          INC       PRCFMSUA    
.
          INC       STDGENCD
.

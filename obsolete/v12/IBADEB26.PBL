.-----------------------------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.00.00"
.-------------------------------------------------------
.V10.04.01  15/04/2014 Ebon Clements CAR 299449
.           Recompiled for IBAPRINT 6 character printers
.V10.02.01  07/04/2011 Mike Laming for Jill CAR 239574
.           Remove CALL to ' IBAPRNT1,"ibaprntf" '
. V9.11.01  10.10.2008 J.Tan         CAR 180356
.           Recompiled for DEBCRDCD - MAXCLNO for layout 8
. V9.09.01  25.10.2007 Sandra Barcham    109997
.           Allow printing of partial quantities for layout 12
.-------------------------------------------------------
. V9.05.01  24.03.2006  Peter Vela       61299
.           Recompiled for DEBCRDCD
.-------------------------------------------------------
. V9.04.B01 23.12.2005  Sandra Barcham   77705
.           Make quantity print decimal places
.-------------------------------------------------------
. V9.02.00  03.05.2002  Glenn Saunders
.           Export to new release i.e. v9.02 from vf.09
.-------------------------------------------------------
ADMDATE   DIM       10
ASATDATE  DIM       10
CARRIED   FORM      1
CRFWDCOL  FORM      3
CRFWDROW  FORM      3
CRLINE    FORM      3
CURRROW   FORM      3
DBFHDTOT  FORM      12.2   8        31    Total Inc Tax
DBFHFTOT  DIM       14                    Formatted Total
DIM10A    DIM       10
DIM14A    DIM       14
DIM14B    DIM       14
DIM35     DIM       35
.
DIM10TOT  DIM       10
DIM12TOT  DIM       12
DIM10PRI  DIM       10
DIM9TAX   DIM       9
DIM10TAX  DIM       10
DIM13TAX  DIM       13
DIM9GRN   DIM       9
DIM14GRN  DIM       14
DIM14TAX  DIM       14
DIM4QTY   DIM       4
DIM7QTY   DIM       7
DIM8QTY   DIM       8
DIM13QTY  DIM       13
.
DISDATE   DIM       10
ENDADD    FORM      1
F4P2      FORM      4.2
F5P2      FORM      5.2
F7P2      FORM      7.2
F9P2      FORM      9.2
F12       FORM      12
F12P2     FORM      12.2
FORM3     FORM      3
FORM5     FORM      5
FTGSTEXC  DIM       14
FTGSTAMN  DIM       14
FTOTINV   DIM       14
HEADTAIL  FORM      1
HEADLENG  FORM      3
INVDAT    DIM       8
INVREF    DIM       12
MAXCOLNO  FORM      3
MAXLENGT  FORM      3
NOTELINE  FORM      3
OLDINV    DIM       8
PRNTSTRT  FORM      3
SAVUR1    DIM       25
SAVUR2    DIM       25
SAVUD1    DIM       8
SAVUD2    DIM       8
SAVUY1    DIM       1
SAVUY2    DIM       1
SAVUC1    DIM       3
SAVUC2    DIM       3
STAMESS1  DIM       30
STAMESS2  DIM       30
SVTOTALS  FORM      12.2
TAILLENG  FORM      3
TGSTEXCV  FORM      12.2
TGSTAMNT  FORM      12.2
TMPLTFLG  FORM      1
TOTDIM12  DIM       12
TOTTAX    FORM      12.2
TOTQTY    FORM      12.2
TOTTOT    FORM      12.2
TRANLINE  FORM      3
VARIABLE  DIM       127
X70       INIT      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
.-----------------------------------------------------------------------------
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBADEB26
.   Function      :   Credit Note Processing                  
.   Generated  On :   07/04/2011
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       DEBCODFD/INC
          INC       DEBCONFD/INC
          INC       DEBDBTFD/INC
          INC       DEBDCMFD/INC
          INC       DEBDKIFD/INC
          INC       DEBFDTFD/INC
          INC       DEBFNOFD/INC
          INC       DEBFTHFD/INC
          INC       DEBICMFD/INC
          INC       DEBINVDF    
          INC       DEBITMFD/INC
          INC       DEBLINFD/INC
          INC       DEBPTYFD/INC
          INC       DEBSECFD/INC
          INC       DEBTCRFD/INC
          INC       DEBTDCFD/INC
          INC       DEBTERFD/INC
          INC       IBACONFD/INC
          INC       IBAGEDFD/INC
          INC       IBAGSTFD/INC
          INC       IBAPRNFD/INC
          INC       IBATMDFD/INC
          INC       IBATMHFD/INC
.=========================
.Local Variable Definition
.-------------------------
TOTALCRD  FORM     12.2 * Scr 01 Fld    10
CRDATE    DIM       8 * Scr 01 Fld    11
DBDBUC1D  DIM      35 * Scr 01 Fld    34
DBDBUC2D  DIM      35 * Scr 01 Fld    35
DBDBUC3D  DIM      35 * Scr 01 Fld    36
DBDBUC4D  DIM      35 * Scr 01 Fld    37
DBDBWRND  DIM      35 * Scr 01 Fld    38
.
.Word Processor File * Scr 01 Fld    42
.
NAMDBDC1  INIT      "Wdbdc1"
FILDBDC1  DIM       8
.
.
.    Multi Item Key Fields Scr 01 Fld    61
.-------------------------------------------------------
DBTC1NAM  INIT      "DBTC1"
DBTC1END  FORM      1   * End Display
DBTC1SNO  FORM      5   * Number of Items on the Screen
DBTC1MKY  DIM       127 * Match Key 
DBTC1EKY  DIM       127 * End Key
DBTC1SKY  DIM       127 * Start Key
DBTC1IDX  INIT      " 132 UC1-5"
DBTC1FL1  IFILE     SQL, FIXED=132, KEY="U1-5"
DBTC1FNM  DIM       8  * Filename
DBTC1CNT  FORM      3  * Number of Items on Screen
TOTALAMT  FORM     12.2 * Scr 01 Fld    73
DBTCUC1D  DIM      35 * Scr 02 Fld    32
DBTCUC2D  DIM      35 * Scr 02 Fld    33
DBTCUC3D  DIM      35 * Scr 02 Fld    34
DBTCUC4D  DIM      35 * Scr 02 Fld    35
.
.Word Processor File * Scr 02 Fld    37
.
NAMDBTD1  INIT      "Wdbtd1"
FILDBTD1  DIM       8
.
.
.    Multi Item Key Fields Scr 03 Fld    61
.-------------------------------------------------------
DBFD1NAM  INIT      "DBFD1"
DBFD1END  FORM      1   * End Display
DBFD1SNO  FORM      5   * Number of Items on the Screen
DBFD1MKY  DIM       127 * Match Key 
DBFD1EKY  DIM       127 * End Key
DBFD1SKY  DIM       127 * Start Key
DBFD1IDX  INIT      " 132 UC1-5"
DBFD1FL1  IFILE     SQL, FIXED=132, KEY="U1-5"
DBFD1FNM  DIM       8  * Filename
DBFD1CNT  FORM      3  * Number of Items on Screen
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBADEB26"
PRGNAM    INIT      "Credit Note Processing                  "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          MOVE      PORT,PARENTID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      SELPRT00
          CALL      SC00L000
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      TEMPWORD,FILDBDC1
          TRAPCLR   IO
          IF        OVRCD=0
            CLOSE     TEMPWORD,DELETE
          ENDIF
          CLOSE     DBTC1FL1,DELETE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      TEMPWORD,FILDBTD1
          TRAPCLR   IO
          IF        OVRCD=0
            CLOSE     TEMPWORD,DELETE
          ENDIF
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          MOVE      "   81",AUDTSECT
          MOVE      "  9",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening debaudcd";
            OPEN      DEBAUDCD,"debaudcd"
          ENDIF
          MOVE      "   81",AUDTSECT
          MOVE      " 10",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening debauddb";
            OPEN      DEBAUDDB,"debauddb"
          ENDIF
          MOVE      "   81",AUDTSECT
          MOVE      " 12",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening debaudit";
            OPEN      DEBAUDIT,"debaudit"
          ENDIF
          MOVE      "   81",AUDTSECT
          MOVE      " 13",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening debaudpt";
            OPEN      DEBAUDPT,"debaudpt"
          ENDIF
          MOVE      "   81",AUDTSECT
          MOVE      " 14",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening debaudse";
            OPEN      DEBAUDSE,"debaudse"
          ENDIF
          MOVE      "   81",AUDTSECT
          MOVE      " 15",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening debaudte";
            OPEN      DEBAUDTE,"debaudte"
          ENDIF
          DISPLAY   *P56:24,"Opening debcodaf";
          OPEN      DEBCODA1,"debcodaf"
          DISPLAY   *P56:24,"Opening debcodaf";
          OPEN      DEBCODA2,"debcodaf"
          DISPLAY   *P56:24,"Opening debdbtaf";
          OPEN      DEBDBTA1,"debdbtaf"
          DISPLAY   *P56:24,"Opening debdbtaf";
          OPEN      DEBDBTA2,"debdbtaf"
          DISPLAY   *P56:24,"Opening debdbtaf";
          OPEN      DEBDBTA3,"debdbtaf"
          DISPLAY   *P56:24,"Opening debdcmaf";
          OPEN      DEBDCMA1,"debdcmaf"
          DISPLAY   *P56:24,"Opening debdkiaf";
          OPEN      DEBDKIA1,"debdkiaf"
          DISPLAY   *P56:24,"Opening debdkiaf";
          OPEN      DEBDKIA2,"debdkiaf"
          DISPLAY   *P56:24,"Opening debfdtaf";
          OPEN      DEBFDTA1,"debfdtaf"
          DISPLAY   *P56:24,"Opening debfdtaf";
          OPEN      DEBFDTA2,"debfdtaf"
          DISPLAY   *P56:24,"Opening debfdtaf";
          OPEN      DEBFDTA3,"debfdtaf"
          DISPLAY   *P56:24,"Opening debfdtaf";
          OPEN      DEBFDTA4,"debfdtaf"
          DISPLAY   *P56:24,"Opening debfdtaf";
          OPEN      DEBFDTA5,"debfdtaf"
          DISPLAY   *P56:24,"Opening debfdtaf";
          OPEN      DEBFDTA7,"debfdtaf"
          DISPLAY   *P56:24,"Opening debfdtaf";
          OPEN      DEBFDTA8,"debfdtaf"
          DISPLAY   *P56:24,"Opening debfnoaf";
          OPEN      DEBFNOA1,"debfnoaf"
          DISPLAY   *P56:24,"Opening debfthaf";
          OPEN      DEBFTHA1,"debfthaf"
          DISPLAY   *P56:24,"Opening debfthaf";
          OPEN      DEBFTHA2,"debfthaf"
          DISPLAY   *P56:24,"Opening debfthaf";
          OPEN      DEBFTHA3,"debfthaf"
          DISPLAY   *P56:24,"Opening debfthaf";
          OPEN      DEBFTHA4,"debfthaf"
          DISPLAY   *P56:24,"Opening debfthaf";
          OPEN      DEBFTHA5,"debfthaf"
          DISPLAY   *P56:24,"Opening debfthaf";
          OPEN      DEBFTHA6,"debfthaf"
          DISPLAY   *P56:24,"Opening debfthaf";
          OPEN      DEBFTHA7,"debfthaf"
          DISPLAY   *P56:24,"Opening debicmaf";
          OPEN      DEBICMA1,"debicmaf"
          DISPLAY   *P56:24,"Opening debitmaf";
          OPEN      DEBITMA1,"debitmaf"
          DISPLAY   *P56:24,"Opening debitmaf";
          OPEN      DEBITMA2,"debitmaf"
          DISPLAY   *P56:24,"Opening debitmaf";
          OPEN      DEBITMA3,"debitmaf"
          DISPLAY   *P56:24,"Opening  debdbtaf           ";
          OPEN      DEBLINA1,"debdbtaf"          
          DISPLAY   *P56:24,"Opening  debdbtaf           ";
          OPEN      DEBLINA2,"debdbtaf"          
          DISPLAY   *P56:24,"Opening debptyaf";
          OPEN      DEBPTYA1,"debptyaf"
          DISPLAY   *P56:24,"Opening debptyaf";
          OPEN      DEBPTYA2,"debptyaf"
          DISPLAY   *P56:24,"Opening debptyaf";
          OPEN      DEBPTYA3,"debptyaf"
          DISPLAY   *P56:24,"Opening debsecaf";
          OPEN      DEBSECA1,"debsecaf"
          DISPLAY   *P56:24,"Opening debsecaf";
          OPEN      DEBSECA2,"debsecaf"
          DISPLAY   *P56:24,"Opening debtcraf";
          OPEN      DEBTCRA1,"debtcraf"
          DISPLAY   *P56:24,"Opening debtdcaf";
          OPEN      DEBTDCA1,"debtdcaf"
          DISPLAY   *P56:24,"Opening debteraf";
          OPEN      DEBTERA1,"debteraf"
          DISPLAY   *P56:24,"Opening ibagedaf";
          OPEN      IBAGEDA1,"ibagedaf"
          DISPLAY   *P56:24,"Opening ibagstaf";
          OPEN      IBAGSTA1,"ibagstaf"
          DISPLAY   *P56:24,"Opening ibagstaf";
          OPEN      IBAGSTA2,"ibagstaf"
          DISPLAY   *P56:24,"Opening ibagstaf";
          OPEN      IBAGSTA3,"ibagstaf"
          DISPLAY   *P56:24,"Opening  ibatmdaf           ";
          OPEN      IBATDET1,"ibatmdaf"          
          DISPLAY   *P56:24,"Opening ibatmhaf";
          OPEN      IBATMHA1,"ibatmhaf"
          DISPLAY   *P56:24,"Opening ibatmhaf";
          OPEN      IBATMHA2,"ibatmhaf"
.--------------------------------------------------------
. Initialise Wp Filename for Debtor Notes                       
.--------------------------------------------------------
          PACK      FILDBDC1,NAMDBDC1,PORT
          REP       " 0",FILDBDC1
          DISPLAY   *P56:24,"Create & Open ",FILDBDC1;
          PREP      TEMPWORD,FILDBDC1
.
.--------------------------------------------------------
. Initialise Batch Screen Document Line                      
.--------------------------------------------------------
          MOVE     ZERO,DBTC1SNO
          MOVE     "01   61",KEY7
          PACK     KEY15,PRGID,KEY7,SP70
          PACK     KEY20,PRGID,KEY7,SP70
          CALL     RSSCPS2
          CALL     RKSCPS2
          IF       OVRCD=0
            PACK     KEY20,SCPSPID,SCPSSID,SCPSITM
            MATCH    KEY15,KEY20
            IF       @EQUAL
              MOVE     SCPSNOR,DBTC1SNO
            ENDIF
          ENDIF
          PACK      DBTC1FNM,ANST,DBTC1NAM,PORT
          REP       " 0",DBTC1FNM
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      DBTC1FL1,DBTC1FNM
          TRAPCLR   IO
          IF        OVRCD=0
            CLOSE     DBTC1FL1,DELETE
          ENDIF
          PACK      KEY80,SGENISB,DBTC1FNM,DBTC1IDX
          DISPLAY   *P1:3;
          DISPLAY   *P56:24,"Create & Open ",DBTC1FNM;
          EXECUTE   KEY80,TASKID
          OPEN      DBTC1FL1,DBTC1FNM
.--------------------------------------------------------
. Initialise Wp Filename for Notes                              
.--------------------------------------------------------
          PACK      FILDBTD1,NAMDBTD1,PORT
          REP       " 0",FILDBTD1
          DISPLAY   *P56:24,"Create & Open ",FILDBTD1;
          PREP      TEMPWORD,FILDBTD1
.
.--------------------------------------------------------
. Initialise Batch Screen Document Line Number               
.--------------------------------------------------------
          MOVE     ZERO,DBFD1SNO
          MOVE     "03   61",KEY7
          PACK     KEY15,PRGID,KEY7,SP70
          PACK     KEY20,PRGID,KEY7,SP70
          CALL     RSSCPS2
          CALL     RKSCPS2
          IF       OVRCD=0
            PACK     KEY20,SCPSPID,SCPSSID,SCPSITM
            MATCH    KEY15,KEY20
            IF       @EQUAL
              MOVE     SCPSNOR,DBFD1SNO
            ENDIF
          ENDIF
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "00",SCRID
          IF         @EQUAL
            CALL       PS00L000   * Menu                               
          ENDIF
          MATCH     "01",SCRID
          IF         @EQUAL
            CALL       PS01L000   * Input/Print Credit Note            
          ENDIF
          MATCH     "02",SCRID
          IF         @EQUAL
            CALL       PS02L000   * Item Details                       
          ENDIF
          MATCH     "03",SCRID
          IF         @EQUAL
            CALL       PS03L000   * Re-Print Invoice                   
          ENDIF
          RETURN
.--------------------------------
. Screen - Menu                               
.--------------------------------
SC00L000
SC00L100
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC00L200
          CALL      CF00L000 * Clear Fields
SC00L300
          CALL      KY00L000 * Enter Key Fields
          BRANCH    EXIT,SC00L999,SC00L999
SC00L400
          CALL      WP00L000 * Load any WP Details
SC00L500
          CALL      LM00L000 * Load any Batch Details
SC00L600
          CALL      DF00L000 * Display Fields
SC00L700
          CALL      SF00L000 * Select Fields
          BRANCH    EXIT,SC00L100,SC00L100,SC00L200
SC00L800
SC00L900
SC00L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Menu                               
.-------------------------------------------------------
CF00L000
CF00L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Menu                               
.--------------------------------------------------------
KY00L000
          MOVE      ZERO,EXIT
          GOTO      KY00L999
.
KY00L900  MOVE      ONE,EXIT
KY00L999  RETURN
.---------------------------------------------------------
. Load WP files for : Menu                               
.---------------------------------------------------------
WP00L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Menu                               
.---------------------------------------------------------
LM00L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Menu                               
.---------------------------------------------------------
DF00L000
          BRANCH   ACCEPT,DF00L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF00L900
          MATCH    PRGID,SCPSPID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF00L010 IF NOT EQUAL
.
          CALL     PS00L000 * Display Field
          GOTO     DF00L010
DF00L900
DF00L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Menu                               
.---------------------------------------------------------
PS00L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS00L999,PS00L999,PS00L999,PS00L999:
                            PS00L999
          GOTO     PS00L999
PS00L999
          RETURN
.---------------------------------------------------------
. Selections for : Menu                               
.---------------------------------------------------------
SF00L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF00L001  BRANCH   ACCEPT,SF00L020
.
SF00L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L006,SF00L101,SF00L102,SF00L103:
                            SF00L104
SF00L006  BEEP
          GOTO     SF00L005
SF00L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF00L090
          MATCH    PRGID,SCSLPID
          GOTO     SF00L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF00L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020
          GOTO     SF00L020
SF00L090  MOVE     ZERO,ACCEPT
          GOTO     SF00L001
.
SF00L101
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L102
          CALL      SC01L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L103
          CALL      SC03L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L104
          CALL      CRDPL000
          MOVE      ONE,EXIT
          GOTO      SF00L999
SF00L990  MOVE      ONE,EXIT * Exit Char Restart
SF00L999  RETURN
.--------------------------------
. Screen - Input/Print Credit Note            
.--------------------------------
SC01L000
SC01L100
          MOVE      "01",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC01L200
          CALL      CF01L000 * Clear Fields
SC01L300
          CALL      KY01L000 * Enter Key Fields
          BRANCH    EXIT,SC01L999,SC01L999
SC01L400
          CALL      WP01L000 * Load any WP Details
SC01L500
          CALL      LM01L000 * Load any Batch Details
SC01L600
          CALL      DF01L000 * Display Fields
SC01L700
          CALL      SF01L000 * Select Fields
          BRANCH    EXIT,SC01L100,SC01L100,SC01L200
SC01L800
SC01L900
SC01L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Input/Print Credit Note            
.-------------------------------------------------------
CF01L000
          MOVE      SP70,DBDBDEB 
          MOVE      SP70,NADLINE1
          MOVE      SP70,NADLINE2
          MOVE      SP70,NADLINE3
          MOVE      SP70,NADLINE4
          MOVE      SP70,NADLINE5
          MOVE      ZERO,TOTALCRD
          MOVE      SP70,CRDATE  
          MOVE      SP70,DBDBPH1 
          MOVE      SP70,DBDBPH2 
          MOVE      SP70,DBDBPH3 
          MOVE      SP70,DBDBCON 
          MOVE      ZERO,DBDBACT 
          MOVE      ZERO,DBDBSTA 
          MOVE      ZERO,DBDBTEX 
          MOVE      SP70,DBDBTER 
          MOVE      SP70,DBDBWRN 
          MOVE      SP70,DBDBLIN 
          MOVE      SP70,DBDBPUR 
          MOVE      ZERO,DBDBBAD 
          MOVE      SP70,DBDBSORT
          MOVE      SP70,DBDBUR2 
          MOVE      SP70,DBDBUD1 
          MOVE      SP70,DBDBUD2 
          MOVE      SP70,DBDBUY1 
          MOVE      SP70,DBDBUY2 
          MOVE      SP70,DBDBUC1 
          MOVE      SP70,DBDBUC2 
          MOVE      SP70,DBDBUC3 
          MOVE      SP70,DBDBUC4 
          MOVE      SP70,DBDBUC1D
          MOVE      SP70,DBDBUC2D
          MOVE      SP70,DBDBUC3D
          MOVE      SP70,DBDBUC4D
          MOVE      SP70,DBDBWRND
          MOVE      SP70,DBTEDES 
          MOVE      SP70,DBLNNA1 
          MOVE      SP70,DBFHDOC 
          MOVE      SP70,DBFHDDAT
          MOVE      SP70,DBFHTER 
          MOVE      ZERO,DBFHTOT 
          MOVE      ZERO,DBFHTAX 
          MOVE      SP70,DBFHDPRT
          MOVE      SP70,DBFHDSTA
          MOVE      SP70,DBFHCDAT
          MOVE      SP70,DBFHCTIM
          MOVE      SP70,DBFHCUSR
          MOVE      SP70,DBFHUR1 
          MOVE      SP70,DBFHUR2 
          MOVE      SP70,DBFHUD1 
          MOVE      SP70,DBFHUD2 
          MOVE      SP70,DBFHUY1 
          MOVE      SP70,DBFHUY2 
          MOVE      SP70,DBFHUC1 
          MOVE      SP70,DBFHUC2 
          MOVE      ZERO,DBFHDTOT
          MOVE      SP70,DBTCDLN 
          MOVE      SP70,DBTCITM 
          MOVE      SP70,DBTCSDAT
          MOVE      SP70,DBTCDREF
          MOVE      SP70,DBTCOREF
          MOVE      ZERO,DBTCQTY 
          MOVE      ZERO,DBTCPRI 
          MOVE      ZERO,DBTCTOT 
          MOVE      ZERO,DBTCTAX 
          MOVE      ZERO,TOTALAMT
          MOVE      SP70,DBITDES 
          MOVE      SP70,DBTCGST 
CF01L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Input/Print Credit Note            
.--------------------------------------------------------
KY01L000
.
KY01L110
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,NADLINE1
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    6",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,NADLINE2
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,NADLINE3
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    8",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,NADLINE4
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    9",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,NADLINE5
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   12",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBDBPH1 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   13",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBDBPH2 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   14",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBDBPH3 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   15",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBDBCON 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   16",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBDBACT 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   17",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBDBSTA 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   18",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBDBTEX 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   19",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBDBTER 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   20",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBDBWRN 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          MOVE      "    4",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      EKEYF000
          BRANCH    EXIT,KY01L900,KY01L900
          MOVE      ZERO,ACCEPT
          MOVE      DBDBDEB,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      NADLINE1,VAR     
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    6",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      NADLINE2,VAR     
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      NADLINE3,VAR     
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    8",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      NADLINE4,VAR     
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    9",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      NADLINE5,VAR     
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   12",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      DBDBPH1,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   13",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      DBDBPH2,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   14",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      DBDBPH3,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   15",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      DBDBCON,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   16",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      NO,YESNO
            MOVE      ZERO,FORM2
            MOVE      DBDBACT,FORM2    
            LOAD      YESNO,FORM2,YES
            MOVE      YESNO,VAR
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   17",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      NO,YESNO
            MOVE      ZERO,FORM2
            MOVE      DBDBSTA,FORM2    
            LOAD      YESNO,FORM2,YES
            MOVE      YESNO,VAR
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   18",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      NO,YESNO
            MOVE      ZERO,FORM2
            MOVE      DBDBTEX,FORM2    
            LOAD      YESNO,FORM2,YES
            MOVE      YESNO,VAR
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   19",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      DBDBTER,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   20",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      DBDBWRN,VAR      
            CALL      DISPITEM
          ENDIF
.
KY01L120
          CALL      DATECURR
          MOVE      "   11",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      ECDAT000
          BRANCH    EXIT,KY01L110,KY01L900
          MOVE      ZERO,ACCEPT
          UNPACK    CRDATE,CCENT,CYEAR,CMON,CDAY            
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
.
KY01L130
          MOVE      "   41",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      EINVN000
          BRANCH    EXIT,KY01L120,KY01L900
          MOVE      ZERO,ACCEPT
          MOVE      DBFHDOC,VAR      
          CALL      DISPITEM
          MOVE      ZERO,EXIT
          GOTO      KY01L999
.
KY01L900  MOVE      ONE,EXIT
KY01L999  RETURN
.---------------------------------------------------------
. Load WP files for : Input/Print Credit Note            
.---------------------------------------------------------
WP01L000
          PREP     TEMPWORD,FILDBDC1
          PACK     KEY11,DBDBDEB,SP70
          MOVE     KEY11,SAVKEY80
          SETLPTR  SAVKEY80,8 
          CALL      RDDBDC1 
          IF        OVRCD=0
            CALL      RPDBDC1 
          ENDIF
WP01L100
          CALL     RKDBDC1 
          BRANCH   OVRCD,WP01L105
          PACK     KEY11,DBDCDEB,DBDCLIN
          MATCH    SAVKEY80,KEY11   
          GOTO     WP01L105 IF NOT EQUAL
          PACK     VAR,DBDCCOM,SP70,SP70
          STRIP    VAR
          MOVELPTR VAR,F3
          SFORMAT  VAR,F3
          MOVE     DBDCCOM,VAR
          IF       F3=0
            WRITE    TEMPWORD,SEQ;
          ELSE
            WRITE    TEMPWORD,SEQ;VAR
          ENDIF
          SFORMAT  VAR,127
          GOTO     WP01L100
WP01L105  CLOSE    TEMPWORD
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Input/Print Credit Note            
.---------------------------------------------------------
LM01L000
.---------------------------------------------------------
. Load for :    61 Document Line                      
.---------------------------------------------------------
          UNPACK    SP70,DBTCDEB,DBTCDLN
          PACK      KEY11,DBFHDEB,SP70
          MOVE      KEY11,DBTC1EKY
          STRIP     DBTC1SKY
          SETLPTR   DBTC1EKY,8
          MOVE      DBTC1EKY,DBTC1SKY
          CALL      RDDBTC1 
          IF        OVRCD=0
            CALL      RPDBTC1 
          ENDIF
          RETURN
.--------------------------------------------------------
. Display Current Page of Multi Items
.--------------------------------------------------------
DP01L000
          MOVE     ZERO,DBTC1CNT
          MOVE     ZERO,DBTC1END
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DP01L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DP01L600
          MATCH    PRGID,SCPSPID
          GOTO     DP01L600 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DP01L600 IF NOT EQUAL
          MATCH    NAMSSFFI,SCPSMTY
          GOTO     DP01L010 IF NOT EQUAL
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,DP01L010,DP01L010,DP01L010,DP01L010:
                            DP01L010,DP01L010,DP01L010,DP01L010:
                            DP01L010,DP01L010,DP01L010,DP01L010:
                            DP01L010,DP01L010,DP01L010,DP01L010:
                            DP01L010,DP01L010,DP01L010,DP01L010:
                            DP01L010,DP01L010,DP01L010,DP01L010:
                            DP01L010,DP01L010,DP01L010,DP01L010:
                            DP01L010,DP01L010,DP01L010,DP01L010:
                            DP01L010,DP01L010,DP01L010,DP01L010:
                            DP01L010,DP01L010,DP01L010,DP01L010:
                            DP01L010,DP01L010,DP01L010,DP01L010:
                            DP01L010,DP01L010,DP01L010,DP01L010:
                            DP01L010,DP01L010,DP01L010,DP01L010:
                            DP01L010,DP01L010,DP01L010,DP01L010:
                            DP01L010,DP01L010,DP01L010,DP01L010:
                            DP01L101,DP01L010,DP01L010,DP01L010:
                           DP01L102,DP01L103,DP01L104,DP01L105:
                            DP01L106,DP01L107,DP01L108,DP01L109:
                            DP01L110,DP01L111,DP01L112,DP01L010:
                           DP01L010,DP01L010,DP01L010,DP01L010:
                            DP01L010,DP01L010,DP01L010,DP01L010:
                            DP01L010
          GOTO      DP01L010
.
DP01L101
          PACK      DBTC1MKY,SP70,SP70
          CALL      UPTDBTC1
          IF        DBTC1END=0
            CALL      RKDBTC1 
            IF        OVRCD=0
              PACK      DBTC1MKY,DBTCDEB,DBTCDLN                                                                
              MATCH     DBTC1EKY,DBTC1MKY
              IF        @EQUAL
                MOVE      ZERO,DBTC1END
                ADD       ONE,DBTC1CNT
                CALL      UPTDBTC1
          CALL      REDDET00
                MOVE      DBTCDLN,VAR      
                CALL      DISPITEM
              ELSE
                MOVE      ONE,DBTC1END
              ENDIF
            ELSE
              MOVE      ONE,DBTC1END
            ENDIF
          ENDIF
          IF        DBTC1END=1
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP01L010
.
DP01L102
          IF        DBTC1END=0
            MOVE      DBTCITM,VAR      
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP01L010
.
DP01L103
          IF        DBTC1END=0
            UNPACK    DBTCSDAT,CCENT,CYEAR,CMON,CDAY          
            CALL      PACDATE
            MOVE      CPCDATE,VAR
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP01L010
.
DP01L104
          IF        DBTC1END=0
            MOVE      DBTCDREF,VAR     
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP01L010
.
DP01L105
          IF        DBTC1END=0
            MOVE      DBTCOREF,VAR     
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP01L010
.
DP01L106
          IF        DBTC1END=0
            MOVE      DBTCQTY,VAR      
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP01L010
.
DP01L107
          IF        DBTC1END=0
            MOVE      DBTCPRI,VAR      
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP01L010
.
DP01L108
          IF        DBTC1END=0
            MOVE      DBTCTOT,VAR      
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP01L010
.
DP01L109
          IF        DBTC1END=0
            MOVE      DBTCTAX,VAR      
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP01L010
.
DP01L110
          IF        DBTC1END=0
            MOVE      TOTALAMT,VAR     
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP01L010
.
DP01L111
          IF        DBTC1END=0
            MOVE      DBITDES,VAR      
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP01L010
.
DP01L112
          IF        DBTC1END=0
            MOVE      DBTCGST,VAR      
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP01L010
DP01L600
          MATCH    "DBTC1",NAMSSFFI
          GOTO     DP01L605 IF NOT EQUAL
          GOTO     DP01L999
DP01L605
DP01L999
          RETURN
.--------------------------------------------------------
. Display First Page of Multi Items
.--------------------------------------------------------
FP01L000
.
          MATCH    "DBTC1",NAMSSFFI
          GOTO     FP01L105 IF NOT EQUAL
          PACK     KEY11,DBTC1SKY,SP70
          CALL     RDDBTC1  * Start
          IF       OVRCD=0
            CALL     RPDBTC1  * Start
          ENDIF
          CALL     DP01L000
          GOTO     FP01L999
FP01L105
FP01L999  RETURN
.--------------------------------------------------------
. Display Last Page of Multi Items
.--------------------------------------------------------
LP01L000
.
          MATCH    "DBTC1",NAMSSFFI
          GOTO     LP01L105 IF NOT EQUAL
          PACK     KEY11,DBTC1SKY,Z70
          CALL     RSDBTC1  * End
          IF       OVRCD=1
            CALL     RPDBTC1 
          ENDIF
          MOVE     ZERO,SECTOR
          WHILE    SECTOR<DBTC1SNO
            CALL     RPDBTC1 
            IF       OVRCD=1
              MOVE     DBTC1SNO,SECTOR
            ENDIF
            PACK     DBTC1MKY,DBTCDEB,DBTCDLN                                                                
            MATCH    DBTC1EKY,DBTC1MKY
            IF       !@EQUAL
              MOVE     DBTC1SNO,SECTOR
            ENDIF
            ADD      ONE,SECTOR
          DO
          CALL     DP01L000
          GOTO     LP01L999
LP01L105
LP01L999  RETURN
.--------------------------------------------------------
. Display Previous Page  
.--------------------------------------------------------
PP01L000
.
          MATCH    "DBTC1",NAMSSFFI
          GOTO     PP01L120 IF NOT EQUAL
          MOVE     ZERO,SECTOR
PP01L105
          CALL      RFTDBTC1
          BRANCH   OVRCD,PP01L115
          MOVE      DBTC1MKY,KEY11 
          CALL      RSDBTC1 
PP01L110
          MOVE     ZERO,SECTOR
          WHILE    SECTOR<=DBTC1SNO
            CALL     RPDBTC1 
            IF       OVRCD=1
              MOVE     DBTC1SNO,SECTOR
            ENDIF
            PACK     DBTC1MKY,DBTCDEB,DBTCDLN                                                                
            MATCH    DBTC1EKY,DBTC1MKY
            IF       !@EQUAL
              MOVE     DBTC1SNO,SECTOR
            ENDIF
            ADD      ONE,SECTOR
          DO
          CALL     DP01L000
          GOTO     PP01L999
PP01L115
          BEEP
          MOVE     ZERO,SECTOR
          WHILE    SECTOR<DBTC1SNO
            CALL     RKDBTC1 
            IF       OVRCD=1
              MOVE     DBTC1SNO,SECTOR
            ENDIF
            PACK     DBTC1MKY,DBTCDEB,DBTCDLN                                                                
            MATCH    DBTC1EKY,DBTC1MKY
            IF       !@EQUAL
              MOVE     DBTC1SNO,SECTOR
            ENDIF
            ADD      ONE,SECTOR
          DO
          GOTO     PP01L999
PP01L120
PP01L999  RETURN
.--------------------------------------------------------
. Display Next Page of Multi Items
.--------------------------------------------------------
NP01L000
          MATCH    "DBTC1",NAMSSFFI
          GOTO     NP01L115 IF NOT EQUAL
NP01L105
          CALL     RKDBTC1 
          BRANCH   OVRCD,NP01L110
          PACK     DBTC1MKY,DBTCDEB,DBTCDLN                                                                
          MATCH    DBTC1EKY,DBTC1MKY
          GOTO     NP01L110 IF NOT EQUAL
          CALL     RPDBTC1 
          CALL     DP01L000
          GOTO     NP01L999
NP01L110
          CALL     RPDBTC1 
          BEEP
          GOTO     NP01L999
NP01L115
NP01L999  RETURN
.--------------------------------------------------------
. Clear Page of Multi Items from Temp File
.--------------------------------------------------------
CT01L000
CT01L105
CT01L999  RETURN
.---------------------------------------------------------
. Batch IO for Screen : Input/Print Credit Note            
.---------------------------------------------------------
.---------------------------------------------------------
. Batch IO for :    61 Document Line                      
.---------------------------------------------------------
UPTDBTC1
          PACK      KEY5,SCPSROW,SCPSCOL
          READ      DBTC1FL1,KEY5;ANS
          IF        @OVER
            WRITE     DBTC1FL1,KEY5;SCPSROW,SCPSCOL,DBTC1MKY
          ELSE
            UPDATE    DBTC1FL1;SCPSROW,SCPSCOL,DBTC1MKY
          ENDIF
          RETURN
RDTDBTC1
          MOVE      ZERO,OVRCD
          PACK      KEY5,SCPSROW,SCPSCOL
          READ      DBTC1FL1,KEY5;SCPSROW,SCPSCOL,DBTC1MKY
          GOTO      OVERCOND IF OVER
          RETURN
RFTDBTC1
          MOVE      ZERO,OVRCD
          PACK      KEY5,SP70
          READ      DBTC1FL1,KEY5;;
          READKS    DBTC1FL1;SCPSROW,SCPSCOL,DBTC1MKY
          GOTO      OVERCOND IF OVER
          MATCH     SP70,DBTC1MKY
          GOTO      OVERCOND IF EQUAL
          RETURN
.---------------------------------------------------------
. Display Fields for : Input/Print Credit Note            
.---------------------------------------------------------
DF01L000
          BRANCH   ACCEPT,DF01L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF01L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF01L900
          MATCH    PRGID,SCPSPID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF01L010 IF NOT EQUAL
.
          CALL     PS01L000 * Display Field
          GOTO     DF01L010
DF01L900
          MOVE      "DBTC1",NAMSSFFI
          MOVE      "   61",ITMSSFFI
          CALL      FP01L000
DF01L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Input/Print Credit Note            
.---------------------------------------------------------
PS01L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS01L999,PS01L999,PS01L999,PS01L999:
                            PS01L101,PS01L102,PS01L103,PS01L104:
                            PS01L105,PS01L106,PS01L999,PS01L107:
                            PS01L108,PS01L109,PS01L110,PS01L111:
                            PS01L112,PS01L113,PS01L114,PS01L115:
                            PS01L116,PS01L117,PS01L118,PS01L119:
                            PS01L120,PS01L121,PS01L122,PS01L123:
                            PS01L124,PS01L125,PS01L126,PS01L127:
                            PS01L128,PS01L129,PS01L130,PS01L131:
                            PS01L132,PS01L133,PS01L134,PS01L135:
                            PS01L999,PS01L136,PS01L137,PS01L138:
                            PS01L139,PS01L140,PS01L141,PS01L142:
                            PS01L143,PS01L144,PS01L145,PS01L146:
                            PS01L147,PS01L148,PS01L149,PS01L150:
                            PS01L151,PS01L152,PS01L153,PS01L154:
                            PS01L999,PS01L999,PS01L999,PS01L999:
                           PS01L999,PS01L999,PS01L999,PS01L999:
                            PS01L999,PS01L999,PS01L999,PS01L999:
                            PS01L999,PS01L999,PS01L999,PS01L999:
                           PS01L999,PS01L999,PS01L999,PS01L999:
                            PS01L999,PS01L999,PS01L999,PS01L999:
                            PS01L999
          GOTO     PS01L999
.
PS01L101
          MOVE      NADLINE1,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L102
          MOVE      NADLINE2,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L103
          MOVE      NADLINE3,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L104
          MOVE      NADLINE4,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L105
          MOVE      NADLINE5,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L106
          MOVE      TOTALCRD,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L107
          MOVE      DBDBPH1,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L108
          MOVE      DBDBPH2,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L109
          MOVE      DBDBPH3,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L110
          MOVE      DBDBCON,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L111
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      DBDBACT,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L112
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      DBDBSTA,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L113
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      DBDBTEX,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L114
          MOVE      DBDBTER,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L115
          MOVE      DBDBWRN,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L116
          MOVE      DBDBLIN,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L117
          MOVE      DBDBPUR,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L118
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      DBDBBAD,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L119
          MOVE      DBDBSORT,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L120
          MOVE      DBDBUR2,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L121
          UNPACK    DBDBUD1,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L122
          UNPACK    DBDBUD2,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L123
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      DBDBUY1,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L124
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      DBDBUY2,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L125
          MOVE      DBDBUC1,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L126
          MOVE      DBDBUC2,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L127
          MOVE      DBDBUC3,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L128
          MOVE      DBDBUC4,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L129
          MOVE      DBDBUC1D,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L130
          MOVE      DBDBUC2D,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L131
          MOVE      DBDBUC3D,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L132
          MOVE      DBDBUC4D,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L133
          MOVE      DBDBWRND,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L134
          MOVE      DBTEDES,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L135
          MOVE      DBLNNA1,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L136
          MOVE     FILDBDC1,WORDNAME
          CALL     DISPWORD
          GOTO     PS01L999
.
PS01L137
          UNPACK    DBFHDDAT,CCENT,CYEAR,CMON,CDAY          
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L138
          MOVE      DBFHTER,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L139
          MOVE      DBFHTOT,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L140
          MOVE      DBFHTAX,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L141
          UNPACK    DBFHDPRT,CCENT,CYEAR,CMON,CDAY          
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L142
          UNPACK    DBFHDSTA,CCENT,CYEAR,CMON,CDAY          
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L143
          UNPACK    DBFHCDAT,CCENT,CYEAR,CMON,CDAY          
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L144
          MOVE      DBFHCTIM,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L145
          MOVE      DBFHCUSR,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L146
          MOVE      DBFHUR1,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L147
          MOVE      DBFHUR2,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L148
          UNPACK    DBFHUD1,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L149
          UNPACK    DBFHUD2,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L150
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      DBFHUY1,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L151
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      DBFHUY2,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L152
          MOVE      DBFHUC1,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L153
          MOVE      DBFHUC2,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L154
          MOVE      DBFHDTOT,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
PS01L999
          RETURN
.---------------------------------------------------------
. Selections for : Input/Print Credit Note            
.---------------------------------------------------------
SF01L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF01L001  BRANCH   ACCEPT,SF01L020
.
SF01L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L006,SF01L101,SF01L102,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L103,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L104,SF01L006,SF01L006,SF01L006:
                           SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                           SF01L006,SF01L006,SF01L006,SF01L105:
                            SF01L106,SF01L107,SF01L108,SF01L109:
                            SF01L110
SF01L006  BEEP
          GOTO     SF01L005
SF01L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF01L090
          MATCH    PRGID,SCSLPID
          GOTO     SF01L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF01L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L103,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L104,SF01L020,SF01L020,SF01L020:
                           SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                           SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020
          GOTO     SF01L020
SF01L090  MOVE     ZERO,ACCEPT
          MOVE      "DBTC1",NAMSSFFI
          MOVE      "   61",ITMSSFFI
          CALL      FP01L000
          GOTO     SF01L001
.
SF01L101
          CALL      CANC0000
          MOVE      ONE,EXIT
          GOTO      SF01L999
.
SF01L102
          CALL      POST0000
          MOVE      ONE,EXIT
          GOTO      SF01L999
.
SF01L103
          CALL     SELECTED
          IF       EXIT=1
            IF       ACCEPT=0
              MOVE     "10",SCPSROW
              MOVE     "  5",SCPSCOL
              MOVE     " 70",SCPSLEN
              MOVE     "10",SCPSNOR
              MOVE     SCPSROW,CVERT
              MOVE     SCPSCOL,CCOL
              MOVE     ZERO,HLEF
              CALL     GETSCR00
              MOVE     FILDBDC1,WORDNAME
              MOVE     " 12",WORDTYPE
              CALL     EDITWORD
              CALL     PUTSCR00
            ENDIF
          ELSE
            MOVE     FILDBDC1,WORDNAME
            MOVE     " 12",WORDTYPE
            IF       ACCEPT=0
               CALL     EDITWORD
            ENDIF
          ENDIF
          GOTO     SF01L001
.
SF01L104
          CALL      SELECTED
          BRANCH    EXIT,SF01L001
          COMPARE   ONE,ACCEPT
          GOTO      SF01L001 IF EQUAL
          CALL      RDTDBTC1
          IF        OVRCD=1
            BEEP
            GOTO      SF01L001
          ENDIF
          MATCH     SP70,DBTC1MKY
          IF        @EQUAL
            BEEP
            GOTO      SF01L001
          ENDIF
          MOVE      DBTC1MKY,KEY11 
          MOVE      ZERO,HLEF
          CALL      GETSCR00
          CALL      SELT0000
          MOVE      "01",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      PUTSCR00
          CALL      RFTDBTC1
          IF        OVRCD=1
            CALL      FP01L000
          ELSE
            MOVE      DBTC1MKY,KEY11 
            CALL      RSDBTC1 
            CALL      RPDBTC1 
            CALL      DP01L000
          ENDIF
          GOTO     SF01L001
.
SF01L105
          MOVE      ZERO,EXIT
          GOTO      SF01L999
.
SF01L106
          MOVE      "DBTC1",NAMSSFFI
          MOVE      "   61",ITMSSFFI
          CALL      NP01L000
          GOTO     SF01L001
.
SF01L107
          MOVE      "DBTC1",NAMSSFFI
          MOVE      "   61",ITMSSFFI
          CALL      PP01L000
          GOTO     SF01L001
.
SF01L108
          MOVE      "     ",NAMSSFFI
          MOVE      "     ",ITMSSFFI
          CALL      FP01L000
          GOTO     SF01L001
.
SF01L109
          MOVE      "     ",NAMSSFFI
          MOVE      "     ",ITMSSFFI
          CALL      LP01L000
          GOTO     SF01L001
.
SF01L110
            MOVE      ZERO,HLEF
            CALL      GETSCR00
          CALL      ADDI0000
          MOVE      "01",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      PUTSCR00
          CALL      DF01L000
          GOTO      SF01L001
SF01L990  MOVE      ONE,EXIT * Exit Char Restart
SF01L999  RETURN
.--------------------------------
. Screen - Item Details                       
.--------------------------------
SC02L000
SC02L100
          MOVE      "02",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          MOVE      "  1",CLEF
          MOVE      " 80",CRIG
          MOVE      " 6",CTOP
          MOVE      "24",CBOT
          CALL      VBACK000 * Display Background
          MOVE      ZERO,CLEF
          MOVE      ZERO,CTOP
          MOVE      ZERO,CRIG
          MOVE      ZERO,CBOT
.
SC02L200
          CALL      CF02L000 * Clear Fields
SC02L300
          CALL      KY02L000 * Enter Key Fields
          BRANCH    EXIT,SC02L999,SC02L999
SC02L400
          CALL      WP02L000 * Load any WP Details
SC02L500
          CALL      LM02L000 * Load any Batch Details
SC02L600
          CALL      DF02L000 * Display Fields
SC02L700
          CALL      SF02L000 * Select Fields
          BRANCH    EXIT,SC02L100,SC02L100,SC02L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC02L800
SC02L900
SC02L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Item Details                       
.-------------------------------------------------------
CF02L000
CF02L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Item Details                       
.--------------------------------------------------------
KY02L000
          MOVE      ZERO,EXIT
          GOTO      KY02L999
.
KY02L900  MOVE      ONE,EXIT
KY02L999  RETURN
.---------------------------------------------------------
. Load WP files for : Item Details                       
.---------------------------------------------------------
WP02L000
          PREP     TEMPWORD,FILDBTD1
          PACK     KEY14,DBTCDEB,DBTCDLN,SP70
          MOVE     KEY14,SAVKEY80
          SETLPTR  SAVKEY80,11
          CALL      RDDBTD1 
          IF        OVRCD=0
            CALL      RPDBTD1 
          ENDIF
WP02L100
          CALL     RKDBTD1 
          BRANCH   OVRCD,WP02L105
          PACK     KEY14,DBTDDEB,DBTDDLN,DBTDLIN
          MATCH    SAVKEY80,KEY14   
          GOTO     WP02L105 IF NOT EQUAL
          PACK     VAR,DBTDCOM,SP70,SP70
          STRIP    VAR
          MOVELPTR VAR,F3
          SFORMAT  VAR,F3
          MOVE     DBTDCOM,VAR
          IF       F3=0
            WRITE    TEMPWORD,SEQ;
          ELSE
            WRITE    TEMPWORD,SEQ;VAR
          ENDIF
          SFORMAT  VAR,127
          GOTO     WP02L100
WP02L105  CLOSE    TEMPWORD
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Item Details                       
.---------------------------------------------------------
LM02L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Item Details                       
.---------------------------------------------------------
DF02L000
          BRANCH   ACCEPT,DF02L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF02L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF02L900
          MATCH    PRGID,SCPSPID
          GOTO     DF02L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF02L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF02L010 IF NOT EQUAL
.
          CALL     PS02L000 * Display Field
          GOTO     DF02L010
DF02L900
DF02L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Item Details                       
.---------------------------------------------------------
PS02L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS02L999,PS02L999,PS02L999,PS02L999:
                            PS02L999,PS02L101,PS02L999,PS02L999:
                           PS02L999,PS02L102,PS02L103,PS02L104:
                            PS02L105,PS02L106,PS02L107,PS02L108:
                            PS02L109,PS02L110,PS02L111,PS02L112:
                            PS02L113,PS02L114,PS02L115,PS02L116:
                            PS02L117,PS02L118,PS02L119,PS02L120:
                            PS02L121,PS02L122,PS02L123,PS02L124:
                            PS02L125,PS02L126,PS02L127,PS02L128:
                            PS02L129,PS02L130,PS02L131
          GOTO     PS02L999
.
PS02L101
          MOVE      DBTCDLN,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L102
          MOVE      DBTCITM,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L103
          UNPACK    DBTCSDAT,CCENT,CYEAR,CMON,CDAY          
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L104
          MOVE      DBTCDREF,VAR     
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L105
          MOVE      DBTCOREF,VAR     
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L106
          MOVE      DBTCQTY,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L107
          MOVE      DBTCPRI,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L108
          MOVE      DBTCTOT,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L109
          MOVE      DBTCTRT,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L110
          MOVE      DBTCTAX,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L111
          MOVE      DBTCUR1,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L112
          MOVE      DBTCUR2,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L113
          UNPACK    DBTCUD1,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L114
          UNPACK    DBTCUD2,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L115
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      DBTCUY1,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L116
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      DBTCUY2,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L117
          MOVE      DBTCUC1,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L118
          MOVE      DBTCUC2,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L119
          MOVE      DBTCUC3,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L120
          MOVE      DBTCUC4,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L121
          MOVE      DBITDES,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L122
          MOVE      DBITIDE,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L123
          MOVE      DBITPRI,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L124
          MOVE      DBTCUC1D,VAR     
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L125
          MOVE      DBTCUC2D,VAR     
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L126
          MOVE      DBTCUC3D,VAR     
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L127
          MOVE      DBTCUC4D,VAR     
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L128
          MOVE      TOTALAMT,VAR     
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L129
          MOVE     FILDBTD1,WORDNAME
          CALL     DISPWORD
          GOTO     PS02L999
.
PS02L130
          MOVE      DBTCGST,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L131
          MOVE      IBGSDESC,VAR     
          CALL      DISPITEM
          GOTO     PS02L999
PS02L999
          RETURN
.---------------------------------------------------------
. Selections for : Item Details                       
.---------------------------------------------------------
SF02L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF02L001  BRANCH   ACCEPT,SF02L020
.
SF02L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF02L006,SF02L101,SF02L102,SF02L103:
                            SF02L006,SF02L006,SF02L006,SF02L006:
                           SF02L006,SF02L104,SF02L105,SF02L106:
                            SF02L107,SF02L108,SF02L109,SF02L110:
                            SF02L111,SF02L112,SF02L113,SF02L114:
                            SF02L115,SF02L116,SF02L117,SF02L118:
                            SF02L119,SF02L120,SF02L121,SF02L122:
                            SF02L006,SF02L006,SF02L006,SF02L006:
                            SF02L006,SF02L006,SF02L006,SF02L006:
                            SF02L123,SF02L124,SF02L006
SF02L006  BEEP
          GOTO     SF02L005
SF02L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF02L090
          MATCH    PRGID,SCSLPID
          GOTO     SF02L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF02L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF02L020,SF02L020,SF02L020,SF02L020:
                            SF02L020,SF02L020,SF02L020,SF02L020:
                           SF02L020,SF02L104,SF02L105,SF02L106:
                            SF02L107,SF02L108,SF02L109,SF02L110:
                            SF02L111,SF02L112,SF02L113,SF02L114:
                            SF02L115,SF02L116,SF02L117,SF02L118:
                            SF02L119,SF02L120,SF02L121,SF02L122:
                            SF02L020,SF02L020,SF02L020,SF02L020:
                            SF02L020,SF02L020,SF02L020,SF02L020:
                            SF02L123,SF02L124,SF02L020
          GOTO     SF02L020
SF02L090  MOVE     ZERO,ACCEPT
          GOTO     SF02L001
.
SF02L101
          CALL      CANA0000
          MOVE      ZERO,EXIT
          GOTO      SF02L999
.
SF02L102
            MOVE      ZERO,HLEF
            CALL      GETSCR00
          CALL      POSA0000
          MOVE      EXIT,SECTOR
          IF        SECTOR=0
            CALL      FRESCR00
            GOTO      SF02L999
          ENDIF
          IF        SECTOR=1
            CALL      FRESCR00
            MOVE      ZERO,EXIT
            GOTO      SF02L001
          ENDIF
          IF        SECTOR=2
            CALL      FRESCR00
            MOVE      ONE,EXIT
            GOTO      SF02L999
          ENDIF
          MOVE      "02",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      PUTSCR00
          IF        SECTOR=4
            CALL      DF02L000
          ENDIF
          GOTO      SF02L001
.
SF02L103
            MOVE      ZERO,HLEF
            CALL      GETSCR00
          CALL      DELA0000
          MOVE      EXIT,SECTOR
          IF        SECTOR=0
            CALL      FRESCR00
            GOTO      SF02L999
          ENDIF
          IF        SECTOR=1
            CALL      FRESCR00
            MOVE      ZERO,EXIT
            GOTO      SF02L001
          ENDIF
          IF        SECTOR=2
            CALL      FRESCR00
            MOVE      ONE,EXIT
            GOTO      SF02L999
          ENDIF
          MOVE      "02",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      PUTSCR00
          IF        SECTOR=4
            CALL      DF02L000
          ENDIF
          GOTO      SF02L001
.
SF02L104
.
.
          MOVE      "   29",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBITDES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   30",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBITIDE 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   31",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBITPRI 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      ESALI000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L104
            ENDIF
            BRANCH    EXIT,SF02L104,SF02L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF02L990 IF EQUAL
          ENDIF
          MOVE      DBTCITM,VAR      
          CALL      DISPITEM
.
.
          MOVE      "   29",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      DBITDES,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   30",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      DBITIDE,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   31",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      DBITPRI,VAR      
            CALL      DISPITEM
          ENDIF
          GOTO     SF02L001
.
SF02L105
          CALL      DATECURR
          CALL     SELECTED
          CALL      KEYDATE
          PACK      DBTCSDAT,CCENT,CYEAR,CMON,CDAY          
          UNPACK    DBTCSDAT,CCENT,CYEAR,CMON,CDAY          
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L106
          CALL     SELECTED
          STRIP     DBTCDREF
          SFORMAT   VAR,SCPSLEN
          MOVE      DBTCDREF,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,DBTCDREF
          SFORMAT   VAR,127
          ENDSET    DBTCDREF
          APPEND    SP70,DBTCDREF
          RESET     DBTCDREF
          CMATCH    EXITCHAR,DBTCDREF
          GOTO      SF02L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,DBTCDREF
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L106
            ENDIF
          ENDIF
          MOVE      DBTCDREF,VAR     
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L107
          CALL     SELECTED
          STRIP     DBTCOREF
          SFORMAT   VAR,SCPSLEN
          MOVE      DBTCOREF,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,DBTCOREF
          SFORMAT   VAR,127
          ENDSET    DBTCOREF
          APPEND    SP70,DBTCOREF
          RESET     DBTCOREF
          CMATCH    EXITCHAR,DBTCOREF
          GOTO      SF02L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,DBTCOREF
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L107
            ENDIF
          ENDIF
          MOVE      DBTCOREF,VAR     
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L108
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      EQUTY000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L108
            ENDIF
            BRANCH    EXIT,SF02L108,SF02L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF02L990 IF EQUAL
          ENDIF
          MOVE      DBTCQTY,VAR      
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L109
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      EPRIC000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L109
            ENDIF
            BRANCH    EXIT,SF02L109,SF02L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF02L990 IF EQUAL
          ENDIF
          MOVE      DBTCPRI,VAR      
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L110
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      ETOTL000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L110
            ENDIF
            BRANCH    EXIT,SF02L110,SF02L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF02L990 IF EQUAL
          ENDIF
          MOVE      DBTCTOT,VAR      
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L111
          CALL     SELECTED
          MOVE      SP70,VAR
          CALL      DISPITEM
          KEYIN     *PCCOL:CVERT,*V2LON,*NOMASK,*RV,DBTCTRT 
          IF        SCPSMAN=1
            COMPARE   ZERO,DBTCTRT 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L111
            ENDIF
          ENDIF
          MOVE      DBTCTRT,VAR      
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L112
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      ETAXA000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L112
            ENDIF
            BRANCH    EXIT,SF02L112,SF02L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF02L990 IF EQUAL
          ENDIF
          MOVE      DBTCTAX,VAR      
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L113
          CALL     SELECTED
          STRIP     DBTCUR1 
          SFORMAT   VAR,SCPSLEN
          MOVE      DBTCUR1,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,DBTCUR1 
          SFORMAT   VAR,127
          ENDSET    DBTCUR1 
          APPEND    SP70,DBTCUR1 
          RESET     DBTCUR1 
          CMATCH    EXITCHAR,DBTCUR1 
          GOTO      SF02L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,DBTCUR1 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L113
            ENDIF
          ENDIF
          MOVE      DBTCUR1,VAR      
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L114
          CALL     SELECTED
          STRIP     DBTCUR2 
          SFORMAT   VAR,SCPSLEN
          MOVE      DBTCUR2,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,DBTCUR2 
          SFORMAT   VAR,127
          ENDSET    DBTCUR2 
          APPEND    SP70,DBTCUR2 
          RESET     DBTCUR2 
          CMATCH    EXITCHAR,DBTCUR2 
          GOTO      SF02L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,DBTCUR2 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L114
            ENDIF
          ENDIF
          MOVE      DBTCUR2,VAR      
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L115
          CALL     SELECTED
          CALL      KEYDATE
          PACK      DBTCUD1,CCENT,CYEAR,CMON,CDAY           
          UNPACK    DBTCUD1,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L116
          CALL     SELECTED
          CALL      KEYDATE
          PACK      DBTCUD2,CCENT,CYEAR,CMON,CDAY           
          UNPACK    DBTCUD2,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L117
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,DBTCUY1 
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      DBTCUY1,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L118
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,DBTCUY2 
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      DBTCUY2,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L119
.
.
          MOVE      "   32",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBTCUC1D
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          STRIP     DBTCUC1 
          SFORMAT   VAR,SCPSLEN
          MOVE      DBTCUC1,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,DBTCUC1 
          SFORMAT   VAR,127
          ENDSET    DBTCUC1 
          APPEND    SP70,DBTCUC1 
          RESET     DBTCUC1 
          CMATCH    EXITCHAR,DBTCUC1 
          GOTO      SF02L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,DBTCUC1 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L119
            ENDIF
          ENDIF
          MOVE      DBTCUC1,VAR      
          CALL      DISPITEM
.
.
          MOVE      "   32",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      DBTCUC1D,VAR     
            CALL      DISPITEM
          ENDIF
          GOTO     SF02L001
.
SF02L120
.
.
          MOVE      "   33",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBTCUC2D
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          STRIP     DBTCUC2 
          SFORMAT   VAR,SCPSLEN
          MOVE      DBTCUC2,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,DBTCUC2 
          SFORMAT   VAR,127
          ENDSET    DBTCUC2 
          APPEND    SP70,DBTCUC2 
          RESET     DBTCUC2 
          CMATCH    EXITCHAR,DBTCUC2 
          GOTO      SF02L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,DBTCUC2 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L120
            ENDIF
          ENDIF
          MOVE      DBTCUC2,VAR      
          CALL      DISPITEM
.
.
          MOVE      "   33",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      DBTCUC2D,VAR     
            CALL      DISPITEM
          ENDIF
          GOTO     SF02L001
.
SF02L121
.
.
          MOVE      "   34",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBTCUC3D
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          STRIP     DBTCUC3 
          SFORMAT   VAR,SCPSLEN
          MOVE      DBTCUC3,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,DBTCUC3 
          SFORMAT   VAR,127
          ENDSET    DBTCUC3 
          APPEND    SP70,DBTCUC3 
          RESET     DBTCUC3 
          CMATCH    EXITCHAR,DBTCUC3 
          GOTO      SF02L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,DBTCUC3 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L121
            ENDIF
          ENDIF
          MOVE      DBTCUC3,VAR      
          CALL      DISPITEM
.
.
          MOVE      "   34",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      DBTCUC3D,VAR     
            CALL      DISPITEM
          ENDIF
          GOTO     SF02L001
.
SF02L122
.
.
          MOVE      "   35",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBTCUC4D
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          STRIP     DBTCUC4 
          SFORMAT   VAR,SCPSLEN
          MOVE      DBTCUC4,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,DBTCUC4 
          SFORMAT   VAR,127
          ENDSET    DBTCUC4 
          APPEND    SP70,DBTCUC4 
          RESET     DBTCUC4 
          CMATCH    EXITCHAR,DBTCUC4 
          GOTO      SF02L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,DBTCUC4 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L122
            ENDIF
          ENDIF
          MOVE      DBTCUC4,VAR      
          CALL      DISPITEM
.
.
          MOVE      "   35",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      DBTCUC4D,VAR     
            CALL      DISPITEM
          ENDIF
          GOTO     SF02L001
.
SF02L123
          CALL     SELECTED
          IF       EXIT=1
            IF       ACCEPT=0
              MOVE     "10",SCPSROW
              MOVE     " 10",SCPSCOL
              MOVE     " 50",SCPSLEN
              MOVE     "10",SCPSNOR
              MOVE     SCPSROW,CVERT
              MOVE     SCPSCOL,CCOL
              MOVE     ZERO,HLEF
              CALL     GETSCR00
              MOVE     FILDBTD1,WORDNAME
              MOVE     "  8",WORDTYPE
              CALL     EDITWORD
              CALL     PUTSCR00
            ENDIF
          ELSE
            MOVE     FILDBTD1,WORDNAME
            MOVE     "  8",WORDTYPE
            CALL     EDITWORD
          ENDIF
          GOTO     SF02L001
.
SF02L124
.
.
          MOVE      "   39",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,IBGSDESC
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      EGST0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L124
            ENDIF
            BRANCH    EXIT,SF02L124,SF02L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF02L990 IF EQUAL
          ENDIF
          MOVE      DBTCGST,VAR      
          CALL      DISPITEM
.
.
          MOVE      "   39",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      IBGSDESC,VAR     
            CALL      DISPITEM
          ENDIF
          GOTO     SF02L001
SF02L990  MOVE      FOUR,EXIT * Exit Char Exit
SF02L999  RETURN
.--------------------------------
. Screen - Re-Print Invoice                   
.--------------------------------
SC03L000
SC03L100
          MOVE      "03",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC03L200
          CALL      CF03L000 * Clear Fields
SC03L300
          CALL      KY03L000 * Enter Key Fields
          BRANCH    EXIT,SC03L999,SC03L999
SC03L400
          CALL      WP03L000 * Load any WP Details
SC03L500
          CALL      LM03L000 * Load any Batch Details
SC03L600
          CALL      DF03L000 * Display Fields
SC03L700
          CALL      SF03L000 * Select Fields
          BRANCH    EXIT,SC03L100,SC03L100,SC03L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC03L800
SC03L900
SC03L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Re-Print Invoice                   
.-------------------------------------------------------
CF03L000  COMPARE   ZERO,ACCEPT
              GOTO      CF03L999 IF EQUAL
          MOVE      SP70,DBDBDEB 
          MOVE      SP70,DBDBNA1 
          MOVE      SP70,DBDBNA2 
          MOVE      SP70,DBDBAD1 
          MOVE      SP70,DBDBAD2 
          MOVE      SP70,DBDBAD3 
          MOVE      SP70,DBDBAD4 
          MOVE      SP70,DBDBPC  
          MOVE      SP70,DBDBPH1 
          MOVE      SP70,DBDBPH2 
          MOVE      SP70,DBDBPH3 
          MOVE      SP70,DBDBCON 
          MOVE      ZERO,DBDBACT 
          MOVE      ZERO,DBDBSTA 
          MOVE      ZERO,DBDBTEX 
          MOVE      SP70,DBDBTER 
          MOVE      SP70,DBDBWRN 
          MOVE      SP70,DBDBLIN 
          MOVE      SP70,DBDBPUR 
          MOVE      ZERO,DBDBBAD 
          MOVE      SP70,DBDBSORT
          MOVE      SP70,DBDBUR2 
          MOVE      SP70,DBDBUD1 
          MOVE      SP70,DBDBUD2 
          MOVE      SP70,DBDBUY1 
          MOVE      SP70,DBDBUY2 
          MOVE      SP70,DBDBUC1 
          MOVE      SP70,DBDBUC2 
          MOVE      SP70,DBDBUC3 
          MOVE      SP70,DBDBUC4 
          MOVE      SP70,DBDBUC1D
          MOVE      SP70,DBDBUC2D
          MOVE      SP70,DBDBUC3D
          MOVE      SP70,DBDBUC4D
          MOVE      SP70,DBDBWRND
          MOVE      SP70,DBTEDES 
          MOVE      SP70,DBLNNA1 
          MOVE      SP70,DBFHDOC 
          MOVE      SP70,DBFHDTY 
          MOVE      SP70,DBFHDDAT
          MOVE      SP70,DBFHTER 
          MOVE      ZERO,DBFHTOT 
          MOVE      ZERO,DBFHTAX 
          MOVE      SP70,DBFHDPRT
          MOVE      SP70,DBFHDSTA
          MOVE      SP70,DBFHCDAT
          MOVE      SP70,DBFHCTIM
          MOVE      SP70,DBFHCUSR
          MOVE      SP70,DBFHUR1 
          MOVE      SP70,DBFHUR2 
          MOVE      SP70,DBFHUD1 
          MOVE      SP70,DBFHUD2 
          MOVE      SP70,DBFHUY1 
          MOVE      SP70,DBFHUY2 
          MOVE      SP70,DBFHUC1 
          MOVE      SP70,DBFHUC2 
          MOVE      ZERO,DBFHDTOT
          MOVE      SP70,DBFDDLN 
          MOVE      SP70,DBFDINV 
          MOVE      SP70,DBFDPDAT
          MOVE      SP70,DBFDGLS 
          MOVE      SP70,DBFDITM 
          MOVE      SP70,DBFDSDAT
          MOVE      SP70,DBFDDREF
          MOVE      SP70,DBFDOREF
          MOVE      ZERO,DBFDQTY 
          MOVE      ZERO,DBFDPRI 
          MOVE      ZERO,DBFDTOT 
          MOVE      ZERO,DBFDTAX 
          MOVE      ZERO,TOTALAMT
          MOVE      SP70,DBITDES 
          MOVE      SP70,DBFDGST 
CF03L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Re-Print Invoice                   
.--------------------------------------------------------
KY03L000
.
KY03L110
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBDBNA1 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    6",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBDBNA2 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBDBAD1 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    8",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBDBAD2 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    9",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBDBAD3 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   10",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBDBAD4 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   11",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBDBPC  
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   12",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBDBPH1 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   13",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBDBPH2 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   14",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBDBPH3 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   15",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBDBCON 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   16",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBDBACT 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   17",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBDBSTA 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   18",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBDBTEX 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   19",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBDBTER 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   20",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,DBDBWRN 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          MOVE      "    4",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      EKEYF000
          BRANCH    EXIT,KY03L900,KY03L900
          MOVE      ZERO,ACCEPT
          MOVE      DBDBDEB,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      DBDBNA1,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    6",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      DBDBNA2,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      DBDBAD1,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    8",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      DBDBAD2,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    9",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      DBDBAD3,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   10",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      DBDBAD4,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   11",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      DBDBPC,VAR       
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   12",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      DBDBPH1,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   13",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      DBDBPH2,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   14",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      DBDBPH3,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   15",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      DBDBCON,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   16",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      NO,YESNO
            MOVE      ZERO,FORM2
            MOVE      DBDBACT,FORM2    
            LOAD      YESNO,FORM2,YES
            MOVE      YESNO,VAR
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   17",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      NO,YESNO
            MOVE      ZERO,FORM2
            MOVE      DBDBSTA,FORM2    
            LOAD      YESNO,FORM2,YES
            MOVE      YESNO,VAR
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   18",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      NO,YESNO
            MOVE      ZERO,FORM2
            MOVE      DBDBTEX,FORM2    
            LOAD      YESNO,FORM2,YES
            MOVE      YESNO,VAR
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   19",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      DBDBTER,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   20",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      DBDBWRN,VAR      
            CALL      DISPITEM
          ENDIF
.
KY03L120
          MOVE      "   41",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      ECRDN000
          BRANCH    EXIT,KY03L110,KY03L900
          MOVE      ZERO,ACCEPT
          MOVE      DBFHDOC,VAR      
          CALL      DISPITEM
          MOVE      ZERO,EXIT
          GOTO      KY03L999
.
KY03L900  MOVE      ONE,EXIT
KY03L999  RETURN
.---------------------------------------------------------
. Load WP files for : Re-Print Invoice                   
.---------------------------------------------------------
WP03L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Re-Print Invoice                   
.---------------------------------------------------------
LM03L000
.---------------------------------------------------------
. Load for :    61 Document Line Number               
.---------------------------------------------------------
          UNPACK    SP70,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN
          PACK      KEY24,DBFHDEB,DBFHDTY,DBFHDOC,SP70
          MOVE      KEY24,DBFD1EKY
          STRIP     DBFD1SKY
          SETLPTR   DBFD1EKY,21
          MOVE      DBFD1EKY,DBFD1SKY
          CALL      RDDBFD1 
          IF        OVRCD=0
            CALL      RPDBFD1 
          ENDIF
          RETURN
.--------------------------------------------------------
. Display Current Page of Multi Items
.--------------------------------------------------------
DP03L000
          MOVE     ZERO,DBFD1CNT
          MOVE     ZERO,DBFD1END
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DP03L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DP03L600
          MATCH    PRGID,SCPSPID
          GOTO     DP03L600 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DP03L600 IF NOT EQUAL
          MATCH    NAMSSFFI,SCPSMTY
          GOTO     DP03L010 IF NOT EQUAL
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,DP03L010,DP03L010,DP03L010,DP03L010:
                            DP03L010,DP03L010,DP03L010,DP03L010:
                            DP03L010,DP03L010,DP03L010,DP03L010:
                            DP03L010,DP03L010,DP03L010,DP03L010:
                            DP03L010,DP03L010,DP03L010,DP03L010:
                            DP03L010,DP03L010,DP03L010,DP03L010:
                            DP03L010,DP03L010,DP03L010,DP03L010:
                            DP03L010,DP03L010,DP03L010,DP03L010:
                            DP03L010,DP03L010,DP03L010,DP03L010:
                            DP03L010,DP03L010,DP03L010,DP03L010:
                            DP03L010,DP03L010,DP03L010,DP03L010:
                            DP03L010,DP03L010,DP03L010,DP03L010:
                            DP03L010,DP03L010,DP03L010,DP03L010:
                            DP03L010,DP03L010,DP03L010,DP03L010:
                            DP03L010,DP03L010,DP03L010,DP03L010:
                            DP03L101,DP03L102,DP03L103,DP03L104:
                            DP03L105,DP03L106,DP03L107,DP03L108:
                            DP03L109,DP03L110,DP03L111,DP03L112:
                            DP03L113,DP03L114,DP03L115,DP03L010:
                           DP03L010,DP03L010,DP03L010,DP03L010:
                           DP03L010,DP03L010,DP03L010,DP03L010
          GOTO      DP03L010
.
DP03L101
          IF        DBFD1END=0
            CALL      RKDBFD1 
            IF        OVRCD=0
              PACK      DBFD1MKY,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN                                                
              MATCH     DBFD1EKY,DBFD1MKY
              IF        @EQUAL
                MOVE      ZERO,DBFD1END
                ADD       ONE,DBFD1CNT
          CALL      LINDET00
                MOVE      DBFDDLN,VAR      
                CALL      DISPITEM
              ELSE
                MOVE      ONE,DBFD1END
              ENDIF
            ELSE
              MOVE      ONE,DBFD1END
            ENDIF
          ENDIF
          IF        DBFD1END=1
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP03L010
.
DP03L102
          IF        DBFD1END=0
            MOVE      DBFDINV,VAR      
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP03L010
.
DP03L103
          IF        DBFD1END=0
            UNPACK    DBFDPDAT,CCENT,CYEAR,CMON,CDAY          
            CALL      PACDATE
            MOVE      CPCDATE,VAR
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP03L010
.
DP03L104
          IF        DBFD1END=0
            MOVE      NO,YESNO
            MOVE      ZERO,FORM2
            MOVE      DBFDGLS,FORM2    
            LOAD      YESNO,FORM2,YES
            MOVE      YESNO,VAR
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP03L010
.
DP03L105
          IF        DBFD1END=0
            MOVE      DBFDITM,VAR      
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP03L010
.
DP03L106
          IF        DBFD1END=0
            UNPACK    DBFDSDAT,CCENT,CYEAR,CMON,CDAY          
            CALL      PACDATE
            MOVE      CPCDATE,VAR
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP03L010
.
DP03L107
          IF        DBFD1END=0
            MOVE      DBFDDREF,VAR     
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP03L010
.
DP03L108
          IF        DBFD1END=0
            MOVE      DBFDOREF,VAR     
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP03L010
.
DP03L109
          IF        DBFD1END=0
            MOVE      DBFDQTY,VAR      
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP03L010
.
DP03L110
          IF        DBFD1END=0
            MOVE      DBFDPRI,VAR      
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP03L010
.
DP03L111
          IF        DBFD1END=0
            MOVE      DBFDTOT,VAR      
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP03L010
.
DP03L112
          IF        DBFD1END=0
            MOVE      DBFDTAX,VAR      
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP03L010
.
DP03L113
          IF        DBFD1END=0
            MOVE      TOTALAMT,VAR     
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP03L010
.
DP03L114
          IF        DBFD1END=0
            MOVE      DBITDES,VAR      
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP03L010
.
DP03L115
          IF        DBFD1END=0
            MOVE      DBFDGST,VAR      
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP03L010
DP03L600
          MATCH    "DBFD1",NAMSSFFI
          GOTO     DP03L605 IF NOT EQUAL
          GOTO     DP03L999
DP03L605
DP03L999
          RETURN
.--------------------------------------------------------
. Display First Page of Multi Items
.--------------------------------------------------------
FP03L000
.
          MATCH    "DBFD1",NAMSSFFI
          GOTO     FP03L105 IF NOT EQUAL
          PACK     KEY24,DBFD1SKY,SP70
          CALL     RDDBFD1  * Start
          IF       OVRCD=0
            CALL     RPDBFD1  * Start
          ENDIF
          CALL     DP03L000
          GOTO     FP03L999
FP03L105
FP03L999  RETURN
.--------------------------------------------------------
. Display Last Page of Multi Items
.--------------------------------------------------------
LP03L000
.
          MATCH    "DBFD1",NAMSSFFI
          GOTO     LP03L105 IF NOT EQUAL
          PACK     KEY24,DBFD1SKY,Z70
          CALL     RSDBFD1  * End
          IF       OVRCD=1
            CALL     RPDBFD1 
          ENDIF
          MOVE     ZERO,SECTOR
          WHILE    SECTOR<DBFD1SNO
            CALL     RPDBFD1 
            IF       OVRCD=1
              MOVE     DBFD1SNO,SECTOR
            ENDIF
            PACK     DBFD1MKY,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN                                                
            MATCH    DBFD1EKY,DBFD1MKY
            IF       !@EQUAL
              MOVE     DBFD1SNO,SECTOR
            ENDIF
            ADD      ONE,SECTOR
          DO
          CALL     DP03L000
          GOTO     LP03L999
LP03L105
LP03L999  RETURN
.--------------------------------------------------------
. Display Previous Page  
.--------------------------------------------------------
PP03L000
.
          MATCH    "DBFD1",NAMSSFFI
          GOTO     PP03L120 IF NOT EQUAL
          MOVE     ZERO,SECTOR
PP03L105
          COMPARE  SECTOR,DBFD1SNO
          GOTO     PP03L110 IF EQUAL
          CALL     RPDBFD1 
          BRANCH   OVRCD,PP03L115
          PACK     DBFD1MKY,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN                                                
          MATCH    DBFD1EKY,DBFD1MKY
          GOTO     PP03L115 IF NOT EQUAL
          ADD      ONE,SECTOR
          GOTO     PP03L105
PP03L110
          MOVE     ZERO,SECTOR
          IF       DBFD1CNT=DBFD1SNO
            SUB      ONE,DBFD1CNT
          ENDIF
          WHILE    SECTOR<=DBFD1CNT
            CALL     RPDBFD1 
            IF       OVRCD=1
              MOVE     DBFD1SNO,SECTOR
            ENDIF
            PACK     DBFD1MKY,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN                                                
            MATCH    DBFD1EKY,DBFD1MKY
            IF       !@EQUAL
              MOVE     DBFD1SNO,SECTOR
            ENDIF
            ADD      ONE,SECTOR
          DO
          CALL     DP03L000
          GOTO     PP03L999
PP03L115
          BEEP
          MOVE     ZERO,SECTOR
          WHILE    SECTOR<DBFD1SNO
            CALL     RKDBFD1 
            IF       OVRCD=1
              MOVE     DBFD1SNO,SECTOR
            ENDIF
            PACK     DBFD1MKY,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN                                                
            MATCH    DBFD1EKY,DBFD1MKY
            IF       !@EQUAL
              MOVE     DBFD1SNO,SECTOR
            ENDIF
            ADD      ONE,SECTOR
          DO
          GOTO     PP03L999
PP03L120
PP03L999  RETURN
.--------------------------------------------------------
. Display Next Page of Multi Items
.--------------------------------------------------------
NP03L000
          MATCH    "DBFD1",NAMSSFFI
          GOTO     NP03L115 IF NOT EQUAL
NP03L105
          CALL     RKDBFD1 
          BRANCH   OVRCD,NP03L110
          PACK     DBFD1MKY,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN                                                
          MATCH    DBFD1EKY,DBFD1MKY
          GOTO     NP03L110 IF NOT EQUAL
          CALL     RPDBFD1 
          CALL     DP03L000
          GOTO     NP03L999
NP03L110
          CALL     RPDBFD1 
          BEEP
          GOTO     NP03L999
NP03L115
NP03L999  RETURN
.--------------------------------------------------------
. Clear Page of Multi Items from Temp File
.--------------------------------------------------------
CT03L000
CT03L105
CT03L999  RETURN
.---------------------------------------------------------
. Batch IO for Screen : Re-Print Invoice                   
.---------------------------------------------------------
.---------------------------------------------------------
. Display Fields for : Re-Print Invoice                   
.---------------------------------------------------------
DF03L000
          BRANCH   ACCEPT,DF03L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF03L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF03L900
          MATCH    PRGID,SCPSPID
          GOTO     DF03L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF03L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF03L010 IF NOT EQUAL
.
          CALL     PS03L000 * Display Field
          GOTO     DF03L010
DF03L900
          MOVE      "DBFD1",NAMSSFFI
          MOVE      "   61",ITMSSFFI
          CALL      FP03L000
DF03L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Re-Print Invoice                   
.---------------------------------------------------------
PS03L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS03L999,PS03L999,PS03L999,PS03L999:
                            PS03L101,PS03L102,PS03L103,PS03L104:
                            PS03L105,PS03L106,PS03L107,PS03L108:
                            PS03L109,PS03L110,PS03L111,PS03L112:
                            PS03L113,PS03L114,PS03L115,PS03L116:
                            PS03L117,PS03L118,PS03L119,PS03L120:
                            PS03L121,PS03L122,PS03L123,PS03L124:
                            PS03L125,PS03L126,PS03L127,PS03L128:
                            PS03L129,PS03L130,PS03L131,PS03L132:
                            PS03L133,PS03L134,PS03L135,PS03L136:
                            PS03L999,PS03L137,PS03L138,PS03L139:
                            PS03L140,PS03L141,PS03L142,PS03L143:
                            PS03L144,PS03L145,PS03L146,PS03L147:
                            PS03L148,PS03L149,PS03L150,PS03L151:
                            PS03L152,PS03L153,PS03L154,PS03L155:
                            PS03L999,PS03L999,PS03L999,PS03L999:
                            PS03L999,PS03L999,PS03L999,PS03L999:
                            PS03L999,PS03L999,PS03L999,PS03L999:
                            PS03L999,PS03L999,PS03L999,PS03L999:
                           PS03L999,PS03L999,PS03L999,PS03L999:
                           PS03L999,PS03L999,PS03L999,PS03L999
          GOTO     PS03L999
.
PS03L101
          MOVE      DBDBNA1,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L102
          MOVE      DBDBNA2,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L103
          MOVE      DBDBAD1,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L104
          MOVE      DBDBAD2,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L105
          MOVE      DBDBAD3,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L106
          MOVE      DBDBAD4,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L107
          MOVE      DBDBPC,VAR       
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L108
          MOVE      DBDBPH1,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L109
          MOVE      DBDBPH2,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L110
          MOVE      DBDBPH3,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L111
          MOVE      DBDBCON,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L112
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      DBDBACT,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L113
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      DBDBSTA,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L114
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      DBDBTEX,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L115
          MOVE      DBDBTER,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L116
          MOVE      DBDBWRN,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L117
          MOVE      DBDBLIN,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L118
          MOVE      DBDBPUR,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L119
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      DBDBBAD,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L120
          MOVE      DBDBSORT,VAR     
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L121
          MOVE      DBDBUR2,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L122
          UNPACK    DBDBUD1,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L123
          UNPACK    DBDBUD2,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L124
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      DBDBUY1,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L125
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      DBDBUY2,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L126
          MOVE      DBDBUC1,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L127
          MOVE      DBDBUC2,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L128
          MOVE      DBDBUC3,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L129
          MOVE      DBDBUC4,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L130
          MOVE      DBDBUC1D,VAR     
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L131
          MOVE      DBDBUC2D,VAR     
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L132
          MOVE      DBDBUC3D,VAR     
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L133
          MOVE      DBDBUC4D,VAR     
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L134
          MOVE      DBDBWRND,VAR     
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L135
          MOVE      DBTEDES,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L136
          MOVE      DBLNNA1,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L137
          MOVE      DBFHDTY,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L138
          UNPACK    DBFHDDAT,CCENT,CYEAR,CMON,CDAY          
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L139
          MOVE      DBFHTER,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L140
          MOVE      DBFHTOT,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L141
          MOVE      DBFHTAX,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L142
          UNPACK    DBFHDPRT,CCENT,CYEAR,CMON,CDAY          
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L143
          UNPACK    DBFHDSTA,CCENT,CYEAR,CMON,CDAY          
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L144
          UNPACK    DBFHCDAT,CCENT,CYEAR,CMON,CDAY          
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L145
          MOVE      DBFHCTIM,VAR     
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L146
          MOVE      DBFHCUSR,VAR     
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L147
          MOVE      DBFHUR1,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L148
          MOVE      DBFHUR2,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L149
          UNPACK    DBFHUD1,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L150
          UNPACK    DBFHUD2,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L151
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      DBFHUY1,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L152
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      DBFHUY2,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L153
          MOVE      DBFHUC1,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L154
          MOVE      DBFHUC2,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L155
          MOVE      DBFHDTOT,VAR     
          CALL      DISPITEM
          GOTO     PS03L999
PS03L999
          RETURN
.---------------------------------------------------------
. Selections for : Re-Print Invoice                   
.---------------------------------------------------------
SF03L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF03L001  BRANCH   ACCEPT,SF03L020
.
SF03L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF03L006,SF03L101,SF03L102,SF03L006:
                            SF03L006,SF03L006,SF03L006,SF03L006:
                            SF03L006,SF03L006,SF03L006,SF03L006:
                            SF03L006,SF03L006,SF03L006,SF03L006:
                            SF03L006,SF03L006,SF03L006,SF03L006:
                            SF03L006,SF03L006,SF03L006,SF03L006:
                            SF03L006,SF03L006,SF03L006,SF03L006:
                            SF03L006,SF03L006,SF03L006,SF03L006:
                            SF03L006,SF03L006,SF03L006,SF03L006:
                            SF03L006,SF03L006,SF03L006,SF03L006:
                            SF03L006,SF03L006,SF03L006,SF03L006:
                            SF03L006,SF03L006,SF03L006,SF03L006:
                            SF03L006,SF03L006,SF03L006,SF03L006:
                            SF03L006,SF03L006,SF03L006,SF03L006:
                            SF03L006,SF03L006,SF03L006,SF03L006:
                            SF03L006,SF03L006,SF03L006,SF03L006:
                            SF03L006,SF03L006,SF03L006,SF03L006:
                            SF03L006,SF03L006,SF03L006,SF03L006:
                            SF03L006,SF03L006,SF03L006,SF03L006:
                           SF03L006,SF03L006,SF03L006,SF03L006:
                           SF03L103,SF03L104,SF03L105,SF03L106
SF03L006  BEEP
          GOTO     SF03L005
SF03L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF03L090
          MATCH    PRGID,SCSLPID
          GOTO     SF03L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF03L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF03L020,SF03L020,SF03L020,SF03L020:
                            SF03L020,SF03L020,SF03L020,SF03L020:
                            SF03L020,SF03L020,SF03L020,SF03L020:
                            SF03L020,SF03L020,SF03L020,SF03L020:
                            SF03L020,SF03L020,SF03L020,SF03L020:
                            SF03L020,SF03L020,SF03L020,SF03L020:
                            SF03L020,SF03L020,SF03L020,SF03L020:
                            SF03L020,SF03L020,SF03L020,SF03L020:
                            SF03L020,SF03L020,SF03L020,SF03L020:
                            SF03L020,SF03L020,SF03L020,SF03L020:
                            SF03L020,SF03L020,SF03L020,SF03L020:
                            SF03L020,SF03L020,SF03L020,SF03L020:
                            SF03L020,SF03L020,SF03L020,SF03L020:
                            SF03L020,SF03L020,SF03L020,SF03L020:
                            SF03L020,SF03L020,SF03L020,SF03L020:
                            SF03L020,SF03L020,SF03L020,SF03L020:
                            SF03L020,SF03L020,SF03L020,SF03L020:
                            SF03L020,SF03L020,SF03L020,SF03L020:
                            SF03L020,SF03L020,SF03L020,SF03L020:
                           SF03L020,SF03L020,SF03L020,SF03L020:
                           SF03L020,SF03L020,SF03L020,SF03L020
          GOTO     SF03L020
SF03L090  MOVE     ZERO,ACCEPT
          MOVE      "DBFD1",NAMSSFFI
          MOVE      "   61",ITMSSFFI
          CALL      FP03L000
          GOTO     SF03L001
.
SF03L101
          MOVE      ONE,EXIT
          GOTO      SF03L999
.
SF03L102
          CALL      REPR0000
          MOVE      ONE,EXIT
          GOTO      SF03L999
.
SF03L103
          MOVE      "DBFD1",NAMSSFFI
          MOVE      "   61",ITMSSFFI
          CALL      NP03L000
          GOTO     SF03L001
.
SF03L104
          MOVE      "DBFD1",NAMSSFFI
          MOVE      "   61",ITMSSFFI
          CALL      PP03L000
          GOTO     SF03L001
.
SF03L105
          MOVE      "DBFD1",NAMSSFFI
          MOVE      "   61",ITMSSFFI
          CALL      FP03L000
          GOTO     SF03L001
.
SF03L106
          MOVE      "DBFD1",NAMSSFFI
          MOVE      "   61",ITMSSFFI
          CALL      LP03L000
          GOTO     SF03L001
SF03L990  MOVE      FOUR,EXIT * Exit Char Exit
SF03L999  RETURN
.@@@@@ Function Restart Point @@@@@
.**********************************************************************
. SELPRT00 - select printer routine
. Requires IBACODFD/INC IBAPRNFD/INC
.          IBAIOCOD/INC IBAIOPRN/INC IBAPRINT
.  Note : already includes IBAPASFD & IBAPASIO
.**********************************************************************
SELPRT00  OPEN      IBACODE1,"ibacodef"     * open files
...       OPEN      IBAPRNT1,"ibaprntf"                               *D-239574
          MOVE      SP70,SPLFILE
          CALL      SELPRINT
.
          READ      CONTROLF,ZERO;*85,IBCNUGST
          READ      CONTROLF,EIGHTY7;*74,CFDBCRHD,CFDBCRTL
.
SELPRT99  RETURN
DATECURR  MOVE      CDD,CDAY
          MOVE      CMM,CMON
          MOVE      CYY,CYEAR
          MOVE      CCC,CCENT
          REP       " 0",CCENT
          REP       " 0",CYEAR
          REP       " 0",CMON
          REP       " 0",CDAY
          RETURN
REDDET00  ASSIGN   DBTCTAX+DBTCTOT,TOTALAMT
          MOVE     DBTCITM,KEY8
          CALL     RDDBIT1
          IF       OVRCD=1
            MOVE     "***** ITEM RECORD MISSING *****",DBITDES
          ENDIF
          MOVE     "   10",FLDID
          CALL     GETPOSIT
          IF       EXIT=0
            MOVE     TOTALCRD,VAR
            CALL     DISPITEM
          ENDIF
          MOVE     "   61",FLDID
          CALL     GETPOSIT
          RETURN

.-------------------------------------------------------------
. Cancel Credit Note
.-------------------------------------------------------------
CANC0000   CALL     CLRTMP00   * Clear Temp Files (in Routine EINVN000)
CANC9999   CALL     UUDBDB1    * Unlock Debtor
           RETURN
.
.-------------------------------------------------------------
. Post Credit Note
.-------------------------------------------------------------
POST0000   CALL      CHKTRN00        * Check that Details are related to Credit
           BRANCH    EXIT,POST9999
.
           MOVE      DBFHDOC,INVREF  * Save Invoice Number & Date
           MOVE      DBFHDDAT,INVDAT
           MATCH     "000000000000",INVREF
           IF        @EQUAL
             MOVE      CRDATE,INVDAT
           ENDIF
.
           CALL      STCRD000        * Get Next Credit Note No. & Write Header
.
           CALL      STRAN000        * Save Transactions
.
           MOVE      "Print Credit Note. ",DISPMSG
           CALL      MESSAGE4
           BRANCH    EXIT,POST9999
.
. Print the Credit Note.
.------------------------
           CALL      OPNPRINT
           CALL      PRCRD000        * Print Invoice
           CALL      CLSPRINT
.
POST9999   CALL      CLRTMP00
           CALL      UUDBDB1         * Unlock Debtor
           RETURN
.-----------------------------------------------------------------------
. Check for Detail Transactions (EXIT=1 if nothing to post)
.-----------------------------------------------------------------------
CHKTRN00   MOVE      ONE,EXIT
           PACK      KEY11,DBDBDEB,SP70
           CALL      RSDBTC1
           CALL      RKDBTC1
           BRANCH    OVRCD,CHKTRN99
           MATCH     DBFHDEB,DBTCDEB
           GOTO      CHKTRN99 IF NOT EQUAL
           MOVE      ZERO,EXIT
CHKTRN99   RETURN
.-----------------------------------------------------------------------
. Get Next Credit Note Number & Write Header Record
.-----------------------------------------------------------------------
STCRD000  READ       CONTROLF,EIGHTY1;*242,CFDBMAN
          READ       CONTROLF,EIGHTY7;*38,CFDBCRN
          COMPARE    ONE,CFDBMAN
          GOTO       STCRD010 IF NOT EQUAL
          CALL       MANCRD00
          GOTO       STCRD020
.
STCRD010  ADD        ONE,CFDBCRN
          WRITAB     CONTROLF,EIGHTY7;*38,CFDBCRN
.
STCRD020  MOVE       DBDBDEB,DBFHDEB
          MOVE       TWO,DBFHDTY               * Doc. Type 2=Credit Note
          MOVE       CFDBCRN,DBFHDOC           * Document Reference
          REP        " 0",DBFHDOC
          MOVE       CRDATE,DBFHDDAT           * Document Date
          REP        " 0",DBFHDDAT             * Document Date
          MOVE       SP70,DBFHTER              * Terms Not Applicable to Cr
          CALL       CALTOT00                  * Calculate Document Totals
.
          PACK       DBFHDPRT,CCC,CYY,CMM,CDD  * Date Printed
          PACK       DBFHDSTA,SP70             * Statement Date
          PACK       DBFHCDAT,CCC,CYY,CMM,CDD  * Creation Date
          REP        " 0",DBFHDPRT
          REP        " 0",DBFHCDAT
          CLOCK      TIME,CTIMEIS
          UNPACK     CTIMEIS,CHOUR,KEY1,CMIN,KEY1,KEY2
          PACK       DBFHCTIM,CHOUR,CMIN,KEY2
          MOVE       PASSCODE,DBFHCUSR         * Creation User ID
          MOVE       SP70,DBFHUR1              * User Def Ref 1
          MOVE       SP70,DBFHUR2              * User Def Ref 2
          MOVE       SP70,DBFHUD1              * User Def Date 1
          MOVE       SP70,DBFHUD2              * User Def Date 2
          MOVE       SP70,DBFHUY1              * User Def Y/N 1
          MOVE       SP70,DBFHUY2              * User Def Y/N 2
          MOVE       SP70,DBFHUC1              * User Def Code 1
          MOVE       SP70,DBFHUC2              * User Def Code 2
          MOVE       SP70,DBFHSPA              * Spare
.
          PACK       KEY21,DBFHDEB,DBFHDTY,DBFHDOC,SP70
          CALL       RADBFH1
          COMPARE    ZERO,OVRCD
          GOTO       STCRD000 IF EQUAL
          CALL       WRDBFH1
          RETURN
.------------------------------------------------------------
. Manual Invoice Number Allocation
.------------------------------------------------------------
MANCRD00  MOVE       SP70,DISPMSG
          CALL       MESSAGE2
.
          MOVE       DBFHUR1,SAVUR1
          MOVE       DBFHUR2,SAVUR2
          MOVE       DBFHUD1,SAVUD1
          MOVE       DBFHUD2,SAVUD2
          MOVE       DBFHUY1,SAVUY1
          MOVE       DBFHUY2,SAVUY2
          MOVE       DBFHUC1,SAVUC1
          MOVE       DBFHUC2,SAVUC2
.
MANCRD10  BEEP
          KEYIN      *P1:24,*EL,"Enter Credit Note Number : ",CFDBCRN:
                     *P50:24,*EL,"Ok (Y/N) ? ",ANS
          REP        UPPLOW,ANS
          MATCH      ANSN,ANS
          GOTO       MANCRD10 IF EQUAL
          MATCH      ANSY,ANS
          GOTO       MANCRD10 IF NOT EQUAL
          COMPARE    ONE,CFDBCRN
          GOTO       MANCRD10 IF LESS
.
MANCRD20  MOVE       DBDBDEB,DBFHDEB           * Debtor
          MOVE       TWO,DBFHDTY               * Doc. Type 2=Cr Note
          MOVE       CFDBCRN,DBFHDOC           * Document Reference
          REP        " 0",DBFHDOC           * Document Reference
          MOVE       DBFHDOC,KEY12
          PACK       KEY21,DBFHDTY,DBFHDOC,SP70
          CALL       RSDBFH6
          CALL       RKDBFH6
          BRANCH     OVRCD,MANCRD99
          MATCH      "2",DBFHDTY
          GOTO       MANCRD99 IF NOT EQUAL
          MATCH      KEY12,DBFHDOC
          GOTO       MANCRD99 IF NOT EQUAL
.
          BEEP
          DISPLAY    *P1:24,*EL,"Credit Note Number Already Exists - ";
          CALL       HITENTER
          GOTO       MANCRD10
.
MANCRD99  CALL       MESSAGE3
.
          MOVE       SAVUR1,DBFHUR1
          MOVE       SAVUR2,DBFHUR2
          MOVE       SAVUD1,DBFHUD1
          MOVE       SAVUD2,DBFHUD2
          MOVE       SAVUY1,DBFHUY1
          MOVE       SAVUY2,DBFHUY2
          MOVE       SAVUC1,DBFHUC1
          MOVE       SAVUC2,DBFHUC2
.
          RETURN
.------------------------------------------------------------
. Calculate Document Header Total
.------------------------------------------------------------
CALTOT00  PACK       KEY11,DBFHDEB,SP70
          MOVE       ZERO,DBFHTOT              * Total of Document
          MOVE       ZERO,DBFHTAX              * Tax Total
          CALL       RSDBTC1
CALTOT10  CALL       RKDBTC1
          BRANCH     OVRCD,CALTOT99
          MATCH      DBTCDEB,DBFHDEB
          GOTO       CALTOT99 IF NOT EQUAL
          ADD        DBTCTOT,DBFHTOT
          ADD        DBTCTAX,DBFHTAX
          GOTO       CALTOT10
CALTOT99  RETURN
.------------------------------------------------------------
. Save Transaction Details
.------------------------------------------------------------
STRAN000  MOVE       ZERO,TRANLINE
          PACK       KEY11,DBFHDEB,SP70
          CALL       RSDBTC1
STRAN100  CALL       RKDBTC1
          BRANCH     OVRCD,STRAN900
          MATCH      DBTCDEB,DBFHDEB
          GOTO       STRAN900 IF NOT EQUAL
.
STRAN110  CALL       MVFDT000
          PACK       KEY24,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,SP70
          CALL       RADBFD1       * Check File
          COMPARE    ZERO,OVRCD    * Must Write to File
          GOTO       STRAN110 IF EQUAL
          CALL       WRDBFD1       * Write Detail Record
          CALL       CNOTE000      * Copy Notes from Billing File to Fin Det.
.
          CALL       UPINV000      * Update Invoice Details
.
          GOTO       STRAN100
.
STRAN900
STRAN999  RETURN
.------------------------------------------------------------
. Move in Financial Detail Transaction
.------------------------------------------------------------
MVFDT000  ADD        ONE,TRANLINE
          MOVE       TRANLINE,DBFDDLN    * Line Number
          MOVE       DBTCDEB,DBFDDEB     * Debtor
          MOVE       TWO,DBFDDTY         * Doc. Type 2=Credit Note
          MOVE       CFDBCRN,DBFDDOC     * Document Reference (Invoice Number)
          REP        " 0",DBFDDOC
          MOVE       INVREF,DBFDINV      * Invoice Ref
          MOVE       DBTCDLN,DBFDILN     * Invoice Line
          MOVE       INVDAT,DBFDIDAT     * Invoice Date
          REP        " 0",DBFDIDAT
          MOVE       DBFHDDAT,DBFDPDAT   * Paid Date = Document Date for Credit
          REP        " 0",DBFDPDAT
.
          MOVE       ZERO,DBFDGLS        * Ledger Status
          MOVE       DBTCITM,KEY8        * Read Item for General Ledger Details
          CALL       RDDBIT1
          MOVE       DBITLED,DBFDLED     * Ledger
          MOVE       DBITIAC,DBFDIAC     * Income Account
          MOVE       DBITCAC,DBFDCAC     * Control Account
          MOVE       DBITTAC,DBFDTAC     * Tax Account
          MOVE       DBITTCA,DBFDTCA     * Tax Control
          MOVE       SP70,DBFDBCHG       * Billing Charge Number
          MOVE       DBFHCDAT,DBFDBDAT   * Billing Input Date
          MOVE       DBFHCTIM,DBFDBTIM   * Billing Input Time
          MOVE       PASSCODE,DBFDBUSR   * Billing Input User ID
          MOVE       DBTCITM,DBFDITM     * Sales Item Code
          MOVE       DBTCSDAT,DBFDSDAT   * Service Date
          REP        " 0",DBFDSDAT
          MOVE       DBTCDREF,DBFDDREF   * Debtors Reference
          MOVE       DBTCOREF,DBFDOREF   * Our Reference
          MOVE       DBTCQTY,DBFDQTY     * Quantity
          MOVE       DBTCPRI,DBFDPRI     * Price
          MOVE       DBTCTOT,DBFDTOT     * Extended Total
          MOVE       DBTCTRT,DBFDTRT     * Tax Rate
          MOVE       DBTCTAX,DBFDTAX     * Tax Amount
          ASSIGN     DBFDTAX+DBFDTOT,DBFDPAID       * Paid Amount
          MOVE       DBTCUR1,DBFDUR1     * User Def Ref 1
          MOVE       DBTCUR2,DBFDUR2     * User Def Ref 2
          MOVE       DBTCUD1,DBFDUD1     * User Def Date 1
          MOVE       DBTCUD2,DBFDUD2     * User Def Date 2
          MOVE       DBTCUY1,DBFDUY1     * User Def Y/N 1
          MOVE       DBTCUY2,DBFDUY2     * User Def Y/N 2
          MOVE       DBTCUC1,DBFDUC1     * User Def Code 1
          MOVE       DBTCUC2,DBFDUC2     * User Def Code 2
          MOVE       DBTCUC3,DBFDUC3     * User Def Code 3
          MOVE       DBTCUC4,DBFDUC4     * User Def Code 4
          MOVE       DBTCGST,DBFDGST
          MOVE       SP70,DBFDSPA        * Spare
.
          RETURN
.-------------------------------------------------------------------
. Copy Notes to Financial Details Notes File
.-------------------------------------------------------------------
CNOTE000  PACK       KEY14,DBTCDEB,DBTCDLN,SP70
          CALL       RSDBTD1
CNOTE100  CALL       RKDBTD1
          BRANCH     OVRCD,CNOTE999
          MATCH      DBTCDEB,DBTDDEB
          GOTO       CNOTE999 IF NOT EQUAL
          MATCH      DBTCDLN,DBTDDLN
          GOTO       CNOTE999 IF NOT EQUAL
.
CNOTE110  PACK       KEY27,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,DBTDLIN,SP70
          CALL       RADBFN1
          BRANCH     OVRCD,CNOTE200
          MOVE       DBTDLIN,F3   * This is here just in case it should
          ADD        ONE,F3       * Not Normally Occur
          MOVE       F3,DBTDLIN
          GOTO       CNOTE110
.
CNOTE200  UNPACK     KEY27,DBFNDEB,DBFNDTY,DBFNDOC,DBFNDLN,DBFNLIN
          MOVE       DBTDCOM,DBFNCOM
          MOVE       SP70,DBTDSPA
          CALL       WRDBFN1
.
          PACK       KEY14,DBTDDEB,DBTDDLN,DBTDLIN
          CALL       DEDBTD1
          GOTO       CNOTE100
.
CNOTE999  RETURN
.------------------------------------------------------------
. Update Invoice Transaction Details
.------------------------------------------------------------
UPINV000  MATCH      "000000000000",INVREF
          GOTO       UPINV500 IF NOT EQUAL
.
. Write dummy invoice record for Cr Note Not releated to a Invoice
.----------------------------------------------------------------------
.         Save KEY50 to Matching Credit Entry
.
          IF         DBFDTAX+DBFDTOT=0
            GOTO       UPINV999
          ENDIF
          PACK       KEY50,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,SP70
.
UPINV100  PACK       KEY24,DBFDDEB,ONE,INVREF,DBFDDLN
          CALL       RADBFD1       * Check File
          BRANCH     OVRCD,UPINV200
          MOVE       DBFDDLN,F3
          ADD        ONE,F3
          MOVE       F3,DBFDDLN
          GOTO       UPINV100
.
UPINV200  MULT       SEQ,DBFDTOT          * Credit Balance Invoice for
          MULT       SEQ,DBFDTAX          * Outstanding/Aging
          MOVE       ZERO,DBFDPAID        * Nothing Paid
          MOVE       DBFHDDAT,DBFDIDAT    * Invoice Date same as Document Date
          MOVE       "99999999",DBFDPDAT  * Record as Outstanding
          MOVE       INVREF,DBFDDOC       * Document Reference "000000000000"
          MOVE       KEY50,DBFDOREF       * Save Key to Credit in Reference
          MOVE       ONE,DBFDDTY          * Doc. Type Invoice
          CALL       WRDBFD1              * Write Detail Record
          GOTO       UPINV999
.
. Update Existing Invoice with Amount Paid/Credit
.
UPINV500  ASSIGN     DBFDTOT+DBFDTAX,TOTALAMT
          PACK       KEY24,DBFDDEB,ONE,DBFDINV,DBFDILN,SP70
          CALL       RDDBFD1
          BRANCH     OVRCD,UPINV900
.
          ADD        TOTALAMT,DBFDPAID       * Increase Amount Paid by Cr Amt.
          IF         DBFDPAID=(DBFDTAX+DBFDTOT)
            MOVE       DBFHDDAT,DBFDPDAT     * Date Paid = Credit Doc. Date
          ELSE
            MOVE       "99999999",DBFDPDAT
          ENDIF
          CALL       UPDBFD1
          GOTO       UPINV999
.
UPINV900  BEEP
          MOVE       "ERROR : Update Failed on Invoice Details - ",DISPMSG
          CALL       MESSAGE1
.
UPINV999  RETURN
.
.-------------------------------------------------------------
. Locking Standard Routine to Enter Key Field
.-------------------------------------------------------------
EKEYF000  MOVE      ZERO,CKEYTYP
          CALL      KDBDBA00                * Call Standard Keyin Routine wDBh ?
          BRANCH    EXIT,EKEYF999,EKEYF999  * EXIT 1 Null Entry 2 EXITchar
.
           MOVE     SP70,DBLNNA1
           MATCH    SP70,DBDBLIN
           IF       !@EQUAL
             PACK     KEY8,DBDBLIN,SP70
             CALL     RDDBDB1
           ENDIF
.
EKEYF100  PACK      KEY8,DBDBDEB,SP70       * Setup Key to File
          CALL      RLDBDB1                 * Read and Lock Record
          BRANCH    OVRCD,EKEYF999,EKEYF200 * OVRCD=1 Not on File 2 Locked
          CALL      GETCDS00                * Get User Def Code Descriptions
          MOVE      ZERO,EXIT               * Setup EXIT Field
          MOVE      ZERO,OVRCD              * Setup Ovrcd Field
          GOTO      EKEYF999
.
EKEYF200  MOVE      SP70,DISPMSG            * Clear Line 24 Message Display
          CALL      MESSAGE2                * Clear Line 24 and Save
          KEYIN     *P1:24,*EL,"Record Locked - (":
                    *V2LON,"R",*HOFF,")etry or e(":
                    *V2LON,"X",*HOFF,")it ? ",ANS
          CALL      MESSAGE3                * Restore Line 24
          REP       UPPLOW,ANS              * Convert to Upper Case
          MATCH     ANSR,ANS                * Re-try
          GOTO      EKEYF100 IF EQUAL       * Return to locking
          MATCH     ANSX,ANS                * EXIT
          GOTO      EKEYF000 IF EQUAL       * Must be a valid response
          MATCH     ANSE,ANS                * EXIT
          GOTO      EKEYF200 IF NOT EQUAL   * Must be a valid response
          GOTO      EKEYF000                * Return to Keyin
.
EKEYF999  RETURN                            * End of Routine
.---------------------------------------------------
. Get User Def Code Descriptions
.---------------------------------------------------
GETCDS00   CALL     FORAD000
.
           MOVE     SP70,DBDBUC1D
           MOVE     SP70,DBDBUC2D
           MOVE     SP70,DBDBUC3D
           MOVE     SP70,DBDBUC4D
           MOVE     SP70,DBDBWRND
.
           MATCH    SP70,DBDBWRN
           IF       !@EQUAL
             MOVE     "DBWR",DBCDCAT
             PACK     KEY7,DBCDCAT,DBDBWRN
             CALL     RDDBCD1
             IF       OVRCD=0
               MOVE     DBCDDES,DBDBWRND
             ENDIF
           ENDIF
           MATCH    SP70,DBDBUC1
           IF       !@EQUAL
             MOVE     "DB01",DBCDCAT
             PACK     KEY7,DBCDCAT,DBDBUC1
             CALL     RDDBCD1
             IF       OVRCD=0
               MOVE     DBCDDES,DBDBUC1D
             ENDIF
           ENDIF
           MATCH    SP70,DBDBUC2
           IF       !@EQUAL
             MOVE     "DB02",DBCDCAT
             PACK     KEY7,DBCDCAT,DBDBUC2
             CALL     RDDBCD1
             IF       OVRCD=0
               MOVE     DBCDDES,DBDBUC2D
             ENDIF
           ENDIF
           MATCH    SP70,DBDBUC3
           IF       !@EQUAL
             MOVE     "DB03",DBCDCAT
             PACK     KEY7,DBCDCAT,DBDBUC3
             CALL     RDDBCD1
             IF       OVRCD=0
               MOVE     DBCDDES,DBDBUC3D
             ENDIF
           ENDIF
           MATCH    SP70,DBDBUC4
           IF       !@EQUAL
             MOVE     "DB04",DBCDCAT
             PACK     KEY7,DBCDCAT,DBDBUC4
             CALL     RDDBCD1
             IF       OVRCD=0
               MOVE     DBCDDES,DBDBUC4D
             ENDIF
           ENDIF
.
           MOVE     SP70,DBTEDES
           PACK     KEY3,DBDBTER,SP70
           CALL     RDDBTE1
.
           RETURN
.
.------------------------------------------------------------
. Enter Credit Note Date
.------------------------------------------------------------
ECDAT000  READ      CONTROLF,EIGHTY1;CFDBPASS,*77,CFDBSQLA,CFDBSQLB:
                                                   CFDBFDAT,CFDBTDAT
          MOVE      SP2,CDAY
          MOVE      "0",CKEYTYP
          CALL      KEYDATE
          BRANCH    OVRCD,ECDAT900
          MATCH     SP2,CDAY
          GOTO      ECDAT900 IF EQUAL
          PACK      CRDATE,CCENT,CYEAR,CMON,CDAY
          REP       " 0",CRDATE
          MATCH     CFDBFDAT,CRDATE   * Date Range
          GOTO      ECDAT800 IF LESS
          MATCH     CRDATE,CFDBTDAT
          GOTO      ECDAT800 IF LESS
          MOVE      ZERO,EXIT
          GOTO      ECDAT999
.
ECDAT800  BEEP
          MOVE      "Credit Date NOT in Processing Date Range - ",DISPMSG
          CALL      MESSAGE1
          GOTO      ECDAT000
.
ECDAT900  MOVE      ONE,EXIT
ECDAT999  RETURN
.-------------------------------------------------------------
. Enter Invoice Number
.    - Accept Invoice Number
.    - Copy Details to Credit Note
.-------------------------------------------------------------
EINVN000  MOVE     ONE,DBFHDTY
          MOVE     DBDBDEB,DBFHDEB
          MOVE     ZERO,CKEYTYP
          CALL     KDBFHX00
          BRANCH   EXIT,EINVN999,EINVN999,EINVN100
.
          MOVE     DBFHDDAT,OLDINV
          MOVE     ZERO,DBFHDTOT
          MOVE     ZERO,TOTALCRD
          CALL     CLRTMP00       * Clear Temp File for Debtor
          CALL     CPDET000       * Note as Debtor is Locked No Other User
.                                  * Can Post a Credit At the Same Time
          GOTO     EINVN999
.
EINVN100  CALL     CHKOUT00       * If Outstanding Invoices Exists then
          BRANCH   EXIT,EINVN000  * Non Referenced Credit Notes Not Allowed
          CALL     CLRTMP00       * Clear Temp File for Debtor
          MOVE     DBDBDEB,DBFHDEB
          MOVE     ZERO,DBFHDTOT
          MOVE     ZERO,TOTALCRD
.
EINVN999  RETURN
.------------------------------------------------------------
. Copy Invoice Details to Blank Credit Note Temp File
.------------------------------------------------------------
CPDET000  MOVE     ZERO,CRLINE
          PACK     KEY44,DBFHDEB,DBFHDDAT,DBFHDOC,SP70
          CALL     RDDBFD3
          IF       OVRCD=0
            CALL     RPDBFD3
          ENDIF
CPDET100  CALL     RKDBFD3
          BRANCH   OVRCD,CPDET500
          MATCH    DBFHDEB,DBFDDEB           * Same Debtor
          GOTO     CPDET500 IF NOT EQUAL
          MATCH    DBFHDDAT,DBFDIDAT         * Same Invoice Date
          GOTO     CPDET500 IF NOT EQUAL
          MATCH    DBFHDOC,DBFDINV           * Same Invoice Reference
          GOTO     CPDET500 IF NOT EQUAL
.
          MOVE     DBFDDEB,DBTCDEB           * Same Debtor
          MOVE     DBFDILN,DBTCDLN
          PACK     KEY11,DBTCDEB,DBTCDLN
          CALL     RDDBTC1
          IF       OVRCD=0
            CALL     ADDET000
            CALL     UPDBTC1
            CALL     CPNOT000           * Add Notes
          ELSE
            CALL     MVDET000
            CALL     WRDBTC1
            MOVE     ZERO,NOTELINE
            CALL     CPNOT000           * Copy Notes
          ENDIF
          GOTO     CPDET100           * Next Line
.
. Delete any Items with Zero Outstanding
.----------------------------------------
CPDET500  PACK     KEY11,DBFHDEB,SP70
          CALL     RSDBTC1
.
CPDET510  CALL     RKDBTC1
          BRANCH   OVRCD,CPDET999
          MATCH    DBFHDEB,DBTCDEB
          GOTO     CPDET999 IF NOT EQUAL
.
          IF       (DBTCTAX+DBTCTOT)=0
            PACK     KEY11,DBTCDEB,DBTCDLN
            CALL     DEDBTC1
            CALL     DENOT000
          ENDIF
          ASSIGN   DBFHDTOT+DBTCTOT+DBTCTAX,DBFHDTOT
          ASSIGN   TOTALCRD+DBTCTOT+DBTCTAX,TOTALCRD
          GOTO     CPDET510
.
CPDET999  RETURN
.------------------------------------------------------------
. Add in Invoice Details
.------------------------------------------------------------
ADDET000  MOVE      DBFDDTY,F1
          BRANCH    F1,ADDET100,ADDET200,ADDET200,ADDET100
ADDET100  ADD       DBFDQTY,DBTCQTY    * This would be very Strange if
          ADD       DBFDTOT,DBTCTOT    * it happened
          ADD       DBFDTAX,DBTCTAX
          GOTO      ADDET999
.
ADDET200  SUB       DBFDQTY,DBTCQTY    * Take off Payments & Credits
          SUB       DBFDTOT,DBTCTOT
          SUB       DBFDTAX,DBTCTAX
          GOTO      ADDET999
.
ADDET999  RETURN
.------------------------------------------------------------
. Move in Invoice Details
.------------------------------------------------------------
MVDET000  MOVE      DBFDDEB,DBTCDEB
          MOVE      DBFDITM,DBTCITM
          MOVE      DBFDSDAT,DBTCSDAT
          MOVE      DBFDDREF,DBTCDREF
          MOVE      DBFDOREF,DBTCOREF
          MOVE      DBFDQTY,DBTCQTY
          MOVE      DBFDPRI,DBTCPRI
          MOVE      DBFDTOT,DBTCTOT
          MOVE      DBFDTRT,DBTCTRT
          MOVE      DBFDTAX,DBTCTAX
          MOVE      DBFDUR1,DBTCUR1
          MOVE      DBFDUR2,DBTCUR2
          MOVE      DBFDUD1,DBTCUD1
          MOVE      DBFDUD2,DBTCUD2
          MOVE      DBFDUY1,DBTCUY1
          MOVE      DBFDUY2,DBTCUY2
          MOVE      DBFDUC1,DBTCUC1
          MOVE      DBFDUC2,DBTCUC2
          MOVE      DBFDUC3,DBTCUC3
          MOVE      DBFDUC4,DBTCUC4
          MOVE      DBFDGST,DBTCGST
          MOVE      SP70,DBTCSPA
          RETURN
.------------------------------------------------------------
. Copy Notes from Invoice
.------------------------------------------------------------
CPNOT000  PACK      KEY27,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,SP70
          CALL      RSDBFN1
CPNOT100  CALL      RKDBFN1
          BRANCH    OVRCD,CPNOT999
          PACK      KEY24,DBFDDEB,DBFDDTY,DBFDDOC,DBFDDLN,SP70
          PACK      KEY27,DBFNDEB,DBFNDTY,DBFNDOC,DBFNDLN,SP70
          MATCH     KEY24,KEY27
          GOTO      CPNOT999 IF NOT EQUAL
          MOVE      DBTCDEB,DBTDDEB
          MOVE      DBTCDLN,DBTDDLN
          MOVE      DBFNCOM,DBTDCOM
          MOVE      SP70,DBTDSPA
.
CPNOT110  ADD       ONE,NOTELINE
          MOVE      NOTELINE,DBTDLIN
          PACK      KEY14,DBTDDEB,DBTDDLN,DBTDLIN
          CALL      RADBTD1
          COMPARE   ZERO,OVRCD
          GOTO      CPNOT110 IF EQUAL  * Should Never Happen
          CALL      WRDBTD1
          GOTO      CPNOT100
.
CPNOT999  RETURN
.------------------------------------------------------------
. Clear Temp Files for input
.------------------------------------------------------------
CLRTMP00  PACK      KEY11,DBFHDEB,SP70
          CALL      RSDBTC1
          CALL      RKDBTC1
          BRANCH    OVRCD,CLRTMP50
          MATCH     DBTCDEB,DBFHDEB
          GOTO      CLRTMP50 IF NOT EQUAL
          PACK      KEY11,DBTCDEB,DBTCDLN
          CALL      DEDBTC1
          GOTO      CLRTMP00
.
CLRTMP50  PACK      KEY14,DBFHDEB,SP70
          CALL      RSDBTD1
          CALL      RKDBTD1
          BRANCH    OVRCD,CLRTMP99
          MATCH     DBTDDEB,DBFHDEB
          GOTO      CLRTMP99 IF NOT EQUAL
          PACK      KEY14,DBTDDEB,DBTDDLN,DBTDLIN
          CALL      DEDBTD1
          GOTO      CLRTMP50
.
CLRTMP99  RETURN
.------------------------------------------------------------
. Delete Notes for a Item
.------------------------------------------------------------
DENOT000  PACK      KEY14,DBTCDEB,DBTCDLN,SP70
          CALL      RSDBTD1
          CALL      RKDBTD1
          BRANCH    OVRCD,CLRTMP99
          MATCH     DBTDDEB,DBTCDEB
          GOTO      DENOT999 IF NOT EQUAL
          PACK      KEY14,DBTDDEB,DBTDDLN,DBTDLIN
          CALL      DEDBTD1
          GOTO      DENOT000
DENOT999  RETURN
.------------------------------------------------------------
. Check Outstanding Invoices
.  - NON Invoice Referenced Credits May only be posted
.    if the debtor has no outstanding invoices.
.------------------------------------------------------------
CHKOUT00  MOVE      "99999999",KEY8
          PACK      KEY52,DBDBDEB,KEY8,SP70
          CALL      RSDBFD2            * Process all transactions paid after
CHKOUT10  CALL      RKDBFD2            * the as at date.
          BRANCH    OVRCD,CHKOUT95
          MATCH     DBFDDEB,DBDBDEB
          GOTO      CHKOUT95 IF NOT EQUAL
          MATCH     "1",DBFDDTY        * Process Invoices Only
          GOTO      CHKOUT10 IF NOT EQUAL
          MATCH     "000000000000",DBFDDOC
          GOTO      CHKOUT10 IF EQUAL
.
          IF        (DBFDTAX+DBFDTOT-DBFDPAID)<>0
            MOVE      "Debtor has Outstanding Invoices - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            MOVE      "Non Invoice Referenced Credits Not Allowed - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            MOVE      ONE,EXIT
            GOTO      CHKOUT99
          ENDIF
          GOTO      CHKOUT10
.
CHKOUT95  MOVE      ZERO,EXIT
.
CHKOUT99  RETURN
.
.-------------------------------------------------------------
. Item Selected
.-------------------------------------------------------------
SELT0000  CALL     RDDBTC1
          IF       OVRCD=1
            BEEP
            MOVE     "Can't Read Details - ",DISPMSG
            CALL     MESSAGE1
            GOTO     SELT9999
          ENDIF
.
          MOVE      DBTCITM,KEY8
          CALL      RDDBIT1
          BRANCH    OVRCD,SELT9100
.
          MOVE      DBITPTY,KEY8
          CALL      RDDBPT1
          BRANCH    OVRCD,SELT9200
.
          PACK      KEY12,PASSCODE,DBPTDEP
          CALL      RDDBSE1
          BRANCH    OVRCD,SELT9300
.
          UNPACK    SP70,IBGSDESC
          PACK      KEY6,DBTCGST,SP70
          CALL      RDIBGS1
          IF        OVRCD=0 & IBGSACTV=1
            MOVE      "GST Code is Inactive          ",IBGSDESC
          ENDIF
.
          ASSIGN   DBTCTOT+DBTCTAX,TOTALAMT
          ASSIGN   TOTALCRD-DBTCTOT-DBTCTAX,TOTALCRD
          CALL     GETDES00
.
          CALL     SC02L000
.
          GOTO     SELT9999
.
SELT9100  BEEP
          MOVE     "Invalid Sales Item - ",DISPMSG
          CALL     MESSAGE1
          GOTO     SELT9999
.
SELT9200  BEEP
          MOVE     "Invalid Product Type on Sales Item - ",DISPMSG
          CALL     MESSAGE1
          GOTO     SELT9999
.
SELT9300  BEEP
          MOVE     "Inadequate Security for Sales Item - ",DISPMSG
          CALL     MESSAGE1
          GOTO     SELT9999
.
SELT9999  RETURN
.
.---------------------------------------------------
. Get User Def Code Descriptions
.---------------------------------------------------
GETDES00   MOVE     SP70,DBTCUC1D
           MOVE     SP70,DBTCUC2D
           MOVE     SP70,DBTCUC3D
           MOVE     SP70,DBTCUC4D
           MATCH    SP70,DBTCUC1
           IF       !@EQUAL
             MOVE     "FD01",DBCDCAT
             PACK     KEY7,DBCDCAT,DBTCUC1
             CALL     RDDBCD1
             IF       OVRCD=0
               MOVE     DBCDDES,DBTCUC1D
             ENDIF
           ENDIF
           MATCH    SP70,DBTCUC2
           IF       !@EQUAL
             MOVE     "FD02",DBCDCAT
             PACK     KEY7,DBCDCAT,DBTCUC2
             CALL     RDDBCD1
             IF       OVRCD=0
               MOVE     DBCDDES,DBTCUC2D
             ENDIF
           ENDIF
           MATCH    SP70,DBTCUC3
           IF       !@EQUAL
             MOVE     "FD03",DBCDCAT
             PACK     KEY7,DBCDCAT,DBTCUC3
             CALL     RDDBCD1
             IF       OVRCD=0
               MOVE     DBCDDES,DBTCUC3D
             ENDIF
           ENDIF
           MATCH    SP70,DBTCUC4
           IF       !@EQUAL
             MOVE     "FD04",DBCDCAT
             PACK     KEY7,DBCDCAT,DBTCUC4
             CALL     RDDBCD1
             IF       OVRCD=0
               MOVE     DBCDDES,DBTCUC4D
             ENDIF
           ENDIF
.
GETDES99   RETURN
.
.-------------------------------------------------------------
. Add Item to the Credit
.-------------------------------------------------------------
ADDI0000  MATCH     "000000000000",DBFHDOC
          GOTO      ADDI9900 IF NOT EQUAL
          MOVE      ZERO,F3
          PACK      KEY11,DBDBDEB,Z70       * Setup Key to File
          CALL      RSDBTC1
          CALL      RPDBTC1
          BRANCH    OVRCD,ADDI2000
          MATCH     DBDBDEB,DBTCDEB
          GOTO      ADDI2000 IF NOT EQUAL
.
ADDI1000  MOVE      DBTCDLN,F3
ADDI2000  MOVE      DBDBDEB,DBTCDEB
          ADD       ONE,F3
          MOVE      F3,DBTCDLN
          CALL      CLRCRD00
          PACK      KEY11,DBDBDEB,DBTCDLN,SP70  * Setup Key to File
          UNPACK    KEY11,DBTCDEB,DBTCDLN
          CALL      RADBTC1                     * Read
          COMPARE   ZERO,OVRCD
          GOTO      ADDI2000 IF EQUAL
.
          MOVE      ONE,ACCEPT
          MOVE      ONE,ENDADD
.
          CALL      SC02L000                    * Input Details
.
          BRANCH    ENDADD,ADDI0000
          GOTO      ADDI9999
.
ADDI9900  BEEP
          MOVE      "Can't Add Items to Invoice. - ",DISPMSG
          CALL      MESSAGE1
.
ADDI9999  RETURN
.------------------------------
. Clear Fields for New Record
.------------------------------
CLRCRD00  MOVE     SP70,DBTCITM
          MOVE     SP70,DBTCSDAT
          MOVE     SP70,DBTCDREF
          MOVE     SP70,DBTCOREF
          MOVE     ZERO,DBTCQTY
          MOVE     ZERO,DBTCPRI
          MOVE     ZERO,DBTCTOT
          MOVE     ZERO,DBTCTRT
          MOVE     ZERO,DBTCTAX
          MOVE     SP70,DBTCUR1
          MOVE     SP70,DBTCUR2
          MOVE     SP70,DBTCUD1
          MOVE     SP70,DBTCUD2
          MOVE     ZERO,DBTCUY1
          MOVE     ZERO,DBTCUY2
          MOVE     SP70,DBTCUC1
          MOVE     SP70,DBTCUC2
          MOVE     SP70,DBTCUC3
          MOVE     SP70,DBTCUC4
          MOVE     SP70,DBTCGST
          MOVE     SP70,DBTCSPA
          RETURN
.
.-------------------------------------------------------------
. Cancel Post
.-------------------------------------------------------------
CANA0000  PACK     KEY11,DBTCDEB,DBTCDLN,SP70
          CALL     RDDBTC1
          IF       OVRCD=0
            ASSIGN   TOTALCRD+DBTCTOT+DBTCTAX,TOTALCRD
          ENDIF
          RETURN
.
.-------------------------------------------------------------
. Audit & Locking Standard Routine to POSA Changes.
.-------------------------------------------------------------
POSA0000  CALL     CHKTOT00           * Check Total Credit Against Outstanding
          BRANCH   EXIT,POSA9000
.
          PACK     KEY11,DBTCDEB,DBTCDLN,SP70  * Setup Key
          CALL     RADBTC1            * Check for record on file
          IF       OVRCD=0
            CALL     UPDBTC1          * Update Changes
          ELSE
            CALL     WRDBTC1          * Write New Record
          ENDIF
.
          ASSIGN    TOTALCRD+DBTCTOT+DBTCTAX,TOTALCRD
.
          CALL      PNOTE000          * Save Notes
          MOVE      ZERO,EXIT         * Save Complete so Exit Screen
          GOTO      POSA9999
.
POSA9000  MOVE      ONE,EXIT          * Return to Prompt Invalid Totals
.
POSA9999  RETURN                      * Return to program.
.---------------------------
. Save Notes
.---------------------------
PNOTE000  PACK      KEY14,DBTCDEB,DBTCDLN,SP70
          CALL      RSDBTD1
PNOTE200  CALL      RKDBTD1
          BRANCH    OVRCD,PNOTE250
          MATCH     DBTCDEB,DBTDDEB
          GOTO      PNOTE250 IF NOT EQUAL
          MATCH     DBTCDLN,DBTDDLN
          GOTO      PNOTE250 IF NOT EQUAL
          PACK      KEY14,DBTDDEB,DBTDDLN,DBTDLIN
          CALL      DEDBTD1
          GOTO      PNOTE200
.
PNOTE250  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      TEMPWORD,FILDBTD1
          TRAPCLR   IO
          BRANCH    OVRCD,PNOTE999
          MOVE      ZERO,F3
PNOTE260  READ      TEMPWORD,SEQ;DBTDCOM
          GOTO      PNOTE999 IF OVER
          MOVE      F3,DBTDLIN
          PACK      KEY14,DBTCDEB,DBTCDLN,DBTDLIN
          UNPACK    KEY14,DBTDDEB,DBTDDLN,DBTDLIN
          CALL      WRDBTD1
          ADD       ONE,F3
          GOTO      PNOTE260
.
PNOTE999  RETURN
.------------------------------------------------------------
. Check Totals Against the Outstanding Totals
.------------------------------------------------------------
CHKTOT00  MATCH    "000000000000",DBFHDOC
          GOTO     CHKTOT95 IF EQUAL
          PACK     KEY44,DBFHDEB,DBFHDDAT,DBFHDOC,SP70
          MOVE     ZERO,TOTQTY    * This would be very Strange if
          MOVE     ZERO,TOTTOT    * it happened
          MOVE     ZERO,TOTTAX
          CALL     RSDBFD3
CHKTOT10  CALL     RKDBFD3
          BRANCH   OVRCD,CHKTOT90
          MATCH    DBFHDEB,DBFDDEB           * Same Debtor
          GOTO     CHKTOT90 IF NOT EQUAL
          MATCH    DBFHDDAT,DBFDIDAT         * Same Invoice Date
          GOTO     CHKTOT90 IF NOT EQUAL
          MATCH    DBFHDOC,DBFDINV           * Same Invoice Reference
          GOTO     CHKTOT90 IF NOT EQUAL
          MATCH    DBTCDLN,DBFDILN           * Same Invoice Line
          GOTO     CHKTOT10 IF NOT EQUAL
          MOVE     DBFDDTY,F1
          BRANCH   F1,CHKTOT20,CHKTOT30,CHKTOT30,CHKTOT20
.
CHKTOT20  ADD      DBFDQTY,TOTQTY    * This would be very Strange if
          ADD      DBFDTOT,TOTTOT    * it happened
          ADD      DBFDTAX,TOTTAX
          GOTO     CHKTOT10
.
CHKTOT30  SUB      DBFDQTY,TOTQTY    * This would be very Strange if
          SUB      DBFDTOT,TOTTOT    * it happened
          SUB      DBFDTAX,TOTTAX
          GOTO     CHKTOT10
.
CHKTOT90  IF       DBTCQTY>TOTQTY
            MOVE     ONE,EXIT
            BEEP
            MOVE     "ERROR : Credit Qty. Greater than Outstanding - ",DISPMSG
            CALL     MESSAGE1
            GOTO     CHKTOT99
          ENDIF
          IF       DBTCTOT>TOTTOT
            MOVE     ONE,EXIT
            BEEP
            MOVE     "ERROR : Credit Total Greater than Outstanding - ",DISPMSG
            CALL     MESSAGE1
            GOTO     CHKTOT99
          ENDIF
          IF       DBTCTAX>TOTTAX
            MOVE     ONE,EXIT
            BEEP
            MOVE     "ERROR : Credit Tax Greater than Outstanding - ",DISPMSG
            CALL     MESSAGE1
            GOTO     CHKTOT99
          ENDIF
CHKTOT95  MOVE     ZERO,EXIT
CHKTOT99  RETURN
.
.-------------------------------------------------------------
. Delete Item From Credit Note
.-------------------------------------------------------------
DELA0000  MOVE     SP70,DISPMSG        * Clear Line 24 Display Message
          CALL     MESSAGE2            * Save and Clear Line 24
          CALL     DELQST              * Delete (Y/N/C) CEXIT 1/2/3
          CALL     MESSAGE3            * Restore Line 24
          BRANCH   CEXIT,DELA1000,DELA9000,DELA9100
.
DELA1000  PACK     KEY11,DBTCDEB,DBTCDLN,SP70  * Setup Key
          CALL     RADBTC1            * Check for record on file
          IF       OVRCD=0
            CALL     DEDBTC1          * Delete
          ENDIF
          CALL     DNOTE000           * Delete Notes
          MOVE     ZERO,EXIT          * Exit Screen
          GOTO     DELA9999
DELA9000  MOVE     ONE,EXIT           * Return to Prompt on "No"
          GOTO     DELA9999
DELA9100  MOVE     ZERO,EXIT          * Exit Screen on "Cancel"
          GOTO     DELA9999
.
DELA9999  RETURN
.---------------------------
. Save Notes
.---------------------------
DNOTE000  PACK      KEY14,DBTCDEB,DBTCDLN,SP70
          CALL      RSDBTD1
DNOTE100  CALL      RKDBTD1
          BRANCH    OVRCD,DNOTE999
          MATCH     DBTCDEB,DBTDDEB
          GOTO      DNOTE999 IF NOT EQUAL
          MATCH     DBTCDLN,DBTDDLN
          GOTO      DNOTE999 IF NOT EQUAL
          PACK      KEY14,DBTDDEB,DBTDDLN,DBTDLIN
          CALL      DEDBTD1
          GOTO      DNOTE100
DNOTE999  RETURN
.
.------------------------------------------------------------
. Enter Sales Item Code
.------------------------------------------------------------
ESALI000  COMPARE   ONE,ACCEPT         * Display Line Number on Screen if
          CALL      DISLIN00 IF EQUAL  * in Add Mode.
.
          MATCH     "000000000000",DBFHDOC    * Related to an Invoice
          GOTO      ESALI990 IF NOT EQUAL   * Yes
.
          MOVE      ZERO,CKEYTYP
          CALL      KDBITX00
          BRANCH    EXIT,ESALI900,ESALI900
          IF        DBITACT=0
            MOVE      "Sales Item Not Active. - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      ESALI000
          ENDIF
          MOVE      DBITITM,DBTCITM
.
          IF        ACCEPT=1
            CALL      LODWP000
          ENDIF
.
          COMPARE   ONE,ACCEPT
          GOTO      ESALI999 IF EQUAL
.
          MOVE      "   37",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      FILDBTD1,WORDNAME
            CALL      DISPWORD
          ENDIF
          MOVE      DBITPRI,DBTCPRI
          ASSIGN    DBTCPRI*DBTCQTY,DBTCTOT
          CALL      CALTAX00
          ASSIGN    DBTCTOT+DBTCTAX,TOTALAMT
          CALL      DISPIT00
          MOVE      "   10",FLDID
          CALL      GETPOSIT
          GOTO      ESALI999
.
ESALI900  BRANCH    ACCEPT,ESALI910
          MOVE      DBTCITM,KEY8
          CALL      RDDBIT1
          MOVE      ZERO,EXIT
          GOTO      ESALI999

ESALI910  MOVE      ZERO,ENDADD   * End Add Items
          MOVE      TWO,EXIT
          GOTO      ESALI999
.
ESALI990  BEEP
          MOVE      "Can't Change Sales Item for Invoice Item - ",DISPMSG
          CALL      MESSAGE1
          MOVE      DBTCITM,KEY8
          CALL      RDDBIT1
          GOTO      ESALI999
.
ESALI999  RETURN
.
LODWP000  PREP     TEMPWORD,FILDBTD1
          PACK     KEY11,DBITITM,SP70
          CALL      RDDBIC1
          IF        OVRCD=0
            CALL      RPDBIC1
          ENDIF
LODWP100  CALL     RKDBIC1
          BRANCH   OVRCD,LODWP999
          MATCH    DBITITM,DBICITM
          GOTO     LODWP999 IF NOT EQUAL
          PACK     VAR,DBICCOM,SP70,SP70
          STRIP    VAR
          MOVELPTR VAR,F3
          SFORMAT  VAR,F3
          MOVE     DBICCOM,VAR
          IF       F3=0
            WRITE    TEMPWORD,SEQ;
          ELSE
            WRITE    TEMPWORD,SEQ;VAR
          ENDIF
          SFORMAT  VAR,127
          GOTO     LODWP100
LODWP999  CLOSE    TEMPWORD
          RETURN
.
.------------------------------------------------------------
. Display Line Number of Entry
.------------------------------------------------------------
DISLIN00  MOVE      "    6",FLDID      * Display Item Number if in Add
          CALL      GETPOSIT           * Mode
          IF        EXIT=0
            MOVE      DBTCDLN,VAR
            CALL      DISPITEM
          ENDIF
          MOVE      "   10",FLDID
          CALL      GETPOSIT
          RETURN
.------------------------------------------------------------
. Enter Quantity
.------------------------------------------------------------
EQUTY000  MOVE      SP70,VAR
          CALL      DISPITEM
          KEYIN     *PCCOL:CVERT,*V2LON,*RV,DBTCQTY
          COMPARE   ONE,ACCEPT
          GOTO      EQUTY999 IF EQUAL
.
EQUTY100  ASSIGN    DBTCPRI*DBTCQTY,DBTCTOT
          CALL      CALTAX00
.
          MOVE      "   16",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            PACK      VAR,DBTCTOT,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
          MOVE      "   14",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            PACK      VAR,DBTCQTY,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
EQUTY999  RETURN
.
.------------------------------------------------------------
. Enter Price
.------------------------------------------------------------
EPRIC000  IF        DBITMOD=1
            IF        ACCEPT=0
              BEEP
              MOVE      "Price Fixed for this Sales Item. ",DISPMSG
              CALL      MESSAGE1
            ENDIF
            GOTO      EPRIC100
          ENDIF
.
          COMPARE   ZERO,DBTCPRI
          GOTO      EPRIC050 IF EQUAL
          COMPARE   ONE,ACCEPT
          GOTO      EPRIC100 IF EQUAL
.
EPRIC050  MOVE      SP70,VAR
          CALL      DISPITEM
          KEYIN     *PCCOL:CVERT,*V2LON,*RV,DBTCPRI
.
          ASSIGN    DBTCQTY*DBTCPRI,DBTCTOT
EPRIC100  CALL      CALTAX00    * Calculate Tax Amount
.
          MOVE      "   16",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            PACK      VAR,DBTCTOT,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
          MOVE      "   15",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            PACK      VAR,DBTCPRI,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
EPRIC999  RETURN
.
CALTAX00  MOVE      ZERO,DBTCTRT
          MOVE      ZERO,DBTCTAX
.
          MOVE      DBTCTOT,TOTALAMT
.
          MATCH     SP6,DBTCGST
          GOTO      CALTAX90 IF EQUAL
.
          COMPARE   ONE,DBDBTEX
          GOTO      CALTAX90 IF EQUAL
.
          PACK      KEY14,DBTCGST,OLDINV,SP70
          CALL      RDIBGE1
          COMPARE   ZERO,OVRCD
          GOTO      CALTAX10 IF EQUAL
.
          CALL      RPIBGE1
          BRANCH    OVRCD,CALTAX80
.
          MATCH     DBTCGST,IBGECODE
          GOTO      CALTAX80 IF NOT EQUAL
.
CALTAX10  IF        IBGEAMNT<>0
            ASSIGN    (DBTCTOT*IBGEAMNT)/100.0,DBTCTAX
          ENDIF
          ASSIGN    DBTCTAX+DBTCTOT,TOTALAMT
          GOTO      CALTAX90
.
CALTAX80  MOVE      ZERO,IBGEAMNT
.
CALTAX90  CALL      DISPIT00
          GOTO      CALTAX99
.
CALTAX99  RETURN
.------------------------------------------------------------
. Display GST and Total back on Screen
.------------------------------------------------------------
DISPIT00  MOVE      "   18",FLDID      * GST
          CALL      GETPOSIT
          IF        EXIT=0
            PACK      VAR,DBTCTAX,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
          MOVE      "   36",FLDID      * Total Charge
          CALL      GETPOSIT
          IF        EXIT=0
            PACK      VAR,TOTALAMT,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
DISPIT99  RETURN
.
.------------------------------------------------------------
. Enter Total
.------------------------------------------------------------
ETOTL000  IF        DBITMOD=1
            ASSIGN    DBTCQTY*DBTCPRI,DBTCTOT
            IF        ACCEPT=0
              BEEP
              MOVE      "Price Fixed for this Sales Item. ",DISPMSG
              CALL      MESSAGE1
            ENDIF
            GOTO      ETOTL999
          ENDIF
.
          ASSIGN    DBTCQTY*DBTCPRI,DBTCTOT
          COMPARE   ONE,ACCEPT
          GOTO      ETOTL500 IF EQUAL
.
          MOVE      SP70,VAR
          CALL      DISPITEM
          KEYIN     *PCCOL:CVERT,*V2LON,*RV,DBTCTOT
          IF        !(DBTCTOT=(DBTCQTY*DBTCPRI))
            ASSIGN    DBTCTOT/DBTCQTY,DBTCPRI
          ENDIF
.
ETOTL500  CALL      CALTAX00
.
          MOVE      "   15",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            PACK      VAR,DBTCPRI,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
          MOVE      "   16",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            PACK      VAR,DBTCTOT,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
ETOTL999  RETURN
.
.------------------------------------------------------------
. Enter Tax Amount
.------------------------------------------------------------
ETAXA000  COMPARE   ONE,DBDBTEX
          GOTO      ETAXA100 IF NOT EQUAL
          MOVE      ZERO,DBTCTAX
          MOVE      ZERO,DBTCTRT
          COMPARE   ONE,ACCEPT
          GOTO      ETAXA900 IF EQUAL
          MOVE      "WARNING : Debtor is Flagged as Tax Exempt - ",DISPMSG
          BEEP
          CALL      MESSAGE1
          GOTO      ETAXA200
.
ETAXA100  CALL      CALTAX00
          MOVE      "   18",FLDID
          CALL      GETPOSIT
.
          COMPARE   ONE,ACCEPT          * Default if in Insert Mode
          GOTO      ETAXA900 IF EQUAL
.
ETAXA200  MOVE      SP70,VAR
          CALL      DISPITEM
          KEYIN     *PCCOL:CVERT,*V2LON,*RV,DBTCTAX
.
          ASSIGN    DBTCTAX+DBTCTOT,TOTALAMT
          MOVE      "   36",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            PACK      VAR,TOTALAMT,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
          MOVE      "   18",FLDID
          CALL      GETPOSIT
.
ETAXA900  MOVE      ZERO,EXIT
          MOVE      ZERO,OVRCD
.
ETAXA999  RETURN
.
.------------------------------------------------------------
. Enter GST Code
.------------------------------------------------------------
EGST0000  BRANCH    IBCNUGST,EGST0100,EGST0100
          GOTO      EGST9999
.
EGST0100  UNPACK    SP70,IBGSCODE,IBGSDESC
          CALL      KIBGSA00
          BRANCH    EXIT,EGST1000,EGST9999
.
          MOVE      IBGSCODE,DBTCGST
          GOTO      EGST1500
.
EGST1000  MOVE      SP70,DBTCGST
          MOVE      SP70,IBGSDESC
.
EGST1500  CALL      CALTAX00
.
          MOVE      "   39",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            PACK      VAR,IBGSDESC,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
          MOVE      "   38",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            PACK      VAR,DBTCGST,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
          GOTO      EGST9999
.
EGST9999  RETURN
.
.------------------------------------------------------------
. Re-print Line Details
.------------------------------------------------------------
LINDET00  ASSIGN   DBFDTAX+DBFDTOT,TOTALAMT
          MOVE     DBFDITM,KEY8
          CALL     RDDBIT1
          IF       OVRCD=1
            MOVE     "***** ITEM RECORD MISSING *****",DBITDES
          ENDIF
          RETURN
.-------------------------------------------------------------
. Re Print Credit
.-------------------------------------------------------------
REPR0000  CALL       OPNPRINT
          CALL       PRCRD000              * Print Credit Note
          CALL       CLSPRINT
.
          MOVE       "Re-Print Complete - ",DISPMSG
          BEEP
          CALL       MESSAGE1
.
REPR9999  RETURN
.
.-------------------------------------------------------------
. Enter Credit Note Number
.-------------------------------------------------------------
ECRDN000   MOVE     TWO,DBFHDTY
           MOVE     DBDBDEB,DBFHDEB
           MOVE     ZERO,CKEYTYP
           CALL     KDBFHA00
           BRANCH   EXIT,ECRDN999,ECRDN999
           ASSIGN   DBFHTOT+DBFHTAX,DBFHDTOT
ECRDN999   RETURN
.
.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       DEBCODIO/INC
          INC       DEBCRDCD    
          INC       DEBDBTIO/INC
          INC       DEBDBTKY    
          INC       DEBDCMIO/INC
          INC       DEBDKIIO/INC
          INC       DEBDKIKY    
          INC       DEBDKIPR    
          INC       DEBFADCD    
          INC       DEBFDTIO/INC
          INC       DEBFNOIO/INC
          INC       DEBFTHIO/INC
          INC       DEBFTHKY    
          INC       DEBICMIO/INC
          INC       DEBITMCD    
          INC       DEBITMIO/INC
          INC       DEBLINIO/INC
          INC       DEBPTYIO/INC
          INC       DEBSECIO/INC
          INC       DEBTCRIO/INC
          INC       DEBTDCIO/INC
          INC       DEBTERIO/INC
          INC       IBAGEDIO/INC
          INC       IBAGKIKY    
          INC       IBAGSTIO/INC
          INC       IBAGSTKY    
          INC       IBAPRINT    
          INC       IBAPRNIO/INC
          INC       IBATMDIO/INC
          INC       IBATMHIO/INC
.
          INC       STDGENCD
.

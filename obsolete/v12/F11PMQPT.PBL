.*****************************************************************************
.*    Program      : F11PMQPT                                                *
.
.*    Description  : Conversion pmsqptaf to new File layout                  *
.*                                                                           *
.*    Author       : Ebon Clements                                           *
.*    Date         : 19/11/2008                                              *
.*    Modifications: V9.11.00  19/11/2008  CAR 183976                        *
.*                 :           Created program                               *
.*****************************************************************************
.
.  Global change F11PMQPT  eg F57PTDOC
.  Global change PMSQPTFD  eg PATDOCFD (new layout)
.  Global change pmsqptaf  eg patdoctf
.  Global change PMSQPTA1  eg PATDOCT1
.  Global change KEY20     eg KEY8
.  Global change WRPMQPT1  eg WRDOCT1
.  Global change spsqptaf  eg sptdoctf
.
.  vi Global change command  :%s/FromString/ToString/g
.
.
          INC       STD001FD
.
FINDFILE  FILE      ASCII, FIXED=256
.
. Enter the first or the shortest index from the original FD and rename
. the index OLDFILE
.   
.                                     ******** copy the old FD here *******
.                                     * comment out all continuing fields and
.                                     * prefix changing fields with "OLD" -
.                                     * remove old Indexes and Redefines
.
OLDFILE    IFILE SQL, FIXED=3300, KEY="U1-20"
.
.Name      Type    Length Physical Start   Description
.----      ----    ------ -------- -----   -----------
.DPMQPMES  DIM     20        20        1   Message Id
.
.          PATMA1FD variables
.
.PURNO     DIM      8         8       21   PATIENT U.R NO.
.PMQPOURN  DIM      8         8       29   Old U/R Number (for CMR message)
.CSALIAS   FORM     1         2       37   Alias Status
.PTCGDATE  DIM      8         8       39   Effective Date
.PTITL     DIM      4         4       47   PATIENT TITLE
.PHOSP     FORM     1         2       51   HOSPITAL LAST 12 MONTHS
.                                            1-YES,2-NO
.PLDAYS    FORM     3         3       53   NO DAYS LAST IN HOSPITAL
.PBDEBT    FORM     1         2       56   BAD DEBTOR INDICATOR 0-NO 1-YES
.PSNAME    DIM     20        20       58   PATIENT SURNAME
.PGNAME    DIM     25        25       78   PATIENTS GIVEN NAMES
.PPSNAME   DIM     19        19      103   PATIENTS PREVIOUS SURNAME
.PADD1     DIM     35        35      122   PATIENT ADDRESS LINE 1
.PADD2     DIM     35        35      157   PATIENT ADDRESS LINE 2
.PSUBRB    DIM     35        35      192   PATIENT ADDRESS LINE 3
.PADD4     DIM     35        35      227   PATIENT ADDRESS LINE 4
.PPOST     DIM      8         8      262   PATIENT POSTCODE
.PTELEP    DIM     20        20      270   TELEPHONE PRIVATE
.PTELEB    DIM     20        20      290   TELEPHONE BUSINESS
.PSEX      DIM      1         1      310   PATIENTS SEX
.PMSTAT    DIM      3         3      311   PATIENTS MARTIAL STATUS (Cat M)
.PBDATE    DIM      8         8      314   date of birth         (ccyymmdd)
.PCONT     DIM      3         3      322   COUNTRY OF BIRTH (Cat C)
.PREG      DIM      3         3      325   PATIENTS RELIGION (Cat R)
.PTYPE     DIM      3         3      328   PATIENTS TYPE (Cat T)
.POCCUP    DIM     14        14      331   PATIENTS OCCUPATION
.PLDDATE   DIM      8         8      345   last discharge date   (ccyymmdd)
.PMEDI     DIM     10        10      353   MEDICARE NUMBER
.PPENNO    DIM     15        15      363   PENSION NUMBER
.PPNDTE    DIM      6         6      378   pension no expiry date  (ccyymm)
.PREPAT    DIM     10        10      384   REPATRIATION NUMBER
.PSMOK     FORM     1         2      394   PATIENT SMOKER
.PMICRO    DIM     20        20      396   MICROFILM ADDRESS
.                                          1 -  6  U.R. NO.
.                                          7 - 10  ROLL NO.
.                                          11 - 14  POSITION NO.
.                                          15 - 16  YEAR
.PCEASE    FORM     1         2      416   DESEASED INDICATOR
.                                          0 = NO
.                                          1 = YES
.PCASE     FORM     1         2      418   CASE NOTES INDICATOR
.PAUTOPY   FORM     1         2      420   AUTOPSY INDICATOR
.                                          0 = NO
.                                          1 = YES
.PHIGH1    DIM      3         3      422   HIGHLIGHT CODE 1 (Cat H1)
.PHIGH2    DIM      3         3      425   HIGHLIGHT CODE 2 (Cat H2)
.PHIGH3    DIM      3         3      428   HIGHLIGHT CODE 3 (Cat H3)
.PLOCDOC   DIM     30        30      431   LOCAL DOCTOR
.PFUNDH    DIM      6         6      461   HEALTH FUND
.PFNDTB    DIM      8         8      467   HEALTH FUND TABLE
.PFNDMM    DIM     10        10      475   FUND MEMBERSHIP NUMBER
.PUSR1     DIM      3         3      485   USER DEFINED FIELD 1 (Cat P1)
.PUSR2     DIM      3         3      488   USER DEFINED FIELD 2 (Cat P2)
.PUSR3     DIM      3         3      491   USER DEFINED FIELD 3 (Cat P3)
.PUSR4     DIM      3         3      494   USER DEFINED FIELD 4 (Cat P4)
.PUSR5     DIM      3         3      497   USER DEFINED FIELD 5 (Cat P5)
.PUSR6     DIM      3         3      500   USER DEFINED FIELD 6 (Cat P6)
.PUYN1     FORM     1         2      503   USER DEFINED Y/N FIELD 1
.                                          (1=Y,0=N)
.PUYN2     FORM     1         2      505   USER DEFINED Y/N FIELD 2
.                                          (1=Y,0=N)
.PUYN3     FORM     1         2      507   USER DEFINED Y/N FIELD 3
.                                          (1=Y,0=N)
.PYRRES    FORM     2         2      509   NUMBER OF YEARS RESIDENT
.PNKNAME   DIM     20        20      511   NEXT OF KIN 1 NAME
.PNKADD1   DIM     35        35      531   N.O.K 1 ADDRESS LINE 1
.PNKADD2   DIM     35        35      566   N.O.K 1 ADDRESS LINE 2
.PNKSUBR   DIM     35        35      601   N.O.K 1 ADDRESS LINE 3
.PNKADD4   DIM     35        35      636   N.O.K 1 ADDRESS LINE 4
.PNKPOST   DIM      8         8      671   N.O.K 1 POSTCODE
.PNKTELP   DIM     20        20      679   N.O.K 1 PRIVATE TELEPHONE
.PNKTELB   DIM     20        20      699   N.O.K 1 BUSINESS TELEPHONE
.PNKRELP   DIM     10        10      719   N.O.K 1 RELATIONSHIP
.PFNDYY    DIM      2         2      729   YRS OF FUND MEMBERSHIP (JR,DE)
.PFNDCG    DIM      6         6      731   fund cover change       (ccyymm)
.PDECDTE   DIM      8         8      737   date of death         (ccyymmdd)
.PDIET     DIM      3         3      745   DEFAULT DIET CODE (Cat DC)
.PINITHOS  DIM      2         2      748   HOSPITAL U/R INITIATED FROM
.PHKADUNI  DIM     10        10      750   HONG KONG UNIQUE ADDRESS ID
.PTMAEMPC  DIM      6         6      760   PATIENT EMPLOYER CODE
.PTMANOKO  DIM     14        14      766   NEXT OF KIN OCCUPATION
.PTMANOKE  DIM      6         6      780   NEXT OF KIN EMPLOYER CODE
.PTMADCNO  DIM     10        10      786   DEATH CERTIFICATE NUMBER
.
.          PATMX1FD variables
.
.PTMXRDAT  DIM      8         8      796   Registration Date
.PTMXMEAL  DIM     30        30      804   Special Meal Requirements
.PTMXLGA   DIM      4         4      834   LGA Code
.PTMXLS    DIM      3         3      838   Current Legal status (Cat LS)
.PTMXLSDT  DIM      8         8      841   Date of legal status (ccyymmdd)
.PTMXFHMD  DIM      1         1      849   Familial history of mental disorder ?
.                                            1 = Yes ; 2 = No
.PTMXMHU1  DIM      3         3      850   M.H. User defined field 1 (Cat V6)
.PTMXMHU2  DIM      3         3      853   M.H. User defined field 2 (Cat V7)
.PTMXMHU3  DIM      3         3      856   M.H. User defined field 3 (Cat V8)
.PTMXECNM  DIM     20        20      859   Emergency contact name
.PTMXECA1  DIM     35        35      879   Emergency contact address line 1
.PTMXECA2  DIM     35        35      914   Emergency contact address line 2
.PTMXECA3  DIM     35        35      949   Emergency contact address line 3
.PTMXECA4  DIM     35        35      984   Emergency contact address line 4
.PTMXECPC  DIM      8         8     1019   Emergency contact postcode
.PTMXECPP  DIM     20        20     1027   Emergency contact private phone
.PTMXECBP  DIM     20        20     1047   Emergency contact business phone
.PTMXECRE  DIM     10        10     1067   Emergency contact relationship
.PTMXNRNM  DIM     20        20     1077   Nearest relative name
.PTMXNRA1  DIM     35        35     1097   Nearest relative address line 1
.PTMXNRA2  DIM     35        35     1132   Nearest relative address line 2
.PTMXNRA3  DIM     35        35     1167   Nearest relative address line 3
.PTMXNRA4  DIM     35        35     1202   Nearest relative address line 4
.PTMXNRPC  DIM      8         8     1237   Nearest relative postcode
.PTMXNRPP  DIM     20        20     1245   Nearest relative private phone
.PTMXNRBP  DIM     20        20     1265   Nearest relative business phone
.PTMXNRRE  DIM     10        10     1285   Nearest relative relationship
.PTMX3BEX  DIM      8         8     1295   3B certificate expiry date
.PTMXCARD  DIM     20        20     1303   Card number (NZ billing)
.PTMXCEXP  DIM      8         8     1323   Card expiry date (NZ billing)
.PTMXCXMP  DIM      3         3     1331   Card exemption type (Cat XM)
.PTMXFMLY  DIM     12        12     1334   Family id
.PTMXCHNM  DIM     20        20     1346   Chinese Name
.PTMXDOFR  DIM      3         3     1366   District of Residence (Cat DA)
.PTMXREGP  DIM      8         8     1369   Registered GP
.PTMXGPPC  DIM      6         6     1377   GP Practice Code
.PTMXSPID  DIM     20        20     1383   Supplementary Id
.PTMXGPPT  DIM      2         2     1403   GP Practice count
.PTMXOSDT  DIM      8         8     1405   Date Arrived from Overseas (CCYYMMDD)
.
.         PATNIDFD variables
.
.PTNINMPI  DIM     20        20     1413   National ID No. (right justified)
.
.         NHIMASFD variables
.
.NHMASURN  DIM     25        25     1433   Surname
.NHMAGIV1  DIM     20        20     1458   Given Name 1
.NHMAGIV2  DIM     20        20     1478   Given Name 2
.NHMAGIV3  DIM     20        20     1498   Given Name 3
.NHMAPREI  DIM      1         1     1518   Preferred Name Indicator (1-3)
.NHMAADD1  DIM     35        35     1519   Address Line 1
.NHMAADD2  DIM     30        30     1554   Address Line 2
.NHMAADD3  DIM     30        30     1584   Suburb
.NHMAADD4  DIM     30        30     1614   City/Town
.NHMAADD5  DIM     30        30     1644   Country
.NHMADOB   DIM      8         8     1674   Date of Birth
.NHMADDTH  DIM      8         8     1682   Date of Death
.NHMADOMC  DIM      4         4     1690   Domicile Code
.NHMARES   DIM      1         1     1694   Residence Status (Y/N)
.NHMAETH   DIM      2         2     1695   Ethnicity
.NHMASEX   DIM      1         1     1697   Gender
.NHMADAT   DIM      8         8     1698   Date Last Updated
.NHMATIM   DIM      8         8     1706   Time Last Updated
.NHMAETH2  DIM      2         2     1714   2nd Ethnicity
.NHMAETH3  DIM      2         2     1716   3rd Ethnicity
.
.         more PATMX1FD variables
.
.PTMXOPER  DIM      4         4     1718   Sec. Code Operator who Created Record
.PTMXUKDO  DIM      1         1     1722   Unknown Date Arrived from O/S (Y/N)
.PTMXCELL  DIM     20        20     1723   Cellular Phone Number
.PTMXADD1  DIM     35        35     1743   Postal Address Line 1
.PTMXADD2  DIM     35        35     1778   Postal Address Line 2
.PTMXADD3  DIM     35        35     1813   Postal Address Line 3
.PTMXADD4  DIM     35        35     1848   Postal Address Line 4
.PTMXPOST  DIM      8         8     1883   Postal Address Post Code
.
.         PMSPX2FD variables
.
.PMPXINTR  DIM      1         1     1891   Interpreter Required? (0=NO,1=YES)
.PMPXLNG1  DIM      3         3     1892   Preferred Language 1 (Cat LA)
.PMPXLNG2  DIM      3         3     1895   Preferred Language 2 (Cat LA)
.PMPXLNG3  DIM      3         3     1898   Preferred Language 3 (Cat LA)
.PMPXPEML  DIM     80        80     1901   Patient's Email Address
.PMPXEDOB  DIM      1         1     1981   Date of Birth Estimated? 0=NO,1=YES
.PMPXCMOB  DIM     20        20     1982   Emergency Contact Mobile Number
.PMPXCEML  DIM     80        80     2002   Emergency Contact Email Address
.PMPXCCRP  DIM      1         1     2082   Emer. Contact Corres. (0=NO,1=YES)
.PMPXKMOB  DIM     20        20     2083   NOK Mobile Number
.PMPXKEML  DIM     80        80     2103   NOK Email Address
.PMPXKCRP  DIM      1         1     2183   NOK Correspondence (0=NO,1=YES)
.PMPXRMOB  DIM     20        20     2184   Nearest Relative Mobile Number
.PMPXREML  DIM     80        80     2204   Nearest Relative Email Address
.PMPXRCRP  DIM      1         1     2284   Nearest Relative Corres. 0=NO,1=YES
.PMPXMEDC  DIM      8         8     2285   Medicare Card Valid to (CCYYMMDD)
.PMPXDETY  DIM      3         3     2293   Death Type (Cat DY)
.PMPXPRIS  DIM     15        15     2296   PRISM Number
.PMPXCSER  DIM     15        15     2311   Correctional Services Number
.PMPXPHEI  FORM     6         4     2326   Patient Height
.PMPXPWEI  FORM     6         4     2330   Patient Weight
.PMPXDREC  DIM      8         8     2334   Date Weight & Height Rec.(CCYYMMDD)
.PMPXDVAC  DIM      3         3     2342   DVA Card Colour (Cat DX)
.PMPXPNSD  DIM      8         8     2345   Pension Start Date (CCYYMMDD)
.PMPXUYN4  DIM      1         1     2353   User Defined Y/N field 4 0=NO,1=YES
.PMPXUYN5  DIM      1         1     2354   User Defined Y/N field 5 0=NO,1=YES
.PMPXUYN6  DIM      1         1     2355   User Defined Y/N field 6 0=NO,1=YES
.PMPXABRG  DIM      3         3     2356   Aboriginality (Cat VA)
.PMPXPRVI  DIM      3         3     2359   Privacy Indicator (Cat PV)
.PMPXCRIN  DIM      1         1     2362   Consent Release of Info? 0=NO,1=YES
.PMPXHOML  DIM      1         1     2363   Homeless? (0=NO,1=YES)
.PMPXUDC1  DIM     50        50     2364   User Defined Comments 1
.PMPXUDC2  DIM     50        50     2414   User Defined Comments 2
.PMPXUDC3  DIM     50        50     2464   User Defined Comments 3
.PMPXUSR7  DIM      3         3     2514   User Defined 7 (Category P7)
.PMPXUSR8  DIM      3         3     2517   User Defined 8 (Category P8)
.PMPXUSR9  DIM      3         3     2520   User Defined 9 (Category P9)
.PMPXMSNA  DIM     20        20     2523   Mother's Surname
.PMPXMGNA  DIM     25        25     2543   Mother's Given Name
.PMPXMTLE  DIM      4         4     2568   Mother's Title
.PMPXMAD1  DIM     35        35     2572   Mother's Address Line 1
.PMPXMAD2  DIM     35        35     2607   Mother's Address Line 2
.PMPXMAD3  DIM     35        35     2642   Mother's Address Line 3
.PMPXMAD4  DIM     35        35     2677   Mother's Address Line 4
.PMPXMPOS  DIM      8         8     2712   Mother's Address Post Code
.PMPXMPNO  DIM     20        20     2720   Mother's Private Number
.PMPXMBNO  DIM     20        20     2740   Mother's Business Number
.PMPXMMNO  DIM     20        20     2760   Mother's Mobile Number
.PMPXMEML  DIM     80        80     2780   Mother's Email Address
.PMPXMCNT  DIM      3         3     2860   Mother's Country of Birth (Cat C)
.PMPXMCRP  DIM      1         1     2863   Mother's Correspondence  0=NO,1=YES
.PMPXMLAB  DIM      1         1     2864   Mother's Name on Labels  0=NO,1=YES
.PMPXMREL  DIM     10        10     2865   Relationship to Patient
.PMPXFSNA  DIM     20        20     2875   Father's Surname
.PMPXFGNA  DIM     25        25     2895   Father's Given Name
.PMPXFTLE  DIM      4         4     2920   Father's Title
.PMPXFAD1  DIM     35        35     2924   Father's Address Line 1
.PMPXFAD2  DIM     35        35     2959   Father's Address Line 2
.PMPXFAD3  DIM     35        35     2994   Father's Address Line 3
.PMPXFAD4  DIM     35        35     3029   Father's Address Line 4
.PMPXFPOS  DIM      8         8     3064   Father's Address Post Code
.PMPXFPNO  DIM     20        20     3072   Father's Private Number
.PMPXFBNO  DIM     20        20     3092   Father's Business Number
.PMPXFMNO  DIM     20        20     3112   Father's Mobile Number
.PMPXFEML  DIM     80        80     3132   Father's Email Address
.PMPXFCNT  DIM      3         3     3212   Father's Country of Birth (Cat C)
.PMPXFCRP  DIM      1         1     3215   Father's Correspondence 0=NO,1=YES
.PMPXFLAB  DIM      1         1     3216   Father's Name on Labels 0=NO,1=YES
.PMPXFREL  DIM     10        10     3217   Relationship to Patient
.PTMXMCCD  DIM      2         2     3227   Medicare Code
.PMPXRHC1  DIM     10        10     3229   Registered HCP 1
.PMPXRH1G  DIM     10        10     3239   Registered HCP Practice 1
.PMPXR1GC  DIM      2         2     3249   Registered HCP Practice Count 1
.PMQPSPAR  DIM     49        49     3251   Spare Variable
.
.End of Record                      3300
.
.                                     ******** copy the new FD here *******
.
PMSQPTA1   IFILE SQL, FIXED=3380, KEY="U1-20"
PMSQPTA2   IFILE SQL, FIXED=3380, KEY="U21-28,1-20"
.
.Name      Type    Length Physical Start   Description
.----      ----    ------ -------- -----   -----------
DPMQPMES  DIM     20        20        1   Message Id
.
.          PATMA1FD variables
.
PURNO     DIM      8         8       21   PATIENT U.R NO.
PMQPOURN  DIM      8         8       29   Old U/R Number (for CMR message)
CSALIAS   FORM     1         2       37   Alias Status
PTCGDATE  DIM      8         8       39   Effective Date
PTITL     DIM      4         4       47   PATIENT TITLE
PHOSP     FORM     1         2       51   HOSPITAL LAST 12 MONTHS
.                                            1-YES,2-NO
PLDAYS    FORM     3         3       53   NO DAYS LAST IN HOSPITAL
PBDEBT    FORM     1         2       56   BAD DEBTOR INDICATOR 0-NO 1-YES
PSNAME    DIM     20        20       58   PATIENT SURNAME
PGNAME    DIM     25        25       78   PATIENTS GIVEN NAMES
PPSNAME   DIM     19        19      103   PATIENTS PREVIOUS SURNAME
PADD1     DIM     35        35      122   PATIENT ADDRESS LINE 1
PADD2     DIM     35        35      157   PATIENT ADDRESS LINE 2
PSUBRB    DIM     35        35      192   PATIENT ADDRESS LINE 3
PADD4     DIM     35        35      227   PATIENT ADDRESS LINE 4
PPOST     DIM      8         8      262   PATIENT POSTCODE
PTELEP    DIM     20        20      270   TELEPHONE PRIVATE
PTELEB    DIM     20        20      290   TELEPHONE BUSINESS
PSEX      DIM      1         1      310   PATIENTS SEX
PMSTAT    DIM      3         3      311   PATIENTS MARTIAL STATUS (Cat M)
PBDATE    DIM      8         8      314   date of birth         (ccyymmdd)
PCONT     DIM      3         3      322   COUNTRY OF BIRTH (Cat C)
PREG      DIM      3         3      325   PATIENTS RELIGION (Cat R)
PTYPE     DIM      3         3      328   PATIENTS TYPE (Cat T)
POCCUP    DIM     14        14      331   PATIENTS OCCUPATION
PLDDATE   DIM      8         8      345   last discharge date   (ccyymmdd)
PMEDI     DIM     10        10      353   MEDICARE NUMBER
PPENNO    DIM     15        15      363   PENSION NUMBER
PPNDTE    DIM      6         6      378   pension no expiry date  (ccyymm)
PREPAT    DIM     10        10      384   REPATRIATION NUMBER
PSMOK     FORM     1         2      394   PATIENT SMOKER
PMICRO    DIM     20        20      396   MICROFILM ADDRESS
.                                          1 -  6  U.R. NO.
.                                          7 - 10  ROLL NO.
.                                          11 - 14  POSITION NO.
.                                          15 - 16  YEAR
PCEASE    FORM     1         2      416   DESEASED INDICATOR
.                                          0 = NO
.                                          1 = YES
PCASE     FORM     1         2      418   CASE NOTES INDICATOR
PAUTOPY   FORM     1         2      420   AUTOPSY INDICATOR
.                                          0 = NO
.                                          1 = YES
PHIGH1    DIM      3         3      422   HIGHLIGHT CODE 1 (Cat H1)
PHIGH2    DIM      3         3      425   HIGHLIGHT CODE 2 (Cat H2)
PHIGH3    DIM      3         3      428   HIGHLIGHT CODE 3 (Cat H3)
PLOCDOC   DIM     30        30      431   LOCAL DOCTOR
PFUNDH    DIM      6         6      461   HEALTH FUND
PFNDTB    DIM      8         8      467   HEALTH FUND TABLE
PFNDMM    DIM     10        10      475   FUND MEMBERSHIP NUMBER
PUSR1     DIM      3         3      485   USER DEFINED FIELD 1 (Cat P1)
PUSR2     DIM      3         3      488   USER DEFINED FIELD 2 (Cat P2)
PUSR3     DIM      3         3      491   USER DEFINED FIELD 3 (Cat P3)
PUSR4     DIM      3         3      494   USER DEFINED FIELD 4 (Cat P4)
PUSR5     DIM      3         3      497   USER DEFINED FIELD 5 (Cat P5)
PUSR6     DIM      3         3      500   USER DEFINED FIELD 6 (Cat P6)
PUYN1     FORM     1         2      503   USER DEFINED Y/N FIELD 1
.                                          (1=Y,0=N)
PUYN2     FORM     1         2      505   USER DEFINED Y/N FIELD 2
.                                          (1=Y,0=N)
PUYN3     FORM     1         2      507   USER DEFINED Y/N FIELD 3
.                                          (1=Y,0=N)
PYRRES    FORM     2         2      509   NUMBER OF YEARS RESIDENT
PNKNAME   DIM     20        20      511   NEXT OF KIN 1 NAME
PNKADD1   DIM     35        35      531   N.O.K 1 ADDRESS LINE 1
PNKADD2   DIM     35        35      566   N.O.K 1 ADDRESS LINE 2
PNKSUBR   DIM     35        35      601   N.O.K 1 ADDRESS LINE 3
PNKADD4   DIM     35        35      636   N.O.K 1 ADDRESS LINE 4
PNKPOST   DIM      8         8      671   N.O.K 1 POSTCODE
PNKTELP   DIM     20        20      679   N.O.K 1 PRIVATE TELEPHONE
PNKTELB   DIM     20        20      699   N.O.K 1 BUSINESS TELEPHONE
PNKRELP   DIM     10        10      719   N.O.K 1 RELATIONSHIP
PFNDYY    DIM      2         2      729   YRS OF FUND MEMBERSHIP (JR,DE)
PFNDCG    DIM      6         6      731   fund cover change       (ccyymm)
PDECDTE   DIM      8         8      737   date of death         (ccyymmdd)
PDIET     DIM      3         3      745   DEFAULT DIET CODE (Cat DC)
PINITHOS  DIM      2         2      748   HOSPITAL U/R INITIATED FROM
PHKADUNI  DIM     10        10      750   HONG KONG UNIQUE ADDRESS ID
PTMAEMPC  DIM      6         6      760   PATIENT EMPLOYER CODE
PTMANOKO  DIM     14        14      766   NEXT OF KIN OCCUPATION
PTMANOKE  DIM      6         6      780   NEXT OF KIN EMPLOYER CODE
PTMADCNO  DIM     10        10      786   DEATH CERTIFICATE NUMBER
.
.          PATMX1FD variables
.
PTMXRDAT  DIM      8         8      796   Registration Date
PTMXMEAL  DIM     30        30      804   Special Meal Requirements
PTMXLGA   DIM      4         4      834   LGA Code
PTMXLS    DIM      3         3      838   Current Legal status (Cat LS)
PTMXLSDT  DIM      8         8      841   Date of legal status (ccyymmdd)
PTMXFHMD  DIM      1         1      849   Familial history of mental disorder ?
.                                            1 = Yes ; 2 = No
PTMXMHU1  DIM      3         3      850   M.H. User defined field 1 (Cat V6)
PTMXMHU2  DIM      3         3      853   M.H. User defined field 2 (Cat V7)
PTMXMHU3  DIM      3         3      856   M.H. User defined field 3 (Cat V8)
PTMXECNM  DIM     20        20      859   Emergency contact name
PTMXECA1  DIM     35        35      879   Emergency contact address line 1
PTMXECA2  DIM     35        35      914   Emergency contact address line 2
PTMXECA3  DIM     35        35      949   Emergency contact address line 3
PTMXECA4  DIM     35        35      984   Emergency contact address line 4
PTMXECPC  DIM      8         8     1019   Emergency contact postcode
PTMXECPP  DIM     20        20     1027   Emergency contact private phone
PTMXECBP  DIM     20        20     1047   Emergency contact business phone
PTMXECRE  DIM     10        10     1067   Emergency contact relationship
PTMXNRNM  DIM     20        20     1077   Nearest relative name
PTMXNRA1  DIM     35        35     1097   Nearest relative address line 1
PTMXNRA2  DIM     35        35     1132   Nearest relative address line 2
PTMXNRA3  DIM     35        35     1167   Nearest relative address line 3
PTMXNRA4  DIM     35        35     1202   Nearest relative address line 4
PTMXNRPC  DIM      8         8     1237   Nearest relative postcode
PTMXNRPP  DIM     20        20     1245   Nearest relative private phone
PTMXNRBP  DIM     20        20     1265   Nearest relative business phone
PTMXNRRE  DIM     10        10     1285   Nearest relative relationship
PTMX3BEX  DIM      8         8     1295   3B certificate expiry date
PTMXCARD  DIM     20        20     1303   Card number (NZ billing)
PTMXCEXP  DIM      8         8     1323   Card expiry date (NZ billing)
PTMXCXMP  DIM      3         3     1331   Card exemption type (Cat XM)
PTMXFMLY  DIM     12        12     1334   Family id
PTMXCHNM  DIM     20        20     1346   Chinese Name
PTMXDOFR  DIM      3         3     1366   District of Residence (Cat DA)
PTMXREGP  DIM      8         8     1369   Registered GP
PTMXGPPC  DIM      6         6     1377   GP Practice Code
PTMXSPID  DIM     20        20     1383   Supplementary Id
PTMXGPPT  DIM      2         2     1403   GP Practice count
PTMXOSDT  DIM      8         8     1405   Date Arrived from Overseas (CCYYMMDD)
.
.         PATNIDFD variables
.
PTNINMPI  DIM     20        20     1413   National ID No. (right justified)
.
.         NHIMASFD variables
.
NHMASURN  DIM     25        25     1433   Surname
NHMAGIV1  DIM     20        20     1458   Given Name 1
NHMAGIV2  DIM     20        20     1478   Given Name 2
NHMAGIV3  DIM     20        20     1498   Given Name 3
NHMAPREI  DIM      1         1     1518   Preferred Name Indicator (1-3)
NHMAADD1  DIM     35        35     1519   Address Line 1
NHMAADD2  DIM     30        30     1554   Address Line 2
NHMAADD3  DIM     30        30     1584   Suburb
NHMAADD4  DIM     30        30     1614   City/Town
NHMAADD5  DIM     30        30     1644   Country
NHMADOB   DIM      8         8     1674   Date of Birth
NHMADDTH  DIM      8         8     1682   Date of Death
NHMADOMC  DIM      4         4     1690   Domicile Code
NHMARES   DIM      1         1     1694   Residence Status (Y/N)
NHMAETH   DIM      2         2     1695   Ethnicity
NHMASEX   DIM      1         1     1697   Gender
NHMADAT   DIM      8         8     1698   Date Last Updated
NHMATIM   DIM      8         8     1706   Time Last Updated
NHMAETH2  DIM      2         2     1714   2nd Ethnicity
NHMAETH3  DIM      2         2     1716   3rd Ethnicity
.
.         more PATMX1FD variables
.
PTMXOPER  DIM      4         4     1718   Sec. Code Operator who Created Record
PTMXUKDO  DIM      1         1     1722   Unknown Date Arrived from O/S (Y/N)
PTMXCELL  DIM     20        20     1723   Cellular Phone Number
PTMXADD1  DIM     35        35     1743   Postal Address Line 1
PTMXADD2  DIM     35        35     1778   Postal Address Line 2
PTMXADD3  DIM     35        35     1813   Postal Address Line 3
PTMXADD4  DIM     35        35     1848   Postal Address Line 4
PTMXPOST  DIM      8         8     1883   Postal Address Post Code
.
.         PMSPX2FD variables
.
PMPXINTR  DIM      1         1     1891   Interpreter Required? (0=NO,1=YES)
PMPXLNG1  DIM      3         3     1892   Preferred Language 1 (Cat LA)
PMPXLNG2  DIM      3         3     1895   Preferred Language 2 (Cat LA)
PMPXLNG3  DIM      3         3     1898   Preferred Language 3 (Cat LA)
PMPXPEML  DIM     80        80     1901   Patient's Email Address
PMPXEDOB  DIM      1         1     1981   Date of Birth Estimated? 0=NO,1=YES
PMPXCMOB  DIM     20        20     1982   Emergency Contact Mobile Number
PMPXCEML  DIM     80        80     2002   Emergency Contact Email Address
PMPXCCRP  DIM      1         1     2082   Emer. Contact Corres. (0=NO,1=YES)
PMPXKMOB  DIM     20        20     2083   NOK Mobile Number
PMPXKEML  DIM     80        80     2103   NOK Email Address
PMPXKCRP  DIM      1         1     2183   NOK Correspondence (0=NO,1=YES)
PMPXRMOB  DIM     20        20     2184   Nearest Relative Mobile Number
PMPXREML  DIM     80        80     2204   Nearest Relative Email Address
PMPXRCRP  DIM      1         1     2284   Nearest Relative Corres. 0=NO,1=YES
PMPXMEDC  DIM      8         8     2285   Medicare Card Valid to (CCYYMMDD)
PMPXDETY  DIM      3         3     2293   Death Type (Cat DY)
PMPXPRIS  DIM     15        15     2296   PRISM Number
PMPXCSER  DIM     15        15     2311   Correctional Services Number
PMPXPHEI  FORM     6         4     2326   Patient Height
PMPXPWEI  FORM     6         4     2330   Patient Weight
PMPXDREC  DIM      8         8     2334   Date Weight & Height Rec.(CCYYMMDD)
PMPXDVAC  DIM      3         3     2342   DVA Card Colour (Cat DX)
PMPXPNSD  DIM      8         8     2345   Pension Start Date (CCYYMMDD)
PMPXUYN4  DIM      1         1     2353   User Defined Y/N field 4 0=NO,1=YES
PMPXUYN5  DIM      1         1     2354   User Defined Y/N field 5 0=NO,1=YES
PMPXUYN6  DIM      1         1     2355   User Defined Y/N field 6 0=NO,1=YES
PMPXABRG  DIM      3         3     2356   Aboriginality (Cat VA)
PMPXPRVI  DIM      3         3     2359   Privacy Indicator (Cat PV)
PMPXCRIN  DIM      1         1     2362   Consent Release of Info? 0=NO,1=YES
PMPXHOML  DIM      1         1     2363   Homeless? (0=NO,1=YES)
PMPXUDC1  DIM     50        50     2364   User Defined Comments 1
PMPXUDC2  DIM     50        50     2414   User Defined Comments 2
PMPXUDC3  DIM     50        50     2464   User Defined Comments 3
PMPXUSR7  DIM      3         3     2514   User Defined 7 (Category P7)
PMPXUSR8  DIM      3         3     2517   User Defined 8 (Category P8)
PMPXUSR9  DIM      3         3     2520   User Defined 9 (Category P9)
PMPXMSNA  DIM     20        20     2523   Mother's Surname
PMPXMGNA  DIM     25        25     2543   Mother's Given Name
PMPXMTLE  DIM      4         4     2568   Mother's Title
PMPXMAD1  DIM     35        35     2572   Mother's Address Line 1
PMPXMAD2  DIM     35        35     2607   Mother's Address Line 2
PMPXMAD3  DIM     35        35     2642   Mother's Address Line 3
PMPXMAD4  DIM     35        35     2677   Mother's Address Line 4
PMPXMPOS  DIM      8         8     2712   Mother's Address Post Code
PMPXMPNO  DIM     20        20     2720   Mother's Private Number
PMPXMBNO  DIM     20        20     2740   Mother's Business Number
PMPXMMNO  DIM     20        20     2760   Mother's Mobile Number
PMPXMEML  DIM     80        80     2780   Mother's Email Address
PMPXMCNT  DIM      3         3     2860   Mother's Country of Birth (Cat C)
PMPXMCRP  DIM      1         1     2863   Mother's Correspondence  0=NO,1=YES
PMPXMLAB  DIM      1         1     2864   Mother's Name on Labels  0=NO,1=YES
PMPXMREL  DIM     10        10     2865   Relationship to Patient
PMPXFSNA  DIM     20        20     2875   Father's Surname
PMPXFGNA  DIM     25        25     2895   Father's Given Name
PMPXFTLE  DIM      4         4     2920   Father's Title
PMPXFAD1  DIM     35        35     2924   Father's Address Line 1
PMPXFAD2  DIM     35        35     2959   Father's Address Line 2
PMPXFAD3  DIM     35        35     2994   Father's Address Line 3
PMPXFAD4  DIM     35        35     3029   Father's Address Line 4
PMPXFPOS  DIM      8         8     3064   Father's Address Post Code
PMPXFPNO  DIM     20        20     3072   Father's Private Number
PMPXFBNO  DIM     20        20     3092   Father's Business Number
PMPXFMNO  DIM     20        20     3112   Father's Mobile Number
PMPXFEML  DIM     80        80     3132   Father's Email Address
PMPXFCNT  DIM      3         3     3212   Father's Country of Birth (Cat C)
PMPXFCRP  DIM      1         1     3215   Father's Correspondence 0=NO,1=YES
PMPXFLAB  DIM      1         1     3216   Father's Name on Labels 0=NO,1=YES
PMPXFREL  DIM     10        10     3217   Relationship to Patient
PTMXMCCD  DIM      2         2     3227   Medicare Code
PMPXRHC1  DIM     10        10     3229   Registered HCP 1
PMPXRH1G  DIM     10        10     3239   Registered HCP Practice 1
PMPXR1GC  DIM      2         2     3249   Registered HCP Practice Count 1
PMPXFNAM  DIM     40        40     3251   Patient First Name
PMPXSNAM  DIM     40        40     3291   Patient Second Name
PMQPSPAR  DIM     49        49     3331   Spare Variable
.
.End of Record                      3380
.
. Redefine form fields from key
. -----------------------------
PMQPMESI  FORM      20
.
CMDLINE   DIM       100
DIM4      DIM       4
DIM4A     DIM       4
DIM6      DIM       6
DIM6A     DIM       6
DIM60     DIM       60
DDCENT    DIM       2
.
RECNUM    FORM      8
NEWFILE   DIM       60
NEWPATH   DIM       60
OLDPATH   DIM       60
DEFPATH   DIM       60
SAVEFLG   FORM      1
SP50      INIT    "                                                  "
SP60      INIT    "                                                            "
.
PRGNAM    INIT      "CONVERSION PMSQPTFD"
PRGID     INIT      "F11PMQPT"
VERSION   INIT      "V12.00.00"
.
. Start of Program
.
MAIN0000  CALL      INIT0000                      * init and open files
          BRANCH    EXIT,MAIN9999                 * init failure
.
          CALL      KDIR0000                      * Keyin directory
          BRANCH    EXIT,MAIN9999
.
          CALL      CONTQST                       * Ok to continue ?
          BRANCH    CEXIT,MAIN1000,MAIN0000,MAIN9999 * Yes, no, cancel
.
MAIN1000  CALL      PREP0000                      * preparing files
          BRANCH    EXIT,MAIN9999
.
. Loop thru old file and write records to new file
.
          CALL      READ0000                      * read old records and write
          CALL      ENDP0000                      * save/compress saved file
.
MAIN9999  CHAIN     PGM
+
.********************************************************************
.*                          INIT0000                                *
.*  Display heading and check that the files needed exist&open them *
.********************************************************************
INIT0000  CALL      DISPHEAD
          MOVE      ZERO,RECNUM
          
INIT9999  RETURN
.
.********************************************************************
.*                          KDIR0000                                *
.*  Keyin directories                                               *
.********************************************************************
KDIR0000  MOVE      ONE,SAVEFLG        * Default to keep file
          KEYIN     *P1:10,*EL,"Do you want to save the original file (Y/N) ? ":
                    ANS;
          REP       "yYnN",ANS
          CMATCH    "Y",ANS
          GOTO      KDIR1000 IF EQUAL
          MOVE      ZERO,SAVEFLG       * not to keep file
          CMATCH    "N",ANS
          GOTO      KDIR1000 IF EQUAL
          BEEP
          GOTO      KDIR0000
.
KDIR1000  CALL      DEFT0000                * Get the default path
          BRANCH    EXIT,KDIR9999
          MOVE      SP60,OLDPATH
.
          DISPLAY   *P1:24,*EL,"The directory path must end with a slash (/) ";
.
          MOVE      DEFPATH,OLDPATH
          BRANCH    SAVEFLG,KDIR2000
.
.         Keyin the path for the original file
.
          KEYIN     *P1:12,*EL,"Keyin path for temporarily saving original ":
                    "file: ":
                    *P10:13,*EL,*DV,*RV,OLDPATH:
                    *P10:13,OLDPATH;
          GOTO      KDIR3000
.
KDIR2000  KEYIN     *P1:12,*EL,"Keyin path for saving original file: ":
                    *P10:13,*EL,*DV,*RV,OLDPATH:
                    *P10:13,OLDPATH;
.
KDIR3000  ENDSET    OLDPATH
          APPEND    SP60,OLDPATH
          RESET     OLDPATH
.
          MATCH     SP60,OLDPATH
          IF        @EQUAL
            PACK      OLDPATH,DEFPATH      * use the default
            DISPLAY   *P10:13,*EL,*V2LON,OLDPATH;
          ENDIF
.
          SQUEEZE   OLDPATH
          CMATCH    EXITCHAR,OLDPATH
          GOTO      KDIR9000 IF EQUAL
.
          PACK      DIM60,OLDPATH,SP60
          CALL      VALD0000         * check if it's a valid directory
          BRANCH    EXIT,KDIR1000
.
.         Keyin the path for the new file
.
KDIR5000  MOVE      SP60,NEWPATH
          MOVE      DEFPATH,NEWPATH
          KEYIN     *P1:15,*EL,"Keyin path for the new file: ":
                    *P10:16,*EL,*DV,*RV,NEWPATH:
                    *P10:16,NEWPATH;
          ENDSET    NEWPATH
          APPEND    SP60,NEWPATH
          RESET     NEWPATH
.
          MATCH     SP60,NEWPATH
          IF        @EQUAL
            PACK      NEWPATH,DEFPATH      * use the default
            DISPLAY   *P10:16,*V2LON,NEWPATH;
          ENDIF
.
          SQUEEZE   NEWPATH
          CMATCH    EXITCHAR,NEWPATH
          GOTO      KDIR9000 IF EQUAL
.
          PACK      DIM60,NEWPATH,SP60
          CALL      VALD0000         * check if it's a valid directory
          BRANCH    EXIT,KDIR5000
          GOTO      KDIR9999
.
KDIR9000  MOVE      ONE,EXIT
KDIR9999  DISPLAY   *P1:24,*EL;
          RETURN
+
.
.********************************************************************
.*                          PREP0000                                *
.*  Preparing files                                                 *
.********************************************************************
PREP0000 
. open old file
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      OLDFILE,"pmsqptaf"
          TRAPCLR   IO
          BRANCH    OVRCD,PREP5000       * Original file does not exist
          CLOSE     OLDFILE
          DISPLAY   *P1:24,*EL,"Copying files ... Please wait !! ";
.
. Copy old file to the keyin directory
.
          PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          APPEND    "cp `ldat pmsqptaf.dat` ",CMDLINE
          APPEND    OLDPATH,CMDLINE
          APPEND    "spsqptaf.dat",CMDLINE
          APPEND    SP60,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CMATCH    "0",TASKID
          IF        !@EQUAL
            GOTO      PREP8000
          ENDIF
.
          PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          APPEND    "cp `ldat pmsqptaf.idx` ",CMDLINE
          APPEND    OLDPATH,CMDLINE
          APPEND    "spsqptaf.idx",CMDLINE
          APPEND    SP60,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CMATCH    "0",TASKID
          IF        !@EQUAL
            GOTO      PREP8000
          ENDIF
.
. remove the original files
.
          PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          APPEND    "iserase ",CMDLINE
          APPEND    DEFPATH,CMDLINE
          APPEND    "pmsqptaf",CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CMATCH    "0",TASKID
          IF        !@EQUAL
            DISPLAY   *P1:24,*EL,*B,"Unable to remove the original file.  ";
            CALL      HITENTER
            GOTO      PREP9000
          ENDIF
.
. Opening old file after being copied
.
          MOVE      SP60,DIM60
          CLEAR     DIM60
          APPEND    OLDPATH,DIM60
          APPEND    "spsqptaf",DIM60
          APPEND    SP60,DIM60
          RESET     DIM60
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      OLDFILE,DIM60
          TRAPCLR   IO
          IF        OVRCD = 1
            DISPLAY   *P1:24,*EL,*B,"Unable to open saved original file.  ";
            CALL      HITENTER
            GOTO      PREP9000
          ENDIF
.
. Create the new file
.
          DISPLAY   *P1:24,*EL,"Creating new files ... Please wait !! ";
          PACK      NEWFILE,SP60
          CLEAR     NEWFILE
          APPEND    NEWPATH,NEWFILE
          APPEND    "pmsqptaf",NEWFILE
          APPEND    SP60,NEWFILE
          RESET     NEWFILE
          SQUEEZE   NEWFILE
.
PREP1000  PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          APPEND    "isbuild ",CMDLINE
          APPEND    NEWFILE,CMDLINE
.
.  The files new record length and unique key must be written here
.      eg    APPEND    " 195 UC9-16",CMDLINE
.
          APPEND    " 3380 UC1-20",CMDLINE
          APPEND    SP60,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
.  If the file has more than one index, this piece of code below has 
.  to be repeated with for each individual index
.
           PACK      CMDLINE,SP60,SP60
           CLEAR     CMDLINE
           APPEND    "isadd ",CMDLINE
           APPEND    NEWFILE,CMDLINE
           APPEND    " UC21-28,1-20",CMDLINE
           APPEND    SP60,CMDLINE
           RESET     CMDLINE
           EXECUTE   CMDLINE,TASKID
.
          OPEN      PMSQPTA1,NEWFILE
.
. set the flag to say we want to continue
.
          DISPLAY   *P1:24,*EL;
          MOVE      ZERO,EXIT
          CALL      IBACLOCK
          REP       " 0",CDATE
          DISPLAY   *P1:18,"Started : ",CDATE,SP1,CTIMEIS:
                    *P1:20,"Record : "
          GOTO      PREP9999
.
PREP5000  DISPLAY   *P1:24,*EL,*B,"Old file not found.  ";
          CALL      HITENTER
          GOTO      PREP9000
.
PREP8000  DISPLAY   *P1:24,*EL,*B,"Unable to copy original file.  ":
                    "(Error: ",TASKID,")  ";
          CALL      HITENTER
.
PREP9000  MOVE      ONE,EXIT
PREP9999  RETURN
+
.**********************************************************************
.*                               READ0000                             *
.*             loop thru old file and write each record               *
.**********************************************************************
READ0000  DISPLAY   *P1:20,*EL,"Record No. : ";
          PACK      KEY20,SP60
          CALL      READSOLD                      * position at start
READ1000  CALL      READKOLD                      * read next record
          BRANCH    OVRCD,READ6000                * no more records
          ADD       ONE,RECNUM                    * update record counter
.
.  All necessary changes to the files field lengths, date changes
.  or any other sort of modification must be made here
.
.    eg    PACK      DSPARE,SP50
.          PACK      PTDSDMDC,SP10
.          PACK      PTDSDDRG,SP10
.
          MOVE      SP70,PMPXFNAM
          MOVE      SP70,PMPXSNAM
.                                               * Pack key here
          PACK      KEY20,PMQPMESI,SP70
          CALL      WRPMQPT1                    * write to new file
.
          IF        (RECNUM%1000) = 0
            DISPLAY   *P15:20,*V2LON,RECNUM
          ENDIF
.
          GOTO      READ1000                      * get next record
.
READ6000  CLOSE     PMSQPTA1                      * close new file
          CLOSE     OLDFILE                       * close old file
.
          CALL      IBACLOCK
          REP       " 0",CDATE
          DISPLAY   *P1:22,"Ended  : ",CDATE,SP1,CTIMEIS
.
READ9999  RETURN
.
+
.**********************************************************************
.*                               VALD0000                             *
.*        Check if it a valid directory                               *
.**********************************************************************
VALD0000  MOVE      ZERO,EXIT
          SQUEEZE   DIM60
          ENDSET    DIM60
          CMATCH    SLASH,DIM60
          IF        !@EQUAL
            DISPLAY   *P1:24,*EL,*B,"Directory path must end with a slash (/) ";
            CALL      HITENTER
            GOTO      VALD9000
          ENDIF
          RESET     DIM60
.
          PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          APPEND    "cd ",CMDLINE
          APPEND    DIM60,CMDLINE
          APPEND    SP60,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID      * check if exists
.
          CMATCH    "0",TASKID
          IF        !@EQUAL
            DISPLAY   *P1:24,*EL,*B,"Directory does not exist ";
            CALL      HITENTER
            GOTO      VALD9000
          ENDIF
          GOTO      VALD9999
.
VALD9000  MOVE      ONE,EXIT            * Not valid
VALD9999  RETURN
+
.**********************************************************************
.*                               ENDP0000                             *
.*        Remove or compress save file                                *
.**********************************************************************
ENDP0000  MOVE      SP60,DIM60
          CLEAR     DIM60
          APPEND    OLDPATH,DIM60        * set up the saved file with path
          APPEND    "spsqptaf*",DIM60
          APPEND    SP60,DIM60
          RESET     DIM60
          SQUEEZE   DIM60
.
          PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          IF        SAVEFLG = 1
            APPEND    "compress -f ",CMDLINE
            APPEND    DIM60,CMDLINE
            APPEND    SP60,CMDLINE
            RESET     CMDLINE
            DISPLAY   *P1:24,*EL,"Compressing original file.. ":
                      "Please wait !!  ";
          ELSE
            APPEND    "rm ",CMDLINE
            APPEND    DIM60,CMDLINE
            APPEND    SP60,CMDLINE
            RESET     CMDLINE
            DISPLAY   *P1:24,*EL,"Removing original file.. Please wait !!  ";
          ENDIF
          EXECUTE   CMDLINE,TASKID      * check if exists
.
          CMATCH    "0",TASKID
          IF        !@EQUAL
            DISPLAY   *P1:24,*EL,*B,"Saved file not compressed or removed.  ";
            CALL      HITENTER
            GOTO      ENDP9999
          ENDIF
.
          CALL      IBACLOCK
          DISPLAY   *P1:24,*EL,*B,"Finish processing.  ";
          CALL      HITENTER
.
ENDP9999  RETURN
+
.**********************************************************************
.         Get the default directory
.**********************************************************************
DEFT0000  EXECUTE   "ldat pmsqptaf.dat > temp.txt",TASKID
.
          PACK      DEFPATH,SP30,SP30
          CLOSE     FINDFILE
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      FINDFILE,"temp"
          TRAPCLR   IO
          BRANCH    OVRCD,DEFT3000
.
          READ      FINDFILE,SEQ;DEFPATH
          GOTO      DEFT3000 IF OVER
.
          ENDSET    DEFPATH
DEFT1000  CMATCH    "/",DEFPATH
          GOTO      DEFT2000 IF EQUAL
.
          BUMP      DEFPATH,-1
          GOTO      DEFT1000 IF NOT EOS
          GOTO      DEFT3000
.
DEFT2000  LENSET    DEFPATH
          RESET     DEFPATH
.
          PACK      DEFPATH,DEFPATH,SP30,SP30,SP30,SP30
          STRIP     DEFPATH
          ENDSET    DEFPATH
          RESET     DEFPATH
          CLOSE     FINDFILE
          MOVE      ZERO,EXIT
          GOTO      DEFT9999
.
DEFT3000  DISPLAY   *P1:24,*EL,*B,"Error finding pmsqptaf.  ";
          CALL      HITENTER
          CLOSE     FINDFILE
          MOVE      ONE,EXIT
DEFT9999  RETURN
+
.
.                  ******************************    OLD IO ROUTINES
.                  Copy the Positional Read (RS or RDS) from original I/O file,
.                  - change Label to READSOLD and the index name to OLDFILE
.
.
READSOLD  RESET     KEY20
          READ      OLDFILE,KEY20;;
          RETURN
.
.READSOLD  MOVE      ZERO,OVRCD
.          RESET     KEY6
.          PACK      KEY8,SP2,KEY6
.          READ      OLDFILE,KEY8;;
.          RETURN
.
.                  Copy the Read Next (RK or RDK) from the original I/O file
.                  - change Label to READKOLD and the index name to OLDFILE
.                  - change any fields that are changing to a prefix of OLD,
.                    eg. PTEDSPAR becomes OLDDSPAR
.
READKOLD  MOVE      ZERO,OVRCD
          READKS    OLDFILE;DPMQPMES,PURNO,PMQPOURN,CSALIAS:
                                  PTCGDATE,PTITL,PHOSP,PLDAYS,PBDEBT:
                                  PSNAME,PGNAME,PPSNAME,PADD1,PADD2:
                                  PSUBRB,PADD4,PPOST,PTELEP,PTELEB:
                                  PSEX,PMSTAT,PBDATE,PCONT,PREG:
                                  PTYPE,POCCUP,PLDDATE,PMEDI,PPENNO:
                                  PPNDTE,PREPAT,PSMOK,PMICRO,PCEASE:
                                  PCASE,PAUTOPY,PHIGH1,PHIGH2,PHIGH3:
                                  PLOCDOC,PFUNDH,PFNDTB,PFNDMM,PUSR1:
                                  PUSR2,PUSR3,PUSR4,PUSR5,PUSR6:
                                  PUYN1,PUYN2,PUYN3,PYRRES,PNKNAME:
                                  PNKADD1,PNKADD2,PNKSUBR,PNKADD4,PNKPOST:
                                  PNKTELP,PNKTELB,PNKRELP,PFNDYY,PFNDCG:
                                  PDECDTE,PDIET,PINITHOS,PHKADUNI,PTMAEMPC:
                                  PTMANOKO,PTMANOKE,PTMADCNO,PTMXRDAT,PTMXMEAL:
                                  PTMXLGA,PTMXLS,PTMXLSDT,PTMXFHMD,PTMXMHU1:
                                  PTMXMHU2,PTMXMHU3,PTMXECNM,PTMXECA1,PTMXECA2:
                                  PTMXECA3,PTMXECA4,PTMXECPC,PTMXECPP,PTMXECBP:
                                  PTMXECRE,PTMXNRNM,PTMXNRA1,PTMXNRA2,PTMXNRA3:
                                  PTMXNRA4,PTMXNRPC,PTMXNRPP,PTMXNRBP,PTMXNRRE:
                                  PTMX3BEX,PTMXCARD,PTMXCEXP,PTMXCXMP,PTMXFMLY:
                                  PTMXCHNM,PTMXDOFR,PTMXREGP,PTMXGPPC,PTMXSPID:
                                  PTMXGPPT,PTMXOSDT,PTNINMPI,NHMASURN,NHMAGIV1:
                                  NHMAGIV2,NHMAGIV3,NHMAPREI,NHMAADD1,NHMAADD2:
                                  NHMAADD3,NHMAADD4,NHMAADD5,NHMADOB,NHMADDTH:
                                  NHMADOMC,NHMARES,NHMAETH,NHMASEX,NHMADAT:
                                  NHMATIM,NHMAETH2,NHMAETH3,PTMXOPER,PTMXUKDO:
                                  PTMXCELL,PTMXADD1,PTMXADD2,PTMXADD3,PTMXADD4:
                                  PTMXPOST,PMPXINTR,PMPXLNG1,PMPXLNG2,PMPXLNG3:
                                  PMPXPEML,PMPXEDOB,PMPXCMOB,PMPXCEML,PMPXCCRP:
                                  PMPXKMOB,PMPXKEML,PMPXKCRP,PMPXRMOB,PMPXREML:
                                  PMPXRCRP,PMPXMEDC,PMPXDETY,PMPXPRIS,PMPXCSER:
                                  PMPXPHEI,PMPXPWEI,PMPXDREC,PMPXDVAC,PMPXPNSD:
                                  PMPXUYN4,PMPXUYN5,PMPXUYN6,PMPXABRG,PMPXPRVI:
                                  PMPXCRIN,PMPXHOML,PMPXUDC1,PMPXUDC2,PMPXUDC3:
                                  PMPXUSR7,PMPXUSR8,PMPXUSR9,PMPXMSNA,PMPXMGNA:
                                  PMPXMTLE,PMPXMAD1,PMPXMAD2,PMPXMAD3,PMPXMAD4:
                                  PMPXMPOS,PMPXMPNO,PMPXMBNO,PMPXMMNO,PMPXMEML:
                                  PMPXMCNT,PMPXMCRP,PMPXMLAB,PMPXMREL,PMPXFSNA:
                                  PMPXFGNA,PMPXFTLE,PMPXFAD1,PMPXFAD2,PMPXFAD3:
                                  PMPXFAD4,PMPXFPOS,PMPXFPNO,PMPXFBNO,PMPXFMNO:
                                  PMPXFEML,PMPXFCNT,PMPXFCRP,PMPXFLAB,PMPXFREL:
                                  PTMXMCCD,PMPXRHC1,PMPXRH1G,PMPXR1GC,PMQPSPAR
          GOTO      OVERCOND IF OVER
          MOVE      DPMQPMES,PMQPMESI
          RETURN
.
.
.READKOLD  MOVE      ZERO,OVRCD
.          READKS    OLDFILE;DDURNO,DDADMNO:
.                             DIM6,DTIME,DSTAT,DDEST:
.                             PTDSVOGU,DSPARE
.          GOTO      OVERCOND IF OVER
.          MOVE      QDURNO,DURNO
.          RETURN
.
.                  ******************************    NEW IO ROUTINES
.                  Copy the Write statement from the new I/O file           
.                  (no changes are needed to this routine)               
.
WRPMQPT1  RESET     KEY20
          MOVE      PMQPMESI,DPMQPMES
          WRITE     PMSQPTA1,KEY20;DPMQPMES,PURNO,PMQPOURN,CSALIAS:
                                  PTCGDATE,PTITL,PHOSP,PLDAYS,PBDEBT:
                                  PSNAME,PGNAME,PPSNAME,PADD1,PADD2:
                                  PSUBRB,PADD4,PPOST,PTELEP,PTELEB:
                                  PSEX,PMSTAT,PBDATE,PCONT,PREG:
                                  PTYPE,POCCUP,PLDDATE,PMEDI,PPENNO:
                                  PPNDTE,PREPAT,PSMOK,PMICRO,PCEASE:
                                  PCASE,PAUTOPY,PHIGH1,PHIGH2,PHIGH3:
                                  PLOCDOC,PFUNDH,PFNDTB,PFNDMM,PUSR1:
                                  PUSR2,PUSR3,PUSR4,PUSR5,PUSR6:
                                  PUYN1,PUYN2,PUYN3,PYRRES,PNKNAME:
                                  PNKADD1,PNKADD2,PNKSUBR,PNKADD4,PNKPOST:
                                  PNKTELP,PNKTELB,PNKRELP,PFNDYY,PFNDCG:
                                  PDECDTE,PDIET,PINITHOS,PHKADUNI,PTMAEMPC:
                                  PTMANOKO,PTMANOKE,PTMADCNO,PTMXRDAT,PTMXMEAL:
                                  PTMXLGA,PTMXLS,PTMXLSDT,PTMXFHMD,PTMXMHU1:
                                  PTMXMHU2,PTMXMHU3,PTMXECNM,PTMXECA1,PTMXECA2:
                                  PTMXECA3,PTMXECA4,PTMXECPC,PTMXECPP,PTMXECBP:
                                  PTMXECRE,PTMXNRNM,PTMXNRA1,PTMXNRA2,PTMXNRA3:
                                  PTMXNRA4,PTMXNRPC,PTMXNRPP,PTMXNRBP,PTMXNRRE:
                                  PTMX3BEX,PTMXCARD,PTMXCEXP,PTMXCXMP,PTMXFMLY:
                                  PTMXCHNM,PTMXDOFR,PTMXREGP,PTMXGPPC,PTMXSPID:
                                  PTMXGPPT,PTMXOSDT,PTNINMPI,NHMASURN,NHMAGIV1:
                                  NHMAGIV2,NHMAGIV3,NHMAPREI,NHMAADD1,NHMAADD2:
                                  NHMAADD3,NHMAADD4,NHMAADD5,NHMADOB,NHMADDTH:
                                  NHMADOMC,NHMARES,NHMAETH,NHMASEX,NHMADAT:
                                  NHMATIM,NHMAETH2,NHMAETH3,PTMXOPER,PTMXUKDO:
                                  PTMXCELL,PTMXADD1,PTMXADD2,PTMXADD3,PTMXADD4:
                                  PTMXPOST,PMPXINTR,PMPXLNG1,PMPXLNG2,PMPXLNG3:
                                  PMPXPEML,PMPXEDOB,PMPXCMOB,PMPXCEML,PMPXCCRP:
                                  PMPXKMOB,PMPXKEML,PMPXKCRP,PMPXRMOB,PMPXREML:
                                  PMPXRCRP,PMPXMEDC,PMPXDETY,PMPXPRIS,PMPXCSER:
                                  PMPXPHEI,PMPXPWEI,PMPXDREC,PMPXDVAC,PMPXPNSD:
                                  PMPXUYN4,PMPXUYN5,PMPXUYN6,PMPXABRG,PMPXPRVI:
                                  PMPXCRIN,PMPXHOML,PMPXUDC1,PMPXUDC2,PMPXUDC3:
                                  PMPXUSR7,PMPXUSR8,PMPXUSR9,PMPXMSNA,PMPXMGNA:
                                  PMPXMTLE,PMPXMAD1,PMPXMAD2,PMPXMAD3,PMPXMAD4:
                                  PMPXMPOS,PMPXMPNO,PMPXMBNO,PMPXMMNO,PMPXMEML:
                                  PMPXMCNT,PMPXMCRP,PMPXMLAB,PMPXMREL,PMPXFSNA:
                                  PMPXFGNA,PMPXFTLE,PMPXFAD1,PMPXFAD2,PMPXFAD3:
                                  PMPXFAD4,PMPXFPOS,PMPXFPNO,PMPXFBNO,PMPXFMNO:
                                  PMPXFEML,PMPXFCNT,PMPXFCRP,PMPXFLAB,PMPXFREL:
                                  PTMXMCCD,PMPXRHC1,PMPXRH1G,PMPXR1GC:
                                  PMPXFNAM,PMPXSNAM,PMQPSPAR
          RETURN
.
.
          INC       STD001IO

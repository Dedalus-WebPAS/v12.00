.--------------------
. Format Date
.--------------------
EAPIMA00  UNPACK    APIMIDT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          RETURN
.--------------------
. Format Type
.--------------------
EAPIMB00  MOVE      APIMTYP,F1
          BRANCH    F1,EAPIMB10,EAPIMB20,EAPIMB30,EAPIMB40
          MOVE      "Inv",KEY3
          GOTO      EAPIMB99
EAPIMB10 
          MOVE      "Crd",KEY3
          GOTO      EAPIMB99
EAPIMB20 
          MOVE      "Pay",KEY3
          GOTO      EAPIMB99
EAPIMB30 
          MOVE      "C/C",KEY3
          GOTO      EAPIMB99
EAPIMB40 
          MOVE      "C/R",KEY3
          GOTO      EAPIMB99
EAPIMB99
          RETURN
.
.---------------------------------------------------------------------------
.   System    :   Accounts Payable System            
.   Include   :   APSIMSKY
.   Routine   :   KAPIMA00 Keyin Reference           
.   Parameter :   CKEYTYP 0 = Keyin , 1 = Accept, 2 = Either
.   Return    :   EXIT = 1 null entry, 2 EXITCHAR entered
.-------------------------------------------------------------------------------
KAPIMA00 TOPIC     "APIMREF "
          MOVE      UNDLN70,APIMREF 
          KEYIN     *PCCOL:CVERT,*DV,APIMREF:                                   
                    *PCCOL:CVERT,*V2LON,APIMREF:                                
                    *PCCOL:CVERT,*DV,APIMREF 
.
          ENDSET    APIMREF 
          APPEND    SP70,APIMREF 
          RESET     APIMREF 
.
          MATCH     SP70,APIMREF 
          GOTO      KAPIMA90 IF EQUAL
.
          CMATCH    EXITCHAR,APIMREF 
          GOTO      KAPIMA95 IF EQUAL
.
          CMATCH    QUEST,APIMREF 
          GOTO      KAPIMA10 IF NOT EQUAL
.
          MOVE      CCITEM,SCCITEM
          CALL      HAPIMZ00
          MOVE      SCCITEM,CCITEM
.
          ENDSET    APIMREF 
          APPEND    SP70,APIMREF 
          RESET     APIMREF 
.
          MATCH     SP70,APIMREF 
          GOTO      KAPIMA00 IF EQUAL
.
          DISPLAY   *PCCOL:CVERT,*V2LON,APIMREF                                 
KAPIMA10
          PACK      KEY40,APIMBCH,APIMCRD,APIMREF,APIMREF
          CALL      RAAPIM1 
          BRANCH    OVRCD,KAPIMA80
          BRANCH    CKEYTYP,KAPIMA75
          CALL      RDAPIM1 
KAPIMA70
          MOVE      ZERO,EXIT
          GOTO      KAPIMA99
KAPIMA75
          MOVE      "Reference Already Exist - ",DISPMSG                                             
          CALL      MESSAGE1
          GOTO      KAPIMA00
KAPIMA80
          MOVE      ZERO,EXIT
          BRANCH    CKEYTYP,KAPIMA99,KAPIMA99
          MOVE      "Reference Does Not Exist - ",DISPMSG                                            
          CALL      MESSAGE1
          GOTO      KAPIMA00
KAPIMA90
          MOVE      ONE,EXIT
          GOTO      KAPIMA99
KAPIMA95
          MOVE      TWO,EXIT
KAPIMA99 TOPIC    PRGID
          RETURN
.
.-------------------------------------------------------------------------------
.   System    :   Accounts Payable System            
.   Include   :   APSIMSKY
.   Routine   :   HAPIMZ00 Reference Help      
.   Return    :   APIMREF 
.-------------------------------------------------------------------------------
HAPIMZ00
          MOVE      ZERO,CSCRSIZ
          IF        HTOP<3
            MOVE      "12",HTOP
            MOVE      "24",HBOT
            MOVE      "1",HLEF
            MOVE      "80",HRIG
          ENDIF
HAPIMZ04
          CALL      GSCRN000
          BRANCH    EXIT,HAPIMZ99
          MOVE      STDCOL00,STDCOL01
          ADD       " 5",STDCOL01
          DISPLAY   *PSTDCOL01:STDROW,*V2LON,*ULON,"Date"         
.
          MOVE      STDCOL01,STDCOL02
          ADD       "11",STDCOL02
          DISPLAY   *PSTDCOL02:STDROW,*V2LON,*ULON,"Batch"              
.
          MOVE      STDCOL02,STDCOL03
          ADD       " 6",STDCOL03
          DISPLAY   *PSTDCOL03:STDROW,*V2LON,*ULON,"Document Ref."          
.
          MOVE      STDCOL03,STDCOL04
          ADD       "16",STDCOL04
          DISPLAY   *PSTDCOL04:STDROW,*V2LON,*ULON,"Type"               
.
          MOVE      STDCOL04,STDCOL05
          ADD       " 5",STDCOL05
          DISPLAY   *PSTDCOL05:STDROW,*V2LON,*ULON,"         Amount"   
.
          MOVE      STDCOL05,STDCOL06
          ADD       "16",STDCOL06
          DISPLAY   *PSTDCOL06:STDROW,*V2LON,*ULON,"Invoice Ref."   
.
          MOVE      STDCOL06,STDCOL07
          ADD       "15",STDCOL07
HAPIMZ08
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          MOVE      SP70,APIMREF 
          PACK      KEY48,APIMCRD,Z70
          PACK      SAVKEY80,APIMCRD,APIMBCH
          SETLPTR   SAVKEY80,5                                                 
          CALL      RSAPIM2 
HAPIMZ10
          CALL      RPAPIM2 
          BRANCH    OVRCD,HAPIMZ15
          PACK      KEY48,APIMCRD,APIMIDT,APIMREF,APIMDOC,APIMBCH,SP70
          MATCH     SAVKEY80,KEY48                                              
          GOTO      HAPIMZ15 IF NOT EQUAL                                       
          BRANCH    CSEARCH,HAPIMZ12
          CALL      HAPIMZ60
          BRANCH    OVRCD,HAPIMZ10
HAPIMZ12
          ADD       ONE,XITEMNO
          ADD       ONE,STDROW
          STORE     KEY48,XITEMNO,ST1,ST2,ST3,ST4,ST5:                           
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
.
          DISPLAY   *PSTDCOL00:STDROW,SP1,*V2LON,XITEMNO,DOT
          CALL      EAPIMA00
          DISPLAY   *PSTDCOL01:STDROW,CPCDATE 
          DISPLAY   *PSTDCOL02:STDROW,APIMBCH 
          DISPLAY   *PSTDCOL03:STDROW,APIMDOC 
          CALL      EAPIMB00
          DISPLAY   *PSTDCOL04:STDROW,KEY3    
          ASSIGN    APIMTOT-APIMDIS+APIMGST,F12P2
          MATCH     "0",APIMTYP
          IF        !@EQUAL
            MULT      SEQ,F12P2
          ENDIF      
          MOVE      "(99,999,999.99 ",KEY15
          FEDIT     F12P2,KEY15
          DISPLAY   *PSTDCOL05:STDROW,KEY15 
          DISPLAY   *PSTDCOL06:STDROW,APIMREF 
.
          COMPARE   MAXITEM,XITEMNO
          GOTO      HAPIMZ10 IF NOT EQUAL
HAPIMZ15
          UNPACK    SAVKEY80,APIMCRD,APIMBCH
          MOVE      ONE,DITEM
          MOVE      MINITEM,DROW
          ADD       ONE,DROW
          DISPLAY   *PSTDCOL00:DROW,*V2LON,*HON,SP1,DITEM,DOT
          CLIP
          FLUSH     HLEF,HTOP,HRIG,HBOT
.
HAPIMZ20
          CALL      HSCRI000
          BRANCH    EXIT,HAPIMZ30,HAPIMZ35,HAPIMZ40,HAPIMZ45,HAPIMZ04:
                              HAPIMZ91,HAPIMZ50
          GOTO      HAPIMZ92
HAPIMZ30
          CALL      RPAPIM2 
          BRANCH    OVRCD,HAPIMZ85
          PACK      KEY48,APIMCRD,APIMIDT,APIMREF,APIMDOC,APIMBCH,SP70
          MATCH     SAVKEY80,KEY48                                              
          GOTO      HAPIMZ85 IF NOT EQUAL                                       
          CALL      RKAPIM2 
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HAPIMZ10
HAPIMZ35
          MOVE      ST1,KEY48
          CALL      RDAPIM2 
          CALL      RKAPIM2 
          BRANCH    OVRCD,HAPIMZ85
          PACK      KEY48,APIMCRD,APIMIDT,APIMREF,APIMDOC,APIMBCH,SP70
          MATCH     SAVKEY80,KEY48                                              
          GOTO      HAPIMZ85 IF NOT EQUAL                                       
          MATCH     SP70,APIMREF                                                
          GOTO      HAPIMZ85 IF EQUAL                                           
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
HAPIMZ36
          CALL      RKAPIM2 
          BRANCH    OVRCD,HAPIMZ37
          PACK      KEY48,APIMCRD,APIMIDT,APIMREF,APIMDOC,APIMBCH,SP70
          MATCH     SAVKEY80,KEY48                                              
          GOTO      HAPIMZ37 IF NOT EQUAL                                       
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HAPIMZ36 IF NOT EQUAL
HAPIMZ37
          MOVE      ZERO,XITEMNO
          GOTO      HAPIMZ10
HAPIMZ40
          MOVE      ST1,KEY48
          CALL      RDAPIM2 
          CALL      RKAPIM2 
          BRANCH    OVRCD,HAPIMZ85
          PACK      KEY48,APIMCRD,APIMIDT,APIMREF,APIMDOC,APIMBCH,SP70
          MATCH     SAVKEY80,KEY48                                              
          GOTO      HAPIMZ85 IF NOT EQUAL                                       
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HAPIMZ08
HAPIMZ45
          CALL      RPAPIM2 
          BRANCH    OVRCD,HAPIMZ85
          PACK      KEY48,APIMCRD,APIMIDT,APIMREF,APIMDOC,APIMBCH,SP70
          MATCH     SAVKEY80,KEY48                                              
          GOTO      HAPIMZ85 IF NOT EQUAL                                       
          SUSPEND
          CLIP      1,1,CRIG,24
.
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      ZERO,XITEMNO
          PACK      KEY48,SAVKEY80,Z70                                          
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
          CALL      RSAPIM2 
HAPIMZ46
          CALL      RKAPIM2 
          BRANCH    OVRCD,HAPIMZ47
          PACK      KEY48,APIMCRD,APIMIDT,APIMREF,APIMDOC,APIMBCH,SP70
          MATCH     SAVKEY80,KEY48                                              
          GOTO      HAPIMZ47 IF NOT EQUAL                                       
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HAPIMZ46 IF NOT EQUAL
HAPIMZ47
          MOVE      ZERO,XITEMNO
          GOTO      HAPIMZ10
HAPIMZ50  COMPARE   ZERO,CSEARCH
          GOTO      HAPIMZ55 IF EQUAL
          MOVE      ZERO,CSEARCH
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          ADD       ONE,STDROW
          UNPACK    SP70,SCHFLD01,SCHFLD02,SCHFLD03,SCHFLD04,SCHFLD05
          UNPACK    SP70,SCHFLD06,SCHFLD07,SCHFLD08,SCHFLD09,SCHFLD10
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          DISPLAY   *PSTDCOL00:STDROW,*V2LON,*HON,"Sch"
          KEYIN     *PSTDCOL01:STDROW,*V2LON,SCHFLD01
          RESET     SCHFLD01
          KEYIN     *PSTDCOL02:STDROW,*V2LON,SCHFLD02
          RESET     SCHFLD02
          KEYIN     *PSTDCOL03:STDROW,*V2LON,SCHFLD03
          RESET     SCHFLD03
          KEYIN     *PSTDCOL04:STDROW,*V2LON,SCHFLD04
          RESET     SCHFLD04
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HAPIMZ08
HAPIMZ55  MOVE      ONE,CSEARCH
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HAPIMZ08
HAPIMZ60  MOVE      ZERO,OVRCD
          CALL      EAPIMA00
          MATCH     SP70,SCHFLD01
          GOTO      HAPIMZ61 IF EQUAL
          MATCH     SCHFLD01,CPCDATE 
          GOTO      HAPIMZ72 IF NOT EQUAL
HAPIMZ61
          MATCH     SP70,SCHFLD02
          GOTO      HAPIMZ62 IF EQUAL
          MATCH     SCHFLD02,APIMBCH 
          GOTO      HAPIMZ72 IF NOT EQUAL
HAPIMZ62
          MATCH     SP70,SCHFLD03
          GOTO      HAPIMZ63 IF EQUAL
          MATCH     SCHFLD03,APIMREF 
          GOTO      HAPIMZ72 IF NOT EQUAL
HAPIMZ63
          CALL      EAPIMB00
          MATCH     SP70,SCHFLD04
          GOTO      HAPIMZ64 IF EQUAL
          MATCH     SCHFLD04,KEY3    
          GOTO      HAPIMZ72 IF NOT EQUAL
HAPIMZ64
HAPIMZ65
HAPIMZ66
HAPIMZ67
HAPIMZ68
HAPIMZ69
HAPIMZ70
          GOTO      HAPIMZ75
HAPIMZ72  MOVE      ONE,OVRCD
HAPIMZ75  RETURN
HAPIMZ85
          LOAD      KEY48,XITEMNO,ST1,ST2,ST3,ST4,ST5:                           
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY48,APIMCRD,APIMIDT,APIMREF,APIMDOC,APIMBCH
          CALL      RDAPIM2 
HAPIMZ90
          UNPACK    SAVKEY80,APIMCRD,APIMBCH
          BEEP
          GOTO      HAPIMZ20
HAPIMZ91
          MOVE      SP70,APIMDOC 
          MOVE      SP70,APIMDDT 
          MOVE      SP70,APIMTYP 
          MOVE      SP70,APIMUPD 
          MOVE      SP70,APIMTER 
          MOVE      SP70,APIMPDT 
          MOVE      SP70,APIMTDT 
          MOVE      ZERO,APIMTOT 
          MOVE      ZERO,APIMDIS 
          MOVE      ZERO,APIMGST 
          MOVE      SP70,APIMCM1 
          MOVE      SP70,APIMCM2 
          MOVE      ZERO,APIMPAY 
          MOVE      SP70,APIMSPA 
          MOVE      SP70,KEY48
          MOVE      SP70,APIMREF 
          UNPACK    SAVKEY80,APIMCRD,APIMBCH
          GOTO      HAPIMZ96
HAPIMZ92
          MOVE      SP70,KEY48
          MOVE      SP70,APIMREF 
          LOAD      KEY48,CCITEM,ST1,ST2,ST3,ST4,ST5:                           
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY48,APIMCRD,APIMIDT,APIMREF,APIMDOC,APIMBCH
HAPIMZ96
          PUTSCR    CSSCRNUM,HLEF,HTOP,HRIG,HBOT
          CALL      FRESCR00
          MOVE      ZERO,HTOP
          MOVE      ZERO,HLEF
          MOVE      ZERO,HBOT
          MOVE      ZERO,HRIG
HAPIMZ99
          RETURN
.---------------------------------------------------------------------------
.   System    :   Accounts Payable System            
.   Include   :   APSIMSKY
.   Routine   :   KAPIMA00 Keyin Reference           
.   Parameter :   CKEYTYP 0 = Keyin , 1 = Accept, 2 = Either
.   Return    :   EXIT = 1 null entry, 2 EXITCHAR entered
.-------------------------------------------------------------------------------
KAPIMX00 TOPIC     "APIMDOC "
          MOVE      UNDLN70,APIMDOC 
          KEYIN     *PCCOL:CVERT,*DV,APIMDOC:                                   
                    *PCCOL:CVERT,*V2LON,APIMDOC:                                
                    *PCCOL:CVERT,*DV,APIMDOC 
.
          ENDSET    APIMDOC 
          APPEND    SP70,APIMDOC 
          RESET     APIMDOC 
.
          MATCH     SP70,APIMDOC 
          GOTO      KAPIMX90 IF EQUAL
.
          CMATCH    EXITCHAR,APIMDOC 
          GOTO      KAPIMX95 IF EQUAL
.
          CMATCH    QUEST,APIMDOC 
          GOTO      KAPIMX10 IF NOT EQUAL
.
          MOVE      CCITEM,SCCITEM
          CALL      HAPIMZ00
          MOVE      SCCITEM,CCITEM
.
          ENDSET    APIMDOC 
          APPEND    SP70,APIMDOC 
          RESET     APIMDOC 
.
          MATCH     SP70,APIMDOC 
          GOTO      KAPIMX00 IF EQUAL
.
          DISPLAY   *PCCOL:CVERT,*V2LON,APIMDOC                                 
KAPIMX10
          MOVE      ZERO,EXIT
          GOTO      KAPIMX99
KAPIMX90
          MOVE      ONE,EXIT
          GOTO      KAPIMX99
KAPIMX95
          MOVE      TWO,EXIT
KAPIMX99  TOPIC     PRGID
          RETURN
.---------------------------------------------------------------------------
.   System    :   Accounts Payable System            
.   Include   :   APSIMSKY
.   Routine   :   KAPIMY00 Keyin Reference           
.   Parameter :   CKEYTYP 0 = Keyin , 1 = Accept, 2 = Either
.   Return    :   EXIT = 1 null entry, 2 EXITCHAR entered
.-------------------------------------------------------------------------------
KAPIMY00 TOPIC     "APIMREF "
          MOVE      UNDLN70,APIMREF 
          KEYIN     *PCCOL:CVERT,*DV,APIMREF:                                   
                    *PCCOL:CVERT,*V2LON,APIMREF:                                
                    *PCCOL:CVERT,*DV,APIMREF 
.
          ENDSET    APIMREF 
          APPEND    SP70,APIMREF 
          RESET     APIMREF 
.
          MATCH     SP70,APIMREF 
          GOTO      KAPIMY90 IF EQUAL
.
          CMATCH    EXITCHAR,APIMREF 
          GOTO      KAPIMY95 IF EQUAL
.
          CMATCH    QUEST,APIMREF 
          GOTO      KAPIMY10 IF NOT EQUAL
.
          MOVE      CCITEM,SCCITEM
          CALL      HAPIMZ00
          MOVE      SCCITEM,CCITEM
.
          ENDSET    APIMREF 
          APPEND    SP70,APIMREF 
          RESET     APIMREF 
.
          MATCH     SP70,APIMREF 
          GOTO      KAPIMY00 IF EQUAL
.
          DISPLAY   *PCCOL:CVERT,*V2LON,APIMREF                                 
KAPIMY10
          MOVE      ZERO,EXIT
          GOTO      KAPIMY99
KAPIMY90
          MOVE      ONE,EXIT
          GOTO      KAPIMY99
KAPIMY95
          MOVE      TWO,EXIT
KAPIMY99  TOPIC     PRGID
          RETURN
.---------------------------------------------------------------------------
.   System    :   Accounts Payable System            
.   Include   :   APSIMSKY
.   Routine   :   KAPIMA00 Keyin Reference           
.                 Input Outstanding Reference
.   Parameter :   CKEYTYP 0 = Keyin , 1 = Accept, 2 = Either
.   Return    :   EXIT = 1 null entry, 2 EXITCHAR entered
.-------------------------------------------------------------------------------
IAPIMX00 TOPIC     "APIMREF "
          MOVE      UNDLN70,APIMREF 
          KEYIN     *PCCOL:CVERT,*DV,APIMREF:                                   
                    *PCCOL:CVERT,*V2LON,APIMREF:                                
                    *PCCOL:CVERT,*DV,APIMREF 
.
          ENDSET    APIMREF 
          APPEND    SP70,APIMREF 
          RESET     APIMREF 
.
          MATCH     SP70,APIMREF 
          GOTO      IAPIMX90 IF EQUAL
.
          MATCH     "E             ",APIMREF 
          GOTO      IAPIMX95 IF EQUAL
          MATCH     "e             ",APIMREF 
          GOTO      IAPIMX95 IF EQUAL
.
          MATCH     "X             ",APIMREF 
          GOTO      IAPIMX95 IF EQUAL
          MATCH     "x             ",APIMREF 
          GOTO      IAPIMX95 IF EQUAL
.
          CMATCH    EXITCHAR,APIMREF 
          GOTO      IAPIMX95 IF EQUAL
.
          CMATCH    QUEST,APIMREF 
          GOTO      IAPIMX10 IF NOT EQUAL
.
          MOVE      CCITEM,SCCITEM
          CALL      QAPIMA00
          MOVE      SCCITEM,CCITEM
.
          ENDSET    APIMREF 
          APPEND    SP70,APIMREF 
          RESET     APIMREF 
.
          MATCH     SP70,APIMREF 
          GOTO      IAPIMX00 IF EQUAL
.
          DISPLAY   *PCCOL:CVERT,*V2LON,APIMREF                                 
IAPIMX10
          MOVE      ZERO,EXIT
          GOTO      IAPIMX99
IAPIMX90
          MOVE      ONE,EXIT
          GOTO      IAPIMX99
IAPIMX95
          MOVE      TWO,EXIT
IAPIMX99  TOPIC     PRGID
          RETURN
.
.---------------------------------------------------------------------------
.   System    :   Accounts Payable System            
.   Include   :   APSIMSKY
.   Routine   :   QAPIMA00 Invoice Batch Detail
.   Return    :           
.-------------------------------------------------------------------------------
QAPIMA00
          MOVE      ZERO,CSCRSIZ
          IF        HTOP<3
            MOVE      "12",HTOP
            MOVE      "24",HBOT
            MOVE      "1",HLEF
            MOVE      "80",HRIG
          ENDIF
QAPIMA04
          CALL      GSCRN000
          BRANCH    EXIT,QAPIMA99
          MOVE      STDCOL00,STDCOL01
          ADD       " 5",STDCOL01
          DISPLAY   *PSTDCOL01:STDROW,*V2LON,*ULON,"Date"         
.
          MOVE      STDCOL01,STDCOL02
          ADD       "11",STDCOL02
          DISPLAY   *PSTDCOL02:STDROW,*V2LON,*ULON,"Batch"              
.
          MOVE      STDCOL02,STDCOL03
          ADD       " 6",STDCOL03
          DISPLAY   *PSTDCOL03:STDROW,*V2LON,*ULON,"Document Ref."          
.
          MOVE      STDCOL03,STDCOL04
          ADD       "16",STDCOL04
          DISPLAY   *PSTDCOL04:STDROW,*V2LON,*ULON,"Type"               
.
          MOVE      STDCOL04,STDCOL05
          ADD       " 5",STDCOL05
          DISPLAY   *PSTDCOL05:STDROW,*V2LON,*ULON,"    Outstanding"   
.
          MOVE      STDCOL05,STDCOL06
          ADD       "16",STDCOL06
          DISPLAY   *PSTDCOL06:STDROW,*V2LON,*ULON,"Invoice Ref."   
.
          MOVE      STDCOL06,STDCOL07
          ADD       "15",STDCOL07
QAPIMA08
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          MOVE      SP70,APIMREF 
          PACK      KEY41,ONE,APMACRD,SP70                  
          PACK      SAVKEY80,ONE,APMACRD,SP70               
          SETLPTR   SAVKEY80,6                                                  
          CALL      RSAPIM6 
QAPIMA10
          CALL      RKAPIM6 
          BRANCH    OVRCD,QAPIMA15
          PACK      KEY41,APIMOUT,APIMCRD,APIMREF,APIMDOC,APIMBCH,SP70
          MATCH     SAVKEY80,KEY41                                              
          GOTO      QAPIMA15 IF NOT EQUAL                                       
          BRANCH    CSEARCH,QAPIMA12
          CALL      QAPIMA60
          BRANCH    OVRCD,QAPIMA10
QAPIMA12
          ADD       ONE,XITEMNO
          ADD       ONE,STDROW
          STORE     KEY41,XITEMNO,ST1,ST2,ST3,ST4,ST5:                           
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
.
          DISPLAY   *PSTDCOL00:STDROW,SP1,*V2LON,XITEMNO,DOT
          CALL      EAPIMA00
          DISPLAY   *PSTDCOL01:STDROW,CPCDATE 
          DISPLAY   *PSTDCOL02:STDROW,APIMBCH 
          DISPLAY   *PSTDCOL03:STDROW,APIMDOC 
          CALL      EAPIMB00
          DISPLAY   *PSTDCOL04:STDROW,KEY3    
          ASSIGN    APIMTOT-APIMDIS+APIMGST-APIMPAY,F12P2
          MATCH     "0",APIMTYP
          IF        !@EQUAL
            MULT      SEQ,F12P2
          ENDIF      
          MOVE      "(99,999,999.99 ",KEY15
          FEDIT     F12P2,KEY15
          DISPLAY   *PSTDCOL05:STDROW,KEY15 
          DISPLAY   *PSTDCOL06:STDROW,APIMREF 
.
          COMPARE   MAXITEM,XITEMNO
          GOTO      QAPIMA10 IF NOT EQUAL
QAPIMA15
          UNPACK    SAVKEY80,APIMOUT,APIMCRD,APIMREF,APIMDOC,APIMBCH
          MOVE      ONE,DITEM
          MOVE      MINITEM,DROW
          ADD       ONE,DROW
          DISPLAY   *PSTDCOL00:DROW,*V2LON,*HON,SP1,DITEM,DOT
          CLIP
          FLUSH     HLEF,HTOP,HRIG,HBOT
.
QAPIMA20
          CALL      HSCRI000
          BRANCH    EXIT,QAPIMA30,QAPIMA35,QAPIMA40,QAPIMA45,QAPIMA04:
                              QAPIMA91,QAPIMA50
          GOTO      QAPIMA92
QAPIMA30
          CALL      RKAPIM6 
          BRANCH    OVRCD,QAPIMA85
          PACK      KEY41,APIMOUT,APIMCRD,APIMREF,APIMDOC,APIMBCH,SP70
          MATCH     SAVKEY80,KEY41                                              
          GOTO      QAPIMA85 IF NOT EQUAL                                       
          CALL      RPAPIM6 
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      QAPIMA10
QAPIMA35
          MOVE      ST1,KEY41
          CALL      RDAPIM6 
          CALL      RPAPIM6 
          BRANCH    OVRCD,QAPIMA85
          PACK      KEY41,APIMOUT,APIMCRD,APIMREF,APIMDOC,APIMBCH,SP70  
          MATCH     SAVKEY80,KEY41                                              
          GOTO      QAPIMA85 IF NOT EQUAL                                       
          MATCH     SP70,APIMREF                                                
          GOTO      QAPIMA85 IF EQUAL                                           
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
QAPIMA36
          CALL      RPAPIM6 
          BRANCH    OVRCD,QAPIMA37
          PACK      KEY41,APIMOUT,APIMCRD,APIMREF,APIMDOC,APIMBCH,SP70  
          MATCH     SAVKEY80,KEY41                                              
          GOTO      QAPIMA37 IF NOT EQUAL                                       
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      QAPIMA36 IF NOT EQUAL
QAPIMA37
          MOVE      ZERO,XITEMNO
          GOTO      QAPIMA10
QAPIMA40
          MOVE      ST1,KEY41
          CALL      RDAPIM6 
          CALL      RPAPIM6 
          BRANCH    OVRCD,QAPIMA85
          PACK      KEY41,APIMOUT,APIMCRD,APIMREF,APIMDOC,APIMBCH,SP70
          MATCH     SAVKEY80,KEY41                                              
          GOTO      QAPIMA85 IF NOT EQUAL                                       
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      QAPIMA08
QAPIMA45
          CALL      RKAPIM6 
          BRANCH    OVRCD,QAPIMA85
          PACK      KEY41,APIMOUT,APIMCRD,APIMREF,APIMDOC,APIMBCH,SP70
          MATCH     SAVKEY80,KEY41                                              
          GOTO      QAPIMA85 IF NOT EQUAL                                       
          SUSPEND
          CLIP      1,1,CRIG,24
.
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      ZERO,XITEMNO
          PACK      KEY41,SAVKEY80,Z70                                          
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
          CALL      RSAPIM6 
QAPIMA46
          CALL      RPAPIM6 
          BRANCH    OVRCD,QAPIMA47
          PACK      KEY41,APIMOUT,APIMCRD,APIMREF,APIMDOC,APIMBCH,SP70
          MATCH     SAVKEY80,KEY41                                              
          GOTO      QAPIMA47 IF NOT EQUAL                                       
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      QAPIMA46 IF NOT EQUAL
QAPIMA47
          MOVE      ZERO,XITEMNO
          GOTO      QAPIMA10
QAPIMA50  COMPARE   ZERO,CSEARCH
          GOTO      QAPIMA55 IF EQUAL
          MOVE      ZERO,CSEARCH
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          ADD       ONE,STDROW
          UNPACK    SP70,SCHFLD01,SCHFLD02,SCHFLD03,SCHFLD04,SCHFLD05
          UNPACK    SP70,SCHFLD06,SCHFLD07,SCHFLD08,SCHFLD09,SCHFLD10
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          DISPLAY   *PSTDCOL00:STDROW,*V2LON,*HON,"Sch"
          KEYIN     *PSTDCOL01:STDROW,*V2LON,SCHFLD01
          RESET     SCHFLD01
          KEYIN     *PSTDCOL02:STDROW,*V2LON,SCHFLD02
          RESET     SCHFLD02
          KEYIN     *PSTDCOL03:STDROW,*V2LON,SCHFLD03
          RESET     SCHFLD03
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      QAPIMA08
QAPIMA55  MOVE      ONE,CSEARCH
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      QAPIMA08
QAPIMA60  MOVE      ZERO,OVRCD
          MATCH     SP70,SCHFLD01
          GOTO      QAPIMA61 IF EQUAL
          MATCH     SCHFLD01,APIMREF 
          GOTO      QAPIMA72 IF NOT EQUAL
QAPIMA61
          MATCH     SP70,SCHFLD02
          GOTO      QAPIMA62 IF EQUAL
          MATCH     SCHFLD02,APIMDOC 
          GOTO      QAPIMA72 IF NOT EQUAL
QAPIMA62
          CALL      EAPIMA00
          MATCH     SP70,SCHFLD03
          GOTO      QAPIMA63 IF EQUAL
          MATCH     SCHFLD03,CPCDATE 
          GOTO      QAPIMA72 IF NOT EQUAL
QAPIMA63
QAPIMA64
QAPIMA65
QAPIMA66
QAPIMA67
QAPIMA68
QAPIMA69
QAPIMA70
          GOTO      QAPIMA75
QAPIMA72  MOVE      ONE,OVRCD
QAPIMA75  RETURN
QAPIMA85
          LOAD      KEY41,XITEMNO,ST1,ST2,ST3,ST4,ST5:                           
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY41,APIMBCH,APIMCRD,APIMREF,APIMDOC                       
          CALL      RDAPIM6 
QAPIMA90
          UNPACK    SAVKEY80,APIMOUT,APIMCRD,APIMREF,APIMDOC,APIMBCH
          BEEP
          GOTO      QAPIMA20
QAPIMA91
          MOVE      SP70,APIMTYP 
          MOVE      SP70,APIMUPD 
          MOVE      SP70,APIMTER 
          MOVE      SP70,APIMIDT 
          MOVE      SP70,APIMDDT 
          MOVE      SP70,APIMPDT 
          MOVE      SP70,APIMTDT 
          MOVE      ZERO,APIMTOT 
          MOVE      ZERO,APIMDIS 
          MOVE      ZERO,APIMGST 
          MOVE      ZERO,APIMPAY 
          MOVE      SP70,APIMCM1 
          MOVE      SP70,APIMCM2 
          MOVE      SP70,APIMICM 
          MOVE      SP70,APIMSPA 
          MOVE      SP70,KEY41
          MOVE      SP70,APIMREF 
          GOTO      QAPIMA96
QAPIMA92
          MOVE      SP70,KEY41
          MOVE      SP70,APIMREF 
          LOAD      KEY41,CCITEM,ST1,ST2,ST3,ST4,ST5:                           
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY41,APIMOUT,APIMCRD,APIMREF,APIMDOC,APIMBCH
QAPIMA96
          PUTSCR    CSSCRNUM,HLEF,HTOP,HRIG,HBOT
          CALL      FRESCR00
          MOVE      ZERO,HTOP
          MOVE      ZERO,HLEF
          MOVE      ZERO,HBOT
          MOVE      ZERO,HRIG
QAPIMA99
          RETURN

.----------------------------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.00.00"
.-------------------------------------------------------
.V11.05.01  20/03/2025  Davin          TSK 0956210
.           Add ICD10 Ed.13 - Go-live Date PTCNGDX3 (Sect.130 Pos.86)
.V11.02.01  31/03/2022  Davin          TSK 0917793
.           Add ICD10 Ed.12 - Go-live Date PTCNGDX2 (Sect.128 Pos.231)
.-------------------------------------------------------
.V10.10.01  17/03/2017  Davin          TSK 0833093     HDP 2017/2018
.           Add ICD10 Ed.10 - Go-live Date PTCNGDVX (Sect.110 Pos.85)
.V10.06.01  17/03/2015  Davin         CAR 311669      HDP 2015/16
.           ADD PTCNGDV9 for ICD10 Ed.9 Go-live Date (Sect.110 Pos.77)
.V10.03.01  23/04/2013  Davin         CAR 284420      HDP 2013/14
.           ADD PTCNGDV8 for ICD10 Ed.8 Go-live Date (Sect.110 Pos.69)
.V10.00.01  07/04/2010  Mike Laming   CAR 219246      HDP 2010
.           ADD PTCNGDV7 for ICD10 Ed.7 Go-live Date (Sect.110 Pos.61)
. V9.09.01  20/03/2008  Mike Laming   CAR 163918      HDP 2008
.           ADD PTCNGDV6 for ICD10 Ed.6 Go-live
. V9.06.01  15/05/2006  Mike Laming   CAR 105244      2006 HDP
.           ADD PTCNGDV5 for ICD10 Ed.5 Go-live
. V9.03.01  23.06/2004  Henry Son                CAR 49037
.           ICD10 Ed.4 changes - add PTCNGDV4.
.-------------------------------------------------------
. V9.02.00  04.07.2002  Glenn Saunders
.           Export to new release i.e. v9.02 from r5.09
.----------------------------------------------------------------------------
. V5.08.02  15/08/2000  Caleb Sharman
.           Changed Health Fund table variables to 8 chars
. V5.08.01  22.08.2000 Sandra Barcham
.           Recompiled for change to ccshlcaf
.----------------------------------------------------------------------------
. V6.03.00  02.10.1995 B.G.Ackland
.           Release 6.03
. V6.03.02  30.10.1995 B.G.Ackland
.           Phase 1 WGH Changes
. V6.01.02  22.06.1994 B.G.Ackland
.           Chnage MBS & ICD Descriptions to Include Code
. V6.01.03  13.07.1995 B.G.Ackland
.           New Extracts for Theatre Bands & Days of Week
. V5.04.01  28.07.1997 B.G.Ackland
.           New Fields from Admission File for Southern
. V5.07.01  22.11.1999 B.G.Ackland
.           ICD9/10
.----------------------------------------------------------------------------
CCSTMPAF  FILE      ASCII, FIXED=80
OPCNCLSU  FORM      1        111      Using Clinic or Surgeon ?
.                                          0 = Clinic
.                                          1 = Surgeon
OPRCLIOP  FORM      1
OPROPROP  FORM      1
PATDOCOP  FORM      1
PTCNGDV3  DIM       8
PTCNGDV4  DIM       8                  * Ed4. Golive date              *I-49037
PTCNGDV5  DIM       8                       * Ed5 golive date         *I-105244
PTCNGDV6  DIM       8                       * Ed.6 Go-live date       *I-163918
PTCNGDV7  DIM       8                       * Ed.7 Go-live date       *I-219246	
PTCNGDV8  DIM       8                       * Ed.8 Go-live date       *I-284420	
PTCNGDV9  DIM       8                       * Ed.9 Go-live date       *I-311669	
PTCNGDVX  DIM       8                       * Ed.10 Go-live date      *I-0833093
PTCNGDX1  DIM       8                       * Go live date for ICD10 Ed.11
PTCNGDX2  DIM       8                       * Go live date for ICD10 Ed.12
PTCNGDX3  DIM       8                       * Go live date for ICD10 Ed.13
PTCNI10D  DIM       8
SOCACLIN  DIM       6
SOCADESC  DIM       30
.-------------------------------------------------------
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBACCA05
.   Function      :   Casemix Codes Maintenance               
.   Generated  On :   20/03/2008
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       CCSHLCFD/INC
          INC       CCSSTYFD/INC
          INC       CCSXHDFD/INC
          INC       OPRCLIFD/INC
          INC       OPROPRFD/INC
          INC       OUTCLIFD/INC
          INC       OUTCTYFD/INC
          INC       OUTSITFD/INC
          INC       PATCODFD/INC
          INC       PATDGWFD/INC
          INC       PATDO1FD/INC
          INC       PATFN1FD/INC
          INC       PATICDFD/INC
          INC       PATICOFD/INC
          INC       PATITMFD/INC
          INC       PATWR1FD/INC
.=========================
.Local Variable Definition
.-------------------------
LOADNAME  DIM      40 * Scr 00 Fld     2
CMIXSTY   DIM       3 * Scr 02 Fld     1
CMIXKEY   DIM      10 * Scr 02 Fld     2
CMIXDES   DIM      35 * Scr 02 Fld     4
CMIXSUM   DIM      10 * Scr 02 Fld     5
SUMDES    DIM      35 * Scr 02 Fld    10
SAVETYPE  DIM       3 * Scr 02 Fld    12
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBACCA05"
PRGNAM    INIT      "Casemix Codes Maintenance               "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          MOVE      PORT,PARENTID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      SC01L000
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          DISPLAY   *P56:24,"Opening ccshlcaf";
          OPEN      CCSHLCA1,"ccshlcaf"
          DISPLAY   *P56:24,"Opening ccsstyaf";
          OPEN      CCSSTYA1,"ccsstyaf"
          DISPLAY   *P56:24,"Opening ccsstyaf";
          OPEN      CCSSTYA2,"ccsstyaf"
          DISPLAY   *P56:24,"Opening ccsxhdaf";
          OPEN      CCSXHDA1,"ccsxhdaf"
          DISPLAY   *P56:24,"Opening ccsxhdaf";
          OPEN      CCSXHDA2,"ccsxhdaf"
          DISPLAY   *P56:24,"Opening ccsxhdaf";
          OPEN      CCSXHDA3,"ccsxhdaf"
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "00",SCRID
          IF         @EQUAL
            CALL       PS00L000   * Cross Reference Description Load   
          ENDIF
          MATCH     "01",SCRID
          IF         @EQUAL
            CALL       PS01L000   * Options                            
          ENDIF
          MATCH     "02",SCRID
          IF         @EQUAL
            CALL       PS02L000   * Maintain Casemix Codes             
          ENDIF
          MATCH     "03",SCRID
          IF         @EQUAL
            CALL       PS03L000   * Casemix Type Maintenance           
          ENDIF
          RETURN
.--------------------------------
. Screen - Cross Reference Description Load   
.--------------------------------
SC00L000
SC00L100
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC00L200
          CALL      CF00L000 * Clear Fields
          CALL      MVACCEPT
SC00L300
          CALL      KY00L000 * Enter Key Fields
          BRANCH    EXIT,SC00L999,SC00L999
SC00L400
          CALL      WP00L000 * Load any WP Details
SC00L500
          CALL      LM00L000 * Load any Batch Details
SC00L600
          CALL      DF00L000 * Display Fields
SC00L700
          CALL      SF00L000 * Select Fields
          BRANCH    EXIT,SC00L100,SC00L100,SC00L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC00L800
SC00L900
SC00L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Cross Reference Description Load   
.-------------------------------------------------------
CF00L000
          MOVE      SP70,LOADNAME
          MOVE      SP70,CCSTSTY 
CF00L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Cross Reference Description Load   
.--------------------------------------------------------
KY00L000
          MOVE      ZERO,EXIT
          GOTO      KY00L999
.
KY00L900  MOVE      ONE,EXIT
KY00L999  RETURN
.---------------------------------------------------------
. Load WP files for : Cross Reference Description Load   
.---------------------------------------------------------
WP00L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Cross Reference Description Load   
.---------------------------------------------------------
LM00L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Cross Reference Description Load   
.---------------------------------------------------------
DF00L000
          BRANCH   ACCEPT,DF00L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF00L900
          MATCH    PRGID,SCPSPID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF00L010 IF NOT EQUAL
.
          CALL     PS00L000 * Display Field
          GOTO     DF00L010
DF00L900
DF00L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Cross Reference Description Load   
.---------------------------------------------------------
PS00L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS00L999,PS00L101,PS00L999,PS00L999:
                            PS00L102,PS00L103
          GOTO     PS00L999
.
PS00L101
          MOVE      LOADNAME,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L102
          MOVE      CCSTSTY,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L103
          MOVE      CCSTDES,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
PS00L999
          RETURN
.---------------------------------------------------------
. Selections for : Cross Reference Description Load   
.---------------------------------------------------------
SF00L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF00L001  BRANCH   ACCEPT,SF00L020
.
SF00L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L006,SF00L101,SF00L102,SF00L103:
                            SF00L104,SF00L006
SF00L006  BEEP
          GOTO     SF00L005
SF00L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF00L090
          MATCH    PRGID,SCSLPID
          GOTO     SF00L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF00L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L020,SF00L101,SF00L020,SF00L020:
                            SF00L104,SF00L020
          GOTO     SF00L020
SF00L090  MOVE     ZERO,ACCEPT
          GOTO     SF00L001
.
SF00L101
          CALL     SELECTED
          STRIP     LOADNAME
          SFORMAT   VAR,SCPSLEN
          MOVE      LOADNAME,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,LOADNAME
          SFORMAT   VAR,127
          ENDSET    LOADNAME
          APPEND    SP70,LOADNAME
          RESET     LOADNAME
          CMATCH    EXITCHAR,LOADNAME
          GOTO      SF00L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,LOADNAME
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L101
            ENDIF
          ENDIF
          MOVE      LOADNAME,VAR     
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L102
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L103
          CALL      LOAD0000
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L104
.
.
          MOVE      "    6",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CCSTDES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KCCSTA00
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L104
            ENDIF
            BRANCH    EXIT,SF00L104,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      CCSTSTY,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    6",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      CCSTDES,VAR      
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
SF00L990  MOVE      FOUR,EXIT * Exit Char Exit
SF00L999  RETURN
.--------------------------------
. Screen - Options                            
.--------------------------------
SC01L000
SC01L100
          MOVE      "01",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC01L200
          CALL      CF01L000 * Clear Fields
SC01L300
          CALL      KY01L000 * Enter Key Fields
          BRANCH    EXIT,SC01L999,SC01L999
SC01L400
          CALL      WP01L000 * Load any WP Details
SC01L500
          CALL      LM01L000 * Load any Batch Details
SC01L600
          CALL      DF01L000 * Display Fields
SC01L700
          CALL      SF01L000 * Select Fields
          BRANCH    EXIT,SC01L100,SC01L100,SC01L200
SC01L800
SC01L900
SC01L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Options                            
.-------------------------------------------------------
CF01L000
CF01L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Options                            
.--------------------------------------------------------
KY01L000
          MOVE      ZERO,EXIT
          GOTO      KY01L999
.
KY01L900  MOVE      ONE,EXIT
KY01L999  RETURN
.---------------------------------------------------------
. Load WP files for : Options                            
.---------------------------------------------------------
WP01L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Options                            
.---------------------------------------------------------
LM01L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Options                            
.---------------------------------------------------------
DF01L000
          BRANCH   ACCEPT,DF01L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF01L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF01L900
          MATCH    PRGID,SCPSPID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF01L010 IF NOT EQUAL
.
          CALL     PS01L000 * Display Field
          GOTO     DF01L010
DF01L900
DF01L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Options                            
.---------------------------------------------------------
PS01L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS01L999,PS01L999,PS01L999,PS01L999:
                            PS01L999,PS01L999,PS01L999,PS01L999:
                            PS01L999,PS01L999,PS01L999,PS01L999:
                            PS01L999,PS01L999
          GOTO     PS01L999
PS01L999
          RETURN
.---------------------------------------------------------
. Selections for : Options                            
.---------------------------------------------------------
SF01L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF01L001  BRANCH   ACCEPT,SF01L020
.
SF01L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L006,SF01L101,SF01L102,SF01L103:
                            SF01L104,SF01L105,SF01L106,SF01L107:
                            SF01L108,SF01L109,SF01L110,SF01L111:
                            SF01L112,SF01L113
SF01L006  BEEP
          GOTO     SF01L005
SF01L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF01L090
          MATCH    PRGID,SCSLPID
          GOTO     SF01L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF01L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020
          GOTO     SF01L020
SF01L090  MOVE     ZERO,ACCEPT
          GOTO     SF01L001
.
SF01L101
          CALL      SC00L000
          MOVE      ONE,EXIT
          GOTO      SF01L999
.
SF01L102
          CALL      PROC0000
          MOVE      ONE,EXIT
          GOTO      SF01L999
.
SF01L103
          CALL      PDOC0000
          MOVE      ONE,EXIT
          GOTO      SF01L999
.
SF01L104
          CALL      PWAR0000
          MOVE      ONE,EXIT
          GOTO      SF01L999
.
SF01L105
          CALL      PICD0000
          MOVE      ONE,EXIT
          GOTO      SF01L999
.
SF01L106
          CALL      AICD0000
          MOVE      ONE,EXIT
          GOTO      SF01L999
.
SF01L107
          CALL      PMBS0000
          MOVE      ONE,EXIT
          GOTO      SF01L999
.
SF01L108
          CALL      PFUN0000
          MOVE      ONE,EXIT
          GOTO      SF01L999
.
SF01L109
          MOVE      ZERO,EXIT
          GOTO      SF01L999
.
SF01L110
          CALL      SC02L000
          MOVE      ONE,EXIT
          GOTO      SF01L999
.
SF01L111
          CALL      SC03L000
          MOVE      ONE,EXIT
          GOTO      SF01L999
.
SF01L112
          CALL      PCLI0000
          MOVE      ONE,EXIT
          GOTO      SF01L999
.
SF01L113
          CALL      PROP0000
          MOVE      ONE,EXIT
          GOTO      SF01L999
SF01L990  MOVE      ONE,EXIT * Exit Char Restart
SF01L999  RETURN
.--------------------------------
. Screen - Maintain Casemix Codes             
.--------------------------------
SC02L000
SC02L100
          MOVE      "02",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    9",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC02L200
          CALL      CF02L000 * Clear Fields
SC02L300
          CALL      KY02L000 * Enter Key Fields
          BRANCH    EXIT,SC02L999,SC02L999
SC02L400
          CALL      WP02L000 * Load any WP Details
SC02L500
          CALL      LM02L000 * Load any Batch Details
SC02L600
          CALL      DF02L000 * Display Fields
SC02L700
          CALL      SF02L000 * Select Fields
          BRANCH    EXIT,SC02L100,SC02L100,SC02L200
SC02L800
SC02L900
SC02L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Maintain Casemix Codes             
.-------------------------------------------------------
CF02L000
          MOVE      SP70,CMIXSTY 
          MOVE      SP70,CMIXKEY 
          MOVE      SP70,CMIXDES 
          MOVE      SP70,CMIXSUM 
CF02L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Maintain Casemix Codes             
.--------------------------------------------------------
KY02L000
.
KY02L110
.
.
          MOVE      "    3",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,CCSTDES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      ETYPE000
          BRANCH    EXIT,KY02L900,KY02L900
          MOVE      ZERO,ACCEPT
          MOVE      CMIXSTY,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    3",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      CCSTDES,VAR      
            CALL      DISPITEM
          ENDIF
.
KY02L120
          MOVE      "    2",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "2",CKEYTYP
          CALL      ECODE000
          BRANCH    EXIT,KY02L110,KY02L900
          MOVE      OVRCD,ACCEPT
          MOVE      CMIXKEY,VAR      
          CALL      DISPITEM
          MOVE      ZERO,EXIT
          GOTO      KY02L999
.
KY02L900  MOVE      ONE,EXIT
KY02L999  RETURN
.---------------------------------------------------------
. Load WP files for : Maintain Casemix Codes             
.---------------------------------------------------------
WP02L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Maintain Casemix Codes             
.---------------------------------------------------------
LM02L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Maintain Casemix Codes             
.---------------------------------------------------------
DF02L000
          BRANCH   ACCEPT,DF02L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF02L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF02L900
          MATCH    PRGID,SCPSPID
          GOTO     DF02L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF02L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF02L010 IF NOT EQUAL
.
          CALL     PS02L000 * Display Field
          GOTO     DF02L010
DF02L900
DF02L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Maintain Casemix Codes             
.---------------------------------------------------------
PS02L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS02L999,PS02L999,PS02L101,PS02L102:
                            PS02L103,PS02L999,PS02L999,PS02L999:
                            PS02L999,PS02L104,PS02L999,PS02L105
          GOTO     PS02L999
.
PS02L101
          MOVE      CCSTDES,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L102
          MOVE      CMIXDES,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L103
          MOVE      CMIXSUM,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L104
          MOVE      SUMDES,VAR       
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L105
          MOVE      SAVETYPE,VAR     
          CALL      DISPITEM
          GOTO     PS02L999
PS02L999
          RETURN
.---------------------------------------------------------
. Selections for : Maintain Casemix Codes             
.---------------------------------------------------------
SF02L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF02L001  BRANCH   ACCEPT,SF02L020
.
SF02L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF02L006,SF02L006,SF02L006,SF02L101:
                            SF02L102,SF02L103,SF02L104,SF02L105:
                            SF02L006,SF02L006,SF02L006,SF02L006
SF02L006  BEEP
          GOTO     SF02L005
SF02L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF02L090
          MATCH    PRGID,SCSLPID
          GOTO     SF02L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF02L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF02L020,SF02L020,SF02L020,SF02L101:
                            SF02L102,SF02L020,SF02L020,SF02L020:
                            SF02L020,SF02L020,SF02L020,SF02L020
          GOTO     SF02L020
SF02L090  MOVE     ZERO,ACCEPT
          GOTO     SF02L001
.
SF02L101
          CALL     SELECTED
          STRIP     CMIXDES 
          SFORMAT   VAR,SCPSLEN
          MOVE      CMIXDES,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,CMIXDES 
          SFORMAT   VAR,127
          ENDSET    CMIXDES 
          APPEND    SP70,CMIXDES 
          RESET     CMIXDES 
          CMATCH    EXITCHAR,CMIXDES 
          GOTO      SF02L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,CMIXDES 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L101
            ENDIF
          ENDIF
          MOVE      CMIXDES,VAR      
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L102
.
.
          MOVE      "   10",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SUMDES  
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      ESUMM000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L102
            ENDIF
            BRANCH    EXIT,SF02L102,SF02L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF02L990 IF EQUAL
          ENDIF
          MOVE      CMIXSUM,VAR      
          CALL      DISPITEM
.
.
          MOVE      "   10",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SUMDES,VAR       
            CALL      DISPITEM
          ENDIF
          GOTO     SF02L001
.
SF02L103
          CALL      POST0000
          MOVE      ONE,EXIT
          GOTO      SF02L999
.
SF02L104
          MOVE      ONE,EXIT
          GOTO      SF02L999
.
SF02L105
          CALL      DELT0000
          MOVE      ONE,EXIT
          GOTO      SF02L999
SF02L990  MOVE      ONE,EXIT * Exit Char Restart
SF02L999  RETURN
.--------------------------------
. Screen - Casemix Type Maintenance           
.--------------------------------
SC03L000
SC03L100
          MOVE      "03",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    3",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC03L200
          CALL      CF03L000 * Clear Fields
SC03L300
          CALL      KY03L000 * Enter Key Fields
          BRANCH    EXIT,SC03L999,SC03L999
SC03L400
          CALL      WP03L000 * Load any WP Details
SC03L500
          CALL      LM03L000 * Load any Batch Details
SC03L600
          CALL      DF03L000 * Display Fields
SC03L700
          CALL      SF03L000 * Select Fields
          BRANCH    EXIT,SC03L100,SC03L100,SC03L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC03L800
SC03L900
SC03L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Casemix Type Maintenance           
.-------------------------------------------------------
CF03L000
          MOVE      SP70,CCSTSTY 
          MOVE      SP70,CCSTDES 
          MOVE      ZERO,CCSTLEN 
          MOVE      SP70,CCSTJR  
          MOVE      SP70,CCSTZF  
          MOVE      SP70,CCSTDE  
CF03L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Casemix Type Maintenance           
.--------------------------------------------------------
KY03L000
.
KY03L110
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      KCCSTA00
          BRANCH    EXIT,KY03L900,KY03L900
          MOVE      ZERO,ACCEPT
          MOVE      CCSTSTY,VAR      
          CALL      DISPITEM
          MOVE      ZERO,EXIT
          GOTO      KY03L999
.
KY03L900  MOVE      ONE,EXIT
KY03L999  RETURN
.---------------------------------------------------------
. Load WP files for : Casemix Type Maintenance           
.---------------------------------------------------------
WP03L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Casemix Type Maintenance           
.---------------------------------------------------------
LM03L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Casemix Type Maintenance           
.---------------------------------------------------------
DF03L000
          BRANCH   ACCEPT,DF03L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF03L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF03L900
          MATCH    PRGID,SCPSPID
          GOTO     DF03L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF03L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF03L010 IF NOT EQUAL
.
          CALL     PS03L000 * Display Field
          GOTO     DF03L010
DF03L900
DF03L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Casemix Type Maintenance           
.---------------------------------------------------------
PS03L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS03L999,PS03L101,PS03L999,PS03L999:
                            PS03L999,PS03L999,PS03L102,PS03L103:
                            PS03L104,PS03L105
          GOTO     PS03L999
.
PS03L101
          MOVE      CCSTDES,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L102
          MOVE      CCSTLEN,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L103
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      CCSTJR,FORM2     
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L104
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      CCSTZF,FORM2     
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L105
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      CCSTDE,FORM2     
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS03L999
PS03L999
          RETURN
.---------------------------------------------------------
. Selections for : Casemix Type Maintenance           
.---------------------------------------------------------
SF03L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF03L001  BRANCH   ACCEPT,SF03L020
.
SF03L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF03L006,SF03L101,SF03L006,SF03L102:
                            SF03L103,SF03L104,SF03L105,SF03L106:
                            SF03L107,SF03L108
SF03L006  BEEP
          GOTO     SF03L005
SF03L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF03L090
          MATCH    PRGID,SCSLPID
          GOTO     SF03L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF03L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF03L020,SF03L101,SF03L020,SF03L020:
                            SF03L020,SF03L020,SF03L105,SF03L106:
                            SF03L107,SF03L108
          GOTO     SF03L020
SF03L090  MOVE     ZERO,ACCEPT
          GOTO     SF03L001
.
SF03L101
          CALL     SELECTED
          STRIP     CCSTDES 
          SFORMAT   VAR,SCPSLEN
          MOVE      CCSTDES,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,CCSTDES 
          SFORMAT   VAR,127
          ENDSET    CCSTDES 
          APPEND    SP70,CCSTDES 
          RESET     CCSTDES 
          CMATCH    EXITCHAR,CCSTDES 
          GOTO      SF03L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,CCSTDES 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF03L101
            ENDIF
          ENDIF
          MOVE      CCSTDES,VAR      
          CALL      DISPITEM
          GOTO     SF03L001
.
SF03L102
          MOVE      ONE,EXIT
          GOTO      SF03L999
.
SF03L103
          CALL      WCCST000
          MOVE      ONE,EXIT
          GOTO      SF03L999
.
SF03L104
            MOVE      ZERO,HLEF
            CALL      GETSCR00
          CALL      DELA0000
          MOVE      EXIT,SECTOR
          IF        SECTOR=0
            CALL      FRESCR00
            GOTO      SF03L999
          ENDIF
          IF        SECTOR=1
            CALL      FRESCR00
            MOVE      ZERO,EXIT
            GOTO      SF03L001
          ENDIF
          IF        SECTOR=2
            CALL      FRESCR00
            MOVE      ONE,EXIT
            GOTO      SF03L999
          ENDIF
          MOVE      "03",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    3",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      PUTSCR00
          IF        SECTOR=4
            CALL      DF03L000
          ENDIF
          GOTO      SF03L001
.
SF03L105
          CALL     SELECTED
          MOVE      SP70,VAR
          CALL      DISPITEM
          KEYIN     *PCCOL:CVERT,*V2LON,*NOMASK,*RV,CCSTLEN 
          IF        SCPSMAN=1
            COMPARE   ZERO,CCSTLEN 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF03L105
            ENDIF
          ENDIF
          MOVE      CCSTLEN,VAR      
          CALL      DISPITEM
          GOTO     SF03L001
.
SF03L106
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,CCSTJR  
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      CCSTJR,FORM2     
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF03L001
.
SF03L107
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,CCSTZF  
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      CCSTZF,FORM2     
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF03L001
.
SF03L108
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,CCSTDE  
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      CCSTDE,FORM2     
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF03L001
SF03L990  MOVE      FOUR,EXIT * Exit Char Exit
SF03L999  RETURN
.@@@@@ Function Restart Point @@@@@
.----------------------------------------
. Move one to accept to for insert mode
.----------------------------------------
MVACCEPT  MOVE      ONE,ACCEPT
          RETURN
.------------------------------------
. Load Summary Cross Reference Names
.------------------------------------
LOAD0000  STRIP     LOADNAME
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      CCSTMPAF,LOADNAME
          TRAPCLR   IO
          BRANCH    OVRCD,LOAD0090
.
          MOVE      SCSLDES,DISPMSG
          CALL      MESSAGE2
.
LOAD0010  READ      CCSTMPAF,SEQ;CCXHKEY,CCXHDES,CCXHSUM
          GOTO      LOAD0080 IF OVER
          PACK      KEY13,CCSTSTY,CCXHKEY
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          DISPLAY   *P30:24,CCXHKEY
          CALL      RACCXH1
          IF        OVRCD=0
            CALL      UPCCXH1
          ELSE
            CALL      WRCCXH1
          ENDIF
          GOTO      LOAD0010
.
LOAD0080  CALL      MESSAGE3
          MOVE      "Completed - ",DISPMSG
          CALL      MESSAGE1
          GOTO      LOAD0099
.
LOAD0090  MOVE      "File Not Found. - ",DISPMSG
          CALL      MESSAGE1
          GOTO      LOAD0099
.
LOAD0099  RETURN
.
.------------------------------------------------------------
. Process IBA Extract
.------------------------------------------------------------
PROC0000  MOVE      "1 ",KEY2
          CALL      RDCCHL1
          IF        OVRCD=1
            MOVE      SP70,CCHLPCD
          ENDIF
.
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          MATCH    SP70,CCHLPCD
          IF       @EQUAL
            OPEN     PATCODE1,"patcodes"
          ELSE
            MOVE     "patcodes",KEY8
            STRIP    CCHLPCD
            PACK     KEY80,CCHLPCD,KEY8
            OPEN     PATCODE1,KEY80
          ENDIF
          TRAPCLR  IO
          BRANCH    OVRCD,PROC9900
.
          MOVE      "D ",KEY2
          MOVE      "004",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "DD",KEY2
          MOVE      "005",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "A ",KEY2
          MOVE      "007",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "DT",KEY2
          MOVE      "008",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "S ",KEY2
          MOVE      "010",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "P ",KEY2
          MOVE      "011",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "CC",KEY2
          MOVE      "012",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "A ",KEY2
          MOVE      "014",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "DT",KEY2
          MOVE      "015",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "032",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          MOVE      ZERO,F3
PROC1000  MOVE      F3,KEY3
          REP       " 0",KEY3
          PACK      KEY13,CCSTSTY,KEY3,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=1
            CLEAR     CCXHDES
            APPEND    "Age : ",CCXHDES
            APPEND    F3,CCXHDES
            RESET     CCXHDES
            CALL      WRCCXH1
          ENDIF
          ADD       ONE,F3
          COMPARE   "150",F3
          GOTO      PROC1000 IF NOT EQUAL
.
          MOVE      "033",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          PACK      KEY13,CCSTSTY,ANSM,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      "Male",CCXHDES
            CALL      WRCCXH1
          ENDIF
.
          MOVE      "033",CCSTSTY
          PACK      KEY13,CCSTSTY,ANSF,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      "Female",CCXHDES
            CALL      WRCCXH1
          ENDIF
.
          MOVE      "C ",KEY2
          MOVE      "034",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "R ",KEY2
          MOVE      "035",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "U1",KEY2
          MOVE      "047",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "U2",KEY2
          MOVE      "048",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "U3",KEY2
          MOVE      "049",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "U4",KEY2
          MOVE      "050",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "U5",KEY2
          MOVE      "051",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "U6",KEY2
          MOVE      "052",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "U7",KEY2
          MOVE      "053",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "CL",KEY2
          MOVE      "055",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          CALL      WEKDAY00              * Add Week Days
.
          MOVE      "TB",KEY2
          MOVE      "058",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "TB",KEY2
          MOVE      "059",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "40",AUDTSECT
          READ      CONTROLF,AUDTSECT;*111,OPCNCLSU
          IF        OPCNCLSU=1
            MOVE      "DT",KEY2
          ELSE
            MOVE      "YG",KEY2
          ENDIF
          MOVE      "061",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "OA",KEY2
          MOVE      "062",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "OY",KEY2
          MOVE      "063",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "OR",KEY2
          MOVE      "064",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "Y6",KEY2
          MOVE      "065",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "Y7",KEY2
          MOVE      "066",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "Y8",KEY2
          MOVE      "067",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "Y9",KEY2
          MOVE      "068",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "OK",KEY2
          MOVE      "070",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "SP",KEY2
          MOVE      "071",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "ST",KEY2
          MOVE      "072",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "U1",KEY2
          MOVE      "073",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "ES",KEY2
          MOVE      "080",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "EA",KEY2
          MOVE      "081",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "A1",KEY2
          MOVE      "082",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "A2",KEY2
          MOVE      "083",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "A3",KEY2
          MOVE      "084",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "A4",KEY2
          MOVE      "085",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "A5",KEY2
          MOVE      "086",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "A6",KEY2
          MOVE      "087",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "A7",KEY2
          MOVE      "088",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "A8",KEY2
          MOVE      "089",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "EW",KEY2
          MOVE      "090",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "EP",KEY2
          MOVE      "091",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "AE",KEY2
          MOVE      "092",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "AR",KEY2
          MOVE      "093",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "AI",KEY2
          MOVE      "094",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "AP",KEY2
          MOVE      "095",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "AA",KEY2
          MOVE      "096",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "CV",KEY2
          MOVE      "100",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "101",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          PACK      KEY13,CCSTSTY,ONE,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      "Monday",CCXHDES
            CALL      WRCCXH1
          ENDIF
.
          PACK      KEY13,CCSTSTY,TWO,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      "Tuesday",CCXHDES
            CALL      WRCCXH1
          ENDIF
.
          PACK      KEY13,CCSTSTY,THREE,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      "Wednesday",CCXHDES
            CALL      WRCCXH1
          ENDIF
.
          PACK      KEY13,CCSTSTY,FOUR,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      "Thursday",CCXHDES
            CALL      WRCCXH1
          ENDIF
.
          PACK      KEY13,CCSTSTY,FIVE,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      "Friday",CCXHDES
            CALL      WRCCXH1
          ENDIF
.
          PACK      KEY13,CCSTSTY,SIX,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      "Saturday",CCXHDES
            CALL      WRCCXH1
          ENDIF
.
          PACK      KEY13,CCSTSTY,SEVEN,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      "Sunday",CCXHDES
            CALL      WRCCXH1
          ENDIF
.
          MOVE      "CS",KEY2
          MOVE      "102",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "DO",KEY2
          MOVE      "103",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "CA",KEY2
          MOVE      "104",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "PR",KEY2
          MOVE      "105",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "O1",KEY2
          MOVE      "106",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "O2",KEY2
          MOVE      "107",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "O3",KEY2
          MOVE      "108",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "O4",KEY2
          MOVE      "109",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "AC",KEY2
          MOVE      "110",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "OB",KEY2
          MOVE      "111",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "OL",KEY2
          MOVE      "112",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "OZ",KEY2
          MOVE      "113",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "U8",KEY2
          MOVE      "114",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "U9",KEY2
          MOVE      "115",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "U0",KEY2
          MOVE      "116",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "HP",KEY2
          MOVE      "117",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          MOVE      "HA",KEY2
          MOVE      "118",CCSTSTY
          DISPLAY   *P1:24,*EL,"Extracting Casemix Type : ",CCSTSTY
          CALL      PCODE000
.
          BEEP
          MOVE      "Extract Complete - ",DISPMSG
          CALL      MESSAGE1
          GOTO      PROC9999
.
PROC9900  BEEP
          MOVE      "Unable to Open Codes File. - ",DISPMSG
          CALL      MESSAGE1
          GOTO      PROC9999
.
PROC9999  RETURN
.
PCODE000  PACK      KEY5,KEY2,SP3
          CALL      RDSCODE1
PCODE100  CALL      RDKCODE1
          BRANCH    OVRCD,PCODE900
          MATCH     KEY2,TCODE
          GOTO      PCODE900 IF NOT EQUAL
          PACK      KEY13,CCSTSTY,ACODE,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=0
            MOVE      TDESC,CCXHDES
            CALL      UPCCXH1
          ELSE
            MOVE      TDESC,CCXHDES
            CALL      WRCCXH1
          ENDIF
          GOTO      PCODE100
.
PCODE900  RETURN
.
WEKDAY00  MOVE      "056",CCSTSTY
          PACK      KEY13,CCSTSTY,ONE,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      "Monday",CCXHDES
            CALL      WRCCXH1
          ENDIF
.
          MOVE      "056",CCSTSTY
          PACK      KEY13,CCSTSTY,TWO,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      "Tuesday",CCXHDES
            CALL      WRCCXH1
          ENDIF
.
          MOVE      "056",CCSTSTY
          PACK      KEY13,CCSTSTY,THREE,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      "Wednesday",CCXHDES
            CALL      WRCCXH1
          ENDIF
.
          MOVE      "056",CCSTSTY
          PACK      KEY13,CCSTSTY,FOUR,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      "Thursday",CCXHDES
            CALL      WRCCXH1
          ENDIF
.
          MOVE      "056",CCSTSTY
          PACK      KEY13,CCSTSTY,FIVE,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      "Friday",CCXHDES
            CALL      WRCCXH1
          ENDIF
.
          MOVE      "056",CCSTSTY
          PACK      KEY13,CCSTSTY,SIX,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      "Saturday",CCXHDES
            CALL      WRCCXH1
          ENDIF
.
          MOVE      "056",CCSTSTY
          PACK      KEY13,CCSTSTY,SEVEN,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      "Sunday",CCXHDES
            CALL      WRCCXH1
          ENDIF
.
          MOVE      "057",CCSTSTY
          PACK      KEY13,CCSTSTY,ONE,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      "Monday",CCXHDES
            CALL      WRCCXH1
          ENDIF
.
          MOVE      "057",CCSTSTY
          PACK      KEY13,CCSTSTY,TWO,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      "Tuesday",CCXHDES
            CALL      WRCCXH1
          ENDIF
.
          MOVE      "057",CCSTSTY
          PACK      KEY13,CCSTSTY,THREE,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      "Wednesday",CCXHDES
            CALL      WRCCXH1
          ENDIF
.
          MOVE      "057",CCSTSTY
          PACK      KEY13,CCSTSTY,FOUR,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      "Thursday",CCXHDES
            CALL      WRCCXH1
          ENDIF
.
          MOVE      "057",CCSTSTY
          PACK      KEY13,CCSTSTY,FIVE,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      "Friday",CCXHDES
            CALL      WRCCXH1
          ENDIF
.
          MOVE      "057",CCSTSTY
          PACK      KEY13,CCSTSTY,SIX,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      "Saturday",CCXHDES
            CALL      WRCCXH1
          ENDIF
.
          MOVE      "057",CCSTSTY
          PACK      KEY13,CCSTSTY,SEVEN,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=1
            MOVE      "Sunday",CCXHDES
            CALL      WRCCXH1
          ENDIF
          RETURN
.
.------------------------------------------------------------
. PDOCess IBA Extract
.------------------------------------------------------------
PDOC0000  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PATDO1A1,"patdo1af"
          TRAPCLR   IO
          BRANCH    OVRCD,PDOC9900
.
          DISPLAY   *P1:24,*EL,"Extracting Doctor Codes : "
          PACK      KEY6,SP70
          CALL      RDSDOCT1
PDOC1000  CALL      RDKDOCT1
          BRANCH    OVRCD,PDOC9000
          DISPLAY   *P27:24,*V2LON,DCODE
          MOVE      "016",CCSTSTY
          CALL      UPDOC000
.
          MOVE      "017",CCSTSTY
          CALL      UPDOC000
.
          MOVE      "018",CCSTSTY
          CALL      UPDOC000
.
          MOVE      "019",CCSTSTY
          CALL      UPDOC000
.
          GOTO      PDOC1000
.
PDOC9000  BEEP
          MOVE      "Extract Complete - ",DISPMSG
          CALL      MESSAGE1
          GOTO      PDOC9999
.
PDOC9900  BEEP
          MOVE      "Unable to Open Doctors File. - ",DISPMSG
          CALL      MESSAGE1
          GOTO      PDOC9999
.
PDOC9999  RETURN
.
UPDOC000  PACK      KEY13,CCSTSTY,DCODE,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=0
            STRIP     DTITL
            MOVE      DGNAME,ANS
            MOVE      ".",KEY1
            PACK      CCXHDES,DTITL,SP1,ANS,KEY1,DSNAME
            CALL      UPCCXH1
          ELSE
            STRIP     DTITL
            MOVE      DGNAME,ANS
            MOVE      ".",KEY1
            PACK      CCXHDES,DTITL,SP1,ANS,KEY1,DSNAME
            CALL      WRCCXH1
          ENDIF
          RETURN
.------------------------------------------------------------
. Ward IBA Extract
.------------------------------------------------------------
PWAR0000  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PATWR1A3,"patwr1af"
          TRAPCLR   IO
          BRANCH    OVRCD,PWAR9900
.
          DISPLAY   *P1:24,*EL,"Extracting Ward Names : "
          PACK      KEY6,SP70
          CALL      RDSWARD3
PWAR1000  CALL      RDKWARD3
          BRANCH    OVRCD,PWAR9000
          MATCH     SP70,WBED
          GOTO      PWAR9000 IF NOT EQUAL
          DISPLAY   *P27:24,*V2LON,WWARD
          MOVE      "003",CCSTSTY
          CALL      UPWAR000
.
          MOVE      "009",CCSTSTY
          CALL      UPWAR000
.
          GOTO      PWAR1000
.
PWAR9000  BEEP
          MOVE      "Extract Complete - ",DISPMSG
          CALL      MESSAGE1
          GOTO      PWAR9999
.
PWAR9900  BEEP
          MOVE      "Unable to Open Ward File. - ",DISPMSG
          CALL      MESSAGE1
          GOTO      PWAR9999
.
PWAR9999  RETURN
.
UPWAR000  PACK      KEY13,CCSTSTY,WWARD,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=0
            PACK      CCXHDES,WBDESC,SP70
            CALL      UPCCXH1
          ELSE
            PACK      CCXHDES,WBDESC,SP70
            CALL      WRCCXH1
          ENDIF
          RETURN
.------------------------------------------------------------
. IBA Extract
.------------------------------------------------------------
PICD0000  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          CALL      OPICD1
          TRAPCLR   IO
          BRANCH    OVRCD,PICD9910
.
          DISPLAY   *P1:24,*EL,"Extracting ICD Diagnosis Headers : "
          MOVE      ZERO,SECTOR
          PACK      KEY9,SP70
          CALL      RDSICD1
PICD1000  CALL      RDKICD1
          BRANCH    OVRCD,PICD1900
          ADD       ONE,SECTOR
          IF        (SECTOR%100=0)
            DISPLAY   *P40:24,*V2LON,SECTOR
          ENDIF
          MATCH     "H",DFLAG
          GOTO      PICD1000 IF NOT EQUAL
.
          MOVE      "028",CCSTSTY
          CALL      UPICD000
.
          MOVE      "029",CCSTSTY
          CALL      UPICD000
.
          GOTO      PICD1000
.
PICD1900  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          CALL      OPICO1
          TRAPCLR   IO
          BRANCH    OVRCD,PICD9920
.
          DISPLAY   *P1:24,*EL,"Extracting ICD Operation Headers : "
          MOVE      ZERO,SECTOR
          PACK      KEY9,SP70
          CALL      RDSICO1
PICD2000  CALL      RDKICO1
          BRANCH    OVRCD,PICD2900
          ADD       ONE,SECTOR
          IF        (SECTOR%100=0)
            DISPLAY   *P40:24,*V2LON,SECTOR
          ENDIF
.
          MATCH     "H",OFLAG
          GOTO      PICD2000 IF NOT EQUAL
.
          MOVE      "030",CCSTSTY
          CALL      UPICO000
.
          MOVE      "031",CCSTSTY
          CALL      UPICO000
.
          GOTO      PICD2000
.
PICD2900  BEEP
          MOVE      "Extract Complete - ",DISPMSG
          CALL      MESSAGE1
          GOTO      PICD9999
.
PICD9910  BEEP
          MOVE      "Unable to Open ICD Diagnosis File. - ",DISPMSG
          CALL      MESSAGE1
          GOTO      PICD9999
.
PICD9920  BEEP
          MOVE      "Unable to Open ICD Operation File. - ",DISPMSG
          CALL      MESSAGE1
          GOTO      PICD9999
.
PICD9999  RETURN
.
UPICD000  PACK      KEY13,CCSTSTY,DPCODE,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=0
            SQUEEZE   DPCODE
            PACK      CCXHDES,DPCODE,SP1,DDESC,SP70
            CALL      UPCCXH1
          ELSE
            SQUEEZE   DPCODE
            PACK      CCXHDES,DPCODE,SP1,DDESC,SP70
            CALL      WRCCXH1
          ENDIF
          RETURN
.
UPICO000  PACK      KEY13,CCSTSTY,OPCODE,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=0
            SQUEEZE   OPCODE
            PACK      CCXHDES,OPCODE,SP1,ODESC,SP70
            CALL      UPCCXH1
          ELSE
            SQUEEZE   OPCODE
            PACK      CCXHDES,OPCODE,SP1,ODESC,SP70
            CALL      WRCCXH1
          ENDIF
          RETURN
.------------------------------------------------------------
. IBA Extract All ICD Codes to Xref File
.------------------------------------------------------------
AICD0000  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
..          OPEN      PATICDD1,"paticddf"
          CALL      OPICD1
          TRAPCLR   IO
          BRANCH    OVRCD,AICD9910
.
          DISPLAY   *P1:24,*EL,"Extracting ICD Diagnosis Codes   : "
          MOVE      ZERO,SECTOR
          PACK      KEY9,SP70
          CALL      RDSICD1
AICD1000  CALL      RDKICD1
          BRANCH    OVRCD,AICD1900
          ADD       ONE,SECTOR
          IF        SECTOR%100=0
            DISPLAY   *P40:24,*V2LON,SECTOR
          ENDIF
.
          MATCH     "H",DFLAG
          GOTO      AICD1100 IF EQUAL
.
          MOVE      "023",CCSTSTY
          CALL      UPICD000
          MOVE      "024",CCSTSTY
          CALL      UPICD000
          GOTO      AICD1000
.
AICD1100  MOVE      "028",CCSTSTY
          CALL      UPICD000
          MOVE      "029",CCSTSTY
          CALL      UPICD000
          GOTO      AICD1000
.
AICD1900  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
..          OPEN      PATICDO1,"paticdof"
          CALL      OPICO1
          TRAPCLR   IO
          BRANCH    OVRCD,AICD9920
.
          DISPLAY   *P1:24,*EL,"Extracting ICD Operation Codes   : "
          MOVE      ZERO,SECTOR
          PACK      KEY9,SP70
          CALL      RDSICO1
AICD2000  CALL      RDKICO1
          BRANCH    OVRCD,AICD2900
          ADD       ONE,SECTOR
          IF        SECTOR%100=0
            DISPLAY   *P40:24,*V2LON,SECTOR
          ENDIF
.
          MATCH     "H",OFLAG
          GOTO      AICD2100 IF EQUAL
.
          MOVE      "025",CCSTSTY
          CALL      UPICO000
          MOVE      "026",CCSTSTY
          CALL      UPICO000
          GOTO      AICD2000
.
AICD2100  MOVE      "030",CCSTSTY
          CALL      UPICO000
          MOVE      "031",CCSTSTY
          CALL      UPICO000
          GOTO      AICD2000
.
AICD2900  BEEP
          MOVE      "Extract Complete - ",DISPMSG
          CALL      MESSAGE1
          GOTO      AICD9999
.
AICD9910  BEEP
          MOVE      "Unable to Open ICD Diagnosis File. - ",DISPMSG
          CALL      MESSAGE1
          GOTO      AICD9999
.
AICD9920  BEEP
          MOVE      "Unable to Open ICD Operation File. - ",DISPMSG
          CALL      MESSAGE1
          GOTO      AICD9999
.
AICD9999  RETURN
.
.------------------------------------------------------------
. IBA Extract
.------------------------------------------------------------
PMBS0000  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PATITEM1,"patitemn"
          TRAPCLR   IO
          BRANCH    OVRCD,PMBS9910
.
          DISPLAY   *P1:24,*EL,"Extracting MBS Codes             : "
          MOVE      ZERO,SECTOR
          PACK      KEY9,SP70
          CALL      RDSITEM1
PMBS1000  CALL      RDKITEM1
          BRANCH    OVRCD,PMBS1900
          ADD       ONE,SECTOR
          IF        (SECTOR%100=0)
            DISPLAY   *P40:24,*V2LON,SECTOR
          ENDIF
.
          MOVE      "006",CCSTSTY
          CALL      UPMBS000
.
          MOVE      "013",CCSTSTY
          CALL      UPMBS000
.
          MOVE      "045",CCSTSTY
          CALL      UPMBS000
.
          MOVE      "046",CCSTSTY
          CALL      UPMBS000
.
          GOTO      PMBS1000
.
PMBS1900  BEEP
          MOVE      "Extract Complete - ",DISPMSG
          CALL      MESSAGE1
          GOTO      PMBS9999
.
PMBS9910  BEEP
          MOVE      "Unable to Open MBS Item File. - ",DISPMSG
          CALL      MESSAGE1
          GOTO      PMBS9999
.
PMBS9999  RETURN
.
UPMBS000  PACK      KEY13,CCSTSTY,ITEMNO,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=0
            SQUEEZE   ITEMNO
            PACK      CCXHDES,ITEMNO,SP1,IDESC,SP70
            CALL      UPCCXH1
          ELSE
            SQUEEZE   ITEMNO
            PACK      CCXHDES,ITEMNO,SP1,IDESC,SP70
            CALL      WRCCXH1
          ENDIF
          RETURN
.
.------------------------------------------------------------
. IBA Extract
.------------------------------------------------------------
PFUN0000  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PATFN1A1,"patfn1af"
          TRAPCLR   IO
          BRANCH    OVRCD,PFUN9910
.
          DISPLAY   *P1:24,*EL,"Extracting Health Fund Tables    : "
          MOVE      ZERO,SECTOR
          PACK      KEY14,SP70
          CALL      RDSFUND1
PFUN1000  CALL      RDKFUND1
          BRANCH    OVRCD,PFUN1900
          ADD       ONE,SECTOR
          IF        (SECTOR%100=0)
            DISPLAY   *P40:24,*V2LON,SECTOR
          ENDIF
.
          MATCH     "0000",HFTABL
          IF        @EQUAL
            CALL      UPFUN000
          ENDIF
.
          GOTO      PFUN1000
.
PFUN1900  BEEP
          MOVE      "Extract Complete - ",DISPMSG
          CALL      MESSAGE1
          GOTO      PFUN9999
.
PFUN9910  BEEP
          MOVE      "Unable to Open Health Fund File. - ",DISPMSG
          CALL      MESSAGE1
          GOTO      PFUN9999
.
PFUN9999  RETURN
.
UPFUN000  MOVE      "020",CCSTSTY
          PACK      KEY13,CCSTSTY,HCODE,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=0
            PACK      CCXHDES,HFNAME,SP1,HCODE,SP70
            CALL      UPCCXH1
          ELSE
            PACK      CCXHDES,HFNAME,SP1,HCODE,SP70
            CALL      WRCCXH1
          ENDIF
          RETURN
.
UPTAB000  MOVE      "021",CCSTSTY
          PACK      KEY13,CCSTSTY,HFTABL,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=0
            PACK      CCXHDES,HFNAME,SP70
            CALL      UPCCXH1
          ELSE
            PACK      CCXHDES,HFNAME,SP70
            CALL      WRCCXH1
          ENDIF
          RETURN
.
.------------------------------------------------------------
. Process Clinic & Op Room Details IBA Extract
.------------------------------------------------------------
PCLI0000  CALL      OPNOPR00
          DISPLAY   *P1:24,*EL,"Extracting Theatre Codes : "
.
          BRANCH    OPROPROP,PCLI9900
          PACK      KEY6,SP70
          CALL      RSOPOPR1
PCLI1000  CALL      RKOPOPR1
          BRANCH    OVRCD,PCLI2000
          DISPLAY   *P27:24,*V2LON,OPRMROOM
          MOVE      "069",CCSTSTY
          PACK      KEY13,CCSTSTY,OPRMROOM,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=0
            MOVE      OPRMDESC,CCXHDES
            CALL      UPCCXH1
          ELSE
            MOVE      OPRMDESC,CCXHDES
            CALL      WRCCXH1
          ENDIF
          GOTO      PCLI1000
.
.
PCLI2000  BRANCH    OPCNCLSU,PCLI4000
.
. Using Clinic Details
.
          BRANCH    OPRCLIOP,PCLI9900
          PACK      KEY6,SP70
          CALL      RSOPCLI1
PCLI3000  CALL      RKOPCLI1
          BRANCH    OVRCD,PCLI9000
          DISPLAY   *P27:24,*V2LON,OPCLCLIN
          MOVE      "060",CCSTSTY
          PACK      KEY13,CCSTSTY,OPCLCLIN,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=0
            MOVE      OPCLDESC,CCXHDES
            CALL      UPCCXH1
          ELSE
            MOVE      OPCLDESC,CCXHDES
            CALL      WRCCXH1
          ENDIF
          GOTO      PCLI3000
.
. Using Surgeon Details
.
PCLI4000  BRANCH    PATDOCOP,PCLI9900
          PACK      KEY6,SP70
          CALL      RDSDOCT1
PCLI5000  CALL      RDKDOCT1
          BRANCH    OVRCD,PCLI9000
          DISPLAY   *P27:24,*V2LON,DCODE
          MOVE      "060",CCSTSTY
          CALL      UPDOC000
          GOTO      PCLI5000
.
PCLI9000  BEEP
          MOVE      "Extract Complete - ",DISPMSG
          CALL      MESSAGE1
          GOTO      PCLI9999
.
PCLI9900  BEEP
          MOVE      "Unable to Open Files. - ",DISPMSG
          CALL      MESSAGE1
          GOTO      PCLI9999
.
PCLI9999  RETURN
.------------------------------------------------------------
. Open Files Required for OPR Interface
.------------------------------------------------------------
OPNOPR00  READ      CONTROLF,FORTY;*111,OPCNCLSU
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PATDO1A1,"patdo1af"
          TRAPCLR   IO
          MOVE      OVRCD,PATDOCOP
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      OPRCLIA1,"oprcliaf"
          TRAPCLR   IO
          MOVE      OVRCD,OPRCLIOP
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      OPROPRA1,"opropraf"
          TRAPCLR   IO
          MOVE      OVRCD,OPROPROP
.
OPNOPR99  RETURN
.------------------------------------------------------------
. Process Outpatient Codes
.------------------------------------------------------------
PROP0000  OPEN      OUTCLIA1,"outcliaf"
          OPEN      OUTSITA1,"outsitaf"
          OPEN      OUTCTYA1,"outctyaf"
.
          PACK      KEY6,SP70
          CALL      RDSSITA1
PROP1000  CALL      RDKSITA1
          BRANCH    OVRCD,PROP1900
          DISPLAY   *P27:24,*V2LON,OSTSITE
          MOVE      "097",CCSTSTY
          PACK      KEY13,CCSTSTY,OSTSITE,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=0
            MOVE      OSTDESC,CCXHDES
            CALL      UPCCXH1
          ELSE
            MOVE      OSTDESC,CCXHDES
            CALL      WRCCXH1
          ENDIF
          GOTO      PROP1000
.
PROP1900  PACK      KEY12,SP70
          CALL      RDSCTYA1
PROP2000  CALL      RDKCTYA1
          BRANCH    OVRCD,PROP2900
          DISPLAY   *P27:24,*V2LON,OCTCTYP
          MOVE      "099",CCSTSTY
          PACK      KEY13,CCSTSTY,OCTCTYP,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=0
            MOVE      OCTDESC,CCXHDES
            CALL      UPCCXH1
          ELSE
            MOVE      OCTDESC,CCXHDES
            CALL      WRCCXH1
          ENDIF
          GOTO      PROP2000
.
PROP2900  PACK      D8,CCC,CYY,CMM,CDD
          REP       " 0",D8
          PACK      SOCACLIN,SP70
          PACK      SOCADESC,SP70
          PACK      KEY20,SP70
          CALL      RDSCLIA1
.
PROP3000  CALL      RDKCLIA1
          BRANCH    OVRCD,PROP5000
          DISPLAY   *P27:24,*V2LON,OCACLIN
.
          MATCH     OCACLIN,SOCACLIN
          GOTO      PROP4000 IF NOT EQUAL
.
          MATCH     OCADATE,D8
          GOTO      PROP3000 IF LESS
.
PROP3500  MOVE      OCACLIN,SOCACLIN
          MOVE      OCADESC,SOCADESC
          GOTO      PROP3000
.
PROP4000  MATCH     SP6,SOCACLIN
          GOTO      PROP3500 IF EQUAL
.
          MOVE      "098",CCSTSTY
          PACK      KEY13,CCSTSTY,SOCACLIN,SP70
          UNPACK    KEY13,CCXHSTY,CCXHKEY
          CALL      RDCCXH1
          IF        OVRCD=0
            MOVE      SOCADESC,CCXHDES
            CALL      UPCCXH1
          ELSE
            MOVE      SOCADESC,CCXHDES
            CALL      WRCCXH1
          ENDIF
          GOTO      PROP3500
.
PROP5000
.
PROP9999  RETURN

ETYPE000  MATCH    SP70,SAVETYPE
          GOTO     ETYPE500 IF NOT EQUAL
.
ETYPE100  MOVE     ZERO,CKEYTYP
          CALL     KCCSTA00
          BRANCH   EXIT,ETYPE999,ETYPE999
          MOVE     CCSTSTY,CCXHSTY
          MOVE     CCSTSTY,SAVETYPE
          MOVE     CCSTSTY,CMIXSTY
          GOTO     ETYPE999
.
ETYPE500  MOVE     SAVETYPE,KEY3
          CALL     RDCCST1
          BRANCH   OVRCD,ETYPE100
          MOVE     CCSTSTY,CCXHSTY
          MOVE     CCSTSTY,CMIXSTY
.
ETYPE999  RETURN

.---------------------------------------------------------------------------
. Enter Casemix Code
.-------------------------------------------------------------------------------
ECODE000  TOPIC     "CCXHKEY "
          MOVE      CMIXSTY,CCXHSTY
          SFORMAT   VAR,CCSTLEN
          MATCH     "1",CCSTJR
          IF        @EQUAL
            KEYIN     *PCCOL:CVERT,*V2LON,*JR,VAR
          ELSE
            KEYIN     *PCCOL:CVERT,*V2LON,VAR
          ENDIF
.
          MATCH     "1",CCSTZF
          IF        @EQUAL
            REP       " 0",VAR
          ENDIF
.
          DISPLAY     *PCCOL:CVERT,*V2LON,VAR
.
          ENDSET    VAR
          APPEND    SP70,VAR
          RESET     VAR
.
          MATCH     SP70,VAR
          GOTO      ECODE090 IF EQUAL
.
          MATCH     "1",CCSTJR
          IF        @EQUAL
            ENDSET    VAR
          ENDIF
          CMATCH    EXITCHAR,VAR
          GOTO      ECODE095 IF EQUAL
.
          CMATCH    QUEST,VAR
          GOTO      ECODE010 IF NOT EQUAL
.
          MOVE      CCITEM,SCCITEM
          CALL      HCCXHA00
          MOVE      SCCITEM,CCITEM
.
          ENDSET    CCXHKEY
          APPEND    SP70,CCXHKEY
          RESET     CCXHKEY
.
          MATCH     SP70,CCXHKEY
          GOTO      ECODE000 IF EQUAL
          MOVE      CCXHKEY,VAR
.
          DISPLAY   *PCCOL:CVERT,*V2LON,VAR
ECODE010
          RESET     VAR
          MATCH     "1",CCSTDE
          IF        @EQUAL
            TYPE      VAR
            GOTO      ECODE015 IF EQUAL
            BEEP
            GOTO      ECODE000
          ENDIF
ECODE015
          MOVE      VAR,CCXHKEY
          MOVE      CCXHKEY,CMIXKEY
          PACK      KEY13,CCXHSTY,VAR
          CALL      RACCXH1
          BRANCH    OVRCD,ECODE080
          BRANCH    CKEYTYP,ECODE075
          CALL      RDCCXH1
          MOVE      CCXHSTY,CMIXSTY
          MOVE      CCXHKEY,CMIXKEY
          MOVE      CCXHDES,CMIXDES
          MOVE      CCXHSUM,CMIXSUM
.
          MOVE      CMIXSTY,F3
          ADD       "200",F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
          PACK      KEY13,KEY3,CCXHSUM
          CALL      RDCCXH1
          IF        OVRCD=0
            MOVE      CCXHDES,SUMDES
          ELSE
            MOVE      SP70,SUMDES
          ENDIF
          PACK      KEY13,CMIXSTY,CMIXKEY
          CALL      RDCCXH1
.
ECODE070
          MOVE      ZERO,EXIT
          GOTO      ECODE099
ECODE075
          MOVE      "Code Already Exist - ",DISPMSG
          CALL      MESSAGE1
          GOTO      ECODE000
ECODE080
          MOVE      ZERO,EXIT
          BRANCH    CKEYTYP,ECODE099,ECODE099
          MOVE      "Code Does Not Exist - ",DISPMSG
          CALL      MESSAGE1
          GOTO      ECODE000
ECODE085
          MOVE      SP70,CCXHKEY
          MOVE      SP70,CMIXKEY
          MOVE      ZERO,EXIT
          GOTO      ECODE099
ECODE090  MOVE      SP70,SAVETYPE
          MOVE      ONE,EXIT
          GOTO      ECODE099
ECODE095
          MOVE      TWO,EXIT
ECODE099  SFORMAT   VAR,127
          TOPIC     PRGID
          RETURN
.----------------------------------------------------------------------
. Enter Casemix Summary Codes
.----------------------------------------------------------------------
ESUMM000  MOVE    ZERO,CKEYTYP
          MOVE    CMIXSTY,F3
          IF      F3>200
            GOTO    ESUMM900
          ENDIF
.
          ADD     "200",F3
          MOVE    F3,CCXHSTY
          REP     " 0",CCXHSTY
          CALL    KCCXHA00
          BRANCH  EXIT,ESUMM900,ESUMM999
          MOVE    CCXHKEY,CMIXSUM
          MOVE    CCXHDES,SUMDES
          GOTO    ESUMM999
.
ESUMM900  MOVE    SP70,SUMDES
          MOVE    SP70,CMIXSUM
ESUMM999  RETURN
.
.------------------------------------
. Save Casemix Code Details
.------------------------------------
POST0000  MOVE      CMIXSTY,CCXHSTY
          MOVE      CMIXKEY,CCXHKEY
          MOVE      CMIXDES,CCXHDES
          MOVE      CMIXSUM,CCXHSUM
          MOVE      SP70,CCXHSPA
          PACK      KEY13,CCXHSTY,CCXHKEY
          CALL      RACCXH1
          IF        OVRCD=0
            CALL      UPCCXH1
          ELSE
            CALL      WRCCXH1
          ENDIF
.
          RETURN
.------------------------------------
. Save Summary File Details
.------------------------------------
DELT0000  PACK      KEY13,CMIXSTY,CMIXKEY
          CALL      RACCXH1
          IF        OVRCD=0
            CALL      DECCXH1
          ENDIF
          RETURN
.------------------------------------
. Update Summary Type
.------------------------------------
WCCST000  PACK      KEY3,CCSTSTY
          CALL      RACCST1
          IF        OVRCD=0
            CALL      UPCCST1
          ENDIF
          RETURN
DELA0000  MOVE     SP70,DISPMSG        * Clear Line 24 Display Message
          CALL     MESSAGE2            * Save and Clear Line 24
          CALL     DELQST              * Delete (Y/N/C) CEXIT 1/2/3
          CALL     MESSAGE3            * Restore Line 24
          BRANCH   CEXIT,DELA1000,DELA9000,DELA9100
.
DELA1000  PACK     KEY13,CCSTSTY,SP70
          CALL     RACCXH1
          CALL     RKCCXH1
          BRANCH   OVRCD,DELA1900
          MATCH    CCXHSTY,CCSTSTY
          GOTO     DELA1900 IF EQUAL
          PACK     KEY13,CCXHSTY,CCXHKEY
          CALL     DECCXH1             * Delete Record
          GOTO     DELA1000
.
DELA1900  MOVE     TWO,EXIT            * Restart Screen
          GOTO     DELA9999
.
DELA9000  MOVE     ONE,EXIT            * Return to Prompt on "No"
          GOTO     DELA9999
.
DELA9100  MOVE     TWO,EXIT            * Restart Screen on "Cancel"
          GOTO     DELA9999
.
DELA9999  RETURN
.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       CCSHLCIO/INC
          INC       CCSSTYIO/INC
          INC       CCSSTYKY    
          INC       CCSXHDIO/INC
          INC       CCSXHDKY    
          INC       OPRCLIIO/INC
          INC       OPROPRIO/INC
          INC       OUTCLIIO/INC
          INC       OUTCTYIO/INC
          INC       OUTSITIO/INC
          INC       PATCODIO/INC
          INC       PATDGWIO/INC
          INC       PATDO1IO/INC
          INC       PATFN1IO/INC
          INC       PATICDIO/INC
          INC       PATICOIO/INC
          INC       PATITMIO/INC
          INC       PATWR1IO/INC
.
          INC       STDGENCD
.

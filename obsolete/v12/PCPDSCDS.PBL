.****************************************************************************
.*                             PCPDSCDS                                     *
.* Description : Display codes for patient care plan database maintenance   *
.*                                                                          *
.* Requirements : Set up PCDSTYPE before calling                            *
.*                                                                          *
.* Date : 2/1/90                                                            *
.*                                                                          *
.* Programmer : Glen Hobby                                                  *
.*                                                                          *
.* Modifications :                                                          *
.*      V9.02.00  30/12/2002  Tracey Nguyen  srf 23497                      *
.*                r5.10 Care Plans Port to V9                               *
.****************************************************************************
.* Modifications : 19/04/95 Whirlpool                                       *
.*                          Fixed so it works - G.Hobby is a spastic        *
.*                          (part of it anyway this is nightmare)           *
.*                 27/09/1996  Steve Armstrong                              *
.*                             Fixed bug in "?" routine, change mode, option*
.*                             5 for clinic condition                       *
.*                                                                          *
.****************************************************************************
PCPDSCDS  MOVE       PCDSTYPE,FORM2
          MOVE       ZERO,FORM1
.
.         In INSERT mode we can display the codes.  In CHANGE and DELETE we
.         need to check the PCPDBSFD file as well so this display will be 
.         split into two
.
.         Special case: Use routines at SEMD500 if we are doing ? on 
.         CLINIC CONDITIONS when keyin in the clinic condition.  Use SEMD100
.         if we are doing ? on Related factors
.
          COMPARE    FIVE,OPTION
          GOTO       SEMD010 IF NOT EQUAL
          COMPARE    TWO,PCDSTYPE             * Clinic condition
          GOTO       SEMD500 IF EQUAL
          COMPARE    EIGHT,PCDSTYPE           * Related factors
          GOTO       SEMD100 IF EQUAL
.
SEMD010   BRANCH     CHOOZ,SEMD100,SEMD500,SEMD500 * Insert, Change, Delete
.
.  ****** INSERT ******
.
SEMD100   MOVE       ZERO,SCREENNO          * initialise the screen
          BRANCH     PCDSTYPE,SEMD110,SEMD120,SEMD130,SEMD140,SEMD150,SEMD160
.
          COMPARE    EIGHT,PCDSTYPE
          GOTO       SEMD165 IF EQUAL
.
SEMD110   DISPLAY    *P1:4,*EF,*P28:4,*V2LON,*ULON,"TYPE OF CONDITIONS"
          GOTO       SEMD170
.
SEMD120   DISPLAY    *P1:4,*EF,*P28:4,*V2LON,*ULON,"CLINIC CONDTIONS"
          GOTO       SEMD170
.
SEMD130   DISPLAY    *P1:4,*EF,*P28:4,*V2LON,*ULON,"HEALTH PATTERNS"
          GOTO       SEMD170
.
SEMD140   DISPLAY    *P1:4,*EF,*P28:4,*V2LON,*ULON,"RESPONSE PATTERNS"
          GOTO       SEMD170
.
SEMD150   DISPLAY    *P1:4,*EF,*P28:4,*V2LON,*ULON,"ABC PRN REST CODES"
          GOTO       SEMD170
.
SEMD160   DISPLAY    *P1:4,*EF,*P28:4,*V2LON,*ULON,"DIAGNOSIS CODES"
          GOTO       SEMD170
.
SEMD165   DISPLAY    *P1:4,*EF,*P28:4,*V2LON,*ULON,"RELATED FACTORS"
.
SEMD170   MOVE       SIX,CVERT
          MOVE       ONE,CCOL
          MOVE       FORM2,PCDSTYPE
          PACK       KEY13,PCDSTYPE,SP20
          CALL       RSPCDSC1
.
SEMDS222  CALL       RKPCDSC1
          BRANCH     OVRCD,SEMD240 
          COMPARE    PCDSTYPE,FORM2          * Have we read too far?
          GOTO       SEMD240 IF NOT EQUAL
.
          MATCH      SP60,PCDSDESC
          GOTO       SEMDS222 IF EQUAL      * Don't display spaces
.
          COMPARE    ONE,PCDSLINE
          GOTO       SEMDS222 IF NOT EQUAL
.
          ADD        ONE,CVERT
SEMD230   CALL       SCRFNC00
          MOVE       ZERO,FORM1
          BRANCH     EXIT,SEMDS222,SEMD170
          GOTO       SEMD900
SEMD240   IF         SCREENNO <> 0
            MOVE       ONE,FORM1
            GOTO       SEMD230
          ENDIF
          GOTO       SEMD900
.
.  ****** CHANGE/DELETE ******
.
SEMD500   MOVE       ZERO,SCREENNO          * initialise the screen
          BRANCH     PCDSTYPE,SEMD510,SEMD520,SEMD530,SEMD540,SEMD550,SEMD560
.
          COMPARE    EIGHT,PCDSTYPE
          GOTO       SEMD565 IF EQUAL
.
SEMD510   DISPLAY    *P1:4,*EF,*P28:4,*V2LON,*ULON,"TYPE OF CONDITIONS ON FILE"
          GOTO       SEMD570
.
SEMD520   DISPLAY    *P1:4,*EF,*P28:4,*V2LON,*ULON,"CLINIC CONDTIONS ON FILE"
          GOTO       SEMD570
.
SEMD530   DISPLAY    *P1:4,*EF,*P28:4,*V2LON,*ULON,"HEALTH PATTERNS ON FILE"
          GOTO       SEMD570
.
SEMD540   DISPLAY    *P1:4,*EF,*P28:4,*V2LON,*ULON,"RESPONSE PATTERNS ON FILE"
          GOTO       SEMD570
.
SEMD550   DISPLAY    *P1:4,*EF,*P28:4,*V2LON,*ULON,"ABC PRN REST CODES ON FILE"
          GOTO       SEMD570
.
SEMD560   DISPLAY    *P1:4,*EF,*P28:4,*V2LON,*ULON,"DIAGNOSIS CODES ON FILE"
          GOTO       SEMD570
.
SEMD565   DISPLAY    *P1:4,*EF,*P28:4,*V2LON,*ULON,"RELATED FACTORS ON FILE"
.
.         When we post we post to the PCPDBSAF file, so read this file to
.         see if we have anything to display for the ? routine.  If we have
.         look up the PCPDSCFD file for the description.
.
SEMD570   MOVE      SIX,CVERT
          MOVE      ONE,CCOL
          BRANCH    FLAGZ,SEMD571,SEMD592,SEMD596,SEMD600,SEMD610,SEMD615:
                          SEMD620,SEMD630,SEMD640,SEMD650,SEMD655
          GOTO      SEMD700 
.
.         Health pattern - delete mode - diagnosis code
.
SEMD571   MOVE      CODEE,PCDBCLSS      * Health pattern code
          MOVE      THREE,PCDBTYPE
          PACK      KEY20,PCDBTYPE,PCDBCLSS,SP20
          CALL      RSPCDBS1
SEMD575   CALL      RKPCDBS1
          BRANCH    OVRCD,SEMD591
.
          COMPARE   THREE,PCDBTYPE          
          GOTO      SEMD591 IF NOT EQUAL
.
          MATCH     CODEE,PCDBCLSS
          GOTO      SEMD591 IF NOT EQUAL
.
.         Now get description
.
          MOVE      PCDBCODE,PCDSCODE
          MOVE      ONE,PCDSLINE 
          MOVE      SIX,PCDSTYPE
          PACK      KEY13,PCDSTYPE,PCDSCODE,PCDSLINE
.
          CALL      RDPCDSC1
          BRANCH    OVRCD,SEMD575
.
          ADD       ONE,CVERT
SEMD590   CALL      SCRFNC00
          BRANCH    EXIT,SEMD575,SEMD571
          GOTO      SEMD900
SEMD591   IF        SCREENNO <> 0
            MOVE      ONE,FORM1
            GOTO      SEMD590
          ENDIF
          GOTO      SEMD900
.
.         Response Patterns - delete mode - diagnosis code
.
SEMD592   MOVE      FOUR,PCDBTYPE
          MOVE      CODEE,PCDBCLSS
          PACK      KEY20,PCDBTYPE,PCDBCLSS,SP20
.
          CALL      RSPCDBS1
SEMD594   CALL      RKPCDBS1
.
          BRANCH    OVRCD,SEMD595A
.
          COMPARE   FOUR,PCDBTYPE
          GOTO      SEMD595A IF NOT EQUAL
.
          MATCH     CODEE,PCDBCLSS
          GOTO      SEMD595A IF NOT EQUAL
.
.         Now get description
.
          MOVE      PCDBCODE,PCDSCODE
          MOVE      ONE,PCDSLINE 
          MOVE      SIX,PCDSTYPE
          PACK      KEY13,PCDSTYPE,PCDSCODE,PCDSLINE
.
          CALL      RDPCDSC1
          BRANCH    OVRCD,SEMD594
.
          ADD       ONE,CVERT
.
SEMD595   CALL      SCRFNC00
          MOVE      ZERO,FORM1 
          BRANCH    EXIT,SEMD594,SEMD592
          GOTO      SEMD900
.
SEMD595A  IF        SCREENNO <> 0
            MOVE      ONE,FORM1
            GOTO      SEMD595 
          ENDIF
          GOTO      SEMD900

.         ABC PRN REST CODE - delete mode - diagnosis code
.
SEMD596   MOVE      FIVE,PCDBTYPE
          MOVE      CODEE,PCDBCLSS
          PACK      KEY20,PCDBTYPE,PCDBCLSS,SP20
          CALL      RSPCDBS1
SEMD598   CALL      RKPCDBS1
.
          BRANCH    OVRCD,SEMD599A
.
          COMPARE   FIVE,PCDBTYPE
          GOTO      SEMD599A IF NOT EQUAL
.
          MATCH     CODEE,PCDBCLSS
          GOTO      SEMD599A IF NOT EQUAL
.
.         Now get description
.
          MOVE      PCDBCODE,PCDSCODE
          MOVE      ONE,PCDSLINE 
          MOVE      SIX,PCDSTYPE
          PACK      KEY13,PCDSTYPE,PCDSCODE,PCDSLINE
.
          CALL      RDPCDSC1
          BRANCH    OVRCD,SEMD598
.
          ADD       ONE,CVERT
SEMD599   CALL      SCRFNC00
          MOVE      ZERO,FORM1 
          BRANCH    EXIT,SEMD598,SEMD596
          GOTO      SEMD900
SEMD599A  IF        SCREENNO <> 0
            MOVE      ONE,FORM1
            GOTO      SEMD599 
          ENDIF
          GOTO      SEMD900
.
.         HEALTH PATTERNS - delete mode - health pattern
.
SEMD600   MOVE      THREE,PCDBTYPE
          MOVE      SP10,TEMP5
          PACK      KEY20,PCDBTYPE,SP20
          CALL      RSPCDBS1
SEMD603   CALL      RKPCDBS1
.
          BRANCH    OVRCD,SEMD605
.
.         If we don't have this then we will display the description as many
.         times as it appears in the DBS file
.
          MATCH     PCDBCLSS,TEMP5
          GOTO      SEMD605 IF EQUAL
          MOVE      PCDBCLSS,TEMP5
.
          COMPARE   THREE,PCDBTYPE
          GOTO      SEMD605 IF NOT EQUAL
.
.         Now get description
.
          MOVE      PCDBCLSS,PCDSCODE
          MOVE      ONE,PCDSLINE 
          MOVE      THREE,PCDSTYPE
          PACK      KEY13,PCDSTYPE,PCDSCODE,PCDSLINE
.
          CALL      RDPCDSC1
          BRANCH    OVRCD,SEMD604
.
          ADD       ONE,CVERT
SEMD604   CALL      SCRFNC00
          MOVE      ZERO,FORM1 
          BRANCH    EXIT,SEMD603,SEMD600
          GOTO      SEMD900
SEMD605   IF        SCREENNO <> 0
            MOVE      ONE,FORM1
            GOTO      SEMD604  
          ENDIF
          GOTO      SEMD900
.
.         NURSING DIAGNOSIS - change/delete mode - diagnosis code
.
SEMD610   MOVE      SIX,PCDSTYPE 
          PACK      KEY13,PCDSTYPE,SP20
          CALL      RSPCDSC1
SEMD612   CALL      RKPCDSC1
          BRANCH    OVRCD,SEMD614
          COMPARE   SIX,PCDSTYPE
          GOTO      SEMD614 IF NOT EQUAL
.
          ADD       ONE,CVERT
SEMD613   CALL      SCRFNC00
          MOVE      ZERO,FORM1 
          BRANCH    EXIT,SEMD612,SEMD610
          GOTO      SEMD900
SEMD614   IF        SCREENNO <> 0
            MOVE      ONE,FORM1
            GOTO      SEMD613  
          ENDIF
          GOTO      SEMD900
.
.         TYPE OF CLINIC CONDITION - delete mode - CLINIC CONDITION
.
SEMD615   MOVE      ONE,PCDBTYPE
          MOVE      CODEE,PCDBCLSS
          PACK      KEY20,PCDBTYPE,PCDBCLSS,SP20
          CALL      RSPCDBS1
SEMD617   CALL      RKPCDBS1
          BRANCH    OVRCD,SEMD619
.
          MATCH     PCDBCLSS,CODEE
          GOTO      SEMD619 IF NOT EQUAL
.
          COMPARE   ONE,PCDBTYPE
          GOTO      SEMD900 IF NOT EQUAL
.
.         Now get description
.
          MOVE      TWO,PCDSTYPE
          MOVE      PCDBCODE,PCDSCODE
          MOVE      ONE,PCDSLINE
.
          PACK      KEY13,PCDSTYPE,PCDSCODE,PCDSLINE
          CALL      RDPCDSC1
          BRANCH    OVRCD,SEMD617
.
          ADD       ONE,CVERT
.
SEMD618   CALL      SCRFNC00
          MOVE      ZERO,FORM1 
          BRANCH    EXIT,SEMD617,SEMD615
          GOTO      SEMD900
SEMD619   IF        SCREENNO <> 0
            MOVE      ONE,FORM1
            GOTO      SEMD618  
          ENDIF
          GOTO      SEMD900
.
.         CLINIC CONDITIONS - Type of condition
.
SEMD620   MOVE      ONE,PCDBTYPE
          MOVE      SP9,TEMP5
          PACK      KEY20,PCDBTYPE,SP20
          CALL      RSPCDBS1
SEMD622   CALL      RKPCDBS1
          BRANCH    OVRCD,SEMD626
          COMPARE   ONE,PCDBTYPE
          GOTO      SEMD626 IF NOT EQUAL
.
          MATCH     PCDBCLSS,TEMP5           * Don't display duplicat entries
          GOTO      SEMD622 IF EQUAL
.
          MOVE      PCDBCLSS,TEMP5
.
.         Now get description
.
          MOVE      ONE,PCDSTYPE
          MOVE      PCDBCLSS,PCDSCODE
          MOVE      ONE,PCDSLINE
.
          PACK      KEY13,PCDSTYPE,PCDSCODE,PCDSLINE
          CALL      RDPCDSC1
          BRANCH    OVRCD,SEMD622
.
          ADD       ONE,CVERT
SEMD625   CALL      SCRFNC00
          MOVE      ZERO,FORM1 
          BRANCH    EXIT,SEMD622,SEMD620
          GOTO      SEMD900
SEMD626   IF        SCREENNO <> 0
            MOVE      ONE,FORM1
            GOTO      SEMD625  
          ENDIF
          GOTO      SEMD900
.
.         OPTION: TYPE OF CONDITION - SUB OPTION: TYPE OF CLINIC COND.
.
SEMD630   MOVE      ONE,PCDBTYPE
          MOVE      SP9,TEMP5
          PACK      KEY20,PCDBTYPE,SP20
          CALL      RSPCDBS1
SEMD632   CALL      RKPCDBS1
          BRANCH    OVRCD,SEMD636
.
          COMPARE   ONE,PCDBTYPE
          GOTO      SEMD636 IF NOT EQUAL
.
          MATCH     PCDBCLSS,TEMP5           * Don't display duplicates
          GOTO      SEMD632 IF EQUAL
.
          MOVE      PCDBCLSS,TEMP5
.
.         Now get description
.
          MOVE      ONE,PCDSTYPE
          MOVE      PCDBCLSS,PCDSCODE
          MOVE      ONE,PCDSLINE
.
          PACK      KEY13,PCDSTYPE,PCDSCODE,PCDSLINE
          CALL      RDPCDSC1
          BRANCH    OVRCD,SEMD632
. 
          ADD       ONE,CVERT
SEMD635   CALL      SCRFNC00
          MOVE      ZERO,FORM1 
          BRANCH    EXIT,SEMD632,SEMD630
          GOTO      SEMD900
SEMD636   IF        SCREENNO <> 0
            MOVE      ONE,FORM1
            GOTO      SEMD635  
          ENDIF
          GOTO      SEMD900
.
.         Type of Condition - DIAGNOSIS CODE
.
SEMD640   MOVE      TWO,PCDBTYPE
          MOVE      CODED,PCDBCLSS
          PACK      KEY20,PCDBTYPE,PCDBCLSS,SP20
          CALL      RSPCDBS1
SEMD642   CALL      RKPCDBS1
          BRANCH    OVRCD,SEMD646
. 
          COMPARE   TWO,PCDBTYPE
          GOTO      SEMD646 IF NOT EQUAL
.
          MATCH     CODED,PCDBCLSS
          GOTO      SEMD646 IF NOT EQUAL
.
.         Get description 
.
          MOVE      SIX,PCDSTYPE
          MOVE      PCDBCODE,PCDSCODE
          MOVE      ONE,PCDSLINE
          PACK      KEY13,PCDSTYPE,PCDSCODE,PCDSLINE
.
          CALL      RDPCDSC1
          BRANCH    OVRCD,SEMD642
          ADD       ONE,CVERT
SEMD645   CALL      SCRFNC00
          MOVE      ZERO,FORM1 
          BRANCH    EXIT,SEMD642,SEMD640
          GOTO      SEMD900
SEMD646   IF        SCREENNO <> 0
            MOVE      ONE,FORM1
            GOTO      SEMD645  
          ENDIF
          GOTO      SEMD900
.
.         RESPONSE PATTERN - DELETE - RESPONSE PATTERN
.
SEMD650   MOVE      FOUR,PCDBTYPE
          MOVE      SP9,TEMP5
          PACK      KEY20,PCDBTYPE,SP20
          CALL      RSPCDBS1
SEMD652   CALL      RKPCDBS1
          BRANCH    OVRCD,SEMD654
.
          COMPARE   FOUR,PCDBTYPE
          GOTO      SEMD654 IF NOT EQUAL
. 
          MATCH     PCDBCLSS,TEMP5
          GOTO      SEMD652 IF EQUAL         * Don't show duplicates
          MOVE      PCDBCLSS,TEMP5
.
.         Now get description
.
          MOVE      FOUR,PCDSTYPE
          MOVE      PCDBCLSS,PCDSCODE
          MOVE      ONE,PCDSLINE
          PACK      KEY13,PCDSTYPE,PCDSCODE,PCDSLINE
.
          CALL      RDPCDSC1
          BRANCH    OVRCD,SEMD652
. 
          ADD       ONE,CVERT
SEMD653   CALL      SCRFNC00
          MOVE      ZERO,FORM1 
          BRANCH    EXIT,SEMD652,SEMD650
          GOTO      SEMD900
SEMD654   IF        SCREENNO <> 0
            MOVE      ONE,FORM1
            GOTO      SEMD653  
          ENDIF
          GOTO      SEMD900
.
.         ABC PRN REST CODE
.
SEMD655   MOVE      FIVE,PCDBTYPE
          MOVE      SP9,TEMP5
          PACK      KEY20,PCDBTYPE,SP20
          CALL      RSPCDBS1
SEMD657   CALL      RKPCDBS1
          BRANCH    OVRCD,SEMD659
.
          COMPARE   FIVE,PCDBTYPE
          GOTO      SEMD659 IF NOT EQUAL
. 
          MATCH     PCDBCLSS,TEMP5
          GOTO      SEMD657 IF EQUAL         * Don't show duplicates
          MOVE      PCDBCLSS,TEMP5
.
.         Now get description
.
          MOVE      FIVE,PCDSTYPE
          MOVE      PCDBCLSS,PCDSCODE
          MOVE      ONE,PCDSLINE
          PACK      KEY13,PCDSTYPE,PCDSCODE,PCDSLINE
.
          CALL      RDPCDSC1
          BRANCH    OVRCD,SEMD657
. 
          ADD       ONE,CVERT
SEMD658   CALL      SCRFNC00
          MOVE      ZERO,FORM1 
          BRANCH    EXIT,SEMD657,SEMD655
          GOTO      SEMD900
SEMD659   IF        SCREENNO <> 0
            MOVE      ONE,FORM1
            GOTO      SEMD658  
          ENDIF
          GOTO      SEMD900
.
SEMD700   MOVE      FORM2,PCDSTYPE
          PACK      KEY13,PCDSTYPE,SP20
          CALL      RSPCDSC1
SEMD705   CALL      RKPCDSC1
          BRANCH    OVRCD,SEMD720
.
          COMPARE   PCDSTYPE,FORM2           * Have we read too far?
          GOTO      SEMD720 IF NOT EQUAL
.
          MOVE      PCDSTYPE,PCDBTYPE
          MOVE      PCDSCODE,PCDBCLSS
          PACK      KEY20,PCDBTYPE,PCDBCLSS,SP20
.
          CALL      RSPCDBS1
          CALL      RKPCDBS1
          BRANCH    OVRCD,SEMD720
.
          COMPARE   PCDSTYPE,PCDBTYPE
          GOTO      SEMD720 IF NOT EQUAL
.
          MATCH     PCDSCODE,PCDBCLSS
          GOTO      SEMD720 IF NOT EQUAL
.
          ADD       ONE,CVERT
SEMD710   CALL      SCRFNC00
          MOVE      ZERO,FORM1 
          BRANCH    EXIT,SEMD705,SEMD700
          GOTO      SEMD900
SEMD720   IF        SCREENNO <> 0
            MOVE      ONE,FORM1
            GOTO      SEMD710
          ENDIF
.
SEMD900   MOVE      FORM2,PCDSTYPE
.
SEMD999   RETURN

.-------------------------------------------------------------------------
.       Screen handling routine for first next continue
.-------------------------------------------------------------------------
SCRFNC00  MOVE     ZERO,EXIT
          BRANCH   FORM1,SCRFNC50        * No next screen
          IF        CVERT < 23
            DISPLAY   *PCCOL:CVERT,*V2LON,PCDSCODE,SP4,*HOFF,PCDSDESC
            GOTO      SCRFNC85       * indicate next record
          ENDIF
.
SCRFNC10  KEYIN     *P1:24,*EL:
                    "(",*V2LON,"C",*HOFF,")ontinue, ":
                    "(",*V2LON,"F",*HOFF,")irst Screen, ":
                    "(",*V2LON,"N",*HOFF,")ext Screen : ",*V2LON,ANS;
.
          REP       UPPLOW,ANS
          CMATCH    ANSC,ANS
          GOTO      SCRFNC99 IF EQUAL
          CMATCH    ANSF,ANS
          GOTO      SCRFNC90 IF EQUAL
.
          CMATCH    ANSN,ANS
          GOTO      SCRFNC80 IF EQUAL
.
          BEEP
          GOTO      SCRFNC10
.
SCRFNC50  KEYIN     *P1:24,*EL:
                    "(",*V2LON,"C",*HOFF,")ontinue, ":
                    "(",*V2LON,"F",*HOFF,")irst Screen : ",*V2LON,ANS;
.
          REP       UPPLOW,ANS
          CMATCH    ANSC,ANS
          GOTO      SCRFNC99 IF EQUAL
          CMATCH    ANSF,ANS
          GOTO      SCRFNC90 IF EQUAL
          BEEP
          GOTO      SCRFNC50
.
SCRFNC80  MOVE      SEVEN,CVERT
          ADD       ONE,SCREENNO
          MOVE      ONE,CCOL
          DISPLAY   *P1:6,*EF
          DISPLAY   *PCCOL:CVERT,*V2LON,PCDSCODE,SP4,*HOFF,PCDSDESC
SCRFNC85  MOVE      ONE,EXIT
          GOTO      SCRFNC99
.
SCRFNC90  MOVE      TWO,EXIT
          MOVE      SIX,CVERT
          MOVE      ONE,CCOL
          DISPLAY   *P1:CVERT,*EF
          MOVE      ZERO,SCREENNO
.
SCRFNC99  RETURN

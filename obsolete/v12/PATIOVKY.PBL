.---------------------------------------------------------------------------
.   System    :   Patient System                     
.   Include   :   PATIOVKY
.   Routine   :   HPTIO100 Overnight Invoice Breaskdown
.   Return    :           
.   Mods      :
.     V9.02.01   31/10/2001  Tonii
.                Mods as to not display details if acode is empty
.-------------------------------------------------------------------------------
HPTIO100
          MOVE      ZERO,CSCRSIZ
          IF        HTOP<3
            MOVE      "10",HTOP
            MOVE      "22",HBOT
            MOVE      "10",HLEF
            MOVE      "70",HRIG
          ENDIF
HPTIO104
          CALL      GSCRN000
          BRANCH    EXIT,HPTIO199
          MOVE      STDCOL00,STDCOL01
          ADD       " 5",STDCOL01
HPTIO108
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          MOVE      SP70,PTIOCSCD
          MOVE      CODEFH,TCODE
          MOVE      Z3,ACODE
          PACK      KEY5,TCODE,ACODE
          PACK      SAVKEY80,TCODE,ACODE
          SETLPTR   SAVKEY80,12                                                 
          CALL      RDSCODE1
.         CALL      RSPTIOV1
HPTIO110
          CALL      RDKCODE1
          BRANCH    OVRCD,HPTIO115
          MATCH     SP3,ACODE
          GOTO      HPTIO110 IF EQUAL
.
          PACK      KEY5,TCODE,ACODE
          MATCH     SAVKEY80,KEY5
          GOTO      HPTIO115 IF EQUAL
.
          MATCH     TCODE,CODEFI
          GOTO      HPTIO115 IF NOT EQUAL                                       
          BRANCH    CSEARCH,HPTIO112
          CALL      HPTIO160
          BRANCH    OVRCD,HPTIO110
HPTIO112
          ADD       ONE,XITEMNO
          ADD       ONE,STDROW
          STORE     KEY5,XITEMNO,ST1,ST2,ST3,ST4,ST5:                          
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          DISPLAY   *PSTDCOL00:STDROW,SP1,*V2LON,XITEMNO,DOT:
                    SP2,ACODE,SP6,TDESC
          COMPARE   MAXITEM,XITEMNO
          GOTO      HPTIO110 IF NOT EQUAL
HPTIO115
          UNPACK    SAVKEY80,PTIOCODE,PTIOFUND,PTIOTBLT,PTIOCSCD,PTIOBRCD       
          MOVE      ONE,DITEM
          MOVE      MINITEM,DROW
          ADD       ONE,DROW
          DISPLAY   *PSTDCOL00:DROW,*V2LON,*HON,SP1,DITEM,DOT
          CLIP
          FLUSH     HLEF,HTOP,HRIG,HBOT
.
HPTIO120
          CALL      HSCRI000
          BRANCH    EXIT,HPTIO130,HPTIO135,HPTIO140,HPTIO145,HPTIO104:
                              HPTIO191,HPTIO150
          GOTO      HPTIO192
HPTIO130
          CALL      RDKCODE1
          BRANCH    OVRCD,HPTIO185
          PACK      KEY5,TCODE,ACODE
          MATCH     SAVKEY80,KEY5
          GOTO      HPTIO185 IF EQUAL                                       
          CALL      RDPCODE1
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HPTIO110
HPTIO135
          MOVE      ST1,KEY5 
          CALL      RDCODE1 
          CALL      RDPCODE1 
          BRANCH    OVRCD,HPTIO185
          PACK      KEY5,TCODE,ACODE
          MATCH     CODEFI,TCODE
          GOTO      HPTIO185 IF NOT EQUAL
.
          MATCH     SAVKEY80,KEY5                                               
          GOTO      HPTIO185 IF EQUAL                                       
          MATCH     SP70,PTIOCSCD                                               
          GOTO      HPTIO185 IF EQUAL                                           
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
HPTIO136
          CALL      RDPCODE1
          BRANCH    OVRCD,HPTIO137
          PACK      KEY5,TCODE,ACODE
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HPTIO136 IF NOT EQUAL
HPTIO137
          MOVE      ZERO,XITEMNO
          GOTO      HPTIO110
HPTIO140
          MOVE      ST1,KEY24
          CALL      RDCODE1 
          CALL      RDPCODE1
          BRANCH    OVRCD,HPTIO185
          PACK      KEY5,TCODE,ACODE
          MATCH     SAVKEY80,KEY5                                               
          GOTO      HPTIO185 IF NOT EQUAL                                       
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HPTIO108
HPTIO145
          CALL      RDKCODE1
          BRANCH    OVRCD,HPTIO185
          PACK      KEY5,TCODE,ACODE
          MATCH     SAVKEY80,KEY5                                               
          GOTO      HPTIO185 IF NOT EQUAL                                       
          SUSPEND
          CLIP      1,1,CRIG,24
.
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      ZERO,XITEMNO
          PACK      KEY24,SAVKEY80,Z70                                          
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
          CALL      RSPTIOV1
HPTIO146
          CALL      RDPCODE1
          BRANCH    OVRCD,HPTIO147
          PACK      KEY5,TCODE,ACODE
          MATCH     SAVKEY80,KEY5                                               
          GOTO      HPTIO147 IF NOT EQUAL                                       
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HPTIO146 IF NOT EQUAL
HPTIO147
          MOVE      ZERO,XITEMNO
          GOTO      HPTIO110
HPTIO150  COMPARE   ZERO,CSEARCH
          GOTO      HPTIO155 IF EQUAL
          MOVE      ZERO,CSEARCH
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          ADD       ONE,STDROW
          UNPACK    SP70,SCHFLD01,SCHFLD02,SCHFLD03,SCHFLD04,SCHFLD05
          UNPACK    SP70,SCHFLD06,SCHFLD07,SCHFLD08,SCHFLD09,SCHFLD10
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          DISPLAY   *PSTDCOL00:STDROW,*V2LON,*HON,"Sch"
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HPTIO108
HPTIO155  MOVE      ONE,CSEARCH
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HPTIO108
HPTIO160  MOVE      ZERO,OVRCD
HPTIO161
HPTIO162
HPTIO163
HPTIO164
HPTIO165
HPTIO166
HPTIO167
HPTIO168
HPTIO169
HPTIO170
          GOTO      HPTIO175
HPTIO172  MOVE      ONE,OVRCD
HPTIO175  RETURN
HPTIO185
          LOAD      KEY5,XITEMNO,ST1,ST2,ST3,ST4,ST5:                          
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY5,TCODE,ACODE
          CALL      RDCODE1 
HPTIO190
          UNPACK    SAVKEY80,TCODE,ACODE
          BEEP
          GOTO      HPTIO120
HPTIO191
          MOVE      ZERO,PTIOAMNT
          MOVE      SP70,KEY24
          MOVE      SP70,PTIOCSCD
          GOTO      HPTIO196
HPTIO192
          MOVE      SP70,KEY24
          MOVE      SP70,PTIOCSCD
          LOAD      KEY5,CCITEM,ST1,ST2,ST3,ST4,ST5:                           
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY5,TCODE,ACODE
HPTIO196
          PUTSCR    CSSCRNUM,HLEF,HTOP,HRIG,HBOT
          CALL      FRESCR00
          MOVE      ZERO,HTOP
          MOVE      ZERO,HLEF
          MOVE      ZERO,HBOT
          MOVE      ZERO,HRIG
HPTIO199
          RETURN
.---------------------------------------------------------------------------
.   System    :   Patient System                     
.   Include   :   PATIOVKY
.   Routine   :   KPTIO100 Keyin Overnight Invoice Breakdown
.   Parameter :   CKEYTYP 0 = Keyin , 1 = Accept, 2 = Either
.   Return    :   EXIT = 1 null entry, 2 EXITCHAR entered
.-------------------------------------------------------------------------------
KPTIO100  TOPIC     "PTIOBRCD"
          MATCH     SP3,CKYIDEF3
          GOTO      KPTIO105 IF NOT EQUAL
.
          MOVE      UNDLN70,PTIOBRCD
          KEYIN     *PCCOL:CVERT,*DV,PTIOBRCD:
                    *PCCOL:CVERT,*V2LON,PTIOBRCD:                               
                    *PCCOL:CVERT,*DV,PTIOBRCD
          GOTO      KPTIO108
.
KPTIO105  MOVE      CKYIDEF3,PTIOBRCD
          KEYIN     *PCCOL:CVERT,*DV,PTIOBRCD:
                    *PCCOL:CVERT,*V2LON,*RV,PTIOBRCD:                               
                    *PCCOL:CVERT,*DV,PTIOBRCD
.
KPTIO108  ENDSET    PTIOBRCD
          APPEND    SP70,PTIOBRCD
          RESET     PTIOBRCD
.
          PACK      KEY5,CODEFI,PTIOBRCD
.
          MATCH     SP70,PTIOBRCD
          GOTO      KPTIO190 IF EQUAL
.
          CMATCH    EXITCHAR,PTIOBRCD
          GOTO      KPTIO195 IF EQUAL
.
          CMATCH    QUEST,PTIOBRCD
          GOTO      KPTIO110 IF NOT EQUAL
.
          MOVE      CCITEM,SCCITEM
          CALL      HPTIO100
          MOVE      SCCITEM,CCITEM
.
          ENDSET    TDESC
          APPEND    SP70,TDESC     
          RESET     TDESC
.
          MATCH     SP70,TDESC
          GOTO      KPTIO100 IF EQUAL
.
KPTIO110  UNPACK    KEY5,DIM2
          MATCH     CODEFI,DIM2
          GOTO      KPTIO185 IF NOT EQUAL
.
          CALL      RDCODE1
          BRANCH    OVRCD,KPTIO180
          BRANCH    CKEYTYP,KPTIO175
.
KPTIO170  MOVE      ZERO,EXIT
          GOTO      KPTIO199
KPTIO175
          MOVE      "Overnight Inv. Brkdown Already Exist - ",DISPMSG                                  
          CALL      MESSAGE1
          GOTO      KPTIO100
KPTIO180
          MOVE      ZERO,EXIT
          BRANCH    CKEYTYP,KPTIO199,KPTIO199
          MOVE      "Overnight Inv. Brkdown Does Not Exist - ",DISPMSG                                 
          CALL      MESSAGE1
          GOTO      KPTIO100
KPTIO185
          MOVE      ZERO,EXIT
          BRANCH    CKEYTYP,KPTIO199,KPTIO199
          MOVE      "Code must be from category 'FI' - ",DISPMSG

          CALL      MESSAGE1
          GOTO      KPTIO100
KPTIO190
          MOVE      ONE,EXIT
          GOTO      KPTIO199
KPTIO195
          MOVE      TWO,EXIT
KPTIO199 TOPIC    PRGID
          RETURN

.---------------------------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.00.00"
.-------------------------------------------------------
. V9.02.00  04.07.2002  Glenn Saunders
.           Export to new release i.e. v9.02 from r5.09
.---------------------------------------------------------------------------
. V5.09.01  08/08/2001  Davin
.           Recompiled for change to CCSEPSFD
.---------------------------------------------------------------------------
. V5.07.01  11.09.1999 Steve Downing
.           Recompiled for CCSGETCD
. V5.04.02  28.07.1996 B.G.Ackland
.           New Fields for Southern Health
. V5.04.02  28.07.1996 B.G.Ackland
.           New Fields for Southern Health
. V6.00.03  08.11.1993 B.G.Ackland
.           Change Day Case Inclusion
. V6.00.02  08.11.1993 B.G.Ackland
.           New
.---------------------------------------------------------------------------
COMMAND   DIM       80
EXTRSUMM  FORM      1
F12P4     FORM      12.4
FILENAME  DIM       8
NEWFROM   DIM       8
NEWTO     DIM       8
PDIA01    DIM       9
POPP01    DIM       9
SDIA01    DIM       9
SOPP01    DIM       9
TDPHRS    DIM       2
TDPTEN    DIM       4
THEBAND   DIM       10
TIMHRS    DIM       2
TIMTEN    DIM       4
.---------------------------------------------------------------------------
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBACCR52
.   Function      :   Casemix Extract Update                  
.   Generated  On :   08/07/2002
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       CCSAGEFD/INC
          INC       CCSCALFD/INC
          INC       CCSCEAFD/INC
          INC       CCSCEBFD/INC
          INC       CCSCECFD/INC
          INC       CCSCEDFD/INC
          INC       CCSCEEFD/INC
          INC       CCSCEFFD/INC
          INC       CCSCEGFD/INC
          INC       CCSCEXFD/INC
          INC       CCSCMAFD/INC
          INC       CCSDRGFD/INC
          INC       CCSEPSFD/INC
          INC       CCSHCDFD/INC
          INC       CCSIADFD/INC
          INC       CCSMSCFD/INC
          INC       CCSMTSFD/INC
          INC       CCSSTYFD/INC
          INC       CCSUPDFD/INC
          INC       CCSXHDFD/INC
.=========================
.Local Variable Definition
.-------------------------
DAYCDESC  DIM      25 * Scr 00 Fld     3
FROMNEW   DIM      10 * Scr 00 Fld    18
TONEW     DIM      10 * Scr 00 Fld    19
FROMAD    DIM      10 * Scr 00 Fld    20
TOAD      DIM      10 * Scr 00 Fld    21
VISITDES  DIM      15 * Scr 00 Fld    22
FROMCMOD  DIM      35 * Scr 00 Fld    25
TOCMOD    DIM      35 * Scr 00 Fld    26
TOTALEPS  FORM      6 * Scr 00 Fld    27
TOTALEXT  FORM      6 * Scr 00 Fld    28
EXTRBRAN  FORM      3 * Scr 00 Fld    29
CLV1DES   DIM      35 * Scr 00 Fld    30
CLV2DES   DIM      35 * Scr 00 Fld    31
CLV3DES   DIM      35 * Scr 00 Fld    32
COST1AMT  FORM     12.2 * Scr 00 Fld    33
COST2AMT  FORM     12.2 * Scr 00 Fld    34
EPISODE   FORM      1 * Scr 00 Fld    35
EXSTR     DIM      10 * Scr 00 Fld    37
EXEND     DIM      10 * Scr 00 Fld    38
AGERANGE  DIM       3 * Scr 00 Fld    39
CALCCOST  FORM      1 * Scr 00 Fld    40
FROMDD    DIM      10 * Scr 00 Fld    42
TODD      DIM      10 * Scr 00 Fld    43
DESC01    DIM      35 * Scr 01 Fld     5
FROM01    DIM      35 * Scr 01 Fld     6
TO01      DIM      35 * Scr 01 Fld     7
DESC02    DIM      35 * Scr 01 Fld     8
FROM02    DIM      35 * Scr 01 Fld     9
TO02      DIM      35 * Scr 01 Fld    10
DESC03    DIM      35 * Scr 01 Fld    11
FROM03    DIM      35 * Scr 01 Fld    12
TO03      DIM      35 * Scr 01 Fld    13
DESC04    DIM      35 * Scr 01 Fld    14
FROM04    DIM      35 * Scr 01 Fld    15
TO04      DIM      35 * Scr 01 Fld    16
DESC05    DIM      35 * Scr 01 Fld    17
FROM05    DIM      35 * Scr 01 Fld    18
TO05      DIM      35 * Scr 01 Fld    19
DESC06    DIM      35 * Scr 01 Fld    20
FROM06    DIM      35 * Scr 01 Fld    21
TO06      DIM      35 * Scr 01 Fld    22
DESC07    DIM      35 * Scr 01 Fld    23
FROM07    DIM      35 * Scr 01 Fld    24
TO07      DIM      35 * Scr 01 Fld    25
DESC08    DIM      35 * Scr 01 Fld    26
FROM08    DIM      35 * Scr 01 Fld    27
TO08      DIM      35 * Scr 01 Fld    28
DESC09    DIM      35 * Scr 01 Fld    29
FROM09    DIM      35 * Scr 01 Fld    30
TO09      DIM      35 * Scr 01 Fld    31
DESC10    DIM      35 * Scr 01 Fld    32
FROM10    DIM      35 * Scr 01 Fld    33
TO10      DIM      35 * Scr 01 Fld    34
DESC11    DIM      35 * Scr 01 Fld    35
FROM11    DIM      35 * Scr 01 Fld    36
TO11      DIM      35 * Scr 01 Fld    37
DESC12    DIM      35 * Scr 01 Fld    38
FROM12    DIM      35 * Scr 01 Fld    39
TO12      DIM      35 * Scr 01 Fld    40
DESC13    DIM      35 * Scr 01 Fld    41
FROM13    DIM      35 * Scr 01 Fld    42
TO13      DIM      35 * Scr 01 Fld    43
DESC14X   DIM      35 * Scr 01 Fld    44
FROM14    DIM      35 * Scr 01 Fld    45
TO14      DIM      35 * Scr 01 Fld    46
EXRANGE   FORM      1 * Scr 01 Fld    50
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBACCR52"
PRGNAM    INIT      "Casemix Extract Update                  "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      SC00L000
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          DISPLAY   *P56:24,"Opening ccsageaf";
          OPEN      CCSAGEA1,"ccsageaf"
          DISPLAY   *P56:24,"Opening ccsageaf";
          OPEN      CCSAGEA2,"ccsageaf"
          MOVE      "   64",AUDTSECT
          MOVE      " 38",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening ccsaudia";
            OPEN      CCSAUDIA,"ccsaudia"
          ENDIF
          DISPLAY   *P56:24,"Opening ccscalaf";
          OPEN      CCSCALA1,"ccscalaf"
          DISPLAY   *P56:24,"Opening ccscalaf";
          OPEN      CCSCALA2,"ccscalaf"
          DISPLAY   *P56:24,"Opening ccscalaf";
          OPEN      CCSCALA3,"ccscalaf"
          DISPLAY   *P56:24,"Opening ccsceaaf";
          OPEN      CCSCEAA1,"ccsceaaf"
          DISPLAY   *P56:24,"Opening ccscexaf";
          OPEN      CCSCEXA1,"ccscexaf"
          DISPLAY   *P56:24,"Opening ccscmaaf";
          OPEN      CCSCMAA1,"ccscmaaf"
          DISPLAY   *P56:24,"Opening ccsdrgaf";
          OPEN      CCSDRGA1,"ccsdrgaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA1,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA2,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA3,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA4,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccsepsaf";
          OPEN      CCSEPSA5,"ccsepsaf"
          DISPLAY   *P56:24,"Opening ccshcdaf";
          OPEN      CCSHCDA1,"ccshcdaf"
          DISPLAY   *P56:24,"Opening ccshcdaf";
          OPEN      CCSHCDA2,"ccshcdaf"
          DISPLAY   *P56:24,"Opening ccsiadaf";
          OPEN      CCSIADA1,"ccsiadaf"
          DISPLAY   *P56:24,"Opening ccsmscaf";
          OPEN      CCSMSCA1,"ccsmscaf"
          DISPLAY   *P56:24,"Opening ccsmtsaf";
          OPEN      CCSMTSA1,"ccsmtsaf"
          DISPLAY   *P56:24,"Opening ccsstyaf";
          OPEN      CCSSTYA1,"ccsstyaf"
          DISPLAY   *P56:24,"Opening ccsupdaf";
          OPEN      CCSUPDA1,"ccsupdaf"
          DISPLAY   *P56:24,"Opening ccsupdaf";
          OPEN      CCSUPDA2,"ccsupdaf"
          DISPLAY   *P56:24,"Opening ccsupdaf";
          OPEN      CCSUPDA3,"ccsupdaf"
          DISPLAY   *P56:24,"Opening ccsupdaf";
          OPEN      CCSUPDA4,"ccsupdaf"
          DISPLAY   *P56:24,"Opening ccsxhdaf";
          OPEN      CCSXHDA1,"ccsxhdaf"
          DISPLAY   *P56:24,"Opening ccsxhdaf";
          OPEN      CCSXHDA2,"ccsxhdaf"
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "00",SCRID
          IF         @EQUAL
            CALL       PS00L000   * Options                            
          ENDIF
          MATCH     "01",SCRID
          IF         @EQUAL
            CALL       PS01L000   * Range Options for Casemix Analysis 
          ENDIF
          RETURN
.--------------------------------
. Screen - Options                            
.--------------------------------
SC00L000
SC00L100
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC00L200
          CALL      CF00L000 * Clear Fields
SC00L300
          CALL      KY00L000 * Enter Key Fields
          BRANCH    EXIT,SC00L999,SC00L999
SC00L400
          CALL      WP00L000 * Load any WP Details
SC00L500
          CALL      LM00L000 * Load any Batch Details
SC00L600
          CALL      DF00L000 * Display Fields
SC00L700
          CALL      SF00L000 * Select Fields
          BRANCH    EXIT,SC00L100,SC00L100,SC00L200
SC00L800
SC00L900
SC00L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Options                            
.-------------------------------------------------------
CF00L000
          MOVE      SP70,CCEAEID 
          MOVE      SP70,FROMNEW 
CF00L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Options                            
.--------------------------------------------------------
KY00L000
.
KY00L110
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      EEID0000
          BRANCH    EXIT,KY00L900,KY00L900
          MOVE      ZERO,ACCEPT
          MOVE      CCEAEID,VAR      
          CALL      DISPITEM
          MOVE      ZERO,EXIT
          GOTO      KY00L999
.
KY00L900  MOVE      ONE,EXIT
KY00L999  RETURN
.---------------------------------------------------------
. Load WP files for : Options                            
.---------------------------------------------------------
WP00L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Options                            
.---------------------------------------------------------
LM00L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Options                            
.---------------------------------------------------------
DF00L000
          BRANCH   ACCEPT,DF00L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF00L900
          MATCH    PRGID,SCPSPID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF00L010 IF NOT EQUAL
.
          CALL     PS00L000 * Display Field
          GOTO     DF00L010
DF00L900
DF00L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Options                            
.---------------------------------------------------------
PS00L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS00L999,PS00L999,PS00L101,PS00L999:
                            PS00L999,PS00L102,PS00L103,PS00L104:
                            PS00L105,PS00L106,PS00L107,PS00L108:
                            PS00L109,PS00L110,PS00L111,PS00L112:
                            PS00L113,PS00L114,PS00L115,PS00L116:
                            PS00L117,PS00L118,PS00L999,PS00L119:
                            PS00L120,PS00L121,PS00L122,PS00L123:
                            PS00L124,PS00L125,PS00L126,PS00L127:
                            PS00L128,PS00L129,PS00L130,PS00L131:
                            PS00L132,PS00L133,PS00L134,PS00L135:
                            PS00L136,PS00L137,PS00L138
          GOTO     PS00L999
.
PS00L101
          MOVE      DAYCDESC,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L102
          MOVE      CCEADES,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L103
          MOVE      CCEAHCD,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L104
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      CCEAINC,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L105
          MOVE      CCEAVIS,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L106
          MOVE      CCEADAY,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L107
          MOVE      CCEALV1,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L108
          MOVE      CCEALV2,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L109
          MOVE      CCEALV3,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L110
          MOVE      CCEAFCM,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L111
          MOVE      CCEAFYR,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L112
          MOVE      CCEATCM,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L113
          MOVE      CCEATYR,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L114
          MOVE      FROMNEW,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L115
          MOVE      TONEW,VAR        
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L116
          MOVE      FROMAD,VAR       
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L117
          MOVE      TOAD,VAR         
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L118
          MOVE      VISITDES,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L119
          MOVE      CCHCDES,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L120
          CALL      CHKFCM00
          MOVE      FROMCMOD,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L121
          CALL      CHKTCM00
          MOVE      TOCMOD,VAR       
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L122
          MOVE      TOTALEPS,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L123
          MOVE      TOTALEXT,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L124
          MOVE      EXTRBRAN,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L125
          MOVE      CLV1DES,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L126
          MOVE      CLV2DES,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L127
          MOVE      CLV3DES,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L128
          MOVE      COST1AMT,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L129
          MOVE      COST2AMT,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L130
          MOVE      EPISODE,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L131
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      CCEARUA,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L132
          MOVE      EXSTR,VAR        
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L133
          MOVE      EXEND,VAR        
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L134
          MOVE      AGERANGE,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L135
          MOVE      CALCCOST,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L136
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      CCEAUST,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L137
          MOVE      FROMDD,VAR       
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L138
          MOVE      TODD,VAR         
          CALL      DISPITEM
          GOTO     PS00L999
PS00L999
          RETURN
.---------------------------------------------------------
. Selections for : Options                            
.---------------------------------------------------------
SF00L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF00L001  BRANCH   ACCEPT,SF00L020
.
SF00L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L006,SF00L101,SF00L006,SF00L102:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L103,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L104,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L006
SF00L006  BEEP
          GOTO     SF00L005
SF00L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF00L090
          MATCH    PRGID,SCSLPID
          GOTO     SF00L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF00L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L103,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020
          GOTO     SF00L020
SF00L090  MOVE     ZERO,ACCEPT
          GOTO     SF00L001
.
SF00L101
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L102
          CALL      POST0000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L103
.
.
          MOVE      "   19",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TONEW   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      RDATE000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L103
            ENDIF
            BRANCH    EXIT,SF00L103,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      FROMNEW,VAR      
          CALL      DISPITEM
.
.
          MOVE      "   19",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TONEW,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L104
            MOVE      ZERO,HLEF
            CALL      GETSCR00
          CALL      SC01L000
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      PUTSCR00
          GOTO      SF00L001
SF00L990  MOVE      ONE,EXIT * Exit Char Restart
SF00L999  RETURN
.--------------------------------
. Screen - Range Options for Casemix Analysis 
.--------------------------------
SC01L000
SC01L100
          MOVE      "01",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          MOVE      "  1",CLEF
          MOVE      " 80",CRIG
          MOVE      " 6",CTOP
          MOVE      "24",CBOT
          CALL      VBACK000 * Display Background
          MOVE      ZERO,CLEF
          MOVE      ZERO,CTOP
          MOVE      ZERO,CRIG
          MOVE      ZERO,CBOT
.
SC01L200
          CALL      CF01L000 * Clear Fields
          CALL      GETEXT00
SC01L300
          CALL      KY01L000 * Enter Key Fields
          BRANCH    EXIT,SC01L999,SC01L999
SC01L400
          CALL      WP01L000 * Load any WP Details
SC01L500
          CALL      LM01L000 * Load any Batch Details
SC01L600
          CALL      DF01L000 * Display Fields
SC01L700
          CALL      SF01L000 * Select Fields
          BRANCH    EXIT,SC01L100,SC01L100,SC01L200
SC01L800
SC01L900
SC01L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Range Options for Casemix Analysis 
.-------------------------------------------------------
CF01L000
CF01L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Range Options for Casemix Analysis 
.--------------------------------------------------------
KY01L000
          MOVE      ZERO,EXIT
          GOTO      KY01L999
.
KY01L900  MOVE      ONE,EXIT
KY01L999  RETURN
.---------------------------------------------------------
. Load WP files for : Range Options for Casemix Analysis 
.---------------------------------------------------------
WP01L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Range Options for Casemix Analysis 
.---------------------------------------------------------
LM01L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Range Options for Casemix Analysis 
.---------------------------------------------------------
DF01L000
          BRANCH   ACCEPT,DF01L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF01L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF01L900
          MATCH    PRGID,SCPSPID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF01L010 IF NOT EQUAL
.
          CALL     PS01L000 * Display Field
          GOTO     DF01L010
DF01L900
DF01L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Range Options for Casemix Analysis 
.---------------------------------------------------------
PS01L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS01L999,PS01L999,PS01L999,PS01L999:
                           PS01L101,PS01L102,PS01L103,PS01L104:
                            PS01L105,PS01L106,PS01L107,PS01L108:
                            PS01L109,PS01L110,PS01L111,PS01L112:
                            PS01L113,PS01L114,PS01L115,PS01L116:
                            PS01L117,PS01L118,PS01L119,PS01L120:
                            PS01L121,PS01L122,PS01L123,PS01L124:
                            PS01L125,PS01L126,PS01L127,PS01L128:
                            PS01L129,PS01L130,PS01L131,PS01L132:
                            PS01L133,PS01L134,PS01L135,PS01L136:
                            PS01L137,PS01L138,PS01L139,PS01L140:
                            PS01L141,PS01L142,PS01L999,PS01L999:
                           PS01L999,PS01L143
          GOTO     PS01L999
.
PS01L101
          MOVE      DESC01,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L102
          MOVE      FROM01,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L103
          MOVE      TO01,VAR         
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L104
          MOVE      DESC02,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L105
          MOVE      FROM02,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L106
          MOVE      TO02,VAR         
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L107
          MOVE      DESC03,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L108
          MOVE      FROM03,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L109
          MOVE      TO03,VAR         
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L110
          MOVE      DESC04,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L111
          MOVE      FROM04,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L112
          MOVE      TO04,VAR         
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L113
          MOVE      DESC05,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L114
          MOVE      FROM05,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L115
          MOVE      TO05,VAR         
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L116
          MOVE      DESC06,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L117
          MOVE      FROM06,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L118
          MOVE      TO06,VAR         
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L119
          MOVE      DESC07,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L120
          MOVE      FROM07,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L121
          MOVE      TO07,VAR         
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L122
          MOVE      DESC08,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L123
          MOVE      FROM08,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L124
          MOVE      TO08,VAR         
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L125
          MOVE      DESC09,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L126
          MOVE      FROM09,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L127
          MOVE      TO09,VAR         
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L128
          MOVE      DESC10,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L129
          MOVE      FROM10,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L130
          MOVE      TO10,VAR         
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L131
          MOVE      DESC11,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L132
          MOVE      FROM11,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L133
          MOVE      TO11,VAR         
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L134
          MOVE      DESC12,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L135
          MOVE      FROM12,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L136
          MOVE      TO12,VAR         
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L137
          MOVE      DESC13,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L138
          MOVE      FROM13,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L139
          MOVE      TO13,VAR         
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L140
          MOVE      DESC14X,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L141
          MOVE      FROM14,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L142
          MOVE      TO14,VAR         
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L143
          MOVE      EXRANGE,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
PS01L999
          RETURN
.---------------------------------------------------------
. Selections for : Range Options for Casemix Analysis 
.---------------------------------------------------------
SF01L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF01L001  BRANCH   ACCEPT,SF01L020
.
SF01L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L006,SF01L101,SF01L006,SF01L006:
                           SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                           SF01L006,SF01L006
SF01L006  BEEP
          GOTO     SF01L005
SF01L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF01L090
          MATCH    PRGID,SCSLPID
          GOTO     SF01L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF01L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L020,SF01L020,SF01L020,SF01L020:
                           SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                           SF01L020,SF01L020
          GOTO     SF01L020
SF01L090  MOVE     ZERO,ACCEPT
          GOTO     SF01L001
.
SF01L101
          MOVE      ZERO,EXIT
          GOTO      SF01L999
SF01L990  MOVE      ONE,EXIT * Exit Char Restart
SF01L999  RETURN
.@@@@@ Function Restart Point @@@@@
DEFAULTN    MOVE     ANSN,DEFYESNO
            RETURN
.----------------------------------------------------------------------
. Check if Actuals Required
.----------------------------------------------------------------------
CHKFCM00  MATCH    SP70,CCEAFCM
          IF       @EQUAL
            MOVE     "Actual Costs",FROMCMOD
          ELSE
            MOVE     CCEAFCM,KEY4
            CALL     RDCCMA1
            MOVE     CCMADES,FROMCMOD
          ENDIF
          RETURN
.
.----------------------------------------------------------------------
. Check if Actuals Required
.----------------------------------------------------------------------
CHKTCM00  MATCH    SP70,CCEATCM
          IF       @EQUAL
            MOVE     "Actual Costs",TOCMOD
          ELSE
            MOVE     CCEATCM,KEY4
            CALL     RDCCMA1
            MOVE     CCMADES,TOCMOD
          ENDIF
          RETURN
.
DEFAULTY    MOVE     ANSY,DEFYESNO
            RETURN
.---------------------------------------------------------------------------
. Post Casemix Extract Details and Perofrm Extract
.---------------------------------------------------------------------------
POST0000  DISPLAY  *P1:24,*EL,"Calculate Episode Costs (",*V2LON,"Y",*HOFF:
                   "/",*V2LON,"N",*HOFF,") ? "
          MOVE     "33",CCOL
          MOVE     "24",CVERT
          MOVE     ANSY,DEFYESNO
          CALL     YORN0000
          MOVE     FYESNO,CALCCOST
.
          MATCH    "0",CCEAUST
          IF       !@EQUAL
            MOVE     ONE,CCEAUST
          ENDIF
.
          PACK     KEY4,CCEAEID
          CALL     RACCEA1             * Read Record
          BRANCH   OVRCD,POST9999
.
          MOVE     ZERO,OVRCD
          MOVE     ZERO,EXIT
          MATCH    CCEAFDD,NEWFROM
          IF       @LESS
            ADD      ONE,OVRCD
            MOVE     NEWFROM,CCEAFDD
            MATCH    CCEAFDD,NEWTO
            IF       @LESS
              MOVE     ONE,EXIT
            ENDIF
          ENDIF
.
          MATCH    NEWTO,CCEATDD
          IF       @LESS
            ADD      ONE,OVRCD
            MOVE     NEWTO,CCEATDD
            MATCH    NEWFROM,CCEATDD
            IF       @LESS
              MOVE     ONE,EXIT
            ENDIF
          ENDIF
.
.----------------------------------------------------------------------
. OVRCD = 0 If Range Included in existing Date Range
.         1 If Range Adds to Either end of existing Date Range
.         2 If Add to Both Ends of Date Range
. EXIT  = 0 Date Range Joins Existing Date Range
.         1 Date Range does not join Existing Date Range
.----------------------------------------------------------------------
.
          BRANCH   EXIT,POST0100
          BRANCH   OVRCD,POST1000,POST0200
          BEEP
          DISPLAY  *P1:24,"New Date Range Included in Old. Continue (":
                   *V2LON,"Y",*HOFF,"/":
                   *V2LON,"N",*HOFF,") ? "
          MOVE     "50",CCOL
          MOVE     "24",CVERT
          CALL     YORN0000
          BRANCH   FYESNO,POST1000
          GOTO     POST9999
.
POST0100  BEEP
          MOVE     "Date Range must Join with Existing Date Range. - ",DISPMSG
          CALL     MESSAGE1
          GOTO     POST9999
.
POST0200  BEEP
          MOVE     "Date Range Includes all of Existing Date Range. - ",DISPMSG
          CALL     MESSAGE1
          MOVE     "Use Casemix Extract Generation. - ",DISPMSG
          CALL     MESSAGE1
          GOTO     POST9999
.
POST1000  CALL     UPCCEA1             * Update Record
          PACK     KEY4,CCEAEID
.
          CALL     RDCCEX1             * Read Record
          MOVE     OVRCD,EXRANGE       * 1 = no more ranges
.
. Create and Open Files
.---------------------------------------------------------------------------
          CALL     CREAT000
          BRANCH   EXIT,POST9999
.
. Extract Episodes to the ccec file
.---------------------------------------------------------------------------
          CALL     EXTR0000
.
. Calculate Episode Cost and Update Resource Usage (Takes a lot of time)
.---------------------------------------------------------------------------
          IF        CALCCOST=1
            CALL      CALC0000   * Only if Required CALCCOST 0 = No
          ENDIF
.
. Summarize Casemix Levels
.---------------------------------------------------------------------------
          CALL      SUMM0000
.
. Calculate Statistical Variances
.---------------------------------------------------------------------------
          MATCH    "0",CCEAUST
          GOTO     POST9999 IF EQUAL   * Update Stats Y or N 0=N
.
          CALL     STAT0000
.
POST9999  RETURN
.======================================================================
. Extract Casemix Analysis
.======================================================================
EXTR0000  PACK      KEY18,SP70
          DISPLAY   *P1:24,*EL,"Scanning Episodes : "
          MOVE      ZERO,TOTALEPS
          MOVE      ZERO,TOTALEXT
          PACK      KEY26,NEWFROM,SP70
          CALL      RSCCEP4
EXTR1000  CALL      RKCCEP4
          BRANCH    OVRCD,EXTR9000
          MATCH     CCEPDDAT,NEWTO
          GOTO      EXTR9000 IF LESS
.
          ADD       ONE,TOTALEPS
          IF        (TOTALEPS%500=0)
            DISPLAY   *P21:24,*V2LON,TOTALEPS
          ENDIF
.
          PACK      KEY18,CCEPHCD,CCEPEPS
          CALL      RDCCEC1
          IF        OVRCD=0
            CALL      DECCEC1
          ENDIF
.
          CALL      RANGE000     * Check Range Options
          BRANCH    EXIT,EXTR1000
.
          MOVE      SP70,CCECLV1
          MOVE      SP70,CCECLV2
          MOVE      SP70,CCECLV3
          MOVE      CCEALV1,EXTRBRAN
          CALL      GETCD000     * Get Extract Code Level 1
          MOVE      KEY10,CCECLV1
          MATCH     SP70,CCECLV1
          IF        @EQUAL
            MOVE      Z70,CCECLV1
          ENDIF
.
          MATCH     SP70,CCEALV2
          IF        !@EQUAL
            MOVE      CCEALV2,EXTRBRAN
            CALL      GETCD000     * Get Extract Code Level 2
            MOVE      KEY10,CCECLV2
            MATCH     SP70,CCECLV2
            IF        @EQUAL
              MOVE      Z70,CCECLV2
            ENDIF
          ENDIF
.
          MATCH     SP70,CCEALV3
          IF        !@EQUAL
            MOVE      CCEALV3,EXTRBRAN
            CALL      GETCD000     * Get Extract Code Level 3
            MOVE      KEY10,CCECLV3
            MATCH     SP70,CCECLV3
            IF        @EQUAL
              MOVE      Z70,CCECLV3
            ENDIF
          ENDIF
.
          MOVE      CCEPHCD,CCECHCD
          MOVE      CCEPEPS,CCECEPS
          MOVE      CCEPEXC,CCECEXC
          MOVE      ZERO,CCECFTC
          MOVE      ZERO,CCECTTC
          MOVE      CCEPLOS,CCECLOS
.
          PACK      KEY18,CCECHCD,CCECEPS
          CALL      RACCEC1
          IF        OVRCD=0
            CALL      UPCCEC1
          ELSE
            CALL      WRCCEC1
          ENDIF
          GOTO      EXTR1000
.
EXTR9000  RETURN
.-------------------------------------------
. Check for Range Option - EXIT 0=In Range
.-------------------------------------------
RANGE000  MATCH     CCEAHCD,CCEPHCD
          GOTO      RANGE900 IF NOT EQUAL
.
          MATCH     SP70,CCEPADAT   * Admission Date Range
          GOTO      RANGE010 IF EQUAL
.
          MATCH     CCEAFAD,CCEPADAT   * Admission Date Range
          GOTO      RANGE900 IF LESS
          MATCH     CCEPADAT,CCEATAD
          GOTO      RANGE900 IF LESS
.
RANGE010  MATCH     "0",CCEAVIS       * Include Visits 0=All
          IF        !(@EQUAL)
            MOVE      CCEPVIST,ANS
            MATCH     CCEAVIS,ANS
            GOTO      RANGE900 IF NOT EQUAL
          ENDIF
.
          MATCH     "0",CCEADAY       * Day Cases 0=Exclude
          IF        @EQUAL
            MATCH     "1",CCEPDAY      * Day Case 0=NO
            GOTO      RANGE900 IF EQUAL
          ENDIF
          MATCH     "2",CCEADAY       * Day Cases 2=Only
          IF        @EQUAL
            MATCH     "1",CCEPDAY      * Day Case 0=NO
            GOTO      RANGE900 IF NOT EQUAL
          ENDIF
.
          MATCH     "0",CCEAINC       * Include Incompleted 0=No
          IF        @EQUAL
            MATCH     "0",CCEPCOM     * Complete 0=NO
            GOTO      RANGE900 IF EQUAL
          ENDIF
.
          BRANCH    EXRANGE,RANGE800
          MOVE      ZERO,F2
RANGE700  ADD       ONE,F2
          COMPARE   "15",F2
          GOTO      RANGE800 IF EQUAL
          LOAD      KEY3,F2,CCEXR01,CCEXR02,CCEXR03,CCEXR04,CCEXR05:
                            CCEXR06,CCEXR07,CCEXR08,CCEXR09,CCEXR10:
                            CCEXR11,CCEXR12,CCEXR13,CCEXR14
          MATCH     SP70,KEY3
          GOTO      RANGE700 IF EQUAL
.
          MOVE      KEY3,EXTRBRAN
          CALL      GETCD000     * Get Extract Code
.
          LOAD      EXSTR,F2,CCEXF01,CCEXF02,CCEXF03,CCEXF04,CCEXF05:
                                   CCEXF06,CCEXF07,CCEXF08,CCEXF09,CCEXF10:
                                   CCEXF11,CCEXF12,CCEXF13,CCEXF14
          LOAD      EXEND,F2,CCEXT01,CCEXT02,CCEXT03,CCEXT04,CCEXT05:
                                   CCEXT06,CCEXT07,CCEXT08,CCEXT09,CCEXT10:
                                   CCEXT11,CCEXT12,CCEXT13,CCEXT14
.
          MATCH     EXSTR,KEY10   * Range
          GOTO      RANGE900 IF LESS
          MATCH     KEY10,EXEND
          GOTO      RANGE900 IF LESS
          GOTO      RANGE700
.
RANGE800  MOVE      ZERO,EXIT
          GOTO      RANGE999
RANGE900  MOVE      ONE,EXIT
RANGE999  RETURN
.------------------------------------------------------------
. Calculate Statistics
.------------------------------------------------------------
STAT0000  PACK      KEY10,SP70
          DISPLAY   *P1:24,*EL,"Calculating Statistics : "
          MOVE      ZERO,TOTALEXT
.
          CALL      STEB0000  * Level 1 Min , Max  & Variance Calculation
          CALL      STED0000  * Level 2 Min , Max  & Variance Calculation
          CALL      STEE0000  * Level 3 Min , Max  & Variance Calculation
.
STAT9999  RETURN
.------------------------------------------------------------
. Update Variance Casemix Level 1
.------------------------------------------------------------
STEB0000  PACK      KEY10,SP70
          CALL      RDCCEB1
          IF        OVRCD=0
            CALL      RPCCEB1
          ENDIF
.
STEB1000  CALL      RKCCEB1
          BRANCH    OVRCD,STEB9999
.
          ADD       ONE,TOTALEXT
          IF        (TOTALEXT%100=0)
            DISPLAY   *P26:24,*V2LON,TOTALEXT,"/1"
          ENDIF
.
          MOVE      "999999999999",CCEBFMN
          MOVE      ZERO,CCEBFMX
          MOVE      ZERO,CCEBFSV
          MOVE      "999999999999",CCEBTMN
          MOVE      ZERO,CCEBTMX
          MOVE      ZERO,CCEBTSV
          MOVE      "999999999999",CCEBLMN
          MOVE      ZERO,CCEBLMX
          MOVE      ZERO,CCEBLSV
.
          PACK      KEY48,CCEBLV1,SP70
          CALL      RSCCEC2
STEB1100  CALL      RKCCEC2
          BRANCH    OVRCD,STEB1900
          MATCH     CCEBLV1,CCECLV1
          GOTO      STEB1900 IF NOT EQUAL
.
          MATCH     "1",CCECEXC  * Excluded
          GOTO      STEB1100 IF EQUAL
.
          CALL      CHKEB000
.
          ASSIGN    CCECFTC-(CCEBFTC/CCEBNEP),F12P4
          ASSIGN    CCEBFSV+(F12P4*F12P4),CCEBFSV
.
          ASSIGN    CCECTTC-(CCEBTTC/CCEBNEP),F12P4
          ASSIGN    CCEBTSV+(F12P4*F12P4),CCEBTSV
.
          ASSIGN    CCECLOS-(CCEBLTO/CCEBNEP),F12P4
          ASSIGN    CCEBLSV+(F12P4*F12P4),CCEBLSV
.
          GOTO      STEB1100
.
STEB1900  IF        CCEBNEP>1
            ASSIGN    CCEBFSV/(CCEBNEP-1),CCEBFSV
            ASSIGN    CCEBTSV/(CCEBNEP-1),CCEBTSV
            ASSIGN    CCEBLSV/(CCEBNEP-1),CCEBLSV
          ENDIF
          CALL      UPCCEB1
          GOTO      STEB1000
.
STEB9999  RETURN
.
.------------------------------------------------------------
. Update Variance Casemix Level 2
.------------------------------------------------------------
STED0000  PACK      KEY20,SP70
          CALL      RDCCED1
          IF        OVRCD=0
            CALL      RPCCED1
          ENDIF
STED1000  CALL      RKCCED1
          BRANCH    OVRCD,STED9999
.
          ADD       ONE,TOTALEXT
          IF        (TOTALEXT%100=0)
            DISPLAY   *P26:24,*V2LON,TOTALEXT,"/2"
          ENDIF
.
          MOVE      "999999999999",CCEDFMN
          MOVE      ZERO,CCEDFMX
          MOVE      ZERO,CCEDFSV
          MOVE      "999999999999",CCEDTMN
          MOVE      ZERO,CCEDTMX
          MOVE      ZERO,CCEDTSV
          MOVE      "999999999999",CCEDLMN
          MOVE      ZERO,CCEDLMX
          MOVE      ZERO,CCEDLSV
.
          PACK      KEY48,CCEDLV1,CCEDLV2,SP70
          PACK      KEY20,CCEDLV1,CCEDLV2,SP70
          CALL      RSCCEC2
STED1100  CALL      RKCCEC2
          BRANCH    OVRCD,STED1900
          PACK      KEY48,CCECLV1,CCECLV2,SP70
          MATCH     KEY20,KEY48
          GOTO      STED1900 IF NOT EQUAL
.
          MATCH     "1",CCECEXC  * Excluded
          GOTO      STED1100 IF EQUAL
.
          CALL      CHKED000
.
          ASSIGN    CCECFTC-(CCEDFTC/CCEDNEP),F12P4
          ASSIGN    CCEDFSV+(F12P4*F12P4),CCEDFSV
.
          ASSIGN    CCECTTC-(CCEDTTC/CCEDNEP),F12P4
          ASSIGN    CCEDTSV+(F12P4*F12P4),CCEDTSV
.
          ASSIGN    CCECLOS-(CCEDLTO/CCEDNEP),F12P4
          ASSIGN    CCEDLSV+(F12P4*F12P4),CCEDLSV
.
          GOTO      STED1100
.
STED1900  IF        CCEDNEP>1
            ASSIGN    CCEDFSV/(CCEDNEP-1),CCEDFSV
            ASSIGN    CCEDTSV/(CCEDNEP-1),CCEDTSV
            ASSIGN    CCEDLSV/(CCEDNEP-1),CCEDLSV
          ENDIF
          CALL      UPCCED1
          GOTO      STED1000
.
STED9999  RETURN
.
.------------------------------------------------------------
. Update Variance Casemix Level 3
.------------------------------------------------------------
STEE0000  PACK      KEY30,SP70
          CALL      RDCCEE1
          IF        OVRCD=0
            CALL      RPCCEE1
          ENDIF
.
STEE1000  CALL      RKCCEE1
          BRANCH    OVRCD,STEE9999
.
          ADD       ONE,TOTALEXT
          IF        (TOTALEXT%100=0)
            DISPLAY   *P26:24,*V2LON,TOTALEXT,"/3"
          ENDIF
.
          MOVE      "999999999999",CCEEFMN
          MOVE      ZERO,CCEEFMX
          MOVE      ZERO,CCEEFSV
          MOVE      "999999999999",CCEETMN
          MOVE      ZERO,CCEETMX
          MOVE      ZERO,CCEETSV
          MOVE      "999999999999",CCEELMN
          MOVE      ZERO,CCEELMX
          MOVE      ZERO,CCEELSV
.
          PACK      KEY48,CCEELV1,CCEELV2,CCEELV3,SP70
          PACK      KEY30,CCEELV1,CCEELV2,CCEELV3,SP70
          CALL      RSCCEC2
STEE1100  CALL      RKCCEC2
          BRANCH    OVRCD,STEE1900
          PACK      KEY48,CCECLV1,CCECLV2,CCECLV3,SP70
          MATCH     KEY30,KEY48
          GOTO      STEE1900 IF NOT EQUAL
.
          MATCH     "1",CCECEXC  * Excluded
          GOTO      STEE1100 IF EQUAL
.
          CALL      CHKEE000
.
          ASSIGN    CCECFTC-(CCEEFTC/CCEENEP),F12P4
          ASSIGN    CCEEFSV+(F12P4*F12P4),CCEEFSV
.
          ASSIGN    CCECTTC-(CCEETTC/CCEENEP),F12P4
          ASSIGN    CCEETSV+(F12P4*F12P4),CCEETSV
.
          ASSIGN    CCECLOS-(CCEELTO/CCEENEP),F12P4
          ASSIGN    CCEELSV+(F12P4*F12P4),CCEELSV
.
          GOTO      STEE1100
.
STEE1900  IF        CCEENEP>1
            ASSIGN    CCEEFSV/(CCEENEP-1),CCEEFSV
            ASSIGN    CCEETSV/(CCEENEP-1),CCEETSV
            ASSIGN    CCEELSV/(CCEENEP-1),CCEELSV
          ENDIF
          CALL      UPCCEE1
          GOTO      STEE1000
.
STEE9999  RETURN
.------------------------------------------------------------
. Check Level 1 Min & Max
.------------------------------------------------------------
CHKEB000  IF        CCECFTC>CCEBFMX
            MOVE      CCECFTC,CCEBFMX
          ENDIF
          IF        CCECFTC<CCEBFMN
            MOVE      CCECFTC,CCEBFMN
          ENDIF
.
          IF        CCECTTC>CCEBTMX
            MOVE      CCECTTC,CCEBTMX
          ENDIF
          IF        CCECTTC<CCEBTMN
            MOVE      CCECTTC,CCEBTMN
          ENDIF
.
          IF        CCECLOS>CCEBLMX
            MOVE      CCECLOS,CCEBLMX
          ENDIF
          IF        CCECLOS<CCEBLMN
            MOVE      CCECLOS,CCEBLMN
          ENDIF
          RETURN
.------------------------------------------------------------
. Check Min & Max for Level 2
.------------------------------------------------------------
CHKED000  IF        CCECFTC>CCEDFMX
            MOVE      CCECFTC,CCEDFMX
          ENDIF
          IF        CCECFTC<CCEDFMN
            MOVE      CCECFTC,CCEDFMN
          ENDIF
.
          IF        CCECTTC>CCEDTMX
            MOVE      CCECTTC,CCEDTMX
          ENDIF
          IF        CCECTTC<CCEDTMN
            MOVE      CCECTTC,CCEDTMN
          ENDIF
.
          IF        CCECLOS>CCEDLMX
            MOVE      CCECLOS,CCEDLMX
          ENDIF
          IF        CCECLOS<CCEDLMN
            MOVE      CCECLOS,CCEDLMN
          ENDIF
          RETURN
.------------------------------------------------------------
. Check Level 3 Min & Max
.------------------------------------------------------------
CHKEE000  IF        CCECFTC>CCEEFMX
            MOVE      CCECFTC,CCEEFMX
          ENDIF
          IF        CCECFTC<CCEEFMN
            MOVE      CCECFTC,CCEEFMN
          ENDIF
.
          IF        CCECTTC>CCEETMX
            MOVE      CCECTTC,CCEETMX
          ENDIF
          IF        CCECTTC<CCEETMN
            MOVE      CCECTTC,CCEETMN
          ENDIF
.
          IF        CCECLOS>CCEELMX
            MOVE      CCECLOS,CCEELMX
          ENDIF
          IF        CCECLOS<CCEELMN
            MOVE      CCECLOS,CCEELMN
          ENDIF
          RETURN
.--------------------------------------------------
. Calculate Episode Costs
.--------------------------------------------------
CALC0000  DISPLAY   *P1:24,*EL,"Calculating Episode Costs & Resource Usage : "
          PACK      KEY18,SP70
          CALL      RSCCEC1
CALC1000  CALL      RKCCEC1
          BRANCH    OVRCD,CALC9000
          ADD       ONE,TOTALEXT
          IF        (TOTALEXT%100=0)
            DISPLAY   *P46:24,*V2LON,TOTALEXT
          ENDIF
.
          MOVE      ZERO,CCECFTC
          MOVE      ZERO,CCECTTC
.
          PACK      KEY31,CCECHCD,CCECEPS,SP70
          CALL      RSCCUP2
CALC2000  CALL      RKCCUP2
          BRANCH    OVRCD,CALC2900
          MATCH     CCECHCD,CCUPHCD
          GOTO      CALC2900 IF NOT EQUAL
          MATCH     CCECEPS,CCUPENC
          GOTO      CALC2900 IF NOT EQUAL
.
          CALL      CALFR000     * Calculate "From"  Comparision Costs
          CALL      CALTO000     * Calculate "To  " Comparision Costs
.
          MATCH     "1",CCECEXC  * Excluded from Resource Usage Summary
          GOTO      CALC2000 IF EQUAL
.
          MATCH     "1",CCEARUA
          IF        @EQUAL
            CALL      UPRES000   * Update Resource Usage Summary Files
          ENDIF
          GOTO      CALC2000
.
CALC2900  CALL      UPCCEC1
          GOTO      CALC1000
.
CALC9000  RETURN
.------------------------------------------------------------
. Calculate "From" Comparision Costs
.------------------------------------------------------------
CALFR000  PACK      KEY18,CCEAFYR,CCEAFCM,CCUPHCD,CCUPPCD
          CALL      RDCCMS1
          IF        OVRCD=1
            PACK      KEY26,CCEAFYR,CCEAFCM,CCUPHCD,CCUPDPT,CCUPPCD
            CALL      RDCCMT1
            IF        OVRCD=1
              MOVE      ZERO,CCMSUCT
              MOVE      ZERO,CCMSFIX
              MOVE      ZERO,CCMSFUC
            ELSE
              MOVE      CCMTUCT,CCMSUCT
              MOVE      CCMTFIX,CCMSFIX
              MOVE      CCMTFUC,CCMSFUC
            ENDIF
          ENDIF
          IF        CCMSFIX=1
            ASSIGN    CCUPQTY*CCMSFUC,COST1AMT
          ELSE
            ASSIGN    CCUPQTY*CCMSUCT,COST1AMT
          ENDIF
          ASSIGN    CCECFTC+COST1AMT,CCECFTC
          RETURN
.------------------------------------------------------------
. Calculate "To" Comparision Costs
.------------------------------------------------------------
CALTO000  PACK      KEY18,CCEATYR,CCEATCM,CCUPHCD,CCUPPCD
          CALL      RDCCMS1
          IF        OVRCD=1
            PACK      KEY26,CCEATYR,CCEATCM,CCUPHCD,CCUPDPT,CCUPPCD
            CALL      RDCCMT1
            IF        OVRCD=1
              MOVE      ZERO,CCMSUCT
              MOVE      ZERO,CCMSFIX
              MOVE      ZERO,CCMSFUC
            ELSE
              MOVE      CCMTUCT,CCMSUCT
              MOVE      CCMTFIX,CCMSFIX
              MOVE      CCMTFUC,CCMSFUC
            ENDIF
          ENDIF
          IF        CCMSFIX=1
            ASSIGN    CCUPQTY*CCMSFUC,COST2AMT
          ELSE
            ASSIGN    CCUPQTY*CCMSUCT,COST2AMT
          ENDIF
          ASSIGN    CCECTTC+COST2AMT,CCECTTC
          RETURN
.-----------------------------------------------------------------------
. Update Resuorce Usage Details at Department and Patient Service Level
.-----------------------------------------------------------------------
UPRES000  PACK      KEY20,CCECLV1,CCUPHCD,CCUPDPT
          CALL      RDCCEF1
          IF        OVRCD=0
            ADD       CCUPQTY,CCEFQTY
            ADD       COST1AMT,CCEFFTC
            ADD       COST2AMT,CCEFTTC
            CALL      UPCCEF1
          ELSE
            UNPACK    KEY20,CCEFLV1,CCEFHCD,CCEFDPT
            MOVE      CCUPQTY,CCEFQTY
            MOVE      COST1AMT,CCEFFTC
            MOVE      COST2AMT,CCEFTTC
            CALL      WRCCEF1
          ENDIF
.
          PACK      KEY28,CCECLV1,CCUPHCD,CCUPDPT,CCUPPCD
          CALL      RDCCEG1
          IF        OVRCD=0
            ADD       CCUPQTY,CCEGQTY
            ADD       COST1AMT,CCEGFTC
            ADD       COST2AMT,CCEGTTC
            CALL      UPCCEG1
          ELSE
            UNPACK    KEY28,CCEGLV1,CCEGHCD,CCEGDPT,CCEGPCD
            MOVE      CCUPQTY,CCEGQTY
            MOVE      COST1AMT,CCEGFTC
            MOVE      COST2AMT,CCEGTTC
            CALL      WRCCEG1
          ENDIF
.
          RETURN
.--------------------------------------------------
. Calculate Summary Costs
.--------------------------------------------------
SUMM0000  DISPLAY   *P1:24,*EL,"Casemix Extract Level Summary : "
          PACK      KEY18,SP70
          MOVE      ZERO,SECTOR
          CALL      RSCCEC1
SUMM1000  CALL      RKCCEC1
          BRANCH    OVRCD,SUMM9000
          ADD       ONE,SECTOR
          IF        (SECTOR%100=0)
            DISPLAY   *P33:24,*V2LON,SECTOR
          ENDIF
.
          MATCH     "1",CCECEXC         * Excluded from Summary
          GOTO      SUMM1000 IF EQUAL
.
          CALL      UPDEB000
.
          MATCH     SP70,CCEALV2
          GOTO      SUMM1000 IF EQUAL
          CALL      UPDED000
.
          MATCH     SP70,CCEALV3
          GOTO      SUMM1000 IF EQUAL
          CALL      UPDEE000
          GOTO      SUMM1000
SUMM9000
SUMM9999  RETURN
.------------------------------------------------------------
. Update Casemix Level 1
.------------------------------------------------------------
UPDEB000  PACK      KEY10,CCECLV1
          CALL      RDCCEB1
          IF        OVRCD=1
            CALL      CLREB000
            MOVE      CCECLV1,CCEBLV1
            CALL      WRCCEB1
            CALL      RDCCEB1
          ENDIF
          ADD       ONE,CCEBNEP    * Increase Number of Episodes
          ADD       CCECFTC,CCEBFTC
          ADD       CCECTTC,CCEBTTC
          ADD       CCECLOS,CCEBLTO
          CALL      UPCCEB1
          RETURN
.------------------------------------------------------------
. Update Casemix Level 2
.------------------------------------------------------------
UPDED000  PACK      KEY20,CCECLV1,CCECLV2,SP70
          MATCH     SP70,KEY20
          GOTO      UPDED999 IF EQUAL
          CALL      RDCCED1
          IF        OVRCD=1
            CALL      CLRED000
            UNPACK    KEY20,CCEDLV1,CCEDLV2
            CALL      WRCCED1
            CALL      RDCCED1
          ENDIF
          ADD       ONE,CCEDNEP    * Increase Number of Episodes
          ADD       CCECFTC,CCEDFTC
          ADD       CCECTTC,CCEDTTC
          ADD       CCECLOS,CCEDLTO
          CALL      UPCCED1
UPDED999  RETURN
.------------------------------------------------------------
. Update Casemix Level 3
.------------------------------------------------------------
UPDEE000  PACK      KEY30,CCECLV1,CCECLV2,CCECLV3,SP70
          MATCH     SP70,KEY30
          GOTO      UPDEE999 IF EQUAL
          CALL      RDCCEE1
          IF        OVRCD=1
            CALL      CLREE000
            UNPACK    KEY30,CCEELV1,CCEELV2,CCEELV3
            CALL      WRCCEE1
            CALL      RDCCEE1
          ENDIF
          ADD       ONE,CCEENEP    * Increase Number of Episodes
          ADD       CCECFTC,CCEEFTC
          ADD       CCECTTC,CCEETTC
          ADD       CCECLOS,CCEELTO
          CALL      UPCCEE1
.
UPDEE999  RETURN
.------------------------------------------------------------
. Clear Summary File Details
.------------------------------------------------------------
CLREB000  MOVE      ZERO,CCEBNEP
          MOVE      ZERO,CCEBFTC
          MOVE      "999999999999",CCEBFMN
          MOVE      ZERO,CCEBFMX
          MOVE      ZERO,CCEBFSV
          MOVE      ZERO,CCEBTTC
          MOVE      "999999999999",CCEBTMN
          MOVE      ZERO,CCEBTMX
          MOVE      ZERO,CCEBTSV
          MOVE      "999999999999",CCEBLMN
          MOVE      ZERO,CCEBLMX
          MOVE      ZERO,CCEBLSV
          MOVE      ZERO,CCEBLTO
          RETURN
.
CLRED000  MOVE      ZERO,CCEDNEP
          MOVE      ZERO,CCEDFTC
          MOVE      "999999999999",CCEDFMN
          MOVE      ZERO,CCEDFMX
          MOVE      ZERO,CCEDFSV
          MOVE      ZERO,CCEDTTC
          MOVE      "999999999999",CCEDTMN
          MOVE      ZERO,CCEDTMX
          MOVE      ZERO,CCEDTSV
          MOVE      "999999999999",CCEDLMN
          MOVE      ZERO,CCEDLMX
          MOVE      ZERO,CCEDLSV
          MOVE      ZERO,CCEDLTO
          RETURN
.
CLREE000  MOVE      ZERO,CCEENEP
          MOVE      ZERO,CCEEFTC
          MOVE      "999999999999",CCEEFMN
          MOVE      ZERO,CCEEFMX
          MOVE      ZERO,CCEEFSV
          MOVE      ZERO,CCEETTC
          MOVE      "999999999999",CCEETMN
          MOVE      ZERO,CCEETMX
          MOVE      ZERO,CCEETSV
          MOVE      "999999999999",CCEELMN
          MOVE      ZERO,CCEELMX
          MOVE      ZERO,CCEELSV
          MOVE      ZERO,CCEELTO
          RETURN
.---------------------------------------------------------------------------
. Create and Open Files
.---------------------------------------------------------------------------
CREAT000  DISPLAY  *P1:24,*EL,"Creating Extract Files : "
          MOVE     "cceb",KEY4
          PACK     FILENAME,KEY4,CCEAEID
          DISPLAY  *P26:24,*EL,FILENAME
          REP      " 0",FILENAME
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCEBA1,FILENAME
          TRAPCLR  IO
          IF       OVRCD=0
            CLOSE    CCSCEBA1,DELETE
          ENDIF
          PACK     COMMAND,SGENISB,FILENAME,CCEBIDX
          EXECUTE  COMMAND,TASKID
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCEBA1,FILENAME
          TRAPCLR  IO
          IF       OVRCD=1
            BEEP
            MOVE     "Unable to Create Casemix Extract Files - ",DISPMSG
            CALL     MESSAGE1
            GOTO     CREAT900
          ENDIF
.
          MOVE     "cced",KEY4
          PACK     FILENAME,KEY4,CCEAEID
          DISPLAY  *P26:24,*EL,FILENAME
          REP      " 0",FILENAME
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCEDA1,FILENAME
          TRAPCLR  IO
          IF       OVRCD=0
            CLOSE    CCSCEDA1,DELETE
          ENDIF
          PACK     COMMAND,SGENISB,FILENAME,CCEDIDX
          EXECUTE  COMMAND,TASKID
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCEDA1,FILENAME
          TRAPCLR  IO
          IF       OVRCD=1
            BEEP
            MOVE     "Unable to Create Casemix Extract Files - ",DISPMSG
            CALL     MESSAGE1
            GOTO     CREAT900
          ENDIF
.
          MOVE     "ccee",KEY4
          PACK     FILENAME,KEY4,CCEAEID
          DISPLAY  *P26:24,*EL,FILENAME
          REP      " 0",FILENAME
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCEEA1,FILENAME
          TRAPCLR  IO
          IF       OVRCD=0
            CLOSE    CCSCEEA1,DELETE
          ENDIF
          PACK     COMMAND,SGENISB,FILENAME,CCEEIDX
          EXECUTE  COMMAND,TASKID
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCEEA1,FILENAME
          TRAPCLR  IO
          IF       OVRCD=1
            BEEP
            MOVE     "Unable to Create Casemix Extract Files - ",DISPMSG
            CALL     MESSAGE1
            GOTO     CREAT900
          ENDIF
.
          MOVE     "ccef",KEY4
          PACK     FILENAME,KEY4,CCEAEID
          DISPLAY  *P26:24,*EL,FILENAME
          REP      " 0",FILENAME
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCEFA1,FILENAME
          TRAPCLR  IO
          IF       OVRCD=0
            CLOSE    CCSCEFA1,DELETE
          ENDIF
          PACK     COMMAND,SGENISB,FILENAME,CCEFIDX
          EXECUTE  COMMAND,TASKID
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCEFA1,FILENAME
          TRAPCLR  IO
          IF       OVRCD=1
            BEEP
            MOVE     "Unable to Create Casemix Extract Files - ",DISPMSG
            CALL     MESSAGE1
            GOTO     CREAT900
          ENDIF
.
          MOVE     "cceg",KEY4
          PACK     FILENAME,KEY4,CCEAEID
          DISPLAY  *P26:24,*EL,FILENAME
          REP      " 0",FILENAME
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCEGA1,FILENAME
          TRAPCLR  IO
          IF       OVRCD=0
            CLOSE    CCSCEGA1,DELETE
          ENDIF
          PACK     COMMAND,SGENISB,FILENAME,CCEGIDX
          EXECUTE  COMMAND,TASKID
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     CCSCEGA1,FILENAME
          TRAPCLR  IO
          IF       OVRCD=1
            BEEP
            MOVE     "Unable to Create Casemix Extract Files - ",DISPMSG
            CALL     MESSAGE1
            GOTO     CREAT900
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      CREAT999
.
CREAT900  MOVE      ONE,EXIT
.
CREAT999  RETURN
.
.----------------------------------------------------------------------
. Enter Casemix Extract ID
.----------------------------------------------------------------------
EEID0000  MOVE      ZERO,CKEYTYP
          CALL      KCCEAA00
          BRANCH    EXIT,EEID9999,EEID9999
          CALL      GETCME00
          CALL      CCSCOPOP
          MOVE      ZERO,OVRCD
.
EEID9999  RETURN
.======================================================================
. Determine Display Values for a Valid Casemix Extract Code
.======================================================================
GETCME00  MATCH     SP70,CCEAFDD
          IF        @EQUAL
            MOVE      "Start     ",FROMDD
          ELSE
            UNPACK    CCEAFDD,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
            MOVE      CPCDATE,FROMDD
          ENDIF
.
          MATCH     "99999999",CCEATDD
          IF        @EQUAL
            MOVE      "Finish    ",TODD
          ELSE
            UNPACK    CCEATDD,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
            MOVE      CPCDATE,TODD
          ENDIF
.
          MATCH     SP70,CCEAFAD
          IF        @EQUAL
            MOVE      "Start     ",FROMAD
          ELSE
            UNPACK    CCEAFAD,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
            MOVE      CPCDATE,FROMAD
          ENDIF
.
          MATCH     "99999999",CCEATAD
          IF        @EQUAL
            MOVE      "Finish    ",TOAD
          ELSE
            UNPACK    CCEATAD,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
            MOVE      CPCDATE,TOAD
          ENDIF
.
          MOVE     CCEAVIS,F1
          BRANCH   F1,GETCME10,GETCME20,GETCME30
          MOVE     "All        ",VISITDES
          GOTO     GETCME40
GETCME10  MOVE     "A & E      ",VISITDES
          GOTO     GETCME40
GETCME20  MOVE     "Outpatients ",VISITDES
          GOTO     GETCME40
GETCME30  MOVE     "Inpatients",VISITDES
          GOTO     GETCME40
.
GETCME40
          MOVE     SP70,CLV1DES
          MOVE     SP70,CLV2DES
          MOVE     SP70,CLV3DES
          MOVE     CCEALV1,KEY3
          CALL     RDCCST1
          IF       OVRCD=0
            MOVE     CCSTDES,CLV1DES
          ENDIF
.
          MOVE     CCEALV2,KEY3
          CALL     RDCCST1
          IF       OVRCD=0
            MOVE     CCSTDES,CLV2DES
          ENDIF
.
          MOVE     CCEALV3,KEY3
          CALL     RDCCST1
          IF       OVRCD=0
            MOVE     CCSTDES,CLV3DES
          ENDIF
.
          MATCH    SP70,CCEAFCM
          IF       @EQUAL
            MOVE     "Actual Costs",FROMCMOD
          ELSE
            MOVE     CCEAFCM,KEY4
            CALL     RDCCMA1
            MOVE     CCMADES,FROMCMOD
          ENDIF
.
          MATCH    SP70,CCEATCM
          IF       @EQUAL
            MOVE     "Actual Costs",TOCMOD
          ELSE
            MOVE     CCEATCM,KEY4
            CALL     RDCCMA1
            MOVE     CCMADES,TOCMOD
          ENDIF
.
          MATCH    "0",CCEAUST
          IF       !@EQUAL
            MOVE     ONE,CCEAUST
          ENDIF
.
          MOVE       CCEADAY,F1
          IF         F1=0
            MOVE       "Exclude Day Cases",DAYCDESC
          ELSE
            IF         F1=2
              MOVE       "Day Cases Only",DAYCDESC
            ELSE
              MOVE       "Include Day Cases",DAYCDESC
            ENDIF
          ENDIF
.
          RETURN
RDATE000   MOVE     "   18",FLDID
           CALL     GETPOSIT
           UNPACK   CCEATDD,CCENT,CYEAR,CMON,CDAY
           CALL     KEYDATE
           BRANCH   OVRCD,RDATE100
           MATCH    SP2,CDAY
           GOTO     RDATE100 IF EQUAL
           PACK     NEWFROM,CCENT,CYEAR,CMON,CDAY
           REP      " 0",NEWFROM
           CALL     PACDATE
           MOVE     CPCDATE,FROMNEW
           GOTO     RDATE140
RDATE100   MOVE     "Start             ",FROMNEW
           MOVE     SP70,NEWFROM
.
RDATE140   MOVE     FROMNEW,VAR
           CALL     DISPITEM
.
RDATE150   MOVE     "   19",FLDID
           CALL     GETPOSIT
           MOVE     SP70,CDAY
           MOVE     CMM,CMON
           MOVE     CYY,CYEAR
           MOVE     CCC,CCENT
           CALL     KEYDATE
           BRANCH   OVRCD,RDATE200
           MATCH    SP2,CDAY
           GOTO     RDATE200 IF EQUAL
           PACK     NEWTO,CCENT,CYEAR,CMON,CDAY
           REP      " 0",NEWTO
           CALL     PACDATE
           MOVE     CPCDATE,TONEW
           MATCH    NEWFROM,NEWTO
           GOTO     RDATE999 IF EQUAL
           GOTO     RDATE999 IF NOT LESS
           BEEP
           MOVE     "To Date Must Be > From Date - ",DISPMSG
           CALL     MESSAGE1
           GOTO     RDATE000
.
RDATE200   MOVE     "Finish             ",TONEW
           MOVE     "99999999",NEWTO
.
RDATE999   MOVE     "   18",FLDID
           CALL     GETPOSIT
           RETURN

.---------------------------------------------------------------------------
. Read any Range Details
.---------------------------------------------------------------------------
GETEXT00  PACK     KEY4,CCEAEID
          CALL     CLREXT00          * Clear Record
          CALL     RDCCEX1             * Read Record
          IF       OVRCD=0
            CALL     SETEXT00          * Setup Names
          ENDIF
          RETURN
.
SETEXT00  MOVE      ZERO,SECTOR
          REPEAT
            ADD       ONE,SECTOR
            LOAD      KEY3,SECTOR,CCEXR01,CCEXR02,CCEXR03,CCEXR04,CCEXR05:
                                  CCEXR06,CCEXR07,CCEXR08,CCEXR09,CCEXR10:
                                  CCEXR11,CCEXR12,CCEXR13,CCEXR14
            MATCH     SP70,KEY3
            IF        !@EQUAL
              CALL      RDCCST1
              STORE     CCSTDES,SECTOR,DESC01,DESC02,DESC03,DESC04,DESC05:
                                       DESC06,DESC07,DESC08,DESC09,DESC10:
                                       DESC11,DESC12,DESC13,DESC14
.
              LOAD      KEY10,SECTOR,CCEXF01,CCEXF02,CCEXF03,CCEXF04,CCEXF05:
                                     CCEXF06,CCEXF07,CCEXF08,CCEXF09,CCEXF10:
                                     CCEXF11,CCEXF12,CCEXF13,CCEXF14
              SFORMAT   VAR,CCSTLEN
              MATCH     SP70,KEY10
              IF        @EQUAL
                MOVE      "Start                        ",KEY35
              ELSE
                PACK      KEY13,CCSTSTY,KEY10
                CALL      RDCCXH1
                MOVE      KEY10,VAR
                PACK      KEY35,VAR,SP1,CCXHDES
              ENDIF
              STORE     KEY35,SECTOR,FROM01,FROM02,FROM03,FROM04,FROM05:
                                    FROM06,FROM07,FROM08,FROM09,FROM10:
                                    FROM11,FROM12,FROM13,FROM14
.
              LOAD      KEY10,SECTOR,CCEXT01,CCEXT02,CCEXT03,CCEXT04,CCEXT05:
                                     CCEXT06,CCEXT07,CCEXT08,CCEXT09,CCEXT10:
                                     CCEXT11,CCEXT12,CCEXT13,CCEXT14
              SFORMAT   VAR,CCSTLEN
              MATCH     Z70,KEY10
              IF        @EQUAL
                MOVE      "Finish                       ",KEY35
              ELSE
                PACK      KEY13,CCSTSTY,KEY10
                CALL      RDCCXH1
                MOVE      KEY10,VAR
                PACK      KEY35,VAR,SP1,CCXHDES
              ENDIF
              STORE     KEY35,SECTOR,TO01,TO02,TO03,TO04,TO05:
                                    TO06,TO07,TO08,TO09,TO10:
                                    TO11,TO12,TO13,TO14
              SFORMAT   VAR,127
            ENDIF
         UNTIL      SECTOR=14
         RETURN
.
CLREXT00  MOVE      SP70,CCEXR01
          MOVE      SP70,CCEXF01
          MOVE      SP70,CCEXT01
          MOVE      SP70,CCEXR02
          MOVE      SP70,CCEXF02
          MOVE      SP70,CCEXT02
          MOVE      SP70,CCEXR03
          MOVE      SP70,CCEXF03
          MOVE      SP70,CCEXT03
          MOVE      SP70,CCEXR04
          MOVE      SP70,CCEXF04
          MOVE      SP70,CCEXT04
          MOVE      SP70,CCEXR05
          MOVE      SP70,CCEXF05
          MOVE      SP70,CCEXT05
          MOVE      SP70,CCEXR06
          MOVE      SP70,CCEXF06
          MOVE      SP70,CCEXT06
          MOVE      SP70,CCEXR07
          MOVE      SP70,CCEXF07
          MOVE      SP70,CCEXT07
          MOVE      SP70,CCEXR08
          MOVE      SP70,CCEXF08
          MOVE      SP70,CCEXT08
          MOVE      SP70,CCEXR09
          MOVE      SP70,CCEXF09
          MOVE      SP70,CCEXT09
          MOVE      SP70,CCEXR10
          MOVE      SP70,CCEXF10
          MOVE      SP70,CCEXT10
          MOVE      SP70,CCEXR11
          MOVE      SP70,CCEXF11
          MOVE      SP70,CCEXT11
          MOVE      SP70,CCEXR12
          MOVE      SP70,CCEXF12
          MOVE      SP70,CCEXT12
          MOVE      SP70,CCEXR13
          MOVE      SP70,CCEXF13
          MOVE      SP70,CCEXT13
          MOVE      SP70,CCEXR14
          MOVE      SP70,CCEXF14
          MOVE      SP70,CCEXT14
          MOVE      SP70,DESC01
          MOVE      SP70,DESC02
          MOVE      SP70,DESC03
          MOVE      SP70,DESC04
          MOVE      SP70,DESC05
          MOVE      SP70,DESC06
          MOVE      SP70,DESC07
          MOVE      SP70,DESC08
          MOVE      SP70,DESC09
          MOVE      SP70,DESC10
          MOVE      SP70,DESC11
          MOVE      SP70,DESC12
          MOVE      SP70,DESC13
          MOVE      SP70,DESC14
          MOVE      SP70,FROM01
          MOVE      SP70,FROM02
          MOVE      SP70,FROM03
          MOVE      SP70,FROM04
          MOVE      SP70,FROM05
          MOVE      SP70,FROM06
          MOVE      SP70,FROM07
          MOVE      SP70,FROM08
          MOVE      SP70,FROM09
          MOVE      SP70,FROM10
          MOVE      SP70,FROM11
          MOVE      SP70,FROM12
          MOVE      SP70,FROM13
          MOVE      SP70,FROM14
          MOVE      SP70,TO01
          MOVE      SP70,TO02
          MOVE      SP70,TO03
          MOVE      SP70,TO04
          MOVE      SP70,TO05
          MOVE      SP70,TO06
          MOVE      SP70,TO07
          MOVE      SP70,TO08
          MOVE      SP70,TO09
          MOVE      SP70,TO10
          MOVE      SP70,TO11
          MOVE      SP70,TO12
          MOVE      SP70,TO13
          MOVE      SP70,TO14
          RETURN
.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       CCSAGEIO/INC
          INC       CCSCEAIO/INC
          INC       CCSCEAKY    
          INC       CCSCEBIO/INC
          INC       CCSCECIO/INC
          INC       CCSCEDIO/INC
          INC       CCSCEEIO/INC
          INC       CCSCEFIO/INC
          INC       CCSCEGIO/INC
          INC       CCSCEXIO/INC
          INC       CCSCMAIO/INC
          INC       CCSCOPCD    
          INC       CCSDRGIO/INC
          INC       CCSEPSIO/INC
          INC       CCSGETCD    
          INC       CCSHCDIO/INC
          INC       CCSIADIO/INC
          INC       CCSMSCIO/INC
          INC       CCSMTSIO/INC
          INC       CCSSTYIO/INC
          INC       CCSUPDIO/INC
          INC       CCSXHDIO/INC
.
          INC       STDGENCD
.

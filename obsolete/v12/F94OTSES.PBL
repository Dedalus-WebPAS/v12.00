.*****************************************************************************
.*    Program      : F94OTSES                                                *
.*    Description  : Fix clinic status                                       *
.*                                                                           *
.*    Author       :  Jill Habasque                                          *
.*    Date         :  19/06/2005                                             *
.*    Modifications:                                                         *
.*****************************************************************************
.
          INC       STD001FD
          INC       OUTSESFD/INC
          INC       OUTMA1FD/INC
          INC       OUTBOAFD/INC
          INC       PATCODFD/INC
.
HOUR      FORM      2
MIN       DIM       2
MINUTES   FORM      6
RECNUM    FORM      8
.
.
PRGNAM    INIT      "Fix clinic status"
PRGID     INIT      "F94OTSES"
VERSION   INIT      "V12.00.00"
.
. Start of Program
.
MAIN0000  CALL      INIT0000                      * init and open files
          BRANCH    EXIT,MAIN9999                 * init failure
.
.
          CALL      CONTQST                       * Ok to continue ?
          BRANCH    CEXIT,MAIN1000,MAIN0000,MAIN9999 * Yes, no, cancel
.
MAIN1000  CALL      READ0000                      * read old records 
.
MAIN9999  CHAIN     PGM
+
.********************************************************************
.*                          INIT0000                                *
.*  Display heading and check that the files needed exist&open them *
.********************************************************************
INIT0000  CALL      DISPHEAD
          MOVE      ZERO,RECNUM
          OPEN      OUTBOKA1,"outbokaf" * Open the booking file 
          OPEN      PATCODE1,"patcodes" * Open the booking file 
          OPEN      OUTMA1A1,"outma1af" * Open the booking file 
          OPEN      OUTSESA1,"outsesaf" * Open the booking file 
          MOVE      ZERO,EXIT
          CALL      IBACLOCK
          REP       " 0",CDATE
          DISPLAY   *P1:19,"Started : ",CDATE,SP1,CTIMEIS:
                    *P1:20,"Record : "
.
INIT9999  RETURN
+
.**********************************************************************
.*                               READ0000                             *
.*             loop thru old file                                     *
.**********************************************************************
READ0000  DISPLAY   *P1:20,*EL,"Record No. : ";
          PACK      KEY25,SP70
          CALL      RDSSESA1
READ1000  CALL      RDKSESA1
          BRANCH    OVRCD,READ6000                * no more records
          ADD       ONE,RECNUM                    * update record counter
.
          PACK      KEY18,OSESITE,OSECLIN,OSEDAY,OSESTRT,SP70
          CALL      RDMASA1
.
         PACK      OSESCSTT,SP5
         CALL      GCST0000
.
.
READ2000  CALL      UPSESA1
.
          IF        (RECNUM%1000) = 0
            DISPLAY   *P15:20,*V2LON,RECNUM,SP1,OSESSLTN,SP1,OSESSLTR
            DISPLAY   *P15:21,*V2LON,RECNUM,SP1,OSEBNEW,SP1,OSEBRV
          ENDIF
.
          GOTO      READ1000                      * get next record
.
READ6000  CLOSE     OUTSESA1                      * close new file
.
          CALL      IBACLOCK
          REP       " 0",CDATE
          DISPLAY   *P1:22,"Ended  : ",CDATE,SP1,CTIMEIS
.
READ9999  RETURN
.
+
.**********************************************************************
.*                               GCST0000                             *
.*        Get Clinic Status                                           *
.**********************************************************************
GCST0000  PACK      KEY28,OSESITE,OSECLIN,OSEDATE,OSESTRT,SP10
          CALL      RDSBOKA1
          BRANCH    OVRCD,GCST9999
          CALL      RDKBOKA1
          BRANCH    OVRCD,GCST9999
.
          MATCH     OSESITE,OBASITE
          GOTO      GCST9999 IF NOT EQUAL
          MATCH     OSECLIN,OBACLIN
          GOTO      GCST9999 IF NOT EQUAL
          MATCH     OSEDATE,OBADATE
          GOTO      GCST9999 IF NOT EQUAL
          MATCH     OSESTRT,OBASTRT
          GOTO      GCST9999 IF NOT EQUAL
.
GCST1000  PACK      OSESCSTT,OBASESST,SP10
.
GCST9999  RETURN
.
          INC       OUTSESIO/INC
          INC       OUTBOAIO/INC
          INC       OUTMA1IO/INC
          INC       PATCODIO/INC
          INC       STD001IO

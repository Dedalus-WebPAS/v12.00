<meta name="TemplateVersion" content="V11.00.00">
<meta name="TemplateHome" content="pacific">
<meta name="HelpFileName" content="NoContextSet.html">
<script type="text/javascript" src="../js/OutExtraTemplates.js"></script>
<script type="text/javascript" src="../js/outweb0205.js"></script>
<script type="text/javascript">

//-----------------------------------------------------------------
// Function To check Referral Letters
//-----------------------------------------------------------------
function checkRefLetter(urnumber) {
  if (isWhitespace(urnumber)) return;;
  ReturnFunction="" ;
  for (var i=1; i < checkRefLetter.arguments.length; i++) {
   if (typeof(checkRefLetter.arguments[i]) == 'function') {
     ReturnFunction=checkRefLetter.arguments[i] } }
  var serverURL = "../cgi-bin/outweb02.pbl?reportno=9&updatety=6" +
                  "&urnumber="+urnumber.replace(/ /g,"+")
  var returnValue = RSExecute(serverURL);
  ReturnValue=returnValue.return_value.split("|");
  if (returnValue.status==0) {

    if (ReturnValue[0] == 1) {    // Unbooked referral exists
 
      // Construct warning message
      if (isWhitespace(ReturnValue[1])) 
        { ReturnValue[1] = "Unknown Date"; }
      if (isWhitespace(ReturnValue[2])) 
        { ReturnValue[2] = "Unknown"; }
      if (isWhitespace(ReturnValue[3])) 
        { ReturnValue[3] = "Unknown"; }
      var message = "Warning : Referral Letter Exists for " + ReturnValue[1] +
                    "; Clinic Type " + ReturnValue[2] + "; Clinic Id " +
                    ReturnValue[3] + "\nClick OK to continue " +
                    "without selecting the letter, Cancel to select letter.";

      ans=confirm(message)
      if (!ans) { 
        DFrameExit();
        PatientLinkTo("allweb02.pbl",2,22,0,0,0);
      }
    }

    if (typeof(ReturnFunction) == 'function') { ReturnFunction() } 
  }
}

function SubmitFinal() {
  setRedirect()
  if (!validateMandatory(AddForm)) {
    return;
  }
  p=document.AddForm
  p.dummydat.value=p.clindate.value.substr(4,11);
  validateSuspension(p.urnumber,p.dummydat,p.datefrom,p.dateto);
  if(p.datefrom.value!='0'){ 
       ans=confirm("Warning : Patient has a Suspension record for period \n" +
             "\t" + p.datefrom.value  + " - " + p.dateto.value);
       if (ans!=true) {
          return; }
  } 
  AddForm.submit();
}
function setRedirect() {
  strTemplate="" ;
  scrName="";
  checkInd=document.AddForm.outbb002.value.substr(3,5)
  if(checkInd.search(/W/g) >= 0) {
    strTemplate="005";
    scrName="WC";}
  if(checkInd.search(/M/g) >= 0) {
    strTemplate="042";
    scrName="TAC";}
  if(checkInd.search(/V/g) >= 0) {
    strTemplate="043";
    scrName="VA";}

  checkInd=document.AddForm.outbb002.value.substr(8,1)
  if(checkInd.search(/C/g) >= 0) {
    strTemplate="021";
    scrName="CT";}

  if (strTemplate=="") {
    if ((document.AddForm.ptcnueoc.value==1) &&
        (document.AddForm.outbb002.value.substr(5,1)=='A')) {
      scrName="ACC";
      document.AddForm.redirect.value="eocweb01.pbl?reportno=1&template=006"
        + "&urnumber=" + PatientLinks.urnumber.value.replace(/ /g,"+")
        + "&returncd=OUT";
    }
    else {
      document.AddForm.redirect.value="outweb02.pbl?reportno=3&template=1" +
                                      "&shwprint=1" 
    if (!isWhitespace(document.AddForm.waitflag.value)) {
    document.AddForm.redirect.value=document.AddForm.redirect.value +
               "&waitflag=" + document.AddForm.waitflag.value
    }
    }
  }
  else {
    document.AddForm.redirect.value="patweb89.pbl?reportno=01" +
               "&template=" + strTemplate +
               "&systflag=2" +
               "&urnumber=" + PatientLinks.urnumber.value.replace(/ /g,"+")  
    if (!isWhitespace(document.AddForm.waitflag.value)) {
    document.AddForm.redirect.value=document.AddForm.redirect.value +
               "&waitflag=" + document.AddForm.waitflag.value
    }
  }
  chkExtraTempl(document.AddForm,"B",document.AddForm.newslotk.value,
                PatientLinks.urnumber.value.replace(/ /g,"+"),scrName)
}
function ClinicSearch() {
   if (!isWhitespace(AddForm.newslotk.value)) {
     cancelSlot(AddForm.newslotk.value,ClinicSearchLink)
   }
}
function ClinicSearchLink() {
   AddForm.outbb016.value=trim(AddForm.outbb016.value)
   AddForm.srchclid.value=AddForm.dummy.value.substring(6,11);
   window.ReturnFunction="" ;
   ClinicSearchFrame(AddForm.newslotk,AddForm.clindesc,AddForm.clindate, 
        AddForm.outbb016,AddForm.srchclid,AddForm.defvisty,
        AddForm.deftovrd,AddForm.refrlvis)

}
function AppointSearch() {
   if (!isWhitespace(AddForm.newslotk.value)) {
     cancelSlot(AddForm.newslotk.value,AppointSearchLink)
   }
}
function AppointSearchLink() {
  window.ReturnFunction="" ;
  AppointmentSearchFrame(AddForm.newslotk,AddForm.clindesc,AddForm.clindate,
                AddForm.defclnty,AddForm.defclnid,AddForm.defvisty,
                AddForm.deftovrd,AddForm.refrlvis);
}
</script>
</head>
%START.OF.PAGE
<script type="text/javascript">
function SetAppointDefaults(refletter) {
  if (refletter == 1) {  // New Appointment from Refferal Letters
    document.AddForm.defclnty.value="%OUTWEB02.05.327.1";
    document.AddForm.defclnid.value="%OUTWEB02.05.304.1";
    document.AddForm.outbb013.value="%OUTWEB02.05.307.3";
    document.AddForm.pmsvx052.value="%OUTWEB02.05.306";
    if (document.AddForm.refrldte != undefined) {
      document.AddForm.refrldte.value="%OUTWEB02.05.330"
    }
    document.AddForm.outbb001.value="%OUTWEB02.05.328.3";
//
    document.AddForm.claimc.value="%OUTWEB02.05.354.1";
    for (var i =0 ; i < document.AddForm.outbb002.length; i++) {
      if (document.AddForm.claimc.value==
          document.AddForm.outbb002.options[i].value.substr(0,3)){
            document.AddForm.outbb002.selectedIndex=i;
      }
    }
  } else if (refletter == 2) {
    document.AddForm.defclnty.value="%OUTWEB02.05.353.067.1";
    document.AddForm.defclnid.value="%OUTWEB02.05.353.088.1";
    document.AddForm.defvisty.value="%OUTWEB02.05.353.095";
    document.AddForm.defclaim.value="%OUTWEB02.05.353.035.1";
    document.AddForm.deftovrd.value="1";
    if (document.AddForm.refrldte != undefined) {
      document.AddForm.refrldte.value="%OUTWEB02.05.353.039";
    }
//  
    for (var i=0; i < document.AddForm.outbb002.length; i++) {
     if (document.AddForm.outbb002.options[i].value.substr(0,3)==
         document.AddForm.defclaim.value.substr(0,3)){
         document.AddForm.outbb002.selectedIndex=i;
     }
    }
//
    document.AddForm.outbb013.value="%OUTWEB02.05.353.027.3";
    document.AddForm.outbb001.value="%OUTWEB02.05.353.034.3";
    document.AddForm.pmsvx052.value="%OUTWEB02.05.353.049";
//
  } else {
    checkRefLetter(document.AddForm.urnumber.value);
  }
  document.AddForm.pmsvx052.value=trim(document.AddForm.pmsvx052.value);
}
function valClaimCode(refletter) {
  if (refletter == 1) {  
    return;
  }
  validateCode(41,AddForm.urnumber,AddForm.claimc);
  for (var i =0 ; i < document.AddForm.outbb002.length; i++) {
    if (document.AddForm.claimc.value==
        trim(document.AddForm.outbb002.options[i].value.substr(0,3))){
          document.AddForm.outbb002.selectedIndex=i;
    }
  }
}
function OpenSearchPage() {
  if(AddForm.otcncsum.value=="1") {
    if(!isWhitespace(AddForm.defclnty.value)) {
      AddForm.outbb016.value=AddForm.defclnty.value
    } else {
      AddForm.outbb016.value=trim(AddForm.outbb016.value)
    }
    AddForm.srchclid.value=AddForm.defclnid.value;
    window.ReturnFunction="" ;
    ClinicSearchFrame(AddForm.newslotk,AddForm.clindesc,AddForm.clindate,
                      AddForm.outbb016,AddForm.srchclid,AddForm.defvisty,
                      AddForm.deftovrd,AddForm.refrlvis)
  } else {            
    AppointmentSearchFrame(AddForm.newslotk,AddForm.clindesc,AddForm.clindate,
                           AddForm.defclnty,AddForm.defclnid,AddForm.defvisty,
                           AddForm.deftovrd,AddForm.refrlvis);
  }                        
} 
</script>
<body onload="PageLoad(event);clrFields();valClaimCode(%OUTWEB02.05.214);
      SetAppointDefaults(%OUTWEB02.05.214);OpenSearchPage();">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon"
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Make New Appointment
</span>

<div id=PageBodySection style="overflow: auto;">

<form name=AddForm action=outweb02.pbl method=post
 onSubmit='return validateMandatory(this)'>
<input type=hidden name=reportno value="06">
<input type=hidden name=template value="004">
<input type=hidden name=urnumber value="%OUTWEB02.05.003">
<input type=hidden name=updatety value="5">
<input type=hidden name=nextpage value="6">
<input type=hidden name=redirect value="">
<input type=hidden name=defclnty value="%OUTWEB02.05.108">
<input type=hidden name=defclnid value="%OUTWEB02.05.103.0">
<input type=hidden name=defvisty value="%OUTWEB02.05.110.1">
<input type=hidden name=defclaim value="">
<input type=hidden name=dummy    value="">
<input type=hidden name=dummydat value="">
<input type=hidden name=outbb016 value="" >
<input type=hidden name=srchclid value="%OUTWEB02.05.103.0">
<input type=hidden name=bookflag value="%OUTWEB02.05.214">
<input type=hidden name=refrlvis value="%OUTWEB02.05.353.001">
<input type=hidden name=admissno value="%OUTWEB02.05.081">
<input type=hidden name=tmplredi value="">
<input type=hidden name=ptcnueoc value="%OUTWEB02.05.216">
<input type=hidden name=clinctyp value="%OUTWEB02.05.205.1">
<input type=hidden name=claimc>
<input type=hidden name=waitlkey value="%OUTWEB02.05.219">
<input type=hidden name=waitflag value="%OUTWEB02.05.220">
<input type=hidden name=otcncsum value="%OUTWEB02.05.222">
<input type=hidden name=datefrom>
<input type=hidden name=dateto>
<input type=hidden name=deftovrd value="">

<table cellspacing=0 cellpadding=1 border=0 width=92% align=center >
<tr><td class=DataLabel width=20%>Clinic</td>
    <td class=DataField>
    <input type=hidden name=newslotk value="DEFAULT">
    <input type=text size=25 name=clindesc class=Mandatory title="Clinic"
       readonly value="%OUTWEB02.05.103.1">
    <img src=../images/SearchIcon.gif class=Icon
     onclick="AppointSearch();">
    <img src=../images/LookupIcon.gif
     onclick="ClinicSearch();"></td>
    <td class=DataLabel>Date</td>
    <td class=DataField>
    <input type=text size=30 name=clindate class=Mandatory title="date"
     readonly value="%OUTWEB02.05.113 %OUTWEB02.05.104 %OUTWEB02.05.107">
    </td></tr>

<tr><td class=DataLabel>Visit Type</td>
    <td class=DataField colspan=3>
    <select name=outbb047 title="Visit Type" class="SelectBig Mandatory">
    <option> </option>
    %OUTWEB02.05.199
    </select>
    </td></tr>

<tr valign=top>
    <td class=DataLabel>Presenting Complaint</td>
    <td class=DataField colspan=3>
    <input type=text name=pmsvx052 size=50 maxlength=50 value="">
    </td></tr>

<tr valign=top>
    <td class=DataLabel>Diagnosis</td>
    <td class=DataField colspan=3>
    <input type=text size=15 name=outbb045 value=""
     onblur="validateCode(6,AddForm.outbb045,AddForm.outbb046);">
    <input type=text name=outbb046 size=65 maxlength=50
     readonly class=Readonly value="">
    <img src=../images/SearchIcon.gif class=Icon
     onclick="Icd10DisSearchFrame(AddForm.outbb045,AddForm.outbb046);">
    <img src=../images/LookupIcon.gif class=Icon
     onclick="CtypediagSearchFrame(AddForm.outbb045,AddForm.outbb046);">
    </td></tr>

<tr><td>&nbsp;</td>
    <td class=DataField colspan=3>
    <input type=text size=15 name=outbb055 value=""
     onblur="validateCode(6,AddForm.outbb055,AddForm.outbb056);">
    <input type=text name=outbb056 readonly class=Readonly 
                                   size=65 maxlength=50 value="">
    <img src=../images/SearchIcon.gif class=Icon
     onclick="Icd10DisSearchFrame(AddForm.outbb055,AddForm.outbb056);">
    <img src=../images/LookupIcon.gif class=Icon
     onclick="CtypediagSearchFrame(AddForm.outbb055,AddForm.outbb056);">
    </td></tr>

<tr><td>&nbsp;</td>
    <td class=DataField colspan=3>
    <input type=text size=15 name=outbb057 value=""
     onblur="validateCode(6,AddForm.outbb057,AddForm.outbb058);">
    <input type=text size=65 maxlength=50 name=outbb058 
                             readonly class=Readonly value="">
    <img src=../images/SearchIcon.gif class=Icon
     onclick="Icd10DisSearchFrame(AddForm.outbb057,AddForm.outbb058);">
    <img src=../images/LookupIcon.gif class=Icon
     onclick="CtypediagSearchFrame(AddForm.outbb057,AddForm.outbb058);">
    </td></tr>

<tr><td>&nbsp;</td>
    <td class=DataField colspan=3>
    <input type=text size=15 name=outbb059 value=""
     onblur="validateCode(6,AddForm.outbb059,AddForm.outbb060);">
    <input type=text size=65 maxlength=50 name=outbb060 
                                  readonly class=Readonly value="">
    <img src=../images/SearchIcon.gif class=Icon
     onclick="Icd10DisSearchFrame(AddForm.outbb059,AddForm.outbb060);">
    <img src=../images/LookupIcon.gif class=Icon
     onclick="CtypediagSearchFrame(AddForm.outbb059,AddForm.outbb060);">
    </td></tr>

<tr><td class=DataLabel>Priority</td>
    <td class=DataField><select name=outbb013 class=SelectBig>
	<option></option>
	%OUTWEB02.05.132.2
	</select>
    </td></tr>

<tr><td class=DataLabel>%STANDARD.01.017.CL</td>
    <td class=DataField><select name=outbb002 class="Mandatory SelectBig"
        title="%STANDARD.01.017.CL">
        <option></option>
        %OUTWEB02.05.197.2
        </select></td></tr>

<tr><td class=DataLabel>Source of Referral</td>
    <td class=DataField><select name=outbb001 class="Mandatory SelectBig"
        title="Source of Referral">
        <option></option>
        %OUTWEB02.05.120.2
        </select></td></tr>

<tr valign=top><td class=DataLabel>Comments</td>
    <td class=DataField colspan=3>
    <textarea name=outptcom wrap=hard cols=70 rows=3></textarea>
    </td></tr>

<tr><tr><td class=DataLabel>Referral Date</td>
    <td class=DataField>
      <input type=text name=refrldte class=ReadOnly readonly size=12></td>
    <td>&nbsp;</td>
    <td>&nbsp;</td></tr>

<tr><td colspan=4 align=center>
    <input type=button class="button" value="Ok" 
    onclick="checkSlot(AddForm.newslotk.value,
            AddForm.urnumber.value,SubmitFinal);">
    <input type=button class="button" Value="Cancel" onclick='DFrameClose()'>
    </td></tr>
</table>
</form>
</div>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=urnumber value="%OUTWEB02.05.003">
<input type=hidden name=admissno value="%OUTWEB02.05.081">
<input type=hidden name=MenuType value="%OUTWEB02.05.088">
<input type=hidden name=casekeys value="%OUTWEB02.05.166">
</form>

<script type="text/javascript">
 for (var i=0; i < document.AddForm.outbb047.length; i++) {
  if (document.AddForm.outbb047.options[i].value=="%OUTWEB02.03.310"){
      document.AddForm.outbb047.selectedIndex=i;
  }
 }
</script>

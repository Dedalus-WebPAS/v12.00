<meta name="TemplateVersion" content="V11.00.00">
<meta name="TemplateHome" content="pacific">
<meta name="HelpFileName" content="NoContextSet.html">
<script type="text/javascript" src="../js/OutExtraTemplates.js"></script>
<script type="text/javascript">
function SubmitFinal() {
  p=document.AddForm
  p.valddate.value=p.clindate.value.substr(4,12);
  validateSuspension(p.urnumber,p.valddate,p.datefrom,p.dateto);
  if(p.datefrom.value!='0'){
       ans=confirm("Warning : Patient has a Suspension record for period \n" +
             "\t" + p.datefrom.value  + " - " + p.dateto.value);
       if (ans!=true) {
          return; }
  } 
  setRedirect()
  if (validateMandatory(AddForm)) {
    AddForm.submit() }
}

//-----------------------------------------------------------------
// Function To check Referral Letters
//-----------------------------------------------------------------
function checkRefLetter(urnumber) {
  if (isWhitespace(urnumber)) return;;
  ReturnFunction="" ;
  for (var i=1; i < checkRefLetter.arguments.length; i++) {
   if (typeof(checkRefLetter.arguments[i]) == 'function') {
     ReturnFunction=checkRefLetter.arguments[i] } }
  var serverURL = "../cgi-bin/outweb02.pbl?reportno=9&updatety=6" +
                  "&urnumber="+urnumber.replace(/ /g,"+")
  var returnValue = RSExecute(serverURL);
  ReturnValue=returnValue.return_value.split("|");
  if (returnValue.status==0) {

    if (ReturnValue[0] == 1) {    // Unbooked referral exists
 
      // Construct warning message
      if (isWhitespace(ReturnValue[1])) 
        { ReturnValue[1] = "Unknown Date"; }
      if (isWhitespace(ReturnValue[2])) 
        { ReturnValue[2] = "Unknown"; }
      if (isWhitespace(ReturnValue[3])) 
        { ReturnValue[3] = "Unknown"; }
      var message = "Warning : Referral Letter Exists for " + ReturnValue[1] +
                    "; Clinic Type " + ReturnValue[2] + "; Clinic Id " +
                    ReturnValue[3] + "\nClick OK to continue " +
                    "without selecting the letter, Cancel to select letter.";

      ans=confirm(message)
      if (!ans) { 
//      UrNumber=document.AddForm.urnumber.value.replace(/ /g,"+");
//      DFrameStart();
//      document.getElementById('PopUpFrame').src="outweb01.pbl?reportno=4&template=006"+
//                                  "&urnumber=" + UrNumber + "&lstunbfl=1";
//      SearchFrameShow();
        PatientLinkTo("allweb02.pbl",2,22,0,0,0);
      }
    }
    if (typeof(ReturnFunction) == 'function') { ReturnFunction() } 
  }
}
function setRedirect() {
  strTemplate="" ;
  scrName="";
  checkInd=document.AddForm.outbb002.value.substr(3,5)
  if(checkInd.search(/W/g) >= 0) {
    strTemplate="005"; 
    scrName="WC";}
  if(checkInd.search(/M/g) >= 0) {
    strTemplate="042";
    scrName="TAC";}
  if(checkInd.search(/V/g) >= 0) {
    strTemplate="043"; 
    scrName="VA";}

  checkInd=document.AddForm.outbb002.value.substr(8,1)
  if(checkInd.search(/C/g) >= 0) {
    strTemplate="021"; 
    scrName="CT";}

  if (strTemplate=="") {
    if ((document.AddForm.ptcnueoc.value==1) &&
        (document.AddForm.outbb002.value.substr(5,1)=='A')) {
      scrName="ACC";
      document.AddForm.redirect.value="eocweb01.pbl?reportno=1&template=006"
        + "&urnumber=" + PatientLinks.urnumber.value.replace(/ /g,"+")
        + "&returncd=OUT";
    }
    else {
      document.AddForm.redirect.value="outweb02.pbl?reportno=3&template=1" +
                                      "&shwprint=1" 
    }
  }
  else {
    document.AddForm.redirect.value="patweb89.pbl?reportno=01" +
               "&template=" + strTemplate +
               "&systflag=2" +
               "&urnumber=" + PatientLinks.urnumber.value.replace(/ /g,"+")  
  }
  chkExtraTempl(document.AddForm,"B",document.AddForm.newslotk.value,
                PatientLinks.urnumber.value.replace(/ /g,"+"),scrName)
}

function ClinicSearch() {
  cancelSlot(AddForm.newslotk.value,ClinicSearchLink)
}
function ClinicSearchLink() {
  ClinicSearchFrame(AddForm.newslotk,AddForm.clindesc,AddForm.clindate)
}
function AppointSearch() {
  cancelSlot(AddForm.newslotk.value,AppointSearchLink)
}
function AppointSearchLink() {
  AppointmentSearchFrame(AddForm.newslotk,AddForm.clindesc,AddForm.clindate);
}

function fnCancel() {
 if (isWhitespace(AddForm.newslotk.value)) {
   history.back(); }
 else {
   cancelSlot(AddForm.newslotk.value,SessionLink)
  }
}
function SessionLink() {
   SESSKEYS=AddForm.newslotk.value.substr(0,28).replace(/ /g,"+")
   location.href="outweb02.pbl?reportno=2&template=4&sesskeys="+SESSKEYS
}
function valClaimCode() {
  validateCode(41,AddForm.urnumber,AddForm.claimc);
  for (var i =0 ; i < document.AddForm.outbb002.length; i++) {
//    alert(AddForm.outbb002.options[i].value.substr(0,3));
    if (document.AddForm.claimc.value==
        trim(document.AddForm.outbb002.options[i].value.substr(0,3))){
          document.AddForm.outbb002.selectedIndex=i;
    }
  }
}
</script>
</head>
%START.OF.PAGE
<div id=HeadingSection>
<body onload='PageLoad(event);valClaimCode();checkRefLetter("%OUTWEB02.05.003")'> 
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%OUTWEB02.05.003";
PatientVIS="%OUTWEB02.05.081";
PatientNAM="%OUTWEB02.05.002";
PatientSTA="%OUTWEB02.05.086.078";
PatientALT="%OUTWEB02.05.084";
PatientSEX="%OUTWEB02.05.019";
PatientDOB="%OUTWEB02.05.020";
PatientAGE="%OUTWEB02.05.021";
PatientLOC="%OUTWEB02.05.083";
DoctorCOD="%OUTWEB02.05.082.003";
PatientPRI="%OUTWEB02.05.086.066.1";
PatientUNT="%OUTWEB02.05.066.0";
DoctorNAM="%OUTWEB02.05.082.002";
PatientAID="%OUTWEB02.05.086.090";
PatientIND="%OUTWEB02.05.086.091";
PatientCUR="%OUTWEB02.05.086.092";
PatientCLC="%OUTWEB02.05.086.093.1";
PatientCLH="%STANDARD.01.017.CL";
PatientHFT="%OUTWEB02.05.086.094";
PatientCDM="%OUTWEB02.05.086.095";
PatientVDH="%OUTWEB02.05.086.099.015";
InsertPatientHeader()
</script>
<div id=PatientMenu></div>
<table cellspacing=0 cellpadding=1 border=0 width=100% >
<tr><td class=HeadingCell align=center width=100% >
    Make New Appointment</td></tr>
</table>
<table cellspacing=0 cellpadding=0 border=0 width=90% align=center>
<form name=AddForm action=outweb02.pbl method=post>
<input type=hidden name=reportno value="06">
<input type=hidden name=template value="004">
<input type=hidden name=nextpage value="1">
<input type=hidden name=redirect value="">
<input type=hidden name=urnumber value="%OUTWEB02.05.003">
<input type=hidden name=admissno value="%OUTWEB02.05.081">
<input type=hidden name=updatety value="5">
<input type=hidden name=bookflag value="">
<input type=hidden name=refrlvis value="">
<input type=hidden name=systfalg value="2">
<input type=hidden name=ptcnueoc value="%OUTWEB02.05.216">
<input type=hidden name=clinctyp value="%OUTWEB02.05.205.1">
<input type=hidden name=dateclin value="%OUTWEB02.05.104">
<input type="hidden" name="claimc">
<input type=hidden name=valddate>
<input type=hidden name=datefrom>
<input type=hidden name=dateto>
<tr><td class=DataLabel width=20%>Clinic</td>
    <td class=DataField colspan=3>
    <input type=hidden name=newslotk value="%OUTWEB02.05.166" >
    <input type=text size=30 name=clindesc Title="Clinic" 
     value="%OUTWEB02.05.192" readonly class=Mandatory>
     <img src="../images/SearchIcon.gif" class=Icon onClick="AppointSearch();">
     <img src="../images/LookupIcon.gif" class=Icon onClick="ClinicSearch();">
    </td></tr>
<tr><td class=DataLabel>Date</td>
   <td class=DataField colspan=3>
   <input type=text size=35 name=clindate readonly  class=Mandatory title="date"
     value="%OUTWEB02.05.113 %OUTWEB02.05.104 %OUTWEB02.05.116">
    </td></tr>

<tr><td class=DataLabel>Visit Type</td>
    <td class=DataField colspan=3>
    <select name=outbb047 title="Visit Type" class="Mandatory SelectBig">
    <option></option>
    %OUTWEB02.05.199
    </select>
    </td></tr>

<tr valign=top>
    <td class=DataLabel>Presenting Complaint</td>                              
    <td class=DataField colspan=3>
    <input type=text name=pmsvx052 size=50 maxlength=50 
      value="">
</td></tr>     

<tr valign=top>
    <td class=DataLabel>Diagnosis</td>

    <td class=DataField colspan=3>
    <input type=text size=12 name=outbb045 value=""
     onblur="validateCode(6,AddForm.outbb045,AddForm.outbb046);">
    <input type=text name=outbb046 size=70 maxlength=50
     readonly class=Readonly value="">
    <img src=../images/SearchIcon.gif class=Icon
     onclick="Icd10DisSearchFrame(AddForm.outbb045,AddForm.outbb046);">
    <img src=../images/LookupIcon.gif class=Icon
     onclick="CtypediagSearchFrame(AddForm.outbb045,AddForm.outbb046);">
    </td></tr>

<tr>
<td>&nbsp;</td>
    <td class=DataField colspan=3>
    <input type=text size=12 name=outbb055 value=""
     onblur="validateCode(6,AddForm.outbb055,AddForm.outbb056);">
    <input type=text name=outbb056 size=70 maxlength=50 
     readonly class=Readonly value="">
    <img src=../images/SearchIcon.gif class=Icon
     onclick="Icd10DisSearchFrame(AddForm.outbb055,AddForm.outbb056);">
    <img src=../images/LookupIcon.gif class=Icon
     onclick="CtypediagSearchFrame(AddForm.outbb055,AddForm.outbb056);">
    </td></tr>
<tr>
<td>&nbsp;</td>
<td class=DataField colspan=3>
     <input type=text size=12 name=outbb057 value=""
     onblur="validateCode(6,AddForm.outbb057,AddForm.outbb058);">
     <input type=text size=70 maxlength=50 name=outbb058 
      readonly class=Readonly value="">
    <img src=../images/SearchIcon.gif class=Icon
     onclick="Icd10DisSearchFrame(AddForm.outbb057,AddForm.outbb058);">
    <img src=../images/LookupIcon.gif class=Icon
     onclick="CtypediagSearchFrame(AddForm.outbb057,AddForm.outbb058);">
    </td></tr>
<tr>
<td>&nbsp;</td>
<td class=DataField colspan=3>
    <input type=text size=12 name=outbb059 value=""
    onblur="validateCode(6,AddForm.outbb059,AddForm.outbb060);">
    <input type=text size=70 maxlength=50 name=outbb060 
     readonly class=Readonly value="">
    <img src=../images/SearchIcon.gif class=Icon
     onclick="Icd10DisSearchFrame(AddForm.outbb059,AddForm.outbb060);">
    <img src=../images/LookupIcon.gif class=Icon
     onclick="CtypediagSearchFrame(AddForm.outbb059,AddForm.outbb060);">
    </td></tr>

<!--
<tr><td class=DataLabel>Transport</td>
    <td class=DataField><select name=outbb023 class=SelectBig>
        <option></option>
        %OUTWEB02.05.142.2
        </select></td>
-->
<tr><td class=DataLabel>Priority</td>
    <td class=DataField><select name=outbb013 class=SelectBig>
	<option></option>
	%OUTWEB02.05.132.2
	</select>
    </td></tr>
<tr><td class=DataLabel>%STANDARD.01.017.CL</td>
    <td class=DataField><select name=outbb002 class="Mandatory SelectBig"
        title="%STANDARD.01.017.CL">
        <option></option>
        %OUTWEB02.05.197.2
        </select></td>
<!--
    <td class=DataLabel>Unit</td>
    <td class=DataField><select name=outbb022 class="SelectBig"
                         title="Unit">
	<option></option>
	 %OUTWEB02.05.141.2
	</select></td></tr>
-->

<tr><td class=DataLabel>Source of Referral</td>
    <td class=DataField><select name=outbb001 class="Mandatory SelectBig"
        title="Source of Referral">
        <option></option>
        %OUTWEB02.05.120.2
        </select></td>
<!--
    <td class=DataLabel>Reports Required</td>
    <td class=DataField><select name=outbb017 class=SelectBig>
        <option></option>
        %OUTWEB02.05.136.2</td></tr>
-->
</tr>

<!--
<tr><td class=DataLabel>Special Arrangements</td>
    <td class=DataField >
    <select name=outbb054 class=SelectBig>
    <option></option>
    %OUTWEB02.05.178.2
    </select></td>
-->
<!--
    <td class=DataLabel>Referring GP</td>
    <td class=DataField> 
    <input type=hidden name=outbb029>
    <input type=hidden name=dummy1 value="6">
    <input type=text name=genpname readonly Class=Readonly> 
    <img src="../images/SearchIcon.gif" align=absmiddle
     onclick="HCPSearchFrame(outbb029,genpname,dummy1.value)">
    <img src="../images/erase.gif" align=absmiddle
     onClick="clrFields(outbb029,genpname);">
    </td></tr>
-->

<!--
<tr><td class=DataLabel>Preferred Contact Method</td>
    <td class=DataField >
      <select name=outbb040>
       <option value="   "></option>
        %OUTWEB02.05.159.2
       </select></td>
-->
<!--
    <td class=DataLabel>Notify GP</td>
    <td><input type=checkbox value=1 name=outbb036></td></tr>
-->

<tr><tr><td class=DataLabel>Referral Date</td>
    <td class=DataField>
      <input type=text name=refrldte class=ReadOnly readonly size=12></td>
    <td>&nbsp;</td>
    <td>&nbsp;</td></tr>

<tr valign=top><td class=DataLabel>Comments</td>
    <td class=DataField colspan=3>
    <textarea name=outptcom wrap=hard cols=70 rows=3></textarea>
    </td></tr>

<tr><td colspan=4 align=center>
    <input type=button class="button" value="Ok" 
    onclick="checkSlot(AddForm.newslotk.value,
            AddForm.urnumber.value,SubmitFinal);">
    <input type=button class="button" Value="Cancel" onClick='fnCancel()'>
    </td></tr>
</table>
</form>
<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=urnumber value="%OUTWEB02.05.003">
<input type=hidden name=admissno value="%OUTWEB02.05.081">
<input type=hidden name=MenuType value="%OUTWEB02.05.088">
<input type=hidden name=casekeys value="%OUTWEB02.05.166">
</form>

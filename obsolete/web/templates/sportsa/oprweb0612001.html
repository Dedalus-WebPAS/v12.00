<meta name="TemplateVersion" content="V11.02.00">
<meta name="TemplateHome" content="sportsa">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/oprweb06.js"> </script>
<script type="text/javascript">
function validateNurse(code,name) {
  validateCode('17',code,name,document.UpdateForm.gnm);
  SetNurseName(name);
}
function SetNurseName(name) {
  name.value=UpdateForm.gnm.value.replace(/\s*$/g,"") + " " +
             name.value.replace(/\s*$/g,"")
}
function StaffChecked() {
  if(document.UpdateForm.d_opsrg072.checked==true) {
    document.UpdateForm.opsrg072.value="1";
  } else {
    document.UpdateForm.opsrg072.value="0";
  }
}
function chkTime(field){
  if(isWhitespace(field.value))
    return;
  endTime=UpdateForm.opsrg006.value.replace(/:/g,"");
  if(isWhitespace(endTime)){
     alert("Surgery End Time must be entered first");
     field.value=""
     return;
  }
  OperDate=document.UpdateForm.casekeys.value.substring(0,8);
  if(document.UpdateForm.currdate.value > OperDate) {
    return;
  }
  if(field.value.replace(/:/g,"")<=endTime){
    if(!confirm(""+field.title+" must be after Surgery End Time." +
                "\n Do you want to override")) {
      field.value="";
    }
  }
}

function ChgSurgeon() {
  UpdateForm.target="PopUpFrame"
  if (UpdateDayProc()) {
    setTimeout('showChgSur()',100);
  }
  UpdateForm.target="";
}

function showChgSur() {
  caseKeys=UpdateForm.casekeys.value.replace(/ /g,"+");
  teamNumb=UpdateForm.teamnumb.value;
  linkurl="oprweb06.pbl?reportno=12&template=005&casekeys="+caseKeys+
          "&teamnumb="+teamNumb;
  Left=(document.body.clientWidth-750)/2
  DFrameLink(linkurl,100,Left,750,350)
}

// Change Theatre
function ChgOpr() {
  UpdateForm.target="PopUpFrame"
  if (UpdateDayProc()) {
    setTimeout('showChgOpr()',100);
  }
  UpdateForm.target="";
}
// Change Session
function ChgSession() {
  if(trim(document.TransferForm.newsessi.value)==""){
    alert("No Alternate Session Available")
    return;
  }
  document.TransferForm.redirect.value="oprweb06.pbl?reportno=12&template=1"+
        "&uniqueky="+document.TransferForm.uniqueky.value.replace(/ /g,"+");

//  if (document.TransferForm.bkrec005.value.length=="5") {
//    document.TransferForm.bkrec005.value =
//    document.TransferForm.bkrec005.value + ":00";
//  }
//  alert(document.TransferForm.bkrec005.value);

  document.TransferForm.submit();
}

function showChgOpr() {
  linkurl="oprweb01.pbl?reportno=4&template=014&casekeys="
           +UpdateForm.casekeys.value; 
  Left=(document.body.clientWidth-350)/2
  DFrameLink(linkurl,100,Left,350,180)
}

function AddMBSItem() {
 if(document.UpdateForm.opsrg005.value=="") {
   alert("Surgery Start Time must be entered first.");
   return;
 }
 if(UpdateForm.opcncomb.value=="1") {
    caseKeys=UpdateForm.casekeys.value.replace(/ /g,"+");
    teamNumb=UpdateForm.teamnumb.value;
    UpdateForm.redirect.value="oprweb06.pbl?reportno=03&template=004&casekeys="+
                             caseKeys+"&teamnumb="+teamNumb
    UpdateDayProc();
  } else {
    UpdateForm.target="PopUpFrame"
    if (UpdateDayProc()) {
        setTimeout('showMBS()',100);
    }
    UpdateForm.target="";
  }
}

function BillMBSItems() {
  document.UpdateForm.updatety.value="B";

  if (UpdateForm.ovrnight.checked == true)
    UpdateForm.opsrg071.value = "1";

  formSubmit();
}

function showMBS() {
  caseKeys=UpdateForm.casekeys.value.replace(/ /g,"+");
  teamNumb=UpdateForm.teamnumb.value;
  Left=(document.body.clientWidth-600)/2
  DFrameLink("oprweb06.pbl?reportno=02&template=002&casekeys="+caseKeys +
             "&teamnumb="+teamNumb,100,Left,600,350);
}
// Update Day Procedure Details
function UpdateDayProc() {

   if (!checkVisitDatesTimes()) {return;}

   document.UpdateForm.updatety.value="U";

   // Set Anaesthetic Prep Time,Anaesthetic Start Time  and time arrived
   // to the surgery start time 
   document.UpdateForm.opard002.value = document.UpdateForm.opsrg005.value;
   document.UpdateForm.opard041.value = document.UpdateForm.opsrg005.value;
   document.UpdateForm.opard042.value = document.UpdateForm.opsrg005.value;

   // Set Prep Time to be equal to Surgery Start Time. This is required
   // for calculation of Actual Operation Minutes.
   document.UpdateForm.opsrg003.value = document.UpdateForm.opsrg005.value;

   // Set Dressing Time to be equal to Surgery End Time. This is required
   // for calculation of Actual Operation Minutes.
   document.UpdateForm.opsrg004.value = document.UpdateForm.opsrg006.value;

   // Set Ready To Depart Time to be equal to the Exit Theatre Complex Time.
   //This is needed as opard085 is not displayed on the screen
   document.UpdateForm.opard085.value = document.UpdateForm.opard080.value;

   if (UpdateForm.ovrnight.checked == true)
     UpdateForm.opsrg071.value = "1";

   return(formSubmit());

}

// Validate Surgery End Time
function chkSurgEnd() {
  if(!isWhitespace(UpdateForm.opsrg006.value)) {
    if(isWhitespace(UpdateForm.opsrg005.value)) {
      alert("Surgery Start Time must be entered first.");
      UpdateForm.opsrg006.value="";
      UpdateForm.opsrg005.focus(); 
      return;
    }
    valPrepDress();
  }
}

// Refresh Page
function RefreshPage() {
   document.UpdateForm.method="get"
   document.UpdateForm.updatety.value="";
   document.UpdateForm.submit();
}
// Link To Staff List
function goToStaff() {
  caseKey=UpdateForm.casekeys.value.replace(/ /g,"+")
  temp=document.UpdateForm.teamnumb.value;
  supr=document.UpdateForm.suprlevl.value;
  UpdateForm.redirect.value="oprweb06.pbl?reportno=12&template=2&casekeys="+
                             caseKey+"&teamnumb="+temp+"&suprlevl="+supr;
  UpdateDayProc();
}
function goToOther() {
  caseKey=UpdateForm.casekeys.value.replace(/ /g,"+")
  temp=document.UpdateForm.teamnumb.value;
  supr=document.UpdateForm.suprlevl.value;
  UpdateForm.redirect.value="oprweb06.pbl?reportno=8&template=1&casekeys="+
                             caseKey+"&teamnumb="+temp+"&suprlevl="+supr;
  UpdateDayProc();
}

// Form Submit
function formSubmit() {
   if(validateMandatory(UpdateForm)) {
      casekey=UpdateForm.casekeys.value.substr(0,23);
      casekey=casekey.replace(/ /g,"+");
      uniqkey=UpdateForm.uniqueky.value
      uniqkey=uniqkey.replace(/ /g,"+");
      if (isWhitespace(UpdateForm.redirect.value)) {
        UpdateForm.redirect.value="oprweb06.pbl?reportno=12&template=001"+
                                  "&uniqueky="+uniqkey+"&teamnumb="; 
      }
      document.UpdateForm.submit();
      return true;
    }
    else
      return false;
}
// Set Team no.
function set(){
 PatientLinks.teamnumb.value=UpdateForm.teamnumb.value;
 if(isWhitespace(document.UpdateForm.opsrg005.value)) {
   document.UpdateForm.opsrg005.value=document.UpdateForm.currtime.value
 }
}

// Procedure Description to be made Mandatory
function ProcMan() {
  if(!isWhitespace(UpdateForm.opsrg006.value))  
    UpdateForm.opdea014.className="Mandatory";
  else
    UpdateForm.opdea014.className="";
}

// Validate Prep Start/Surgery Start and Dressing/Surgery End Times
function valPrepDress() {
  var prepTime = trim(document.UpdateForm.opsrg005.value.replace(/:/g,""));
  var dressTime = trim(document.UpdateForm.opsrg006.value.replace(/:/g,""));
  if (isWhitespace(dressTime) || isWhitespace(prepTime))
    return;

  if ((dressTime < prepTime) && (UpdateForm.ovrnight.checked != true)) {
    if(confirm("Is Surgery End the day after Surgery Start time?"))
      UpdateForm.ovrnight.checked=true;
    else
      UpdateForm.opsrg006.focus();
      return;
  }

  if ((dressTime >= prepTime) && (UpdateForm.ovrnight.checked == true)) {
    if(!confirm("Warning: The Past Midnight Indicator is set - Time difference " +
       "between\nSurgery Start time and Surgery End time is greater than " +
       "24 hours!")) {
      UpdateForm.ovrnight.focus();
      return;
    }
  }
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);UpdateForm.opsrg005.focus();set();ProcMan();
              LoadDefTeam();">
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%OPRWEB06.12.003";
PatientVIS="%OPRWEB06.12.081";
PatientNAM="%OPRWEB06.12.002";
PatientSTA="%OPRWEB06.12.086.078";
PatientALT="%OPRWEB06.12.084";
PatientSEX="%OPRWEB06.12.019";
PatientDOB="%OPRWEB06.12.020";
PatientAGE="%OPRWEB06.12.021";
PatientLOC="%OPRWEB06.12.083";
PatientPRI="%OPRWEB06.12.086.066.1";
PatientUNT="%OPRWEB06.12.066.0";
DoctorCOD="%OPRWEB06.12.082.003";
DoctorNAM="%OPRWEB06.12.082.002";
PatientAID="%OPRWEB06.12.086.090";
PatientIND="%OPRWEB06.12.086.091";
PatientCUR="%OPRWEB06.12.086.092";
PatientCLC="%OPRWEB06.12.086.093.1";
PatientCLH="%STANDARD.01.017.CL";
PatientHFT="%OPRWEB06.12.086.094";
PatientCDM="%OPRWEB06.12.086.095";
PatientVDH="%OPRWEB06.12.086.099.015";
InsertPatientHeader()
</script>
<div id="PatientMenu"></div>

<div id=PageBodySection>
<form name=UpdateForm method=post action="oprweb06.pbl" style="margin:0">
<input type=hidden name=reportno value=12>
<input type=hidden name=template value=1>
<input type=hidden name=updatety value="">
<input type=hidden name=urnumber value='%OPRWEB06.12.003'>
<input type=hidden name=casekeys value="%OPRWEB06.12.101">
<input type=hidden name=uniqueky value='%OPRWEB06.12.110'>
<input type=hidden name=redirect value="">
<input type=hidden name=nextpage value=1>
<input type=hidden name=gnm>
<input type=hidden name=suprlevl value="%OPRWEB06.12.313">
<input type=hidden name=opdunqid value="">
<input type=hidden name=teamnumb value="%OPRWEB06.12.334">
<input type=hidden name=currdate value="%STANDARD.01.013">
<input type=hidden name=opard002>
<input type=hidden name=opard041>
<input type=hidden name=opard042>
<input type=hidden name=opsrg003>
<input type=hidden name=opsrg004>
<input type=hidden name=opard085>
<input type=hidden name=opsrg071 value=" ">
<input type=hidden name=opcncomb value="%STANDARD.01.025.113.003.0.1">
<input type=hidden name=currtime value="%STANDARD.01.016">
<input type=hidden name=opsrg072 value="">
<input type=hidden name=opsedtcm id=opsedtcm value="%OPRWEB06.12.483">
<input type=hidden name=opsework id=opsework value='%OPRWEB06.12.402'
 title="Session Date">
<input type=hidden name="admndate" id="admndate" value="%OPRWEB06.12.351"
 title="Admission Date">
<input type=hidden name="admntime" id="admntime" value="%OPRWEB06.12.352">
<input type=hidden name="discdate" id="discdate" value="%OPRWEB06.12.353"
 title="Discharge Date">
<input type=hidden name="disctime" id="disctime" value="%OPRWEB06.12.354">

<table border="0" cellpadding="0" cellspacing="0" width="100%" align=center>
<tr><td class=HeadingCell align=left>
    <img src=../images/ListIcon.gif class=Icon onclick='SessCaseList();'></td>
    <td align=center class=HeadingCell width=85%>Day Procedures</td>
    <td align=right class=HeadingCell><font color=red>
     %OPRWEB06.12.208</font></td></tr>
</table>

<table border="0" cellpadding="0" cellspacing="0" width="100%" align=center>
<tr><td class=DataLabel>Consultant</td>
    <td class=DataField>
    <a href='javascript:DoctorViewFrame("%OPRWEB06.12.404.003")'>
    %OPRWEB06.12.404.002 </a></td>
    <td class=DataLabel>Operating Surgeon</td>
    <td class=DataField>
    <a href='javascript:DoctorViewFrame("%OPRWEB06.12.311.003")'>
    %OPRWEB06.12.311.002 </a></td>
    <td class=DataField>
    <input type=button value="Change Surgeon" class=button
     onclick="ChgSurgeon();"></td></tr>

<tr><td class=DataLabel>Unit</td>
    <td class="DataField">
       <select name=opses012 title="Unit" class=SelectBig>
        <option></option>
         %OPRWEB06.12.413.2
        </select></td>
    <td class=DataLabel>Theatre</td>
    <td class=DataField>%OPRWEB06.12.302</td>
    <td class=DataField>
       <input type=button value="Change Theatre" class=button id="chgtheatre"
        onclick="tempDisable(this,10);ChgSession();"></td></tr>

<tr><td class=DataLabel>Date </td>
    <td class=DataField>%OPRWEB06.12.406 %OPRWEB06.12.402</td>
    <td class=DataLabel>Time </td>
    <td class=DataField>%OPRWEB06.12.403</td></tr>
</table>

<hr>

<table border="0" cellpadding="0" cellspacing="0" width="100%" align=center>
<tr><td class=DataLabel>Procedure&nbsp;</td>
    <td> <input type=text size=116 name=opdea014 maxlength=55
          title="Procedure Description" value="%OPRWEB06.12.305"></td></tr>
<tr><td class=DataLabel>&nbsp;&nbsp;</td>
    <td> <input type=text size=116 name=opdea015 maxlength=55
     title="Procedure Description" value="%OPRWEB06.12.343"></td></tr> 
<tr><td class=DataLabel>&nbsp;&nbsp;</td>
    <td> <input type=text size=116 name=opdea016 maxlength=55
         title="Procedure Description" value="%OPRWEB06.12.344">
    </td></tr>
</table>

<br>

<table border="0" cellpadding="0" cellspacing="0" width="100%" align=center>
<tr><td class=DataLabel>Surgery Start</td>
    <td class=DataField>
      <input type=text name=opsrg005 id=opsrg005 size=8 maxlength=8
       title="Surgery Start Time" value="%OPRWEB06.12.337"
       onblur="checkTime(this,this.title);">
      <img src="../images/DateTimeStamp.gif" class=Icon 
       onclick="SetCurrentDateTime(null,opsrg005);">
      <img src=../images/TimeLookup.gif border=0 class=Icon 
       onclick="TimeLookupFrame(opsrg005);"></td>
    <td class=DataLabel>Anaesthetic</td>
    <td class=DataField>
      <select name=opdea003 title="Anaesthetic">
        <option></option>
         %OPRWEB06.12.113.2
      </select></td>

    <td class=DataLabel>MBS Items</td>
    <td><input type=text size=15 class=Readonly readonly name=mbsitem
         tabindex=-1 value=%OPRWEB06.12.202>
        <input type=button name="mbsbill" value="BILL" disabled
         color=red tabindex=-1 onclick="BillMBSItems();"> 
        </td>
    <td><input class=button type=button name="mbsbutton" 
         value="MBS/Prosthesis" tabindex=-1 onclick="AddMBSItem();">
    </td></tr>

<tr><td class=DataLabel>Surgery End</td>
    <td class=DataField>
      <input type=text name=opsrg006 id=opsrg006 size=8 maxlength=8
       title="Surgery End Time" value="%OPRWEB06.12.338" 
       onblur="checkTime(this,this.title);chkSurgEnd();ProcMan()">
      <img src="../images/DateTimeStamp.gif" class=Icon 
       onclick="SetCurrentDateTime(null,opsrg006);">
      <img src=../images/TimeLookup.gif class=Icon 
       onclick="TimeLookupFrame(opsrg006);"></td>
    <td class=DataLabel>&nbsp;</td>
    <td class=DataField>&nbsp;</td>
    <td class=DataLabel>Staff Members Checked</td>
    <td class=DataField><input type=checkbox name=d_opsrg072 
        title="Staff Members Checked" value="1" onclick="StaffChecked();"></td>
    <td class=DataLabel><input class=button type=button value="Staff Members"
         tabindex=-1 onclick="goToStaff();"></td>
    <td class=DataLabel>&nbsp;</td>
    </tr>

<tr><td class=DataLabel>Exit Theatre Complex</td>
    <td class=DataField>
      <input type=text name=opard080 id=opard080 size=8 maxlength=8
       title="Exit Theatre Complex Time" value="%OPRWEB06.12.580"
       onblur="checkTime(this,this.title);chkTime(this);">
      <img src="../images/DateTimeStamp.gif" class=Icon
       onclick="SetCurrentDateTime(null,opard080);">
      <img src=../images/TimeLookup.gif class=Icon
       onclick="TimeLookupFrame(opard080);"></td>
    <td class=DataLabel>&nbsp;</td>
    <td class=DataField>&nbsp;</td>
    <td class=DataLabel>Past Midnight</td>
    <td><input type=checkbox name=ovrnight title="Past Midnight"
         value="1" onblur="valPrepDress();"></td>
    <td class=DataLabel>
         <input class=Bigbutton type=button value="Tourniquet/Other"
         tabindex=-1 onclick="goToOther();"></td></tr>

<tr><td class=DataLabel>&nbsp;</td>
    <td class=DataField>&nbsp;</td>
    <td class=DataLabel>&nbsp;</td>
    <td class=DataField>&nbsp;</td>
    <td class=DataLabel>Reason for Past Midnight</td>
    <td class=DataField>
      <select name=opard086 title="Reason for Past Midnight">
        <option></option>
         %OPRWEB06.12.586.2
      </select></td>
    <td class=DataLabel>&nbsp;</td></tr>
</table>

<table border="0" cellpadding="0" cellspacing="0" width="100%" align=center>
<tr valign=top><td class=DataLabel>Comments</td>
    <td class=DataField>
        <div id=CommentText></div> 
    </td></tr>

<tr><td colspan=2 align=center><br>
    <input type=button value=Update class=button id="opr06sub"
     onclick="tempDisable(this);CheckDefaultTeamCompleted();UpdateDayProc();">
    <input type=button value=Cancel class=button 
     onclick="RefreshPage();"> </td></tr>
</table>
</form>
</div>

<form  name=PatientLinks method=get>
<input type=hidden name=reportno value=12>
<input type=hidden name=template value=001>
<input type=hidden name=urnumber value='%OPRWEB06.12.003'>
<input type=hidden name=admissno value='%OPRWEB06.12.081'>
<input type=hidden name=MenuType value='%OPRWEB06.12.088'>
<input type=hidden name=casekeys value='%OPRWEB06.12.101'>
<input type=hidden name=sesskeys value='%OPRWEB06.12.102.oprweb01.03.003'>
<input type=hidden name=uniqueky value='%OPRWEB06.12.110'>
<input type=hidden name=teamnumb value='%OPRWEB06.12.334'>
</form>

<form name=TransferForm action=oprweb01.pbl method=get>
<input type=hidden name=reportno value=15>
<input type=hidden name=template value=001>
<input type=hidden name=urnumber value='%OPRWEB06.12.003'>
<input type=hidden name=admissno value='%OPRWEB06.12.081'>
<input type=hidden name=MenuType value='%OPRWEB06.12.088'>
<input type=hidden name=casekeys value="%OPRWEB06.12.101">
<input type=hidden name=uniqueky value='%OPRWEB06.12.110'>
<input type=hidden name=newsessi value="%OPRWEB06.12.221">
<input type=hidden name=patadmdt value="%OPRWEB06.12.226">
<input type=hidden name=tranreas value="">
<input type=hidden name=redirect value="">
<input type=hidden name=nextpage value="1">
<input type=hidden name=bkrec005 value="%OPRWEB06.12.227">
</form>

<span id=ThtrCom style="display:none">
  <textarea wrap=hard cols=70 rows=3 name=opcom008> 
%OPRWEB06.12.143.008
  </textarea>
</span>

<span id=BookCom style="display:none">
  <textarea wrap=hard cols=70 rows=3 name=opcom008> 
%OPRWEB06.12.143.009
  </textarea>
</span>

<script type="text/javascript">
if ("%OPRWEB06.12.671" == "Yes") {
  document.UpdateForm.ovrnight.checked=1;
}
var mbsCount = %OPRWEB06.12.201
if (mbsCount >= 1)
  document.UpdateForm.mbsbutton.className="RedButton";

var impCount = %OPRWEB06.12.203
if (impCount > 1)
  document.UpdateForm.impbutton.className="RedButton";

var expCount = %OPRWEB06.12.205
if (expCount > 1)
  document.UpdateForm.expbutton.className="RedButton";

// Default MBS Item from Booking
if (isWhitespace(document.UpdateForm.mbsitem.value))
  document.UpdateForm.mbsitem.value="%OPRWEB06.12.345";

// Set 'BILL' button for MBS Items
var mbsBilled = %OPRWEB06.12.212
if ((!isWhitespace(document.UpdateForm.mbsitem.value)) && mbsBilled !=1)
  document.UpdateForm.mbsbill.disabled=false;

// Default Comment from Booking
if (%OPRWEB06.12.211 == 0)                       // First display of this page?
  CommentText.innerHTML = BookCom.innerHTML;     // Yes, default from booking
else
  CommentText.innerHTML = ThtrCom.innerHTML;     // No, use Day Proc comments

// Staff Members Checked
if ("%OPRWEB06.12.672" == "Yes") {
  document.UpdateForm.d_opsrg072.checked=true;
} 
StaffChecked();
</script>


.************************************************************************
.*  Procedure: DGCLICAT  -  Send New Alert details                      *
.*                                                                      *
.*  Author   : Steve Armstrong  (24/02/1998)                            *
.*                                                                      *
.*  Requires : Valid read on patalrtf                                   *
.*             FORM1    -  (1=Add, 2=Delete)                            *
.*                                                                      *
.*  Mods     :                                                          *
.*            15/11/2002 J.Tan                                          *
.*            Modified field names                                      *
.*            02/10/2001  Davin                                         *
.*            Mods to use message holding file                          *
.*                                                                      *
.************************************************************************
.
          DEFPROC   DGCLICAT
.
          INC       HL7BMTFD/INC
.
DGCLI000  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,EIGHTY8;*53,PTCNDGAL
.
.         Check if we are broadcasting alert messages
.
          COMPARE   ONE,PTCNDGAL
          GOTO      DGCLI999 IF NOT EQUAL
.
.         Open the broadcast message holding table file
.
          OPEN      HL7BMTA1,"hl7bmtaf"
.
.         Write to file
.
          MOVE     "CAT",HLBMTYPE
          MOVE     PURNO,HLBMURNO
          MOVE     SP30,HLBMVISN
          PACK     HLBMTKEY,SP30,SP30
.
          PACK     HLBMDATE,CCC,CYY,CMM,CDD
          REP      " 0",HLBMDATE
          PACK     HLBMSPAR,SP30,SP30,SP30
.
DGCLI100  CLOCK    TIME,KEY8
          REP      ": ",KEY8
          SQUEEZE  KEY8
          MOVE     KEY8,HLBMTIME
          PACK     KEY14,HLBMDATE,HLBMTIME,SP30
          CALL     RAHLBMT1
          COMPARE  ZERO,OVRCD             * Must be a Unique Record
          GOTO     DGCLI100 IF EQUAL      * So get Time Again
.
          CALL     WRHLBMT1
          CLOSE    HL7BMTA1
.
DGCLI999  GOTO      DGCLIEND                        * end procedure
.
.         IO's go in here
.
          INC       HL7BMTIO/INC
          INC       IBAOVRIO/INC
.
DGCLIEND  ENDPROC


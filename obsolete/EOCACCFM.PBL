.******************************************************************************
.*                                                                            *
.*      EOCACCFM.PBL - User Defined ACC Form Stationery                       *
.*      -----------                                                           *
.*                                                                            *
.*      This include assumes the IBATMDFD, IBATMHFD, files have been read with*
.*      a valid stationery code. This must be done each time this include is  *
.*      called.                                                               *
.*      Also the PATMA1FD, EOCACCFD must have been read                       *
.*                                                                            *
.*      This include was initially copied from PRTSHT6.                       *
.*                                                                            *
.*      Files to be opened : IBATMDFD.INC   IBATDET1                          *
.*                           IBATMHFD.INC   IBATMHA1                          *
.*                           IBAVARFD.INC   IBAVARD1 & IBAVARD2               *
.*                           PATCODFD.INC   PATCODE1                          *
.*                           PATDO1FD.INC   PATDO1A1                          *
.*                           PATICDFD.INC   PATICDD1                          *
.*                           PATMA1FD.INC   PATMA1A1                          *
.*                                                                            *
.*      Variables needed   : CURRROW     FORM     3                           *
.*                           DIM5        DIM      5                           *
.*                           FORM1       FORM     1                           *
.*                           FORM2       FORM     2                           *
.*                           FORM5       FORM     5                           *
.*                           FORM8       FORM     8                           *
.*                           FORM82      FORM     8.2                         *
.*                           PRNTSTRT    FORM     3                           *
.*                           VARIABLE    DIM      127                         *
.*                           MBSKEY20    DIM      20
.*                                                                            *
.*      Constants needed   : SP27        INIT     "              ...etc"      *
.*                           SP100       INIT     "              ...etc"      *
.*                           ZED10       INIT     "ZZZZZZZZZZ"                *
.*                           ZERO8       INIT     "0000    "                  *
.*                                                                            *
.*      Modifications      :                                                  *
.*        V9.05.01  24/03/2006  Peter Vela    CAR 61299                       *
.*                  Increased field no size from DIM3 to DIM5                 *
.*        V9.03.01  11/06/2004  Mike Laming   CAR 49016  July 2004 PRS/2      *
.*                  - Add Sex Description routine SEXDSC00 with Code "R" -    *
.*                  "Intersex" added                                          *
.*        V5.08.01  30/08/2000  Tonii                                         *
.*                  Mods to accept unknown and indeterminate as valid patient *
.*                  sex description                                           *
.*        V5.07.00  12/10/1998  Jim Stathopoulos                              *
.*                  507 Changes                                               *
.******************************************************************************
.*        V5.05.01  13/01/1998  Nick     SRF 643695                           *
.*                  Added PNKADD4,PKADD4,PADD4,PTMXECA4,PTMXNRA4              *
.*                                                                            *
.******************************************************************************
+
.*******************************************************************************
.*                                 LNUPACCF                                    *
.*                              Print Line Up ACC Form                     *
.*******************************************************************************
.
LNUPACCF  CALL      OPNPRINT                * Open spool file
          MOVE      ONE,CURRROW             * Initialize current row counter
LACC0000  COMPARE   CURRROW,IBDTROW         * Current row up to required row ?
          GOTO      LACC2000 IF EQUAL       * Yes - print data
          PRINT     *N;                     * Else print 1 extra line
          ADD       ONE,CURRROW             * Increment counter
          GOTO      LACC0000                * Check counter again
.
. ----- Read through the details file -----
.
LACC1000  CALL      RKIBDET1                * Read next detail record
          BRANCH    OVRCD,LACC9000          * No more records - pad out form
.
          MATCH     PTCNPACC,IBDTSCOD       * Same form ?
          GOTO      LACC9000 IF NOT EQUAL   * No - pad out rest of form
.
LACC1500  COMPARE   CURRROW,IBDTROW         * Are we at the required row ?
          GOTO      LACC2000 IF EQUAL       * Yes - print data
          PRINT     *N;                     * Else pad out to required row
          ADD       ONE,CURRROW             * One more row printed
          GOTO      LACC1500                * Check row count
.
. ----- Print actual data lines -----
.
LACC2000  BRANCH    IBDTINDC,LACC3000:      * Text field
                             LACC4000       * Data field
.
. ----- Print text field -----
.
LACC3000  RESET     IBDTTXFL,IBDTPLEN
          LENSET    IBDTTXFL
          RESET     IBDTTXFL
          PRINT     *IBDTCOL,*+,IBDTTXFL;   * Print data
          MOVE      IBDTROW,CURRROW         * Row printed is current row
          GOTO      LACC1000                * Read next record
.
. ----- Print data field -----
.
LACC4000  MOVE      IBDTTXFL,DIM5           * Data number 1st 3 chars of field
          MOVE      DIM5,FORM5              * Move to a FORM field for BRANCH
.
          PACK      VARIABLE,SP100,SP27     * Initialize variable
          BRANCH    FORM5,LACC4150,LACC4050,LACC4020,LACC4020,LACC5070:   *   5
                          LACC4020,LACC5070,LACC4020,LACC5070,LACC4020:   *  10
                          LACC5070,LACC4020,LACC5070,LACC4020,LACC5070:   *  15
                          LACC4080,LACC4160,LACC4080,LACC4160,LACC4080:   *  20
                          LACC4160,LACC4080,LACC4160,LACC4080,LACC4160:   *  25
                          LACC4080,LACC4160,LACC4110,LACC5080,LACC4110:   *  30
                          LACC5080,LACC4110,LACC5080,LACC5080,LACC5080:   *  35
                          LACC5080,LACC4050,LACC4050,LACC4050,LACC4050:   *  40
                          LACC4050,LACC4050,LACC5080,LACC5080,LACC5080:   *  45
                          LACC5080,LACC5080,LACC5080,LACC5080,LACC5080:   *  50
                          LACC5080,LACC5080,LACC4050,LACC4150,LACC4050:   *  55
                          LACC4150,LACC4050,LACC4150,LACC4050,LACC4150:   *  60
                          LACC4050,LACC4150,LACC4050,LACC4150,LACC4050:   *  65
                          LACC4150,LACC4050,LACC4150,LACC4050,LACC4150:   *  70
                          LACC5080,LACC5080,LACC5080,LACC5080,LACC5080:   *    
                          LACC5080,LACC5080,LACC5080,LACC5080,LACC5080:   *  80
                          LACC5080,LACC5080,LACC5080,LACC5080,LACC5080:   *    
                          LACC5080,LACC5080,LACC5080,LACC5080,LACC5080:   *  90
                          LACC5080,LACC5080,LACC5080,LACC5080,LACC5080:   *    
                          LACC5080,LACC5080,LACC5080,LACC5080,LACC5080:   * 100
                          LACC5080,LACC5080,LACC5080,LACC5080,LACC5080:   *    
                          LACC5080,LACC5080,LACC5080,LACC5080,LACC5080:   * 110
                          LACC5080,LACC5080,LACC5080,LACC5080,LACC5080:   *    
                          LACC5080,LACC5080,LACC5080,LACC5080,LACC5080:   * 120
                          LACC5080,LACC5080,LACC5080,LACC5080,LACC5080:   *    
                          LACC5080,LACC5080,LACC5080,LACC5080,LACC5080:   * 130
                          LACC5080,LACC5080,LACC5080,LACC5080,LACC5080:   *    
                          LACC5080,LACC5080,LACC5080,LACC5080,LACC5080:   * 140
                          LACC5080,LACC5080,LACC5080,LACC5080,LACC5080:   *    
                          LACC5080,LACC5090,LACC5090,LACC5090,LACC5090:   * 150
                          LACC5090
.
. ----- Date - MM/DD/YY -----
.
LACC4010  MOVE      "99/99/99",VARIABLE
          GOTO      LACC6000
.
. ----- Date - MM/DD/CCYY -----
.
LACC4020  MOVE      "99/99/9999",VARIABLE
          GOTO      LACC6000
.
. ----- Alpha Numeric - Dim 1 -----
.
LACC4030  MOVE      "X",VARIABLE
          GOTO      LACC6000
.
. ----- Alpha Numeric - Dim 2 -----
.
LACC4040  MOVE      "XX",VARIABLE
          GOTO      LACC6000
.
. ----- Alpha Numeric - Dim 3 -----
.
LACC4050  MOVE      "XXX",VARIABLE
          GOTO      LACC6000
.
. ----- Alpha Numeric - Dim 4 -----
.
LACC4060  MOVE      "XXXX",VARIABLE
          GOTO      LACC6000
.
. ----- Alpha Numeric - Dim 5 -----
.
LACC4070  MOVE      "XXXXX",VARIABLE
          GOTO      LACC6000
.
. ----- Alpha Numeric - Dim 6 -----
.
LACC4080  MOVE      "XXXXXX",VARIABLE
          GOTO      LACC6000
.
. ----- Alpha Numeric - Dim 7 -----
.
LACC4090  MOVE      "XXXXXXX",VARIABLE
          GOTO      LACC6000
.
. ----- Alpha Numeric - Dim 8 -----
.
LACC4100  MOVE      "XXXXXXXX",VARIABLE
          GOTO      LACC6000
.
. ----- Alpha Numeric - Dim 9 -----
.
LACC4110  MOVE      "XXXXXXXXX",VARIABLE
          GOTO      LACC6000
.
. ----- Alpha Numeric - Dim 10 -----
.
LACC4120  MOVE      "XXXXXXXXXX",VARIABLE
          GOTO      LACC6000
.
. ----- Alpha Numeric - Dim 12 -----
.
LACC4130  MOVE      "XXXXXXXXXXXX",VARIABLE
          GOTO      LACC6000
.
. ----- Alpha Numeric - Dim 15 -----
.
LACC4140  MOVE      "XXXXXXXXXXXXXXX",VARIABLE
          GOTO      LACC6000
.
. ----- Alpha Numeric - Dim 20 -----
.
LACC4150  MOVE      "XXXXXXXXXXXXXXXXXXXX",VARIABLE
          GOTO      LACC6000
.
. ----- Alpha Numeric - Dim 25 -----
.
LACC4160  MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXX",VARIABLE
          GOTO      LACC6000
.
. ----- Alpha Numeric - Dim 30 -----
.
LACC4170  MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",VARIABLE
          GOTO      LACC6000
.
. ----- Alpha Numeric - Dim 35 -----
.
LACC4180  MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",VARIABLE
          GOTO      LACC6000
.
. ----- Alpha Numeric - Dim 40 -----
.
LACC4190  MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",VARIABLE
          GOTO      LACC6000
.
. ----- Alpha Numeric - Dim 50 -----
.
LACC4200  CLEAR     VARIABLE
          APPEND    "XXXXXXXXXXXXXXXXXXXXXXXXX",VARIABLE
          APPEND    "XXXXXXXXXXXXXXXXXXXXXXXXX",VARIABLE
          RESET     VARIABLE
          GOTO      LACC6000
.
. ----- Alpha Numeric - Dim 65 -----
.
LACC4210  CLEAR     VARIABLE
          APPEND    "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",VARIABLE
          APPEND    "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",VARIABLE
          RESET     VARIABLE
          GOTO      LACC6000
.
. ----- Numeric - Form 1 -----
.
LACC4990  MOVE      "9",VARIABLE
          GOTO      LACC6000
.
. ----- Numeric - Form 2 -----
.
LACC5000  MOVE      "99",VARIABLE
          GOTO      LACC6000
.
. ----- Numeric - Form 3 -----
.
LACC5010  MOVE      "999",VARIABLE
          GOTO      LACC6000
.
. ----- Numeric - Form 4 -----
.
LACC5020  MOVE      "9999",VARIABLE
          GOTO      LACC6000
.
. ----- Numeric - Form 5 -----
.
LACC5025  MOVE      "99999",VARIABLE
          GOTO      LACC6000
.
. ----- Numeric - Form 6 -----
.
LACC5030  MOVE      "999999",VARIABLE
          GOTO      LACC6000
.
. ----- Numeric - Form 8 -----
.
LACC5040  MOVE      "99999999",VARIABLE
          GOTO      LACC6000
.
. ----- Numeric - Form 8.2 -----
.
LACC5050  MOVE      "99999999.99",VARIABLE
          GOTO      LACC6000
.
. ----- Numeric - Form 6.2 -----
.
LACC5060  MOVE      "999999.99",VARIABLE
          GOTO      LACC6000
.
. ----- Time Field -------------
.
LACC5070  MOVE      "99:99",VARIABLE
          GOTO      LACC6000
.
. ----- Alpha Numeric - Dim 60 -----
.
LACC5080  CLEAR     VARIABLE
          APPEND    "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",VARIABLE
          APPEND    "XXXXXXXXXXXXXXXXXXXXXXXXXXX",VARIABLE
          RESET     VARIABLE
          GOTO      LACC6000
.
. ------ Format Dim 127 for line up ------
.
LACC5090  CLEAR     VARIABLE
          APPEND    "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",VARIABLE
          APPEND    "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",VARIABLE
          APPEND    "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",VARIABLE
          APPEND    "XXXXXXX",VARIABLE
          RESET     VARIABLE
          GOTO      LACC6000
.
. ----- Format the variable -----
.
LACC6000  RESET     VARIABLE,IBDTPLEN
          LENSET    VARIABLE
          RESET     VARIABLE
          PRINT     *IBDTCOL,*+,VARIABLE;
          GOTO      LACC1000                * Read next record
.
. ----- End of ACCF, Print new lines until the end of page is reached -----
.
LACC9000  COMPARE   CURRROW,IBTHLENG        * Test page length
          GOTO      LACC9999 IF LESS
.
          PRINT     *N;
          ADD       ONE,CURRROW
          GOTO      LACC9000
.
LACC9999  CALL      CLSPRINT                * Close the spool file
          RETURN                            * Finished
+
.*******************************************************************************
.*                                  PRTACCF                                    *
.*                        Print the ACC Form                                   *
.*******************************************************************************
.
PRTACCFM  MOVE      ONE,CPAGENO             *     "      page count
          CALL      IBACLOCK                * get current date - century
.                                             required for transfer dates
          CALL      OPNPRINT                * Open spool file
PACC0000  MOVE      ONE,CURRROW             * Initialize current row counter
PACC0500  COMPARE   CURRROW,IBDTROW         * Current row up to required row ?
          GOTO      PACC2000 IF EQUAL       * Yes - print data
          PRINT     *N;                     * Else print 1 extra line
          ADD       ONE,CURRROW             * Increment counter
          GOTO      PACC0500                * Check counter again
.
. ----- Read through the details file -----
.
PACC1000  CALL      RKIBDET1                * Read next detail record
          BRANCH    OVRCD,PACC9000          * No more records - pad out form
.
          MATCH     PTCNPACC,IBDTSCOD       * Same form ?
          GOTO      PACC9000 IF NOT EQUAL   * No - pad out rest of form
.
PACC1500  COMPARE   CURRROW,IBDTROW         * Are we at the required row ?
          GOTO      PACC2000 IF EQUAL       * Yes - print data
          PRINT     *N;                     * Else pad out to required row
          ADD       ONE,CURRROW             * One more row printed
          GOTO      PACC1500                * Check row count
.
. ----- Print actual data lines -----
.
PACC2000  BRANCH    IBDTINDC,PACC3000:      * Text field
                             PACC4000       * Data field
.
. ----- Print text field -----
.
PACC3000  RESET     IBDTTXFL,IBDTPLEN
          LENSET    IBDTTXFL
          RESET     IBDTTXFL
          PRINT     *IBDTCOL,*+,IBDTTXFL;   * Print data
          MOVE      IBDTROW,CURRROW         * Row printed is current row
          GOTO      PACC1000                * Read next record
.
. ----- Print data field -----
.
PACC4000  MOVE      IBDTTXFL,DIM5           * Data number 1st 3 chars of field
          MOVE      DIM5,FORM5              * Move to a FORM field for BRANCH
.
          PACK      VARIABLE,SP100,SP27     * Initialize variable
          BRANCH    FORM5,PACC4010,PACC4020,PACC4030,PACC4040,PACC4050:   *   5
                          PACC4060,PACC4070,PACC4080,PACC4090,PACC4100:   *  10
                          PACC4110,PACC4120,PACC4130,PACC4140,PACC4150:   *  15
                          PACC4160,PACC4170,PACC4180,PACC4190,PACC4200:   *  20
                          PACC4210,PACC4220,PACC4230,PACC4240,PACC4250:   *  25
                          PACC4260,PACC4270,PACC4280,PACC4290,PACC4300:   *  30
                          PACC4310,PACC4320,PACC4330,PACC4340,PACC4350:   *  35
                          PACC4360,PACC4370,PACC4380,PACC4390,PACC4400:   *  40
                          PACC4410,PACC4420,PACC4430,PACC4440,PACC4450:   *  45
                          PACC4460,PACC4470,PACC4480,PACC4490,PACC4500:   *  50
                          PACC4510,PACC4520,PACC4530,PACC4540,PACC4550:   *  55
                          PACC4560,PACC4570,PACC4580,PACC4590,PACC4600:   *  60
                          PACC4610,PACC4620,PACC4630,PACC4640,PACC4650:   *  65
                          PACC4660,PACC4670,PACC4680,PACC4690,PACC4700:   *  70
                          PACC4710,PACC4720,PACC4730,PACC4740,PACC4750:   *  75
                          PACC4760,PACC4770,PACC4780,PACC4790,PACC4800:   *  80
                          PACC4810,PACC4820,PACC4830,PACC4840,PACC4850:   *  85
                          PACC4860,PACC4870,PACC4880,PACC4890,PACC4900:   *  90
                          PACC4910,PACC4920,PACC4930,PACC4940,PACC4950:   *  95
                          PACC4960,PACC4970,PACC4980,PACC4990,PACC5000:   * 100
                          PACC5010,PACC5020,PACC5030,PACC5040,PACC5050:   * 105
                          PACC5060,PACC5070,PACC5080,PACC5090,PACC5100:   * 110
                          PACC5110,PACC5120,PACC5130,PACC5140,PACC5150:   * 115
                          PACC5160,PACC5170,PACC5180,PACC5190,PACC5200:   * 120
                          PACC5210,PACC5220,PACC5230,PACC5240,PACC5250:   * 125
                          PACC5260,PACC5270,PACC5280,PACC5290,PACC5300:   * 130
                          PACC5310,PACC5320,PACC5330,PACC5331,PACC5332:   * 135
                          PACC5333,PACC5334,PACC5335,PACC5336,PACC5337:   * 140
                          PACC5338,PACC5339,PACC5340,PACC5341,PACC5342:   * 145
                          PACC5343,PACC5344,PACC5345,PACC5346,PACC5347:   * 150
                          PACC5348
.
. ----- ACC Number --------
.
PACC4010  MOVE      ECACACCN,VARIABLE
          GOTO      PACC6000
.
. ----- ACC Approval -----------------
.
PACC4020  MOVE      DNO,VARIABLE
          LOAD      VARIABLE,ECACACCA,DYES 
          GOTO      PACC6000
.
. ----- Date of Accident ---------
.
PACC4030  UNPACK    ECACDACC,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE                 * Format patient's birth date
          MOVE      CPCDATE,VARIABLE
          GOTO      PACC6000
.
. ----- Date Field 1 ----------------
.
PACC4040  UNPACK    ECACDAT1,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE                 * Format patient's birth date
          MOVE      CPCDATE,VARIABLE
          GOTO      PACC6000
.
. ----- Time Field 1 ------------------
.
PACC4050  MOVE      ECACTIM1,VARIABLE
          GOTO      PACC6000
.
. ----- Date Field 2 ------------------
.
PACC4060  UNPACK    ECACDAT2,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE                 * Format patient's birth date
          MOVE      CPCDATE,VARIABLE
          GOTO      PACC6000
.
. ----- Time Field 2 -----------------------
.
PACC4070  MOVE      ECACTIM2,VARIABLE
          GOTO      PACC6000
.
. ----- Date Field 3 -----------------------
.
PACC4080  UNPACK    ECACDAT3,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE                 * Format patient's birth date
          MOVE      CPCDATE,VARIABLE
          GOTO      PACC6000
.
. ----- Time Field 3 ------------------
.
PACC4090  MOVE      ECACTIM3,VARIABLE
          GOTO      PACC6000
.
. ----- Date Field 4 -------------
.
PACC4100  UNPACK    ECACDAT4,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE                 * Format patient's birth date
          MOVE      CPCDATE,VARIABLE
          GOTO      PACC6000
.
. ----- Time Field 4 ------------------
.
PACC4110  MOVE      ECACTIM4,VARIABLE
          GOTO      PACC6000
.
. ----- Date Field 5 -------------ber -----
.
PACC4120  UNPACK    ECACDAT5,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE                 * Format patient's birth date
          MOVE      CPCDATE,VARIABLE
          GOTO      PACC6000
.
. ----- Time Field 5 ------------------
.
PACC4130  MOVE      ECACTIM5,VARIABLE
          GOTO      PACC6000
.
. ----- Date Field 6 -------------
.
PACC4140  UNPACK    ECACDAT6,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE                 * Format patient's birth date
          MOVE      CPCDATE,VARIABLE
          GOTO      PACC6000
.
. ----- Time Field 6 ------------------
.
PACC4150  MOVE      ECACTIM6,VARIABLE
          GOTO      PACC6000
.
. ----- Doctor Field 1 ---------------
.
PACC4160  MOVE      ECACDOC1,VARIABLE
          GOTO      PACC6000
.
. ----- Doctor Field 1 Desc ----------
.
PACC4170  PACK      KEY6,ECACDOC1
          CALL      RDDOCT1               * Read the doctors file
          IF        OVRCD=1
            PACK      VARIABLE,SP20,SP20
            GOTO      PACC6000
          ENDIF
.
          MOVE      DSNAME,PACSNAME
          MOVE      DGNAME,PACGNAME
          MOVE      DTITL,PACTITLE
          MOVE      TWO,PACFRMT
          CALL      PACNAME               * Format doctors name
          MOVE      PACFNAME,VARIABLE
          GOTO      PACC6000
.
. ----- Doctor Field 2 -------------
.
PACC4180  MOVE      ECACDOC2,VARIABLE
          GOTO      PACC6000
.
. ----- Doctor Field 2 Desc ----------
.
PACC4190  PACK      KEY6,ECACDOC2
          CALL      RDDOCT1               * Read the doctors file
          IF        OVRCD=1
            PACK      VARIABLE,SP20,SP20
            GOTO      PACC6000
          ENDIF
.
          MOVE      DSNAME,PACSNAME
          MOVE      DGNAME,PACGNAME
          MOVE      DTITL,PACTITLE
          MOVE      TWO,PACFRMT
          CALL      PACNAME               * Format doctors name
          MOVE      PACFNAME,VARIABLE
          GOTO      PACC6000
.
.
. ----- Doctor Field 3 -------------
.
PACC4200  MOVE      ECACDOC3,VARIABLE
          GOTO      PACC6000
.
. ----- Doctor Field 3 Desc ----------
.
PACC4210  PACK      KEY6,ECACDOC3
          CALL      RDDOCT1               * Read the doctors file
          IF        OVRCD=1
            PACK      VARIABLE,SP20,SP20
            GOTO      PACC6000
          ENDIF
.
          MOVE      DSNAME,PACSNAME
          MOVE      DGNAME,PACGNAME
          MOVE      DTITL,PACTITLE
          MOVE      TWO,PACFRMT
          CALL      PACNAME               * Format doctors name
          MOVE      PACFNAME,VARIABLE
          GOTO      PACC6000
.
.
. ----- Doctor Field 4 -------------
.
PACC4220  MOVE      ECACDOC4,VARIABLE
          GOTO      PACC6000
.
. ----- Doctor Field 4 Desc ----------
.
PACC4230  PACK      KEY6,ECACDOC4
          CALL      RDDOCT1               * Read the doctors file
          IF        OVRCD=1
            PACK      VARIABLE,SP20,SP20
            GOTO      PACC6000
          ENDIF
.
          MOVE      DSNAME,PACSNAME
          MOVE      DGNAME,PACGNAME
          MOVE      DTITL,PACTITLE
          MOVE      TWO,PACFRMT
          CALL      PACNAME               * Format doctors name
          MOVE      PACFNAME,VARIABLE
          GOTO      PACC6000
.
.
. ----- Doctor Field 5 -------------
.
PACC4240  MOVE      ECACDOC5,VARIABLE
          GOTO      PACC6000
.
. ----- Doctor Field 5 Desc ----------
.
PACC4250  PACK      KEY6,ECACDOC5
          CALL      RDDOCT1               * Read the doctors file
          IF        OVRCD=1
            PACK      VARIABLE,SP20,SP20
            GOTO      PACC6000
          ENDIF
.
          MOVE      DSNAME,PACSNAME
          MOVE      DGNAME,PACGNAME
          MOVE      DTITL,PACTITLE
          MOVE      TWO,PACFRMT
          CALL      PACNAME               * Format doctors name
          MOVE      PACFNAME,VARIABLE
          GOTO      PACC6000
.
.
. ----- Doctor Field 6 -------------
.
PACC4260  MOVE      ECACDOC6,VARIABLE
          GOTO      PACC6000
.
. ----- Doctor Field 6 Desc ----------
.
PACC4270  PACK      KEY6,ECACDOC6
          CALL      RDDOCT1               * Read the doctors file
          IF        OVRCD=1
            PACK      VARIABLE,SP20,SP20
            GOTO      PACC6000
          ENDIF
.
          MOVE      DSNAME,PACSNAME
          MOVE      DGNAME,PACGNAME
          MOVE      DTITL,PACTITLE
          MOVE      TWO,PACFRMT
          CALL      PACNAME               * Format doctors name
          MOVE      PACFNAME,VARIABLE
          GOTO      PACC6000
.
. 28. Diagnosis Field 1     
.
PACC4280  PACK      VARIABLE,ECACDIA1,SP70,SP10 
          GOTO      PACC6000
.
. 29. Diagnosis Field 1 Description
.
PACC4290  MOVE      SP70,DDESC 
          MOVE      ECACDIA1,KEY9
          CALL      RD10T9D1
          IF        OVRCD=1
              CALL      RDPT10D1
          ENDIF
          PACK      VARIABLE,DDESC,SP70,SP10
          GOTO      PACC6000
.
. 30. Diagnosis Field 2    
.
PACC4300  PACK      VARIABLE,ECACDIA2,SP70,SP10 
          GOTO      PACC6000
.
. 31. Diagnosis Field 2 Description
.
PACC4310  MOVE      SP70,DDESC 
          MOVE      ECACDIA2,KEY9
          CALL      RD10T9D1
          IF        OVRCD=1
              CALL      RDPT10D1
          ENDIF
          PACK      VARIABLE,DDESC,SP70,SP10
          GOTO      PACC6000
.
. 32. Diagnosis Field 3    
.
PACC4320  PACK      VARIABLE,ECACDIA3,SP70,SP10 
          GOTO      PACC6000
.
. 33. Diagnosis Field 3 Description
.
PACC4330  MOVE      SP70,DDESC 
          MOVE      ECACDIA3,KEY9
          CALL      RD10T9D1
          IF        OVRCD=1
              CALL      RDPT10D1
          ENDIF
          PACK      VARIABLE,DDESC,SP70,SP10
          GOTO      PACC6000
.
. 34. Diagnosis Field 4    
.
PACC4340  PACK      VARIABLE,ECACDIA4,SP70,SP10 
          GOTO      PACC6000
.
. 35. Diagnosis Field 5    
.
PACC4350  PACK      VARIABLE,ECACDIA5,SP70,SP10 
          GOTO      PACC6000
.
. 36. Diagnosis Field 6    
.
PACC4360  PACK      VARIABLE,ECACDIA6,SP70,SP10 
          GOTO      PACC6000
.
. 37. Yes/No Field 1       
.
PACC4370  MOVE      DNO,DIM3
          LOAD      DIM3,ECACYNO1,DYES
          PACK      VARIABLE,DIM3,SP70,SP10
          GOTO      PACC6000
.
. 38. Yes/No Field 2       
.
PACC4380  MOVE      DNO,DIM3
          LOAD      DIM3,ECACYNO2,DYES
          PACK      VARIABLE,DIM3,SP70,SP10
          GOTO      PACC6000
.
. 39. Yes/No Field 3       
.
PACC4390  MOVE      DNO,DIM3
          LOAD      DIM3,ECACYNO3,DYES
          PACK      VARIABLE,DIM3,SP70,SP10
          GOTO      PACC6000
.
. 40. Yes/No Field 4       
.
PACC4400  MOVE      DNO,DIM3
          LOAD      DIM3,ECACYNO4,DYES
          PACK      VARIABLE,DIM3,SP70,SP10
          GOTO      PACC6000
.
. 41. Yes/No Field 5       
.
PACC4410  MOVE      DNO,DIM3
          LOAD      DIM3,ECACYNO5,DYES
          PACK      VARIABLE,DIM3,SP70,SP10
          GOTO      PACC6000
.
. 42. Yes/No Field 6       
.
PACC4420  MOVE      DNO,DIM3
          LOAD      DIM3,ECACYNO6,DYES
          PACK      VARIABLE,DIM3,SP70,SP10
          GOTO      PACC6000
.
. 43. Free Format Field 1  
.
PACC4430  PACK      VARIABLE,ECACFRE1,SP70,SP10 
          GOTO      PACC6000
.
. 44. Free Format Field 2  
.
PACC4440  PACK      VARIABLE,ECACFRE2,SP70,SP10 
          GOTO      PACC6000
.
. 45. Free Format Field 3  
.
PACC4450  PACK      VARIABLE,ECACFRE3,SP70,SP10 
          GOTO      PACC6000
.
. 46. Free Format Field 4  
.
PACC4460  PACK      VARIABLE,ECACFRE4,SP70,SP10 
          GOTO      PACC6000
.
. 47. Free Format Field 5  
.
PACC4470  PACK      VARIABLE,ECACFRE5,SP70,SP10 
          GOTO      PACC6000
.
. 48. Free Format Field 6  
.
PACC4480  PACK      VARIABLE,ECACFRE6,SP70,SP10 
          GOTO      PACC6000
.
. 49. Free Format Field 7  
.
PACC4490  PACK      VARIABLE,ECACFRE7,SP70,SP10 
          GOTO      PACC6000
.
. 50. Free Format Field 8  
.
PACC4500  PACK      VARIABLE,ECACFRE8,SP70,SP10 
          GOTO      PACC6000
.
. 51. Free Format Field 9  
.
PACC4510  PACK      VARIABLE,ECACFRE9,SP70,SP10 
          GOTO      PACC6000
.
. 52. Free Format Field 10 
.
PACC4520  PACK      VARIABLE,ECACFR10,SP70,SP10 
          GOTO      PACC6000
.
. 53. User Defined Field 1
.
PACC4530  PACK      VARIABLE,ECACCOD1,SP70,SP10             * diagnosis
          GOTO      PACC6000
.
. 54. User Defined Field 1 Description
.
PACC4540  MOVE      CODEI1,TCODE
          MOVE      ECACCOD1,ACODE
          MOVE      SP20,TDESC
          MATCH     SP3,ACODE
          IF        !@EQUAL
            PACK      KEY5,TCODE,ACODE
            CALL      RDCODE1                      * code on file ?
          ENDIF
          MOVE      TDESC,VARIABLE
          GOTO      PACC6000
.
. 55. User Defined Field 2
.
PACC4550  PACK      VARIABLE,ECACCOD2,SP70,SP10             * diagnosis
          GOTO      PACC6000
.
. 56. User Defined Field 2 Description
.
PACC4560  MOVE      CODEI2,TCODE
          MOVE      ECACCOD2,ACODE
          MOVE      SP20,TDESC
          MATCH     SP3,ACODE
          IF        !@EQUAL
            PACK      KEY5,TCODE,ACODE
            CALL      RDCODE1                      * code on file ?
          ENDIF
          MOVE      TDESC,VARIABLE
          GOTO      PACC6000
.
. 57. User Defined Field 3
.
PACC4570  PACK      VARIABLE,ECACCOD3,SP70,SP10             * diagnosis
          GOTO      PACC6000
.
. 58. User Defined Field 3 Description
.
PACC4580  MOVE      CODEI3,TCODE
          MOVE      ECACCOD3,ACODE
          MOVE      SP20,TDESC
          MATCH     SP3,ACODE
          IF        !@EQUAL
            PACK      KEY5,TCODE,ACODE
            CALL      RDCODE1                      * code on file ?
          ENDIF
          MOVE      TDESC,VARIABLE
          GOTO      PACC6000
.
. 59. User Defined Field 4
.
PACC4590  PACK      VARIABLE,ECACCOD4,SP70,SP10             * diagnosis
          GOTO      PACC6000
.
. 60. User Defined Field 4 Description
.
PACC4600  MOVE      CODEI4,TCODE
          MOVE      ECACCOD4,ACODE
          MOVE      SP20,TDESC
          MATCH     SP3,ACODE
          IF        !@EQUAL
            PACK      KEY5,TCODE,ACODE
            CALL      RDCODE1                      * code on file ?
          ENDIF
          MOVE      TDESC,VARIABLE
          GOTO      PACC6000
.
. 61. User Defined Field 5
.
PACC4610  PACK      VARIABLE,ECACCOD5,SP70,SP10             * diagnosis
          GOTO      PACC6000
.
. 62. User Defined Field 5 Description
.
PACC4620  MOVE      CODEI5,TCODE
          MOVE      ECACCOD5,ACODE
          MOVE      SP20,TDESC
          MATCH     SP3,ACODE
          IF        !@EQUAL
            PACK      KEY5,TCODE,ACODE
            CALL      RDCODE1                      * code on file ?
          ENDIF
          MOVE      TDESC,VARIABLE
          GOTO      PACC6000
.
. 63. User Defined Field 6
.
PACC4630  PACK      VARIABLE,ECACCOD6,SP70,SP10             * diagnosis
          GOTO      PACC6000
.
. 64. User Defined Field 6 Description
.
PACC4640  MOVE      CODEI6,TCODE
          MOVE      ECACCOD6,ACODE
          MOVE      SP20,TDESC
          MATCH     SP3,ACODE
          IF        !@EQUAL
            PACK      KEY5,TCODE,ACODE
            CALL      RDCODE1                      * code on file ?
          ENDIF
          MOVE      TDESC,VARIABLE
          GOTO      PACC6000
.
. 65. User Defined Field 7
.
PACC4650  PACK      VARIABLE,ECACCOD7,SP70,SP10             * diagnosis
          GOTO      PACC6000
.
. 66. User Defined Field 7 Description
.
PACC4660  MOVE      CODEI7,TCODE
          MOVE      ECACCOD7,ACODE
          MOVE      SP20,TDESC
          PACK      KEY5,TCODE,ACODE
          CALL      RDCODE1                      * code on file ?
          MOVE      TDESC,VARIABLE
          GOTO      PACC6000
.
. 67. User Defined Field 8
.
PACC4670  PACK      VARIABLE,ECACCOD8,SP70,SP10             * diagnosis
          GOTO      PACC6000
.
. 68. User Defined Field 8 Description
.
PACC4680  MOVE      CODEI8,TCODE
          MOVE      ECACCOD8,ACODE
          MOVE      SP20,TDESC
          PACK      KEY5,TCODE,ACODE
          CALL      RDCODE1                      * code on file ?
          MOVE      TDESC,VARIABLE
          GOTO      PACC6000
.
. 69. User Defined Field 9
.
PACC4690  PACK      VARIABLE,ECACCOD9,SP70,SP10             * diagnosis
          GOTO      PACC6000
.
. 70. User Defined Field 9 Description
.
PACC4700  MOVE      CODEI9,TCODE
          MOVE      ECACCOD9,ACODE
          MOVE      SP20,TDESC
          PACK      KEY5,TCODE,ACODE
          CALL      RDCODE1                      * code on file ?
          MOVE      TDESC,VARIABLE
          GOTO      PACC6000
.
. 71. Numeric Field 1      
.
PACC4710  PACK      VARIABLE,ECACNUM1,SP70,SP10             * diagnosis
          MOVE      EIGHT,PRNTSTRT
          SUB       IBDTPLEN,PRNTSTRT
          GOTO      PACC7000
.
. 72. Numeric Field 2      
.
PACC4720  PACK      VARIABLE,ECACNUM2,SP70,SP10             * diagnosis
          MOVE      EIGHT,PRNTSTRT
          SUB       IBDTPLEN,PRNTSTRT
          GOTO      PACC7000
.
PACC4730  MOVE      PURNO,VARIABLE           * U/R number
          MOVE      EIGHT,PRNTSTRT
          SUB       IBDTPLEN,PRNTSTRT
          GOTO      PACC7000
.
PACC4740  MOVE      PMEDI,VARIABLE           * Medicare number
          GOTO      PACC6000
.
.------ format patient title ------
.
PACC4750  MOVE      PTITL,VARIABLE
          GOTO      PACC6000
.
.------ format previous name ------
.
PACC4760  MOVE      PPSNAME,VARIABLE
          GOTO      PACC6000
.
PACC4770  MOVE      PSNAME,VARIABLE          * Surname
          GOTO      PACC6000
.
PACC4780  MOVE      PGNAME,VARIABLE          * Given name
          GOTO      PACC6000
.
PACC4790  MOVE      PADD1,VARIABLE           * Address line 1
          GOTO      PACC6000
.
PACC4800  MOVE      PADD2,VARIABLE           * Address line 2
          GOTO      PACC6000
.
PACC4810  MOVE      PSUBRB,VARIABLE          * Suburb
          GOTO      PACC6000
.
PACC4820  MOVE      PTELEP,VARIABLE          * Private telephone
          GOTO      PACC6000
.
PACC4830  MOVE      PTELEB,VARIABLE          * Business telephone
          GOTO      PACC6000
.
PACC4840  MOVE      PPOST,VARIABLE           * Postcode
          GOTO      PACC6000
.
PACC4850  MOVE      SP8,VARIABLE
.
.* ****************************************** Start of Changes         *C-49016
          MOVE      PSEX,DSEXCHAR
          CALL      SEXDSC00                * get sex description (in IBACOMN)
.                                           *       returns DSEXDESC & DSEXNO
          MOVE      DSEXDESC,VARIABLE
.* ******************************************   End of Changes         *C-49016
.
          GOTO      PACC6000
.
PACC4860  CALL      LABELAGE 
          MOVE      XAGE,VARIABLE           * Age
          MOVE      THREE,PRNTSTRT
          SUB       IBDTPLEN,PRNTSTRT
          GOTO      PACC7000
.
.------ format Birth date with century ------
.
PACC4870  UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPCDATE,VARIABLE
          GOTO      PACC6000
.
PACC4880  MOVE      PCONT,VARIABLE           * Country
          GOTO      PACC6000
.
.------ format the country of birth description ------
.
PACC4890  MOVE      CODEC,TCODE
          PACK      ACODE,PCONT,SP3
          CALL      GTCOD000
          MOVE      TDESC,VARIABLE
          GOTO      PACC6000
.
PACC4900  MOVE      PMSTAT,VARIABLE          * Marital status
          GOTO      PACC6000
.
.------ format the marital status description ------
.
PACC4910  MOVE      CODEM,TCODE
          PACK      ACODE,PMSTAT,SP3
          CALL      GTCOD000
          MOVE      TDESC,VARIABLE
          GOTO      PACC6000
.
.------ format religion ------
.
PACC4920  MOVE      PREG,VARIABLE
          GOTO      PACC6000
.
PACC4930  MOVE      CODER,TCODE              * Religion
          PACK      ACODE,PREG,SP3
          CALL      GTCOD000
          MOVE      TDESC,VARIABLE
          GOTO      PACC6000
.
PACC4940  MOVE      POCCUP,VARIABLE          * Occupation
          GOTO      PACC6000
.
PACC4950  MOVE      PTYPE,VARIABLE           * Patient Type
          GOTO      PACC6000
.
PACC4960  MOVE      CODET,TCODE              * Patient Type
          PACK      ACODE,PTYPE,SP3
          CALL      GTCOD000
          MOVE      TDESC,VARIABLE
          GOTO      PACC6000
.
PACC4970  MOVE      PPENNO,VARIABLE          * Pension number
          GOTO      PACC6000
.
.------ format the smoker indicator ------
.
PACC4980  MOVE      "UNKNOWN",DSMOKE
          LOAD      DSMOKE,PSMOK,DYES,DNO
          MOVE      DSMOKE,VARIABLE
          GOTO      PACC6000
.
.------ format the repatriation number ------
.
PACC4990  MOVE      PREPAT,VARIABLE
          GOTO      PACC6000
.
.------ format the case notes indicator ------
.
PACC5000  MOVE      SP1,ANS 
          LOAD      ANS,PCASE,CCNOTES
          MOVE      ANS,VARIABLE
          GOTO      PACC6000
.
.------ format the number of years resident ------
.
PACC5010  MOVE      PYRRES,VARIABLE
          MOVE      TWO,PRNTSTRT
          SUB       IBDTPLEN,PRNTSTRT
          GOTO      PACC7000
.
.------ format user defined field 1 code ------
.
PACC5020  MOVE      PUSR1,VARIABLE
          GOTO      PACC6000
.
.------ format user defined field 1 description ------
.
PACC5030  MOVE      CODEP1,TCODE           * User defined 1
          PACK      ACODE,PUSR1,SP3
          CALL      GTCOD000                 * Read the patient codes file
          MOVE      TDESC,VARIABLE
          GOTO      PACC6000
.
.------ format user defined field 2 code ------
.
PACC5040  MOVE      PUSR2,VARIABLE
          GOTO      PACC6000
.
.------ format user defined field 2 description ------
.
PACC5050  MOVE      CODEP2,TCODE           * User defined 2
          PACK      ACODE,PUSR2,SP3
          CALL      GTCOD000                 * Read the patient codes file
          MOVE      TDESC,VARIABLE
          GOTO      PACC6000
.
.------ format user defined field 3 code ------
.
PACC5060  MOVE      PUSR3,VARIABLE
          GOTO      PACC6000
.
.------ format user defined field 3 description ------
.
PACC5070  MOVE      CODEP3,TCODE           * User defined 3
          PACK      ACODE,PUSR3,SP3
          CALL      GTCOD000                 * Read the patient codes file
          MOVE      TDESC,VARIABLE
          GOTO      PACC6000
.
.------ format user defined field 4 code ------
.
PACC5080  MOVE      PUSR4,VARIABLE
          GOTO      PACC6000
.
.------ format user defined field 4 description ------
.
PACC5090  MOVE      CODEP4,TCODE           * User defined 4
          PACK      ACODE,PUSR4,SP3
          CALL      GTCOD000                 * Read the patient codes file
          MOVE      TDESC,VARIABLE
          GOTO      PACC6000
.
.------ format user defined field 5 code ------
.
PACC5100  MOVE      PUSR5,VARIABLE
          GOTO      PACC6000
.
.------ format user defined field 5 description ------
.
PACC5110  MOVE      CODEP5,TCODE           * User defined 5
          PACK      ACODE,PUSR5,SP3
          CALL      GTCOD000                 * Read the patient codes file
          MOVE      TDESC,VARIABLE
          GOTO      PACC6000
.
.------ format user defined field 6 code ------
.
PACC5120  MOVE      PUSR6,VARIABLE
          GOTO      PACC6000
.
.------ format user defined field 6 description ------
.
PACC5130  MOVE      CODEP6,TCODE           * User defined 6
          PACK      ACODE,PUSR6,SP3
          CALL      GTCOD000                 * Read the patient codes file
          MOVE      TDESC,VARIABLE
          GOTO      PACC6000
.
.------ format user defined Y/N field 1 -----
.
PACC5140  MOVE      DNO,DIM3
          LOAD      DIM3,PUYN1,DYES,DNO
          MOVE      DIM3,VARIABLE
          GOTO      PACC6000
.
.------ format user defined Y/N field 2 -----
.
PACC5150  MOVE      DNO,DIM3
          LOAD      DIM3,PUYN2,DYES,DNO
          MOVE      DIM3,VARIABLE
          GOTO      PACC6000
.
.------ format user defined Y/N field 3 -----
.
PACC5160  MOVE      DNO,DIM3
          LOAD      DIM3,PUYN3,DYES,DNO
          MOVE      DIM3,VARIABLE
          GOTO      PACC6000
.
.------ format pension number expiry date ------
.
PACC5170  REP       " 0",PPNDTE
          UNPACK    PPNDTE,XCENT,XYEAR,XMON
          PACK      VARIABLE,XMON,SLASH,XCENT,XYEAR
          GOTO      PACC6000
.
. ------- Format Emergency contact name -------
.
PACC5180  MOVE      PTMXECNM,VARIABLE
          GOTO      PACC6000
.
. ------- Format Emergency contact address 1 -------
.
PACC5190  MOVE      PTMXECA1,VARIABLE
          GOTO      PACC6000
.
. ------- Format Emergency contact address 2 -------
.
PACC5200  MOVE      PTMXECA2,VARIABLE
          GOTO      PACC6000
.
. ------- Format Emergency contact address 3 -------
.
PACC5210  MOVE      PTMXECA3,VARIABLE
          GOTO      PACC6000
.
. ------- Format Emergency contact postcode -------
.
PACC5220  MOVE      PTMXECPC,VARIABLE
          GOTO      PACC6000
.
. ------- Format Emergency contact private phone -------
.
PACC5230  MOVE      PTMXECPP,VARIABLE
          GOTO      PACC6000
.
. ------- Format Emergency contact business phone -------
.
PACC5240  MOVE      PTMXECBP,VARIABLE
          GOTO      PACC6000
.
. ------- Format Emergency contact relationship -------
.
PACC5250  MOVE      PTMXECRE,VARIABLE
          GOTO      PACC6000
.
. ------- Format Nearest relative name -------
.
PACC5260  MOVE      PTMXNRNM,VARIABLE
          GOTO      PACC6000
.
. ------- Format Nearest relative address 1 -------
.
PACC5270  MOVE      PTMXNRA1,VARIABLE
          GOTO      PACC6000
.
. ------- Format Nearest relative address 2 -------
.
PACC5280  MOVE      PTMXNRA2,VARIABLE
          GOTO      PACC6000
.
. ------- Format Nearest relative address 3 -------
.
PACC5290  MOVE      PTMXNRA3,VARIABLE
          GOTO      PACC6000
.
. ------- Format Nearest relative postcode -------
.
PACC5300  MOVE      PTMXNRPC,VARIABLE
          GOTO      PACC6000
.
. ------- Format Nearest relative private phone -------
.
PACC5310  MOVE      PTMXNRPP,VARIABLE
          GOTO      PACC6000
.
. ------- Format Nearest relative business phone -------
.
PACC5320  MOVE      PTMXNRBP,VARIABLE
          GOTO      PACC6000
.
. ------- Format Nearest relative relationship -------
.
PACC5330  MOVE      PTMXNRRE,VARIABLE
          GOTO      PACC6000
.
PACC5331  MOVE      PTMXCELL,VARIABLE          * cellular telephone
          GOTO      PACC6000
.
PACC5332  MOVE      PTMXADD1,VARIABLE          * Postal Address line 1
          GOTO      PACC6000
.
PACC5333  MOVE      PTMXADD2,VARIABLE          * Postal Address line 2
          GOTO      PACC6000
.
PACC5334  MOVE      PTMXADD3,VARIABLE          * Postal Address line 3
          GOTO      PACC6000
.
PACC5335  MOVE      PTMXADD4,VARIABLE          * Postal Address line 4
          GOTO      PACC6000
.
PACC5336  MOVE      PTMXPOST,VARIABLE             * Postcode
          GOTO      PACC6000
.
PACC5337  COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      PACC1000 IF NOT EQUAL
.
          MOVE      SP2,NHMAETH
          OPEN      NHIMASA2,"nhimasaf"
          MOVE      PURNO,KEY8
          CALL      RDNHMAS2
          PACK      VARIABLE,NHMAETH,SP70,SP70     * Ethnicity code (NHI only)
          GOTO      PACC6000
.
PACC5338  COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      PACC1000 IF NOT EQUAL
.
          MOVE      SP2,NHMAETH
          OPEN      NHIMASA2,"nhimasaf"
          MOVE      PURNO,KEY8
          CALL      RDNHMAS2
.
          MATCH     SP2,NHMAETH                   * Ethnicity desc (NHI only)
          IF        @EQUAL
            PACK      VARIABLE,SP70,SP70
            GOTO      PACC6000
          ENDIF
.
          OPEN      NHIETHA1,"nhiethaf"
          MOVE      SP30,NHETDES
          PACK      KEY2,NHMAETH
          CALL      RDNHETH1
          PACK      VARIABLE,NHETDES,SP70,SP70
          GOTO      PACC6000
.
PACC5339  COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      PACC1000 IF NOT EQUAL
.
          MOVE      SP2,NHMAETH2
          OPEN      NHIMASA2,"nhimasaf"
          MOVE      PURNO,KEY8
          CALL      RDNHMAS2
          PACK      VARIABLE,NHMAETH2,SP70,SP70     * Ethnicity code (NHI only)
          GOTO      PACC6000
.
PACC5340  COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      PACC1000 IF NOT EQUAL
.
          MOVE      SP2,NHMAETH2
          OPEN      NHIMASA2,"nhimasaf"
          MOVE      PURNO,KEY8
          CALL      RDNHMAS2
.
          MATCH     SP2,NHMAETH2                  * Ethnicity desc (NHI only)
          IF        @EQUAL
            PACK      VARIABLE,SP70,SP70
            GOTO      PACC6000
          ENDIF
.
          OPEN      NHIETHA1,"nhiethaf"
          MOVE      SP30,NHETDES
          PACK      KEY2,NHMAETH2
          CALL      RDNHETH1
          PACK      VARIABLE,NHETDES,SP70,SP70
          GOTO      PACC6000
.
PACC5341  COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      PACC1000 IF NOT EQUAL
.
          MOVE      SP2,NHMAETH3
          OPEN      NHIMASA2,"nhimasaf"
          MOVE      PURNO,KEY8
          CALL      RDNHMAS2
          PACK      VARIABLE,NHMAETH3,SP70,SP70     * Ethnicity code (NHI only)
          GOTO      PACC6000
.
PACC5342  COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      PACC1000 IF NOT EQUAL
.
          MOVE      SP2,NHMAETH3
          OPEN      NHIMASA2,"nhimasaf"
          MOVE      PURNO,KEY8
          CALL      RDNHMAS2
.
          MATCH     SP2,NHMAETH3                  * Ethnicity desc (NHI only)
          IF        @EQUAL
            PACK      VARIABLE,SP70,SP70
            GOTO      PACC6000
          ENDIF
.
          OPEN      NHIETHA1,"nhiethaf"
          MOVE      SP30,NHETDES
          PACK      KEY2,NHMAETH3
          CALL      RDNHETH1
          PACK      VARIABLE,NHETDES,SP70,SP70
          GOTO      PACC6000
.
PACC5343  COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      PACC1000 IF NOT EQUAL
.
          MOVE      SP1,NHMARES
          OPEN      NHIMASA2,"nhimasaf"
          MOVE      PURNO,KEY8
          CALL      RDNHMAS2
.
          PACK      VARIABLE,SP70,SP70            * Resident Status (NHI only)
          MATCH     "Y",NHMARES
          IF        @EQUAL
            PACK      VARIABLE,DYES,SP70,SP70
          ENDIF
.
          MATCH     "N",NHMARES
          IF        @EQUAL
            PACK      VARIABLE,DNO,SP70,SP70
          ENDIF
          GOTO      PACC6000
.
PACC5344  PACK      VARIABLE,SP70,SP70
          MOVE      PNKADD4,VARIABLE
          GOTO      PACC6000
.
PACC5345  PACK      VARIABLE,SP70,SP70
          MOVE      PADD4,VARIABLE
          GOTO      PACC6000
.
PACC5346  PACK      VARIABLE,SP70,SP70
          MOVE      PKADD4,VARIABLE
          GOTO      PACC6000
.
PACC5347  PACK      VARIABLE,SP70,SP70
          MOVE      PTMXECA4,VARIABLE
          GOTO      PACC6000
.
PACC5348  PACK      VARIABLE,SP70,SP70
          MOVE      PTMXNRA4,VARIABLE
          GOTO      PACC6000
.
. ----- Format the variable -----
.
PACC6000  RESET     VARIABLE,IBDTPLEN
          LENSET    VARIABLE
          RESET     VARIABLE
          PRINT     *IBDTCOL,*+,VARIABLE;
          GOTO      PACC1000                * Read next record
.
PACC7000  COMPARE   ZERO,PRNTSTRT           * Don't bump if printing full length
          GOTO      PACC8000 IF EQUAL
.
          BUMP      VARIABLE,PRNTSTRT       * Bump to starting position
          RESET     VARIABLE,IBDTPLEN
          LENSET    VARIABLE
          RESET     VARIABLE
.
. ----- Print the variable -----
.
PACC8000  PRINT     *IBDTCOL,*+,VARIABLE;
          GOTO      PACC1000                * Read next record
.
. ----- End of ACCF, Print new lines until the end of page is reached -----
.
PACC9000  COMPARE   CURRROW,IBTHLENG        * Test page length
          GOTO      PACC9999 IF LESS
.
          PRINT     *N;
          ADD       ONE,CURRROW
          GOTO      PACC9000
.
PACC9999  MOVE      FALSE,EXIT 
          CALL      CLSPRINT                * Close the spool file
          RETURN                            * Finished
.
.****************************************************************************
.------- Get a codes file record -------
.****************************************************************************
GTCOD000  MOVE      SP20,TDESC               * Initialise description
          UNPACK    SP20,THCSCOD,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5
          MOVE      ZERO,TCFORM6
.
.         Is the code blank ?
.
          MATCH     SP3,ACODE
          GOTO      GTCOD999 IF EQUAL
.
.         Get the code file record
.
          PACK      KEY5,TCODE,ACODE
          CALL      RDCODE1
.
GTCOD999  RETURN

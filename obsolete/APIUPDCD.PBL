.****************************************************************************
.*                          APIUPDCD.PBL                                    *
.*                                                                          *
.* Written By    : Steve Armstrong                                          *
.*                                                                          *
.* Date          : 30/03/1998                                               *
.*                                                                          *
.* Function      : To update the latest Medical Warnings from the MOH to    *
.*                 Powerbuilder PMI via API's                               *
.*                                                                          *
.* Modifications :                                                          *
.*      V10.00.01 19/03/2010  Steve Armstrong   CAR 135505                  *
.*                Added HL7TRGID & HL7INCLD setting for all broadcast       *
.*                messages                                                  *
.****************************************************************************
.*      V9.02.01 : 09/11/2001  Mike Laming                                  *
.*                 Rename DGCLIDNR to DGCLICDN                              *
.*                 Rename DGCLIMWN to DGCLICMW                              *
.*                                                                          *
.****************************************************************************
.
.         Firstly, send a delete record for the selected U/R so that the
.         PB application can delete all existing Med. Warning records for this
.         patient
.
APIUPD00  MOVE      PURNO,PTMWURNO
          MOVE      TWO,FORM1                    * set for delete
          MOVE      ONE,HL7TRGID
          MOVE      "APIUPDCD",HL7INCLD
          PROC      DGCLICMW                     * broadcast dgate msg *C-90201
.
.         Now loop through the patmwsaf file and for each record found for the
.         U/R number, send a message through to Datagate to add this Warning
.
          PACK      KEY14,PURNO,SP20
          CALL      RSPTMWS1                     * position on U/R
APIUPD10  CALL      RKPTMWS1                     * read next record
          BRANCH    OVRCD,APIUPD99               * eof - finished
.
          MATCH     PURNO,PTMWURNO               * same U/R still ?
          GOTO      APIUPD99 IF NOT EQUAL        * no - finished
.
          MOVE      ONE,FORM1                    * set for add
          MOVE      TWO,HL7TRGID
          MOVE      "APIUPDCD",HL7INCLD
          PROC      DGCLICMW                     * broadcast dgate msg *C-90201
.
          GOTO      APIUPD10                     * get next record
.
APIUPD99  RETURN
.
          INC       DGCLICMW                                           *C-90201
          INC       DGCLICDN                                           *C-90201
+

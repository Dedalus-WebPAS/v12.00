<!DOCTYPE HTML>
<head>
<link rel="stylesheet" href="iphone.css" type="text/css">
<script type="text/javascript" src="iphone.js"> </script>
<script type="text/javascript">
var ListLocation;
function init() {
 var h  = document.getElementsByTagName("head")[0];
 var xRawData=document.getElementById("RawData")
 xmlHttp = new XMLHttpRequest(); // Firefox, Opera 8.0+, Safari
 theURL = "../../cgi-bin/patweb07.pbl?reportno=2&template=3"
 xmlHttp.open("GET", theURL, false);
 xmlHttp.send();
 if (xmlHttp.responseText!="") {
   xRawData.innerHTML=xmlHttp.responseText;
   PatientListTable()
 }
 else {
   ListLocation=document.getElementById("WidgetTable1")
   ListLocation.innerHTML="<h4 align=center>Web Service Not Available</h4><br>" +
                          "<p align=center>Please Contact System Administrators</p>"
 }
}
//----------------------------------------------------------------------------
// Patient List Display
//---------------------------------------------------------------------------
function PatientListTable() {
 var xRawData=document.getElementById("RawData")
 var trows=xRawData.getElementsByTagName("tr");
 var purn="";
 var pnam="";
 var pvis="";
 var pbod="";
 var psex="";
 var padd="&nbsp;"
 ListString="<ul class=sectionList>"
 for (i=1;i<trows.length;i++) {
     var tcells=trows[i].getElementsByTagName("td")
     for (j=0;j<tcells.length;j++) {
       switch (j) {
         case 0 :
           purn=tcells[j].innerHTML
           purn=purn.replace(/.*ShowPatient\(\"/i,"")
           pvis=purn.replace(/.*\,\"/i,"").replace(/\"\).*/,"")
           purn=purn.replace(/\"\,.*/i,"")
           break;
         case 1 :
           pnam=tcells[j].innerHTML.replace(/.*\<b\>/i,"")
           pnam=pnam.replace(/\<\/b\>/i,"")
           $xvar=pnam.replace(/.*\(/i,"").replace(/\).*/,"")
           $xvar=$xvar.split(",")
           pdob=$xvar[0]
           psex=$xvar[1]
           if (psex=="F") psex="Female"
           if (psex=="M") psex="Male"
           pnam=pnam.replace(/\(.*/i,"")
           break;
       } 
     }
        ListString+="<li class=sectionItem "+
        "onclick=\"LinkTo('"+purn+"','"+pvis+"');\">"+
        "<span class='PatientDetails'>"+
        "<span class='listText'>"+pnam+"</span>"+
        "<span class='subscript'> "+psex+"&nbsp;"+pdob+"</span></span></li>"
 //       "<span class='subscript'>"+psex+"</span></span></li>"
 //       "<span onclick='AddPhoto(\""+purn+"\",\""+pvis+"\");' class=PatientImageDiv>" +
 //       "<img style='display:none;' src='../../images/patients/"+purn.replace(/ /g,"")+
 //       ".jpg' class=PatientImage onload=\"this.style.display='inline';\" "+
 //       "onerror=\"this.parentElement.innerHTML='<br>Add<br>Photo ID';\"></span>"+
  }
  ListString+="</ul>"
  ListLocation=document.getElementById("WidgetTable1")
  ListLocation.innerHTML=ListString;
}
function LinkTo(urnumber,admissno) {
  mScreen=top.document.getElementById("mainScreen")
  mScreen.style.display = "none";
  pFrame=top.document.getElementById("patientFrame")
  pScreen=top.document.getElementById("patientScreen")
  pScreen.style.position = "absolute";
  pScreen.style.top = "0px";
  pScreen.style.left = "0px";
  pScreen.style.width = "100%";
  pFrame.src="LoadingPage.html";
  pScreen.style.display = "";
  pFrame.src = "../../cgi-bin/patweb98.pbl?reportno=1&template=081"+
                                "&urnumber="+urnumber.replace(/ /g,"+") +
                                "&admissno="+admissno.replace(/ /g,"+")
}
function GoBack() {
  backPage=top.getCookie('HomePageURL');
  backPage=backPage.replace(/.*iphone\//,"");
  location.href=backPage;
}
</script>
</head>
<body class=PatientList onload="init();">
<div class=HeadingDiv>
<table border=0 padding=0 style='width:100%;border:0;margin:0;padding:4px 0px'>
<tr><td class=HeadLeft><span class="goBack"
    onclick="GoBack();">Back</span></td>
    <td class=HeadTitle>Recent Patients</td>
    <td class=HeadRight>
    </td>
</tr></table>
</div>
<div id=WidgetTable1 class=w-table></div>
<div id=RawData style='display:none;'></div>
</body>

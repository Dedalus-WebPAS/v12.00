<!DOCTYPE HTML>
<head>
<link rel="stylesheet" href="iphone.css" type="text/css"/>
<script type="text/javascript" src="iphone.js"></script>
<script type="text/javascript">
var ListLocation;
function EditList(webpd002,ListTitle) {
 el=document.getElementById("BackButton")
 el.innerText="Lists";
 el.href='javascript:PatientLists()';
 el=document.getElementById("PageTitle")
 el.innerText=ListTitle;
 ListLocation=document.getElementById("WidgetTable1")
 theURL="../../cgi-bin/patweb02.pbl?reportno=1&template=3&webpd002="+webpd002
 theURL = theURL + '&httprand='+Math.random();
 xmlHttp = new XMLHttpRequest(); // Firefox, Opera 8.0+, Safari
 xmlHttp.open("GET", theURL, false);
 xmlHttp.send();
 ListLocation.innerHTML=xmlHttp.responseText;
}
function ShowList(webpd002,ListTitle) {
 el=document.getElementById("BackButton")
 el.innerText="Lists";
 el.href='javascript:PatientLists()';
 el=document.getElementById("PageTitle")
 el.innerText=ListTitle;
 var h  = document.getElementsByTagName("head")[0];
 ListLocation=document.getElementById("WidgetTable1")
 theURL="../../cgi-bin/patweb02.pbl?reportno=2&template=7&webpd002="+webpd002
 theURL = theURL + '&httprand='+Math.random();
 xmlHttp = new XMLHttpRequest(); // Firefox, Opera 8.0+, Safari
 xmlHttp.open("GET", theURL, false);
 xmlHttp.send();
 var s = document.createElement("script");
 s.type="text/javascript";
 h.appendChild(s);
 s.text=xmlHttp.responseText;
 ListPatients();
}
//----------------------------------------------------------------------------
// Patient List Display
//---------------------------------------------------------------------------
function ListPatients(ListName) {
 ListLocation=document.getElementById("WidgetTable1")
 t = new Table("patient-list","patient-item");
 t.addColumn("Patient Image","PatientImage",0,0,"../../cgi-bin/","","","")
 t.addColumn("Patient","PatientLinkOnly",3,3,"","","01","45%")
 t.addColumn("Patient","PatientLink",3,3,"","","01","45%")
 t.addColumn("","LeftSubscript",7,7,"","","0","45%")
 t.addColumn("","RightDate",8,8,"","","0","45%")
 t.addColumn("LinkClose","LinkClose",3,3,"","","15","")
 AddPatients();
 TableOutput(0,1);
}
function EditPatients() {
 ListLocation=document.getElementById("WidgetTable1")
 t = new Table("patient-list","patient-item");
 t.addColumn("EditIcon","Image",1,1,"","delete.png","1","")
 t.addColumn("ListName","String",3,3,"","","0","45%")
 t.addColumn("","LeftSubscript",7,7,"","","0","45%")
 t.addColumn("","RightDate",8,8,"","","0","45%")
 AddPatients();
 TableOutput(0,1);
}
function PatientLink(urnumber,admissno) {
  location.href="../../cgi-bin/patweb98.pbl?reportno=1&template=081"+
                "&urnumber="+urnumber.replace(/ /g,"+") +
                "&admissno="+admissno.replace(/ /g,"+")
}
//----------------------------------------------------------------------------
// Patient List Display
//---------------------------------------------------------------------------
function PatientLists() {
 ListLocation=document.getElementById("WidgetTable1")
 t = new Table("menu","menu-line");
 t.addColumn("ListName","String",2,3,"","","0","45%")
 AddListRow();
 TableOutput(0,1);
}
//----------------------------------------------------------------------------
// Edit Patient List Display
//---------------------------------------------------------------------------
function ShowEditLists() {
 el=document.getElementById("EditButton")
 if (el.innerText=="Edit") {
   el.innerText="Done"
   ListLocation=document.getElementById("WidgetTable1")
 t = new Table("","single-line");
   t.addColumn("EditIcon","Image",1,1,"","application_form_edit.png","1","")
   t.addColumn("ListName","String",2,3,"","","0","")
   AddListRow();
   TableOutput(0,1);
 }
 else {
   el.innerText="Edit"
   PatientLists();
 }
}
function AddListRow() {
  theURL = "../../cgi-bin/patweb02.pbl?reportno=2&template=5";
  theURL = theURL + '&httprand='+Math.random();
  xmlHttp = new XMLHttpRequest(); // Firefox, Opera 8.0+, Safari
  xmlHttp.open("GET", theURL, false);
  xmlHttp.send();
  var $str=xmlHttp.responseText.replace(/\n/,"")
  $str=$str.replace(/<\/option>/g,"|");
  $arr=$str.split("|");
  for (i=0;i<$arr.length;i++) {
    optText=$arr[i].replace(/<option.*>/,"");
    optValue=$arr[i].replace(/<option value="/,"").replace(/">.*/,"");
    if (optValue.match(/\w/)!=null) {
      Link1="javascript:ShowList('"+optValue+"','"+optText+"');"
      Link2="javascript:EditList('"+optValue+"','"+optText+"');"
      t.addRow(Link1,Link2,optText,optText)
    }
  }
}
//
// Update or Delete List
//
function UpdateListPage(theForm) {
  xmlHttp = new XMLHttpRequest(); // Firefox, Opera 8.0+, Safari
  theURL="../../cgi-bin/patweb02.pbl"
  theData="reportno=1&template=3&updttype=U"
  theData=theData+"&webpd002="+theForm.webpd002.value
  theData=theData+"&webpd003="+theForm.webpd003.value
  theData=theData+"&webpd004="+theForm.webpd004.value
  xmlHttp.open("POST", theURL, false);
  xmlHttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
  xmlHttp.send(theData);
  el=document.getElementById("EditButton")
  el.innerText="Edit"
  PatientLists()
}
function DeleteListPage(theForm) {
  xmlHttp = new XMLHttpRequest(); // Firefox, Opera 8.0+, Safari
  theURL="../../cgi-bin/patweb02.pbl"
  theData="reportno=1&template=3&updttype=D"
  theData=theData+"&webpd002="+theForm.webpd002.value
  theData=theData+"&webpd003="+theForm.webpd003.value
  theData=theData+"&webpd004="+theForm.webpd004.value
  xmlHttp.open("POST", theURL, false);
  xmlHttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
  xmlHttp.send(theData);
  el=document.getElementById("EditButton")
  el.innerText="Edit"
  PatientLists()
}
function GoBack() {
  backPage=top.getCookie('HomePageURL');
  backPage=backPage.replace(/.*iphone\//,"");
  location.href=backPage;
}
</script>
</head>
<body class=PatientList onload="PatientLists();">
<div class=HeadingDiv>
<table border=0 padding=0 style='width:100%;border:0;margin:0;padding:4px 0px'>
<tr><td class=HeadLeft><span class="goBack"
    onclick="GoBack();">Back</span></td>
    <td class=HeadTitle>Patients</td>
    <td class=HeadRight>
    </td>
</tr></table>
</div>

<div id=WidgetTable1 class=w-table></div>
<div style='display:none;'>
<form id=DisplayForm><select id=webpd002></select></form>
</div>
</body>

#!/bin/bash 
shopt -s xpg_echo
scriptPath=`which $0`;
scriptDir="${scriptPath%/*}";

#------------------------------------------------------------------
#  Script     : ibaaps60.us2
#
#  Function   : Perform Unix Functions Required for Faxing Remittance
#
#  Parameters : <spoolfile> <fax number> <passcode>
#                   $1           $2          $3
#
#------------------------------------------------------------------
cd $TBSPOOL                                    # cd to Print Spool Directory
echo "%%[MESSAGE]" >$1.sub                     # Start ZetaFax Submit File
echo "From: IBA Health Limited" >>$1.sub       # Set From Hospital Name
echo "User: DavidB" >>$1.sub                       # Zetafax User Based on Passcode
#case $3 in
#1426) echo "david" >>$1.sub
#      echo "Letterhead: ddadvice " >>$1.sub
#      ;;
#   *) echo "Invalid User ID"
#      exit 0
#      ;;
#esac
#echo $3 >>$1.sub                               # $3 = Passcode
echo "Letterhead: ddadvice" >>$1.sub           # Set Letterhead to APREMADV
echo "COVERSHEET:" >>$1.sub
echo "Format: EPSON" >>$1.sub                  # Printer Format to EPSON
comp=`awk -f $scriptDir/ibaaps60.awk $1.prt`   # Get Company Name from Spoolfile
echo "To: \c" >>$1.sub                         # Set "To" Company
echo $comp >>$1.sub  
echo "Fax: \c" >>$1.sub                        # Set "To" Fax Number $2
echo $2 >>$1.sub
echo "%%[TEXT]" >>$1.sub                       # Start Text Section
echo "%%[Font:ROMAN14]" >>$1.sub               # Set Font
echo "%%[DOWN:100]" >>$1.sub                   # Position Overlay
echo " " >>$1.sub
#cat  $1.prt  >>$1.sub                          # Add Spoolfile Details
awk -f $scriptDir/ibaaps60.aw2 $1.prt >> $1.sub
#---------------------------------------------------------------------
# Transmit File to PC Network.
# Using Remote86.ktm to put file in Zetafax Submit Directory.
# Clean up Submit and Spool file.
#---------------------------------------------------------------------
# echo " "
# echo $2
# echo $1.sub 
# echo "[4;86.z\c"
#---------------------------------------------------------------------
# Transmit file to PC Network.
# Using FTP to put file in Zetafax Submit Directory.
#---------------------------------------------------------------------
#system=206.73.199.63
#here=`pwd`
#filename=$1.sub
#echo "open $system"  >lancp.$$
#echo "user root root"  >>lancp.$$
#echo "cd /zfax/server/z-temp"  >>lancp.$$
#echo "put $filename"  >>lancp.$$
#echo "close"    >>lancp.$$
#echo "bye"    >>lancp.$$
#ftp -n -v < lancp.$$ >lanerr.$$
#rm lanerr.$$
#rm lancp.$$
cp $1.sub /home/davidb/tmp/
rm $1.sub 
rm $1.prt 

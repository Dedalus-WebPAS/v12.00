<meta name="TemplateVersion" content="V12.00.00">
<meta name="TemplateHome" content="nz">
<meta name="HelpFileName"    content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/OutpatientSelect.js"></script>
<script type="text/javascript" src="../js/OutpatientTypeClinic.js"></script>
<script type="text/javascript">
function SetList() {
  p=UpdateForm
  p.otrfl027.options.length=1;
  SetClinicType(p.otrfl027,p.defctype.value,p.otrfl003.value);
//
  SetList2();
}
function SetList2() {
  p=UpdateForm
  p.otrfl004.options.length=1;
  SetTypeClinic(p.otrfl004,p.deftclid.value,p.otrfl003.value,p.otrfl027.value);
}
function AddReferral() {
 Submitpage=true;
 if(!isWhitespace(UpdateForm.otrfl030.value)) {
 if (SetDateYYYYMMDD(UpdateForm.otrfl001.value) > SetDateYYYYMMDD(UpdateForm.otrfl030.value)) {
 Submitpage=false;
 alert("Date Letter Recieved must be greater than or equal to Date of Letter");
  }
 }
 if(!isWhitespace(UpdateForm.otrfl031.value)) {
if (SetDateYYYYMMDD(UpdateForm.otrfl001.value) > SetDateYYYYMMDD(UpdateForm.otrfl031.value)) {
 Submitpage=false;
 alert("Date of Priority must be greater than or equal to Date of Letter");
  }
}
 if(Submitpage){
  var Admissno = document.PatientLinks.admissno.value.replace(/ /g,"+");
  var Urnumber = document.PatientLinks.urnumber.value.replace(/ /g,"+");
  var Eocrdind = checkMaintainEOC();
  document.UpdateForm.redirect.value = "outweb01.pbl?reportno=4&template=7" +
           "&urnumber=" + Urnumber + "&eocrdind=" + Eocrdind;
  setRedirect();
  document.UpdateForm.submit();
 }
}
function setRedirect() {
  strTemplate="" ;
  scrName="";
  checkInd=document.UpdateForm.otrfl041.value.substr(3,5)
  if(checkInd.search(/W/g) >= 0) {
    strTemplate="005"; 
    scrName="WC";}
  if(checkInd.search(/M/g) >= 0) {
    strTemplate="042";
    scrName="TAC";}
  if(checkInd.search(/V/g) >= 0) {
    strTemplate="043"; 
    scrName="VA";}
  checkInd=document.UpdateForm.otrfl041.value.substr(8,1)
  if(checkInd.search(/C/g) >= 0) {
    strTemplate="021"; 
    scrName="CT";}
  if (strTemplate!="") {
    document.UpdateForm.redirect.value="patweb89.pbl?reportno=01" +
               "&template=" + strTemplate +
               "&urnumber=" + PatientLinks.urnumber.value.replace(/ /g,"+")  +
               "&systflag=2" +
               "&refrflag=1"
    document.UpdateForm.nextpage.value=6;
  }
}
function checkMaintainEOC() {
  if (document.UpdateForm.chkbxeoc.checked == true)
    return 1;
  else
    return 0;
}
function valClaimCode() {
  validateCode(41,UpdateForm.urnumber,UpdateForm.claimc);
  for (var i =0 ; i < document.UpdateForm.otrfl041.length; i++) {
//    alert(UpdateForm.otrfl041.options[i].value.substr(0,3));
    if (document.UpdateForm.claimc.value==
        trim(document.UpdateForm.otrfl041.options[i].value.substr(0,3))){
          document.UpdateForm.otrfl041.selectedIndex=i;
    }
  }
}
function valClaimCode() {
  validateCode(41,UpdateForm.urnumber,UpdateForm.claimc);
  for (var i =0 ; i < document.UpdateForm.otrfl041.length; i++) {
    if (document.UpdateForm.claimc.value==
        trim(document.UpdateForm.otrfl041.options[i].value.substr(0,3))){
          document.UpdateForm.otrfl041.selectedIndex=i;
    }
  }
}
</script>
%START.OF.PAGE
<body onload="PageLoad(event);valClaimCode();">
<span class=DFrameTitleBar>
<img border=0 align=right src=../images/ExitIcon.gif onclick=DFrameExit()>
Add Referral
</span>
<div id=PageBodySection style="overflow: auto;">
<form name=UpdateForm action=outweb01.pbl method=post style="margin:0">
<input type=hidden name=reportno value=4>
<input type=hidden name=template value=001>
<input type=hidden name=urnumber value="%OUTWEB01.04.003">
<input type=hidden name=updttype value="A">
<input type=hidden name=nextpage value=5>
<input type=hidden name=defctype value="">
<input type=hidden name=deftclid value="">
<input type=hidden name=claimc value="">
<input type=hidden name=redirect value="">

<table border=0 width="100%" cellspacing="0" cellpadding="2">
<tr><td class=DataLabel>Date of Letter</td>
    <td><input name=otrfl001 type=text title="Date of Letter" size=12 
         value="%STANDARD.01.015" class="BackDate" >
        <img src=../images/DateTimeStamp.gif class="Icon"
         onclick="SetCurrentDateTime(UpdateForm.otrfl001,null);">
        <img src=../images/CalendarLookup.gif class="Icon"
         onclick="DateLookupFrame(UpdateForm.otrfl001);"></td></tr>

<tr><td class=DataLabel>Date Letter Received   </td>
    <td><input name=otrfl030 type=text title="Date of Received" size=12
         class="BackDate" >
        <img src=../images/DateTimeStamp.gif class="Icon"
         onclick="SetCurrentDateTime(UpdateForm.otrfl030,null);">
        <img src=../images/CalendarLookup.gif class="Icon"
         onclick="DateLookupFrame(UpdateForm.otrfl030);"></td></tr>

<tr><td class=DataLabel>Referral Source</td>
    <td><select name=otrfl028 tile="Referral Source">
        <option></option>
        %OUTWEB01.04.128.2
        </select></td></tr>

<tr><td class=DataLabel>Referring HCP</td>
    <td><input type=text name=otrfl002 size=12 maxlength=10
         onblur="ValidateHCP(18,0,UpdateForm.otrfl002,
                             UpdateForm.name_otrfl002);">
        <input type=text name=name_otrfl002 size=22 maxlength=30
         class=Readonly readonly>
     <img src="../images/SearchIcon.gif" class=Icon
     onclick="HCPSearchFrame(UpdateForm.otrfl002,UpdateForm.name_otrfl002,0);">
        <img src="../images/ViewIcon.gif" class=Icon 
         onclick="HCPViewFrame(UpdateForm.otrfl002.value);">
        <img src="../images/erase.gif" class=Icon
         onclick="clrDoc(UpdateForm.otrfl002,UpdateForm.name_otrfl002);"> 
     </td></tr>

<tr><td class=DataLabel>Preferred Site</td>
    <td class=DataField><select name=otrfl003 title="Preferred Site"
                         Onchange="SetList();">
                         <option></option>
              %OUTWEB01.04.103.2 </select></td></tr>

<tr><td class=DataLabel>Clinic Type</td>
    <td class=DataField><select name=otrfl027 title="Clinic Type"
                         onchange="SetList2();">
                        <option></option>
                        </select></td></tr>

<tr><td class=DataLabel>Clinic ID</td>
    <td class=DataField><select name=otrfl004 title="Clinic ID">
                        <option></option>
                        </select></td></tr>

<tr><td class=DataLabel>Reason for Referral</td>
    <td><select name=otrfl019 tile="Reason for Referral">
        <option></option>
<!--                           Cat."OF" Ind.1 = "R" for Reason for Referral -->
        %OUTWEB01.04.119.9.1.01.1.R
        </select></td></tr>

<tr><td class=DataLabel>Diagnosis/Problem</td>
    <td><input type=text name=otrfl006 size=50 maxlength="50" id="otrfl006"></td></tr>

<tr><td class=DataLabel>Priority</td> 
    <td><select name=otrfl007 class=select150 
         onchange="SetCurrentDateTime(UpdateForm.otrfl031,null);">
                         <option></option>
              %OUTWEB01.04.107.2 </select></td></tr>

<tr><td class=DataLabel>Date of Priority</td>
    <td><input name=otrfl031 type=text  size=12 title=Date class=BackDate
         onblur="checkDate(this,'Date of Priority')">
        <img src=../images/DateTimeStamp.gif class="Icon"
         onclick="SetCurrentDateTime(UpdateForm.otrfl031,null);">
        <img src=../images/CalendarLookup.gif class="Icon"
         onclick="DateLookupFrame(UpdateForm.otrfl031);"></td></tr>

<tr><td class=DataLabel>Prioritising HCP</td>
    <td><input type=text name=otrfl029 size=12 maxlength=10
         value=""
         onblur="ValidateHCP(18,14,UpdateForm.otrfl029,
                             UpdateForm.name_otrfl029);">
        <input type=text name=name_otrfl029 size=22 maxlength=30
         class=Readonly readonly value="">
     <img src="../images/SearchIcon.gif" class=Icon 
     onclick="HCPSearchFrame(UpdateForm.otrfl029,UpdateForm.name_otrfl029,1);">
        <img src="../images/ViewIcon.gif" class=Icon 
         onclick="HCPViewFrame(UpdateForm.otrfl029.value);">
        <img src="../images/erase.gif" class=Icon
         onclick="clrDoc(UpdateForm.otrfl029,UpdateForm.name_otrfl029);">
        </td></tr>

<tr><td class=DataLabel>Claim Code</td>
    <td><select name=otrfl041 class=select150 >
                         <option></option>
              %OUTWEB01.04.154.2 </select></td></tr>

<tr><td class=DataLabel>Expected Purchaser</td>
    <td><select name=otrfl032 tile="Expected Purchaser">
        <option></option>
        %OUTWEB01.04.132.2
        </select></td></tr>

<tr><td class=DataLabel>Maintain Episodes of Care</td>
    <td><input type=checkbox name=chkbxeoc value=1></td></tr>

<tr><td colspan=2 align=center>
    <input class="button"  type="button" value="Ok" onclick="AddReferral();">
    <input class="button"  type="button" value="Cancel"
     onclick="DFrameExit();"></td></tr>
</table>
</form>
</div>

<form name=PatientLinks method=get style="margin:0">
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=urnumber value="%OUTWEB01.04.003">
<input type=hidden name=admissno value="%OUTWEB01.04.081">
<input type=hidden name=MenuType value="%OUTWEB01.04.088">
</form>
<script type="text/javascript">
 UserSite="%STANDARD.01.023";
 for (var i =0 ; i < document.UpdateForm.otrfl003.length; i++) {
  if (document.UpdateForm.otrfl003.options[i].value==UserSite.substr(0,6)) {
       document.UpdateForm.otrfl003.selectedIndex=i } };
  SetList();
</script>

<meta name="TemplateVersion" content="V12.00.00">
<meta name="TemplateHome" content="nz">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript">
function UpdateNurse() {
 if(!isWhitespace(parent.document.UpdateForm.username.value)) {
 getUserIDForLoginName(parent.document.UpdateForm.username,UpdateForm.webuseid);
 }
 if(isWhitespace(document.UpdateForm.reasonfc.value)) { 
   alert("Reason for Change is a required field.\nPlease enter it now." );
   return;
 }
  document.UpdateForm.submit();
}

function DeleteNurse() {
  if (isWhitespace(document.UpdateForm.reasonfc.value)) {
    alert("Reason for Change is a required field.\nPlease enter it now." );
    return;
  }
  nurse="      ";
  admissno=document.UpdateForm.admissno.value;
  user=document.PatientLinks.webuseid.value;
  reason=document.UpdateForm.reasonfc.value;

  var serverURL   = "../cgi-bin/emrweb08.pbl?reportno=4" +
                    "&admissno=" + admissno.replace(/ /g,"+") +
                    "&webuseid=" + user.replace(/ /g,"+") +
                    "&doctcode=" + nurse.replace(/ /g,"+") +
                    "&updttype=ALNUR" +
                    "&suprvisr=" + "1" +
                    "&reasonfc=" + reason.replace(/ /g,"+");
  var returnValue = RSExecute(serverURL);
  DFrameExitRefresh();
  parent.top.content.location.reload();
}

function DelLastNurse() {
  if (isWhitespace(document.LastNurse.reasonfc.value)) {
    alert("Reason for Change is a required field.\nPlease enter it now." );
    return;
  }
  if (isWhitespace(document.LastNurse.d_seendate.value)) { 
    alert("Invalid deletion - No nurse allocated to patient");
    return;
  }
  if (!confirm("Are you sure you want to delete this nurse?" +
            "\nOk to continue, Cancel to Abort")) {
   return;
  }
  nurse="      ";
  admissno=document.PatientLinks.admissno.value;
  user=document.PatientLinks.webuseid.value;
  reason=document.LastNurse.reasonfc.value;

  var serverURL   = "../cgi-bin/emrweb08.pbl?reportno=4" +
                    "&admissno=" + admissno.replace(/ /g,"+") +
                    "&webuseid=" + user.replace(/ /g,"+") +
                    "&doctcode=" + nurse.replace(/ /g,"+") +
                    "&updttype=ALNUR&deltlast=1" +
                    "&reasonfc=" + reason.replace(/ /g,"+");
  var returnValue = RSExecute(serverURL);
  DFrameExitRefresh();
  parent.top.content.location.reload();
}

function nurseName(nurse){
  if (isWhitespace(nurse.value)) { return;;}
  var serverURL   = "../cgi-bin/patweb80.pbl?reportno=17" +
                    "&valdcode=" + nurse.value.replace(/ /g,"+")
  var returnValue = RSExecute(serverURL);
  if (returnValue.status!=0) {
    UpdateForm.frstnurs.value="";
    UpdateForm.frstnurs.focus();
    return;
  }
  else {
    ReturnValue=returnValue.return_value.split("|");
    UpdateForm.dummy3.value=trim(ReturnValue[1]) + " " + trim(ReturnValue[0]);
  }
}
</script>
</head>
%START.OF.PAGE
<body onload=PageLoad(event);>
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon"
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Change Nurse Seen Date/Time
</span>

<form name="UpdateForm" action="emrweb02.pbl" method="post">
<input type=hidden name="reportno" value="15">
<input type=hidden name="template" value="112">
<input type=hidden name="admissno" value="%EMRWEB02.01.081">
<input type=hidden name="urnumber" value="%EMRWEB02.01.003">
<input type=hidden name=webuseid value="">
<input type=hidden name=calcwait value="">
<input type=hidden name="updttype" value="ERROR">
<table width="95%" align=center border="0" cellspacing="0">

<tr><td class=DataLabel>First Nurse Seen</td>
    <td class=DataLabel>
    <input type=text size=6 name=frstnurs title="First Nurse Seen"
     value="%EMRWEB02.01.496.0"
     onblur="UpCase(this);nurseName(UpdateForm.frstnurs);">
    <input type=text size=30 name=dummy3 title="Nurse Name"
     readonly class=Readonly value="%EMRWEB02.01.496.1">
    <img class=Icon src="../images/SearchIcon.gif"
     onclick="NurseSearchFrame(UpdateForm.frstnurs,UpdateForm.dummy3)">
    <img class=Icon src="../images/erase.gif"
     onclick="clrFields(UpdateForm.frstnurs,UpdateForm.dummy3);">
    </td></tr>

<tr><td class=DataLabel>Nurse Seen Date </td>
    <td class=DataLabel><input type="text" name=nursdate id="nursdate" size="11"
                         value="%EMRWEB02.01.128.0" title="Nurse Seen Date">
     <img class=Icon src=../images/DateLookup.gif date=document.UpdateForm.nursdate>
        Time
        <input type="text" name=nurstime id="nurstime" size="8" value="%EMRWEB02.01.129"
          onblur="checkTime(this,'Nurse Seen Time')">
        <img class=Icon src=../images/TimeLookup.gif
     onclick="TimeLookupFrame(UpdateForm.nurstime);">
        <img class=Icon src="../images/stopwat1.gif"
      onclick="SetCurrentDateTime(UpdateForm.nursdate,UpdateForm.nurstime);">
    </td></tr>

<tr><td class=DataLabel>Reason for Change</td>
    <td><select name=reasonfc title="Reason for Change" class="Mandatory">
         <option></option>
         %STANDARD.01.007.FW
        </select></td></tr>
</table>

<table width="95%" align=center border="0" cellspacing="0">
<tr><td align=center> 
    <input type="button" value="Change" class="button" id="emr02ch"
     onclick="tempDisable(this);UpdateNurse();">
    <input type="button" value="Delete" class="button" id="emr02del"
     onclick="tempDisable(this);DeleteNurse();">
    <input type="button" value="Cancel" class="button" 
     onclick="DFrameClose();">
    </td></tr>

<tr><td align=center colspan=2><hr>
    </td></tr> 
</table>
</form>

<form name="LastNurse" action="emrweb02.pbl" method="post">
<input type=hidden name="reportno" value="15">
<input type=hidden name="template" value="112">
<input type=hidden name="admissno" value="%EMRWEB02.01.081">
<input type=hidden name="urnumber" value="%EMRWEB02.01.003">
<input type=hidden name="d_seendate" value="%EMRWEB02.01.128.0">

<table width="95%" align=center border="0" cellspacing="0">
<tr>
  <td class=DataLabel width=25%>Last Nurse Seen</td>
  <td>
    <input type=text size=25 title="Nurse Name"
     readonly class=Readonly value="%EMRWEB02.01.557.1">
  </td>
</tr>
<tr>
  <td class=DataLabel width=25%>Reason for Change</td>
  <td>
    <select name=reasonfc title="Reason for Change" class="Mandatory">
      <option></option>
      %STANDARD.01.007.FW
    </select>
  </td>
</tr>
<tr>
  <td align=center colspan=2><br>
    <input type="button" value="Delete Last Nurse Allocated" id="emr02delt"
     class="ExtraBigbutton" onclick="tempDisable(this);DelLastNurse();">
  </td>
</tr>
</table>
</form>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=regexstm value=102>
<input type=hidden name=newstand value=1>
<input type=hidden name=urnumber value="%EMRWEB02.01.003">
<input type=hidden name=admissno value="%EMRWEB02.01.081">
<input type=hidden name=MenuType value="%EMRWEB02.01.088">
<input type=hidden name=webuseid value="%STANDARD.01.008">
</form>

<script type="text/javascript">
 Discharged="%EMRWEB02.01.147";
 if(Discharged==2 || Discharged==3){
   document.UpdateForm.calcwait.value="1";
 }
</script>

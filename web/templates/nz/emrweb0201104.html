<meta name="TemplateVersion" content="V12.00.00">
<meta name="TemplateHome" content="nz">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript">
function init() {
PageLocation="?reportno=1&template=4" +
               "&urnumber=" + PatientURN.replace(/ /g,"+") +
               "&admissno=" + PatientVIS.replace(/ /g,"+")
  if(top.content.location.search.substring(1,23)!="reportno=1&template=16"&&
     top.content.location.search.substring(1,23)!="reportno=1&template=17"){
    if (top.content.location.search!=this.location.search) {
      if (top.content.location.search!=PageLocation) {
      top.content.location.href="emrweb02.pbl" + PageLocation } }
  }
}
function validateNurse() {
  validateCode('17',document.UpdateForm.emvis127,
                    document.UpdateForm.dummy1,
                    document.UpdateForm.gnm,
                    SetNurseName);
}
function SetNurseName() {
UpdateForm.dummy1.value=UpdateForm.gnm.value.replace(/\s*$/g,"")+
                              " " +
                            UpdateForm.dummy1.value.replace(/\s*$/g,"");
}

function setRedirect() {
 document.UpdateForm.redirect.value="emrweb02.pbl?reportno=1&template=104";
}
function changeUndischarge() {
  var validateresult = validateMandatory(document.UpdateForm);
    if (validateresult==true) {
  PatientLinks.reportno.value="01";
  PatientLinks.template.value="108";
  PatientLinks.action="emrweb02.pbl";
  Left=(document.body.clientWidth-600)/2;
  DFrameSubmit(PatientLinks,100,Left,600,300);
  }
}
function changeNurDateTime() {
  var validateresult = validateMandatory(document.UpdateForm);
    if (validateresult==true) {
  PatientLinks.reportno.value="01";
  PatientLinks.template.value="112";
  PatientLinks.action="emrweb02.pbl";
  Left=(document.body.clientWidth-600)/2;
  DFrameSubmit(PatientLinks,100,Left,600,300);
  }
}
function linkAdmission() {
  var validateresult = validateMandatory(document.UpdateForm);
    if (validateresult==true) {
  PatientLinks.reportno.value="01";
  PatientLinks.template.value="114";
  PatientLinks.action="emrweb02.pbl";
  Left=(document.body.clientWidth-750)/2;
  DFrameSubmit(PatientLinks,50,Left,750,500);
  }
}
function changeDocDateTime() {
  var validateresult = validateMandatory(document.UpdateForm);
    if (validateresult==true) {
  PatientLinks.reportno.value="01";
  PatientLinks.template.value="111";
  PatientLinks.action="emrweb02.pbl";
  Left=(document.body.clientWidth-600)/2;
  DFrameSubmit(PatientLinks,100,Left,600,300);
  }
}
function setUndischarge() {
    if(!isWhitespace(document.UpdateForm.username.value)) {
      getUserIDForLoginName(UpdateForm.username,UpdateForm.webuseid);
    }
    var validateresult = validateMandatory(document.UpdateForm);
    if (validateresult==true) {
      document.UpdateForm.nextpage.value="1";
      document.UpdateForm.formactn.value="U ";
      document.UpdateForm.updttype.value="UNDIS";
      DFrameHide(UpdateForm);
   }
}
function PostDischarge() {
  document.UpdateForm.redirect.value="emrweb02.pbl?reportno=1&template=104"
  document.UpdateForm.nextpage.value="8";
  document.UpdateForm.suprflag.value="Y";
  document.UpdateForm.formactn.value="D ";
  document.UpdateForm.updttype.value="DISCH";
  var validateresult = validateMandatory(document.UpdateForm);
  if (validateresult==true) {
    SubmitHidden(UpdateForm);
  }
}
function deleteEvent() {
  var validateresult = validateMandatory(document.UpdateForm);
    if (validateresult==true) {
  linkurl="emrweb02.pbl?reportno=1&template=103" +
      "&urnumber=" + document.UpdateForm.urnumber.value +
      "&admissno=" + document.UpdateForm.admissno.value;
  Left=(document.body.clientWidth-420)/2;
  DFrameLink(linkurl,0,Left,420,130);
 }
}
function SyncDates(){
  document.UpdateForm.emvis001.value=document.UpdateForm.emvis128.value;
  document.UpdateForm.emvis002.value=document.UpdateForm.emvis129.value;
  return; 
}
function setFormactn(type) {
    p=document.UpdateForm;
    p.updfield.value=type;
    p.reasonfc.value=document.getElementById('reason'+type).value;
    document.getElementById('reason'+type).className='Mandatory';

    if (type=='01') {
      document.getElementById('emvis001').className='Mandatory';
      document.getElementById('emvis002').className='Mandatory';
    }

    if (type=='02') {
      document.getElementById('emvis128').className='Mandatory';
      document.getElementById('emvis129').className='Mandatory';
    }

    setRedirect();
    document.UpdateForm.nextpage.value="1";
    document.UpdateForm.formactn.value="C1";
    document.UpdateForm.updttype.value="ERROR";
    if(!isWhitespace(document.UpdateForm.username.value)) {
      getUserIDForLoginName(UpdateForm.username,UpdateForm.webuseid);
    }
    var validateresult = validateMandatory(document.UpdateForm);
    if (validateresult==true) {
       if (type=='02') {
        if(valTriageADis(document.UpdateForm.emvis128,
            document.UpdateForm.emvis129)==false){ return; }
        if(validateTriageDateTime(document.UpdateForm.emvis128,document.UpdateForm.emvis129)==false){ return; }
       }
       SubmitHidden(UpdateForm);
    }
}
function changePatient() {
   PMenuLinkTo('../cgi-bin/emrweb02.pbl|01|008|1|400|150');
}
function changeClinical() {
      var validateresult = validateMandatory(document.UpdateForm);
      if (validateresult==true) {
         PMenuLinkTo('../cgi-bin/emrweb02.pbl|01|110|0|0|0');
      }
}
function changeDischarge() {
    document.UpdateForm.template.value="109";
    document.UpdateForm.reportno.value="1";
    document.UpdateForm.nextpage.value="1";
    document.UpdateForm.formactn.value="";
    document.UpdateForm.updttype.value="";
    var validateresult = validateMandatory(document.UpdateForm);
    if (validateresult==true) {
       document.UpdateForm.submit();
    }
}
function changeInjury() {
  var validateresult = validateMandatory(document.UpdateForm);
    if (validateresult==true) {
  PatientLinks.reportno.value="01";
  PatientLinks.template.value="072";
  PatientLinks.action="emrweb02.pbl";
  Left=(document.body.clientWidth-600)/2;
  DFrameSubmit(PatientLinks,100,Left,600,300);
  }
}
function changeUR() {
  var validateresult = validateMandatory(document.UpdateForm);
    if (validateresult==true) {
  PatientLinks.action="patweb98.pbl";
  PatientLinks.reportno.value="01";
  PatientLinks.template.value="066";
  Left=(document.body.clientWidth-600)/2;
  DFrameSubmit(PatientLinks,100,Left,600,300);
  }
}
function AccessAll() {
  if(!isWhitespace(document.UpdateForm.accessal.value)) {
    document.UpdateForm.username.value=document.UpdateForm.accessal.value;
    document.UpdateForm.username.className="Readonly";
    document.UpdateForm.username.readOnly=true; 
    document.UpdateForm.password.className="Readonly";
    document.UpdateForm.password.readOnly=true;
  } 
}
function changeClaim() {
  var validateresult = validateMandatory(document.UpdateForm);
    if (validateresult==true) {
  PatientLinks.reportno.value="01";
  PatientLinks.template.value="116";
  PatientLinks.action="emrweb02.pbl";
  Left=(document.body.clientWidth-600)/2;
  DFrameSubmit(PatientLinks,100,Left,600,300);
  }                 
}                   
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);AccessAll();self.focus();
 UpdateForm.emvis001.focus();">
<div id=PatientHeading></div>
<div id=PageBodySection>
<script type="text/javascript">
PatientURN="%EMRWEB02.01.003";
PatientVIS="%EMRWEB02.01.081";
PatientNAM="%EMRWEB02.01.002";
PatientSTA="%EMRWEB02.01.086.078";
PatientALT="%EMRWEB02.01.084";
PatientSEX="%EMRWEB02.01.019";
PatientDOB="%EMRWEB02.01.020";
PatientAGE="%EMRWEB02.01.021";
PatientLOC="%EMRWEB02.01.083";
PatientPRI="%EMRWEB02.01.086.066.1";
PatientUNT="%EMRWEB02.01.066.0";
PatientIND="%EMRWEB02.01.086.091";
GpCOD="%EMRWEB02.01.086.084.001";
GpNAM="%EMRWEB02.01.086.084.081";
GpPRAC="%EMRWEB02.01.086.085.001";
GpPRACCNT="%EMRWEB02.01.086.085.002";
GpPRACNAM="%EMRWEB02.01.086.085.005";
PatientARR="%EMRWEB02.01.101.0 %EMRWEB02.01.102";
PatientSEE="%EMRWEB02.01.130.0 %EMRWEB02.01.131";
PatientTRI="%EMRWEB02.01.103.3";
PatientECLC="%EMRWEB02.01.484.1";
PatientCLH="%STANDARD.01.017.CL";
PatientEHFT="%EMRWEB02.01.485";
InsertEmergencyHeader()
</script>
<div id=PatientMenu></div>

<form name=UpdateForm action="emrweb02.pbl" method=post>
 <input type=hidden name=reportno value="01">
 <input type=hidden name=updfield value="">
 <input type=hidden name=reasonfc value="">
 <input type=hidden name=resavail value="%EMRWEB02.01.168">
 <input type=hidden name=template value="001">
 <input type=hidden name=admissno value="%EMRWEB02.01.081">
 <input type=hidden name=urnumber value="%EMRWEB02.01.003">
 <input type=hidden name=emvis118 value="%EMRWEB02.01.003">
 <input type=hidden name=formactn>
 <input type=hidden name=redirect>
 <input type=hidden name=updateky value="%EMRWEB02.01.404">
 <input type=hidden name=updttype>
 <input type=hidden name=pmpxi067 value="%EMRWEB02.01.667.0">
 <input type=hidden name=nextpage>
 <input type=hidden name=suprflag>
 <input type=hidden name=emvis058>
 <input type=hidden name=emvis147>
 <input type=hidden name=newloctn>
 <input type=hidden name=webuseid value="">
 <input type=hidden name=calcwait value="">
 <input type=hidden name=accessal value="%EMRWEB02.01.487">
 <input type=hidden name=dischargeDate id=dischargeDate
        value="%EMRWEB02.01.124.0 %EMRWEB02.01.125">
<table width=100% border=1 cellspacing=0 cellpadding=0>
<tr valign=top><td>
<table width=100% border=0 cellspacing=0 cellpadding=2>
    <tr><td class=DataLabel>Arrival Date </td>
    <td class=DataLabel><input type="text" name=emvis001 id="emvis001" size="12" 
        onblur="checkDate(UpdateForm.emvis001,'Arrival Date');"
                         value="%EMRWEB02.01.101.0" title="Arrival Date">
     <img class=Icon src=../images/DateLookup.gif 
      date=document.UpdateForm.emvis001>

        Time
        <input type="text" name=emvis002 id="emvis002" size="8" 
         value="%EMRWEB02.01.102"
               onblur="checkTime(this,'Arrival Time')" title="Arrival Time">
         <img class=Icon src=../images/TimeLookup.gif
     onclick="TimeLookupFrame(UpdateForm.emvis002);">
        <img class=Icon src="../images/stopwat1.gif"
      onclick="SetCurrentDateTime(UpdateForm.emvis001,UpdateForm.emvis002);">
     </td>
     <td>Reason for Change</td>
     <td><select name=reason01 title="Arrival Date Reason for Change"
          id=reason01>
         <option></option>
         %STANDARD.01.007.FW
        </select></td>
     <td><input type=button class="button" value="Update" 
       onclick="setFormactn('01');">
    </td></tr>

    <tr><td class=DataLabel>Triage Date </td>
        <td class=DataLabel>
        <input type="text" name=emvis128 id="emvis128" size="12"
         value="%EMRWEB02.01.162.0"
         onblur="checkDate(UpdateForm.emvis128,'Triage Date');" 
         title="Triage Date">
        <img src=../images/DateLookup.gif class=Icon 
         date=document.UpdateForm.emvis128>

        Time
        <input type="text" name=emvis129 id="emvis129" size="8" 
         value="%EMRWEB02.01.163"
         onblur="checkTime(UpdateForm.emvis129,'Triage Time');"
         title="Triage Time">
        <img class=Icon src=../images/TimeLookup.gif
         onclick="TimeLookupFrame(UpdateForm.emvis129);">
        <img class=Icon src="../images/stopwat1.gif"
         onclick="SetCurrentDateTime(UpdateForm.emvis128,UpdateForm.emvis129);">
     </td>
     <td>Reason for Change</td>
     <td><select name=reason02 title="Triage Date Reason for Change"
          id=reason02>
         <option></option>
         %STANDARD.01.007.FW
        </select></td>
     <td><input type=button class="button" value="Update" 
       onclick="setFormactn('02');">

        </td></tr>

    <tr><td class=DataLabel>Triage Category
     <td><table border=0 cellspacing=0>
     <tr>
     <td class=Triage1><i>1</i><input type=radio name=emvis003 value=1></td>
     <td class=Triage2><i>2</i><input type=radio name=emvis003 value=2></td>
     <td class=Triage3><i>3</i><input type=radio name=emvis003 value=3></td>
     <td class=Triage4><i>4</i><input type=radio name=emvis003 value=4></td>
     <td class=Triage5><i>5</i><input type=radio name=emvis003 value=5></td>
     </tr></table></td>
     <td>Reason for Change</td>
     <td><select name=reason03 title="Triage Category Reason for Change"
          id=reason03>
         <option></option>
         %STANDARD.01.007.FW
        </select></td>
     <td><input type=button class="button" value="Update" 
       onclick="setFormactn('03');">
     </td>
     </td></tr>

<tr><td class=DataLabel>Triage Nurse </td>
    <td><input type=hidden name=gnm>
        <input type="text" name=emvis127 size=6 class=Readonly readonly
         onblur="UpCase(this);validateNurse(UpdateForm.emvis127,UpdateForm.dummy1);"
         id=emvis127 title="Triage Nurse" value="%EMRWEB02.01.161.1">
        <input type="text" name=dummy1 size=20 class=Readonly readonly
         tabindex=-1 value="%EMRWEB02.01.161.0">
        <img class=Icon src=../images/SearchIcon.gif name=nursebut
         onclick='NurseSearchFrame(UpdateForm.emvis127,UpdateForm.dummy1);'>
     <td>Reason for Change</td>
     <td><select name=reason08 title="Triage Nurse Reason for Change"
          id=reason08>
         <option></option>
         %STANDARD.01.007.FW
        </select></td>
     <td><input type=button class="button" value="Update" 
       onclick="setFormactn('08');">
    </td></tr>

    <tr><td class=DataLabel>Username</td>
      <td class=DataLabel> 
          <input size=12 type=text name=username class=Mandatory
           title="Username" onfocus="SetCaretPosition('username',-1);">
          Password
          <input size=12 type=password name=password onblur="checkPass();"
           class=Mandatory title="Password"
           onfocus="SetCaretPosition('password',-1);"></td></tr>

    <tr>
      <td colspan=5 align=center>
        <input type=button class="BigButton" value="Delete" 
         onclick="deleteEvent();">
        <input type=button class="BigButton" 
         value="Undischarge" onclick="changeUndischarge();">
        <input type=button class="BigButton" 
         value="Change Patient" onclick="changePatient();">
        <input type=button class="BigButton" 
         value="Clinical Screen" onclick="changeClinical();">
        <input type=button class="BigButton" 
         value="Doctor date/time" onclick="changeDocDateTime();">
        <input type=button class="BigButton" 
         value="Nurse date/time" onclick="changeNurDateTime();">
        <input type=button class="BigButton" 
         value="Update Discharge" onclick="changeDischarge();">
        <input type=button class="BigButton" name=injbuttn
         value="Injury Data" onclick="changeInjury();">
        <input type=button class="BigButton" 
         value="Change U/R" onclick="changeUR();">
        <input type=button class="BigButton" 
         value="Link Admission" onclick="linkAdmission();">
      </td>
    </tr>
    </table>
</td></tr>
</table>
</form>
<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=regexstm value=102>
<input type=hidden name=newstand value=1>
<input type=hidden name=urnumber value="%EMRWEB02.01.003">
<input type=hidden name=admissno value="%EMRWEB02.01.081">
<input type=hidden name=MenuType value="%EMRWEB02.01.088">
</form>
<script type="text/javascript">
 var RadioIndex=%EMRWEB02.01.103.1 - 1           // Starts at 0 so sub 1
 if(RadioIndex!=-1) {
 document.UpdateForm.emvis003[RadioIndex].checked=1 // Set Current Checked Value
 document.UpdateForm.nursebut.disabled=false;
 document.UpdateForm.emvis127.readOnly=false;
 document.UpdateForm.emvis127.className="Mandatory"
 } 
 CTypeAdm="%EMRWEB02.01.252";
 if ( CTypeAdm == "Yes") {
   document.UpdateForm.emvis147.value=1; }
 else { 
   document.UpdateForm.emvis147.value=0; }
//
 Discharged="%EMRWEB02.01.147";
 if(Discharged==2 || Discharged==3){
   document.UpdateForm.calcwait.value="1";
 }
 if(Discharged=="4") {
   alert("Warning: This visit is cancelled");
 }
 InjData="%EMRWEB02.01.188";
 if ( InjData =="1" ) {
    document.UpdateForm.injbuttn.className="BigRedButton";
 }

function validateTriageDateTime(triagedate,triagetime){
  var firstDocDateTime= PatientSEE;
  var warmessage="Triage Date/Time will be after the First Clinician Seen " +
                 "Date/Time.\nPlease OK to continue or Cancel to return.";
  
  var triageDate=triagedate.value;
  if (isWhitespace(triageDate))
  { return true;}
  var triage_Date=new Date(triageDate);   //Triage date object


  var triageTime=triagetime.value;
  
  //Check for Against the First Doctor Seen Time
  if(!isEmpty(firstDocDateTime)){
      first_DocDD=new Date(firstDocDateTime);

           //compare date
           if(triage_Date>first_DocDD){
             if(confirm(warmessage)==true){
                  return;
             }
             else{
                 triagedate.focus();
                 return false;
             }
           }

           //check for time
             if (!isWhitespace(triageTime))
             {
               if((triage_Date.getFullYear()==first_DocDD.getFullYear())&&
                  (triage_Date.getMonth()==first_DocDD.getMonth())&&
                  (triage_Date.getDate()==first_DocDD.getDate())
               ){
                   triageDT=new Date(triageDate +" "+triageTime); //Triage time
                   if(triageDT>first_DocDD){ 
                     if(confirm(warmessage)==true){
                       return;
                     }
                     else{
                       triagedate.focus();
                       return false;
                     }  
                   }
                }
             }

  }
}

function valTriageADis(triagedate,triagetime){
  //Check Against the Discharge Time
  var dischargeDate=document.getElementById('dischargeDate').value;
  if (isWhitespace(dischargeDate)){ return; }
  var discharge_Date  = new Date(dischargeDate); //Discharge date Object
  var errMessage="Triage Date/Time cannot be after Discharge Date/Time.";

  var triageDate=triagedate.value;
  if (isWhitespace(triageDate))
  { return true;}
  var triage_Date=new Date(triageDate);   //Triage date object
  var triageTime=triagetime.value;

  //compare date
   if(triage_Date>discharge_Date){
    alert(errMessage);
    triagedate.focus();
    return false;
   }
  //Compare Time
   if (!isWhitespace(triageTime)){
     if((triage_Date.getFullYear()==discharge_Date.getFullYear())&&
                  (triage_Date.getMonth()==discharge_Date.getMonth())&&
                  (triage_Date.getDate()==discharge_Date.getDate())
               ){
       triageDT=new Date(triageDate +" "+triageTime); //Triage time
       if(triageDT>discharge_Date){
         alert(errMessage);
         triagedate.focus();
         return false;
       }
     }
   }
} 
</script>

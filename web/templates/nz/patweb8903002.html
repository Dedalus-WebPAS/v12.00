<meta name="TemplateVersion" content="V12.00.00">
<meta name="TemplateHome"    content="nz">
<meta name="HelpFileName"    content="NoContextSet.html">
<meta name="CrossBrowser"    content="true">
<script type="text/javascript" src="../js/preadmission.js"></script>
<script type="text/javascript" src="../js/CaseTeamSelect.js"></script>
<script type="text/javascript">    

function SetWardBed() {
 if(document.UpdateForm.admitbox.checked == true) {
     document.UpdateForm.admitbox.value="1";
  } else {
     document.UpdateForm.admitbox.value="0";
  }
}
function SubmitAdm() {
  p=document.UpdateForm
  if(!checkSiteOpBooking(p.urnumber,p.ptmis001)) {
    return;
  }
  MandatoryOk=validateMandatory(document.UpdateForm);
  if (MandatoryOk) {
    SetRedirect();
    UpdateForm.ptmis004.value=UpdateForm.ptmis068.value;
    UpdateForm.ptmis005.value=UpdateForm.ptmis076.value;
    SetLinkACC(UpdateForm,"MEH");
    SubmitHidden(UpdateForm);
    }
}
function SetRedirect(){

    SetWardBed();
    if(document.UpdateForm.admitbox.value=="1") {
     document.UpdateForm.redirect.value="patweb98.pbl?reportno=01&template=043"
     + "&urnumber=" + document.UpdateForm.urnumber.value
     + "&admissno=";
    } else {
     document.UpdateForm.redirect.value="patweb98.pbl?reportno=01&template=001"
     + "&urnumber=" + document.UpdateForm.urnumber.value
     + "&admissno=";
    }

}
function displayDivMH(OptionType,Field)
{
  if (Field == "PT") {
  if (OptionType.value.substr(6,1) == "B") {
    document.UpdateForm.ptmis041.className="Mandatory";
  }else{
    document.UpdateForm.ptmis041.className="";
  }
  displayDiv(OptionType,Field);
 }
}
function validateCodeOnChange(num,trnsfsrc,trndesc,ptmis009)
{
  if(validateCode(num,trnsfsrc,trndesc))
  {
   validateTransSrcWithRef(trnsfsrc,ptmis009,trndesc);
  }
}
function ValCaseTeam(CaseTeamFld, CaseTeamDesc) {
  if (validateCode2(7,CaseTeamFld, CaseTeamDesc)) {
    var p = document.UpdateForm;
    getHCPbyCaseTeam(p.pmsvx146,p.ptmis007,p.doctnam2,p.ptmis001);
    if (!ValCaseTeamMember()) {
      CaseTeamFld.value = "";
      CaseTeamDesc.value = "";
      CaseTeamFld.focus();
    }
  }
}
function ValCaseTeamMember() {
  if (!isWhitespace(document.UpdateForm.ptmis001.value)&&
      !isWhitespace(document.UpdateForm.ptmis007.value)&&
      !isWhitespace(document.UpdateForm.pmsvx146.value)) {
    var serverURL = "../cgi-bin/allweb01.pbl?reportno=8&functype=7"+
          "&valddate=" + document.UpdateForm.ptmis001.value.replace(/ /g,"+")+
          "&valdhcpc=" + document.UpdateForm.ptmis007.value.replace(/ /g,"+")+
          "&valdteam=" + document.UpdateForm.pmsvx146.value.replace(/ /g,"+")+
          "&valdmode=1";
    var returnValue = RSExecute(serverURL);
    if (returnValue.status != 0) {
      return false;
    }
  }
  return true;
}
</script>
%START.OF.PAGE
<body onload="PageLoad(event);createSpecialtyArray();
              getHCPSpecialtySelectList();showACC();FilterMentalHealth(1);"> 
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%PATWEB89.03.003";
PatientVIS="%PATWEB89.03.081";
PatientNAM="%PATWEB89.03.002";
PatientSTA="%PATWEB89.03.086.078";
PatientALT="%PATWEB89.03.084";
PatientSEX="%PATWEB89.03.019";
PatientDOB="%PATWEB89.03.020";
PatientAGE="%PATWEB89.03.021";
PatientLOC="%PATWEB89.03.083";
PatientPRI="%PATWEB89.03.086.066.1";
PatientUNT="%PATWEB89.03.066.0";
DoctorCOD="%PATWEB89.03.082.003";
DoctorNAM="%PATWEB89.03.082.002";
PatientAID="%PATWEB89.03.086.090";
PatientIND="%PATWEB89.03.086.091";
PatientCUR="%PATWEB89.03.086.092";
PatientCLC="%PATWEB89.03.086.093.1";
PatientCLH="%STANDARD.01.017.CL";
PatientHFT="%PATWEB89.03.086.094";
PatientCDM="%PATWEB89.03.086.095";
PatientVDH="%PATWEB89.03.086.099.015";
InsertPatientHeader()
</script>
<div id=PatientMenu></div>
<div id=PageBodySection>

<form name=UpdateForm id=UpdateForm method=post>
<input type=hidden name=urnumber id=urnumber value="%PATWEB89.03.003">
<input type=hidden name=admissno id=admissno value="%PATWEB89.03.101">
<input type=hidden name="mhadmflg" id="mhadmflg" value="1">
<input type=hidden name="updatety" id="updatety" value="1">
<input type=hidden name="reportno" id="reportno" value="2">
<input type=hidden name="redirect" id="redirect">
<input type=hidden name="allocate" id="allocate" value="1">
<input type=hidden name="chckname" id="chckname" value="0">
<input type=hidden name="emradmit" id="emradmit" value="0">
<input type=hidden name="emradmis" id="emradmis" value="0">
<input type=hidden name="newbmand" id="newbmand" value="0">
<input type=hidden name="agebmand" id="agebmand" value="0">
<input type=hidden name="ptcnueoc" id="ptcnueoc" value="%PATWEB89.03.925">
<input type=hidden name="exstward" id="exstward" value="%PATWEB89.03.449.1">
<input type=hidden name="ptcnhpcd" id="ptcnhpcd" value="%PATWEB89.03.930">
<input type=hidden name="ptcnbage" id="ptcnbage" value="%STANDARD.01.025.021.046.1.3">
<input type=hidden name="pbdate" id="pbdate"   value="%PATWEB89.03.020">
<input type=hidden name="ibcnmhos" id="ibcnmhos" value="%STANDARD.01.025.000.043.1.1">
<input type=hidden name=residadm id=residadm value="%PATWEB89.03.959">
<input type=hidden name=refvisno id=refvisno value="%PATWEB89.03.960">
<input type=hidden name="refrdate" id="refrdate" value="%PATWEB89.03.999.101">
<input type=hidden name=ptvis029 id=ptvis029 value="">
<input type=hidden name=ptvis030 id=ptvis030 value="">
<input type=hidden name=genpprov id=genpprov>
<input type=hidden name=dummy1 id=dummy1 value="">
<input type=hidden name=admiscat id=admiscat value="A ">
<input type=hidden name=bedstat1 id=bedstat1>
<input type=hidden name=ptmis004 id=ptmis004>
<input type=hidden name=ptmis005 id=ptmis005>
<input type=hidden name=warddesc id=warddesc>
<input type=hidden name="ptmis030" id="ptmis030" value="">
<input type=hidden name=userdef5 id=userdef5 value="U5">

<table border=0 width=100% cellspacing=1 cellpadding=1>
<tr><td class=HeadingCell align=center colspan=2>
    Mental Health Pre-Admission Details (New) </td>
</tr>

<tr><td>
    <table width=100% border=0 class=TableBody cellpadding=2 cellspacing=2>
    <tr><td width=50%>

      <table width=100% border=0 class=TableBody cellpadding=1 cellspacing=0>
      <tr><td class=DataLabel>Admission Date </td>
          <td><input type=text size=12 name=ptmis001 id=ptmis001 tabindex=1
               class=Mandatory title="Admission Date" value="%STANDARD.01.015" 
      onblur="checkDate(this,'AdmissionDate');ShowAdmissionWeight(UpdateForm);
              getHCPSpecialtySelectList();">
         <img notab src="../images/CalendarLookup.gif" class=Icon
          onclick="DateLookupFrame(ptmis001);">     
          Time <input type=text name=ptmis002 id=ptmis002 size=8 tabindex=2 
                value="%STANDARD.01.016" class="Mandatory" 
               title="Admission Time" onblur="checkTime(this,'AdmissionTime');">
        <img notab src="../images/DateTimeStamp.gif" class=Icon
         onclick="SetCurrentDateTime(null,ptmis002);">
       <img notab src="../images/TimeLookup.gif" class=Icon
        onclick="TimeLookupFrame(ptmis002);">
          </td></tr>
     <tr><td class=DataLabel>%STANDARD.01.017.P </td>
      <td><select name=ptmis011 id=ptmis011 tabindex=3 class=Mandatory
                  title="%STANDARD.01.017.P " 
                  onchange="displayDivMH(ptmis011,'PT');">
              <option> </option>
               %PATWEB89.03.112.2
              </select></td></tr>

      <tr><td class=DataLabel>Referral Source</td>
          <td><select name=ptmis009 id=ptmis009 tabindex=4 onchange="DisplayTrnSrc();"
                 onblur="validateCodeOnChange(9,trnsfsrc,trandesc,ptmis009);"
               class="Mandatory" title="Referral Source">
                 <option> </option>
                 %PATWEB89.03.110.2
                 </select></td></tr>
      <tr><td><div id=TranSrcHeading></div></td>
          <td><div id=TranSrc></div></td></tr>

<tr><td class=DataLabel>Referring HCP</td>
    <td><input type="text" size=10 maxlength=10 name=ptvis028 id=ptvis028 tabindex=5
         title="Referring HCP"
         onchange="if (checkAlphanumDesc(event,this) != false) {
                     ReadDoc(18,0,ptvis028,genpname,ptvis029,genpprac,ptvis030,
                             genpprov);
                   }">
        <input type=text size=25 notab readonly name=genpname id=genpname>
        <img src="../images/SearchIcon.gif" class=Icon
        onclick="GPHCPSearchFrame(ptvis028,genpname,genpprov,ptvis029,genpprac,ptvis030,0)">
       <img src="../images/erase.gif" class=Icon
        onclick="clrFields(ptvis028,genpname);"></td></tr>

<tr><td class=DataLabel>Practice</td>
    <td><input type=text name=genpprac id=genpprac size=35 readonly>
          <img src="../images/SearchIcon.gif" class=Icon
      onclick="GPHCGSearchFrame(ptvis028,genpname,genpprov,ptvis029,genpprac,ptvis030)">
    <img src="../images/erase.gif" class=Icon
     onclick="clrFields(ptvis029,genpprac,ptvis030,genpprov);"></td>
    </tr>

      <tr><td class=DataLabel>Inform GP</td>
      <td><select name=ptvis022 id=ptvis022 tabindex=6>
         <option value="0">No</option>
         <option value="1" selected>Yes</option>
        </select></td></tr>

      <tr><td class=DataLabel>Readmission Indicator</td>
          <td><select name=ptmis042 id=ptmis042 tabindex=7>
                <option> </option>
                 %PATWEB89.03.138.2
              </select></td></tr>     

      <tr><td class=DataLabel>Admission Type</td>
          <td><select name=ptmis012 id=ptmis012 tabindex=8 class="Mandatory" title="Admission Type"   
               onchange="displayDiv(ptmis012,'AT');">
                <option> </option>
                 %PATWEB89.03.113.2
              </select></td></tr>

      <tr><td class=DataLabel>Admitting Doctor</td>
          <td><input type="text" size=11 maxlength=6 name=ptmis007 id=ptmis007
               tabindex=11 class="Mandatory" title="Admitting Doctor"
               onblur="UpCase(this);
                       if (checkAlphanumDesc(event,this) != false) {
                         validateCode(3,ptmis007,doctnam2);
                         getHCPSpecialtySelectList();
                       }"
            onchange="if (checkAlphanumDesc(event,this) != false) {
                        getCaseTeamByHCP(ptmis007,pmsvx146,n_pmsvx146,ptmis001);
                      }">
              <input type=text readonly size=25 notab name=doctnam2 id=doctnam2>
              <img notab src="../images/SearchIcon.gif" class=Icon
               onclick="HCPSelectOnClick(ptmis007,doctnam2,pmsvx146,n_pmsvx146,
                                         dummy1);"> 
              <img src="../images/erase.gif" class=Icon
               onclick="clrFields(ptmis007,doctnam2,pmsvx146,n_pmsvx146);">
          </td>

      <tr><td class=DataLabel>Case Team</td>
       <td>
         <input type=text name=pmsvx146 id=pmsvx146 size=11 maxlength=10 
          title="Case Team" tabindex=12
          onchange="if (checkAlphanumDesc(event,this) != false) {
                      ValCaseTeam(pmsvx146,n_pmsvx146);
                    }">
         <input type=text name=n_pmsvx146 id=n_pmsvx146 size=42 readonly
          class=Readonly tabindex=-1 title="Team Description">
         <img src="../images/SearchIcon.gif" class=Icon
          onclick="CaseTeamOnClick(pmsvx146,n_pmsvx146,ptmis007,doctnam2,dummy1);">
         <img src="../images/erase.gif" class=Icon
          onclick="clrFields(pmsvx146,n_pmsvx146);">
       </td></tr>
            
      <tr><td class=DataLabel>%STANDARD.01.017.A </td>
          <td><select name=ptmis010 id=ptmis010 tabindex=13
               title="%STANDARD.01.017.A " class="Mandatory"
               >
              <option> </option>
                 %PATWEB89.03.111.2
              </select>
		  </td></tr>

     <tr><td class=DataLabel>%STANDARD.01.017.CL</td>
         <td><select name=ptmis027 id=ptmis027 title="%STANDARD.01.017.CL" class="Mandatory"
              tabindex=14 onchange="showACC();">
               <option> </option>
                %PATWEB89.03.126.2
             </select>
         </td></tr>

     <tr><td><div id=ACCHeading></div></td>
         <td><div id=ACCId></div></tr>

     <tr><td class=DataLabel>Admit Now</td>
         <td><input type=checkbox checked value="1" name="admitbox" id="admitbox" 
               tabindex=15 onclick="SetWardBed();"></td></tr>
     </table>
   </td> 

   <td width=50%>
     <table width=100% border=0 class=TableBody cellpadding=1 cellspacing=0>
     <tr><td class=DataLabel>Reason For Admission </td>
         <td><input tabindex=20 type=text name="ptmis020" id="ptmis020" size=50 maxlength=80>
         </td></tr>

     <tr><td>&nbsp;</td>
         <td><input tabindex=21 type=text name="ptmis021" id="ptmis021" size=50 maxlength=50>
         </td></tr>

     <tr><td class=DataLabel>&nbsp;</td>
          <td>&nbsp;</td></tr>

      <tr><td class=DataLabel>%STANDARD.01.017.HP</td>
          <td><select name="ptmis060" id="ptmis060" tabindex=22 class="Mandatory" 
               title="%STANDARD.01.017.HP">
            <option> </option>
            %PATWEB89.03.151.2
          </select>
         </td></tr>

    <tr><td> &nbsp; </td></tr>
      <tr><td class=DataLabel>Health Agency</td>
          <td><select name="ptmis061" id="ptmis061" tabindex=23 class="Mandatory"
                title="Health Agency">
            <option> </option>
            %PATWEB89.03.152.4
          </select>
          </td></tr>

    <tr><td>Admitting Point</td>
       <td>
         <select name=ptvis046 id=ptvis046 tabindex=24 onchange="defaultWard()">
           <option></option>
            %PATWEB89.03.290.2
         </select>
      </td>
      </tr>

     <tr><td class=DataLabel>Ward / Bed </td>
         <td><select name=ptmis068 id=ptmis068 tabindex=25 class=Mandatory 
            title="Ward" onchange="SetWardBed();">
            <option value=""> </option>
            %PATWEB89.03.449.2
           </select>
           <input type=text name=ptmis076 id=ptmis076 maxlength=3 size=3 title="Bed"
            onchange="UpCase(this);">
           <img notab src="../images/SearchIcon.gif" class=Icon border=0 vspace=1
            onclick="WardBedSearchFrame(ptmis068,warddesc,ptmis076,bedstat1);">
          </td></tr>


      <tr><td class=DataLabel>Diet</td>
          <td><select name=ptmis028 id=ptmis028 tabindex=26>
              <option></option>
              %PATWEB89.03.065.2 
              </select>
          </td></tr>

      <tr><td colspan=2 rowspan=6>
          <table width=100% border=0> 
           <tr><td>
           <span id=BabyAge style="display:none">
             <table width=100% height=100% border=0 cellspacing=0 cellpadding=0>
               <tr><td class=DataLabel width=37%>Admission Weight</td>
               <td><input type=text name=ptmis051 id=ptmis051 size=8 maxlength=6
             value="" tabindex=27 title="Admission Weight"  
                onblur="justifyRight(this);">grams</td>
               </tr>
             </table>
           </span>
           </td></tr>
           <tr><td>
           <span id=NewBorn style="display:none">
             <table width=100% height=100% border=0 cellspacing=0 cellpadding=0>
               <tr><td class=DataLabel width=37%>Gestation Period</td>
               <td><input type=text name=ptmis041 id=ptmis041 maxlength=3 size=4
                  tabindex=28 onchange="validateCatCode(userdef5,ptmis041,'');"
                  title="Gestation Period" value=""> weeks
             </td></tr>
             </table>
           </span>
           </td></tr>
          <tr><td rowspan=2>
          <span id=WaitingList style="display:none">
            <table width=100% height=100% border=0 cellspacing=0 cellpadding=0>
              <tr><td class=DataLabel width=37%>Date of Referral</td>
              <td><input type=text size=12 name=ptmis058 id=ptmis058 tabindex=29 value=""
                   onblur="checkDate(this,'ReferralDate')">
              <img notab src="../images/CalendarLookup.gif" class=Icon
                   onclick="DateLookupFrame(ptmis058);"></td></tr>
              <tr><td class=DataLabel>Date of 1st Spec Consult</td>
              <td><input type=text size=12 name=ptmis059 id=ptmis059 tabindex=30 value=""
                   onblur="checkDate(this,'SpecConDate')">
              <img notab src="../images/CalendarLookup.gif" class=Icon
                   onclick="DateLookupFrame(ptmis059);"></td></tr>
             </table>
           </span>
           </td></tr>
          </table>
          </td></tr>

</table>
</td>
</tr>

<tr align=center>
  <td colspan=4>
    <input type=button value="Ok" class="button" tabindex=35 id="pat89sub"
        onclick="tempDisable(this);
          if(checkAdmissionDate()){
            checkBedStatus(ptmis068.value,ptmis076.value,
                           ptmis001.value,ptmis030.value,
                           SubmitAdm);}">
  </td>
</tr>
</table>
</td></tr>

<tr><td><hr></td></tr>

</table>
</form>
</div>

<form name=linkForm id=linkForm action=patweb89.pbl method=post>
<input type=hidden name=reportno id=reportno value=1>
<input type=hidden name=template id=template value=1>
<input type=hidden name=urnumber id=urnumber value="%PATWEB89.03.003">
<input type=hidden name=admissno id=admissno value="%PATWEB89.03.101">
</form>

<form name=Lookup id=Lookup action=patweb94.pbl method=post>
<input type=hidden name=reportno id=reportno value=9>
<input type=hidden name=template id=template value=1>
<input type=hidden name=valcateg id=valcateg>
<input type=hidden name=valdtype id=valdtype>
<input type=hidden name=valdcode id=valdcode>
</form>

<form name=PatientLinks id=PatientLinks method=get>
<input type=hidden name=reportno id=reportno value=1>
<input type=hidden name=template id=template value=004>
<input type=hidden name=urnumber id=urnumber value="%PATWEB89.03.003">
<input type=hidden name=admissno id=admissno value="%PATWEB89.03.101">
<input type=hidden name=MenuType id=MenuType value="%PATWEB89.03.088">
</form>

<script type="text/javascript">
for (var i=0;i<document.UpdateForm.ptmis060.length;i++){
if (document.UpdateForm.ptmis060.options[i].value.substr(0,3)==
    document.UpdateForm.ptcnhpcd.value){
    document.UpdateForm.ptmis060.selectedIndex=i}};
//
ShowAdmissionWeight(UpdateForm);
//
if ("%PATWEB89.03.466.1" == "BED" ) { var site="4711" } else { var site="4712" }
//
 if ("%PATWEB89.03.903" == "1") {
  alert("Warning: Patient has a Waiting List Procedure");
 }
 if ("%PATWEB89.03.904" == "1") {
  alert("Warning: Patient has a Booking");
 }
 if ("%PATWEB89.03.905" == "1") {
  alert("Warning: Patient is currently admitted");
 }
 if ("%PATWEB89.03.908" == "1") {
  alert("Warning: Patient has a pre-admission record");
 }
ibcnmhos="%STANDARD.01.025.000.043.1.1"
if(ibcnmhos=="1"){
  UpdateForm.ptmis068.className="Mandatory"
}
</script>
<span id=transferhd style="display:none">
Transfer Source
</span>
<span id=transfersrc style="display:none">
<input type="text" size=7 maxlength=5 name=trnsfsrc id=trnsfsrc class=Mandatory
 title="Transfer Source" tabindex=5
 onblur="validateCodeOnChange(9,trnsfsrc,trandesc,ptmis009);">
<input type=text size=27 name=trandesc id=trandesc notab
 class=Readonly readonly>
<img src="../images/SearchIcon.gif" class=Icon
 onclick="TransferSourceFrame(trnsfsrc,trandesc,ptmis009)">
</span>
<span id=transferblank style="display:none">
   <input type=hidden name=trnsfsrc id=trnsfsrc>
</span>

<span id=blanklabel style="display:none">&nbsp;</span>
<span id=acchd style="display:none">
ACC Purchase Order Number
</span>

<span id=accorderid style="display:none">
  <input type=text name=accpordn id=accpordn title="ACC Purchase Order Number"
   value="%PATWEB89.03.392" maxlength=20 size=25>
</span>



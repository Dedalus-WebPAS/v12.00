<meta name="TemplateVersion" content="V12.00.00">
<meta name="TemplateHome" content="nz">
<meta name="HelpFileName"    content="NoContextSet.html">
<meta name="CrossBrowser"    content="true">
<script type="text/javascript">
function UpdateDetails() {
  if (validateMandatory(UpdateForm)) {
     if(trim(document.UpdateForm.d_procedure.value) ==
        trim(document.UpdateForm.newprocc.value)) {
        alert("ERROR : The Procedure code has not changed " +
              "\nNo update performed.");
        return;
     }
     if(valProcSubmit()){
    var serverURL = "../cgi-bin/watweb01.pbl?reportno=12&valdtype=1" +
                   "&urnumber="+document.PatientLinks.urnumber.value.replace(/ /g,"+") +
                   "&proccode="+document.UpdateForm.newprocc.value.replace(/ /g,"+");
    var returnValue = RSExecute(serverURL);
    if (returnValue.return_value == -1) {
     if (!confirm("Waiting list entry already exists.\nOK will create a duplicate.")) {
       return false; 
      } 
    }
    document.UpdateForm.submit();
}
   }
}
function valProc() {
   validateCode(27,UpdateForm.newprocc,UpdateForm.wattr003,AddForm.wpgrp)
}
function valProcSubmit() {
   validateCode(27,UpdateForm.newprocc,UpdateForm.wattr003,AddForm.wpgrp)
//   if(AddForm.wattr011.value==AddForm.wpgrp.value){
//         return true;}
//   else{
//      if(confirm("Warning : Invalid procedure for Unit")){
//        return true;}
//      else {
//         return false;}
//   }
   return true;
}
function validateCode(OptionNumber,ReturnCode,ReturnName) {
  ReturnFunction="" ;
  ReturnName.value="";
  for (var i=3; i < validateCode.arguments.length; i++) {
    if (typeof(validateCode.arguments[i]) == 'function') {
      ReturnFunction=validateCode.arguments[i] }
    else {
      validateCode.arguments[i].value=""; }  }
  if (isWhitespace(ReturnCode.value)) return;;
  var serverURL   = "../cgi-bin/patweb80.pbl?reportno=" + OptionNumber +
                    "&valdcode=" + ReturnCode.value.replace(/ /g,"+") +
                    "&valddefv=" + document.UpdateForm.procoddv.value.replace(/ /g,"+")
  var returnValue = RSExecute(serverURL);
  if (returnValue.status==0) {
    ReturnValue=returnValue.return_value.split("|")
    ReturnName.value=trim(ReturnValue[0])
    j=0
    for (var i=3; i < validateCode.arguments.length; i++) {
       if (typeof(validateCode.arguments[i]) != 'function') {
         j++
         validateCode.arguments[i].value=ReturnValue[j] } }
    if (typeof(ReturnFunction) == 'function') {
       ReturnFunction() }
    return true;
    }
  else {
    ReturnCode.value="";
    ReturnCode.select();
    ReturnCode.focus();
    return false;
     }
}
</script>
</head>
%START.OF.PAGE
<body onload=PageLoad(event);>
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Change Waiting List Procedure Code
</span>
<form name=UpdateForm action="watweb01.pbl" method=post style="margin:0"
 onsubmit='return validateMandatory(this);'>
<table border=0 width=90% cellspacing=0 align=center>
<input type=hidden name=reportno value=2>
<input type=hidden name=template value=20>
<input type=hidden name=casekeys value="%WATWEB01.02.101">
<input type=hidden name=updttype value="P">
<input type=hidden name=nextpage value="8">
<input type=hidden name=dummy >
<input type=hidden name=procoddv value=" ">
<input type=hidden name=d_procedure value="%WATWEB01.02.103">

<tr><td class=DataLabel>Procedure</td>
    <td class=DataLabel>
    <input type=text size=12 name=newprocc value="%WATWEB01.02.103"
     title="Procedure Code" class=Mandatory onchange="valProc();">
    <input type=text name=wattr003 size=60 
     maxlength=50 value="%WATWEB01.02.106">
    <img src=../images/SearchIcon.gif class=Icon
     onclick="WaitProSearchFrame(UpdateForm.newprocc,
                                 UpdateForm.wattr003,
                                 UpdateForm.dummy,
                                 UpdateForm.dummy)"></td>
    </td></tr>

<tr><td class=DataLabel>Reason for Change</td>
    <td class=DataLabel>
    <select name=reasonfc title="Reason for Change" class=Mandatory >
    <option></option>
    %WATWEB01.02.327.2
    </select>
    </td></tr>

<tr><td colspan=2 align=center>
    <input type=button class="button" value="Ok" onclick="UpdateDetails();">
    <input type=button value="Cancel" class="button" onclick='DFrameExit()'>
    </td></tr>
</table>
</form>

<form name=AddForm method=get>
<input type=hidden name=wattr001 value="%WATWEB01.02.103.0">
<input type=hidden name=wattr011 value="%WATWEB01.02.114.1">
<input type=hidden name=dummy1 value="">
<input type=hidden name=wpgrp value="">
</form>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=urnumber value="%WATWEB01.02.003">
<input type=hidden name=admissno value="%WATWEB01.02.081">
<input type=hidden name=MenuType value="%WATWEB01.02.088">
<input type=hidden name=casekeys value="%WATWEB01.02.101">
<input type=hidden name=wattrkey value="%WATWEB01.02.101">
<input type=hidden name=nextpage value="8">
<input type=hidden name=sesskeys value="">
</form>

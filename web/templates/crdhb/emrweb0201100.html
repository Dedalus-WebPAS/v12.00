<meta name="TemplateVersion" content="V12.00.00">
<meta name="TemplateHome" content="crdhb">
<meta name="HelpFileName"    content="NoContextSet.html">
<link rel="stylesheet" href="../html/postcode.css" type="text/css">
<script type="text/javascript" src="../js/emrweb0201100.js"></script>
<!-- 01 : CTAS : link to custom javascript -->
<script type="text/javascript" src="../js/ctascustom.js"></script>
<script type="text/javascript" src="../js/ctas_emrmandatory.js"></script>
<!-- end of change -->
<script type="text/javascript">
function checkDateFunction(fieldvar,stringtitle) {
  if(isWhitespace(fieldvar.value)) {
    return;
  } else {
    checkDate(fieldvar,stringtitle);
  }
}
function UpdDoctor() {
  if (UpdateForm.emcndoct.value==1) {
    UpdEmrDoc(UpdateForm.emvis007);
  }
  else {
    UpdDoc(UpdateForm.emvis007);
  }
}
function SearchDoctor() {
  if (UpdateForm.emcndoct.value==1) {
    DoctorEmrSearchFrame(UpdateForm.emvis007,UpdateForm.dummy3);
  }
  else {
    DoctorSearchFrame(UpdateForm.emvis007,UpdateForm.dummy3);
  }
}
function checkDisabled (theFieldObject) {

  if (theFieldObject.disabled==true) {
    alert(theFieldObject.title+" is a disabled field.");
    return true;
  }

  return false;
}

// 01 : CTAS : add function to save Smoking Status, alchohol involed when value changed
function updateSmokingStatus() {
	RemoteEmrUpdate(SelectScreen.admissno, UpdateForm.emvis047);
}

function updateAlcoholInvolvedStatus() {
	RemoteEmrUpdate(SelectScreen.admissno, UpdateForm.emvis067);
}

//function updateSpecialtyPaged() {
//	RemoteEmrUpdate(SelectScreen.admissno, UpdateForm.emvis169);
//}
// end of change

// 01 : CTAS: Call new buttons
// ED Visit Flow
function callEDVisitFlow() {
	document.PatientLinks.target="_self";
	document.PatientLinks.action="emrweb02.pbl";
	document.PatientLinks.reportno.value="01";
	document.PatientLinks.template.value="004";
	document.PatientLinks.submit();
}
// Injury Data
function callInjuryData() {
	document.PatientLinks.target="_self";
	document.PatientLinks.action="patweb89.pbl";
	document.PatientLinks.reportno.value="01";
	document.PatientLinks.template.value="005";
	document.PatientLinks.submit();
}
// Observations
function callObservations() {
	document.PatientLinks.target="_self";
	document.PatientLinks.action="cliweb02.pbl";
	document.PatientLinks.reportno.value="01";
	document.PatientLinks.template.value="001";
	document.PatientLinks.submit();
}
// Tracking pop-up
function callTracking() {
	// as of now, open on the same window
	// if pop-up is required, then a new template must be created for Tracking
	/*
	linkurl="emrweb02.pbl?reportno=01&template=900" +
	"&urnumber=" + PatientLinks.urnumber.value.replace(/ /g,"+") +
	"&admissno=" + PatientLinks.admissno.value.replace(/ /g,"+")
	Left=(document.body.clientWidth-770)/2
	DFrameLink(linkurl,50,Left,770,500)
	*/
	document.PatientLinks.target="_self";
	document.PatientLinks.action="emrweb02.pbl";
	document.PatientLinks.reportno.value="01";
	document.PatientLinks.template.value="900";
	document.PatientLinks.submit();
}
// call work capacity
function callWC() {
	linkurl="patweb89.pbl?reportno=01&template=054"
      + "&urnumber=" + document.UpdateForm.urnumber.value.replace(/ /g,"+")
      + "&admissno=" + document.UpdateForm.admissno.value.replace(/ /g,"+")
      + "&systflag=0" +
      + "&seriflag=0" +
      + "&showflag=1"
	Left=(document.body.clientWidth-770)/2
	DFrameLink(linkurl,50,Left,770,500)
}
// end of change

// 01 : CTAS : Add Bed Request link
// implementation copied from ../standard/patweb1008001.html 
function addBedRequest() {
  if(isWhitespace(PatientLinks.admissno.value)) {
    alert("Please select a visit before adding request details");
    return;
  }
  if(trim(PatientLinks.d_ptvitype.value)=="1" &&
     PatientLinks.d_emvistat.value!="1") {
    alert("Invalid Emergency visit status for adding bed requests");
    return;
  }
  /* As per CAR0812864, we don't need to validate d_inpastat
  since this is always a patient EMR visit
  if(trim(PatientLinks.d_ptvitype.value)=="3" &&
    (PatientLinks.d_inpastat.value=="3" || PatientLinks.d_inpastat.value=="5")){
    alert("Invalid Inpatient visit status for adding bed requests");
    return;
  }
  end of change */ 
  linkurl="patweb10.pbl?reportno=08&template=002" +
          "&urnumber=" + PatientLinks.urnumber.value.replace(/ /g,"+") +
          "&admissno=" + PatientLinks.admissno.value.replace(/ /g,"+")
  Left=(document.body.clientWidth-770)/2
  DFrameLink(linkurl,50,Left,770,500)
}
// end of change

// 01 : CTAS : For specialty paged
// based on methods from ../custom-js/ctas_emrtracking.js
function setSpecialtyPagedAccess () {
	// Specialty Paged 1: 
	// allow selection only if no specialty already entered
	if  (!isWhitespace(UpdateForm.emvis169.value)) {
		UpdateForm.specialty.style.visibility = "hidden";
		setField ("Off",UpdateForm.specialty);
	} else {
		UpdateForm.specialty.style.visibility = "visible";
		setField ("On",UpdateForm.specialty);
	}
	// make specialty fields read-only if populated
	if   ((!isWhitespace(UpdateForm.emvis077.value)) 
			&& (!isWhitespace(UpdateForm.emvis087.value)))
	{
		setField ("Off",UpdateForm.emvis077);
		setField ("Off",UpdateForm.emvis087);
		setImage ("Off",UpdateForm.image02);
	}
	else
	{
		setField ("On",UpdateForm.emvis077);
		setField ("On",UpdateForm.emvis087);
		setImage ("On",UpdateForm.image02);
	}
}
function setField(cAction,aField) {
	if (cAction.toUpperCase() == "OFF") {
		aField.className = "readOnly";
		aField.readOnly  = true;
	} else {
		aField.className = "Text";
		aField.readOnly  = false;
	}
}
function setImage (cAction,aImage) {
  if (cAction.toUpperCase() == "OFF") {
    aImage.style.visibility = "hidden";
    aImage.disabled         = true;
  } else {
    aImage.style.visibility = "visible";
    aImage.disabled         = false;
  }
}
function setSpecialty(cSelect,cSpecialty,cDescription,dDate,tTime,fFocus)
{
  // save only if it validated date rules
  var oldDate = dDate.value;
  var oldTime = tTime.value;
  if (setStopWatch(dDate,tTime,fFocus)) {
	cSpecialty.value   = cSelect.options[cSelect.selectedIndex].value.substr(0,3);
	cDescription.value = cSelect.options[cSelect.selectedIndex].text;
	RemoteEmrUpdate(UpdateForm.admissno,cSpecialty);
	setSpecialtyPagedAccess();
	// fFocus.focus();
  } else {
	// reset
	dDate.value = oldDate;
	tTime.value = oldTime; 
	// revert
	// RemoteEmrUpdate(UpdateForm.admissno,dDate);
    // RemoteEmrUpdate(UpdateForm.admissno,tTime);
  }
}
function setStopWatch (dDate,tTime,fFocus) {
  // Get the Date/time
  setDateTime(dDate,dDate.Title,tTime,tTime.Title);

  // Check that Focus field is available
  // if ((fFocus.name == "emvis116") && (!isWhitespace(UpdateForm.emvis116.value)))
  // {fFocus = UpdateForm.emvis075;}
  // if ((fFocus.name == "emvis075") && (!isWhitespace(UpdateForm.emvis075.value)))
  // {fFocus = UpdateForm.emvis040;}
  
  // Write the Date/Time and change focus
  if(setDT(dDate,tTime,fFocus)) {
	return true;
  } else {
	return false;
  }
}
function setDateTime(dateField,dateString,timeField,timeString) {
  var monthname = new Array(12);
  monthname[0]="Jan";
  monthname[1]="Feb";
  monthname[2]="Mar";
  monthname[3]="Apr";
  monthname[4]="May";
  monthname[5]="Jun";
  monthname[6]="Jul";
  monthname[7]="Aug";
  monthname[8]="Sep";
  monthname[9]="Oct";
  monthname[10]="Nov";
  monthname[11]="Dec";
  var n=new Date();
  var day=n.getDate();
  var mon=n.getMonth();
  mon=mon + 1
  var ccyy=n.getFullYear();
  if (day<10)  day ="0" + day
  var dateValue=day + " " + monthname[mon-1] + " " + ccyy
  dateField.value=dateValue;
  timeField.value="          ";
  checkDate(dateField,dateString);
  checkTime(timeField,timeString);
}
function setDT (dDate,tTime,fFocus)
{
  // For a Date/Time manually entered check that it is not a future Date/Time.
  if  ((!isWhitespace(dDate.value))
    && (!isWhitespace(tTime.value))) {
    if (!checkDate(dDate,dDate.title)) {
      dDate.value = "";
      dDate.focus();
      return;
    }

    setDateTime(UpdateForm.currdate,"Current PC Date",UpdateForm.currtime,"Current PC Time");
    if (!ChkDateTime(dDate,tTime,UpdateForm.currdate,UpdateForm.currtime)) {
      alert(dDate.title+"/Time ("+dDate.value+" "+tTime.value+") cannot be in the Future.");
      tTime.value="";
      dDate.focus();
      return;
    }
  }
  // Only update if the Date/Time Rules are correct
  // Note that data may return true if only one of date / time entered as
  // incomplete rather than wrong.
  
  if (DTRules()) {
    // Only write the Date/Time as a valid pair
    if ((!isWhitespace(dDate.value)) && (!isWhitespace(tTime.value))) {
      RemoteEmrUpdate(UpdateForm.admissno,dDate);
      RemoteEmrUpdate(UpdateForm.admissno,tTime);
    }
	return true;
  } else {
	return false;
  }
}
function DTRules () {
  // Specialty Accept Patient after Specialty Paged
  if (!xDT(UpdateForm.emvis073,UpdateForm.emvis083,UpdateForm.emvis077,UpdateForm.emvis087)){return false};
  return true;
}

function xDT (dDate1,tTime1,dDate2,tTime2) {
  var dDate1p=0;
  var dDate2p=0;
  
  if (!isWhitespace(dDate1.value)) {
    dDate1p=Date.parse(dDate1.value);
  }
  if (!isWhitespace(dDate2.value)) {
    if (!checkDate(dDate2,dDate2.title)) {
      // Alert should be from checkDate
      // dDate2.value="";
      // dDate2.focus();
      return false;
    }
    dDate2p=Date.parse(dDate2.value);
    if (!CheckPast(SetDateYYYYMMDD(dDate2.value))) {
      alert(dDate2.title+" ("+dDate2.value+") cannot be in the future");
      // dDate2.value="";
      // dDate2.focus();
      return false;
    }
  }
  if ((!isWhitespace(dDate1.value))
     && (!isWhitespace(dDate2.value))) {
    if (dDate2p < dDate1p) {
      alert(dDate2.title+" ("+dDate2.value+") cannot be before "+dDate1.title+" ("+dDate1.value+")");
      // dDate2.value="";
      // dDate2.focus();
      return false;
    }
  }
  if (!isWhitespace(tTime2.value)) {
    checkTime(tTime2,tTime2.title);
  }
//  CheckFutureTime(UpdateForm,dDate2.value,tTime2);
  if ((!isWhitespace(tTime1.value))
   && (!isWhitespace(tTime2.value))
   && (tTime2.value <= tTime1.value)
   && (dDate2p == dDate1p)) {
    alert(tTime2.title+" ("+tTime2.value+") cannot be before "+tTime1.title+" ("+tTime1.value+")");
    // tTime2.value="";
    // tTime2.focus();
    return false;
  }
  return true;
}
// Specialty Accept Date
function updateSpecialtyAcceptDate() {
	DTRules ();
	setSpecialtyPagedAccess();
	RemoteEmrUpdate(SelectScreen.admissno, UpdateForm.emvis077);
}
// Specialty Accept Time
function updateSpecialtyAcceptTime() {
	DTRules ();
	setSpecialtyPagedAccess();
	RemoteEmrUpdate(SelectScreen.admissno, UpdateForm.emvis087);
}
// end of change

// 03 : TAS : Enable or disable Injury Data button 
// enable Injury details button if claim type is Accident type	
function InjuryButtonEnable() {  
	if (trim(document.PatientLinks.emvis008.value)!== "Non-accident") {
	    document.all.InjurydatBut.disabled = false;
}
}

</script>
%START.OF.PAGE
<!-- 01 : CTAS : Add function calls
<body onLoad="PageLoad(event);">
03 : TAS : Add InjuryButton function call
-->
<body onLoad="PageLoad(event);setSpecialtyPagedAccess();InjuryButtonEnable();">
<!-- end of change -->
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%EMRWEB02.01.003";
PatientVIS="%EMRWEB02.01.081";
PatientNAM="%EMRWEB02.01.002";
PatientSTA="%EMRWEB02.01.086.078";
PatientALT="%EMRWEB02.01.084";
PatientSEX="%EMRWEB02.01.019";
PatientDOB="%EMRWEB02.01.020";
PatientAGE="%EMRWEB02.01.021";
PatientLOC="%EMRWEB02.01.083";
PatientPRI="%EMRWEB02.01.086.066.1";
PatientUNT="%EMRWEB02.01.066.0";
PatientIND="%EMRWEB02.01.086.091";
GpCOD="%EMRWEB02.01.086.084.001";
GpNAM="%EMRWEB02.01.086.084.081";
GpPRAC="%EMRWEB02.01.086.085.001";
GpPRACCNT="%EMRWEB02.01.086.085.002";
GpPRACNAM="%EMRWEB02.01.086.085.005";
PatientARR="%EMRWEB02.01.101.0 %EMRWEB02.01.102";
PatientSEE="%EMRWEB02.01.130.0 %EMRWEB02.01.131";
PatientTRI="%EMRWEB02.01.103.3";
PatientECLC="%EMRWEB02.01.484.1";
PatientCLH="%STANDARD.01.017.CL";
PatientEHFT="%EMRWEB02.01.485";
InsertEmergencyHeader()
</script>
<div id=PatientMenu></div>
<div id=PageBodySection>
<table width=100% center border=0 cellspacing=0 cellpadding=0>
<!-- 01 : CTAS : relabel Clinical Details to Work Screen
<tr><td class=HeadingCell align=center>
    Emergency Patient Clinical Details</td>
-->
<tr><td class=HeadingCell align=center>
    Emergency Patient Work Screen</td>
<!-- end of change -->
    <td class=HeadingCell align=right width=5%>
    <a href="javascript:NextPatient('%EMRWEB02.01.476.emrweb02.01.100');">
    <img src='../images/ShowIcon.gif' border=0 align=left
              alt='Select next emergency patient by visit date/time.'>
    <a href='javascript:print();'>
    <img src='../images/PrinterIcon.gif' border=0 align=absmiddle
              alt='Print Page'></td></tr>
</table>
<form name=SelectScreen action="emrweb02.pbl" method=post>
 <input type=hidden name=reportno value=1>
 <input type=hidden name=template value=1>
 <input type=hidden name=admissno value="%EMRWEB02.01.081">
 <input type=hidden name=urnumber value="%EMRWEB02.01.003">
</form>
<form name=UpdateForm action="emrweb02.pbl" method=post style="margin:0"
 onsubmit='return validateMandatory(this);'>
 <input type=hidden name=reportno value="01">
 <input type=hidden name=updttype value="TRIAG">
 <input type=hidden name=resavail value="0">
 <input type=hidden name=template value="100">
 <input type=hidden name=admissno value="%EMRWEB02.01.081">
 <input type=hidden name=urnumber value="%EMRWEB02.01.003">
 <input type=hidden name=emvis118 value="%EMRWEB02.01.003">
 <input type=hidden name=formactn value=" "> 
 <input type=hidden name=nextpage value=0>
 <input type=hidden name=redirect>
 <input type=hidden name=updateky value="%EMRWEB02.01.404">
 <input type=hidden name="username">
 <input type=hidden name="password">
 <input type=hidden name=dummy1>
 <input type=hidden name=dummy2>
 <input type=hidden name=emvis004>
 <input type=hidden name=emvis005>
 <input type=hidden name=emvis135>
 <input type=hidden name=emvis136>
 <input type=hidden name=emvis137>
 <input type=hidden name=emvis138>
 <input type=hidden name=emdct001>
 <input type=hidden name=emdct002>
 <input type=hidden name=emdct003>
 <input type=hidden name=emdct004>
 <input type=hidden name=emdct005>
 <input type=hidden name=emdct006>
 <input type=hidden name=emdct007>
 <input type=hidden name=emdct008>
 <input type=hidden name=emdct009>
 <input type=hidden name=emvis026 value=" ">
 <input type=hidden name=emvis006 value="%EMRWEB02.01.106.1">
 <input type=hidden name=temdiag value="">
 <input type=hidden name=emcndoct value="%EMRWEB02.01.455">
 <!-- 01 : CTAS : Add hidden fields -->
 <input type=hidden name=currdate value="%STANDARD.01.013">
 <input type=hidden name=currtime>
 <!-- end of change -->
<table width=98% align=center border=0 cellspacing=0 cellpadding=1>
<tr><td class=DataLabel>Triage Date </td>
    <td class=DataLabel colspan=2><input type="text" name=emvis128 size="12"
     title="Triage Date" value="%EMRWEB02.01.162.0" readonly>
    Time
    <input type="text" name=emvis129 size="8" value="%EMRWEB02.01.163" readonly>
    </td>
	<!-- 01 : CTAS : Move buttons at the bottom of the page
    <td colspan=2 align=right>
    <input type=button class="button" 
     value="Nurse Handover" onClick='DoctorData();'>
    <input type=button class="button" value="Doctor Handover"
     onClick='NurseData();'>
    </td>
	 end of change -->
	 </tr>
<tr valign=top><td class=DataLabel>Presenting Complaint</td>
        <td><input type=hidden name=el value="el">
        <input type=text name=emvis060 max=3 readonly size=3
         title="Presenting Complaint"
         value="%EMRWEB02.01.220.1"
         onblur="validateCatCode(el,emvis060,v060name);">
        <input type=text name=v060name readonly value="%EMRWEB02.01.220.0"></td>
<!-- 01 : CTAS : add triage notes label -->
<!-- 04 : TAS : Make triage notes display as ready onnly -->
		<td class=DataLabel>Triage Notes</td>
<!-- end of change -->
        <td><textarea wrap=hard name=prcom001 cols=50 readonly class=Readonly 
             rows=3 onchange="setPreXml('%EMRWEB02.01.081');"></textarea>
    </td></tr>

<!-- 01 : CTAS : rearrange notes fields
<tr valign=top><td class=DataLabel>Medical History </td>
    <td colspan=3>
    <table cellspacing=0 cellpadding=0>
    <tr valign=bottom>
          <td><textarea class=Readonly cols=100 rows=5 
                        name=medichis readonly></textarea></td>
          <td><input type=button class=SlimButton value="Add" onclick='AddList();'>
          </td></tr>
    </table>
    </td></tr>

<tr valign=top><td class=DataLabel>Patient Notes </td>
    <td colspan=3><textarea  class=Readonly cols=70 rows=5 
    name=dispnote readonly>EMRWEB02.01.453</textarea>
    <input type=button class="button" value="Add" onclick='AddPatNote();'>
    </td></tr>

<tr valign=top>
    <td class=DataLabel>
    <input type=button class="button" value="Procedures" 
       onclick='ProcedureLinkNoDef();'>
    <input type=button class="button" value="List Procedures" 
       onclick='ProcedureList();'> </td>
    <td><textarea cols=40 rows=3 readonly>EMRWEB02.01.402.004.0</textarea></td>
    <td><input type=button class="button" value="Diagnosis"
     onclick='DiagnosisLink();'></td> 
    <td><textarea wrap=hard cols=50 rows=3 name=patdiag align=right
        onfocus="lockDiagnosis();" onkeydown="LimitText(this,8,450);"
        onblur="diagNoteXml('EMRWEB02.01.081');"></textarea>
    </td></tr>
-->	
<tr valign=top style="display:none"><td class=DataLabel>Medical History </td>
    <td colspan=3>
    <table cellspacing=0 cellpadding=0>
    <tr valign=bottom>
          <td><textarea class=Readonly cols=100 rows=5 
                        name=medichis readonly></textarea></td>
          <td><input type=button class=SlimButton value="Add" onclick='AddList();'>
          </td></tr>
    </table>
    </td></tr>

<tr valign=top style="display:none"><td class=DataLabel>Patient Notes </td>
    <td colspan=3><textarea  class=Readonly cols=70 rows=5 
    name=dispnote readonly>%EMRWEB02.01.453</textarea>
    <input type=button class="button" value="Add" onclick='AddPatNote();'>
    </td></tr>

<tr><td colspan=4>&nbsp;</td></tr>
<tr>
	<td colspan=2><input type=button class="button" value="Medical Notes"   
		onclick='addNoteCustom("emrweb0201980");'></td>
	<!-- 01 : CTAS : Rename field
	<td colspan=2><input type=button class="button" value="Nursing Notes"   
		onclick='addNoteCustom("emrweb0201981");'></td>
	-->
	<td colspan=2><input type=button class="button" value="Nursing/AH Notes"   
		onclick='addNoteCustom("emrweb0201981");'></td>
	<!-- end of change -->
</tr>
<tr><td colspan=2><textarea cols=58 rows=14  name=doctorsnotes 
	readonly>%EMRWEB02.01.471.007.1</textarea></td>
    <td colspan=2><textarea cols=58 rows=14 name=nursingnotes 
	readonly>%EMRWEB02.01.471.001.1</textarea></td>
</tr>

<!-- 01 : CTAS : Swap positions of Procedures and Diagnosis
<tr valign=top>
    <td colspan=2 class=DataLabel>
    <input type=button class="button" value="Procedures" 
		onclick='ProcedureLinkNoDef();'>
    <input type=button class="button" value="List Procedures" 
		onclick='ProcedureList();'></td>
	<td colspan=2>
		<input type=button class="button" value="Diagnosis"
		onclick='DiagnosisLink();'></td>
</tr>
<tr>
    <td colspan=2><textarea cols=40 rows=3 readonly>EMRWEB02.01.402.004.0</textarea></td>
    <td colspan=2><textarea wrap=hard cols=50 rows=3 name=patdiag align=right
        onfocus="lockDiagnosis();" onkeydown="LimitText(this,8,450);"
        onblur="diagNoteXml('EMRWEB02.01.081');"></textarea>
    </td>
</tr>
-->
<tr valign=top>
	<td colspan=2>
		<input type=button class="button" value="Diagnosis"
		onclick='DiagnosisLink();'></td>
    <td colspan=2 class=DataLabel>
    <input type=button class="button" value="Procedures" 
		onclick='ProcedureLinkNoDef();'>
    <input type=button class="button" value="List Procedures" 
		onclick='ProcedureList();'></td>
</tr>
<tr>
    <td colspan=2><textarea wrap=hard cols=50 rows=3 name=patdiag align=right
        onfocus="lockDiagnosis();" onkeydown="LimitText(this,8,450);"
        onblur="diagNoteXml('%EMRWEB02.01.081');"></textarea>
    </td>
	<td colspan=2><textarea cols=40 rows=3 readonly>%EMRWEB02.01.402.004.0</textarea></td>
</tr>
<!-- end of change -->
<tr><td colspan=4>&nbsp;</td></tr>
<!-- end of change -->
<tr>
	<!-- 01 : CTAS : Move field and rename, Move Doctor field here
	<td class=DataLabel>Unit Req. Date</td>
    <td class=DataLabel>
    <input type=text name=emvis073 title="Unit Request Date"
     value="EMRWEB02.01.233.0" readonly class=Readonly size=12>
    Time
    <input type="text" name=emvis083 size="8" value="EMRWEB02.01.243"
     readonly class=Readonly>
    </td>
	-->
	<td class=DataLabel>Doctor</td>
    <td><input type=text size=10 name=emvis007 title="Doctor Code"
         value="%EMRWEB02.01.107.001" id=emvis007
         onblur="UpdDoctor();">
        <input type=text size=35 name=dummy3 title="Doctor Name" width=35
         readonly class=Readonly value="%EMRWEB02.01.107.003">
        <img class=Icon src="../images/erase.gif"
         onClick="if (checkDisabled(document.getElementById('emvis007')))
                  {return;}
                  DelDoc();">
        <img class=Icon src="../images/SearchIcon.gif"
          onClick="if (checkDisabled(document.getElementById('emvis007')))
                   {return;}
                   SearchDoctor();">
   </td>
	<!-- end of change -->
    <td class=DataLabel>Ward Allocated Date</td>
    <td class=DataLabel> 
	<!-- 01 : CTAS : Add size for consistency with other fields
	<input type=text name=emvis074 
        title="Ward Allocated Date" readonly class=Readonly 
         value="EMRWEB02.01.234.0">
	-->
	<input type="text" name=emvis074 size="12" value="%EMRWEB02.01.234.0"
        title="Ward Allocated Date" readonly class=Readonly>
	<!-- end of change -->
    Time
    <input type="text" name=emvis084 size="8" value="%EMRWEB02.01.244"
     title="Bed Ready Time" readonly class=Readonly>
    </td></tr>

<!-- 01 : CTAS : Remove Expected Unit, Move Expected Ward
Move First Doctor Seen here, Add Ward Accepted Date
<tr><td class=DataLabel>Expected Unit</td>
        <input type=hidden name=AC value="AC">
        <input type=hidden name=DEL value="DEL">
    <td><input name=emvis134 title="Expected Unit" size=4 maxlength=3
         value='EMRWEB02.01.173.1' id=emvis134 
         onblur="UpCase(this);
         validateCatCode1(AC,emvis134,unitdesc,emvis073,emvis083);">
        <input name=unitdesc size=30 Class=Readonly readonly 
         value='EMRWEB02.01.173.0'>
        <img class=Icon src=../images/SelectLink.gif
        onclick="if (checkDisabled(document.getElementById('emvis134'))) 
                 {return;}
                 LookupPage(emvis134,unitdesc,'Lookup_CodeCTAC_000',emvis134);">
        <img class=Icon src="../images/erase.gif"
         onClick="if (checkDisabled(document.getElementById('emvis134')))
                  {return;}
                  validateCatCode1(AC,DEL,unitdesc,emvis073,emvis083);"></td>

    <td>Expected Ward</td>
    <td><input name=emvis116 title="Expected Ward" size=4 maxlength=3 
     value='EMRWEB02.01.149.1' id=emvis116
     onblur="validateWard(emvis116,warddesc,emvis074,emvis084);">
       <input name=warddesc size=30 Class=Readonly readonly
        value='EMRWEB02.01.149.0'>
      <img class=Icon src="../images/erase.gif"
       onclick="if (checkDisabled(document.getElementById('emvis116')))
                {return;}
                LookupPage(emvis116,warddesc,'Lookup_ward0000_000',emvis116);">
       <img class=Icon src="../images/erase.gif"
        onClick="if (checkDisabled(document.getElementById('emvis116')))
                 {return;}
                 validateWard(DEL,warddesc,emvis074,emvis084);"></td></tr>
</tr>	
-->
<tr>
	<td class=DataLabel>First Doctor Seen Date </td>
    <td><select name=emvis030 title="First Doctor Seen Date" id=emvis030
       onblur="checkDateFunction(emvis030,'First Doctor Seen Date');
               UpdateDoctorDate(emvis007,emvis030,emvis031);">
       %EMRWEB02.01.130.1
        </select>
    Time
    <input type="text" name=emvis031 size="8" value="%EMRWEB02.01.131"
     title="First Doctor Seen Time"
     onblur="UpdateDoctorDate(emvis007,emvis030,emvis031);">
    <img class=Icon src=../images/TimeLookup.gif
     onclick="if (checkDisabled(document.getElementById('emvis030')))
              {return;}
              TimeLookupFrame(emvis031);">
    <img class=Icon src="../images/DateTimeStamp.gif"
     onClick="if (checkDisabled(document.getElementById('emvis030')))
              {return;}
              defDateTime(emvis030,'Seen Date',emvis031,'Seen Time');
              CheckFocus(emvis030);">
    </td>
	<td>Ward Accept Patient Date</td>
    <td class=DataLabel>
      <input type=text name=emvis075 size=12
             title="Ward Accept Patient Date" readOnly class=readOnly 
             onblur="setDT(emvis075,emvis085,emvis040);"
             value="%EMRWEB02.01.235.0" tabindex=-1>
      Time
      <input type="text" name=emvis085 size="8" value="%EMRWEB02.01.245"
             onblur="setDT(emvis075,emvis085,emvis040);"
             title="Ward Accept Patient Time" readOnly class=readOnly  tabindex=-1>
      <img src="../images/stopwat1.gif" name=image08
        style="visibility:hidden" tabindex=-1
        onClick="setStopWatch(emvis075,emvis085,emvis040);">
    </td>
</tr>

<tr><td class=DataLabel>Responsible HCP</td>
    <td><input type="text" size=9 maxlength=10 name="emvis164" tabindex=13
              title="Responsible HCP" value="%EMRWEB02.01.285.1"
              onblur="UpCase(this);
                     UpdRHCPDoc(UpdateForm.emvis164)" id="emvis164">
        <input type=text readonly size=25 notab name=doctnam2
               title="Responsible HCP" value="%EMRWEB02.01.285.0">
        <img notab src="../images/SearchIcon.gif" class="Icon"
             onclick="DoctorSearchFrame(UpdateForm.emvis164,
                      UpdateForm.doctnam2);">
        <img class=Icon src="../images/erase.gif"
           onClick="if (checkDisabled(document.getElementById('emvis164')))
          {return;}DelRHCPDoc();">
        <input type=text size=12 max=12 name="emvis165" class="NotFuturEdate"
               title="Date" onblur="checkDate(this, 'Date');CheckAdateHCPdate(this.value);"
               value="%EMRWEB02.01.286">
        <img notab src=../images/DateLookup.gif border=0 hspace=4
             align=absmiddle onclick="DateLookupFrame(emvis165);">
        <input type=text size=8 max=8 name="emvis166" title="Time"
            value="%EMRWEB02.01.287"
onblur="checkTime(this,'Time');CheckFutureTime(UpdateForm,UpdateForm.emvis165.value,UpdateForm.emvis166);
checkTATime(UpdateForm,UpdateForm.emvis165.value,UpdateForm.emvis166.value);"
        >
        <img notab src=../images/DateTimeStamp.gif class=Icon
           onClick="SetCurrentDateTime(emvis165,emvis166);">
        <img notab src=../images/TimeLookup.gif class=Icon
           onclick="TimeLookupFrame(emvis166);">
        <img notab src=../images/SwapIcon.gif class=Icon
           onclick="swapAdateRdate();">
    </td>
</tr>
<!-- end of change -->

<!-- 01 : CTAS : Move Doctor fields up
Move Unit Req Date here, Rename, Move Expected Ward here
<tr><td class=DataLabel>Doctor</td>
    <td><input type=text size=10 name=emvis007 title="Doctor Code"
         value="EMRWEB02.01.107.001" id=emvis007
         onblur="UpdDoctor();">
        <input type=text size=39 name=dummy3 title="Doctor Name"
         readonly class=Readonly value="EMRWEB02.01.107.003">
       <img class=Icon src="../images/SearchIcon.gif"
         onClick="if (checkDisabled(document.getElementById('emvis007')))
                  {return;}
                  DelDoc();">
        <img class=Icon src="../images/SearchIcon.gif"
          onClick="if (checkDisabled(document.getElementById('emvis007')))
                   {return;}
                   SearchDoctor();">
        </td>
<td class=DataLabel>First Doctor Seen Date </td>
    <td><select name=emvis030 title="First Doctor Seen Date" id=emvis030
       onblur="checkDateFunction(emvis030,'First Doctor Seen Date');
               UpdateDoctorDate(emvis007,emvis030,emvis031);">
       EMRWEB02.01.130.1
        </select>
    Time
    <input type="text" name=emvis031 size="8" value="EMRWEB02.01.131"
     title="First Doctor Seen Time"
     onblur="UpdateDoctorDate(emvis007,emvis030,emvis031);">
    <img class=Icon src=../images/TimeLookup.gif
     onclick="if (checkDisabled(document.getElementById('emvis030')))
              {return;}
              TimeLookupFrame(emvis031);">
    <img class=Icon src="../images/DateTimeStamp.gif"
     onClick="if (checkDisabled(document.getElementById('emvis030')))
              {return;}
              defDateTime(emvis030,'Seen Date',emvis031,'Seen Time');
              CheckFocus(emvis030);">
    </td>
    </tr>-->

<!-- Alcohol Involved - TSK 0817059 -->
<!--
<tr><td>STANDARD.01.017.es</td>
  <td>
    <select name=emvis067 onchange="RemoteEmrUpdate(UpdateForm.admissno,UpdateForm.emvis067);">
      <option value=""></option>
      EMRWEB02.01.227.2
    </select>
  </td>
</tr>
-->
 <tr>
	<td class=DataLabel>First Specialty Paged Date</td>
        <input type=hidden name=AC value="AC">
        <input type=hidden name=DEL value="DEL">
      </td>
      <td class=DataLabel>
        <input type=text name=emvis073 title="First Specialty Paged Date" tabindex=-1
               value="%EMRWEB02.01.233.0" readOnly class=readOnly size=12>
        Time
        <input type="text" name=emvis083 size="8" value="%EMRWEB02.01.243"
          readOnly class=readOnly tabindex=-1 title="First Specialty Paged Time">
      </td>
	<td>Expected Ward</td>
    <td><input name=emvis116 title="Expected Ward" size=4 maxlength=3 
     value='%EMRWEB02.01.149.1' id=emvis116
     onblur="validateWard(emvis116,warddesc,emvis074,emvis084);">
       <input name=warddesc size=30 Class=Readonly readonly
        value='%EMRWEB02.01.149.0'>
       <img src=../images/SelectLink.gif border=0
       onclick="if (checkDisabled(document.getElementById('emvis116')))
                {return;}
                LookupPage(emvis116,warddesc,'Lookup_ward0000_000',emvis116);">
       <img class=Icon src="../images/erase.gif"
        onClick="if (checkDisabled(document.getElementById('emvis116')))
                 {return;}
                 validateWard(DEL,warddesc,emvis074,emvis084);"></td>
</tr>
<!-- end of change -->

<!-- 01 : CTAS : added fields: smoking status, alcohol involved, 
specialty paged, specialty accept date/time
-->
<tr>
	<td>First Specialty Paged</td>
	<td><input name=emvis169 title="First Specialty Paged" size=6 maxlength=3
		value='%EMRWEB02.01.290.1' readOnly class=readOnly tabindex=-1>
		<input name=unitdesc size=30 Class=readOnly readOnly 
		value='%EMRWEB02.01.290.0' tabindex=-1>
		<select title="First Specialty Paged" name=specialty tabindex=-1
			readOnly class=readOnly style="visibility:hidden"
			onchange="setSpecialty(specialty,emvis169,unitdesc,emvis073,emvis083,emvis077);"
			class="SelectBig">
		<option></option>
		%EMRWEB02.01.290.2
		</select>
	</td>
	<td class=DataLabel>%STANDARD.01.017.A7</td>
	<td>
	<select name=emvis047 id=emvis047
		onchange="updateSmokingStatus();" 
		title="%STANDARD.01.017.A7">
		<option></option>
		%EMRWEB02.01.207.2
	</select>
	</td>
<tr>
  <td class=DataLabel>First Specialty Accept Patient Date</td>
   <td class=DataLabel>
      Date
      <input type="text" name=emvis077 size="12"
        title="Specialty Accept Patient Date" readOnly class=readOnly
        onblur="setDT(emvis077,emvis087,null);updateSpecialtyAcceptDate();"
        value="%EMRWEB02.01.237.0" tabindex=-1>
      Time
      <input type="text" name=emvis087 size="8" value="%EMRWEB02.01.247" tabindex=-1
        title="Specialty Accept Patient Time" readOnly class=readOnly
        onblur="setDT(emvis077,emvis087,null);updateSpecialtyAcceptTime();">
      <img src="../images/stopwat1.gif" name=image02
        style="visibility:hidden" tabindex=-1
        onClick="setStopWatch(emvis077,emvis087,emvis116);">
    </td>
  <td>Alcohol Involved</td>
  <td>
    <select name=emvis067 id=emvis067
		onchange="updateAlcoholInvolvedStatus();"
		title="Alcohol Involved">
      <option></option>
      %EMRWEB02.01.227.2
    </select>
  </td>	
</tr>
<!-- end of change -->

<tr><td colspan=4 align=center> 
<!-- 01 : CTAS : remove Injury Data button
    <input type=button class="button" value="Injury Data" name=injbuttn
     onClick='InjuryData();'> 
-->
<!-- end of change -->
    </td></tr>
<!-- 01 : CTAS : Add buttons -->
<tr><td colspan=4>&nbsp;</td></tr>
<tr>
 	<td colspan=4 align=center>
	<!-- ED Visit Flow -->
	<input type=button class="button" value="ED Visit Flow" 
		onclick="callEDVisitFlow();">
	<!-- Observations -->
	<input type=button class="button" value="Observations" 
		onclick="callObservations();">
	<!-- Injury Data -->
	<!-- 03 : TAS : Add name and type to button properties -->
	<input type=button class="button" value="Injury Data" 
	type=button disabled name="InjurydatBut" onclick="callInjuryData();">
	<!-- end of change -->
	<!-- Work Capacity -->
	<!-- 02 : TAS : Remove Work capacity
	<input type=button value="Work Capacity" tabindex=38 class="button" name="WC"
	onclick="callWC();">
	-->
	<!-- Tracking -->
	<input type=button class="button" value="Tracking" 
		onclick="callTracking();">
	<!-- Bed Request -->
	<input type=button class="button" value="Bed Request" 
		onclick="addBedRequest();">
	</td>
</tr>
<tr>
	<td colspan=4 align=center>
		 <input type=button class="button" value="Doctor Handover"
		 onClick='NurseData();'>
		<input type=button class="button" 
		 value="Nurse Handover" onClick='DoctorData();'>
    </td>
</tr>
<!-- end of change -->
</table>
</form>

<form name=AddDiagnosis method=post action=emrweb06.pbl>
<input type=hidden name=reportno value="2">
<input type=hidden name=template value="002">
<input type=hidden name=updatety value="A">
<input type=hidden name=nextpage value="1">
<input type=hidden name=redirect value="%EMRWEB02.01.001.emrweb02.01.100">
<input type=hidden name=urnumber value="%EMRWEB02.01.003">
<input type=hidden name=admissno value="%EMRWEB02.01.081">
<input type=hidden name=emvcd001 value="%EMRWEB02.01.081">
<input type=hidden name=emvcd002 value="005">
<input type=hidden name=emvcd004 value="5">
<input type=hidden name=emuty001 value="EMRD">
<input type=hidden name=emvcd005 value="">
<input type=hidden name=emvcd006 value="   ">
<input type=hidden name=emvcd031 value="1">
<input type=hidden name=updateky value="%EMRWEB02.01.449">
<input type=hidden name=webuseri value="%STANDARD.01.008">
</form>
<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=regexstm value=102>
<input type=hidden name=newstand value=1>
<input type=hidden name=urnumber value="%EMRWEB02.01.003">
<input type=hidden name=admissno value="%EMRWEB02.01.081">
<input type=hidden name=nextpage value="4">
<input type=hidden name=emrgflag value="Y">
<input type=hidden name=MenuType value="11">
<!-- 03 : CTAS : Add claim type to patient links -->
<input type=hidden name=emvis008 value="%EMRWEB02.01.108    ">
<!-- end of change -->
<input type=hidden name=webuseid value="%STANDARD.01.008">
<!-- 01 : CTAS : Add fields for Bed Request link -->
<!-- as per CSC, d_ptvitype value is always 1 for ED visits-->
<input type=hidden name=d_ptvitype value="1">
<input type=hidden name=d_emvistat value="%EMRWEB02.01.147">
<!-- end of change -->
</form>
<form name=HiddenFields>
<input type=hidden name=InjuryIndicator value="%EMRWEB02.01.447">
<input type=hidden name=DoctorCode value="%EMRWEB02.01.107.001">
<input type=hidden name=DischargeComplete value="%EMRWEB02.01.147">
<input type=hidden name=Diag01 value="%EMRWEB02.01.437">
<input type=hidden name=Diag02 value="%EMRWEB02.01.438">
<input type=hidden name=Diag03 value="%EMRWEB02.01.439">
<input type=hidden name=Diag04 value="%EMRWEB02.01.440">
<input type=hidden name=Diag05 value="%EMRWEB02.01.441">
<input type=hidden name=Diag06 value="%EMRWEB02.01.442">
<input type=hidden name=Diag07 value="%EMRWEB02.01.443">
<input type=hidden name=Diag08 value="%EMRWEB02.01.444">
<input type=hidden name=Diag09 value="%EMRWEB02.01.445">
<input type=hidden name=Pres01 value="%EMRWEB02.01.104">
<input type=hidden name=Pres02 value="%EMRWEB02.01.105">
<input type=hidden name=Pres03 value="%EMRWEB02.01.174">
<input type=hidden name=Pres04 value="%EMRWEB02.01.175">
<input type=hidden name=Pres05 value="%EMRWEB02.01.176">
<input type=hidden name=Pres06 value="%EMRWEB02.01.177">
<input type=hidden name=prcom001>
</form>
<script type="text/javascript">
if(EmergencyFullScreens) {
  top.document.all.menu.height='744';
  top.document.all.content.height='0';
}
 MedNoteLine="%EMRWEB02.01.436"
 NoteArray=MedNoteLine.split("|");
 NewNotes=NoteArray[0]
 for (var j=1; j < NoteArray.length; j++) {
    if (!isWhitespace(NoteArray[j])) {
       NewNotes=NewNotes+"\n"+NoteArray[j];
    } }
 document.UpdateForm.medichis.value=NewNotes;
 InjData="%EMRWEB02.01.188";
 if ( InjData =="1" ) {
    document.UpdateForm.injbuttn.className="RedButton";
 }
function swapAdateRdate()
{
  UpdateForm.emvis165.value="%EMRWEB02.01.101.0";
  UpdateForm.emvis166.value="%EMRWEB02.01.102";
}
function CheckAdateHCPdate(hcpDate){
  arrivalDate="%EMRWEB02.01.101.0";
  if(arrivalDate==""){ return;}
  if(hcpDate==""){ return;}
  aDate = new Date(arrivalDate);
  hDate = new Date(hcpDate);

  if(hDate<aDate ){
      alert("Warning: Responsible HCP Date cannot be prior to arrival date");
      UpdateForm.emvis165.value="";
      return false;
  }
  RemoteEmrUpdate(SelectScreen.admissno, UpdateForm.emvis165);
}
function checkTATime(theForm,checkHdate,checkHtime)
{
 checkAdate="%EMRWEB02.01.101.0";
 checkAdate=checkAdate.replace(/:/g,"");
 checkAtime="%EMRWEB02.01.102";
 checkAtime=checkAtime.replace(/:/g,"");
 checkHtime=checkHtime.replace(/:/g,"");
 if(checkAdate==""){ return;}
 if(checkHdate==""){ return;}
 if(checkHtime==""){ return;}
 if(checkAtime==""){ return;}
 if (SetDateYYYYMMDD(checkAdate)>=SetDateYYYYMMDD(checkHdate)) {

   if(checkAtime>checkHtime){
     alert("Responsible HCP Time cannot be prior to arrival time");
     UpdateForm.emvis166.value="";
     return false;
   }
 }
 RemoteEmrUpdate(SelectScreen.admissno, UpdateForm.emvis166);
 return true;
}
function UpdRHCPDoc(doctor) {
  if (isWhitespace(document.UpdateForm.emvis164.value)) {
     if (isWhitespace(document.UpdateForm.emvis164.defaultValue))  {
        return;
     }
  alert("Invalid doctor deletion - Please use the eraser icon");
  document.UpdateForm.emvis164.value=document.UpdateForm.emvis164.defaultValue;
  document.UpdateForm.emvis164.focus();
  return;
  }
  doctor.value=doctor.value.toUpperCase()
  a=trim(doctor.value);
  b=trim(doctor.defaultValue);
  if (document.UpdateForm.emvis164.value.substr(0,1) == " ") {
      document.UpdateForm.emvis164.value = a;
  }
  if (a == b)  { return; }
  var serverURL   = "../cgi-bin/patweb80.pbl?reportno=3" +
                    "&valdcode=" + doctor.value.replace(/ /g,"+")


  if (IEBrowser) {
    var returnValue = RSExecute(serverURL);

    if (returnValue.status!=0) {
      document.UpdateForm.emvis164.value=document.UpdateForm.emvis164.defaultValue;
      document.UpdateForm.doctnam2.value=document.UpdateForm.doctnam2.defaultValue;
      document.UpdateForm.emvis164.focus();
      return;
    }
        var serverURL = "../cgi-bin/emrweb08.pbl?reportno=21" +
           "&admissno=" + document.UpdateForm.admissno.value.replace(/ /g,"+") +
            "&emvis164=" + doctor.value.replace(/ /g,"+")

    var returnValue = RSExecute(serverURL);
    location.reload();
    if (returnValue.status==0) {
      if (top.menu.document.all.EmergencyFrame!=undefined) {
        top.content.location.reload();
      }
    }
  }
  else {
    var returnValue = RSExecuteFetch(serverURL);

    returnValue.then(
      function (returnValue) {
        returnValue = ParseFetchData(returnValue);  // parse fetch() result

        if (returnValue.status!=0) {
          document.UpdateForm.emvis164.value=document.UpdateForm.emvis164.defaultValue;
          document.UpdateForm.doctnam2.value=document.UpdateForm.doctnam2.defaultValue;
          document.UpdateForm.emvis164.focus();
          return;
        }
        var serverURL = "../cgi-bin/emrweb08.pbl?reportno=21" +
           "&admissno=" + document.UpdateForm.admissno.value.replace(/ /g,"+") +
            "&emvis164=" + doctor.value.replace(/ /g,"+")

        var returnValue = RSExecuteFetch(serverURL);

        returnValue.then(
          function (returnValue) {
            returnValue = ParseFetchData(returnValue);  // parse fetch() result

            location.reload();
            if (returnValue.status==0) {
              if (top.menu.document.all.EmergencyFrame!=undefined) {
                top.content.location.reload();
              }
            }
          }
        );
      }
    );
  }
}
function DelRHCPDoc() {
  if (isWhitespace(document.UpdateForm.emvis164.value)) { return; }
  doctor="      ";
  
  var serverURL = "../cgi-bin/emrweb08.pbl?reportno=21" +
      "&admissno=" + document.UpdateForm.admissno.value.replace(/ /g,"+") +
      "&emvis164=" + doctor.replace(/ /g,"+") 

  if (IEBrowser) {
    var returnValue = RSExecute(serverURL);

    location.reload();
    if (returnValue.status==0) {
      if (top.menu.document.all.EmergencyFrame!=undefined) {
        top.content.location.reload();
      }
    }
  }
  else {
    var returnValue = RSExecuteFetch(serverURL);

    returnValue.then(
      function (returnValue) {
        returnValue = ParseFetchData(returnValue);  // parse fetch() result

        location.reload();
        if (returnValue.status==0) {
          if (top.menu.document.all.EmergencyFrame!=undefined) {
            top.content.location.reload();
          }
        }
      }
    );
  }
}
</script>

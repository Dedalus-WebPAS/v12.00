<meta name="TemplateVersion" content="V12.00.00">
<meta name="TemplateHome" content="crdhb">
<meta name="HelpFileName" content="NoContextSet.html">
<script type="text/javascript" src="../js/emrweb0201004.js"></script>
<script type="text/javascript">

function ReturnToMap(){
  if(parent.TogglePanel==null){
	 // 01 : CTAS :Open a pop-up for Map
	 // parent.menu.location.href='emrweb01.pbl?reportno=1&template=1';
	 // 1. Open map view
	  open("../html/EmergencyMapFrameTAS.html","",
	  "fullscreen=yes,status=no,titlebar=no,resizable=no,toolbar=no,menubar=no,scrollbar=0");
	 // 2. Redirect page to Current Patients (Need to confirm)
	 PatientLink('emrweb01.pbl',1,2);
	 // end of change
  }
  else{
     parent.TogglePanel();
  }
}
function UpdDoctor(){
  if(UpdateForm.emcndoct.value==1){
     UpdEmrDoc(UpdateForm.emvis007);
  }
  else{
     UpdDoc(UpdateForm.emvis007);
  }
}
function SearchDoctor(){
  if(UpdateForm.emcndoct.value==1){
     DoctorEmrSearchFrame(UpdateForm.emvis007,UpdateForm.dummy3);
  }
  else{
     DoctorSearchFrame(UpdateForm.emvis007,UpdateForm.dummy3);
  }
}
function refreshTop(){
  if(parent.menu.document.readyState=="complete"){
     parent.menu.location.reload();
  }
}

// 01 : CTAS : Redirect to ACC screen
function redirectACC() {
var validateresult = validateMandatory(document.UpdateForm);
  if (validateresult==true) {
	PatientLink('patweb89.pbl',1,5);
  }
}
// end of change

// 01 : CTAS : add functions RequestBed() and BedRequestList() 
// homebuilt stringify function for older browsers
function ctasStringify(arr) {
	var result = '';
	if (arr) {
		result = '{';
		var i = 0;
		for (var key in arr) {
			if (i > 0) {
				result += ',"' + key + '":"' + arr[key].replace("\"","'") + '"';
			} else {
				result += '"' + key + '":"' + arr[key].replace("\"","'") + '"';
			}
			i++;
		}
		result += '}';
	}
	return result;
}

function RequestBed() {
	var validateresult = validateMandatory(document.UpdateForm);
	if (validateresult==true) {
		EMERGENCY_DEPT = "R16";
	
		// store data values to be passed to Bed Request in associative array
		var fldvalues = {};

		var complaintList = document.UpdateForm.emvis060;
		fldvalues["pmbrq004"] = EMERGENCY_DEPT;
		fldvalues["pmbrq005"] = document.UpdateForm.emvis007.value.replace(/ /g,"+");
		fldvalues["n_pmbrq005"] = document.UpdateForm.dummy3.value.replace(/ /g,"+");
		fldvalues["ptmis020"] = 
			complaintList.options[complaintList.selectedIndex].text.replace(/ /g,"+");
		
		// stash data as JSON in session cookie
		var d = new Date();
		var id = d.getTime().toString();
		SetCookie(id, encodeURI(ctasStringify(fldvalues)), 10);
	
		// open Request Bed template as popup
		PatientLinks.cid.value=id;
		PatientLinks.reportno.value="08"
		PatientLinks.template.value="002"
		PatientLinks.action="patweb10.pbl"
		Left=(document.body.clientWidth-850)/2
		DFrameSubmit(PatientLinks,0,Left,850,450);
	}
}

function BedRequestList() {
var validateresult = validateMandatory(document.UpdateForm);
  if (validateresult==true) {
	PatientLink('patweb10.pbl',8,1);
  }
}
// end of change 
// 01 : CTAS : Redirect immediately to emrweb0201001
// overloaded from ../js/emrweb0201004.js
// Patient Search will trigger from there
function checkurno() {
  //if (UpdateForm.urnumber.value==0) {
  // SearchLink('patweb90.pbl',1,101);
  //}
  //else {
   PatientLink('emrweb02.pbl',1,1);
  //}
}
// end of change 

function reEnable() {
  reEnableControl('updbtn');
}

</script>
</head>

%START.OF.PAGE
<body onload="PageLoad(event);" onunload="submitFormRedirect();">
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%EMRWEB02.01.003";
PatientVIS="%EMRWEB02.01.081";
PatientNAM="%EMRWEB02.01.002";
PatientSTA="%EMRWEB02.01.086.078";
PatientALT="%EMRWEB02.01.084";
PatientSEX="%EMRWEB02.01.019";
PatientDOB="%EMRWEB02.01.020";
PatientAGE="%EMRWEB02.01.021";
PatientLOC="%EMRWEB02.01.083";
PatientPRI="%EMRWEB02.01.086.066.1";
PatientUNT="%EMRWEB02.01.066.0";
PatientIND="%EMRWEB02.01.086.091";
GpCOD="%EMRWEB02.01.086.084.001";
GpNAM="%EMRWEB02.01.086.084.081";
GpPRAC="%EMRWEB02.01.086.085.001";
GpPRACCNT="%EMRWEB02.01.086.085.002";
GpPRACNAM="%EMRWEB02.01.086.085.005";
PatientARR="%EMRWEB02.01.101.0 %EMRWEB02.01.102";
PatientSEE="%EMRWEB02.01.130.0 %EMRWEB02.01.131";
PatientTRI="%EMRWEB02.01.103.3";
PatientECLC="%EMRWEB02.01.484.1";
PatientCLH="%STANDARD.01.017.CL";
PatientEHFT="%EMRWEB02.01.485";
InsertEmergencyHeader()
</script>

<table width=95% align=center border=0 cellspacing=0 cellpadding=1>
<form name=UpdateForm action="emrweb02.pbl" method=post
 onsubmit='return validateMandatory(this);'>
 <input type=hidden name=reportno value="01">
 <input type=hidden name=resavail value="0">
 <input type=hidden name=template value="001">
 <input type=hidden name=admissno value="%EMRWEB02.01.081">
 <input type=hidden name=urnumber value="%EMRWEB02.01.003">
 <input type=hidden name=formactn value="C1">
 <input type=hidden name=redirect value="emrweb02.pbl?reportno=1&template=4">
 <input type=hidden name=updateky value="%EMRWEB02.01.404">
 <input type=hidden name=updttype value="UPDAT">
 <input type=hidden name=nextpage value=17>
 <input type=hidden name=username>
 <input type=hidden name=password>
 <input type=hidden name=dummy1>
 <input type=hidden name=dummy2>
 <input type=hidden name=emvis004>
 <input type=hidden name=emvis005>
 <input type=hidden name=emvis135>
 <input type=hidden name=emvis136>
 <input type=hidden name=emvis137>
 <input type=hidden name=emvis138>
 <input type=hidden name=emvis147>
 <input type=hidden name=emvis118 value="%EMRWEB02.01.003">
 <input type=hidden name=savdesc1>
 <input type=hidden name=savmanag>
 <input type=hidden name=searchgn value="%EMRWEB02.01.009">
 <input type=hidden name=searchsn value="%EMRWEB02.01.010">
 <input type=hidden name=searchps value="%EMRWEB02.01.019">
 <input type=hidden name=searchpd value="%EMRWEB02.01.020">
 <input type=hidden name=discstat value="%EMRWEB02.01.147">
 <input type=hidden name=emcndoct value="%EMRWEB02.01.455">
 <input type=hidden name=webuseid value="%STANDARD.01.008">

<tr valign=top>
  <td class=DataLabel width=15%>
    Presenting Complaint
    <input type=hidden name=emrviscat value="el">
  </td>
  <td>
    <input type="text" size=10 tabindex=1 name=test value="%EMRWEB02.01.220.1" 
     onKeyUp='UpCase(this);getPresentCom(this,UpdateForm.emvis060,emrviscat);'
     onblur="emvis060TopFrame();">
    <select name=emvis060 class=SelectBig onblur="emvis060TopFrame();"
     onchange="SetDirty();" tabindex=2>
      <option value="%EMRWEB02.01.220.1">%EMRWEB02.01.220.0</option>
    </select>
  </td>
  <td colspan=4>

<!-- 02 : TAS : Make Triage Notes read only --> 
   <textarea name=prcom001 wrap=hard cols=50 rows=2 readonly tabindex=5
             style="resize:none">
   </textarea>
<!--
   <textarea name=prcom001 wrap=hard cols=50 rows=2 onblur="prcom001TopFrame();" tabindex=5></textarea>
-->
<!-- end of change -->
 </td>
</tr>

<tr>
  <td class=DataLabel>Location</td>
  <td>
  <!-- 03 : Merge Task 0873230 -->
    <input type=hidden name=name_emvis006 title="Location"
     value="%EMRWEB02.01.106.0">
    <select class=SelectMed name=emvis006  tabindex=10
	onchange='if(validateattendingdoctor()){refreashTop();}'/>							
      <option></option>
      %EMRWEB02.01.106.2
    </select>
	<!-- End of change -->
<!-- 01 : CTAS : hide location notes field (emvis149)
    <input type=text size=30 name=emvis149 title="Location Note" tabindex=11
     value="EMRWEB02.01.136">
-->
<!-- end of change -->
  </td>
  <td rowspan=4 class=DataLabel valign=top>
    <!-- 01 : CTAS : Rename
	Management Notes
	-->
	Advice to GP/Patient
	<!-- end of change -->
    <br>
    <textarea name=dismnote rows=4 wrap=hard readonly tabindex=-1 notab cols=60>%EMRWEB02.01.471.002.0</textarea>
  </td>
</tr>

<!--
   <input type=hidden name=textspace>  
   onKeyDown="textCounter(this,document.UpdateForm.textspace,700)"
   onKeyUp="textCounter(this,document.UpdateForm.textspace,700)"
-->

<tr>
  <td class=DataLabel>Doctor</td>
  <td>
    <input type=text size=6 name=emvis007 title="Doctor Code" 
     value="%EMRWEB02.01.107.001" tabindex=15 onfocus="disableObject('updbtn')" 
     onblur="UpdDoctor();setTimeout(reEnable,2000);">
    <input type=text size=39 name=dummy3 title="Doctor Name" readonly 
     class=Readonly value="%EMRWEB02.01.107.003" tabindex=-1 notab>
    <img src="../images/erase.gif" align=absmiddle onClick="DelDoc();">
    <img src="../images/SearchIcon.gif" onClick="SearchDoctor();">
    <input type=button class="button" value="Doctor Handover" 
     onClick='DoctorData();' tabindex=16>
  </td>
</tr>

<tr>
  <td class=DataLabel>
    Treating Nurse
    <input type=hidden name=gnm tabindex=-1 notab>
  </td>
  <td>
    <input type=text size=6 name=emvis130 title="Nurse Code"
     value="%EMRWEB02.01.164.1" tabindex=20 onfocus="disableObject('updbtn');" 
     onblur="UpdNur(emvis130);setTimeout(reEnable,2000);"> 
    <input type=text size=39 name=dummy5 title="Nurse Name" readonly
     class=Readonly value="%EMRWEB02.01.164.0" tabindex=-1 notab>
    <img src="../images/erase.gif" align=absmiddle onClick="DelNurse();">
    <img src="../images/SearchIcon.gif"
     onClick="NurseSearchFrame(emvis130,dummy5)">
    <input type=button class="button" tabindex=21 value="Nurse Handover" 
     onClick='NurseData();'>
  </td>
</tr>

<tr>
  <td>Triage Nurse</td>
  <td>
    <input type=text size=50 name=name_triage title="Triage Nurse" readonly 
     Class=Readonly value="%EMRWEB02.01.161.0" tabindex=-1 notab>
  </td>
</tr>

<tr>
  <td colspan=6 align=center>
   <!-- 03 : Merge Task 0873230 
    <input type=button class="button" value="Update" 
     onClick="onUpdate();" tabindex=30> -->
	<input type=button class="button" value="Update" tabindex=30
         id=updbtn  onclick="tempDisable(this);
              if(validateattendingdoctor()){onUpdate();}"/>
	<!-- End of change -->
	<!-- 01 : CTAS : Rename to Work screen
    <input type=button class="button" value="Clinical" 
     onClick="PatientLink('emrweb02.pbl',1,100);" tabindex=31> 
	 -->
	 <input type=button class="button" value="Work Screen" 
     onClick="PatientLink('emrweb02.pbl',1,100);" tabindex=31> 
	 <!-- end of change -->
    <input type=button class="button" value="Registration" 
     onClick="checkurno();" tabindex=32>
	<!-- 01 : CTAS : To open ACC screen
    <input type=button class="button" value="Injury Data" name=injbuttn
     onClick="SmallFrameEmr('71');" tabindex=33> 
	-->
	<input type=button class="button" value="Injury Data" name=injbuttn
     onClick="redirectACC();" tabindex=33> 
	<!-- end of change -->
    <input type=button class="button" value="Outstanding" 
     onClick="SmallFrameEmr('51');" tabindex=34>
    <input type=button class="button" value="Discharge" 
     onClick="checkUR(document.UpdateForm.discstat.value);" tabindex=35>
    <input type=button class="button" value="Labels & Forms" 
     onClick="SmallFrameEmr('5');" tabindex=36>
    <input type=button class=RedButton value="Return to Map" 
     onClick="ReturnToMap()" tabindex=37>
    <input type=button class="button" value="Jump Queue" 
     onClick="updateNext();" tabindex=38>
	 <!-- 01 : CTAS : Rename to "Advice to patient"
    <input type=button class="button" value="Man. Notes" 
     onClick="AddMgtNote()" tabindex=39>
	 -->
	 <input type=button class="button" value="Advice to GP/Patient" style="width:120px"
     onClick="AddMgtNote()" tabindex=39>
	 <!-- end of change -->
<!-- 01 : CTAS : add Request Bed and Bed Request List buttons 
	 <input type=button class="button" value="Request Bed" 
     onClick="RequestBed()" tabindex=40> 
	 <input type=button class="button" value="Bed Request List" 
     onClick="BedRequestList()" tabindex=41> 	 
-->
<!-- end of change -->
  </td>
</tr>
</form>
</table>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=regexstm value=102>
<input type=hidden name=newstand value=1>
<input type=hidden name=webuseid value="%STANDARD.01.008">
<input type=hidden name=urnumber value="%EMRWEB02.01.003">
<input type=hidden name=admissno value="%EMRWEB02.01.081">
<input type=hidden name=MenuType value="11">
<input type=hidden name=checksub value="0">
<input type=hidden name=emvis147>
<input type=hidden name=cid>
</form>

<form name=HiddenFields>
<input type=hidden name=InjuryIndicator value="%EMRWEB02.01.447">
<input type=hidden name=CheckUr value="%EMRWEB02.01.448">
<input type=hidden name=DoctorCode value="%EMRWEB02.01.107.001">
<input type=hidden name=NurseCode value="%EMRWEB02.01.164.1">
<input type=hidden name=Location value="%EMRWEB02.01.083">
<input type=hidden name=DischargeComplete value="%EMRWEB02.01.147">
<input type=hidden name=Pres01 value="%EMRWEB02.01.104">
<input type=hidden name=Pres02 value="%EMRWEB02.01.105">
<input type=hidden name=Pres03 value="%EMRWEB02.01.174">
<input type=hidden name=Pres04 value="%EMRWEB02.01.175">
<input type=hidden name=Pres05 value="%EMRWEB02.01.176">
<input type=hidden name=Pres06 value="%EMRWEB02.01.177">
<input type=hidden name=linkadmn value="%EMRWEB02.01.081">
</form>

<script type="text/javascript">

 CTypeAdm = "%EMRWEB02.01.252";

 if(CTypeAdm == "Yes"){
    document.UpdateForm.emvis147.value=1; 
    document.PatientLinks.emvis147.value=1; 
 }
 else{ 
    document.UpdateForm.emvis147.value=0; 
    document.PatientLinks.emvis147.value=0;
 }

 ShowReg = "%EMRWEB02.01.461";

 if(ShowReg=="1"){
    checkurno();
 }

 InjData = "%EMRWEB02.01.188";

 if(InjData =="1"){
    document.UpdateForm.injbuttn.className="RedButton";
 }
 if(document.HiddenFields.DischargeComplete.value=="4"){
    alert("Warning: This visit is Cancelled");
 }
</script>

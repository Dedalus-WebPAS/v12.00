<meta name="TemplateVersion" content="V12.00.00">
<meta name="TemplateHome" content="crdhb">
<meta name="HelpFileName" content="NoContextSet.html">
<script type="text/javascript" src="../js/oprweb01.js"></script>
<script type="text/javascript" src="../js/oprweb0109002.js"> </script>
%START.OF.PAGE
<script type="text/javascript">
function showACC(theForm) {
  checkInd=theForm.patclaim.value.substr(3,5)
  if (checkInd.search(/W/g) >= 0) {
      ACCHeading.innerHTML=acchd.innerHTML;
      ACCId.innerHTML=accorderid.innerHTML;
    } else {
      ACCHeading.innerHTML=blanklabel.innerHTML;
      ACCId.innerHTML=blanklabel.innerHTML;
    }
}

function RemoveQuote(Field) {
    Field.value=Field.value.replace(/\"/g,"");
    Field.value=Field.value.replace(/\'/g,"");
}
function changeOperation(theForm) {   
for (var i = 0; i < theForm.operpref.length; i++) {
 if (theForm.operpref.options[i].selected == true) {
  theForm.elements["operdes1"].value=theForm.operpref.options[i].text }
 }
}
function changeAdmitDate(theForm) {   
for (var i = 0; i < theForm.patadmdt.length; i++) {
 if (theForm.patadmdt.options[i].selected == true) {
  theForm.elements["operdes3"].value="Admit:"+theForm.patadmdt.options[i].text }
  }
}
function Check(){
 if(!validateMandatory(AddForm)) 
   return; 
 AddForm.patadmdt.disabled=false
 AddForm.bkrec005.disabled=false
//
 if(!CheckBookDate()) {
   return;
 }
//
var timecalc = parseInt(AddForm.operexpd.value) + 
               parseInt(AddForm.sesendtm.value) +
               parseInt(AddForm.sesprptm.value)
if (timecalc > AddForm.sesdurtm.value) {
   if(confirm("Session will be Overbooked, Ok to Continue")) {
       formSubmit();
       }
   else document.CancelBook.submit();
    }
else formSubmit();
}
function chkDOL() {
if(!isWhitespace(AddForm.listdate.value)){
  if(!ChkDateTime(AddForm.listdate,null,AddForm.patadmdt,null)){
      alert("Confirmed admission date cannot be before Date on List");}
  }
}

function formSubmit() {
  p=document.AddForm
  validateSuspension(p.urnumber,p.opdadate,p.datefrom,p.dateto);
  if(p.datefrom.value!='0'){
     ans=confirm("Warning : Patient has a Suspension record for period \n" +
     "\t" + p.datefrom.value  + " - " + p.dateto.value);
     if(ans!=true) {
        return;
     }
  } 
  if(!isWhitespace(AddForm.listdate.value)){
    if(!ChkDateTime(AddForm.listdate,null,AddForm.patadmdt,null)){
        alert("Confirmed admission date cannot be before Date on List");
        return;
    }
  }
  if(ChkDateTime(AddForm.patadmdt,null,AddForm.bookdate,null)){
     CaseList=GetContentCookie("CasePath");
     if(CaseList!="unknown") {
        AddForm.nextlink.value=CaseList;
     }
     if(document.getElementById('admitnow').checked && 
        isWhitespace(document.AddForm.admisnum.value)){
        admission = "%OPRWEB01.09.325";
        document.AddForm.nextpage.value="8";
        document.AddForm.redirect.value="patweb89.pbl?reportno=1&template=20"
        + "&urnumber="+document.AddForm.urnumber.value.replace(/ /g,"+")
        + "&admissno="+admission.replace(/ /g,"+");
        AddForm.submit();
     }
     else{
       AddForm.submit(); 
     }
  }
  else {
     alert("Theatre Booking cannot be before Admission Date");
  }
}

function setCombo(){
  // 01 : CTAS : Remove this call as infection status is removed
  // MenuOver(AddForm.operknow);
  // end of change
}

function checkWatEntry(){
  if(AddForm.patadmdt.value != ""){
     AddForm.patadmdt.disabled=true;
  }
  if(AddForm.bkrec005.value != ""){
     AddForm.bkrec005.disabled=true;
  }

//Patient Type
  for(var i=0; i<document.AddForm.bkrec019.length; i++) {
      if(document.AddForm.bkrec019.options[i].value.substr(0,3)==
         document.AddForm.d_wattr024.value.substr(0,3)) {
         document.AddForm.bkrec019.selectedIndex=i; 
      } 
  }
}

function DisableIcon(field) {
  if(field.disabled == true) {
     alert(field.title+" is for display only");
     AddForm.bokrx002.focus();
  }
}
// Check if booking date is in the past (warning)
function CheckBookDate(){
      var strtDay  = document.AddForm.bookdate.value.substring(0,2);
      var strtMon  = document.AddForm.bookdate.value.substring(3,6);
      var strtYear = document.AddForm.bookdate.value.substring(7,11);
      strtMon = GetMonthNumber(strtMon);

      var strtDate = strtYear + strtMon + strtDay
      if(!CheckFuture(strtDate)){
        if(!confirm("Warning: Booking date is prior to current date.")){
          return false;
        }
      }
      return true;
}
function valClaimCode() {
  if (document.AddForm.patclaim.value=="") {
  validateCode(41,AddForm.urnumber,AddForm.claimc);
  for (var i =0 ; i < document.AddForm.patclaim.length; i++) {
//    alert(AddForm.patclaim.options[i].value.substr(0,3));
    if (document.AddForm.claimc.value==
        trim(document.AddForm.patclaim.options[i].value.substr(0,3))){
          document.AddForm.patclaim.selectedIndex=i;
    }
  }
 }
}

function loadProcedureDescription()
{
  var operprv1 = document.getElementById("operprv1");
  var operprv2 = document.getElementById("operprv2");
  var operprv3 = document.getElementById("operprv3");

  var mbsdesc1 = document.getElementById("mbsdesc1");
  var mbsdesc2 = document.getElementById("mbsdesc2");
  var mbsdesc3 = document.getElementById("mbsdesc3");
  
  var operdes1 = document.getElementById("operdes1");
  var operdes2 = document.getElementById("operdes2");
  var operdes3 = document.getElementById("operdes3");

  validateCode(7,operprv1,mbsdesc1);
  if (isWhitespace(operdes1.value)) {
    operdes1.value=mbsdesc1.value;
  }

  validateCode(7,operprv2,mbsdesc2);
  operdes2.value=mbsdesc2.value;
  
  validateCode(7,operprv3,mbsdesc3);
  operdes3.value=mbsdesc3.value;
}

function PageLoadExtended()
{
  PageLoad();
  checkWatEntry();
  setCombo();
  DisplayTrnSrc(AddForm.opdea037);
  GetTheatreRequestCookies();
  ChkInp();
  valClaimCode();
  loadProcedureDescription();
  SetAdmitNow();
  showACC(AddForm);

  FilterMentalHealth(document.AddForm.mh_visit.value,
    document.AddForm.opdea037,'13');
  FilterMentalHealth(document.AddForm.mh_visit.value,
    document.AddForm.bkrec019,'14');
}
function setTransferSource(transrc) {
  DisplayTrnSrc(AddForm.opdea037);
  AddForm.trnsfsrc.value=transrc;
  validateCode(9,AddForm.trnsfsrc,AddForm.trandesc);
}
// 01 : CTAS : Add field switch for procedure
function checkProc() {
	var proc1 = document.AddForm.operprv1.value.replace(/ /g,"");
	var proc2 = document.AddForm.operprv2.value.replace(/ /g,"");
	var proc3 = document.AddForm.operprv3.value.replace(/ /g,"");
	
	if ((proc1 == "") && (proc2 != "") && (proc3 == "")) {
		document.AddForm.operprv1.value = document.AddForm.operprv2.value;
		document.AddForm.operprv2.value = "";
		document.AddForm.mbsdesc1.value = document.AddForm.mbsdesc2.value;
		document.AddForm.mbsdesc2.value = "";
		document.AddForm.operdes1.value = document.AddForm.operdes2.value;
		document.AddForm.operdes2.value = "";
	}
	else if ((proc1 == "") && (proc2 != "") && (proc3 != "")) {
		document.AddForm.operprv1.value = document.AddForm.operprv2.value;
		document.AddForm.operprv2.value = document.AddForm.operprv3.value;
		document.AddForm.operprv3.value = "";
		document.AddForm.mbsdesc1.value = document.AddForm.mbsdesc2.value;
		document.AddForm.mbsdesc2.value = document.AddForm.mbsdesc3.value;
		document.AddForm.mbsdesc3.value = "";
		document.AddForm.operdes1.value = document.AddForm.operdes2.value;
		document.AddForm.operdes2.value = document.AddForm.operdes3.value;
		document.AddForm.operdes3.value = "";
	}	
	else if ((proc1 != "") && (proc2 == "") && (proc3 != "")) {
		document.AddForm.operprv2.value = document.AddForm.operprv3.value;
		document.AddForm.operprv3.value = "";
		document.AddForm.mbsdesc2.value = document.AddForm.mbsdesc3.value;
		document.AddForm.mbsdesc3.value = "";
		document.AddForm.operdes2.value = document.AddForm.operdes3.value;
		document.AddForm.operdes3.value = "";
	}			
	else if ((proc1 == "") && ((proc2 == "") || (proc3 != ""))) {
		document.AddForm.operprv1.value = document.AddForm.operprv3.value;
		document.AddForm.operprv3.value = "";
		document.AddForm.mbsdesc1.value = document.AddForm.mbsdesc3.value;
		document.AddForm.mbsdesc3.value = "";
		document.AddForm.operdes1.value = document.AddForm.operdes3.value;
		document.AddForm.operdes3.value = "";
	}
	populateComments();
}
// end of change
// 01 : CTAS : populate comments field
function populateComments() {
	document.AddForm.opcom011.value=document.AddForm.mbsdesc1.value;
}
// end of change
// 04 : TAS : Merge task 0863964
function DisplayPreadmNotes() {
  var key17=AddForm.wattrkey.value.substr(0,17);
  if (!isWhitespace(key17)) {
    document.getElementById('prenotesdet').style.display = "";
  } else {
    document.getElementById('prenotesdet').style.display = "none";
  }
}
//End of change
</script>
</head>
<!-- 01 : CTAS : Add focus field -->
<!-- 04 : TAS : Merge task 0863964 --add DisplayPreadmNotes() -->
<body onload="PageLoadExtended();document.AddForm.bokrx003.focus();
              DisplayPreadmNotes();">
<!-- end of change -->
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%OPRWEB01.09.003";
PatientVIS="%OPRWEB01.09.081";
PatientNAM="%OPRWEB01.09.002";
PatientSTA="%OPRWEB01.09.086.078";
PatientALT="%OPRWEB01.09.084";
PatientSEX="%OPRWEB01.09.019";
PatientDOB="%OPRWEB01.09.020";
PatientAGE="%OPRWEB01.09.021";
PatientLOC="%OPRWEB01.09.083";
PatientPRI="%OPRWEB01.09.086.066.1";
PatientUNT="%OPRWEB01.09.066.0";
DoctorCOD="%OPRWEB01.09.082.003";
DoctorNAM="%OPRWEB01.09.082.002";
PatientAID="%OPRWEB01.09.086.090";
PatientIND="%OPRWEB01.09.086.091";
PatientCUR="%OPRWEB01.09.086.092";
PatientCLC="%OPRWEB01.09.086.093.1";
PatientCLH="%STANDARD.01.017.CL";
PatientHFT="%OPRWEB01.09.086.094";
PatientCDM="%OPRWEB01.09.086.095";
PatientVDH="%OPRWEB01.09.086.099.015";
InsertPatientHeader()
</script>

<div id=PatientMenu></div>
<div id=PageBodySection>

<form name=AddForm  method=post action=oprweb01.pbl>
<input type=hidden name=reportno value=10>
<input type=hidden name=template value=1>
<input type=hidden name=urnumber value="%OPRWEB01.09.003">
<input type=hidden name=admissno value="%OPRWEB01.09.081">
<input type=hidden name=nextlink value="%OPRWEB01.09.102.oprweb01.03.003">
<input type=hidden name=bkrec008 value="THE">
<input type=hidden name=sesskeys value="%OPRWEB01.09.101">
<input type=hidden name=wattrkey value="%OPRWEB01.09.301">
<input type=hidden name=casekeys value="%OPRWEB01.09.301">
<input type=hidden name=bookdate value="%OPRWEB01.09.202">
<input type=hidden name=admisnum>
<input type=hidden name=admndate value="%OPRWEB01.09.702">
<input type=hidden name=admntime value="%OPRWEB01.09.703">
<input type=hidden name=bkrec002 value="%OPRWEB01.09.204.003">
<input type=hidden name=sesdurtm value="%OPRWEB01.09.209">
<input type=hidden name=sesprptm value="%OPRWEB01.09.211">
<input type=hidden name=sesendtm value="%OPRWEB01.09.218">
<input type=hidden name=ptmis027 value="%OPRWEB01.09.726.1"> 
<input type=hidden name=ptmis068 value="%OPRWEB01.09.705.1">
<input type=hidden name=ptvis043 value="%OPRWEB01.09.729">
<input type=hidden name=ptmis009 value="%OPRWEB01.09.710.1">
<input type=hidden name=d_ptdaadts value="%OPRWEB01.09.793.0">
<input type=hidden name=ptmas024 value="%OPRWEB01.09.712.1">
<input type=hidden name=admpoint value="%OPRWEB01.09.503.1">
<input type=hidden name=listdate value="%OPRWEB01.09.309">
<input type=hidden name=admntype value="%OPRWEB01.09.711.3">
<input type=hidden name=caretype value="%OPRWEB01.09.713.3">
<input type=hidden name=ptcnhdps value="%OPRWEB01.09.801">
<input type=hidden name=admstats value="%OPRWEB01.09.704">
<input type=hidden name=opdadate value="%OPRWEB01.09.202">
<input type=hidden name=datefrom>
<input type=hidden name=dateto>
<input type=hidden name=d_wattr024 value="%OPRWEB01.09.331.1">
<input type=hidden name=nextpage value="1">
<input type=hidden name=redirect>
<input type=hidden name="claimc">
<input type=hidden name=opcnfdur value="%STANDARD.01.025.113.002.0.1">
<input type=hidden name="bkrec006" value="%OPRWEB01.09.327">
<input type=hidden name="bkrec007" value="%OPRWEB01.09.428">
<input type=hidden name="mh_visit" value="%OPRWEB01.09.840">
<input type=hidden name=bkthvick value=" ">
<input type=hidden name=bkthrdck value=" ">
<input type=hidden name=requestn value=" ">
<input type=hidden name=thetrqin id=thetrqin value=" ">
<input type=hidden name=thetrqvl id=thetrqvl value=" ">

<table border="0" cellpadding="0" cellspacing="0" width="100%" align=center>
<tr><td align=center class=HeadingCell>Theatre Booking Form</td></tr>
</table>

<table border="0" cellpadding="0" cellspacing="0" width="95%" align=center>
<tr><td width=15% class=DataLabel>Surgeon   </td>
    <td ><a href='javascript:DoctorViewFrame("%OPRWEB01.09.204.003")'>
         <b>%OPRWEB01.09.204.002 &nbsp; </a></td>
    <td width=15%>Anaesthetist   </td>
    <td><a href='javascript:DoctorViewFrame("%OPRWEB01.09.216.003")'>
         %OPRWEB01.09.216.002</a></td></tr>
<tr><td class=DataLabel>Unit</td>
    <td class=DataField>%OPRWEB01.09.213  </td></tr>

<tr><td width=15% class=DataLabel>Theatre  </td>
    <td class=DataField> %OPRWEB01.09.214.0 </td>
    <td class=DataLabel>Session Type</td>
    <td class=DataField>%OPRWEB01.09.269.0  </td></tr>

<tr><td class=DataLabel>Date  </td>
    <td class=DataField>%OPRWEB01.09.206 %OPRWEB01.09.202</td>
    <td class=DataLabel>Time  </td>
    <td class=DataField> %OPRWEB01.09.203 to %OPRWEB01.09.208</td></tr>

<tr><td colspan=4 align=center><hr width=100%></td></tr>
<tr><td></td><td></td>
    <td class=DataLabel>Confirmed Admission</td>
    <td class=DataLabel>
     <input type=text name=patadmdt size=12 maxlength=11 class=Mandatory
     onblur="checkDate(this,'Date');chkDOL();"
	 tabindex=23
     title="Admission Date" value="%OPRWEB01.09.506">
    <img src=../images/DateLookup.gif border=0 hspace=4 align=absmiddle
     onclick='javascript:DateLookupFrame(patadmdt)'
     onfocus='javascript:DisableIcon(patadmdt)' tabindex=-1>
    Time
    <input type=text name=bkrec005 size=6 tabindex=24
            title="Admission Time" class=Mandatory>
    <img src=../images/DateTimeStamp.gif  border=0 hspace=4 align=absmiddle
     onclick='javascript:SetCurrentDateTime(patadmdt,bkrec005)'
     onfocus='javascript:DisableIcon(bkrec005)'>
    <img src=../images/TimeLookup.gif border=0 hspace=4 align=absmiddle
    onclick='javascript:TimeLookupFrame(bkrec005)'
     onfocus='javascript:DisableIcon(bkrec005)'>
    </td></tr>

<tr><td></td><td></td>
    <td class=DataLabel>Proposed Admission</td>
    <td class=DataLabel>
     <input type=text name=watread2 size=12 maxlength=11
     class=Readonly readonly onblur="checkDate(this,'Date')"
	 tabindex=25
     title="Proposed Admission Date" value="%OPRWEB01.09.311">
    </td></tr>

<tr><td class=DataLabel>Admitting Point</td>
    <td class=DataField>
    <select name=bokrx003 title="Admitting Point"  class=Mandatory tabindex=1 >
    <option></option>
    %OPRWEB01.09.406.2
    </select></td>
    <td class=DataLabel>Proposed Operation</td>
    <td class=DataLabel>
     <input type=text name=watread3 size=12 maxlength=11
     class=Readonly readonly onblur="checkDate(this,'Date')"
	 tabindex=13
     title="Proposed Operation Date" value="%OPRWEB01.09.335">
    </td>
    </tr>
<!-- 01 : CTAS : make Exp Post Op Ward mandatory -->
<tr><td class=DataLabel>Exp. Post Op Ward</td>
    <td class=DataField>
    <select name=bokrx002 title="Exp.Post Op Ward" 
	tabindex=2 class=Mandatory >
    <option></option>
    %OPRWEB01.09.405.2
    </select></td>
<!-- end of change -->
    <td class=DataLabel>Intended Length of Stay </td>
    <td class=DataLabel>
    <input type=text name=bkrec033 size=4 maxlength=3 class=Integer
    value=%OPRWEB01.09.316 title="Intended Length of Stay">(days)</td>
    </tr>

<tr><td class=DataLabel>%STANDARD.01.017.P </td>
    <td class=DataField>
    <div id="PatCatFilter">
    <select name=bkrec019 title="%STANDARD.01.017.P " tabindex=3>
    <option></option>
    %STANDARD.01.007.P 
    </select>
    </div></td>
    <td class=DataLabel>Operation Type </td>
    <td><select name="opertype"
             title="Operation Type">
    <option></option>
    %OPRWEB01.09.614.2
    </select>
    </td>
    </tr>

<tr><td class=DataLabel>%STANDARD.01.017.CL</td>
    <td class=DataField>
    <select name="patclaim" title="%STANDARD.01.017.CL" class=Mandatory
            tabindex=4
            onchange=showACC(AddForm);>
     <option></option>
     %OPRWEB01.09.115.2
     </select></td>
     <td class=DataLabel>Admission Source</td>
     <td class=DataField>
     <div id="AdmSrcFilter">
     <select name="opdea037" title="Admission Source" class=Mandatory 
      onchange="DisplayTrnSrc(this);" tabindex=15>
     <option></option>
     %OPRWEB01.09.655.2
     </select>
     </div></td>
    </tr>

     <tr><td><div id=ACCHeading></div></td>
         <td><div id=ACCId></div></tr>

<tr><td class=DataLabel>Anaesthetic Type</td>
    <td><select name="operanae" tabindex=5
             title="Anaesthetic"
             class=Mandatory>
    <option></option>
    %OPRWEB01.09.106.2
    </select></td>
    <td class=DataLabel><div id=TranSrcHeading></div></td>
    <td class=DataLabel><div id=TranSrc></div></td>
    </tr>

<tr><td class=DataLabel>Procedure</td>
    <td>
		<!-- 01 : CTAS : Call checkProc() -->
		<!--04 : TAS : Make Procedure mandatory -->
		<input type=text name=operprv1 size=9 value="%OPRWEB01.09.303"
        onblur="validateCode(7,operprv1,mbsdesc1);
               if(!isWhitespace(this.value)){operdes1.value=mbsdesc1.value};
			   checkProc();" id=operprv1
           title="Expected Proc Item 1" tabindex=6 class=Mandatory>
		<!-- end of change -->
		<input type=text readonly name=mbsdesc1 size=30
           title="Expected Proc Item 1 Name" tabindex=-1
              value="%OPRWEB01.09.306" id=mbsdesc1 >
     <img src="../images/SearchIcon.gif" class=Icon
     onclick="Icd10ProSearchFrame(operprv1,mbsdesc1)"></td>
    <td class=DataLabel> Duration </td>
    <td><div id=Duration></div></td>
    </tr>

<tr><td></td><td>
	<!-- 01 : CTAS : Call checkProc() -->
	<input type=text name=operprv2 size=9 id=operprv2
    onblur="validateCode(7,operprv2,mbsdesc2);operdes2.value=mbsdesc2.value;
			 checkProc();" tabindex=7
           title="Expected Proc Item 2" value="%OPRWEB01.09.350" >
	<!-- end of change -->
    <input type=text readonly name=mbsdesc2 size=30 id=mbsdesc2
           title="Expected Proc Item 2 Name" tabindex=-1>
    <img src="../images/SearchIcon.gif" class=Icon
     onclick="Icd10ProSearchFrame(operprv2,mbsdesc2)"></td>
<!-- 01 : CTAS : remove Blood Type -->
	<td></td><td></td>
</tr>
<!-- end of change -->	

<tr><td></td><td>
	<!-- 01 : CTAS : Call checkProc() -->
	<input type=text name=operprv3 size=9 id=operprv3
     onblur="validateCode(7,operprv3,mbsdesc3);operdes3.value=mbsdesc3.value;
				checkProc();" tabindex=8
           title="Expected Proc Item 3" value="%OPRWEB01.09.351" >
	<!-- end of change -->
    <input type=text readonly name=mbsdesc3 size=30 id=mbsdesc3
           title="Expected Proc Item 3 Name" tabindex=-1>
    <img src="../images/SearchIcon.gif" class=Icon
     onclick="Icd10ProSearchFrame(operprv3,mbsdesc3)"></td>
<!-- 01 : CTAS : remove Infection Status -->
	<td></td><td></td></tr>
<!-- end of change -->	

<tr valign=top>
    <td class=DataLabel>Full Description</td>
    <td><input type="text" size="45" maxlength=80 name="operdes1" 
           value="%OPRWEB01.09.306" tabindex=9 id="operdes1"
           title="Operation Description 1" onblur="RemoveQuote(this);">
    </td>
    <td class=DataLabel>Equipment Required 1</td>
    <td><select name="opdea032" tabindex=18
             title="Equipment Required 1">
    <option></option>
    %OPRWEB01.09.645.2
    </select>
    </td></tr>

<tr><td></td><td><input type="text" size="45" maxlength=80 name="operdes2" 
		tabindex=10 id="operdes2"
           title="Operation Description 2" onblur="RemoveQuote(this);"></td>

    <td class=DataLabel>Equipment Required 2</td>
    <td><select name="opdea033" title="Equipment Required 2" tabindex=19>
    <option></option>
    %OPRWEB01.09.646.2
    </select>
    </td></tr>

<tr><td></td><td><input type="text" size="45" maxlength=80 name="operdes3" 
		tabindex=11 id="operdes3"
           title="Operation Description 3" onblur="RemoveQuote(this);"></td>
		   
<!-- 01 : CTAS : remove Equipment Required 3 -->
    <td class=DataLabel>Equipment Loaned</td>
    <td><select name="opdea034" title="Equipment Loaned" tabindex=20>
    <option></option>
    %OPRWEB01.09.647.2
    </select>
    </td></tr>
	
	<tr><td class=DataLabel>Prosthesis Required</td>
    <td><input type="text" size="45" maxlength=40 name="opercomm" 
        tabindex=12 title="Prosthesis Required"></td>	
    <td class=DataLabel></td>
    <td></td></tr>		 
<!-- end of change -->
	
<tr><td class=DataLabel>Comments</td>
    <td colspan=3>
<textarea wrap=hard cols=60 rows=3 name=opcom011 tabindex=21>%OPRWEB01.09.359</textarea> 
</td></tr>
<!-- 04 : TAS : Merge task 0863964 Add new field-->
<tr id=prenotesdet valign=top><td class=DataLabel>Waiting List Pre-admission Notes</td>
  <td class=DataField colspan=3>
    <textarea wrap=virtual name=prenotes class=Readonly readonly
      cols=60 rows=3>%OPRWEB01.09.459</textarea>
  </td></tr>
<!-- End of change -->
<tr><td class=DataLabel>Date Booking Keyed        </td>
    <td class=DataField><input type=text size=12 name=bkrec034 class=Mandatory
		tabindex=22
        title="Date Booking Keyed" value="%STANDARD.01.015">
        <img notab src=../images/DateLookup.gif border=0 hspace=4
        align=absmiddle onclick="DateLookupFrame(bkrec034);">
        </td></tr>
 <tr id="p_adm_now"><td class=DataLabel>Create Pre-admission now</td>
 <td><input type=checkbox id=admitnow checked></td>
 <td>&nbsp;</td>
 <td>&nbsp;</td>
 </tr>

<tr><td colspan=4 align="center">
  <input type=button id="opr01sub" class="button" value="Ok"  
  tabindex=26
  onclick="tempDisable(this);Check();">
  <input type=button class="button" value="Cancel"
	tabindex=27
  onclick=window.history.go(-1)>
    </td></tr>
<input type=hidden name=currflag value="%OPRWEB01.09.802">
</table>
</form>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=9>
<input type=hidden name=template value=002>
<input type=hidden name=urnumber value="%OPRWEB01.09.003">
<input type=hidden name=admissno value="%OPRWEB01.09.081">
<input type=hidden name=MenuType value="%OPRWEB01.09.088">
<input type=hidden name=casekeys value="%OPRWEB01.09.101">
</form>

<form name=CancelBook method=get>
<input type=hidden name=reportno value=3>
<input type=hidden name=template value=003>
<input type=hidden name=sesskeys value="%OPRWEB01.09.101">
</form>

<span id=SDuration style="display:none">
<td>
  <select name="operexpd" title="Operation Expected Duration" class=Mandatory>
    <option value=""></option>
    <option value="  10">10 min</option>
    <option value="  15">15 Min</option>
    <option value="  20">20 Min</option>
    <option value="  30">30 min</option>
    <option value="  40">40 min</option>
    <option value="  50">50 min</option>
    <option value="  60">60 min</option>
    <option value="  70">70 min</option>
    <option value="  80">80 min</option>
    <option value="  90">90 min</option>
    <option value=" 100">100 min</option>
    <option value=" 110">110 min</option>
    <option value=" 120">120 Min</option>
    <option value=" 130">130 min</option>
    <option value=" 140">140 min</option>
    <option value=" 150">150 min</option>
    <option value=" 160">160 min</option>
    <option value=" 170">170 min</option>
    <option value=" 180">180 min</option>
    <option value=" 190">190 min</option>
    <option value=" 200">200 min</option>
    <option value=" 210">210 min</option>
    <option value=" 220">220 min</option>
    <option value=" 230">230 min</option>
    <option value=" 240">240 min</option>
    <option value=" 250">250 min</option>
    <option value=" 260">260 min</option>
    <option value=" 270">270 min</option>
    <option value=" 280">280 min</option>
    <option value=" 290">290 min</option>
    <option value=" 300">300 min</option>
    </select>
    </td></tr>
</span>
<span id=FDuration style="display:none">
<td><input type=text name="operexpd" size=6 maxlength=4 value="%OPRWEB01.09.305"
     title="Operation Expected Duration" class="Mandatory Integer" min=0>
    (minutes)
</td>
</span>
<span id=blanklabel style="display:none">
</span>
<span id=acchd style="display:none">
ACC Purchase Order Number
</span>

<span id=accorderid style="display:none">
  <input type=text name=accpordn id=accpordn title="ACC Purchase Order Number" 
   maxlength=20 size=20 value="%OPRWEB01.09.824">
</span>

<span id=transferhd style="display:none">
Transfer Source
</span>

<span id=transfersrc style="display:none">
<input type="text" size=7 maxlength=5 name=trnsfsrc class=Mandatory
      title="Transfer Source" value=""
      onchange="validateCode(9,trnsfsrc,trandesc);">
     <input type=text size=27 name=trandesc value=""
      class=Readonly readonly tabindex="-1">
     <img src="../images/SearchIcon.gif"
      onClick="TransferSourceFrame(trnsfsrc,trandesc,opdea037)">
</span>

<span id=transferblank style="display:none">
   <input type=hidden name=trnsfsrc value=" ">
   <input type=hidden name=trandesc value=" ">
</span>

<span id=PatCatFilterSpan style="display:none">
<select name=bkrec019 title="%STANDARD.01.017.P " tabindex=3>
    <option></option>
    %STANDARD.01.007.P 
    </select>
</span>

<span id=AdmSrcFilterSpan style="display:none">
     <select name="opdea037" title="Admission Source" class=Mandatory
      onchange="DisplayTrnSrc(this);" tabindex=15>
     <option></option>
     %OPRWEB01.09.655.2
     </select>
</span>

<script type="text/javascript" >
if(document.AddForm.opcnfdur.value=="1") {
  Duration.style.display="";
  Duration.innerHTML=FDuration.innerHTML;
} else {
  Duration.style.display="";
  Duration.innerHTML=SDuration.innerHTML;
  for (var i =0 ; i < document.AddForm.operexpd.length; i++) {
  x=trim(document.AddForm.operexpd.options[i].value)
       if (x==trim(%OPRWEB01.09.305)){
           document.AddForm.operexpd.options[i].selected=true;
           break;} };
}
for (var i =0 ; i < document.AddForm.bokrx002.length; i++) {
     if (document.AddForm.bokrx002.options[i].value=="%OPRWEB01.09.405.1") {
         document.AddForm.bokrx002.selectedIndex=i } };

for (var i =0 ; i < document.AddForm.operexpd.length; i++) {
x=trim(document.AddForm.operexpd.options[i].value)
     if (x==trim(%OPRWEB01.09.305)){
         document.AddForm.operexpd.options[i].selected=true;
         break;} };

function AdmissionLinkSearchFrame(urnumb,session,RETadmis,RETdate,RETtime,
                                  RETacare,RETaclaim){
 DFrameStart();
  window.urnumber=urnumb;
  window.sesskeys=session;
  document.getElementById('PopUpFrame').src="../lookups/AdmissionLinkSearchFrame.html";
  SearchFrameShow();
}
function ChkInp() {
 if (AddForm.currflag.value=="2") {
   if(confirm("Use the current Admission or Create a new booking\n" +
              "   Ok to use the Current, Cancel to Create New")) {
  AdmissionLinkSearchFrame(AddForm.urnumber,AddForm.sesskeys,AddForm.admissno,
                           AddForm.admndate,AddForm.admntime);
   return;
   }
  }
  if (AddForm.currflag.value!="1") {
     return; }
  if (AddForm.admissno.value=="") {
     return; }
  if(document.AddForm.admstats.value=="Pre-Admission       "){
    if(!confirm("Use the current Pre-Admission or Create a new booking\n" +
              "   Ok to use the Current, Cancel to Create New")) {
        return;}
  }else {if(!confirm("Use the current Admission or Create a new booking\n" +
           "   Ok to use the Current, Cancel to Create New")){
         return;}
   }
    if(document.AddForm.ptcnhdps.value=="3"){
      if(document.AddForm.caretype.value.substr(14,1)!="4"&&
         document.AddForm.caretype.value.substr(14,1)!="5"&&
         document.AddForm.caretype.value.substr(14,1)!="8"){
         alert("Unable to use the current admission, invalid care type.")
         return; }
  }
  if(document.AddForm.admntype.value.substr(31,1)=="X"){
    alert("ERROR\n\n%STANDARD.01.017.A Code not valid for Theatre Bookings")
    return; }
   defaultAdmission();
}
function defaultAdmission(){
   AddForm.admisnum.value=AddForm.admissno.value
   AddForm.patadmdt.value=AddForm.admndate.value
   AddForm.bkrec005.value=AddForm.admntime.value
//Intended Length of Stay
   AddForm.bkrec033.value=AddForm.ptvis043.value
//Financial Class
   for (var i =0 ; i < document.AddForm.patclaim.length; i++) {
     if (document.AddForm.patclaim.options[i].value.substr(0,3)==document.AddForm.ptmis027.value.substr(0,3)) {
         document.AddForm.patclaim.selectedIndex=i } };
//Admitting Point
   for (var i =0 ; i < document.AddForm.bokrx003.length; i++) {
     if (document.AddForm.bokrx003.options[i].value.substr(0,3)==document.AddForm.admpoint.value.substr(0,3)) {
         document.AddForm.bokrx003.selectedIndex=i } };
//Expected Ward
   for (var i =0 ; i < document.AddForm.bokrx002.length; i++) {
     if (document.AddForm.bokrx002.options[i].value.substr(0,3)==document.AddForm.ptmis068.value.substr(0,3)) {
         document.AddForm.bokrx002.selectedIndex=i } };
//Admission Source
   for (var i =0 ; i < document.AddForm.opdea037.length; i++) {
     if (document.AddForm.opdea037.options[i].value.substr(0,3)==document.AddForm.ptmis009.value.substr(0,3)) {
         document.AddForm.opdea037.selectedIndex=i } };
// Transfer Source
   setTransferSource(AddForm.d_ptdaadts.value);
//Patient Type
   for (var i =0 ; i < document.AddForm.bkrec019.length; i++) {
     if (document.AddForm.bkrec019.options[i].value.substr(0,3)==document.AddForm.ptmas024.value.substr(0,3)) {
         document.AddForm.bkrec019.selectedIndex=i } };
}
ibcnmhos="%OPRWEB01.09.799.008"
if(ibcnmhos=="1"){
  AddForm.bokrx002.className="Mandatory"
}
function SetAdmitNow(){
var bookingStatus = "%OPRWEB01.09.913";
if(bookingStatus=="Booked" && isWhitespace(document.AddForm.admisnum.value) &&
   !isWhitespace(document.AddForm.wattrkey.value.substr(0,8))){
   document.getElementById("p_adm_now").style.visibility="visible";
   document.getElementById("admitnow").checked=true;
}
else{
   document.getElementById("p_adm_now").style.visibility="hidden";
   document.getElementById("admitnow").checked=false;
}
}

function setFilterMentalHealth(mhVisit){
  document.getElementById('PatCatFilter').innerHTML=
                    document.getElementById('PatCatFilterSpan').innerHTML;

  FilterMentalHealth(mhVisit,document.AddForm.bkrec019,'14');

  document.getElementById('AdmSrcFilter').innerHTML=
                    document.getElementById('AdmSrcFilterSpan').innerHTML;

  FilterMentalHealth(mhVisit,document.AddForm.opdea037,'13');

}

</script>

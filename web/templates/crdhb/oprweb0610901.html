<meta name="TemplateVersion" content="V12.00.00">
<meta name="TemplateHome" content="crdhb">
<meta name="HelpFileName"    content="NoContextSet.html">
<script type="text/javascript" src="../js/oprweb06-crdhb.js"> </script>
<script type="text/javascript">
function chkTime(field){
  if(isWhitespace(field.value))
   return;
  // 02 : CTAS : Add case abandoned variable, bypass surgery end time check
  //             if case is abandoned.
  var caseAbdn = document.UpdateForm.opsrg074.value;   
  endTime=UpdateForm.suentime.value.replace(/:/g,"");
  if(isWhitespace(endTime) && caseAbdn != "Yes"){
     alert("Surgery End Time must be entered first");
     field.value=""
     return;
  }
  OperDate=document.UpdateForm.casekeys.value.substring(3,11);
  if(document.UpdateForm.currdate.value > OperDate) {
    return;
  }
  if(field.value.replace(/:/g,"")<=endTime){
// 01 : CTAS : ChkTime(): remove option to precede patient out of theatre time
	  alert(""+field.title+" must be after Patient Out of Theatre Time " +
			  UpdateForm.suentime.value)
	  field.value="";
	  field.focus(); 
// end of change
  }
}

function formSubmit() {
    var caseAbdn = document.UpdateForm.opsrg074.value;
    if (validateMandatory(UpdateForm)) {
        casekey = UpdateForm.casekeys.value.substr(0, 23);

        if (checkTimeOrder()) {
            saveOvrNight();
            if (!checkSurgeryEndTime()) {
                if (caseAbdn === "Yes") {
                    document.UpdateForm.opsrg074.value = "1";
                }
                document.UpdateForm.submit();
            }
        }
    }
}

// 01 : CTAS : update function checkTimeOrder()
function checkTimeOrder() {

	// time order: PACU In < Ready for Discharge from PACU < PACU Out
	var PACUIn = UpdateForm.opard071;
	var readyForDischarge = UpdateForm.opard085; 
	var PACUOut = UpdateForm.opard077;
	var overNightIndicator = document.getElementById("d_opsrg071");
	
	var PACUInVal = PACUIn.value.replace(/ /g,"");
	var readyForDischargeVal = readyForDischarge.value.replace(/ /g,""); 
	var PACUOutVal = PACUOut.value.replace(/ /g,"");	

	// accept if no times set
	if ((PACUInVal == "") 
		&& (readyForDischargeVal == "")
		&& (PACUOutVal == "")) {
		return true;
	}
	
	// check that no times have been missed in the sequence
	if ((PACUInVal == "") 
		&& ((readyForDischargeVal != "") || (PACUOutVal != ""))) {
		 alert("Please enter " + PACUIn.title);
		 PACUIn.focus();
		 PACUIn.select();
		 return false;		
	}
	
	if ((readyForDischargeVal == "") && (PACUOutVal != "")) {	
		 alert("Please enter " + readyForDischarge.title);
		 readyForDischarge.focus();
		 readyForDischarge.select();
		 return false;		
	}
	
	// display warning if overnight indicator checked as can't validate time sequence
	if (overNightIndicator.checked) {
		alert("Warning: over night indicator is switch on, check your times carefully");
		return true;
	} else {
		// check times have been entered in order if no overnight indicator
		if (((readyForDischargeVal != "") 
				&& (validateGreatestTime(PACUIn,readyForDischarge)))
			|| ((PACUOutVal != "") 
				&& (validateGreatestTime(readyForDischarge,PACUOut)))) {
				return false;
		}
	}
	return true;
}
// end of change

function convertOvrnightToInteger()
{
 var overNightField = document.getElementById("d_opsrg071");
 var opsrg071 = document.getElementById("opsrg071");
 if (opsrg071.value == "Yes")
   overNightField.checked = true;
 else
   overNightField.checked = false;
}

function saveOvrNight()
{
 var overNightField = document.getElementById("d_opsrg071");
 var opsrg071 =  document.getElementById("opsrg071");
 if(overNightField.checked)
  opsrg071.value  = 1;
 else
  opsrg071.value  = 0;
}

// 01 : CTAS : update checkSurgeryEndTime() to remove unused fields
function checkSurgeryEndTime()
{
  // check that PACU In, Ready for Discharge and PACU Out > Surgery End Time
  // return true to abort submission
  var surgeryEndTime = document.getElementById('opsrg006');
  var PACUInTime = document.getElementById('opard071');
  var readyDischarge = document.getElementById('opard085');
  var PACUOutTime   = document.getElementById('opard077');

  var tempSurgeryTime = surgeryEndTime.value.replace(/\:/g,"");
  var tempPACUInTime = PACUInTime.value.replace(/\:/g,"");
  var tempReadyDischarge = readyDischarge.value.replace(/\:/g,"");
  var tempPACUOutTime = PACUOutTime.value.replace(/\:/g,"");
  var overNightIndicator = document.getElementById("d_opsrg071");

  tempSurgeryTime.replace(/ /g,"");
  tempPACUInTime.replace(/ /g,"");
  tempReadyDischarge.replace(/ /g,"");
  tempPACUOutTime.replace(/ /g,"");

  tempSurgeryTime = parseInt(tempSurgeryTime,10);
 
  if(!overNightIndicator.checked) {
	if (tempPACUInTime != "") {
		tempPACUInTime = parseInt(tempPACUInTime,10);
		if(tempSurgeryTime >= tempPACUInTime)
		{
		  alert(PACUInTime.title+" has to be after Surgery End Time.");
		  PACUInTime.focus();
		  PACUInTime.select();
		  return true;
		}
	}
	
	if (tempReadyDischarge != "") {
		tempReadyDischarge = parseInt(tempReadyDischarge,10);
		if(tempSurgeryTime >= tempReadyDischarge)
		{
		  alert(readyDischarge.title+" has to be after Surgery End Time.");
		  readyDischarge.focus();
		  readyDischarge.select();
		  return true;
		}	
	}

	if (tempPACUOutTime != "") {
		tempPACUOutTime = parseInt(tempPACUOutTime,10);
		if(tempSurgeryTime >= tempPACUOutTime)
		{
		  alert(PACUOutTime.title+" has to be after Surgery End Time.");
		  PACUOutTime.focus();
		  PACUOutTime.select();
		  return true;
		}
	}
  }

  return false;
} 
// end of change
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);convertOvrnightToInteger();">
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%OPRWEB06.10.003";
PatientVIS="%OPRWEB06.10.081";
PatientNAM="%OPRWEB06.10.002";
PatientSTA="%OPRWEB06.10.086.078";
PatientALT="%OPRWEB06.10.084";
PatientSEX="%OPRWEB06.10.019";
PatientDOB="%OPRWEB06.10.020";
PatientAGE="%OPRWEB06.10.021";
PatientLOC="%OPRWEB06.10.083";
PatientPRI="%OPRWEB06.10.086.066.1";
PatientUNT="%OPRWEB06.10.066.0";
DoctorCOD="%OPRWEB06.10.082.003";
DoctorNAM="%OPRWEB06.10.082.002";
PatientAID="%OPRWEB06.10.086.090";
PatientIND="%OPRWEB06.10.086.091";
PatientCUR="%OPRWEB06.10.086.092";
PatientCLC="%OPRWEB06.10.086.093.1";
PatientCLH="%STANDARD.01.017.CL";
PatientHFT="%OPRWEB06.10.086.094";
PatientCDM="%OPRWEB06.10.086.095";
PatientVDH="%OPRWEB06.10.086.099.015";

EventExist="%OPRWEB06.10.743";
usingRecoveryAnaestheticParameter ='%STANDARD.01.025.113.015.0.1';
InsertPatientHeader()
</script>

<!-- 01 : CTAS : add title bar and rename screen to Theatre Case PACU Details -->
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Theatre Case PACU Details
</span>
<!-- end of change -->
<div id=PageBodySection>
<form name=UpdateForm method=post action=oprweb06.pbl>
<input type=hidden name=reportno value=10>
<input type=hidden name=template value=001>
<input type=hidden name=updatety value="U">
<input type=hidden name=casekeys value="%OPRWEB06.10.101">
<input type=hidden name=uniqueky value='%OPRWEB06.10.110'>
<input type=hidden name=suentime value="%OPRWEB06.10.306">
<input type=hidden name=suprlevl value="%OPRWEB06.10.512">
<input type=hidden name=currdate value="%STANDARD.01.013">
<input type=hidden name=opsrg004 id=opsrg004 value="%OPRWEB06.10.304">
<input type=hidden name=opsrg071 id=opsrg071 value="%OPRWEB06.10.371" />
<input type=hidden name=opsrg006 id=opsrg006 value="%OPRWEB06.10.306" />
<input type=hidden name=opsrg074 value ="%OPRWEB06.10.374">

<table border=0 cellpadding=2 cellspacing=0 width="95%" align=center >
<!-- 01 : CTAS : relabel Time in Recovery - Front as PACU In -->
<tr>
	<td class=DataLabel width=18%>PACU In</td>
    <td class=DataField>
    <input type=text name=opard071 id=opard071 size=8 title="PACU In"
	 class=Mandatory value='%OPRWEB06.10.271' tabindex=1
	 onBlur="checkTime(this,this.title);chkTime(this)">
    <img src="../images/DateTimeStamp.gif" class=Icon
     onclick="SetCurrentDateTime(null,opard071);" tabindex=-1>
    <img src=../images/TimeLookup.gif border=0 class=Icon
     onclick="TimeLookupFrame(opard071);" tabindex=-1>
    </td>
<!-- end of change -->
<!-- 01 : CTAS : move and relabel Delay Code as Reason for Holding in PACU -->
    <td class=DataLabel width=18%>Reason for Holding in PACU</td>
    <td class=DataField>
    <select name=opard084 id=opard084 class=DataField tabindex=6
		title="Reason for Holding in PACU">
    <option></option>
     %OPRWEB06.10.284.2
    </select>
    </td>
</tr>
<!-- end of change -->

<!-- 01 : CTAS : move and relabel Ready to Depart Time as 
		Ready for Discharge from PACU and remove adverse event triggers -->
<tr><td class=DataLabel>Ready for Discharge from PACU</td>
    <td class=DataField>
    <input type=text name=opard085 id=opard085 size=8  tabindex=2
		title="Ready for Discharge from PACU" value='%OPRWEB06.10.285' 
		onBlur="checkTime(this,this.title);chkTime(this);">
    <img src="../images/DateTimeStamp.gif" class=Icon
     onclick="SetCurrentDateTime(null,opard085);" tabindex=-1>
    <img src=../images/TimeLookup.gif border=0 class=Icon
     onclick="TimeLookupFrame(opard085);" tabindex=-1>
    </td>
<!-- end of change -->
<!-- 01 : CTAS : add Patient Transferred To (cat code oa) -->
    <td class=DataLabel>Patient Transferred To</td>
    <td class=DataField>
    <select name=opard015 id=opard015 class=DataField tabindex=7
		title="Patient Transferred To">
    <option></option>
     %OPRWEB06.10.215.2
    </select>
    </td>
</tr>
<!-- end of change -->

<!-- 01 : CTAS : rearrange two Nurse Attending Patient fields and rename to PACU Nurse -->
<tr>
	<td class=DataLabel width=20%>PACU Nurse 1</td>
    <td><input type=text name=opard072 id=opard072 size=6 value="%OPRWEB06.10.272.1"
		title="PACU Nurse 1" tabindex=3
     onblur="validateCode(17,opard072,name_opard072);">
    <input type=text readonly name=name_opard072 class=Readonly size=30
     value="%OPRWEB06.10.272.0" tabindex=-1>
    <img src="../images/SearchIcon.gif" class=Icon tabindex=-1
     onclick="NurseSearchFrame(opard072,name_opard072);">
    </td>
    <td class=DataLabel>PACU Nurse 2</td>
    <td><input type=text name=opard073 id=opard073 size=6 value="%OPRWEB06.10.273.1"
		title="PACU Nurse 2" tabindex=8
     onblur="validateCode(17,opard073,name_opard073);">
    <input type=text readonly name=name_opard073 class=Readonly size=30
     value="%OPRWEB06.10.273.0" tabindex=-1>
    <img src="../images/SearchIcon.gif" class=Icon tabindex=-1
     onclick="NurseSearchFrame(opard073,name_opard073);">
    </td>
</tr>
<!-- end of change -->	

<!-- 01 : CTAS : add Reason for prolonged stay (cat code or, opard052) -->
<tr>
    <td class=DataLabel width=18%>Reason for Prolonged Stay</td>
    <td class=DataField>
    <select name=opard052 id=opard052 class=DataField tabindex=4
		title="Reason for Prolonged Stay in PACU">
    <option></option>
     %OPRWEB06.10.252.2
    </select>
    </td>
</tr>
<!-- end of change -->

<!-- 01 : CTAS : move and relabel Time in Recovery - Day Procedure as PACU Out -->
<tr><td class=DataLabel>PACU Out</td>
    <td class=DataField>
    <input type=text name=opard077 id=opard077 size=8 title="PACU Out"
     value='%OPRWEB06.10.277' tabindex=5
     onBlur="checkTime(this,this.title);chkTime(this);">
    <img src="../images/DateTimeStamp.gif" class=Icon
     onclick="SetCurrentDateTime(null,opard077);" tabindex=-1>
    <img src=../images/TimeLookup.gif class=Icon
     onclick="TimeLookupFrame(opard077);" tabindex=-1>
	</td>
<!-- end of change -->
<!-- 01 : CTAS : move and relabel Overnight Indicator as Over Midnight Indicator -->
	<td class=DataLabel>Over Midnight Indicator</td>
	<td class="DataField">
		<input type="checkbox"
           name="d_opsrg071"
           id="d_opsrg071"
		   title="Over Midnight Indicator"
		   tabindex=9
           onchange="saveOvrNight();"/>
	</td>
</tr>
<!-- end of change -->

<!-- 01 : CTAS : custom: close popup when Cancel clicked -->
<table border=0 cellpadding=2 cellspacing=0 width="95%" align=center >
<tr><td colspan=4 align=center>
    <input class="button" id="opr06sub" type=button value="OK" 
		onclick="tempDisable(this);formSubmit();" tabindex=12>
	<input class="button" type=button value="Cancel" 
		onclick="DFrameClose();" tabindex=13>
    </td></tr>
</table>
<!-- end of change -->
</form>
</body>

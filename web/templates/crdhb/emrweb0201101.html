<meta name="TemplateVersion" content="V12.00.00">
<meta name="TemplateHome" content="crdhb">
<meta name="HelpFileName" content="NoContextSet.html">
<script type="text/javascript" src="../js/emrweb0201101.js"></script>
<script type="text/javascript" src="../js/ctascustom.js"></script>
<script type="text/javascript">
// 01 : CTAS : constant values section
var DISCH_IND = 21;				// Cat ED Indicator 21
var DISCH_IND_SHOW_DEST = "1";	// Cat ED Indicator 21 => (1 == show destination)
// end of change
function init() {
  if (document.HiddenFields.DischargeComplete.value!=1) {
    PageLocation="?reportno=1&template=109" + "&urnumber=" + 
    PatientURN.replace(/ /g,"+") + "&admissno=" + PatientVIS.replace(/ /g,"+");
    location.href="emrweb02.pbl" + PageLocation;
    return;
  }
  PageLocation="?reportno=1&template=4" +
               "&urnumber=" + PatientURN.replace(/ /g,"+") +
               "&admissno=" + PatientVIS.replace(/ /g,"+")
  if (top.content.location.href!=this.location.href) {
    top.content.location.href="emrweb02.pbl" + PageLocation }

  if (isWhitespace(document.HiddenFields.HospitalAdmission.value)) {
    if (!isWhitespace(document.HiddenFields.ExpectedUnit.value)) {
       alert('Patient must be admitted before Discharge.')
       DisableForm(document.UpdateForm) }}
  document.UpdateForm.brcom001.value=document.UpdateForm.dummy1.value + 
                                     document.UpdateForm.dummy2.value
 if(document.HiddenFields.ShowOutstanding.value=="1") {
  var linkurl = "../cgi-bin/emrweb02.pbl?reportno=1&template=051" +
                    "&admissno=" + UpdateForm.admissno.value.replace(/ /g,"+")+
                    "&urnumber=" + UpdateForm.urnumber.value.replace(/ /g,"+")
  Left=(document.body.clientWidth-600)/2
  DFrameLink(linkurl,0,Left,600,300);
 }
// this checks to see if it is being used outside the MAPVIEW
  if(top.location.pathname.match(/EmergencyMap/g)) {
    document.UpdateForm.mapvflag.value=1
  }
}
function checkDateFunction() {
  if(isWhitespace(document.UpdateForm.emvis074.value)){
     return;
  } 
  else {
     checkDate(document.UpdateForm.emvis074,'Ward Allocated Date');
  }
}
// 11 : TAS : Make Referred to on departure non-mandatory if patient deceased
function checkTrans(){

  deceasedIndicator = document.UpdateForm.emvis026.value.substr(3,1);
  var doa = (trim(document.UpdateForm.emvis026.value));
  checkDeceasedEMR(deceasedIndicator);
  if (deceasedIndicator=="D" || doa.substr(0,3)=="R02") {
        document.UpdateForm.emvis051.className="";
	} 
 else { document.UpdateForm.emvis051.className="Mandatory";
    }
}
//10: TAS : Extend cookie parameters to other fields on template
function setCookieDepDateTime() {
  SetCookie("depdatecookie"+document.UpdateForm.admissno.value,
            document.UpdateForm.emvis150.value);
  SetCookie("deptimecookie"+document.UpdateForm.admissno.value,
            document.UpdateForm.emvis151.value);
  SetCookie("evtdatecookie"+document.UpdateForm.admissno.value,
            document.UpdateForm.emvis024.value);
  SetCookie("evttimecookie"+document.UpdateForm.admissno.value,
            document.UpdateForm.emvis025.value);
  SetCookie("exvstrsncookie"+document.UpdateForm.admissno.value,
            document.UpdateForm.emvis152.value);
  SetCookie("dptdlyrsncookie"+document.UpdateForm.admissno.value,
            document.UpdateForm.emvis153.value);
  SetCookie("eddisstcookie"+document.UpdateForm.admissno.value,
            document.UpdateForm.emvis026.value);
  SetCookie("refdepcookie"+document.UpdateForm.admissno.value,
            document.UpdateForm.emvis051.value);
// extra cookies 
  SetCookie("bdrqtmcookie"+document.UpdateForm.admissno.value,
            document.UpdateForm.emvis084.value);
  SetCookie("bdrqdtcookie"+document.UpdateForm.admissno.value,
            document.UpdateForm.emvis074.value);
  SetCookie("expwrdcookie"+document.UpdateForm.admissno.value,
            document.UpdateForm.emvis116.value);
  SetCookie("survcookie"+document.UpdateForm.admissno.value,
            document.UpdateForm.emvis069.value);
}
//10: TAS : Extend cookie parameters to other fields on template
//function works to load values if they have previously been entered when loading 
//the page

function getCookieDepDateTime() {
  if (GetCookieData("depdatecookie"+document.UpdateForm.admissno.value) !=
      "unknown") {
    document.UpdateForm.dpdtckie.value=
    GetCookieData("depdatecookie"+document.UpdateForm.admissno.value);
    document.UpdateForm.dptmckie.value=
    GetCookieData("deptimecookie"+document.UpdateForm.admissno.value);
    document.UpdateForm.evdtckie.value=
    GetCookieData("evtdatecookie"+document.UpdateForm.admissno.value);
    document.UpdateForm.evtmckie.value=
    GetCookieData("evttimecookie"+document.UpdateForm.admissno.value);
	document.UpdateForm.xvrmckie.value=
    GetCookieData("exvstrsncookie"+document.UpdateForm.admissno.value);
	document.UpdateForm.ddrmckie.value=
    GetCookieData("dptdlyrsncookie"+document.UpdateForm.admissno.value);
	document.UpdateForm.edsmckie.value=
    GetCookieData("eddisstcookie"+document.UpdateForm.admissno.value);
	document.UpdateForm.rtdmckie.value=
    GetCookieData("refdepcookie"+document.UpdateForm.admissno.value);

	if (isWhitespace(document.UpdateForm.brtmckie.value)) {
	document.UpdateForm.brtmckie.value=
    GetCookieData("bdrqtmcookie"+document.UpdateForm.admissno.value);
	document.UpdateForm.emvis084.value = document.UpdateForm.brtmckie.value;
	}
	if (isWhitespace(document.UpdateForm.brdmckie.value)) {
	document.UpdateForm.brdmckie.value=
    GetCookieData("bdrqdtcookie"+document.UpdateForm.admissno.value);
    document.UpdateForm.emvis074.value = document.UpdateForm.brdmckie.value;
	}
    if (isWhitespace(document.UpdateForm.expdckie.value)) {
	document.UpdateForm.expdckie.value=
    GetCookieData("expwrdcookie"+document.UpdateForm.admissno.value);
	document.UpdateForm.emvis116.value = document.UpdateForm.expdckie.value;
	}
	if (isWhitespace(document.UpdateForm.survckie.value)) {
	document.UpdateForm.survckie.value=
    GetCookieData("survcookie"+document.UpdateForm.admissno.value);
	document.UpdateForm.emvis069.value = document.UpdateForm.survckie.value;
	}
	
    ExpireCookiePath("depdatecookie"+document.UpdateForm.admissno.value);
    ExpireCookiePath("deptimecookie"+document.UpdateForm.admissno.value);
    ExpireCookiePath("evtdatecookie"+document.UpdateForm.admissno.value);
    ExpireCookiePath("evttimecookie"+document.UpdateForm.admissno.value);
    ExpireCookiePath("exvstrsncookie"+document.UpdateForm.admissno.value);
	ExpireCookiePath("dptdlyrsncookie"+document.UpdateForm.admissno.value);
	ExpireCookiePath("eddisstcookie"+document.UpdateForm.admissno.value);
	ExpireCookiePath("refdepcookie"+document.UpdateForm.admissno.value);
//extra cookies	
	ExpireCookiePath("bdrqtmcookie"+document.UpdateForm.admissno.value);
	ExpireCookiePath("bdrqdtcookie"+document.UpdateForm.admissno.value);
	ExpireCookiePath("expwrdcookie"+document.UpdateForm.admissno.value);
	ExpireCookiePath("survcookie"+document.UpdateForm.admissno.value);
  }

// if(document.HiddenFields.ShowOutstanding.value=="1") {
   document.UpdateForm.emvis150.value = document.UpdateForm.dpdtckie.value;
   document.UpdateForm.emvis151.value = document.UpdateForm.dptmckie.value;
   document.UpdateForm.emvis024.value = document.UpdateForm.evdtckie.value;
   document.UpdateForm.emvis025.value = document.UpdateForm.evtmckie.value;
   document.UpdateForm.emvis152.value = document.UpdateForm.xvrmckie.value;
   document.UpdateForm.emvis153.value = document.UpdateForm.ddrmckie.value;
   document.UpdateForm.emvis026.value = document.UpdateForm.edsmckie.value;
   document.UpdateForm.emvis051.value = document.UpdateForm.rtdmckie.value;
} 
// 09 : Add new functions to merge task 0856678
function EventTimeCheckDepartureDateNZ() {
  if(ValTime(document.UpdateForm.emvis024,document.UpdateForm.emvis025)){
    CheckDepartureDateNZ();
	CheckDepartVsTriage();
  }
}
function DepartureTimeCheckDepartureDateNZ() {
  if(ValTime(document.UpdateForm.emvis150,document.UpdateForm.emvis151)){
    CheckDepartureDateNZ();
	CheckDepartVsTriage();
  }
}
// 09 : End of Change
// 04 : TAS : Merge Task 0856522 - modify time validation function
function ValTime(dateField,timeField) {
  if (!checkTime(timeField,timeField.title)) {
     return false;
  }
    if (!checkDate(dateField,dateField.title)) {
     return false;
  }
  SetCurrentDateTimeNoFocus(null,document.UpdateForm.currtime);
  var curDate = document.UpdateForm.currdate.value;
  var curTime = trim(document.UpdateForm.currtime.value.replace(/:/g,"")) - 0;
  var newTime = trim(timeField.value.replace(/:/g,"")) - 0;

  if (SetDateYYYYMMDD(dateField.value) == curDate) {
    if (newTime > curTime) {
      alert("Time is in the future");
      timeField.value = "";
      timeField.focus();
      return false;
    }
  }

  return true;
}
//04 : TAS : Rationalise functions for discharge button, add ValTime
//08 : Add integrate ED discharge field check with ED discharge
//09 : TAS Merge task 0856678
function BtnDischargeClick()
{
  if(CheckDepartureDateNZ()){
//08 and 09 : Both changes merged into new function structure 
 if (!ChkDisStat()){
  PatientLinkTo("emrweb02.pbl",1,100,0,0,0);
  return;
  }
  else{
  if(CheckDepartVsTriage()){
  PostDischargeNZ();
  }
}
}
}
function displayReferralFields() {
  if (document.UpdateForm.stfrefin.value != "1") {
    emvis174TitleDIV.innerHTML = "";
    emvis175TitleDIV.innerHTML = "";
    emvis176TitleDIV.innerHTML = "";
    emvis174FieldDIV.innerHTML = "";
    emvis175FieldDIV.innerHTML = "";
    emvis176FieldDIV.innerHTML = "";
    return;
  }
  displaycatRF();
}
function displaycatRF() {
    if (document.UpdateForm.emvis174.value.substr(3,1) == "N") {
      emvis175TitleDIV.innerHTML = emvis175TitleSPAN.innerHTML;
      emvis175FieldDIV.innerHTML = emvis175FieldSPAN.innerHTML;
    } else {
      emvis175TitleDIV.innerHTML = "";
      emvis175FieldDIV.innerHTML = "";
    }
}
// 01 : CTAS : add function showDestination()
// show Transfer destination field or not based on discharge status 
// add conditional to avoid error when ED Discharge value not selected
function showDestination() {
        if (isWhitespace(document.UpdateForm.emvis026.value)) {
	showDest = null;
        }	
	else {
        showDest = getIndicatorValue(document.UpdateForm.emvis026, DISCH_IND);
	if (showDest == DISCH_IND_SHOW_DEST) {
		// document.getElementById("trandest").style.display = "";
		TransferDestDesc.innerHTML=ShowTransferDestDesc.innerHTML;
		TransferDestField.innerHTML=ShowTransferDestField.innerHTML;
	} else {
		// document.getElementById("trandest").style.display = "none";
		TransferDestDesc.innerHTML="";
		TransferDestField.innerHTML=ShowTransferDestBlank.innerHTML;
	}
}
}
// end of change
// 01 : CTAS : Add function for diagnosis
function DiagnosisLink() {
  document.PatientLinks.target="_self"
  document.PatientLinks.reportno.value="02"
  document.PatientLinks.template.value="001"
  document.PatientLinks.action="emrweb06.pbl"
  document.PatientLinks.submit()
}
// end of change
// 01 : CTAS : Overloaded from ../js/emrweb0201101.js
// to correct name
function CheckDepartureDateNZ() {

  var ExtDesc = document.getElementById('ExtDesc');
  var ExtField = document.getElementById('ExtField');
  var DelayDesc = document.getElementById('DelayDesc');
  var DelayField = document.getElementById('DelayField');

  if(isWhitespace(UpdateForm.emvis024.value) ||
     isWhitespace(UpdateForm.emvis025.value)) {
     ExtDesc.style.display="none";
     ExtField.style.display="none";
     DelayDesc.style.display="none";
     DelayField.style.display="none";
     ExtField.disabled=true;
     DelayField.disabled=true;
     ExtField.className="";
     DelayField.className="";
     return true;
  }
  if(!checkDate(UpdateForm.emvis024,UpdateForm.emvis024.title)) {
     ExtDesc.style.display="none";
     ExtField.style.display="none";
     DelayDesc.style.display="none";
     DelayField.style.display="none";
     ExtField.disabled=true;
     DelayField.disabled=true;
     ExtField.className="";
     DelayField.className="";
     return true;
  }
  if(!checkTime(UpdateForm.emvis025,UpdateForm.emvis025.title)) {
     ExtDesc.style.display="none";
     ExtField.style.display="none";
     DelayDesc.style.display="none";
     DelayField.style.display="none";
     ExtField.disabled=true;
     DelayField.disabled=true;
     ExtField.className="";
     DelayField.className="";
     return true;
  }
  CheckEventEndDateNZ();

  if(isWhitespace(UpdateForm.emvis150.value) ||
     isWhitespace(UpdateForm.emvis151.value)){
     DelayDesc.style.display="none";
     DelayField.style.display="none";
     DelayField.disabled=true;
     DelayField.className="";
     return true;
  }
  if(!checkDate(UpdateForm.emvis150,UpdateForm.emvis150.title)) {
     DelayDesc.style.display="none";
     DelayField.style.display="none";
     DelayField.disabled=true;
     DelayField.className="";
     return true;
  }
  if(!checkTime(UpdateForm.emvis151,UpdateForm.emvis151.title)) {
     DelayDesc.style.display="none";
     DelayField.style.display="none";
     DelayField.disabled=true;
     DelayField.className="";
     return true;
  }
  if(!ChkDateTime(UpdateForm.emvis024,UpdateForm.emvis025,
                 UpdateForm.emvis150,UpdateForm.emvis151)) {
	// change name st
    // alert("Departure date/time must be equal to or greater than " +
    //      "the event end date/time");
	alert("Departure date/time must be equal to or greater than " +
          "the Treatment Completed date/time");
	// change name en
    UpdateForm.emvis151.focus();
    return false;
  }
//
   var delay="0";
//
   stime = new Date();
   stime.setFullYear(UpdateForm.emvis024.value.substr(7,4));
   monstr= UpdateForm.emvis024.value.substr(3,3)
   if (monstr=="Jan" || monstr=="JAN" || monstr=="jan") mon=00
   if (monstr=="Feb" || monstr=="FEB" || monstr=="feb") mon=01
   if (monstr=="Mar" || monstr=="MAR" || monstr=="mar") mon=02
   if (monstr=="Apr" || monstr=="APR" || monstr=="apr") mon=03
   if (monstr=="May" || monstr=="MAY" || monstr=="may") mon=04
   if (monstr=="Jun" || monstr=="JUN" || monstr=="jun") mon=05
   if (monstr=="Jul" || monstr=="JUL" || monstr=="jul") mon=06
   if (monstr=="Aug" || monstr=="AUG" || monstr=="aug") mon=07
   if (monstr=="Sep" || monstr=="SEP" || monstr=="sep") mon=08
   if (monstr=="Oct" || monstr=="OCT" || monstr=="oct") mon=09
   if (monstr=="Nov" || monstr=="NOV" || monstr=="nov") mon=10
   if (monstr=="Dec" || monstr=="DEC" || monstr=="dec") mon=11
   stime.setMonth(mon);
   stime.setDate(UpdateForm.emvis024.value.substr(0,2));
   stime.setHours(UpdateForm.emvis025.value.substr(0,2));
   stime.setMinutes(UpdateForm.emvis025.value.substr(3,2));
   stime.setSeconds(UpdateForm.emvis025.value.substr(6,2));

   etime = new Date();
   etime.setFullYear(UpdateForm.emvis150.value.substr(7,4));
   monstr= UpdateForm.emvis150.value.substr(3,3)
   if (monstr=="Jan" || monstr=="JAN" || monstr=="jan") mon=00
   if (monstr=="Feb" || monstr=="FEB" || monstr=="feb") mon=01
   if (monstr=="Mar" || monstr=="MAR" || monstr=="mar") mon=02
   if (monstr=="Apr" || monstr=="APR" || monstr=="apr") mon=03
   if (monstr=="May" || monstr=="MAY" || monstr=="may") mon=04
   if (monstr=="Jun" || monstr=="JUN" || monstr=="jun") mon=05
   if (monstr=="Jul" || monstr=="JUL" || monstr=="jul") mon=06
   if (monstr=="Aug" || monstr=="AUG" || monstr=="aug") mon=07
   if (monstr=="Sep" || monstr=="SEP" || monstr=="sep") mon=08
   if (monstr=="Oct" || monstr=="OCT" || monstr=="oct") mon=09
   if (monstr=="Nov" || monstr=="NOV" || monstr=="nov") mon=10
   if (monstr=="Dec" || monstr=="DEC" || monstr=="dec") mon=11
   etime.setMonth(mon);
   etime.setDate(UpdateForm.emvis150.value.substr(0,2));
   etime.setHours(UpdateForm.emvis151.value.substr(0,2));
   etime.setMinutes(UpdateForm.emvis151.value.substr(3,2));
   etime.setSeconds(UpdateForm.emvis151.value.substr(6,2));
   delay = etime.getTime() - stime.getTime();
   delay = Math.floor(delay / (1000));

   if(delay<="60") {
     DelayDesc.style.display="none";
     DelayField.style.display="none";
     DelayField.disabled=true;
     DelayField.className="";
   }
   else {
     DelayDesc.style.display="";
     DelayField.style.display="";
     DelayField.disabled=false;
     DelayDesc.disabled=false;
     DelayField.className="Mandatory";
  }
  return true;
}
// 05 : TAS Check that departure date/time after triage date/time
   function CheckDepartVsTriage() {
  if(isWhitespace(UpdateForm.emvis024.value) ||
     isWhitespace(UpdateForm.emvis025.value)) {
     return true;
  }
  if(!checkDate(UpdateForm.emvis024,UpdateForm.emvis024.title)) { return true};
  if(!checkTime(UpdateForm.emvis025,UpdateForm.emvis025.title)) { return true};

  
  if(isWhitespace(UpdateForm.emvis128.value) ||
     isWhitespace(UpdateForm.emvis129.value)){
     return true;
  }
  if(!checkDate(UpdateForm.emvis128,UpdateForm.emvis128.title)) { return true};
  if(!checkTime(UpdateForm.emvis129,UpdateForm.emvis129.title)) { return true};


    if(ChkDateTime(UpdateForm.emvis024,UpdateForm.emvis025,
                 UpdateForm.emvis128,UpdateForm.emvis129)) {
	alert("Treatment Completed date/time must be equal to or greater than " +
          "the Triage date/time");
	UpdateForm.emvis025.focus();
    return false;
  }
  else
  return true;
  }
// end of change
//07  Check ED discharge - if not DOA or DNW time doctor first seen
//    must be populated
function ChkDisStat() {
    var optDis = (trim(document.UpdateForm.emvis026.value));
    var fstSen = (trim(document.UpdateForm.ptdocsee.value));
    var fstTst;
    var optDistst;
    if (fstSen != "") {
        fstTst = true;
        return true;
        }else {
        fstTst = false;
        }
    if (!optDis || optDis.substr(0,3)=="R02" || optDis.substr(0,3)=="R03") {
        optDistst = true;
        return true;
        } else {
		optDistst = false;
        }
    if (!optDistst && !fstTst) {
                alert("First doctor seen date required for discharge");
        return false;
        }
}
// 12 : CTAS : save changes to Alchohol invloved and Smoking status to database immediately
// smoking status
function updateSmokingStatus() {
	RemoteEmrUpdate(UpdateForm.admissno, UpdateForm.emvis047);
}
// for alcohol involved
function updateAlcoholInvolvedStatus() {
	RemoteEmrUpdate(UpdateForm.admissno, UpdateForm.emvis067);
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);getCookieDepDateTime();CheckDepartureDateNZ();
 showDestination();checkTrans();"
 onunload="setCookieDepDateTime();showDestination();">
<!--<body onload="PageLoad(event);CheckDepartureDateNZ();showDestination();checkTrans();"
 onunload="showDestination();"> -->
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%EMRWEB02.01.003";
PatientVIS="%EMRWEB02.01.081";
PatientNAM="%EMRWEB02.01.002";
PatientSTA="%EMRWEB02.01.086.078";
PatientALT="%EMRWEB02.01.084";
PatientSEX="%EMRWEB02.01.019";
PatientDOB="%EMRWEB02.01.020";
PatientAGE="%EMRWEB02.01.021";
PatientLOC="%EMRWEB02.01.083";
PatientPRI="%EMRWEB02.01.086.066.1";
PatientUNT="%EMRWEB02.01.066.0";
PatientIND="%EMRWEB02.01.086.091";
GpCOD="%EMRWEB02.01.086.084.001";
GpNAM="%EMRWEB02.01.086.084.081";
GpPRAC="%EMRWEB02.01.086.085.001";
GpPRACCNT="%EMRWEB02.01.086.085.002";
GpPRACNAM="%EMRWEB02.01.086.085.005";
PatientARR="%EMRWEB02.01.101.0 %EMRWEB02.01.102";
PatientSEE="%EMRWEB02.01.130.0 %EMRWEB02.01.131";
PatientTRI="%EMRWEB02.01.103.3";
PatientECLC="%EMRWEB02.01.484.1";
PatientCLH="%STANDARD.01.017.CL";
PatientEHFT="%EMRWEB02.01.485";
InsertEmergencyHeader();
</script>
<div id=PatientMenu></div>
<div id=PageBodySection>
<table width=100% border=0 cellspacing=0 cellpadding=1>
<tr><td class=HeadingCell align=center>
    Emergency Patient Discharge </td></tr>
</table>
<form name=UpdateForm action=emrweb02.pbl method=post style="margin:0">
 <input type=hidden name=reportno value="01">
 <input type=hidden name=template value="101">
 <input type=hidden name=formactn>
 <input type=hidden name=updttype>
 <input type=hidden name=emvis133>
 <input type=hidden name=admissno value="%EMRWEB02.01.081">
 <input type=hidden name=updateky value="%EMRWEB02.01.404">
 <input type=hidden name=urnumber value="%EMRWEB02.01.003">
 <input type=hidden name=emvis118 value="%EMRWEB02.01.003">
 <input type=hidden name=nextpage value="1">
 <input type=hidden name=redirect value="%EMRWEB02.01.001.emrweb01.01.001">
 <input type=hidden name=chkdot value="%EMRWEB02.01.107.001">
 <input type=hidden name=chknur value="%EMRWEB02.01.164.1">
 <input type=hidden name=dummy1
  value="%EMRWEB02.01.104%EMRWEB02.01.105%EMRWEB02.01.174">
 <input type=hidden name=dummy2
  value="%EMRWEB02.01.175%EMRWEB02.01.176%EMRWEB02.01.177">
 <input type=hidden name=waittime value="%EMRWEB02.01.701">
 <input type=hidden name=loadflag >
 <input type=hidden name=reloadfg value="%EMRWEB02.01.446">
 <input type=hidden name=efrbedty value="%EMRWEB02.01.506">
 <input type=hidden name=efrdisch value="%EMRWEB02.01.509">
 <input type=hidden name=efradmis value="%EMRWEB02.01.508">
 <input type=hidden name=attdtype value="%EMRWEB02.01.213.3">
 <input type=hidden name=depttime value="%EMRWEB02.01.125">
 <input type=hidden name=deptdate value="%EMRWEB02.01.124.0">
 <input type=hidden name=ptdocsee value="%EMRWEB02.01.130.0 %EMRWEB02.01.131">
 <input type=hidden name=ptnursee value="%EMRWEB02.01.128.0 %EMRWEB02.01.129">
 <input type=hidden name=pmpxi067 value="%EMRWEB02.01.667.0">
 <input type=hidden name=mapvflag value="0">
 <input type=hidden name=ptcnhdps value="%STANDARD.01.025.080.250.1.1">
 <input type=hidden name=emvis147 value="0">
 <input type=hidden name=emcnevrm value="%STANDARD.01.025.089.226.0.4">
 <input type=hidden name=currdate value="%STANDARD.01.013">
 <input type=hidden name=currtime value="">
 <input type=hidden name=dpdtckie value="">
 <input type=hidden name=dptmckie value="">
 <input type=hidden name=evdtckie value="">
 <input type=hidden name=evtmckie value="">
 <!-- 10 : Extra values added to cookie-->
 <input type=hidden name=xvrmckie value="">
 <input type=hidden name=ddrmckie value="">
 <input type=hidden name=edsmckie value="">
 <input type=hidden name=rtdmckie value="">
<!-- extra cookies --> 
 <input type=hidden name=tsdmckie value="">
 <input type=hidden name=tsdnckie value="">
 <input type=hidden name=smkmckie value="%EMRWEB02.01.207.0">
 <input type=hidden name=brtmckie value="%EMRWEB02.01.244">
 <input type=hidden name=brdmckie value="%EMRWEB02.01.234.0">
 <input type=hidden name=alcickie value="%EMRWEB02.01.227.0">
 <input type=hidden name=expdckie value="%EMRWEB02.01.149.0">
 <input type=hidden name=survckie value="">
 <!-- 06 : TAS : Fix triage values being removed on discharge -->
 <input type=hidden name=emvis128 value="%EMRWEB02.01.162.0">
 <input type=hidden name=emvis129 value="%EMRWEB02.01.163">
 <input type="hidden" name="stfrefin" id="stfrefin"
 value="%EMRWEB02.01.919">

<table width=100% align=center border=0 cellspacing=0 cellpadding=1>
<tr valign=top><td>
<table width=100% border=0 cellspacing=0 cellpadding=2>
<tr valign=top><td class=DataLabel width=15%>Presenting Complaint</td>
    <td><input type=text name=emvis060 max=3 size=3 value="%EMRWEB02.01.220.1"
       readonly class="Readonly">
        <input type=text name=v060name value="%EMRWEB02.01.220.0" readonly class="Readonly">
    </td>
	<!-- 01 : CTAS : add field label:  triage notes
    <td colspan=2><textarea name=brcom001 readonly cols=50 rows=4 class="Readonly"></textarea>
	-->
	<!-- 13 : TAS : Make triage notes display as ready-only -->
	<td class=DataLabel width=15%>Triage Notes</td>
    <td><textarea name=brcom001 class=Readonly readonly cols=50 rows=4></textarea>
<!-- end of change -->
    </td></tr>

<tr>
<td class=DataLabel>Provisional Diagnosis</td>
    <td colspan=2><input type=text name=dummy5 title="Provisional Diagnosis"
         size=52 value="%EMRWEB02.01.187" class="Mandatory ReadOnly" readonly>
		<input type=button class="button" value="Diagnosis"
		onclick='DiagnosisLink();'>
    </td>
	<td></td><td></td>
</tr>
<tr>
  <!-- 01 : CTAS : rename fields 
  <td class=DataLabel>Event End Date</td> -->
  <!-- 14 : TAS : Merge task 0893679 -->
  <td class=DataLabel>Treatment Completed</td>
  <td width=30%>
    <input type=text size=12 class="Mandatory PastDate" title="Treatment Completed Date"
     name=emvis024 id=emvis024 value="%EMRWEB02.01.124.0" onblur=""
     onchange="if(ValTime(emvis024,emvis025)){CheckDepartureDateNZ();CheckDepartVsTriage();}">
     <img notab src=../images/DateLookup.gif class=Icon
      onclick="DateLookupFrame(emvis024,EventTimeCheckDepartureDateNZ);CheckDepartVsTriage();">
     <input class=Mandatory type=text name=emvis025 id=emvis025 
     size=8 value="%EMRWEB02.01.125" title="Treatment Completed Time"
     onchange="if(ValTime(emvis024,emvis025)){CheckDepartureDateNZ();CheckDepartVsTriage();}">
     <img class=Icon src="../images/erase.gif"
     onclick="clrFields(emvis024,emvis025);CheckDepartureDateNZ();CheckDepartVsTriage();">
     <img notab src=../images/DateTimeStamp.gif class=Icon
     onclick="SetCurrentDateTime(emvis024,emvis025);CheckDepartureDateNZ();CheckDepartVsTriage();">
     <img notab src=../images/TimeLookup.gif class=Icon
     onclick="TimeLookupFrame(emvis025,EventTimeCheckDepartureDateNZ);">
  </td>
  <td class=DataLabel id="ExtDesc" disabled=true>%STANDARD.01.017.RX</td>
  <td>
    <select class="Mandatory" name=emvis152 title="%STANDARD.01.017.RX" disabled=true id="ExtField">
      <option></option>
      %EMRWEB02.01.193.2
    </select>
  </td>
</tr>

<tr>
  <td class=DataLabel>Departure Date</td>
  <td width=30%>
    <input type=text size=12 name=emvis150 class="Mandatory PastDate" onblur=""
     title="Departure Date" value="%EMRWEB02.01.191" onchange="checkDate(this,'Date');
     if(ValTime(emvis150,emvis151)){CheckDepartureDateNZ();}">
    <img notab src=../images/DateLookup.gif class=Icon
     onclick="DateLookupFrame(emvis150,DepartureTimeCheckDepartureDateNZ);">
    <input class=Mandatory type=text name=emvis151 size=8 title="Departure Time"
     value="%EMRWEB02.01.192"
     onchange="if(ValTime(emvis150,emvis151)){CheckDepartureDateNZ();}">
    <img class=Icon src="../images/erase.gif"
     onclick="clrFields(emvis150,emvis151);CheckDepartureDateNZ();">
    <img notab src=../images/DateTimeStamp.gif class=Icon
    onclick="SetCurrentDateTime(emvis150,emvis151);CheckDepartureDateNZ();">
    <img notab src=../images/TimeLookup.gif class=Icon
     onclick="TimeLookupFrame(emvis151,DepartureTimeCheckDepartureDateNZ);">
    <img notab src=../images/SwapIcon.gif class=Icon
     onclick="SetDepartureDateNZ();CheckDepartureDateNZ();">
  </td>
  <td class=DataLabel id="DelayDesc" disabled=true>%STANDARD.01.017.RY</td>
  <td>
    <select class="Mandatory" name=emvis153 title="%STANDARD.01.017.RY" disabled=true id="DelayField">
      <option></option>
      %EMRWEB02.01.194.2
    </select>
  </td>
</tr>

<!-- 09 : Add conditional display for Transfer Dest -->    
<tr>
  <td class=DataLabel>%STANDARD.01.017.ED</td>
  <td>
    <select name=emvis026 class=Mandatory 
		onblur="showDestination();"
		onchange="checkTrans();showDestination();"
		title="%STANDARD.01.017.ED">
      <option></option>
      %EMRWEB02.01.126.2
     </select>
  </td>
  <td class=DataLabel><div id=TransferDestDesc></div></td>
    <td><div id=TransferDestField></div></td>
</tr>					  
<tr>	 
	<!-- 11 : TAS : WP2-453 - remove class to work with new function -->
	<td class=DataLabel width=15%>Referred to on Departure</td>
  <td>
    <select class=Mandatory name=emvis051 title="Referred to on Departure">
      <option></option>
      %EMRWEB02.01.211.2
    </select>
  </td>
  <td colspan=2></td>
</tr>
</table>

<div id=Departure></div>

<table width=100% border=0 align=centre cellspacing=0 cellpadding=2>
<tr>
	<!-- 01 : CTAS : Add Smoking Status -->
	<!-- 12 : TAS : Add function to save change to database immediately -->
	<td class=DataLabel width=15%>%STANDARD.01.017.A7</td>
	<td width=30%><select name=emvis047 id=emvis047 
	class="Mandatory" title="%STANDARD.01.017.A7"
	onchange="updateSmokingStatus();">
		<option></option>
		%EMRWEB02.01.207.2
	</select></td>
	<!-- end of change -->
	<!-- 01 : CTAS : Remove field and Add Bed Requested
	<td class=DataLabel width=15%>Unit Request Date</td>
    <td class=DataLabel width=30%><select name=emvis073>
								  
         EMRWEB02.01.233.1
        </select>
    Time
    <input type="text" name=emvis083 size="8" value="EMRWEB02.01.243">
							   
    <img src="../images/DateTimeStamp.gif" class=Icon
     date=UpdateForm.emvis073 time=UpdateForm.emvis083>
    <img src=../images/TimeLookup.gif class=Icon time=UpdateForm.emvis083>
    </td>
	-->
	<td width=15%>Bed Requested Date</td>
    <td class=DataLabel>
      <input type=text name=emvis074  size=12
        onblur="SetDT(emvis074,emvis084);"
        title="Bed Requested Date"
        value="%EMRWEB02.01.234.0" tabindex=16>
	  <img src=../images/DateLookup.gif class=Icon date=UpdateForm.emvis074>
      <input type="text" name=emvis084 size="8" value="%EMRWEB02.01.244"
        onblur="SetDT(emvis074,emvis084);"
       title="Bed Requested Time" tabindex=17>
	  <img notab src=../images/DateTimeStamp.gif class=Icon
         onClick="SetCurrentDateTime(emvis074,emvis084);"> 
      <img src=../images/TimeLookup.gif class=Icon time=UpdateForm.emvis084>
    </td>
	<!-- end of change -->
	<!-- 01 : CTAS : Remove Ward Allocated D/T
    <td class=DataLabel width=15%>Ward Allocated Date</td>
    <td class=DataLabel><select name=emvis074 title="Ward Allocated Date"
         onchange="checkDateFunction();">
         EMRWEB02.01.234.1
    </select>
    Time
   <input type="text" name=emvis084 size="8" title="Bed Ready time" 
      value="EMRWEB02.01.244" onblur="checkTime(emvis084,'Bed Ready Time')">
    <img src="../images/DateTimeStamp.gif" class=Icon
     date=UpdateForm.emvis074 time=UpdateForm.emvis084>
    <img src=../images/TimeLookup.gif class=Icon time=UpdateForm.emvis084>
    </td>
	end of change -->
</tr>

<tr>
	<!-- 01 : CTAS : Remove Expected Unit, Add Alcohol Involved
	<td class=DataLabel>Expected Unit</td>
    <td><select name=emvis134 class=SelectBig title="Expected Unit">
        <option></option>
        EMRWEB02.01.173.2
        </select></td>
	-->
	<!-- 02 : DXC : Removed call to updateAlcoholInvolvedStatus() -->
	<!-- 12 : TAS : Add function to save change to database immediately -->
      <td>Alcohol Involved</td>
	  <td>
		<select name=emvis067 id=emvis067
			title="Alcohol Involved" class="Mandatory"
			onchange="updateAlcoholInvolvedStatus();">
		  <option></option>
		  %EMRWEB02.01.227.2
		</select>
	  </td>	
	<!-- end of change -->
    <td class=DataLabel>Expected Ward</td>
    <td class=DataLabel>
    <select name=emvis116 class=SelectBig title="Expected Ward">
<option></option>
      %EMRWEB02.01.149.2
         </select>
    </td></tr>

<!-- 01 : CTAS : Move Primary Diagnosis and Remove Claim Type
<tr>
	<td class=DataLabel>Primary Diagnosis</td>
    <td><input type=text name=dummy5 title="Primary Diagnosis"
         size=52 value="EMRWEB02.01.187" class=ReadOnly readonly>
    </td>
end of change -->
<!-- 02 : DXC : changed claim type to hidden value
				removed label and option drop down

    <td class=DataLabel>STANDARD.01.017.CL</td>
     03 : TAS : Fix hidden value -->
<tr style="display:none"><td>%STANDARD.01.017.CL</td>
    <td><select name=emvis008 
         title="%STANDARD.01.017.CL">	
    <option></option>
    %EMRWEB02.01.108.2
    </select>	
    </td>	
	</tr>
<!-- end of change -->
<!-- 01 : CTAS : Remove HP
<tr>
  <td>STANDARD.01.017.HP</td>
  <td>
    <select name=emvis160 class=Mandatory
     title="STANDARD.01.017.HP">
      <option value=""></option>
      EMRWEB02.01.281.2
    </select>
  </td>
 -->  
<!-- Alcohol Involved - CAR 312772/TSK 0817059 -->
<!--
  <td>STANDARD.01.017.es</td>
  <td>
    <select name=emvis067 class=Mandatory
     title="STANDARD.01.017.es">
      <option value=""></option>
      EMRWEB02.01.227.2
    </select>
  </td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
end of change-->
<!-- 01 : CTAS : Add Surveillance -->
<tr>
	<td colspan=2></td>
	<td class=DataLabel><label for=emvis069>%STANDARD.01.017.eu</label></td>
	<input type=hidden name=name_emvis069>
    <td><select name=emvis069 title="%STANDARD.01.017.eu" 
		id=emvis069 class="SelectBig">
        <option></option>
        %EMRWEB02.01.229.2
        </select>
	</td>	
</tr>
<tr>
<td colspan=5>&nbsp;</td>
</tr>
<tr><td colspan=5 align=center><br>
    <input type=button value="Discharge" class="button" 
     onclick="BtnDischargeClick();">
    <input type=button value="Cancel" class="button" 
     onclick='fnPatientLink("%EMRWEB02.01.003","%EMRWEB02.01.081");'>
</td></tr>
</table>
</table>
</form>
<!-- 01 : CTAS : Conditional Display of Transfer Destination -->
<span id=ShowTransferDestBlank style="display:none">
  <input type=hidden name=emvis033 value=" ">
</span>

<span id=ShowTransferDestDesc style="display:none">
  Transfer Destination
</span>

<span id=ShowTransferDestField style="display:none">
													   
														   
	<input type=text size=6 maxlength=6 name=emvis033 id=emvis033
         title="Transfer Destination" value="%EMRWEB02.01.133.1"
         onchange="validateCode(9,emvis033,name_emvis033n);"
		 class="Mandatory">
        <input type=text size=30 name=name_emvis033n readonly
         value="%EMRWEB02.01.133.0"
		 class="Readonly">
    <img src=../images/SearchIcon.gif 
         onClick="TransferSourceFrame(emvis033,name_emvis033n);">
</span>
<!-- end of change -->
<form name=HiddenFields method=get>
<input type=hidden name=DischargeComplete value="%EMRWEB02.01.147">
<input type=hidden name=HospitalAdmission value="%EMRWEB02.01.148">
<input type=hidden name=ExpectedUnit value="%EMRWEB02.01.173.1">
<input type=hidden name=ShowOutstanding value="%EMRWEB02.01.474">
</form>
<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=regexstm value=102>
<input type=hidden name=newstand value=1>
<input type=hidden name=urnumber value="%EMRWEB02.01.003">
<input type=hidden name=admissno value="%EMRWEB02.01.081">
<input type=hidden name=emrgflag value="Y">
<input type=hidden name=nextpage value="4">
<input type=hidden name=MenuType value="11">
</form>

<script type="text/javascript">
// 01 : CTAS : HP removed
//for(var i=0; i<document.UpdateForm.emvis160.length; i++){
//  if(document.UpdateForm.emvis160.options[i].value.substring(0,3)=="%EMRWEB02.01.281.0"){
//     document.UpdateForm.emvis160.selectedIndex=i;
//     break;
//  }
//}
</script>
</body></html>

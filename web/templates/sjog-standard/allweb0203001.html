<meta name="TemplateVersion" content="V12.00.00">
<meta name="TemplateHome" content="sjog-standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/allweb02.js"></script>
<script type="text/javascript" src="../js/eReferralReg.js"></script>
<script type="text/javascript" src="../js/patweb69.js"></script>
<script type="text/javascript">
//------------------------------------------------------------
// Set Link ACC Redirect and Return program after link ACC
//------------------------------------------------------------
function SetLinkACC(CurForm,ReturnCd) {
  if ((CurForm.ptcnueoc.value==1)&&(CurForm.alref035.value.substr(5,1)=='A')) {
       CurForm.redirect.value="eocweb01.pbl?reportno=01&template=006"
             + "&urnumber=" + CurForm.urnumber.value.replace(/ /g,"+")
             + '&returncd=' + ReturnCd
             + "&admissno=";
  }
} //end SetLinkACC
function AddReferral(theForm) {
  window.PageUpdateForm=theForm
  theForm.target="PopUpFrame1";

  if (document.UpdateForm.dispt001!=undefined &&
      !isWhitespace(document.UpdateForm.dispt001.value)) {
    var serverURL   = "../cgi-bin/comweb80.pbl?reportno=44" +
                    "&valdcode=" + UpdateForm.dispt001.value.replace(/ /g,"+") +
                    UpdateForm.alref019.value.replace(/ /g,"+");
    var returnValue = RSExecute(serverURL);
    if (returnValue.status!=0) {
      return;
    }
  }

  if (validateMandatory(theForm)) {
    SetLinkACC(theForm,"AL1");
    theForm.submit(); }
}
function valClaimCode() {
  validateCode(41,UpdateForm.urnumber,UpdateForm.claimc);
  for (var i =0 ; i < document.UpdateForm.alref035.length; i++) {
    if (document.UpdateForm.claimc.value==
        trim(document.UpdateForm.alref035.options[i].value.substr(0,3))){
          document.UpdateForm.alref035.selectedIndex=i;
    }
  }
}
function SetList() {
  p=UpdateForm
  var SetSite
  if(isWhitespace(p.alref119.value)) {
    SetSite=p.wbsesite.value;
  } else {
    SetSite=p.alref119.value;
  }
 for (var i =0 ; i < document.UpdateForm.alref119.length; i++) {
  if (document.UpdateForm.alref119.options[i].value==SetSite.substr(0,6)) {
       document.UpdateForm.alref119.selectedIndex=i } };
}
function displayDisaster() {
  if (document.UpdateForm.ptcnudpd.value=="1") {
    disastercodetitleDIV.innerHTML=disastercodetitleSPAN.innerHTML;
    disastercodeDIV.innerHTML=disastercodeSPAN.innerHTML;
  }
}
function displayDisasterID() {
 p=document.UpdateForm
  if (!isWhitespace(p.dispt001.value)) {
    disasteridnumbertitleDIV.innerHTML=disasteridnumbertitleSPAN.innerHTML;
    disasteridnumberDIV.innerHTML=disasteridnumberSPAN.innerHTML;
  } else {
    disasteridnumbertitleDIV.innerHTML="";
    disasteridnumberDIV.innerHTML="";
  }

  if (!isWhitespace(disasteridnumberDIV.innerHTML)) {
    var serverURL   = "../cgi-bin/patweb80.pbl?reportno=98" +
                    "&valdcode=" + UpdateForm.urnumber.value.replace(/ /g,"+") +
                    UpdateForm.dispt001.value.replace(/ /g,"+");
    var returnValue = RSExecute(serverURL);
    if (returnValue.status==0) {
      ReturnValue=returnValue.return_value.split("|");
      if (!isWhitespace(ReturnValue[0])) {
        p.dispt002.value=ReturnValue;
        p.dispt002.className="Readonly";
        p.dispt002.readOnly=true;
      }
    }
  }
}
function SearchRedirect() {
  var p = document.UpdateForm;

  var sURL = "patweb69.pbl?reportno=01&template=001" +
             "&srchsnam=" + p.srchsnam.value +
             "&srchgnam=" + p.srchgnam.value +
             "&srchmnam=" + p.srchmnam.value +
             "&srchpsex=" + p.srchpsex.value +
             "&srchpdob=" + p.srchpdob.value +
             "&srchmedi=" + p.srchmedi.value + "&srchtype=1";

  var sRedirectURL = "allweb02.pbl?reportno=02&template=001" +
                     "&urnumber=" + p.urnumber.value.replace(/ /g,"+") +
                     "&admissno=" + p.admissno.value.replace(/ /g,"+");

  sURL += "&redirect=" + encodeURIComponent(sRedirectURL);

  DFrameExit();

  setTimeout(function() {
    top.content.location.href = sURL;
  }, 100);
}

function dispRefPracNSW(){
 //Show Referred by Practice, Type of referral, Preferred date 
 //and make Referred By mandatory for NSW only
 if (document.getElementById('ptcnhdps').value == '2'){
    document.getElementById('n_alref022').className="Mandatory";
    document.getElementById('nswRefPrac').style.display="";
    nswPreferredDateDL.innerHTML=nswPreferredDateLabel.innerHTML;
    nswPreferredDateDF.innerHTML=nswPreferredDateData.innerHTML;
 }
 else {
    document.getElementById('n_alref022').className="";
    document.getElementById('alref124').className="";
    document.getElementById('nswRefPrac').style.display="none";
    nswPreferredDateDL.innerHTML=blankSPAN.innerHTML;
    nswPreferredDateDF.innerHTML=blankSPAN.innerHTML;
 }
}

function nswSearchHCP(){
 p=document.UpdateForm;
 if (document.getElementById('ptcnhdps').value == '2'){
    GPHCPSearchFrame(p.alref022,p.n_alref022,p.dummy,p.alref023,
                     p.n_alref023,p.alref024,0); }
 else {
    HCPSearchFrame(p.alref022,p.n_alref022,7); } 
}

function nswClearHCP(){
 p=document.UpdateForm;
 if (document.getElementById('ptcnhdps').value == '2'){
    clrFields(p.alref022,p.n_alref022,p.alref023,p.n_alref023,p.alref024); }
 else {
    clrFields(p.alref022,p.n_alref022); }
}

</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);valClaimCode();SetList();displayDisaster();
  dispRefPracNSW();OnlineReferral();eRefPreList();
  FilterReferralSource(UpdateForm);">
<span class=DFrameTitleBar>
<img border=0 align=right src="../images/ExitIcon.gif" onclick="DFrameExit();">
%ALLWEB02.03.125.0  Referral
</span>
<div id=PageBodySection style="overflow: auto;">
<form name=UpdateForm action="allweb02.pbl" method=post
 onsubmit='return validateMandatory(UpdateForm);' >
<input type=hidden name=reportno value="2">
<input type=hidden name=updatety value="A">
<input type=hidden name=nextpage value="5">
<input type=hidden name=redirect value="%ALLWEB02.03.001.allweb02.02.001">
<input type=hidden name=urnumber value="%ALLWEB02.03.003">
<input type=hidden name=admissno value="%ALLWEB02.03.081">
<input type=hidden name=MenuType value="%ALLWEB02.03.088">
<input type=hidden name=deptcode value="%ALLWEB02.03.125.1">
<input type=hidden name=uservari value="%ALLWEB02.03.113">
<input type=hidden name=override value="0">
<input type=hidden name=usermemr value="">
<input type=hidden name=dummy id=dummy>
<input type=hidden name=mvmedrec>
<input type=hidden name=claimc>
<input type=hidden name=ptcnueoc value="%ALLWEB02.03.203">
<input type=hidden name=sacsvisn value="%ALLWEB02.03.207">
<input type=hidden name=wbsesite value="%STANDARD.01.023">
<input type=hidden name=ptcnudpd value="%STANDARD.01.025.118.153.0.1">
<input type=hidden name=erefrlid value="%ALLWEB02.03.827">
<input type=hidden name=eautoadd value="eAutoAdd">
<input type=hidden name=erefmaprf id="erefmaprf" value="1">
<input type=hidden name=ptcnuepm value="%STANDARD.01.025.125.155.0.1">
<input type=hidden name=srchsnam value="%ALLWEB02.03.009">
<input type=hidden name=srchgnam value="%ALLWEB02.03.499.001">
<input type=hidden name=srchmnam value="%ALLWEB02.03.499.002">
<input type=hidden name=srchpsex value="%ALLWEB02.03.086.082">
<input type=hidden name=srchpdob value="%ALLWEB02.03.020">
<input type=hidden name=srchmedi value="%ALLWEB02.03.027">
<input type=hidden name=d_depcod value="%ALLWEB02.03.125.3">
<input type=hidden name=ptcnhdps id=ptcnhdps  
                                     value="%STANDARD.01.025.080.250.1.1">

<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel>Department Code</td>
    <td><input name=allrf001 type=text value="%ALLWEB02.03.125.0" readonly
	  class=Readonly></td>
    <td class=DataLabel>Entered by</td>
    <td><input	type=text value="%ALLWEB02.03.168" readonly 
	  class=Readonly></td></tr>

<tr><td class=DataLabel>Priority</td>
    <td><select title="Priority" name=alref027 class="Mandatory SelectBig"
         tabindex=1>
        <option></option>
        %ALLWEB02.03.127.2
        </select></td>
    <td class=DataLabel>Referral Date</td>
    <td class=DataField>
    <input type=text name=alref019 size=12 tabindex=40
     onblur="checkDate(this,'Date')"
     class= "Mandatory PastDate" title="Referral Date">
    <img src=../images/DateTimeStamp.gif class=Icon date=UpdateForm.alref019
     time=null>
    <img src=../images/DateLookup.gif class=Icon date=UpdateForm.alref019>
    </td></tr>

<tr><td class=DataLabel>Referral Source</td>
    <td><select title="Referral Source" name=alref034 tabindex=3
         class="Mandatory SelectBig">
	<option></option>
	 %ALLWEB02.03.134.2
	</select></td>
    <td class=DataLabel>Referred By</td>
    <td><input type=hidden name=alref022 id=alref022
	 value="%ALLWEB02.03.122.1">
	<input type=text name=n_alref022 id=n_alref022 readonly 
         title="Referred By HCP Name"
	 value="%ALLWEB02.03.122.0" notab>
	<img src="../images/SearchIcon.gif" class=Icon tabindex=41
	 onclick="nswSearchHCP();">
        <img src="../images/ClearIcon.gif" class=Icon
         onclick="nswClearHCP();">
	</td></tr>

<tr id=nswRefPrac>
    <td class=DataLabel>Type of Referral</td>
    <td><select name=alref124 id=alref124 title="Type of Referral" tabindex=5
         class="SelectBig Mandatory">
        <option></option>
         %ALLWEB02.03.186.4
        </select></td>
    <td class=DataLabel>Referred By Practice</td>
    <td><input type=hidden name=alref023 id=alref023 value="%ALLWEB02.03.123.0"
         title="HCP Practice">
        <input type=text size=35 class=readonly value="%ALLWEB02.03.123.1"
         tabindex=-1
         title="Practice Name" readonly name=n_alref023 id=n_alref023>
        <input type=hidden name=alref024 id=alref024
         title="Practice Count" value="%ALLWEB02.03.124">
        <img src="../images/SearchIcon.gif" class=Icon tabindex=42
         onclick="GPHCGSearchFrame(UpdateForm.alref022,UpdateForm.n_alref022,
                  UpdateForm.dummy,UpdateForm.alref023,
                  UpdateForm.n_alref023,UpdateForm.alref024);">
        <img src="../images/erase.gif" class=Icon
         onclick="clrFields(UpdateForm.alref023,UpdateForm.n_alref023,
                  UpdateForm.alref024,UpdateForm.dummy);">
    </td></tr>


<tr><td class=DataLabel>Responsible HCP</td>
    <td><input type=text name=alref038 size=10 maxlength=10 
         title="Responsible HCP"
	 value="%ALLWEB02.03.138.1" tabindex=7
          onblur="if (checkAlphanumDesc(event,this) != false) {
                    ValidateHCP(18,13,UpdateForm.alref038,
                    UpdateForm.n_alref038);
                  }">
	<input type=text name=n_alref038 size=30 readonly title="HCP Name"
	 value="%ALLWEB02.03.138.0" class=Readonly>
	<img src="../images/SearchIcon.gif" class=Icon
         onclick="HCPSearchFrame(UpdateForm.alref038,UpdateForm.n_alref038,4);">
	</td>
    <td class=DataLabel>Link to Visit</td>
    <td><input type=text size=10 maxlength=8 name=alref005 tabindex=43
         onblur="justifyRight(this);
                ValidateVisit(UpdateForm.alref005,UpdateForm.urnumber,
                UpdateForm.dummy);" >
        <img src="../images/SearchIcon.gif" class=Icon
         onclick="VisitSearchFrame(UpdateForm.urnumber,UpdateForm.alref005);">
    </td></tr>

<tr><td class=DataLabel>%STANDARD.01.017.CL</td>
    <td><select title="%STANDARD.01.017.CL" name=alref035 tabindex=9
         class="Mandatory SelectBig">
	<option></option>
	 %ALLWEB02.03.135.9.1.10.2.X
	</select></td>
    <td class=DataLabel>Event Program</td>
    <td><select class="SelectBig" name=alref145 title="Event Program" 
         tabindex=44>
        <option></option>
         %ALLWEB02.03.199.016.4
        </select></td>
    </tr>

<tr><td class=DataLabel>Reason for Referral</td>
    <td><select title="Reason for Referral" name=alref028 tabindex=11
         class="Mandatory SelectBig" maxlength=49>
	<option></option>
	 %ALLWEB02.03.128.2
	</select></td>
    <td class=DataLabel><div id=disastercodetitleDIV></div></td>
    <td><div id=disastercodeDIV></div></td>
</tr>

<tr><td class=DataLabel>Diagnosis 1</td>
    <td><select maxlength=45 name=alref031 class=SelectBig tabindex=13
         title="Diagnosis 1" >
	<option></option>
	%ALLWEB02.03.131.2
	</select></td>
    <td class=DataLabel><div id=disasteridnumbertitleDIV></div></td>
    <td><div id=disasteridnumberDIV></div></td>
</tr>

<tr><td class=DataLabel>Diagnosis 2</td>
    <td><select maxlength=45 name=alref032 class=SelectBig tabindex=15
         title="Diagnosis 2" >
	<option></option>
	%ALLWEB02.03.132.2
	</select></td>
    <td><div id=nswPreferredDateDL></div></td>
    <td><div id=nswPreferredDateDF></div></td>
</tr>


<tr><td class=DataLabel>Diagnosis 3</td>
    <td><select maxlength=45 name=alref033 class=SelectBig tabindex=17
         title="Diagnosis 3" >
	<option></option>
	%ALLWEB02.03.133.2
	</select></td></tr>

<tr><td class=DataLabel>Clinic Type </td>
    <td><select class=SelectBig name=alref106 maxlength=45 tabindex=19
         title="Clinic Type">
	<option></option>
	%ALLWEB02.03.167.2
	</select></td></tr>

<tr><td class=DataLabel>Bulk Billed</td>
    <td><input type=checkbox name=alref036 title="Bulk Billed" 
         value="1" tabindex=21>
    </td></tr>

<tr><td class=DataLabel>Activate Referral</td>
    <td><input type=checkbox name=alref003 value="1" title="Activate Referral" 
         tabindex=23>
    </td></tr>

<tr><td class=DataLabel>Comments 1</td>
    <td colspan=3><input type=text size=65 maxlength=60 name=alref088 
     tabindex=25>
    </td></tr>

<tr><td class=DataLabel>Comments 2</td>
    <td colspan=3><input type=text size=65 maxlength=60 name=alref089 
     tabindex=26>
    </td></tr>

<tr><td class=DataLabel>Case Team</td>
   <td><input type=text name=alref087 size=11 maxlength=10 title="Case Team"
        onblur="if (checkAlphanumDesc(event,this) != false) {
                  validateCode2(7,UpdateForm.alref087,UpdateForm.n_alref087);
                }" tabindex=29>
       <input type=text name=n_alref087 size=30 readonly 
        class=Readonly tabindex=-1 title="Team Description">
       <img src="../images/SearchIcon.gif" class=Icon
        onclick="TeamSearchFrame(UpdateForm.alref087,UpdateForm.n_alref087);">
        <img src="../images/ClearIcon.gif" class=Icon
        onclick="clrFields(UpdateForm.alref087,UpdateForm.n_alref087);">
       </td></tr>


<tr><td class=DataLabel>Preferred Site</td>
    <td class=DataField><select name=alref119 title="Preferred Site"
      tabindex=31>
      <option></option>
      %ALLWEB02.03.182.2
    </select>
    </td></tr>

<tr><td class=DataLabel
     colspan=2>Print Referral Letter to Patient&nbsp;&nbsp;&nbsp;
     <input type=checkbox name=prtnewpt tabindex=33
      title="New Referral to pat" value="1">
      </td>
      <td class=DataLabel>Printer </td>
      <td><select name=prtpsl01 class=SelectBig tabindex=60>
      %STANDARD.01.001.ALLNEWPT.01
      </select></td></tr>

<tr><td class=DataLabel colspan=2>Print Referral Letter to Referrer
      <input type=checkbox name=prtnewrf tabindex=35
       title="New Referral to pat" value="1">
      </td>
      <td class=DataLabel>Printer </td>
      <td><select name=prtpsl02 class=SelectBig tabindex=62>
      %STANDARD.01.001.ALLNEWRF.01
      </select></td></tr>

<tr><td class=DataLabel colspan=2>Referral Labels
    <input type=checkbox value="1" name=prtreflb width=30% tabindex=37
        onclick="SetPrinter(UpdateForm.prtpno07,UpdateForm.prtpsl07);">
    Copies
    <select name=prtpno07 width=20% tabindex=38>
        %STANDARD.01.027.2.1
    </select></td>
    <td class=DataLabel>Printer</td>
    <td><select class="SelectBig" name=prtpsl07 title="Printer" width=15%
         tabindex=64>
        <option></option>
        %STANDARD.01.001.LABELALL.01
        </select></td></tr>

<tr><td colspan=4 align=center><br>
    <input type=button id=addbtn name=formactn value="Add" class="button"
     onclick="tempDisable(this);AddReferral(UpdateForm);" tabindex=100>
    <input type=button Value="Cancel" class="button" 
     onclick="DFrameCloseRefresh();" tabindex=101>
    </td></tr>

</table>
</form>
</div>

<span id=disastercodetitleSPAN style="display:none">
Disaster Code
</span>

<span id=disastercodeSPAN style="display:none">
<select name=dispt001 tabindex=44 title="Disaster Code"
         onchange="displayDisasterID();">
         <option></option>
          %ALLWEB02.03.213
        </select>
</span>

<span id=disasteridnumbertitleSPAN style="display:none">
Disaster Identification #
</span>

<span id=disasteridnumberSPAN style="display:none">
<input type="text" name=dispt002 size=20 maxlength=19
   tabindex=46 title="Disaster Identification Number">
</span>

<span id=nswPreferredDateLabel style="display:none">
    Preferred Date</span>

<span id=nswPreferredDateData style="display:none">
    <input type=text name=alref096 id=alref096 size=12 tabindex=48
     onblur="checkDate(this,'Date')" value="%ALLWEB02.03.157"
     class="Date" title="Preferred Date">
    <img src="../images/DateTimeStamp.gif" class=Icon date=UpdateForm.alref096
     time=null>
    <img src="../images/DateLookup.gif" class=Icon date=UpdateForm.alref096>
</span>

<span id=blankSPAN style="display:none">&nbsp;</span>

<meta name="TemplateVersion" content="V12.00.00">
<meta name="TemplateHome" content="sjog-standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/emrweb0201004.js"></script>
<script type="text/javascript" src="../js/EmergencyPrimaryDiagSearch.js"></script>
<script type="text/javascript">
function changeMHDocDateTime() {
  var validateresult = validateMandatory(document.UpdateForm);
    if (validateresult==true) {
      linkurl="emrweb02.pbl?reportno=1&template=117" +
              "&urnumber=" + document.UpdateForm.urnumber.value +
              "&admissno=" + document.UpdateForm.admissno.value 
      Left=(document.body.clientWidth-600)/2;
      DFrameLink(linkurl,100,Left,600,350);
  }
}
function PressUpdate() {
//
  if (isWhitespace(document.UpdateForm.emvcd005.value)&&
      !isWhitespace(document.UpdateForm.emvcd033.value)) {
      alert("Primary Diagnosis selection field is mandatory.");
      return;
  }
  if (isWhitespace(document.UpdateForm.a_emvcd005.value)&&
      !isWhitespace(document.UpdateForm.a_emvcd033.value)) {
      alert("Additional Diagnosis selection field is mandatory.");
      return;
  } 
  submitPrimaryDiag();
}
function PressUpdateFinish() {
  document.UpdateForm.formactn.value="C1";
  document.UpdateForm.updttype.value="UPDAT";
  if(!validateMandatory(UpdateForm)) {
    return;
  }
//  Perform discharge as discharge details have just been entered
  if(isWhitespace(document.getElementById("d_emvis026").value) &&
     !isWhitespace(document.getElementById("emvis026").value) &&
     document.getElementById("DischargeComplete").value=="1") {
     DoDischarge();
     return;
  }
//  Check if user want to discharge the visit
  if(!isWhitespace(document.getElementById("d_emvis026").value) &&
     !isWhitespace(document.getElementById("emvis026").value) &&
     document.getElementById("DischargeComplete").value=="1") {
     if(confirm("Do you want to discharge the patient")) {
       DoDischarge();
       return;
     }
  }
  onUpdate();
}
function checkUR(status) {
  if(!validateMandatory(document.UpdateForm)) {
    return;
  }
//  Perform discharge as discharge details have just been entered
  if(isWhitespace(document.getElementById("d_emvis026").value) &&
     !isWhitespace(document.getElementById("emvis026").value) &&
     document.getElementById("DischargeComplete").value=="1") {
     validateCurrentLocation(DoDischarge);
     return;
  }
//
  if(status==1) {
     PatientLink('emrweb02.pbl',1,101);
  } else {
    PatientLink('emrweb02.pbl',1,109);
  }
}
function ReturnToMap(){
  if(parent.TogglePanel==null){
     parent.menu.location.href='emrweb01.pbl?reportno=1&template=1';
  }
  else{
     parent.TogglePanel();
  }
}
function UpdDoctor() {
//  if(!validateMandatory(UpdateForm)) {
//     UpdateForm.emvis007.value=UpdateForm.emvis007.defaultValue;
//     UpdateForm.dummy3.value=UpdateForm.dummy3.defaultValue;
//     return;
//  }
    
  SetTreatingDoc();
  if (UpdateForm.emcndoct.value==1) {
    UpdEmrDoc(UpdateForm.emvis007);
   
  }
  else {
    UpdDoc(UpdateForm.emvis007);
  }
}
function SearchDoctor() {
  if (UpdateForm.emcndoct.value==1) {
    DoctorEmrSearchFrame(UpdateForm.emvis007,UpdateForm.dummy3);
  }
  else {
    DoctorSearchFrame(UpdateForm.emvis007,UpdateForm.dummy3);
  }
}
function SearchDoctorOth() {
  if (UpdateForm.emcndoct.value==1) {
    DoctorEmrSearchFrame(UpdateForm.emvis109,UpdateForm.n_emvis109);
  }
  else {
    DoctorSearchFrame(UpdateForm.emvis109,UpdateForm.n_emvis109);
  }
}
function ChkOtherDoctor() {
  if(isWhitespace(UpdateForm.emvis109.value)) {
     return;
  }
  UpdateForm.emvis109.value=UpdateForm.emvis109.value.toUpperCase()
  a=trim(UpdateForm.emvis109.value);
  b=trim(UpdateForm.emvis109.defaultValue);
  if (UpdateForm.emvis109.value.substr(0,1) == " ") {
      UpdateForm.emvis109.value = a;
  }
  if (a == b)  { return;; }

  // validate doctor exists in patdo1af
  var serverURL   = "../cgi-bin/patweb80.pbl?reportno=3" +
                    "&valdcode=" + UpdateForm.emvis109.value.replace(/ /g,"+")

  if (IEBrowser) {
    var returnValue = RSExecute(serverURL);

    if (returnValue.status!=0) {
      document.UpdateForm.emvis109.value=document.UpdateForm.emvis109.defaultValue;
      document.UpdateForm.n_emvis109.value=document.UpdateForm.n_emvis109.defaultValue;
      UpdateForm.emvis109.focus();
      return;
    }
    if (returnValue.status==0) {
      ReturnValues=returnValue.return_value.split("|");
      document.UpdateForm.n_emvis109.value=ReturnValues[0];
    }
    if (UpdateForm.emcndoct.value==1) {
      // validate doctor exists in emrdocaf
      var serverURL   = "../cgi-bin/emrweb08.pbl?reportno=11" +
                        "&valdcode=" + UpdateForm.emvis109.value.replace(/ /g,"+")
      var returnValue = RSExecute(serverURL);
      if (returnValue.status!=0) {
        document.UpdateForm.emvis109.value=document.UpdateForm.emvis109.defaultValue;
        document.UpdateForm.n_emvis109.value=document.UpdateForm.n_emvis109.defaultValue;
        UpdateForm.emvis109.focus();
        return;
      }
      if (returnValue.status==0) {
        ReturnValues=returnValue.return_value.split("|");
        document.UpdateForm.n_emvis109.value=ReturnValues[0];
      }
    }
  }
  else {
    var returnValue = RSExecuteFetch(serverURL);

    returnValue.then(
      function (returnValue) {
        returnValue = ParseFetchData(returnValue);  // parse fetch() result

        if (returnValue.status!=0) {
          document.UpdateForm.emvis109.value=document.UpdateForm.emvis109.defaultValue;
          document.UpdateForm.n_emvis109.value=document.UpdateForm.n_emvis109.defaultValue;
          UpdateForm.emvis109.focus();
          return;
        }
        if (returnValue.status==0) {
          ReturnValues=returnValue.return_value.split("|");
          document.UpdateForm.n_emvis109.value=ReturnValues[0];
        }
        if (UpdateForm.emcndoct.value==1) {
          // validate doctor exists in emrdocaf
          var serverURL   = "../cgi-bin/emrweb08.pbl?reportno=11" +
                            "&valdcode=" + UpdateForm.emvis109.value.replace(/ /g,"+")
          var returnValue = RSExecuteFetch(serverURL);

          returnValue.then(
            function (returnValue) {
              returnValue = ParseFetchData(returnValue);  // parse fetch() result
              if (returnValue.status!=0) {
                document.UpdateForm.emvis109.value=document.UpdateForm.emvis109.defaultValue;
                document.UpdateForm.n_emvis109.value=document.UpdateForm.n_emvis109.defaultValue;
                UpdateForm.emvis109.focus();
                return;
              }
              if (returnValue.status==0) {
                ReturnValues=returnValue.return_value.split("|");
                document.UpdateForm.n_emvis109.value=ReturnValues[0];
              }
            }
          );
        }
      }
    );
  }
}
function SetOtherDoc() {
  SetCookie("OtherDoc",UpdateForm.admissno.value,20);
}
function MandOtherDoctor() {
  f = document.UpdateForm;
  if(isWhitespace(UpdateForm.emvis109.value)) {
    return;
  }
  mandatory=GetCookieData("OtherDoc");
  if(trim(mandatory)!=trim(UpdateForm.admissno.value)) {
    return;
  }
  if (isWhitespace(f.ptcnnssi.value) ||
      f.ptcnnssi.value == "00000000000000000000") {
    document.UpdateForm.emvis079.className="BackDate Mandatory"
    document.UpdateForm.emvis079.readOnly=false;
    document.UpdateForm.emvis089.className="Time Mandatory";
    document.UpdateForm.emvis089.readOnly=false;
  }
  else {
    document.UpdateForm.emvis080.className="BackDate Mandatory"
    document.UpdateForm.emvis080.readOnly=false;
    document.UpdateForm.emvis090.className="Time Mandatory";
    document.UpdateForm.emvis090.readOnly=false;
  }
  ExpireCookiePath('OtherDoc');
}
function SaveOtherDoctor() {
  f = document.UpdateForm;
  if (isWhitespace(f.ptcnnssi.value) ||
      f.ptcnnssi.value == "00000000000000000000") {
    SaveOtherDoctorNoEdward();
  }
  else {
    SaveOtherDoctorEdward();
  }
}
function SaveOtherDoctorEdward() {
  if(trim(UpdateForm.emvis109.value)==trim(UpdateForm.emvis109.defaultValue) &&
     trim(UpdateForm.emvis080.value)==trim(UpdateForm.emvis080.defaultValue) &&
     trim(UpdateForm.emvis090.value)==trim(UpdateForm.emvis090.defaultValue)) {
     return;
  }

  if(UpdateForm.emvis109.value!=UpdateForm.emvis109.defaultValue) {
    ChkOtherDoctor();
  }

  if(UpdateForm.emvis080.value!=UpdateForm.emvis080.defaultValue) {
    if(!checkDate(UpdateForm.emvis080)) {
      return;
    }
  }
  if(UpdateForm.emvis090.value!=UpdateForm.emvis090.defaultValue) {
    if(!checkTime(UpdateForm.emvis090)) {
      return;
    }
  }
  if(isWhitespace(UpdateForm.emvis109.value)) {
     return;
  }
  if(isWhitespace(UpdateForm.emvis080.value) ||
     isWhitespace(UpdateForm.emvis090.value)) {
     UpdateForm.emvis080.readOnly=false;
     UpdateForm.emvis090.readOnly=false;
     SetCurrentDateTime(UpdateForm.emvis080,UpdateForm.emvis090);
     UpdateForm.emvis080.readOnly=true;
     UpdateForm.emvis090.readOnly=true;
  }
  if(!CheckDateTimeRange(UpdateForm.arrvdate,UpdateForm.arrvtime,
                         UpdateForm.emvis080,UpdateForm.emvis090)) {
    alert("Senior doctor date/time can't be prior" +
          " to the arrival date/time")
    UpdateForm.emvis080.value="";
    UpdateForm.emvis090.value="";
    return;
  }
  RemoteEmrUpdate(UpdateForm.admissno,UpdateForm.emvis109);
  RemoteEmrUpdate(UpdateForm.admissno,UpdateForm.emvis080);
  RemoteEmrUpdate(UpdateForm.admissno,UpdateForm.emvis090);
  RemoteEmrHistory(UpdateForm.admissno,"OTDOC");
  SetOtherDoc();

  ReloadScreen();
}
function SaveOtherDoctorNoEdward() {
  if(trim(UpdateForm.emvis109.value)==trim(UpdateForm.emvis109.defaultValue) &&
     trim(UpdateForm.emvis079.value)==trim(UpdateForm.emvis079.defaultValue) &&
     trim(UpdateForm.emvis089.value)==trim(UpdateForm.emvis089.defaultValue)) {
     return;
  }

  if(UpdateForm.emvis109.value!=UpdateForm.emvis109.defaultValue) {
    ChkOtherDoctor();
  }

  if(UpdateForm.emvis079.value!=UpdateForm.emvis079.defaultValue) {
    if(!checkDate(UpdateForm.emvis079)) {
      return;
    }
  }
  if(UpdateForm.emvis089.value!=UpdateForm.emvis089.defaultValue) {
    if(!checkTime(UpdateForm.emvis089)) {
      return;
    }
  }
  if(isWhitespace(UpdateForm.emvis109.value)) {
     return;
  }
  if(isWhitespace(UpdateForm.emvis079.value) ||
     isWhitespace(UpdateForm.emvis089.value)) {
     UpdateForm.emvis079.readOnly=false;
     UpdateForm.emvis089.readOnly=false;
     SetCurrentDateTime(UpdateForm.emvis079,UpdateForm.emvis089);
     UpdateForm.emvis079.readOnly=true;
     UpdateForm.emvis089.readOnly=true;
  }
  if(!CheckDateTimeRange(UpdateForm.arrvdate,UpdateForm.arrvtime,
                         UpdateForm.emvis079,UpdateForm.emvis079)) {
    alert("Senior doctor date/time can't be prior" +
          " to the arrival date/time")
    UpdateForm.emvis079.value="";
    UpdateForm.emvis089.value="";
    return;
  }
  RemoteEmrUpdate(UpdateForm.admissno,UpdateForm.emvis109);
  RemoteEmrUpdate(UpdateForm.admissno,UpdateForm.emvis079);
  RemoteEmrUpdate(UpdateForm.admissno,UpdateForm.emvis089);
  RemoteEmrHistory(UpdateForm.admissno,"OTDOC");
  SetOtherDoc();

  ReloadScreen();
}
function UpdateOtherDoctorDateTimeEdward() {
  f = document.UpdateForm;
  if(trim(f.emvis080.value)==trim(f.emvis080.defaultValue) &&
     trim(f.emvis090.value)==trim(f.emvis090.defaultValue)) {
     return;
  }

  if(f.emvis080.value!=f.emvis080.defaultValue) {
    if(!checkDate(f.emvis080)) {
      return;
    }
  }
  if(f.emvis090.value!=f.emvis090.defaultValue) {
    if(!checkTime(f.emvis090)) {
      return;
    }
  }
  if(isWhitespace(f.emvis109.value)) {
     return;
  }
  if(isWhitespace(f.emvis080.value) ||
     isWhitespace(f.emvis090.value)) {
     f.emvis080.readOnly=false;
     f.emvis090.readOnly=false;
     SetCurrentDateTime(f.emvis080,f.emvis090);
     f.emvis080.readOnly=true;
     f.emvis090.readOnly=true;
  }
  if(!CheckDateTimeRange(f.arrvdate,f.arrvtime,
                         f.emvis080,f.emvis090)) {
    alert("Senior doctor date/time can't be prior" +
          " to the arrival date/time")
    f.emvis080.value="";
    f.emvis090.value="";
    return;
  }

  RemoteEmrUpdate(f.admissno,f.emvis080);
  RemoteEmrUpdate(f.admissno,f.emvis090);

  var serverURL   = "../cgi-bin/emrweb08.pbl?reportno=64" +
                    "&doctcode=" + f.emvis109.value.replace(/ /g,"+") +
                    "&doctdate=" + f.emvis080.value.replace(/ /g,"+") +
                    "&docttime=" + f.emvis090.value.replace(/ /g,"+") +
                    "&admissno=" + f.admissno.value.replace(/ /g,"+")

  if (IEBrowser) {
    var returnValue = RSExecute(serverURL);

    ReloadScreen();
  }
  else {
    var returnValue = RSExecuteFetch(serverURL);

    returnValue.then(
      function (returnValue) {
        returnValue = ParseFetchData(returnValue);  // parse fetch() result

        ReloadScreen();
      }
    );
  }
}
function UpdateOtherDoctorDateTimeNoEdward() {
  f = document.UpdateForm;
  if(trim(f.emvis079.value)==trim(f.emvis079.defaultValue) &&
     trim(f.emvis089.value)==trim(f.emvis089.defaultValue)) {
     return;
  }

  if(f.emvis079.value!=f.emvis079.defaultValue) {
    if(!checkDate(f.emvis079)) {
      return;
    }
  }
  if(f.emvis089.value!=f.emvis089.defaultValue) {
    if(!checkTime(f.emvis089)) {
      return;
    }
  }
  if(isWhitespace(f.emvis109.value)) {
     return;
  }
  if(isWhitespace(f.emvis079.value) ||
     isWhitespace(f.emvis089.value)) {
     f.emvis079.readOnly=false;
     f.emvis089.readOnly=false;
     SetCurrentDateTime(f.emvis079,f.emvis089);
     f.emvis079.readOnly=true;
     f.emvis089.readOnly=true;
  }
  if(!CheckDateTimeRange(f.arrvdate,f.arrvtime,
                         f.emvis079,f.emvis089)) {
    alert("Senior doctor date/time can't be prior" +
          " to the arrival date/time")
    f.emvis079.value="";
    f.emvis089.value="";
    return;
  }

  RemoteEmrUpdate(f.admissno,f.emvis079);
  RemoteEmrUpdate(f.admissno,f.emvis089);

  var serverURL   = "../cgi-bin/emrweb08.pbl?reportno=64" +
                    "&doctcode=" + f.emvis109.value.replace(/ /g,"+") +
                    "&doctdate=" + f.emvis079.value.replace(/ /g,"+") +
                    "&docttime=" + f.emvis089.value.replace(/ /g,"+") +
                    "&admissno=" + f.admissno.value.replace(/ /g,"+")

  if (IEBrowser) {
    var returnValue = RSExecute(serverURL);

    ReloadScreen();
  }
  else {
    var returnValue = RSExecuteFetch(serverURL);

    returnValue.then(
      function (returnValue) {
        returnValue = ParseFetchData(returnValue);  // parse fetch() result

        ReloadScreen();
      }
    );
  }
}
function ReloadScreen() {
  location.reload();
  if(top.TogglePanel) {
    parent.menu.location.reload();
  }
  else {
    if (top.menu.EmergencyFrame==undefined) {
      parent.menu.location.reload();
    } else {
      if (top.menu.EmergencyFrame.location=="about:blank") {
        parent.menu.location.reload(); }
      else {
        parent.menu.EmergencyFrame.location.reload(); }
    }
  }
}
function MandInitAssessor() {
  if(!isWhitespace(UpdateForm.emvis164.defaultValue)) {
    return;
  }
  if(!isWhitespace(document.UpdateForm.emvis164.value)) {
     document.UpdateForm.emvis165.className="BackDate Mandatory"
     document.UpdateForm.emvis165.readOnly=false;
     document.UpdateForm.emvis166.className="Time Mandatory";
     document.UpdateForm.emvis166.readOnly=false;
  } else {
     document.UpdateForm.emvis165.className="BackDate Readonly"
     document.UpdateForm.emvis165.value="";
     document.UpdateForm.emvis165.readOnly=true;
     document.UpdateForm.emvis166.className="Time Readonly";
     document.UpdateForm.emvis166.value="";
     document.UpdateForm.emvis166.readOnly=true;
  }
}
function PageLoadExtended(ev)
{
   PageLoad(ev);
   setFocus("btnUpdate");
   SetDischarged();
   if(document.HiddenFields.ShowOutstanding.value=="1") {
    var linkurl = "../cgi-bin/emrweb02.pbl?reportno=1&template=051" +
                  "&admissno=" + UpdateForm.admissno.value.replace(/ /g,"+")+
                  "&urnumber=" + UpdateForm.urnumber.value.replace(/ /g,"+")
    Left=(document.body.clientWidth-600)/2
    DFrameLink(linkurl,0,Left,600,300);
   }
  // this checks to see if it is being used outside the MAPVIEW
  if (top.location.pathname.match(/EmergencyMap/g)) {
    document.UpdateForm.mapvflag.value = 1;
  }
}

function setFocus(id)
{
  var  object = document.getElementById(id);

  if(object)
     object.focus();

}
function InitialAssessor() {
  if(document.UpdateForm.emvis164.readOnly==true) {
    alert("Initial Assessor is a readonly field.");
    return;
  }
  HCPSearchFrame(UpdateForm.emvis164,UpdateForm.n_emvis164,0);
}
function SaveInitialAssessor() {
  UpdateForm.emvis164.value=UpdateForm.emvis164.value.toUpperCase();
  if(trim(UpdateForm.emvis164.value)==trim(UpdateForm.emvis164.defaultValue) &&
     trim(UpdateForm.emvis165.value)==trim(UpdateForm.emvis165.defaultValue) &&
     trim(UpdateForm.emvis166.value)==trim(UpdateForm.emvis166.defaultValue)) {
     return;
  }
  if(UpdateForm.emvis164.value!=UpdateForm.emvis164.defaultValue) {
    ValidateHCP(18,0,UpdateForm.emvis164,UpdateForm.n_emvis164);
  }
  if(UpdateForm.emvis165.value!=UpdateForm.emvis165.defaultValue) {
    if(!checkDate(UpdateForm.emvis165)) {
      return;
    }
  }
  if(UpdateForm.emvis166.value!=UpdateForm.emvis166.defaultValue) {
    if(!checkTime(UpdateForm.emvis166)) {
      return;
    }
  }
  MandInitAssessor();
  if(isWhitespace(UpdateForm.emvis164.value)) {
     return;
  }
  if(isWhitespace(UpdateForm.emvis165.value) ||
     isWhitespace(UpdateForm.emvis166.value)) {
     SetCurrentDateTime(UpdateForm.emvis165,UpdateForm.emvis166);
  }
  if(!CheckDateTimeRange(UpdateForm.arrvdate,UpdateForm.arrvtime,
                         UpdateForm.emvis165,UpdateForm.emvis166)) {
    alert("Initial assessor date/time can't be prior" +
          " to the arrival date/time")
    UpdateForm.emvis165.value="";
    UpdateForm.emvis166.value="";
    return;
  }
  RemoteEmrValues(UpdateForm.admissno,HiddenFields.seendate,
                  HiddenFields.seentime);
  if(!isWhitespace(HiddenFields.seendate.value)) {
    if(!CheckDateTimeRange(UpdateForm.emvis165,UpdateForm.emvis166,
                           HiddenFields.seendate,HiddenFields.seentime)) {
      alert("Initial assessor date/time can't be after " +
            "the first seen by doctor date/time")
      UpdateForm.emvis165.value="";
      UpdateForm.emvis166.value="";
      return;
    }
  }
  RemoteEmrUpdate(UpdateForm.admissno,UpdateForm.emvis164);
  RemoteEmrUpdate(UpdateForm.admissno,UpdateForm.emvis165);
  RemoteEmrUpdate(UpdateForm.admissno,UpdateForm.emvis166);
//  RemoteEmrHistory(UpdateForm.admissno,"INTAS");

  ReloadScreen();
}
function UpdateInitialAssessorDateTime() {
  f = document.UpdateForm;
  if(trim(f.emvis165.value)==trim(f.emvis165.defaultValue) &&
     trim(f.emvis166.value)==trim(f.emvis166.defaultValue)) {
     return;
  }
  if(f.emvis165.value!=f.emvis165.defaultValue) {
    if(!checkDate(f.emvis165)) {
      return;
    }
  }
  if(f.emvis166.value!=f.emvis166.defaultValue) {
    if(!checkTime(f.emvis166)) {
      return;
    }
  }
  if(!CheckDateTimeRange(f.arrvdate,f.arrvtime,
                         f.emvis165,f.emvis166)) {
    alert("Initial assessor date/time can't be prior" +
          " to the arrival date/time")
    f.emvis165.value="";
    f.emvis166.value="";
    return;
  }
  RemoteEmrValues(f.admissno,HiddenFields.seendate,
                  HiddenFields.seentime);
  if(!isWhitespace(HiddenFields.seendate.value)) {
    if(!CheckDateTimeRange(f.emvis165,f.emvis166,
                           HiddenFields.seendate,HiddenFields.seentime)) {
      alert("Initial assessor date/time can't be after " +
            "the first seen by doctor date/time")
      f.emvis165.value="";
      f.emvis166.value="";
      return;
    }
  }

  RemoteEmrUpdate(f.admissno,f.emvis165);
  RemoteEmrUpdate(f.admissno,f.emvis166);

  ReloadScreen();
}
function SaveAlliedHealthHCP() {
  UpdateForm.emvis179.value=UpdateForm.emvis179.value.toUpperCase();
  if(trim(UpdateForm.emvis179.value)==trim(UpdateForm.emvis179.defaultValue)) {
     return;
  }
  if(UpdateForm.emvis179.value!=UpdateForm.emvis179.defaultValue) {
    ValidateHCP(18,0,UpdateForm.emvis179,UpdateForm.n_emvis179);
  }
  RemoteEmrUpdate(UpdateForm.admissno,UpdateForm.emvis179);

  ReloadScreen();
}
function SearchAHealthHCP() {
  HCPSearchFrame(UpdateForm.emvis179,UpdateForm.n_emvis179,0);
}

function UpdateDoctorDate(SeenDoctor,SeenDate,SeenTime) {
  if(!checkDate(SeenDate,SeenDate.title)) {
      return;
  }
  if(!checkTime(SeenTime,SeenTime.title)) {
      return;
  }
  user=document.PatientLinks.webuseid.value;
  if (isWhitespace(SeenDoctor.value)) {
    if (!isWhitespace(SeenDate.value)||!isWhitespace(SeenTime.value)) {
      alert("No doctor allocated first doctor seen date/time must be blank");
      SeenDate.value="";
      SeenTime.value="";
      return;
    }
  }

  if(!CheckDateTimeRange(UpdateForm.arrvdate,UpdateForm.arrvtime,
                         UpdateForm.emvis030,UpdateForm.emvis031)) {
    alert("First seen by doctor  date/time can't be prior" +
          " to the arrival date/time")
      SeenDate.value="";
      SeenTime.value="";
    return;
  }


  if (isWhitespace(SeenDate.value) || isWhitespace(SeenTime.value)) {
      alert("First doctor seen date/time are mandatory");
      return;
  }

  var serverURL   = "../cgi-bin/emrweb08.pbl?reportno=13" +
                    "&doctdate=" + SeenDate.value.replace(/ /g,"+") +
                    "&docttime=" + SeenTime.value.replace(/ /g,"+") +
                    "&webuseid=" + user.replace(/ /g,"+") +
                    "&admissno=" + UpdateForm.admissno.value.replace(/ /g,"+") +
                    "&updttype=UPDAT"

  if (IEBrowser) {
    var returnValue = RSExecute(serverURL);
  }
  else {
    var returnValue = RSExecuteFetch(serverURL);
  }
}
function SetTreatingDoc() {
  if(isWhitespace(UpdateForm.emvis007.defaultValue) &&
    !isWhitespace(UpdateForm.emvis007.value)) { 
    SetCookie("TreatingDoc",UpdateForm.admissno.value,20);
  }
}
function MandTreatingDoc() {
  if (isWhitespace(UpdateForm.emvis007.value)) {
    return;
  }
  mandatory=GetCookieData("TreatingDoc");
  if(trim(mandatory)!=trim(UpdateForm.admissno.value)) {
    return;
  }
  document.UpdateForm.emvis030.className="BackDate Mandatory"
  document.UpdateForm.emvis030.readOnly=false;
  document.UpdateForm.emvis031.className="Time Mandatory";
  document.UpdateForm.emvis031.readOnly=false;
  ExpireCookiePath('TreatingDoc');
}
//
function submitPrimaryDiag() {
  if (isWhitespace(document.UpdateForm.diagnosisSearch.value)) {
    UpdateFieldVCD(UpdateForm.admissno,
                   "          "+UpdateForm.emvcd003.value,
                   " ",
                   SaveDiagCookie);
  } else {
    if (!isWhitespace(document.UpdateForm.emvcd005.value)) {
      validateEMRDiagnosis(validateEMRDiagnosisRetFuncTrue);
    }
  }
}
function validateEMRDiagnosisRetFuncTrue() {
  UpdateFieldVCD(UpdateForm.admissno,
    UpdateForm.emvcd005.value.substring(0,10)+UpdateForm.emvcd003.value,
    UpdateForm.emvcd033.value,
    SaveDiagCookie);
}
function UpdateFieldVCD(Visit,ReturnCode,ReturnDesc) {
  ReturnFunction="" ;
  for (var i=3; i < UpdateFieldVCD.arguments.length; i++) {
    if (typeof(UpdateFieldVCD.arguments[i]) == 'function') {
      ReturnFunction=UpdateFieldVCD.arguments[i] }
    else {
      UpdateFieldVCD.arguments[i].value=""; }  }

  var serverURL  = "../cgi-bin/emrweb08.pbl?reportno=24" +
               "&admissno=" + Visit.value.replace(/ /g,"+") +
               "&valdcode=" + ReturnCode.replace(/ /g,"+") +
               "&valddesc=" + escape(ReturnDesc.replace(/ /g,"+")) +
               "&emvcd031=" + UpdateForm.emvcd031.value;

  if (IEBrowser) {
    var returnValue = RSExecute(serverURL);

    if (returnValue.status==0) {
      if (returnValue.return_value=="1") {
        alert("Only Free Format Description from Primary Diagnosis is defaulted to Bed Request.");
      }
    }
    else {
      ReturnCode.focus();
    }

    if (typeof(ReturnFunction) == 'function') { ReturnFunction() }
  }
  else {
    var returnValue = RSExecuteFetch(serverURL);

    returnValue.then(
      function (returnValue) {
        returnValue = ParseFetchData(returnValue);  // parse fetch() result

        if (returnValue.status==0) {
          if (returnValue.return_value=="1") {
            alert("Only Free Format Description from Primary Diagnosis is defaulted to Bed Request.");
          }
        }
        else {
          ReturnCode.focus();
        }

        if (typeof(ReturnFunction) == 'function') { ReturnFunction() }
      }
    );
  }
}
function SaveDiagCookie() {
  var diagCookieName = "diagnosisCookie-" + trim(UpdateForm.admissno.value);
  SetCookie(diagCookieName,document.UpdateForm.diagnosisSearch.value);
  submitAdditionalDiag();
}
function validateEMRDiagnosis(RetFuncTrue) {
  var serverURL="../cgi-bin/emrweb08.pbl?reportno=23" +
                "&emvcd001="+UpdateForm.emvcd001.value.replace(/ /g,"+") +
                "&emvcd002="+UpdateForm.emvcd002.value.replace(/ /g,"+") +
                "&emvcd003="+UpdateForm.emvcd003.value.replace(/ /g,"+") +
       "&emvcd005="+UpdateForm.emvcd005.value.substring(0,10).replace(/ /g,"+");

  if (IEBrowser) {
    var returnValue = RSExecute(serverURL);

    if (returnValue.status==0) {
      if (returnValue.return_value==1) {
        alert("Error: Diagnosis Record already exists.");
        return false;
      }
    }

    if (typeof(RetFuncTrue) == 'function') { RetFuncTrue() }
  }
  else {
    var returnValue = RSExecuteFetch(serverURL);

    returnValue.then(
      function (returnValue) {
        returnValue = ParseFetchData(returnValue);  // parse fetch() result

        if (returnValue.status==0) {
          if (returnValue.return_value==1) {
            alert("Error: Diagnosis Record already exists.");
            return false;
          }
        }

        if (typeof(RetFuncTrue) == 'function') { RetFuncTrue() }
      }
    );
  }
}
function ValDate(dateField,timeField) {
   if (!checkDate(dateField,dateField.title)) {
      return;
   }
   if (!isWhitespace(timeField.value)) {
     CheckFutureTime(UpdateForm,dateField.value,timeField);
   }
}
function ValTime(dateField,timeField) {
   if (!checkTime(timeField,timeField.title)) {
      return;
   }
   CheckFutureTime(UpdateForm,dateField.value,timeField);
}
function checkTrans() {
  var transferIndicator = 0;
  var emvis026 = document.getElementById("emvis026");
  var transferIndex = emvis026.selectedIndex;
  if(!emvis026) {
    return;
  }
  var transferIndicator =
      trim(emvis026.options[transferIndex].value.substr(14,2)); 
  if(transferIndicator != "4") {
    document.getElementById("TDestName").style.display = "none";
    document.getElementById("RTransName").style.display = "none";
    document.getElementById("ESourceName").style.display = "none";
    document.getElementById("TModeName").style.display = "none";
    document.getElementById("ABTName").style.display = "none";

    document.getElementById("TDestField").innerHTML=
    document.getElementById("BlankTDestField").innerHTML;

    document.getElementById("RTransField").innerHTML=
    document.getElementById("BlankRTransField").innerHTML;

    document.getElementById("ESourceField").innerHTML=
    document.getElementById("BlankESourceField").innerHTML;

    document.getElementById("TModeField").innerHTML=
    document.getElementById("BlankTModeField").innerHTML;

    document.getElementById("ABTField").innerHTML=
    document.getElementById("BlankABTField").innerHTML;
  } else {
    document.getElementById("TDestName").style.display = "";
    document.getElementById("RTransName").style.display = "";
    document.getElementById("ESourceName").style.display = "";
    document.getElementById("TModeName").style.display = "";
    document.getElementById("ABTName").style.display = "";

    document.getElementById("TDestField").innerHTML=
    document.getElementById("ShowTDestField").innerHTML;

    document.getElementById("RTransField").innerHTML=
    document.getElementById("ShowRTransField").innerHTML;

    document.getElementById("ESourceField").innerHTML=
    document.getElementById("ShowESourceField").innerHTML;

    document.getElementById("TModeField").innerHTML=
    document.getElementById("ShowTModeField").innerHTML;

    document.getElementById("ABTField").innerHTML=
    document.getElementById("ShowABTField").innerHTML
  }
}
function checkAmbBooking() {
  var transportInd = 0;
  var emvis049 = document.getElementById("emvis049");
  var emvis087 = document.getElementById("emvis087");
  var transportIndex = emvis049.selectedIndex;

  if(emvis049) {
    transportInd = trim(emvis049.options[transportIndex].value.substr(14,4));
  }

  if(transportInd == "3" || transportInd == "4" ||
     transportInd == "10" || transportInd == "11") {
    if(emvis087) {
      emvis087.className="Mandatory Time";
    }
  } else {
    if(emvis087) {
      emvis087.className="Time";
    }
  }
}
function submitAdditionalDiag() {
  if (isWhitespace(document.UpdateForm.a_diagnosisSearch.value)) {
    AUpdateFieldVCD(UpdateForm.admissno,
                    "          "+UpdateForm.a_emvcd003.value,
                    " ",
                    ASaveDiagCookie);
  } else {
    if (!isWhitespace(document.UpdateForm.a_emvcd005.value)) {
      AValidateEMRDiagnosis(AValidateEMRDiagnosisRetFuncTrue);
    }
  }
}
function AValidateEMRDiagnosisRetFuncTrue() {
  AUpdateFieldVCD(UpdateForm.admissno,
    UpdateForm.a_emvcd005.value.substring(0,10)+UpdateForm.a_emvcd003.value,
    UpdateForm.a_emvcd033.value,
    ASaveDiagCookie);
}
function ASaveDiagCookie() {
  var AdiagCookieName = "AdiagnosisCookie-" + trim(UpdateForm.admissno.value);
  SetCookie(AdiagCookieName,document.UpdateForm.a_diagnosisSearch.value);
  PressUpdateFinish();
}
function AValidateEMRDiagnosis(RetFuncTrue) {
  var serverURL="../cgi-bin/emrweb08.pbl?reportno=23" +
                "&emvcd001="+UpdateForm.a_emvcd001.value.replace(/ /g,"+") +
                "&emvcd002="+UpdateForm.a_emvcd002.value.replace(/ /g,"+") +
                "&emvcd003="+UpdateForm.a_emvcd003.value.replace(/ /g,"+") +
                "&emvcd005="+
                UpdateForm.a_emvcd005.value.substring(0,10).replace(/ /g,"+");

  if (IEBrowser) {
    var returnValue = RSExecute(serverURL);

    if (returnValue.status==0) {
      if (returnValue.return_value==1) {
        alert("Error: Diagnosis Record already exists.");
        return false;
      }
    }

    if (typeof(RetFuncTrue) == 'function') { RetFuncTrue() }
  }
  else {
    var returnValue = RSExecuteFetch(serverURL);

    returnValue.then(
      function (returnValue) {
        returnValue = ParseFetchData(returnValue);  // parse fetch() result

        if (returnValue.status==0) {
          if (returnValue.return_value==1) {
            alert("Error: Diagnosis Record already exists.");
            return false;
          }
        }

        if (typeof(RetFuncTrue) == 'function') { RetFuncTrue() }
      }
    );
  }
}
function AUpdateFieldVCD(Visit,ReturnCode,ReturnDesc) {
  ReturnFunction="" ;
  for (var i=3; i < AUpdateFieldVCD.arguments.length; i++) {
    if (typeof(AUpdateFieldVCD.arguments[i]) == 'function') {
      ReturnFunction=AUpdateFieldVCD.arguments[i] }
    else {
      AUpdateFieldVCD.arguments[i].value=""; }  }
  var serverURL  = "../cgi-bin/emrweb08.pbl?reportno=62" +
               "&admissno=" + Visit.value.replace(/ /g,"+") +
               "&valdcode=" + ReturnCode.replace(/ /g,"+") +
               "&valddesc=" + escape(ReturnDesc.replace(/ /g,"+")) +
               "&emvcd031=" + UpdateForm.emvcd031.value;

  if (IEBrowser) {
    var returnValue = RSExecute(serverURL);

    if (returnValue.status==0) {

    }
    else {
      ReturnCode.focus();
    }

    if (typeof(ReturnFunction) == 'function') { ReturnFunction() }
  }
  else {
    var returnValue = RSExecuteFetch(serverURL);

    returnValue.then(
      function (returnValue) {
        returnValue = ParseFetchData(returnValue);  // parse fetch() result

        if (returnValue.status==0) {

        }
        else {
          ReturnCode.focus();
        }

        if (typeof(ReturnFunction) == 'function') { ReturnFunction() }
      }
    );
  }
}
function MDepStat() {
  if(!isWhitespace(document.getElementById("emvis024").value) ||
     !isWhitespace(document.getElementById("emvis025").value)) {
    document.getElementById("emvis026").className="Mandatory";
  } else {
    document.getElementById("emvis026").className="";
  }
}
function MDDate() {
  if(!isWhitespace(document.getElementById("emvis026").value)) {
    document.getElementById("emvis024").className="Mandatory PastDate";
    document.getElementById("emvis025").className="Mandatory";
  } else {
    document.getElementById("emvis024").className="PastDate";
    document.getElementById("emvis025").className="";
  }
}
function chkIfDischarged() {
  if(document.getElementById("DischargeComplete").value!="1") {
     document.getElementById("emvis024").className="Readonly";
     document.getElementById("emvis024").readOnly=true;
     document.getElementById("emvis025").className="Readonly";
     document.getElementById("emvis025").readOnly=true;
     document.getElementById("emvis026").disabled=true;
  } else {
     setTimeout('MDepStat();',200);
     setTimeout('MDDate();',200);
  }
}
function DoDischarge() {
  var serverURL="../cgi-bin/emrweb08.pbl?reportno=31" +
                "&admissno="+UpdateForm.admissno.value.replace(/ /g,"+")

  if (IEBrowser) {
    var returnValue = RSExecute(serverURL);

    if (returnValue.status!=0) {
      return false;
    }

    DoDischargeComplete();
  }
  else {
    var returnValue = RSExecuteFetch(serverURL);

    returnValue.then(
      function (returnValue) {
        returnValue = ParseFetchData(returnValue);  // parse fetch() result

        if (returnValue.status!=0) {
          return false;
        }

        DoDischargeComplete();
      }
    );
  }
}
function DoDischargeComplete() {
  if (isWhitespace(document.HiddenFields.chkdot.value)) {
    i = document.UpdateForm.emvis026.selectedIndex
    ind = trim(document.UpdateForm.emvis026.options[i].value.substr(14,2));
    ind8 = trim(document.UpdateForm.emvis026.options[i].value.substr(10,1));

    if (ind!="6" && ind!="8" && ind!="10" && ind!="11" && ind!="9" &&
        ind!="T1" && ind!="31" && ind8!="N") {
      if (ind == "5" || ind == "1") {
        if (document.UpdateForm.chknur != undefined) {
          if (isWhitespace(document.UpdateForm.chknur.value)) {
            alert("Invalid discharge status, no attending doctor/nurse");
            return;
          }
        }
      }
      else {
        alert("Invalid discharge status, no attending doctor");
        return;
      }
    }
  }
//
  i = document.UpdateForm.emvis026.selectedIndex;
  ind = trim(document.UpdateForm.emvis026.options[i].value.substr(14,4));
  if (ind=="18" || ind=="2" || ind=="14" || ind=="15" || ind=="16" ||
      ind=="22" || ind=="25" || ind=="26") {
    document.UpdateForm.emvis133.value=1;        // Admitted to Hospital
  }
  else {
    document.UpdateForm.emvis133.value=0;
  }
//
  document.UpdateForm.formactn.value="D2";
  document.UpdateForm.updttype.value="DISCH";
  document.UpdateForm.updflag1.value=" ";        // Write discharge audit

  url = "emrweb02.pbl?reportno=1&template=4&urnumber=" +
        document.UpdateForm.urnumber.value.replace(/ /g,"+") +
        "&admissno=" + document.UpdateForm.admissno.value.replace(/ /g,"+");
        document.UpdateForm.redirect.value=url;
  setFormactn('DISCH');
}
function displaySpecialistField() {
  if (document.UpdateForm.emvis051.value.substr(3,1) == "S") {
    RDMSTitleDIV.innerHTML=RDMSTitleSPAN.innerHTML;
    RDMSFieldDIV.innerHTML=RDMSFieldSPAN.innerHTML;
    ValidateHCP(18,0,UpdateForm.emvis019,UpdateForm.n_emvis019);
  } else {
    RDMSTitleDIV.innerHTML="";
    RDMSFieldDIV.innerHTML="";
  }
}
function ShowAmbulanceDet() {
  f = document.UpdateForm;
  if (isWhitespace(f.ptcnnssi.value) || 
      f.ptcnnssi.value == "00000000000000000000") {
    spnAmbCareDateLbl.innerHTML = blanklabel.innerHTML;
    spnAmbCareDate.innerHTML = AmbCareDateBlank.innerHTML;
    spnAmbCareTimeLbl.innerHTML = blanklabel.innerHTML;
    spnAmbCareTime.innerHTML = AmbCareTimeBlank.innerHTML;
    spnAmbCaseNoLbl.innerHTML = blanklabel.innerHTML;
    spnAmbCaseNo.innerHTML = AmbCaseNoBlank.innerHTML;
    spnAmbCaseCreatedDateLbl.innerHTML = blanklabel.innerHTML;
    spnAmbCaseCreatedDate.innerHTML = blanklabel.innerHTML;
    spnAmbCaseCreatedTimeLbl.innerHTML = blanklabel.innerHTML;
    spnAmbCaseCreatedTime.innerHTML = blanklabel.innerHTML;
    f.emvis034.value = f.d_emvis034.value;
    f.emvis034.className = "";
    return;
  }
//
  ind1=f.emvimod1.value.substring(3,4);
  ind3=f.emvimod1.value.substring(5,6);
  spnAmbCareDateLbl.innerHTML = AmbCareDateLbl.innerHTML;
  spnAmbCareDate.innerHTML = AmbCareDate.innerHTML;
  spnAmbCareTimeLbl.innerHTML = AmbCareTimeLbl.innerHTML;
  spnAmbCareTime.innerHTML = AmbCareTime.innerHTML;
  
  if (ind1=="A") { 
    spnAmbCaseNoLbl.innerHTML = AmbCaseNoLbl.innerHTML;
    spnAmbCaseNo.innerHTML = AmbCaseNo.innerHTML;
    f.emvis034.className = "Mandatory";
  }
  else {
    spnAmbCaseNoLbl.innerHTML = blanklabel.innerHTML;
    spnAmbCaseNo.innerHTML = AmbCaseNoBlank.innerHTML;
    f.emvis034.className = "";
  }
  if (ind1=="A" && ind3=="C") {
    spnAmbCaseCreatedDateLbl.innerHTML = AmbCaseCreatedDateLbl.innerHTML;
    spnAmbCaseCreatedDate.innerHTML = AmbCaseCreatedDate.innerHTML;
    spnAmbCaseCreatedTimeLbl.innerHTML = AmbCaseCreatedTimeLbl.innerHTML;
    spnAmbCaseCreatedTime.innerHTML = AmbCaseCreatedTime.innerHTML;
    f.emvis079.className = "Mandatory";
    f.emvis089.className = "Mandatory";
  }
  else {
    spnAmbCaseCreatedDateLbl.innerHTML = blanklabel.innerHTML;
    spnAmbCaseCreatedDate.innerHTML = AmbCaseCreatedDateBlank.innerHTML;
    spnAmbCaseCreatedTimeLbl.innerHTML = blanklabel.innerHTML;
    spnAmbCaseCreatedTime.innerHTML = AmbCaseCreatedTimeBlank.innerHTML;
    f.emvis079.className = "";
    f.emvis089.className = "";
  }
}
function ShowAllHealthStatus() {
  f = document.UpdateForm;
  if (f.emviahst.value == "R") {
    document.getElementById('emvi180r').checked = true;
  }
  if (f.emviahst.value == "A") {
    document.getElementById('emvi180a').checked = true;
  }
  if (f.emviahst.value == "G") {
    document.getElementById('emvi180g').checked = true;
  }
  if (f.emviahst.value == "N") {
    document.getElementById('emvi180n').checked = true;
  }
}
function MandDrugIsolation() {
  f = document.UpdateForm;

  var code = f.emvidrug.value;
  for (var i=0; i < f.emvis182.length; i++) {
    if (code == f.emvis182.options[i].value){
      f.emvis182.selectedIndex=i;
    }
  }

  f.emvis182.className="";
  if (VariableNameExists('EMRClinicalScreenDrugAlcoholMand')) {
    if (EMRClinicalScreenDrugAlcoholMand == true) {
      f.emvis182.className="Mandatory";
    }
  }

  f.emvis067.className="";
  if (VariableNameExists('EMRTriageUDF27Mand')) {
    if (EMRTriageUDF27Mand == true) {
      f.emvis067.className="Mandatory";
    }
  }
}
function DelDocTreating() {
  f = document.UpdateForm;
  if (f.discstat.value != 1) { return; }

  DelDoc();
}
function DelNurseTreating() {
  f = document.UpdateForm;
  if (f.discstat.value != 1) { return; }

  DelNurse();
}
function AutoPostValidation() {
  if (!isWhitespace(document.UpdateForm.emvis007.value) &&
       isWhitespace(document.UpdateForm.emvis007.defaultValue) &&
       isWhitespace(document.UpdateForm.emvis030.value) &&
       isWhitespace(document.UpdateForm.emvis031.value)) {
     return;
  }
  validateCurrentLocation(AutoPostValidation2);
}
function AutoPostValidation2() {
  validateattendingdoctor(PressUpdate);
}

var valError = false;
function CheckPresComplTextLimit(TextArea) {
  valError = false;

  if (!LimitText(TextArea,6,300)) {
    valError = true;
    TextArea.onblur = null;  // clear to prevent infinite loop with alerts

    window.setTimeout(function () {
      TextArea.onblur = function() {
        SavePresComplCommt(TextArea);
      }
    },100);
  }
  else { valError = false; };
}
function SavePresComplCommt(TextArea) {
  if (!prcom001TopFrame()) {
    valError = true;
  }
  else { valError = false; }
}
function CheckMntNotesTextLimit(TextArea) {
  if (!LimitText(TextArea,99,16930)) {
    TextArea.onblur = null;  // clear to prevent infinite loop with alerts

    window.setTimeout(function () {
      TextArea.onblur = function() {
        SaveMntNotes(TextArea);
      }
    },100);
  }
}
function SaveMntNotes(TextArea) {
  if (valError) return;

  SaveMgtNteBLANK(TextArea);
}
function reEnable() {
  reEnableControl('btnUpdate');
}
function DisplayPresentComplaintAddInfo() {
  f = document.UpdateForm;
  if (f.emcprcmp.value == "1") {
    document.getElementById('PresentComplaintAddInfo').style.display = "";
  }
  else {
    document.getElementById('PresentComplaintAddInfo').style.display = "none";
  }
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoadExtended(event);MandTreatingDoc();
              MandOtherDoctor();MandInitAssessor();
              ExternalLinkButtons();HideMainButtons();checkTrans();
              chkIfDischarged();displaySpecialistField();
              setTimeout('disableReturnToMap();',2000);
              ShowAmbulanceDet();
              ShowAllHealthStatus();
              MandDrugIsolation();
              DisplayPresentComplaintAddInfo();"
      onunload="submitFormRedirect();">
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%EMRWEB02.01.003";
PatientVIS="%EMRWEB02.01.081";
PatientNAM="%EMRWEB02.01.002";
PatientSTA="%EMRWEB02.01.086.078";
PatientALT="%EMRWEB02.01.084";
PatientSEX="%EMRWEB02.01.019";
PatientDOB="%EMRWEB02.01.020";
PatientAGE="%EMRWEB02.01.021";
PatientLOC="%EMRWEB02.01.083";
PatientPRI="%EMRWEB02.01.086.066.1";
PatientUNT="%EMRWEB02.01.066.0";
PatientIND="%EMRWEB02.01.086.091";
GpCOD="%EMRWEB02.01.086.084.001";
GpNAM="%EMRWEB02.01.086.084.081";
GpPRAC="%EMRWEB02.01.086.085.001";
GpPRACCNT="%EMRWEB02.01.086.085.002";
GpPRACNAM="%EMRWEB02.01.086.085.005";
PatientARR="%EMRWEB02.01.101.0 %EMRWEB02.01.102";
PatientSEE="%EMRWEB02.01.199.008";
PatientTRI="%EMRWEB02.01.103.3";
PatientECLC="%EMRWEB02.01.484.1";
PatientCLH="%STANDARD.01.017.CL";
PatientEHFT="%EMRWEB02.01.485";
InsertEmergencyHeader()
</script>
<div id=PageBodySection style="overflow: auto;">
<form name=UpdateForm action="emrweb02.pbl" method=post style="margin:0"
 onsubmit='return validateMandatory(this);'>
<input type=hidden name=reportno value="01">
<input type=hidden name=resavail value="0">
<input type=hidden name=template value="004">
<input type=hidden name=admissno value="%EMRWEB02.01.081">
<input type=hidden name=urnumber value="%EMRWEB02.01.003">
<input type=hidden name=formactn value="C1">
<input type=hidden name=redirect value="emrweb02.pbl?reportno=1&template=4">
<input type=hidden name=updateky value="%EMRWEB02.01.404">
<input type=hidden name=updttype value="UPDAT">
<input type=hidden name=nextpage value=17>
<input type=hidden name=pmpxi067 value="%EMRWEB02.01.667.0">
<input type=hidden name=username>
<input type=hidden name=password>
<input type=hidden name=dummy1>
<input type=hidden name=dummy2>
<input type=hidden name=emvis004>
<input type=hidden name=emvis005>
<input type=hidden name=emvis133 value="%EMRWEB02.01.171.0">
<input type=hidden name=emvis135>
<input type=hidden name=emvis136>
<input type=hidden name=emvis137>
<input type=hidden name=emvis138>
<input type=hidden name=emvis147>
<input type=hidden name=emvis118 value="%EMRWEB02.01.003">
<input type=hidden name=savdesc1>
<input type=hidden name=savmanag>
<input type=hidden name=searchgn value="%EMRWEB02.01.009">
<input type=hidden name=searchsn value="%EMRWEB02.01.010">
<input type=hidden name=searchps id=searchps value="%EMRWEB02.01.019">
<input type=hidden name=searchpd value="%EMRWEB02.01.020">
<input type=hidden name=discstat value="%EMRWEB02.01.147">
<input type=hidden name=emcndoct value="%EMRWEB02.01.455">
<input type=hidden name=webuseid value="%STANDARD.01.008">
<input type="hidden" name="updflag1" value="1" />
<input type="hidden" name="current_precom" id="current_precom"
 value="%EMRWEB02.01.220.1" />
<input type=hidden name=arrvdate value="%EMRWEB02.01.101.0">
<input type=hidden name=arrvtime value="%EMRWEB02.01.102">
<input type=hidden name=srchgend id=srchgend>
<input type=hidden name=currdate value="%STANDARD.01.013">
<input type=hidden name=currtime value="">
<input type=hidden name=mapvflag value="0">
<input type=hidden name=ptcnnssi id=ptcnnssi
 value="%STANDARD.01.044.125.093.020">
<input type=hidden name=emvimode value="%EMRWEB02.01.113.1">
<input type=hidden name=emvimod1 value="%EMRWEB02.01.113.3">
<input type=hidden name=emviahst value="%EMRWEB02.01.199.005">
<input type=hidden name=emvidrug value="%EMRWEB02.01.199.007">
<input type=hidden name=sjogsumd value="1">
<input type=hidden name=svmgcmmt value="1">
<input type=hidden name=d_emvis034 value="%EMRWEB02.01.134">
<input type=hidden name=emcprcmp id=emcprcmp
 value="%STANDARD.01.025.122.051.1.1">
<input type=hidden name=d_emvis006 value="%EMRWEB02.01.106.1">

<table width=99.5% align=center border=0 cellspacing=0 cellpadding=0>
<tr>
  <td colspan=2 valign=top>
    <table width=100% align=center border=0 cellspacing=0 cellpadding=0>

      <tr valign=top>
        <td class=DataLabel width=24%>Presenting&nbsp;Complaint&nbsp;</td>
        <td width=30%>
          <input type=hidden name=emrviscat value="el">
          <input type="text" size=10 tabindex=7 name=test
           value="%EMRWEB02.01.220.0"
           class="NoAutoFocus"
           onblur="emvis060TopFrame();savePresentingComplaint();"
           onKeyUp='UpCase(this);getPresentCom(this,UpdateForm.emvis060,
                    UpdateForm.emrviscat);
                    SetDirty();'>
          <select name=emvis060 class=SelectBig onblur="emvis060TopFrame();"
           onchange="SetDirty();">
            <option value="%EMRWEB02.01.220.1">%EMRWEB02.01.220.0</option>
          </select>
        </td>
      </tr>

      <tr>
        <td class=DataLabel>Location</td>
        <td><input type=hidden name=name_emvis006 title="Location"
             value="%EMRWEB02.01.106.0">
          <select class=SelectMed name=emvis006 autocomplete="off"
            onchange='validateattendingdoctor(refreashTop);'/>
            <option value=" "></option>
            %EMRWEB02.01.106.2
          </select>
          <input type=text size=30 name=emvis149 title="Location Note"
           value="%EMRWEB02.01.136">
        </td>
      </tr>

    </table>
  </td>
  <td>
    <table width=100% align=center border=0 cellspacing=0 cellpadding=0>
      <tr>
        <td> 
          <textarea name=prcom001 id=prcom001 wrap=hard cols=50 rows=6
           class=AsciiOnly style="overflow-y:hidden"
           title="Presenting Complaint Comments" 
           onkeydown="CheckPresComplTextLimit(this);"
           onblur="SavePresComplCommt(this);">
          </textarea> 
        </td>
        <td rowspan=4 class=DataLabel valign=top>Management Comments<br>
          <textarea type=text name=vicmt002 id=vicmt002 wrap=hard
           rows=10 cols=60
           title="Management Comments"
           onkeydown="CheckMntNotesTextLimit(this);"
           onblur="SaveMntNotes(this);">%EMRWEB02.01.434.002</textarea>
        </td>
      </tr>
      <tr>
        <td valign=top id=PresentComplaintAddInfo>
          <textarea type=text name=vicmt023 id=vicmt023 wrap=hard tabindex=5
           cols=50 rows=6 class=AsciiOnly
           title="Presenting Complaint - Additional Information"
           onkeydown="CheckPresentCompAddInfoTextLimit(this);"
           onblur="SavePresComplAddInfoBLANK(this);">%EMRWEB02.01.955.023.0
          </textarea>
        </td>
      </tr>
    </table>
  </td>
</tr>

<tr><td class=DataLabel width=13%>Initial Assessor</td>
    <td class="nowrap" Width=16%>
        <input type=text name=emvis164 size=9 maxlength=10
         value="%EMRWEB02.01.285.1" title="HCP Code"
         onfocus="disableObject('btnUpdate');"
         onblur="SaveInitialAssessor();setTimeout(reEnable,2000);" >
        <input type=text name=n_emvis164 size=15 readonly title="HCP Name"
         value="%EMRWEB02.01.285.0" class=Readonly>
        <img src="../images/erase.gif" class=Icon 
         name=dinitass id=dinitass
         onclick='DelDocInitAssessor(UpdateForm.emvis164);'>
        <img src="../images/SearchIcon.gif" class=Icon
         onclick="InitialAssessor();">
    </td>
    <td>
        <input type="text" name=emvis165 size="9"
         class="BackDate Mandatory" title="Initial Assessor Date"
         onblur="UpdateInitialAssessorDateTime();"
         value="%EMRWEB02.01.286">
        <img notab src=../images/DateLookup.gif class=Icon
         onclick="DateLookupFrame(UpdateForm.emvis165);">
        <input type="text" name=emvis166 size="5"
         class='Time Mandatory' title="Initial Assessor Time"
         onblur="UpdateInitialAssessorDateTime();"
         value="%EMRWEB02.01.287">
        <img notab src=../images/DateTimeStamp.gif class=Icon 
         onclick="SetCurrentDateTime(UpdateForm.emvis165,UpdateForm.emvis166);">
        <img notab src=../images/TimeLookup.gif class=Icon
         onclick="TimeLookupFrame(UpdateForm.emvis166);">
    </td>
    <td rowspan=4 class=DataLabel></td>
</tr>

<tr><td class=DataLabel>Treating Doctor</td>
    <td class="nowrap"><input type=text size=9 maxlength=6 name=emvis007 
         title="Treating Doctor Code" value="%EMRWEB02.01.107.001"
         onfocus="disableObject('btnUpdate');"
         onblur="UpdDoctor();setTimeout(reEnable,2000);">
        <input type=text size=15 name=dummy3 title="Doctor Name"
         readonly class=Readonly value="%EMRWEB02.01.911.002">
        <img src="../images/erase.gif" class=Icon name=dtretdoc id=dtretdoc
         onclick="DelDocTreating();">
        <img src="../images/SearchIcon.gif" class=Icon
          onclick="SearchDoctor();">
    </td>
    <td>
        <input type="text" name=emvis030 size="9" readonly
         class="BackDate Readonly" title="First Doctor Seen Date"
         value="%EMRWEB02.01.130.0"
         onblur="UpdateDoctorDate(UpdateForm.emvis007,UpdateForm.emvis030,
                 UpdateForm.emvis031);">
        <img notab src=../images/DateLookup.gif class=Icon
         onclick="DateLookupFrame(UpdateForm.emvis030);">

    <input type="text" name=emvis031 size="5" value="%EMRWEB02.01.131"
     title="First Doctor Seen Time" class="Time Readonly" readonly
     onblur="UpdateDoctorDate(UpdateForm.emvis007,UpdateForm.emvis030,
                              UpdateForm.emvis031);">

    <img notab src=../images/DateTimeStamp.gif class=Icon
     onclick="SetCurrentDateTime(UpdateForm.emvis030,UpdateForm.emvis031);">
    <img notab src=../images/TimeLookup.gif class=Icon
     onclick="TimeLookupFrame(UpdateForm.emvis031);">
    <img src="../images/ChangeHospitalIcon.gif" class=Icon
     onclick="DoctorData();">
</td></tr>

<tr><td class=DataLabel>Senior Doctor</td>
    <td class="nowrap">
       <input type=text size=9 maxlength=6 name=emvis109
         title="Senior Doctor Code" value="%EMRWEB02.01.269.003"
         onfocus="disableObject('btnUpdate');"
         onblur="SaveOtherDoctor();setTimeout(reEnable,2000);">
        <input type=text size=15 name=n_emvis109 title="Senior Doctor Name"
         readonly class=Readonly value="%EMRWEB02.01.269.002">
        <img src="../images/erase.gif" class=Icon name=dsendoct id=dsendoct
         onclick='DelDocOther(UpdateForm.emvis109);'>
        <img src="../images/SearchIcon.gif" class=Icon
         onclick="SearchDoctorOth();">
    </td>
    <td><div id=divSeniorDocDateTime></div></td>
</tr>

<tr><td class=DataLabel> Treating Nurse </td>
    <td>
    <input type=hidden name=gnm>
    <input type=text size=9 name=emvis130 title="Nurse Code"
         value="%EMRWEB02.01.164.1" onfocus="disableObject('btnUpdate');" 
           onblur="UpdNur(UpdateForm.emvis130);setTimeout(reEnable,2000);"> 
    <input type=text size=15 name=dummy5 title="Nurse Name" readonly
     class=Readonly value="%EMRWEB02.01.164.0">
    <img src="../images/erase.gif" class=Icon name=dtretnur id=dtretnur
     onclick='DelNurseTreating();'>
    <img src="../images/SearchIcon.gif" class=Icon
     onclick="NurseSearchFrame(UpdateForm.emvis130,
                               UpdateForm.dummy5)">
    <img src="../images/ChangeHospitalIcon.gif" class=Icon
     onclick="NurseData();">
    </td></tr>
</table>

<table width=99.5% align=center border=0 cellspacing=0 cellpadding=0>
<tr><td class=DataLabel width=13%>Allied Health Status</td>
    <td width=22%>
    <input type=text name=emvis179 id=emvis179 size=9 maxlength=10
     title="Allied Health Hcp Code"
     value="%EMRWEB02.01.199.004.1" onfocus="disableObject('btnUpdate');"
     onblur="SaveAlliedHealthHCP();setTimeout(reEnable,2000);">
    <input type=text size=15 name=n_emvis179 id=n_emvis179
     title="Allied Health Hcp Name"
     class=Readonly readonly value="%EMRWEB02.01.199.004.0">
    <img src="../images/erase.gif" class=Icon name=dhealsts id=dhealsts
     onclick="DelDocAllHealthHCP(UpdateForm.emvis179);">
    <img src="../images/SearchIcon.gif" class=Icon
     onclick="SearchAHealthHCP();">
    </td>
    <td>
    <input type=radio name=emvis180 id=emvi180r value="R"> Red&nbsp;</input>
    <input type=radio name=emvis180 id=emvi180a value="A"> Amber&nbsp;</input>
    <input type=radio name=emvis180 id=emvi180g value="G"> Green&nbsp;</input>
    <input type=radio name=emvis180 id=emvi180n value="N"> N/A&nbsp;</input>
    </td>
    <td width=50%>
    </td>
</tr>

</table>

<table width=99.5% align=center border=0 cellspacing=0 cellpadding=0>
<tr><td class=DataLabel width=13%>Disposition Delay/Likely Discharge</td>
    <td class=DataField width=9%>
        <select name=emvis181 id=emvis181
         title="Disposition Delay/Likely Discharge"> 
        <option></option>
         %EMRWEB02.01.199.006.2
        </select>
    </td>
    <td class=DataLabel width=3%>&nbsp;</td>
    <td class=DataField width=10%>&nbsp;</td>
    <td class=DataLabel width=7%>Drug/Alcohol Related<td>
    <td class=DataField width=13%>
        <select name=emvis182 id=emvis182
         title="Drug/Alcohol Related">
         <option value=""></option>
         <option value="0">No</option>
         <option value="1">Yes</option>
         <option value="2">Unknown</option>
        </select>
    </td>
    <td width=10%>%STANDARD.01.017.es</td>
    <td class=DataField width=8%>
        <select name=emvis067 id=emvis067
         title="%STANDARD.01.017.es">
        <option></option>
         %EMRWEB02.01.227.2
        </select>
    </td>
    <td class=DataLabel width=3%>&nbsp;</td>
    <td class=DataField width=15%>&nbsp;</td>
    <td width=9%></td> 
</tr>
</table>

<table width=99.5% align=center border=0 cellspacing=0 cellpadding=0>
<tr>
  <td class=DataLabel width=13%><span id=spnAmbCareDateLbl></span><td>
  <td class=DataField width=9%><span id=spnAmbCareDate></span><td>
  <td class=DataLabel width=3%><span id=spnAmbCareTimeLbl></span><td>
  <td class=DataField width=10%><span id=spnAmbCareTime></span><td>
  <td class=DataLabel width=7%><span id=spnAmbCaseNoLbl></span><td>
  <td class=DataField width=13%><span id=spnAmbCaseNo></span><td>
  <td class=DataLabel width=10%><span id=spnAmbCaseCreatedDateLbl></span><td>
  <td class=DataField width=8%><span id=spnAmbCaseCreatedDate></span><td>
  <td class=DataLabel width=3%><span id=spnAmbCaseCreatedTimeLbl></span><td>
  <td class=DataField width=15%><span id=spnAmbCaseCreatedTime></span><td>
  <td width=9%><td>
</tr>

</table>

<table width=99.5% align=center border=0 cellspacing=0 cellpadding=0>
<tr><td colspan=3>
    <table width=100% align=center border=0 cellspacing=0 cellpadding=0>
    <tr><td width=13%><input type=button class="button" value="Diagnosis"
             onclick="DiagnosisLink();">
        </td>
        <td></td></tr>
    <tr><td>Primary Diagnosis Search</td>
        <td><input type=hidden name=emvcd001 value="%EMRWEB02.01.081">
        <input type=hidden name=emvcd002 value="005">
        <input type=hidden name=emvcd003 value="%EMRWEB02.01.197">
        <input type=hidden name=emvcd004 value="5">
        <input type=hidden name=emvcd006 value="   ">
        <input type=hidden name=emvcd031 value="1">
        <input type=text
         onKeyUp="getDiagnosis(this,UpdateForm.emvcd005,UpdateForm.emvcd033);"
         class=SelectBig name=diagnosisSearch>
        <select name=emvcd005 class=SelectHugE
       onchange="document.UpdateForm.emvcd033.value=trim(this.value.substring(9,80))+' ';">
        </select>
        </td></tr>
    <tr><td>Primary Diagnosis Free Format Desc</td>
        <td><input type=text name=emvcd033 maxlength=100 size=100>
        </td></tr>

    <tr><td>Additional Diagnosis Search</td>
        <td><input type=hidden name=a_emvcd001 value="%EMRWEB02.01.081">
        <input type=hidden name=a_emvcd002 value="005">
        <input type=hidden name=a_emvcd003 value="%EMRWEB02.01.199.003">
        <input type=hidden name=a_emvcd004 value="5">
        <input type=hidden name=a_emvcd006 value="   ">
        <input type=hidden name=a_emvcd031 value="1">
        <input type=text
         onKeyUp="getDiagnosis(this,UpdateForm.a_emvcd005,UpdateForm.a_emvcd033);"
         class=SelectBig name=a_diagnosisSearch id="a_diagnosisSearch">
        <select name=a_emvcd005 class=SelectHugE
       onchange="document.UpdateForm.a_emvcd033.value=trim(this.value.substring(9,80))+' ';">
        </select>
        </td></tr>
    <tr><td>Additional Diagnosis Free Format Desc</td>
        <td><input type=text name=a_emvcd033 maxlength=100 size=100>
        </td></tr>
    </table>
    </td></tr>
</table>

<table width=99.5% align=center border=0 cellspacing=0 cellpadding=0>
<tr><td>
    <table width=60% align=left border=0 cellspacing=0 cellpadding=0>
    <tr><td align=left colspan=7><br>
        <input type=button class="button" value="Add Consult"
             onclick="NewCrossCons();">
        </td></tr>
    </table>
    </td></tr>
</table>

<div id="Consults" style="overflow:auto;height:70px;width:99.5%">
<table width=100% align=left border=0 cellspacing=0 cellpadding=0>
<tr><td>
    <tr><td class="HeadingCell" width=5%>Cons</td>
        <td class="HeadingCell">Referring Senior Doctor</td>
        <td class="HeadingCell">Time</td>
        <td class="HeadingCell">Referred To Senior Doctor</td>
        <td class="HeadingCell">%STANDARD.01.017.AC</td>
        <td class="HeadingCell">%STANDARD.01.017.Ac</td>
        <td class="HeadingCell">Comments</td>
        </tr>
    %EMRWEB02.01.599.006
</table>
</div>

<table width=99.5% align=center border=0 cellspacing=0 cellpadding=0>
<tr><td colspan=8><br></td>
    </tr>
<tr><td class="DataLabel Bold">External Links</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td class="DataLabel Bold">Discharge Details</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    </tr>

<tr><td colspan=4 width=45%>
    <span id="EmrExternalLinkButton1" style="display: none">
    <input type=button class="bigbutton" value="" id="extlinkbutton1"
     onclick="fnExtButton1();">
    </span>
    <span id="EmrExternalLinkButton2" style="display: none">
    <input type=button class="bigbutton" value="" id="extlinkbutton2"
     onclick="fnExtButton2();">
    </span>
    <span id="EmrExternalLinkButton3" style="display: none">
    <input type=button class="bigbutton" value="" id="extlinkbutton3"
     onclick="fnExtButton3();">
    </span>
    <span id="EmrExternalLinkButton4" style="display: none">
    <input type=button class="bigbutton" value="" id="extlinkbutton4"
     onclick="fnExtButton4();">
    </span>
    <span id="EmrExternalLinkButton5" style="display: none">
    <input type=button class="bigbutton" value="" id="extlinkbutton5"
     onclick="fnExtButton5();">
    </span>
    </td>
    <td class=DataLabel>ED Ready to Discharge</td>
    <td><input type="text" title="ED Ready to Discharge Date"
         size="12" id="emvis071" name="emvis071" value="%EMRWEB02.01.231.0"/>
        <img notab src=../images/DateLookup.gif class=Icon
         onclick="DateLookupFrame(UpdateForm.emvis071);">
        <input type="text" title="ED Ready to Discharge Time"
         size="6" id="emvis081" name="emvis081" value="%EMRWEB02.01.241"/>
        <img notab src=../images/DateTimeStamp.gif class=Icon
         onclick="SetCurrentDateTime(UpdateForm.emvis071,UpdateForm.emvis081);">
        <img notab src=../images/TimeLookup.gif class=Icon
         onclick="TimeLookupFrame(UpdateForm.emvis081);"></td>
    <td class=DataLabel>Decision to Admit</td>
    <td><input type=text title="Decision to Admit Date"
         size=12 name=emvis158 id=emvis158 value="%EMRWEB02.01.279">
        <img notab src=../images/DateLookup.gif class=Icon
         onclick="DateLookupFrame(UpdateForm.emvis158);">
        <input type=text title="Decision to Admit Time"
         size=6 name=emvis159 id=emvis159 value="%EMRWEB02.01.280">
        <img notab src=../images/DateTimeStamp.gif class=Icon
         onclick="SetCurrentDateTime(UpdateForm.emvis158,UpdateForm.emvis159);">
        <img notab src=../images/TimeLookup.gif class=Icon
         onclick="TimeLookupFrame(UpdateForm.emvis159);"></td>
    </tr>

<tr><td class=DataLabel>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td class=DataLabel>Departure Date</td>
    <td><input type=text size=12 name="emvis024" id="emvis024"
         class="PastDate"  title="Departure Date"
         value="%EMRWEB02.01.124.0"
         onblur="ValDate(UpdateForm.emvis024,UpdateForm.emvis025);MDepStat();">
         <img notab src=../images/DateLookup.gif class="Icon"
         align=absmiddle onclick="DateLookupFrame(UpdateForm.emvis024);">
        <input type=text name="emvis025" id="emvis025"
         size=6 value="%EMRWEB02.01.125" title="Time"
         onblur="ValTime(UpdateForm.emvis024,UpdateForm.emvis025);MDepStat();">
        <img notab src=../images/DateTimeStamp.gif class="Icon"
         onclick="SetCurrentDateTime(UpdateForm.emvis024,UpdateForm.emvis025);">
        <img notab src=../images/TimeLookup.gif class="Icon"
         onclick="TimeLookupFrame(UpdateForm.emvis025);">
    </td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    </tr>

<tr><td class=DataLabel>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td class=DataLabel>Departure Status</td>
    <td><select name="emvis026" id="emvis026"
         onchange="checkTrans();MDDate();"
         title="Departure Status">
        <option value=""> </option>
        %EMRWEB02.01.126.2
        </select>
    </td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    </tr>

<tr><td class=DataLabel>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td class=DataLabel>Referred to on Departure</td>
    <td><select name="emvis051" id="emvis051"
         title="Referred to on Departure" onchange="displaySpecialistField();">
        <option></option>
        %EMRWEB02.01.211.2
        </select>
    </td>
    <td><div id=RDMSTitleDIV></div></td>
    <td><div id=RDMSFieldDIV></div></td>
    </tr>

<tr><td class=DataLabel>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td class=DataLabel id="TDestName">Transfer Destination</td>
    <td><div id="TDestField"></div></td>
    <td id="RTransName">Reason for Transer</td>
    <td><div id="RTransField"></div></td>
    </tr>

<tr><td class=DataLabel>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td class=DataLabel id="ESourceName">Escort Source</td>
    <td><div id="ESourceField"></div></td>
    <td id="TModeName">Transport Mode</td>
    <td><div id="TModeField"></div></td>
    </tr>

<tr><td class=DataLabel>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td id="ABTName">Ambulance Booking Time</td>
    <td><div id="ABTField"></div></td>
    </tr>
</table>


<table width=99.5% align=center border=0 cellspacing=0 cellpadding=0>
<tr><td align=center>
    <span id="EMRClinicalScreenButtonUpdate">
    <input type=button class="button" 
           id="stnUpdate"
           name="btnUpdate"
           value="Update" 
     onclick="tempDisable(this);AutoPostValidation();"/>
    </span>
    <span id="EMRClinicalScreenButtonClinical">
    <input type=button class="button" value="Clinical" 
     onclick="PatientLink('emrweb02.pbl',1,100);"> 
    </span>
    <span id="EMRClinicalScreenButtonWardBedRequest">
    <input type=button class="button" value="Ward/Bed Req."
     name=reqbuttn onclick="PatientLink('patweb10.pbl',8,001)">
    </span>
    <span id="EMRClinicalScreenButtonRegistration">
    <input type=button class="button" value="Registration" 
     onclick="checkurno();">
    </span>
    <span id="EMRClinicalScreenButtonInjuryData">
    <input type=button class="button" value="Injury Data" name=injbuttn
     onclick="SmallFrameEmr('71');"> 
    </span>
    <span id="EMRClinicalScreenButtonOutstanding">
    <input type=button class="button" value="Outstanding" 
     onclick="SmallFrameEmr('51');"> 
    </span>
    <span id="EMRClinicalScreenButtonDischarge">
    <input type=button class="button" value="Discharge" id="btnDischarge"
     onclick="tempDisable(this);checkUR(document.UpdateForm.discstat.value);"> 
    </span>
    <span id="EMRClinicalScreenButtonLabelsForms">
    <input type=button class="button" value="Labels & Forms" 
     onclick="SmallFrameEmr('5');"> 
    </span>
    <span id="EMRClinicalScreenButtonReturntoMap">
    <input type=button class=RedButton value="Return to Map" 
     onclick="ReturnToMap();" id=retntomp>
    </span>
    <span id="EMRClinicalScreenButtonJumpQueue">
    <input type=button class="button" value="Jump Queue" 
     onclick="updateNext();">
    </span>
    <span id="EMRClinicalScreenButtonMHPractitioner">
    <input type=button class="button" name="mhprabut"
     value="MH Practitioner" onclick="changeMHDocDateTime();">
    </span>
    <span id="EMRClinicalScreenButtonBilling" style="display: none">
    <input type=button class="button" value="Billing"
     onclick="ProcedureLink();">
    </span>
    </td></tr>
</table>
</form>
</div>

<span id="BlankTDestField" style="display:none;">
<input type=hidden name="emvis033" id="emvis033" value="">
</span>

<span id="ShowTDestField" style="display:none;">
  <input type="text" size="6" name="emvis033" id="emvis033"
   title="Transfer Destination" value="%EMRWEB02.01.133.1"
   onchange="validateCode(9,this,UpdateForm.name_emvis033n);" />&nbsp;
  <input type="text" size="20" name="name_emvis033n"
   id="name_emvis033n" readonly value="%EMRWEB02.01.133.0"/>&nbsp;
  <img src="../images/SearchIcon.gif" class="Icon"
   onclick="TransferSourceFrame(UpdateForm.emvis033,
                                UpdateForm.name_emvis033n);"/>
</span>

<span id="BlankRTransField" style="display:none;">
<input type=hidden name="emvis052" id="emvis052" value="">
</span>

<span id="ShowRTransField" style="display:none;">
  <select name="emvis052" id="emvis052" title="Reason for Transfer">
  <option></option>
   %EMRWEB02.01.212.2
  </select>
</span>

<span id="BlankESourceField" style="display:none;">
<input type=hidden name="emvis050" id="emvis050" value="">
</span>

<span id="ShowESourceField" style="display:none;">
  <select name="emvis050" id="emvis050" title="Escort Source">
  <option></option>
  %EMRWEB02.01.210.2
  </select>
</span>

<span id="BlankTModeField" style="display:none;">
<input type=hidden name="emvis049" id="emvis049" value="">
</span>

<span id="ShowTModeField" style="display:none;">
  <select class="SelectBig" name="emvis049" id="emvis049"
   onchange="checkAmbBooking();">
   <option></option>
   %EMRWEB02.01.209.2
   </select>
</span>

<span id="BlankABTField" style="display:none;">
<input type=hidden name="emvis087" id="emvis087" value="">
</span>

<span id="ShowABTField" style="display:none;">
  <input type="text" name=emvis087 id="emvis087" size="8"
   value="%EMRWEB02.01.247"
   title="Ambulance Booking Time" onblur="checkTime(this,this.title);">
  <img notab src=../images/DateTimeStamp.gif class="Icon"
   onclick="SetCurrentDateTime(null,UpdateForm.emvis087);">
  <img notab src=../images/TimeLookup.gif class="Icon"
   onclick="TimeLookupFrame(UpdateForm.emvis087);">
</span>

<span id=RDMSTitleSPAN style="display:none;">
Specialist
</span>

<span id=RDMSFieldSPAN style="display:none;">
  <input type=text name=emvis019 size=10 maxlength=8
   value="%EMRWEB02.01.119.  1" title="Specialist"
   onblur="ValidateHCP(18,0,emvis019,n_emvis019);">
  <input type=text name=n_emvis019 size=20 readonly title="Specialist Name "
   class=Readonly>
  <img src="../images/erase.gif" class="Icon"
   onclick="emvis019.value='';n_emvis019.value='';"/>
  <img src="../images/SearchIcon.gif" class=Icon
   onclick="HCPSearchFrame(UpdateForm.emvis019,UpdateForm.n_emvis019,0);">
</span>

<form name=PatientLinks method=get style="margin:0">
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=regexstm value=102>
<input type=hidden name=newstand value=1>
<input type=hidden name=webuseid value="%STANDARD.01.008">
<input type=hidden name=urnumber value="%EMRWEB02.01.003">
<input type=hidden name=admissno value="%EMRWEB02.01.081">
<input type=hidden name=MenuType value="11">
<input type=hidden name=checksub value="0">
<input type=hidden name=emvis147>
</form>
<form name=HiddenFields style="margin:0">
<input type=hidden name=InjuryIndicator value="%EMRWEB02.01.447">
<input type=hidden name=CheckUr value="%EMRWEB02.01.448">
<input type=hidden name=DoctorCode value="%EMRWEB02.01.107.001">
<input type=hidden name=NurseCode value="%EMRWEB02.01.164.1">
<input type=hidden name=Location value="%EMRWEB02.01.083">
<input type=hidden name=DischargeComplete id="DischargeComplete"
 value="%EMRWEB02.01.147">
<input type=hidden name=Pres01 value="%EMRWEB02.01.104">
<input type=hidden name=Pres02 value="%EMRWEB02.01.105">
<input type=hidden name=Pres03 value="%EMRWEB02.01.174">
<input type=hidden name=Pres04 value="%EMRWEB02.01.175">
<input type=hidden name=Pres05 value="%EMRWEB02.01.176">
<input type=hidden name=Pres06 value="%EMRWEB02.01.177">
<input type=hidden name=linkadmn value="%EMRWEB02.01.081">
<input type=hidden name=seendate value="%EMRWEB02.01.130.0">
<input type=hidden name=seentime value="%EMRWEB02.01.131">
<input type=hidden name=PrimaryDiagnosis value="%EMRWEB02.01.187">
<input type=hidden name=PrimaryDiagnCode value="%EMRWEB02.01.196">
<input type=hidden name=PrimaryDiagnFtxt value="%EMRWEB02.01.195">
<input type=hidden name=PrimaryDiagnKeyw value="%EMRWEB02.01.490">
<input type=hidden name=AdditionalDiagnosis value="%EMRWEB02.01.198">
<input type=hidden name=AdditionalDiagnCode value="%EMRWEB02.01.199.001">
<input type=hidden name=AdditionalDiagnFtxt value="%EMRWEB02.01.199.002">
<input type=hidden name=AdditionalDiagnKeyw value="%EMRWEB02.01.938">
<input type=hidden name=d_emvis026 id="d_emvis026" value="%EMRWEB02.01.126.1">
<input type=hidden name=chkdot value="%EMRWEB02.01.107.001">
<input type=hidden name=HospitalAdmission value="%EMRWEB02.01.148">
<input type=hidden name=ShowOutstanding value="%EMRWEB02.01.474">
</form>

<span id=AmbCareDateLbl style="display:none;">
Ambulance Transfer of Care Date
</span>
<span id=AmbCareDate style="display:none;">
  <input type=text name=emvis156 id=emvis156 size=11 maxlength=11
   title="Ambulance Transfer of Care Date"
   value="%EMRWEB02.01.277"
   onblur="checkDate(this,this.title)">
  <img notab src="../images/DateLookup.gif" class=Icon
   onclick="DateLookupFrame(UpdateForm.emvis156);">
</span>
<span id=AmbCareTimeLbl style="display:none;">
Time
</span>
<span id=AmbCareTime style="display:none;">
  <input type=text name=emvis157 id=emvis157 size=7 maxlength=8
   title="Ambulance Transfer of Care Time"
   value="%EMRWEB02.01.278"
   onblur="checkTime(this,this.title)">
  <img notab src="../images/DateTimeStamp.gif" class=Icon
   onclick="SetCurrentDateTime(UpdateForm.emvis156,UpdateForm.emvis157);">
  <img notab src="../images/TimeLookup.gif" class=Icon
   onclick="TimeLookupFrame(UpdateForm.emvis157);">
</span>
<span id=AmbCareDateBlank style="display:none;">
  <input type=hidden name=emvis156 value="">
</span>
<span id=AmbCareTimeBlank style="display:none;">
  <input type=hidden name=emvis157 value="">
</span>
<span id=AmbCaseNoLbl style="display:none;">
Amb Case No
</span>
<span id=AmbCaseNo style="display:none;">
  <input type=text name=emvis034 size=17 maxlength=15
   title="Amb Case No"
   value="%EMRWEB02.01.134">
</span>
<span id=AmbCaseNoBlank style="display:none;">
  <input type=hidden name=emvis034 value="">
</span>
<span id=AmbCaseCreatedDateLbl style="display:none;">
Date Amb Case Created
</span>
<span id=AmbCaseCreatedDate style="display:none;">
  <input type=text name=emvis079 id=emvis079 size=11 maxlength=11
   title="Date Amb Case Created"
   value="%EMRWEB02.01.239.0"
    onblur="checkDate(this,this.title)">
  <img notab src="../images/DateLookup.gif" class=Icon
   onclick="DateLookupFrame(UpdateForm.emvis079);">
</span>
<span id=AmbCaseCreatedTimeLbl style="display:none;">
Time
</span>
<span id=AmbCaseCreatedTime style="display:none;">
  <input type=text name=emvis089 id=emvis089 size=7 maxlength=8
   title="Time Amb Case Created"
   value="%EMRWEB02.01.249"
    onblur="checkTime(this,this.title)">
  <img notab src="../images/DateTimeStamp.gif" class=Icon
   onclick="SetCurrentDateTime(UpdateForm.emvis079,UpdateForm.emvis089);">
  <img notab src="../images/TimeLookup.gif" class=Icon
   onclick="TimeLookupFrame(UpdateForm.emvis089);">
</span>
<span id=AmbCaseCreatedDateBlank style="display:none;">
  <input type=hidden name=emvis079 id=emvis079 value="">
</span>
<span id=AmbCaseCreatedTimeBlank style="display:none;">
  <input type=hidden name=emvis089 id=emvis089 value="">
</span>
<span id=blanklabel style="display:none">&nbsp;</span>

<div id=divSeniorDocDateTimeEdward style="display:none;">
    <td>
        <input type="text" name=emvis080 size="9" readonly
         class="BackDate Readonly" title="Senior Doctor Date"
         onblur="UpdateOtherDoctorDateTimeEdward();"
         value="%EMRWEB02.01.240.0">
        <img notab src=../images/DateLookup.gif class=Icon
         onclick="DateLookupFrame(UpdateForm.emvis080);">
        <input type="text" name=emvis090 size="5"
         class='Time Readonly' title="Senior Doctor Time" readonly
         onblur="UpdateOtherDoctorDateTimeEdward();"
         value="%EMRWEB02.01.250">
        <img notab src=../images/DateTimeStamp.gif class=Icon
         onclick="SetCurrentDateTime(UpdateForm.emvis080,UpdateForm.emvis090);">
        <img notab src=../images/TimeLookup.gif class=Icon
         onclick="TimeLookupFrame(UpdateForm.emvis090);">
        <img src="../images/ChangeHospitalIcon.gif" class=Icon
         onclick="OtherDoctorData();">
    </td>
</div>
<div id=divSeniorDocDateTimeNoEdward style="display:none;">
    <td>
        <input type="text" name=emvis079 size="9" readonly
         class="BackDate Readonly" title="Senior Doctor Date"
         onblur="UpdateOtherDoctorDateTimeNoEdward();"
         value="%EMRWEB02.01.239.0">
        <img notab src=../images/DateLookup.gif class=Icon
         onclick="DateLookupFrame(UpdateForm.emvis079);">
        <input type="text" name=emvis089 size="5"
         class='Time Readonly' title="Senior Doctor Time" readonly
         onblur="UpdateOtherDoctorDateTimeNoEdward();"
         value="%EMRWEB02.01.249">
        <img notab src=../images/DateTimeStamp.gif class=Icon
         onclick="SetCurrentDateTime(UpdateForm.emvis079,UpdateForm.emvis089);">
        <img notab src=../images/TimeLookup.gif class=Icon
         onclick="TimeLookupFrame(UpdateForm.emvis089);">
        <img src="../images/ChangeHospitalIcon.gif" class=Icon
         onclick="OtherDoctorData();">
    </td>
</div>

<script type="text/javascript">
 f = document.UpdateForm;
 CTypeAdm="%EMRWEB02.01.252";
 if ( CTypeAdm == "Yes") {
   document.UpdateForm.emvis147.value=1; 
   document.PatientLinks.emvis147.value=1; }
 else { 
   document.UpdateForm.emvis147.value=0; 
   document.PatientLinks.emvis147.value=0; }
 ShowReg="%EMRWEB02.01.461";
 if(ShowReg=="1") {
   checkurno();
 }
 InjData="%EMRWEB02.01.188";
 if ( InjData =="1" ) {
    document.UpdateForm.injbuttn.className="RedButton";
 }
 if(!isWhitespace(document.UpdateForm.emvis007.value)) {
  document.UpdateForm.emvis007.className="Readonly";
  document.UpdateForm.emvis007.readOnly=true;
 }
 if(!isWhitespace(document.UpdateForm.emvis164.value)) {
  document.UpdateForm.emvis164.className="Readonly";
  document.UpdateForm.emvis164.readOnly=true;
 }
 if (isWhitespace(f.ptcnnssi.value) ||
     f.ptcnnssi.value == "00000000000000000000") {
   document.getElementById('divSeniorDocDateTime').innerHTML=
     document.getElementById('divSeniorDocDateTimeNoEdward').innerHTML;
 }
 else {
   document.getElementById('divSeniorDocDateTime').innerHTML=
     document.getElementById('divSeniorDocDateTimeEdward').innerHTML;
 }
 if(!isWhitespace(document.UpdateForm.emvis109.value)) {
  document.UpdateForm.emvis109.className="Readonly";
  document.UpdateForm.emvis109.readOnly=true;
 }
 if(!isWhitespace(document.UpdateForm.emvis179.value)) {
  document.UpdateForm.emvis179.className="Readonly";
  document.UpdateForm.emvis179.readOnly=true;
 }
 if(!isWhitespace("%EMRWEB02.01.271.1")) {
    document.UpdateForm.mhprabut.className="RedButton";
 }


  if(!isWhitespace(document.UpdateForm.diagnosisSearch.value)) {
    diagCookieName = "diagnosisCookie-" + trim(UpdateForm.admissno.value);
    SetCookie(diagCookieName,document.UpdateForm.diagnosisSearch.value);
  }

  if (!isWhitespace(document.HiddenFields.PrimaryDiagnosis.value)) {
    document.UpdateForm.diagnosisSearch.value =
      document.HiddenFields.PrimaryDiagnCode.value.substring(0,2);

    getDiagnosis(UpdateForm.diagnosisSearch,
                 UpdateForm.emvcd005,
                 UpdateForm.emvcd033,
                 SelectDiagList);
  }

  if (!isWhitespace(document.HiddenFields.AdditionalDiagnosis.value)) {
    document.UpdateForm.a_diagnosisSearch.value =
      document.HiddenFields.AdditionalDiagnCode.value.substring(0,2);

    getDiagnosis(UpdateForm.a_diagnosisSearch,
                 UpdateForm.a_emvcd005,
                 UpdateForm.a_emvcd033,
                 SelectDiagList_a);
  }

function disableReturnToMap() {
  if (top.TogglePanel==null) {
    if (top.menu.EmergencyFrame==undefined) {
      document.getElementById('retntomp').disabled=true;
    }
  }
}

function SelectDiagList() {
  for (var i=0; i < document.UpdateForm.emvcd005.length; i++) {
    if (document.UpdateForm.emvcd005.options[i].value.substring(0,10)==
        document.HiddenFields.PrimaryDiagnCode.value) {
      document.UpdateForm.emvcd005.selectedIndex=i;
    }
  }

  document.UpdateForm.emvcd033.value =
    document.HiddenFields.PrimaryDiagnFtxt.value;
}

function SelectDiagList_a() {
  for (var i=0; i < document.UpdateForm.a_emvcd005.length; i++) {
    if (document.UpdateForm.a_emvcd005.options[i].value.substring(0,10)==
        document.HiddenFields.AdditionalDiagnCode.value){
      document.UpdateForm.a_emvcd005.selectedIndex=i;
    }
  }

  document.UpdateForm.a_emvcd033.value =
    document.HiddenFields.AdditionalDiagnFtxt.value;
}
</script>

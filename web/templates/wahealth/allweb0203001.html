<meta name="TemplateVersion" content="V12.00.00">
<meta name="TemplateHome" content="wahealth">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script language="javascript" src="../js/allweb02.js"></script>
<script type="text/javascript" src="../js/OutpatientSelect.js"></script>
<script type="text/javascript" src="../js/OutpatientTypeClinic.js"></script>
<script type="text/javascript">
function AddReferral(theForm) {
  window.PageUpdateForm=theForm
  theForm.target="PopUpFrame1";
  if(theForm.offdutyb!=undefined){
    if(theForm.offdutyb.checked==true){
      alert("Error: Claim Type invalid for 'Off Duty' personnel.")
      return;
    }
  }

  if (!isWhitespace(document.UpdateForm.dispt001.value)) {
    var serverURL   = "../cgi-bin/comweb80.pbl?reportno=44" +
                    "&valdcode=" + UpdateForm.dispt001.value.replace(/ /g,"+") +
                    UpdateForm.alref019.value.replace(/ /g,"+");
    var returnValue = RSExecute(serverURL);
    if (returnValue.status!=0) {
      return;
    }
  }
  if(document.UpdateForm.d_pmsvx093.checked==true) {
    document.UpdateForm.pmsvx093.value="1";
  } else {
    document.UpdateForm.pmsvx093.value="0";
  }
  if (validateMandatory(theForm)) {
    if(document.UpdateForm.ptcnxcom.value == "1") {
       setRedirectXComAdd();
    }
    theForm.submit(); }
}
function valClaimCode() {
  validateCode(41,UpdateForm.urnumber,UpdateForm.claimc);
  for (var i =0 ; i < document.UpdateForm.alref035.length; i++) {
    if (document.UpdateForm.claimc.value==
        trim(document.UpdateForm.alref035.options[i].value.substr(0,3))){
          document.UpdateForm.alref035.selectedIndex=i;
    }
  }
  showFundingSource();
}
function SetSite() {
  p=UpdateForm
  var SetSite
  if(isWhitespace(p.alref119.value)) {
    SetSite=p.wbsesite.value;
  } else {
    SetSite=p.alref119.value;
  }
 for (var i =0 ; i < document.UpdateForm.alref119.length; i++) {
  if (document.UpdateForm.alref119.options[i].value==SetSite.substr(0,6)) {
       document.UpdateForm.alref119.selectedIndex=i } };
 SetList();
}
function SetList() {
  p=UpdateForm
  p.alref106.options.length=1;
  DeptClinicType(p.deptcode,p.alref119,p.alref106,p.defctype)
//
  SetList2();
}
function SetList2() {
  p=UpdateForm
  p.alref120.options.length=1;
  SetTypeClinic(p.alref120,p.deftclid.value,p.alref119.value,p.alref106.value);
}

</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);valClaimCode();SetSite();">
<span class=DFrameTitleBar>
<img border=0 align=right src="../images/ExitIcon.gif" onclick="DFrameExit();">
%ALLWEB02.03.125.0  Referral
</span>
<div id=PageBodySection style="overflow: auto;">
<form name=UpdateForm action="allweb02.pbl" method=post
 onsubmit='return validateMandatory(UpdateForm);' >
<input type=hidden name=reportno value="2">
<input type=hidden name=updatety value="A">
<input type=hidden name=nextpage value="5">
<input type=hidden name=redirect value="%ALLWEB02.03.001.allweb02.02.002">
<input type=hidden name=urnumber value="%ALLWEB02.03.003">
<input type=hidden name=admissno value="%ALLWEB02.03.081">
<input type=hidden name=MenuType value="%ALLWEB02.03.088">
<input type=hidden name=deptcode value="%ALLWEB02.03.125.1">
<input type=hidden name=uservari value="%ALLWEB02.03.113">
<input type=hidden name=override value="0">
<input type=hidden name=usermemr value="">
<input type=hidden name=alref088 value=" ">
<input type=hidden name=alref089 value=" ">
<input type=hidden name=dummy>
<input type="hidden" name="mvmedrec">
<input type="hidden" name="claimc">
<input type=hidden name=ptcnueoc value="%ALLWEB02.03.203">
<input type=hidden name=sacsvisn value="%ALLWEB02.03.207">
<input type=hidden name=wbsesite value="%STANDARD.01.023">
<input type=hidden name=defctype value="">
<input type=hidden name=deftclid value="">
<input type="hidden" name=ptcnxcom value="%STANDARD.01.025.116.222.0.1">
<input type=hidden name=override value="2">
<input type=hidden name="eidexist" value="1">
<input type=hidden name=ptcnhdps id=ptcnhdps 
       value="%STANDARD.01.025.080.250.1.1">

<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel>Department Code</td>
    <td><input name=allrf001 type=text value="%ALLWEB02.03.125.0" readonly
	  class=Readonly></td>
    <td class=DataLabel>Entered by</td>
    <td><input	type=text value="%ALLWEB02.03.168" readonly 
	  class=Readonly></td></tr>

<tr><td class=DataLabel>Hospital</td>
    <td><select name=alref107 title="Hospital"
         class=Mandatory>
        <option></option>
         %ALLWEB02.03.170.2
        </select>
    </td>
    <td class=DataLabel>Referral Date</td>
    <td class=DataField>
    <input type=text name=alref019 size=12 value="%STANDARD.01.015"
     onblur="checkDate(this,'Date')"
     class= "Mandatory PastDate" title="Referral Date">
    <img src=../images/DateTimeStamp.gif class=Icon date=UpdateForm.alref019
     time=null>
    <img src=../images/DateLookup.gif class=Icon date=UpdateForm.alref019>
    </td>
    </tr>

<tr><td class=DataLabel>Preferred Site</td>
    <td><select name=alref119 title="Preferred Site" class="Mandatory"
         onchange="SetList();">
         <option></option>
         %ALLWEB02.03.182.2
         </select>
    </td>
    <td class=DataLabel>Referred By</td>
    <td><input type=hidden name=alref022
         value="%ALLWEB02.03.122.1">
        <input type=text name=d_alref022 readonly title="Referred By"
         value="%ALLWEB02.03.122.0">
        <img src="../images/SearchIcon.gif" class=Icon
         onclick="HCPSearchFrameExpanded(UpdateForm.alref022,
                  UpdateForm.d_alref022,UpdateForm.genpprov,
                  UpdateForm.alref023,UpdateForm.d_alref023,
                  UpdateForm.alref024);">
        <img src="../images/erase.gif" class=Icon
        onclick="clrFields(UpdateForm.alref022,UpdateForm.d_alref022);"></td>
    </tr>

<tr><td class=DataLabel>Referral Priority</td>
    <td><select class="Mandatory selectBig" name=alref027
         title="Referral Priority">
        <option></option>
        %ALLWEB02.03.127.2
        </select></td>
    <td class=DataLabel>Referred by Practice</td>
    <td><input type=hidden name=alref023
        value="%ALLWEB02.03.123.0">
        <input type=text readonly name=d_alref023
         value="%ALLWEB02.03.123.1">
        <img src="../images/SearchIcon.gif" class=Icon
         onclick="GPHCGSearchFrame(UpdateForm.alref022,
                  UpdateForm.d_alref022,UpdateForm.genpprov,
                  UpdateForm.alref023,UpdateForm.d_alref023,
                  UpdateForm.alref024);">
        <img src="../images/erase.gif" class=Icon 
         onclick="clrFields(UpdateForm.alref023,UpdateForm.d_alref023,
                  UpdateForm.alref024,UpdateForm.genpprov);">
        <input type=hidden name=alref024
         value="%ALLWEB02.03.124">
        <input type=hidden name=genpprov
         value="">
        </td>
<tr>

<tr><td class=DataLabel>Source of Referral</td>
    <td><select Title="Source of Referral" name=alref034
         class="Mandatory selectBig">
        <option></option>
         %ALLWEB02.03.134.2
        </select></td>
    <td class=DataLabel>Referred by Other</td>
    <td><input type=text size=55 maxlength=50 value="" name=aleid004
         title="Referred by Other"></td>
</tr>

<tr><td class=DataLabel>Responsible HCP</td>
    <td><input type=text name=alref038 size=10 maxlength=10
         value="%ALLWEB02.03.138.1" title="Responsible HCP"
           onblur="if (checkAlphanumDesc(event,this) != false) {
                     ValidateHCP(18,13,UpdateForm.alref038,
                     UpdateForm.n_alref038);
                   }">
        <input type=text name=n_alref038 size=35 readonly title="HCP Name"
         value="%ALLWEB02.03.138.0" class=Readonly>
        <img src="../images/SearchIcon.gif" class=Icon
         onclick="HCPSearchFrame(UpdateForm.alref038,UpdateForm.n_alref038,4);">
    </td>
    <td class=DataLabel style="vertical-align:top">Referrer Contact</td>
    <td class=DataLabel>
      <textarea rows=2 cols=60 name=aleid005 title="Referrer Contact"
        style="font-size:8pt;font-family:Arial;overflow:hidden"
        onkeyup="LimitText(this,1,100);" >
      </textarea>
    </td>
</tr>

<tr><td class=DataLabel>%STANDARD.01.017.CL</td>
    <td><table cellspacing=0 cellpadding=0>
        <tr><td>
        <select title="%STANDARD.01.017.CL" name=alref035
         class="Mandatory SelectBig" onchange="showFundingSource();">
        <option></option>
         %ALLWEB02.03.135.9.1.10.2.X
        </select>
        </td>
        <td><div id=FundingHeading></div></td>
        <td><div id=FundingId></div></td>
        </table>
    </td>
    <td class=DataLabel>Validity Period</td>
    <td><select name=alref124 title="Validity Period"
         class=Mandatory>
        <option></option>
         %ALLWEB02.03.186.2
        </select></td>
</tr>

<tr><td class=DataLabel>Reason for Referral</td>
    <td><select class="Mandatory selectBig" name=alref028
        Title="Reason for Referral" maxlength=45>
        <option></option>
         %ALLWEB02.03.128.2
        </select></td>
    <td class=DataLabel>Referral Created Date</td>
    <td><input type=text name=alref039 size=12 value="%STANDARD.01.015"
         class="Mandatory Date"
         onblur="WAReceivedDate(this,UpdateForm.alref000);"
         title="Referral Received Date">
        <img src=../images/DateTimeStamp.gif class=Icon alt="Current"
         date=UpdateForm.alref039 time=null>
        <img src=../images/DateLookup.gif class=Icon alt="Show Calendar"
         date=UpdateForm.alref039></td>
</tr>

<tr><td class=DataLabel>Presenting Complaint</td>
    <td><input type=text size=50 maxlength=50 value="%ALLWEB02.03.181"
         name=alref118 title="Presenting Complaint"></td>
    <td class=DataLabel>Referral Entered Date</td>
    <td><input type=text name=alref000 title="Referral Entered Date"
         value="%STANDARD.01.015" readonly class="Readonly Date"></td>
</tr>

<tr><td class=DataLabel>Diagnosis 1</td>
    <td><select maxlength=45 name=alref031 class=SelectBig
         title="Diagnosis 1" >
	<option></option>
	%ALLWEB02.03.131.2
	</select></td>
    <td class=DataLabel>Link to Visit</td>
    <td><input type=text size=10 maxlength=8 class=DataField
         Title="Link to Visit" name=alref005 value="%ALLWEB02.03.105"
          onblur="justifyRight(this);
                ValidateVisit(UpdateForm.alref005,UpdateForm.urnumber,
                UpdateForm.dummy);">
        <img src="../images/SearchIcon.gif" class=Icon
         onclick="VisitSearchFrame(UpdateForm.urnumber,UpdateForm.alref005);" >
    </td>
</tr>

<tr><td class=DataLabel>Diagnosis 2</td>
    <td><select maxlength=45 name=alref032 class=SelectBig
         title="Diagnosis 2" >
	<option></option>
	%ALLWEB02.03.132.2
	</select></td>
    <td class=DataLabel>Event Program</td>
    <td><select class="SelectBig" name=alref145 title="Event Program">
        <option></option>
         %ALLWEB02.03.199.016.2
        </select></td>
</tr>

<tr><td class=DataLabel>Diagnosis 3</td>
    <td><select maxlength=45 name=alref033 class=SelectBig
         title="Diagnosis 3" >
	<option></option>
	%ALLWEB02.03.133.2
	</select></td>
    <td class=DataLabel>Clinic Type</td>
    <td><select name=alref106 class="Mandatory selectBig" title="Clinic Type"
         onchange="SetList2();">
        <option></option>
       </select></td>
</tr>

<tr><td class=DataLabel>Comments 1</td>
    <td><input type=text size=65 maxlength=60 name=alref088></td> 
    <td class=DataLabel>Clinic Id</td>
    <td><select name=alref120 title="Clinic ID" class="SelectBig">
        <option></option>
        </select></td>
</tr>

<tr><td class=DataLabel>Comments 2</td>
    <td><input type=text size=65 maxlength=60 name=alref089></td>
    <td class=DataLabel>Preferred Date</td>
    <td><input type=text name=alref090 size=12 value=""
         class="Date" title="Preferred Date">
        <img src=../images/DateTimeStamp.gif class=Icon alt="Current"
         date=UpdateForm.alref090 time=null>
        <img src=../images/DateLookup.gif class=Icon alt="Show Calendar"
         date=UpdateForm.alref090></td>
</tr>

<tr><td class=DataLabel>&nbsp;</td>
    <td>&nbsp;</td>
    <td>Disaster Code</td>
    <td><select name=dispt001 tabindex=300 title="Disaster Code"
         onchange="displayDisasterID();">
         <option></option>
          %ALLWEB02.03.213
        </select></td>
</tr>


<tr><td class=DataLabel>Interpreter Required</td>
    <td><input type="hidden" name="pmsvx093" value="">
        <input type="checkbox" name="d_pmsvx093" value="1">
        &nbsp;
        <span class="Red">%ALLWEB02.03.086.002.0</span>
    </td>
    <td class=DataLabel><div id=disasteridnumbertitleDIV></div></td>
    <td><div id=disasteridnumberDIV></div></td>
</tr>

<tr><td class=DataLabel
     colspan=2>Print Referral Letter to Patient&nbsp;&nbsp;&nbsp;
     <input type=checkbox name=prtnewpt
      title="New Referral to pat" value="1">
      </td>
      <td class=DataLabel>Printer </td>
      <td><select name=prtpsl01 class=SelectBig>
      %STANDARD.01.001.ALLNEWPT.01
      </select></td></tr>

<tr><td class=DataLabel colspan=2>Print Referral Letter to Referrer
      <input type=checkbox name=prtnewrf
       title="New Referral to pat" value="1">
      </td>
      <td class=DataLabel>Printer </td>
      <td><select name=prtpsl02 class=SelectBig>
      %STANDARD.01.001.ALLNEWRF.01
      </select></td></tr>

<tr><td class=DataLabel colspan=2>Referral Labels
    <input type=checkbox value="1" name=prtreflb width=30%
        onclick="SetPrinter(UpdateForm.prtpno07,UpdateForm.prtpsl07);">
    Copies
    <select name=prtpno07 width=20%>
        %STANDARD.01.027.2.1
    </select></td>
    <td class=DataLabel>Printer</td>
    <td><select class="SelectBig" name=prtpsl07 title="Printer" width=15%>
        <option></option>
        %STANDARD.01.001.LABELALL.01
        </select></td></tr>

<tr><td colspan=4 align=center><br>
    <input type=button name=formactn value="Add" class="button"
    id="all02sub" onclick="tempDisable(this);AddReferral(UpdateForm);">
    <input type=button Value="Cancel" class="button" 
     onclick="DFrameCloseRefresh();">
    </td></tr>

</table>
</form>
</div>

<span id=offdutyhd style="display:none">
&nbsp;Off Duty&nbsp;
</span>

<span id=offdutyid style="display:none">
<input type="checkbox" name="offdutyb" value="0">
</span>

<span id=blanklabel style="display:none">
<input type=hidden name=pmsvx141 value=" ">
</span>

<span id=fundinghd style="display:none">
&nbsp;Funding Source&nbsp;
</span>

<span id=fundingid style="display:none">
<select name=pmsvx141 title="%STANDARD.01.017.cx">
<option> </option>
%ALLWEB02.03.398.053.4
</select>
</span>

<span id=disasteridnumbertitleSPAN style="display:none">
Disaster Identification #
</span>

<span id=disasteridnumberSPAN style="display:none">
<input type="text" name=dispt002 size=20 maxlength=19
   tabindex=19 title="Disaster Identification Number">
</span>

<script type="text/javascript">
 DefaultHosp="%STANDARD.01.032";
 for (var i =0 ; i < document.UpdateForm.alref107.length; i++) {
  if (document.UpdateForm.alref107.options[i].value==DefaultHosp.substr(0,3)) {
       document.UpdateForm.alref107.selectedIndex=i } };

function displayDisasterID() {
 p=document.UpdateForm
  if (!isWhitespace(p.dispt001.value)) {
    disasteridnumbertitleDIV.innerHTML=disasteridnumbertitleSPAN.innerHTML;
    disasteridnumberDIV.innerHTML=disasteridnumberSPAN.innerHTML;
  } else {
    disasteridnumbertitleDIV.innerHTML="";
    disasteridnumberDIV.innerHTML="";
  }

  if (!isWhitespace(disasteridnumberDIV.innerHTML)) {
    var serverURL   = "../cgi-bin/patweb80.pbl?reportno=98" +
                    "&valdcode=" + UpdateForm.urnumber.value.replace(/ /g,"+") +
                    UpdateForm.dispt001.value.replace(/ /g,"+");
    var returnValue = RSExecute(serverURL);
    if (returnValue.status==0) {
      ReturnValue=returnValue.return_value.split("|");
      if (!isWhitespace(ReturnValue[0])) {
        p.dispt002.value=ReturnValue;
        p.dispt002.className="Readonly";
        p.dispt002.readOnly=true;
      }
    }
  }
}
 PMIInterpreter="%ALLWEB02.03.086.001.0";
 if (PMIInterpreter != "1") {
    UpdateForm.d_pmsvx093.disabled=true;
 } else{
    UpdateForm.d_pmsvx093.checked = true;
 }

 var codeList = document.UpdateForm.alref035.options;
 for (var i = 0; i < codeList.length; i++) {
   if (isWhitespace(codeList[i].value)) continue;
   var codeSingle = codeList[i].value.substr(3, 5);
   if (codeSingle.match(/M/g) != null) {
     document.UpdateForm.alref035.options[i].remove(i);
     i--;
   }
 }
</script>

Content-Type: text/html
Cache-Control: no-cache

<!DOCTYPE HTML>
<head>
<!--"TemplateVersion"  : "V12.00.01"
    "TemplateHome"     : "mobile"-->
<title>Ward Patient List</title>
<script type="text/javascript" src="../html/iphone/iphone.js"> </script>
<link rel="stylesheet" href="../html/iphone/iphone.css" type="text/css">
<script type="text/javascript">
function PatientLink(urnumber,admissno) {
  mScreen=top.document.getElementById("mainScreen")
  mScreen.style.display = "none";
  pFrame=top.document.getElementById("patientFrame")
  pScreen=top.document.getElementById("patientScreen")
  pScreen.style.position = "absolute";
  pScreen.style.top = "0px";
  pScreen.style.left = "0px";
  pScreen.style.width = "100%";
  pScreen.style.height = "800px";
  pFrame.src="LoadingPage.html";
  pScreen.style.display = "";
  pFrame.src = "../../cgi-bin/patweb98.pbl?reportno=1&template=081"+
                                "&urnumber="+urnumber.replace(/ /g,"+") +
                                "&admissno="+admissno.replace(/ /g,"+")
}
//------------------------------------------------------------
// Table - Current Admission by Ward
//------------------------------------------------------------
function init() {
 ListLocation=document.getElementById("WidgetTable1")
 t = new Table("patient-list","patient-item");
 t.addColumn("Patient Image","PatientImage",0,0,"","","","")
 t.addColumn("Patient","PatientBlock",3,3,"30","","","")
 t.addColumn("","CenterSubscript",9,9,"","","","")
 t.addColumn("","LeftSubscript",4,4,"","","","")
 t.addColumn("","RightSubscript",8,8,"","","","")
 t.addColumn("","CloseBlock",3,3,"","","","")
 AddTableRows();
 TableOutput(0,1);
}
function AddTableRows() {
  elTable=document.getElementById("WardList");
  elRows=elTable.getElementsByTagName("TR");
  var checkBed=true;
  var leaveFlag=false;
  if (elRows[0].innerHTML.match(/>Bed<\/td>/i)) checkBed=false;
  for (i=0;i<elRows.length;i++) {
    var elCols=elRows[i].getElementsByTagName("TD")
    var urnumber=null;
    var admissno="";
    var gender="";
    var indicators="";
    var PatientName="";
    var WardBed="";
    var AdmDate="";
    var DisDate="";
    var Doctor="";
    var Unit="";
    var closedFlag=false;
    for (j = 0; j < elCols.length;j++) {
      if( elCols[j].innerHTML.match(/Patients On Leave/i) ){ 
         leaveFlag = true;
      }
      if( elCols[j].innerHTML.match(/\*\* Closed \*\*/i) ){ 
         closedFlag=true;
      }

      if (elCols[j].className!="HeadingCell") {
        ColNo = j;
        if (checkBed) ColNo=ColNo+1;
        switch (ColNo) {
          case 0:
 
            if(
               elCols[j].innerHTML.match(/UpdateCondition/i)||
               elCols[j].innerHTML.match(/PatientAlerts/i)) {
               j++;
               break;
            }

            if( leaveFlag ) {
              WardBed = "Onleave (" + elCols[j].innerHTML + ")";
            }else {
              WardBed = elCols[j].innerHTML;
            }

            break; 
          case 1: 
            if(
               elCols[j].innerHTML.match(/UpdateCondition/i)||
               elCols[j].innerHTML.match(/PatientAlerts/i)) {
               j++;
               break;
            }

            if( elCols[j].innerHTML.match(/Empty/i) || 
                elCols[j].innerHTML.match(/On Leave/i) ) { 

            }else {

              gender=elCols[j].innerHTML;
              gender=gender.replace(/.*\(/,"").replace(/\)/,"");
              if (gender.split(",")[0]=="M") gender="Male";
              if (gender.split(",")[0]=="F") gender="Female";
              if (gender.split(",")[1]=="M") gender="Male";
              if (gender.split(",")[1]=="F") gender="Female";
              if (gender.split(",")[2]=="M") gender="Male";
              if (gender.split(",")[2]=="F") gender="Female";
              PatientName=elCols[j].innerHTML;
              PatientName=PatientName.replace(/.*PatientFolder/i,"<span class=PatientFolder");
              //PatientName=PatientName.replace(/.gif.*\<b\>/i,"></span><b>");
              PatientName=PatientName.replace(/\.gif[^<]*<b>/i,"></span><b>");
              NameSort=elCols[j].innerHTML.replace(/.*\<b\>/i,"").replace(/<.b>/i,"");
              urnumber=elCols[j].innerHTML.replace(/.*urnumber=/,"")
              urnumber=urnumber.replace(/.....admissno.*/,"").replace(/\+/g," ");
              if(urnumber.replace(/\s/g,"").length == 0 ) {
                urnumber = null;
              }
              admissno=elCols[j].innerHTML.replace(/.*admissno=/,"")
              admissno=admissno.substr(0,8).replace(/\+/g," ");
            }

            break; 
          case 7:

            Unit = elCols[j].innerHTML.replace(/<BR>.*/i,"");
            Doctors = elCols[j].innerHTML.replace(/.*<BR>/i,"").split(" / ");

            if( Doctors[1] != null ){
              Doctor = Doctors[0].replace(/..A>/i,"").replace(/.*>/,"");
              Doctor += " and " + Doctors[1].replace(/..A>/i,"").replace(/.*>/,"");
            }else {
              Doctor = elCols[j].innerHTML.replace(/..A>/i,"").replace(/.*>/,"");
            }

            break;
          case 8:
            if ( elCols[j].innerHTML.match(/<BR>/ig) ) {
              tempStr = elCols[j].innerHTML.replace(/<BR>/gi,"|").split("|");
              AdmDate = tempStr[0].substr(0,11);
              DisDate = tempStr[1].substr(0,11);
            }

            break;
          default:
            break;
        } 
      }
    }
    if (!closedFlag) {
      if (urnumber!=null) {
        t.addRow(urnumber,admissno,"",PatientName,WardBed,AdmDate,gender,DisDate,Unit,Doctor,NameSort) 
      }
    }
  }
}
</script>
</head>
%START.OF.PAGE
<body class=PatientList onload="init();">
<div class=HeadingDiv>
<table border=0 padding=0 style='width:100%;border:0;margin:0;padding:4px 0px'>
<tr><td class=HeadLeft><span class="goBack"
    onclick="location.href='../html/iphone/WardList.html';">Back</span></td>
    <td class=HeadTitle>%PATWEB93.01.102</td>
    <td class=HeadRight>
    </td>
</tr></table>
</div>
<div id=WidgetTable1 class=w-table></div>
<div style='display:none;'>
<table id=WardList cellspacing=0 cellpadding=2 border=1 width=100%>
%PATWEB93.01.009.patweb98.01.001.patweb99.01.001.0
</table>
</div>
</body>

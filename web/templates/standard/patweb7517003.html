<meta name="TemplateVersion" content="V12.00.00">
<meta name="TemplateHome" content="standard">
<meta name="CrossBrowser" content="true">
<meta name="HelpFileName"    content="NoContextSet.html">
<script type="text/javascript">
function validateMisconload(ReturnCode,ReturnName,MultHosp,
                      ReturnAmount,ReturnQuantity,ReturnHidden,
                      ReturnAdm,ReturnDate) {
//  ReturnName.value="";
  if (isWhitespace(ReturnCode.value)) return;;

//  var serverURL = "../cgi-bin/patweb80.pbl?reportno=40"
//                  + "&valdcode=" + ReturnCode.value.replace(/ /g,"+")
//                  + "&multhosp=" + MultHosp.value.replace(/ /g,"+");
//  var returnValue = RSExecute(serverURL);
//  if (returnValue.status==0) {
//    ReturnValue=returnValue.return_value.split("|")
//    ReturnName.value=trim(ReturnValue[0])
//    ReturnAmount.value=trim(ReturnValue[1])
//    ReturnHidden.value=trim(ReturnValue[1])
//    ReturnQuantity.value="1";
//    return true;
//  }
//  else {
//    ReturnCode.value="";
//    ReturnAmount.value="";
//    ReturnQuantity.value="";
//    ReturnHidden.value="";
//    ReturnCode.select();
//    ReturnCode.focus();
//    return false;
//  }

  var serverURL = "../cgi-bin/patweb80.pbl?reportno=4" +
        "&valdcode=" + ReturnCode.value.replace(/ /g,"+") +
        "&returndt=" + ReturnDate.value.replace(/ /g,"+") +
        "&valdadno=" + ReturnAdm.value.replace(/ /g,"+") +
        "&valdtype=3"

  var returnValue = RSExecute(serverURL);
  if (returnValue.status==0) {
    ReturnValue=returnValue.return_value.split("|");
//    alert(ReturnValue);

//  ReturnName.value=trim(ReturnValue[0]);
//  ReturnName.value=ReturnName.value.toUpperCase()

//  ReturnAmount.value=ReturnValue[1];
//  justifyLeft(ReturnAmount);

//  ReturnHidden.value=ReturnValue[1];
//  justifyLeft(ReturnHidden);

//  ReturnQuantity.value="1";

    if (ReturnValue[2]==1) // keyin description ?
    {
      ReturnName.className="Mandatory";
      ReturnName.readOnly=false;
    }
    else
    {
      ReturnName.className="ReadOnly";
      ReturnName.readOnly=true;
    }

    if (ReturnValue[3]==1) // Keyin Price/Amount
    {
      ReturnAmount.className="Number Mandatory";
      ReturnAmount.readOnly=false;
    }
    else
    {
      if (ReturnAmount.value==0 && ReturnValue[7]==0)
       // mbs amount is 0.00 && no warning msg
      {
        ReturnAmount.className="Number Mandatory";
        ReturnAmount.readOnly=false;
      }
      else
      {
        ReturnAmount.className="ReadOnly";
        ReturnAmount.readOnly=true;

      }
    }

// if the amount is zero and keyin amount is set to No, then No quantity.

    if ((ReturnValue[1]==0.00) && (ReturnValue[3]==0)) {
        ReturnQuantity.className="ReadOnly";
        ReturnQuantity.readOnly=true;
    }
    else {
        ReturnQuantity.className="Integer Mandatory";
        ReturnQuantity.readOnly=false;
        ReturnQuantity.onkeydown = null;
    }


  } else {
    ReturnCode.value="";
    ReturnAmount.value="";
    ReturnQuantity.value="";
    ReturnHidden.value="";
    ReturnCode.select();
    ReturnCode.focus();
    return false;
  }
}
function getURandPatient() {
  justifyRight(document.SelectCode.tmmti002);
  if (validateVisit(document.SelectCode.tmmti002,
                    document.SelectCode.tmmti001,
                    '3')) {
    justifyRight(document.SelectCode.tmmti001);
    validateCodeRecUR(document.SelectCode.tmmti001,
                      document.SelectCode.patientn,
                      document.SelectCode.dummy);
  }

}
function validateMisc(ReturnCode,ReturnName,MultHosp,
                      ReturnAmount,ReturnQuantity,ReturnHidden,
                      ReturnAdm,ReturnDate) {
  ReturnName.value="";
  if (isWhitespace(ReturnCode.value)) return;;

//  var serverURL = "../cgi-bin/patweb80.pbl?reportno=40"
//                  + "&valdcode=" + ReturnCode.value.replace(/ /g,"+")
//                  + "&multhosp=" + MultHosp.value.replace(/ /g,"+");
//  var returnValue = RSExecute(serverURL);
//  if (returnValue.status==0) {
//    ReturnValue=returnValue.return_value.split("|")
//    ReturnName.value=trim(ReturnValue[0])
//    ReturnAmount.value=trim(ReturnValue[1])
//    ReturnHidden.value=trim(ReturnValue[1])
//    ReturnQuantity.value="1"; 
//    return true;
//  }
//  else {
//    ReturnCode.value="";
//    ReturnAmount.value="";
//    ReturnQuantity.value="";
//    ReturnHidden.value="";
//    ReturnCode.select();
//    ReturnCode.focus();
//    return false;
//  }

  var serverURL = "../cgi-bin/patweb80.pbl?reportno=4" +
        "&valdcode=" + ReturnCode.value.replace(/ /g,"+") +
        "&returndt=" + ReturnDate.value.replace(/ /g,"+") +
        "&valdadno=" + ReturnAdm.value.replace(/ /g,"+") +
        "&valdtype=3"

  var returnValue = RSExecute(serverURL);
  if (returnValue.status==0) {
    ReturnValue=returnValue.return_value.split("|");
//    alert(ReturnValue);

    ReturnName.value=trim(ReturnValue[0]);
    ReturnName.value=ReturnName.value.toUpperCase()

    ReturnAmount.value=ReturnValue[1];
    justifyLeft(ReturnAmount);

    ReturnHidden.value=ReturnValue[1];
    justifyLeft(ReturnHidden);

    ReturnQuantity.value="1";

    if (ReturnValue[2]==1) // keyin description ?
    {
      ReturnName.className="Mandatory";
      ReturnName.readOnly=false;
    }
    else
    {
      ReturnName.className="ReadOnly";
      ReturnName.readOnly=true;
    }

    if (ReturnValue[3]==1) // Keyin Price/Amount
    {
      ReturnAmount.className="Number Mandatory";
      ReturnAmount.readOnly=false;
    }
    else
    {
      if (ReturnAmount.value==0 && ReturnValue[7]==0)
       // mbs amount is 0.00 && no warning msg
      {
        ReturnAmount.className="Number Mandatory";
        ReturnAmount.readOnly=false;
      }
      else
      {
        ReturnAmount.className="ReadOnly";
        ReturnAmount.readOnly=true;

      }
    }

// if the amount is zero and keyin amount is set to No, then No quantity.

    if ((ReturnValue[1]==0.00) && (ReturnValue[3]==0)) {
        ReturnQuantity.className="ReadOnly";
        ReturnQuantity.readOnly=true;
    }
    else {
        ReturnQuantity.className="Integer Mandatory";
        ReturnQuantity.readOnly=false;
        ReturnQuantity.onkeydown = null;
    }


  } else {
    ReturnCode.value="";
    ReturnAmount.value="";
    ReturnQuantity.value="";
    ReturnHidden.value="";
    ReturnCode.select();
    ReturnCode.focus();
    return false;
  }
}

function validateCodeRecUR(ReturnCode,ReturnName,ReturnRef) {
  ReturnFunction="" ;
  ReturnName.value="";
  ReturnRef.value="";
  for (var i=3; i < validateCodeRecUR.arguments.length; i++) {
    if (typeof(validateCodeRecUR.arguments[i]) == 'function') {
      ReturnFunction=validateCodeRecUR.arguments[i] }
    else {
      validateCodeRecUR.arguments[i].value=""; }  }
  if (isWhitespace(ReturnCode.value)) return;;
  var serverURL   = "../cgi-bin/patweb80.pbl?reportno=8&returnfm=3" +
                    "&valdcode=" + ReturnCode.value.replace(/ /g,"+")
  var returnValue = RSExecute(serverURL);
  if (returnValue.status==0) {
    ReturnValue=returnValue.return_value.split("|")
    ReturnName.value=trim(ReturnValue[0])
    if(!isWhitespace(ReturnValue[1])) {
      ReturnRef.value=trim(ReturnValue[1])
    }
    j=0
    for (var i=3; i < validateCodeRecUR.arguments.length; i++) {
       if (typeof(validateCodeRecUR.arguments[i]) != 'function') {
         j++
         validateCodeRecUR.arguments[i].value=ReturnValue[j] } }
    if (typeof(ReturnFunction) == 'function') {
       ReturnFunction() }
    return true;
    }
  else {
    ReturnCode.value="";
    ReturnCode.select();
    ReturnCode.focus();
    return false;
     }
}
function RCPPatientSearchFrame(ReturnUR,ReturnName,ReturnVisInv,systemcd){
  ReturnFunction="" ;
  for (var i=4; i < RCPPatientSearchFrame.arguments.length; i++) {
    if (typeof(RCPPatientSearchFrame.arguments[i]) == 'function') {
      ReturnFunction=RCPPatientSearchFrame.arguments[i] }
  }
  window.ReturnName=ReturnName ;
  window.ReturnUR=ReturnUR ;
  window.ReturnCode=ReturnVisInv ;
  window.IBASystem=parseInt(systemcd.value,10);
  window.SystemCode=systemcd;
  var PopUpFrameDoc = DFrameStart();
  PopUpFrameDoc.location.href = "patweb90.pbl?reportno=1&template=18";
  SearchFrameShow();
}
function validateVisit(admissno,urnumber,visittyp) 
{
  ReturnFunction="";
  for (var i=3; i < validateVisit.arguments.length; i++) 
  {
    if (typeof(validateVisit.arguments[i]) == 'function') 
    {
      ReturnFunction=validateVisit.arguments[i] 
    } else {
      validateVisit.arguments[i].value=""; 
    }  
  }

  if (isWhitespace(admissno.value)) return;;

  var serverURL = "../cgi-bin/patweb80.pbl?reportno=56" +
                  "&valdcode=" + admissno.value.replace(/ /g,"+") +
                  "&valdurno=" + urnumber.value.replace(/ /g,"+") +
                  "&valdtype=" + visittyp;

  var returnValue = RSExecute(serverURL);

  if (returnValue.status==0) 
  {
    ReturnValue=returnValue.return_value.split("|");
    if (isWhitespace(urnumber.value)) 
    {
       urnumber.value=ReturnValue[1];
    }

    var warnflag=ReturnValue[2];

    if (warnflag==1) 
    {
      alert("Warning: An Invoice already exists for this visit");
    }

    j=3

    for (var i=3; i < validateVisit.arguments.length; i++) 
    {
       if (typeof(validateVisit.arguments[i]) != 'function') 
       {
         j++
         validateVisit.arguments[i].value=ReturnValue[j] 
       }
    }

    if (typeof(ReturnFunction) == 'function') 
    {
       ReturnFunction(); 
    }
    return true;
  } 
  else 
  {
    admissno.value="";
    return false;
  }
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);getURandPatient();validateMisconload(SelectCode.tmmti004,
                                                        SelectCode.tmmti005,
                                                        SelectCode.multhosp,
                                                        SelectCode.tmmti008,
                                                        SelectCode.tmmti006,
                                                        SelectCode.tmmti009,
                                                        SelectCode.tmmti002,
                                                        SelectCode.tmmti003);">
  <span class=DFrameTitleBar>
    <img align="right" alt="Exit" class="MenuIcon" 
         src="../images/ExitIcon.gif" onclick="DFrameExit();">
    Input Bulk Miscellaneous Charges
  </span>
  <form name=SelectCode action=patweb75.pbl method=post style="margin:0">
      <input type=hidden name=reportno value=17>
      <input type=hidden name=template value=2>
      <input type=hidden name=updttype>
      <input type=hidden name=nextpage value=0>
      <input type=hidden name=systemcd>
      <input type=hidden name=redirect 
             value="patweb75.pbl?reportno=17&template=1">
      <input type=hidden name=dummy>
      <input type=hidden name=multhosp value="%PATWEB75.17.111">
      <input type=hidden name=tmmti009 value="%PATWEB75.17.110">
      <input type=hidden name=trannumb value="%PATWEB75.17.109">
      <input type=hidden name=tmmtibat value="%PATWEB75.17.112">

  <table align=center border=0 width=70% cellspacing=0 cellpadding=0>
      <tr>
        <td class=DataLabel>
          U/R Number
        </td>
        <td>
          <input type=text name=tmmti001 title="U/R Number" size=8
                 class=Readonly readonly maxlength=8 value="%PATWEB75.17.101">
          <input type=text name=patientn title="Patient Name" size=50
                 maxlength=50 class=Readonly readonly>
        </td>
      </tr>

      <tr>
        <td class=DataLabel>
          Visit Number
        </td>
        <td>
          <input type=text name=tmmti002 title="Visit Number" size=8
                 class=ReadOnly maxlength=8 readonly value="%PATWEB75.17.102">
        </td>
      </tr>

      <tr>
        <td class=DataLabel>
          Date
        </td>
        <td>
          <input type=text size=11 maxlength=12 name=tmmti003 
                 class="Mandatory PastDate" value="%PATWEB75.17.103"
                 title="Date" onblur="checkDate(this);">
          <img notab src="../images/DateTimeStamp.gif" class=Icon alt="Current"
               date="SelectCode.tmmti003">
          <img notab src="../images/DateLookup.gif" class="Icon"
               alt="Show Calendar" date="SelectCode.tmmti003">
        </td>
      </tr>

      <tr>
        <td class=DataLabel>
          Item
        </td>
        <td>
          <input type=text name=tmmti004 size=9 maxlength=9
                 class="SelectBig Mandatory"
                 onblur="validateMisc(SelectCode.tmmti004,SelectCode.tmmti005,
                                      SelectCode.multhosp,
                                      SelectCode.tmmti008,
                                      SelectCode.tmmti006,
                                      SelectCode.tmmti009,
                                      SelectCode.tmmti002,
                                      SelectCode.tmmti003);"
                 title="Misc Charge Code" value="%PATWEB75.17.104">
          <input type=text name=tmmti005 size=35 class=Mandatory
                 title="Misc Charge Code Description" value="%PATWEB75.17.105">
          <img src=../images/SearchIcon.gif class=Icon
             onclick="DefMiscChargeSearchFrame(SelectCode.tmmti004,SelectCode.tmmti005,SelectCode.multhosp);">
          <img src="../images/erase.gif" alt="Clear" class="Icon"
             onclick='clrDoc(SelectCode.tmmti004,SelectCode.tmmti005);'> 
        </td>
      </tr>

      <tr>
        <td class=DataLabel>
          Quantity
        </td>
        <td>
          <input type=text name=tmmti006 title="Quantity" size=5
                 class="Number Mandatory" maxlength=5 value="%PATWEB75.17.106"
              onblur="if (!isWhitespace(this.value)&&
                          !isWhitespace(document.SelectCode.tmmti009.value)) {
                         document.SelectCode.tmmti008.value =
                         parseFloat(document.SelectCode.tmmti009.value) *
                         parseFloat(document.SelectCode.tmmti006.value);}">
        </td>
      </tr>

      <tr>
        <td class=DataLabel>
          Reference
        </td>
        <td>
          <input type=text name=tmmti007 title="Reference" size=15 maxlength=12
          value="%PATWEB75.17.107">
        </td>
      </tr>

      <tr>
        <td class=DataLabel>
          Amount
        </td>
        <td>
          <input type=text name=tmmti008 title="Amount" size=20 
                 class="Number Mandatory" onblur="RoundNumber(this,2);"
                 min=0 max=999999999999.99 value="%PATWEB75.17.108">
        </td>
      </tr>

  </table>

  <table width=100%>
    <tr>
      <td align=center>
        <input type=button value="Update" class="button"
               onclick="document.SelectCode.updttype.value='C';
                        if (validateMandatory(document.SelectCode)) 
                          {document.all.SelectCode.submit();}">
        <input type=button value="Close" class="button"
               onclick='DFrameExitRefresh();'>
        <input type=button value="Delete" class="button"
               onclick="document.SelectCode.updttype.value='D';
                        document.all.SelectCode.submit();">
      </td>
    </tr>
  </table>
  </form>

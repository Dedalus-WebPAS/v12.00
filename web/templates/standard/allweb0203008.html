<meta name="TemplateVersion" content="V12.00.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="">
<meta name="CrossBrowser" content="true">
<script language="javascript" src="../js/allweb03.js"></script>
<script type="text/javascript">
function addReferralDestination()
{
  if(!validateMandatory(UpdateForm))
    return;;

  var dest = document.getElementById("alrhl004");
  var date = document.getElementById("alrhl005");
  var place = document.getElementById("alrhl006");
 
  var rfdc =  dest[dest.selectedIndex].value.substr(0,3);    // Destination
  var rfdd =  dest[dest.selectedIndex].innerHTML;

  var rfdpc =  place[place.selectedIndex].value.substr(0,3);  // Place
  var rfdpd =  place[place.selectedIndex].innerHTML;

  var table = document.getElementById("referralDestinationTable");

  var tr = document.createElement("tr");
  var tdRemove = document.createElement("td");
  var tdCode = document.createElement("td");
  var tdDescription = document.createElement("td");
  var tdDate = document.createElement("td");
  var tdCode2 = document.createElement("td");
  var tdDescription2 = document.createElement("td");

  var tdRemoveImage = document.createElement("img");
  var form = parent.document.getElementsByTagName("form");
  var obj = parent.document.createElement("input");
  var obj2 = parent.document.createElement("input");
  var obj3 = parent.document.createElement("input");

  if(allowMultipleSameDiagnosisCode("document","rfdtr"+rfdc,rfdd,false))
  {
    tdRemoveImage.setAttribute("id","rfdi"+rfdc);
    tdRemoveImage.src="../images/DeleteIcon.gif";

    tdRemove.appendChild(tdRemoveImage);

    tdCode.setAttribute("width","100");
    tdCode.setAttribute("id","rfdc"+rfdc);
    tdCode.innerHTML = rfdc;
    tdDescription.innerHTML = rfdd;
    tdDate.innerHTML = date.value;

    tdCode2.setAttribute("width","100");
    tdCode2.setAttribute("id","rfdpc"+rfdpc);
    tdCode2.innerHTML = rfdpc;
    tdDescription2.innerHTML = rfdpd;

    tr.setAttribute("id","rfdtr"+rfdc);
    tr.appendChild(tdRemove);
    tr.appendChild(tdCode);
    tr.appendChild(tdDescription);
    tr.appendChild(tdDate);
    tr.appendChild(tdCode2);
    tr.appendChild(tdDescription2);

    table.getElementsByTagName("TBODY")[0].appendChild(tr);

    obj.type="hidden";
    obj.name = "rfdtr"+rfdc;
    obj.id = "rfdtr"+rfdc
    obj.value = rfdc;
 
    obj2.type="hidden";
    obj2.name = "rfdat"+rfdc;
    obj2.id = "rfdat"+rfdc;
    obj2.value = date.value;

    obj3.type="hidden";
    obj3.name = "rfdpl"+rfdc;
    obj3.id = "rfdpl"+rfdc
    obj3.value = rfdpc;

    if(form.length>1) {
      if(form[1].name=="InternalReferral") {
        form[1].appendChild(obj);
        form[1].appendChild(obj2);
        form[1].appendChild(obj3);
      } else {
        form[0].appendChild(obj);
        form[0].appendChild(obj2);
        form[0].appendChild(obj3);
      }
    } else {
      form[0].appendChild(obj);
      form[0].appendChild(obj2);
      form[0].appendChild(obj3);
    }

    //blind event handler
    tdRemoveImage.onclick = function()
    {
       var temp = document.getElementById(tr.id);
       table.getElementsByTagName("TBODY")[0].removeChild(temp);
       if(form.length>1) {
         if(form[1].name=="InternalReferral") {
            form[1].removeChild(obj);
            form[1].removeChild(obj2);
            form[1].removeChild(obj3);
          } else {
            form[0].removeChild(obj);
            form[0].removeChild(obj2);
            form[0].removeChild(obj3);
          }
       } else {
         form[0].removeChild(obj);
         form[0].removeChild(obj2);
         form[0].removeChild(obj3);
       }
    }
  }
}

function allowMultipleSameDiagnosisCode(temp,id,description,boolean)
{
  var obj = null;

  if(boolean !== true)
  {
      obj = document.getElementById(id);

      if(obj)
      {
        alert("Warning diagnosis already exist: "+
               id.replace(/rfdtr/,"").replace(/ /g,"")+
               " "+description);

        return false;
      }
   }

   return true;
}

function sendReferralDestinationToParentFrame()
{
  renameReferralDestinationCGI("rfdtr");
  renameReferralDestinationCGI("rfdat");
  renameReferralDestinationCGI("rfdi");
  renameReferralDestinationCGI("rfdpl");

  setBtnReferralDestinationColor();
  DFrameExit();
}

function loadReferralDestination()
{
  var form = parent.document.getElementsByTagName("form");
  var hiddenElement = form[0].getElementsByTagName("input");
  if(form.length>1) {
    if(form[1].name=="InternalReferral") {
      hiddenElement = form[1].getElementsByTagName("input");
    }
  } 
  
  var table = document.getElementById("referralDestinationTable");
  var temp = "";
  var temp2 = "";
  var id = "";
  var id2 = "";

  table.onclick = function(e)
  {
    if(!e)
    {
      e = event;
      e.target = e.srcElement;
    }
    if(e.target.nodeName.toLowerCase() == 'img')
    {
       //the image id is one less - etc rfdi100
      removeObject(table,e.target.parentNode.parentNode);
    }
  }

  for(var i = 0; i < hiddenElement.length; i++)
  {
     if(hiddenElement[i].type == "hidden"
        && hiddenElement[i].name.match("rfdt"))
     {
         var tr = document.createElement("tr");
         var tdRemove = document.createElement("td");
         var tdCode = document.createElement("td");
         var tdDescription = document.createElement("td");
         var tdDate = document.createElement("td");
         var tdRemoveImage = document.createElement("img");
         var tdCode2 = document.createElement("td");
         var tdDescription2 = document.createElement("td");
         var desc = new Object();
         var desc2 = new Object();
         
         var category = new Object();
         var category2 = new Object();
         var code = new Object();
         var code2 = new Object();

         var deptcode = document.getElementById("deptcode");

         if(allowMultipleSameDiagnosisCode("document",hiddenElement[i].id,
                                           "N/A ",false))
         {
           tdRemoveImage.setAttribute("id","rfdi"+hiddenElement[i].id.substr(5,3));
           tdRemoveImage.src="../images/DeleteIcon.gif";
           tdRemove.appendChild(tdRemoveImage);

           tdCode.setAttribute("width","100");
           tdCode.setAttribute("id","rfdc"+hiddenElement[i].id.substr(5,3));
           tdCode.innerHTML = hiddenElement[i].value;
          
           //category code for Referral Destination
           category.value = "zU";
           code.value = hiddenElement[i].value;
           //remote script               
           validateCatCode(category,code,desc);
        
           tdDescription.innerHTML = desc.value;
           id = hiddenElement[i].name.substr(5,3);
           temp = parent.document.getElementById("rfdat"+id);
           tdDate.innerHTML = temp.value;
///
           id2 = hiddenElement[i].name.substr(5,3);
           temp2 = parent.document.getElementById("rfdpl"+id2);

           tdCode2.setAttribute("width","100");
           tdCode2.setAttribute("id",temp2.id);
           tdCode2.innerHTML = temp2.value;

           //category code for Referral Place
           category2.value = "zV";
           code2.value = temp2.value;
           //remote script
           validateCatCode(category2,code2,desc2);
         
           tdDescription2.innerHTML = desc2.value;

///
           tr.setAttribute("id",hiddenElement[i].id);

           tr.appendChild(tdRemove);
           tr.appendChild(tdCode);
           tr.appendChild(tdDescription);
           tr.appendChild(tdDate);
           tr.appendChild(tdCode2);
           tr.appendChild(tdDescription2);

           table.getElementsByTagName("TBODY")[0].appendChild(tr);
         }
     }
  }
}

function removeObject(table,obj)
{
  var temp;
  var temp1;
  var temp2;

  var refCode;
  var refDate;
  var refCode2;

  temp = "rfdtr" + obj.id.substr(5,3);
  refCode = parent.document.getElementById(temp);

  temp1 = "rfdat" + obj.id.substr(5,3);
  refDate = parent.document.getElementById(temp1);

  temp2 = "rfdpl" + obj.id.substr(5,3);
  refCode2 = parent.document.getElementById(temp2);
  

  var form =  parent.document.getElementsByTagName("form");
  var hiddenInputs = form[0].getElementsByTagName("input");
  if(form.length>1) {
    if(form[1].name=="InternalReferral") {
      hiddenInputs = form[1].getElementsByTagName("input");
    }
  }

  for(var i = 0; i < hiddenInputs.length; i++)
  {
    if(hiddenInputs[i].type == "hidden" && hiddenInputs[i].name == temp) 
       if(form.length>1) {
         if(form[1].name=="InternalReferral") {
           form[1].removeChild(hiddenInputs[i]);
         } else {
           form[0].removeChild(hiddenInputs[i]);
         }
       } else {
           form[0].removeChild(hiddenInputs[i]);
       }
  }

  for(var i = 0; i < hiddenInputs.length; i++)
  {
    if(hiddenInputs[i].type == "hidden" && hiddenInputs[i].name == temp1)
       if(form.length>1) {
         if(form[1].name=="InternalReferral") {
           form[1].removeChild(hiddenInputs[i]);
         } else {
           form[0].removeChild(hiddenInputs[i]);
         }
       } else {
           form[0].removeChild(hiddenInputs[i]);
       }
  }

  for(var i = 0; i < hiddenInputs.length; i++)
  {
    if(hiddenInputs[i].type == "hidden" && hiddenInputs[i].name == temp2)
       if(form.length>1) {
         if(form[1].name=="InternalReferral") {
           form[1].removeChild(hiddenInputs[i]);
         } else {
           form[0].removeChild(hiddenInputs[i]);
         }
       } else {
           form[0].removeChild(hiddenInputs[i]);
       }
  }

  table.getElementsByTagName("TBODY")[0].removeChild(obj);

}

function setBtnReferralDestinationColor()
{
  var form = parent.document.getElementsByTagName("form");
  var element = form[0].getElementsByTagName("input");
  if(form.length>1) {
    if(form[1].name=="InternalReferral") {
      element = form[1].getElementsByTagName("input");
    }
  }

  var button = parent.document.getElementById("btnReferralDestination");

  for(var i = 0; i < element.length; i++)
  {
    if(element[i].type == "hidden" && element[i].name.match("rfdtr"))
    {
      button.style.color = "red";
      return;;
    }
  }

  button.style.color = "black";
}

function renameReferralDestinationCGI(name)
{
  var form = parent.document.getElementsByTagName("form");
  var element = form[0].getElementsByTagName("input");
  if(form.length>1) {
    if(form[1].name=="InternalReferral") {
      element = form[1].getElementsByTagName("input");
    }
  }

  var j = 100;

  for(var i = 0; i < element.length; i++)
  {
    if(element[i].type == "hidden" && element[i].name.match(name))
    {
       element[i].name = name+j;
       element[i].id = name+j;
       j++;

    }
  }
}

function valDate(obj,str)
{
  checkDate(obj,str);

  //need to also valdiate date for SAC start Date to SAC end date
  //valid if obj.value date falls between the two ranges 
  //(start and end SAC dates). 
}

function setReferralOutPlace() {
  if(parent.document.UpdateForm == undefined) {
     return;
  }
  if(parent.document.UpdateForm.deptIndi == undefined) {
     return;
  }
    var deptIndicator = parent.document.UpdateForm.deptIndi.value;
    var alrhl006 = document.getElementById('alrhl006');
    
    if(typeof deptIndicator != 'undefined') {
      if(deptIndicator.substr(10,1) == "T") {
          alrhl006.className = "Mandatory";
      }
    }
}
function getDeptcodeQueryString() {
  UpdateForm.d_deptcode.value = getQueryString("deptcode");
//
  p=UpdateForm;
  validateCatCode(p.cat_CG,p.d_deptcode,p.dummy,p.deptindi);
  UpdateForm.deptindi.value = "   " + UpdateForm.deptindi.value;
  if(UpdateForm.deptindi.value.substr(10,1)=="O") { // SOP
    filterCatCodeList(UpdateForm.alrhl004,"3","O","1"); // Exclude from SOP
  } else {
    filterCatCodeList(UpdateForm.alrhl004,"2","O","1"); // Remove SOP options
  }
  if(UpdateForm.deptindi.value.substr(10,1)=="T") { // TCP
    document.UpdateForm.alrhl005.className="PastDate";
    document.UpdateForm.alrhl004.className="";
  }
}
</script>
</head>

%START.OF.PAGE


<body onload="PageLoad(event);loadReferralDestination();setReferralOutPlace();
              getDeptcodeQueryString()">
<span class=DFrameTitleBar>
<img class=Icon border=0 align=right src=../images/ExitIcon.gif 
 onclick="sendReferralDestinationToParentFrame();">
Referral Out Service Types
</span>
<div id=PageBodySection>
<form id=UpdateForm name=UpdateForm action="allweb03.pbl" method=post
 onsubmit='return validateMandatory(this)'>
<input type=hidden name=reportno value=3>
<input type=hidden name=template value=008>
<input type=hidden name=nextpage value=0>
<input type=hidden name=redirect value="">
<input type=hidden name=urnumber value='%ALLWEB02.03.003'>
<input type=hidden name=admissno value='%ALLWEB02.03.081'>
<input type=hidden name=updatety value="A">
<input type=hidden name=cat_CG value="CG" />
<input type=hidden name=d_deptcode value="" />
<input type=hidden name=deptindi value="" />
<input type=hidden name=dummy value="" />

<table align=center cellspacing=0 cellpadding=1 border=1 width=100%>
<tr>
  <td class="HeadingCell">Date</td>
  <td class="HeadingCell">Referral Out Service Type</td>
  <td class="HeadingCell">Referral Place</td>
</tr>
<tr>
  <td class="DataLabel">
    <input type="text" id="alrhl005" name="alrhl005" 
           class="Mandatory PastDate" size="10"
           value="%STANDARD.01.015"
           onblur="valDate(this,'Date');" 
           title="Referral Out Service Type Date" />
    <img src=../images/DateTimeStamp.gif class=Icon 
         date=UpdateForm.alrhl005
         time=null />
    <img src=../images/DateLookup.gif class=Icon 
         date="UpdateForm.alrhl005" />
  </td>
  <td class="DataLabel">
    <select id="alrhl004" name="alrhl004"  class="Mandatory"
            title="Referral Out Service Type">
    <option></option>
      %ALLWEB02.03.611.9.1.01.2.I
    </select>
  </td>
  <td class="DataLabel">
    <select id="alrhl006" name="alrhl006" 
            title="Referral Place">
    <option></option>
      %ALLWEB02.03.615.2
    </select>
    &nbsp;
    <input type="button" class="button" value="Add" 
           onclick="addReferralDestination();"/>
    <input type="button" class="button" value="Ok" 
           onclick="sendReferralDestinationToParentFrame()"/>
  </td>
</tr>
</table>
<br />
<div style="height:300px;overflow:auto;">
<table id="referralDestinationTable" border="1" width="99%">
<tr><td class="HeadingCell" width="50">Remove</td>
<td class="HeadingCell" width="50">Code</td>
<td class="HeadingCell">Referral Out Service Type</td>
<td class="HeadingCell">Date</td>
<td class="HeadingCell" width="50">Code</td>
<td class="HeadingCell">Referral Place</td>
</tr>
</table>
</div>
</form>
</div>

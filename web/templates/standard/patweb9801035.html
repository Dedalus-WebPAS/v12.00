<meta name="TemplateVersion" content="V12.00.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/patweb98.js"></script>
<script type="text/javascript">
function ShowBedReq(linkurl) {
  Left=(document.body.clientWidth-600)/2
  DFrameLink(linkurl,23,110,420,210)
}
function ShowGST(linkurl) {
  Left=(document.body.clientWidth-600)/2
  DFrameLink(linkurl,23,110,420,210)
}
function ShowClm(linkurl) {
  linkurl+="&chngctyp=1";
  Left=(document.body.clientWidth-600)/2
  DFrameLink(linkurl,23,110,420,210)
}
function ShowAtype(linkurl) {
  Left=(document.body.clientWidth-600)/2
  DFrameLink(linkurl,23,110,420,210)
}
function ShowHF(linkurl) {
  Left=(document.body.clientWidth-600)/2
  DFrameLink(linkurl,20,30,580,310)
}
function showChangeUR(linkurl) {
  ChangeURFrame(linkurl);
}

function checkoverlap(ptmis001,ptmis002) {
  admissno=PatientLinks.admissno.value.replace(/ /g,"+")
  var serverURL = "../cgi-bin/patweb96.pbl?reportno=12&remoteno=2" +
                  "&ptmis001="+ptmis001.replace(/ /g,"+") +
                  "&ptmis002="+ptmis002.replace(/ /g,"+") +
                  "&admissno="+admissno
  var returnValue = RSExecute(serverURL);
  if(returnValue.status==0){
     return true;
  } else {
     return false;
  }
}

function Undischarge() {
 UpdateForm.updatety.value="1";
 if (document.UpdateForm.ddatreas.value==""){
    alert("Reason is required.")
    return;
 }
  if(!isWhitespace(document.UpdateForm.ptdslsdn.value)){
    alert("This is a Statistical Discharge and is linked to a subsequent "+
          "'Statistical Re-admission'.  You must cancel the linked "+
          "'Statistical Re-admission' before being able to cancel this "+
          "discharge.");
     return;
   }
 if (document.UpdateForm.dscfimex.value=="1"){
    alert("Discharge FIM Details exist for this patient.\n" +
          "These details will be deleted.")
 }
 if (document.getElementById("ptcnwrun").value=="1") {
   var serverURL   = "../cgi-bin/emrweb08.pbl?reportno=44" +
                      "&valdcode=" + 
                      document.UpdateForm.admissno.value.replace(/ /g,"+")
   var returnValue = RSExecute(serverURL);
   if (returnValue.status==0) { 
     if (returnValue.return_value=="1") {
       if (confirm("Warning: \nDischarge Coding exists. Click OK to Undischarge patient" +
                   " or click Cancel to return.")) {
         document.UpdateForm.redirect.value=
         "mrtweb02.pbl?reportno=3&template=001" +
         "&urnumber=" + document.UpdateForm.urnumber.value.replace(/ /g,"+")+
         "&admissno=" + document.UpdateForm.admissno.value.replace(/ /g,"+")   
         UpdateForm.nextpage.value="7";
         UpdateForm.submit();
         return;
       } else {
         return;
       }
     }   
   }
 }
 UpdateForm.submit();
}

function Unadmit() {
 if (trim(document.UpdateForm.astat.value)=="On-Leave"){
    alert("Cannot Unadmit - patient on leave");
    return
 }
 if (document.UpdateForm.trnureas.value==""){
    alert("Cancellation Reason is required.")
    return;
 }
 if (document.UpdateForm.admfimex.value=="1"){
    alert("Admission FIM Details exist for this patient.\n" +
          "These details and all other FIM details will be deleted.")
 }
 if(!isWhitespace(document.UpdateForm.ptmilsdn.value)){
    if(isWhitespace(document.UpdateForm.ddatreas.value)){
      alert("Warning: This is a Statistical Re-admission. The linked "+
          "'Statistical Discharge' will also be cancelled. Please " +
          "Enter the Discharge Cancellation Reason before continuing. ");
          return;
    } else {
      if(!confirm("Warning: This is a Statistical Re-admission. The linked "+
          "'Statistical Discharge' will also be cancelled. Click Ok to  "+
          "Continue or Cancel to return the the Supervisor page. ")){
          return;
      }
   }
 }

 UpdateForm.updatety.value="2";
 if (document.UpdateForm.trncancp.checked==true){
    UpdateForm.nextpage.value="8";
    UpdateForm.redirect.value="patweb89.pbl";
    document.UpdateForm.redirect.value="patweb89.pbl?reportno=1&template=010" +
    "&urnumber=" + document.UpdateForm.urnumber.value.replace(/ /g,"+")+
    "&admissno=" + document.UpdateForm.admissno.value.replace(/ /g,"+")
  if (getTop().location.pathname.match(/EmergencyMapFrame/g)) {
   UpdateForm.nextpage.value="2";
  }
 }
 UpdateForm.submit();
}

//<!-- HPS BLR(SAC) Code Starts Here --> 

function CancelMV(urnumber,admissno){

parent.location.href="patweb98.pbl?reportno=01&template=042&urnumber="+urnumber+"&admissno="+admissno
DFrameExit()

}
 //<!-- HPS Code Ends Here --> 

function UpdAdmit() {
 UpdateForm.updatety.value="4";
 if (document.UpdateForm.ptmis001.value==""){
    alert("Admission Date is required.")
    return;
 }
 if (document.UpdateForm.ptmis002.value==""){
    alert("Admission Time is required.")
    return;
 }
 if (document.UpdateForm.admnreas.value==""){
    alert("Reason is required.")
    return;
 }
 admissno=PatientLinks.admissno.value.replace(/ /g,"+")
 var serverURL = "../cgi-bin/patweb96.pbl?reportno=12&remoteno=9" +
        "&ptmis001="+UpdateForm.ptmis001.value.replace(/ /g,"+") +
        "&admissno="+admissno
 var returnValue = RSExecute(serverURL);
 if (returnValue.status!=0){
    return false;
 }
 if (UpdateForm.ptcnhdps=="3") {
    var serverURL = "../cgi-bin/patweb96.pbl?reportno=12&remoteno=11" +
                    "&ptmis001="+UpdateForm.ptmis001.value.replace(/ /g,"+") +
                    "&admissno="+PatientLinks.admissno.value.replace(/ /g,"+")
    var returnValue = RSExecute(serverURL);
    if (returnValue.status!=0) {
       return false; }   
 }
 if(document.UpdateForm.atrexist.value=="1"){
   alert("MH Legal Status exists.  Check corresponding dates.");
 }
if (checkoverlap(document.UpdateForm.ptmis001.value,document.UpdateForm.ptmis002.value)==true){
  if(!isWhitespace(document.UpdateForm.ptmilsdn.value)){
    setDtime();
    if(!confirm("Warning: This is a Statistical Re-admission.  Select 'Ok' "+
     "to Update the linked Statistical Discharge Date/Time.  Select "+
     " 'Cancel' to return to the Supervisor page.")){
      return;
     }
   }
   UpdateForm.submit();
 }
}
function setDtime(){
   p=document.UpdateForm
   p.ptdsc001.value=p.ptmis001.value;
   if(p.ptmis002.value.substr(0,5)=="00:01"){
      p.ptmis002.value="00:02:00"
   }
   atime = new Date();
   atime.setHours(p.ptmis002.value.substr(0,2));
   atime.setMinutes(p.ptmis002.value.substr(3,2));
   atime.setSeconds(p.ptmis002.value.substr(6,2));
   dtime = new Date();
   dtime.setTime(atime.getTime()-60000);
   if(atime.getHours()<"10"){
     p.ptdsc002.value="0"+dtime.getHours()+":"+dtime.getMinutes()+":"
                    +dtime.getSeconds();
   } else {
     p.ptdsc002.value=dtime.getHours()+":"+dtime.getMinutes()+":"
                    +dtime.getSeconds();
   }
   checkTime(p.ptdsc002);
}
function setAtime(){
   p=document.UpdateForm
   p.ptmis001.value=p.ptdsc001.value;
   if(p.ptdsc002.value.substr(0,5)=="23:59"){
      p.ptdsc002.value="23:58:00"
   }
   dtime = new Date();
   dtime.setHours(p.ptdsc002.value.substr(0,2));
   dtime.setMinutes(p.ptdsc002.value.substr(3,2));
   dtime.setSeconds(p.ptdsc002.value.substr(6,2));
   atime = new Date();
   atime.setTime(dtime.getTime()+60000);
   if(atime.getHours()<"10"){
     p.ptmis002.value="0"+atime.getHours()+":"+atime.getMinutes()+":"
                    +atime.getSeconds();
   } else {
     p.ptmis002.value=atime.getHours()+":"+atime.getMinutes()+":"
                    +atime.getSeconds();
   }
   checkTime(p.ptmis002);
}


function UpdDisch() {
 f = document.UpdateForm;
 if (f.ptcnexdd.value == '1') {
   if (!isWhitespace(f.pmwoedat.value) &&
       !isWhitespace(f.ptdsc001.value)) {
     if (f.pmwoedat.value != f.ptdsc001.value) {
       alert("Discharge Date does not match 'Expected Discharge Date'.\n" +
             "Please enter 'Expected Discharge Date Change Details'.");
     }
   }
 }

 UpdateForm.updatety.value="5";
 if (document.UpdateForm.dschreas.value==""){
    alert("Reason is required.")
    return;
 }

 if(document.UpdateForm.atrexist.value=="1"){
   alert("MH Legal Status exists.  Check corresponding dates.");
 }
 var form = document.UpdateForm;
 var d = form.theadate.value.substring(0,16);
 var td = new Date(d.substring(0,4),parseInt(d.substring(4,6))-1,d.substring(6,8),
          d.substring(8,10),d.substring(11,13),d.substring(14,16));
 var dd = new Date(form.ptdsc001.value + " " + form.ptdsc002.value);
 td.setDate(td.getDate() + parseInt(form.theadate.value.substring(16,17)));
 if(td>dd){
   alert("Discharge date/time must be greater than or equal to "
   + td.toString().substring(0,20));
   return;
 }

 admissno=PatientLinks.admissno.value.replace(/ /g,"+")
 var serverURL = "../cgi-bin/patweb96.pbl?reportno=12&remoteno=10" +
        "&ptdsc001="+UpdateForm.ptdsc001.value.replace(/ /g,"+") +
        "&admissno="+admissno
 var returnValue = RSExecute(serverURL);
 if (returnValue.status!=0){
    return false;
 }
  if(!isWhitespace(document.UpdateForm.ptdslsdn.value)){
    setAtime();
    if(!confirm("Warning: This is a Statistical Discharge.  Select 'Ok' "+
     "to Update the linked Statistical Re-admission Date/Time.  Select "+
     " 'Cancel' to return to the Superisor page.")){
       return;
    }
  }
 updDisDelay();
 UpdateForm.submit();
}
function UpdCare() {
  if(validateMandatory(UpdateForm)){
//
    PatientFolder=document.UpdateForm.pmifoldr.value.substr(3,1);
    CareType=document.UpdateForm.trnacare.value.substr(14,3);
    CheckClaim=document.UpdateForm.chkclaim.value.substr(3,5);
    PTCNCOMF="%STANDARD.01.025.110.243.0.1"
    TAC=CheckClaim.search(/M/g);
    VET=CheckClaim.search(/V/g);
    WORK=CheckClaim.search(/W/g);
    if (PatientFolder != "4" && CareType=="3  ") {
       if (TAC == "-1" && VET == "-1" && WORK == "-1") {
// Show alert if not TAC,VET or Work claimn with a care type of family choice
         if(PTCNCOMF=="2") {
           alert("Patient folder conflict - " +
                 "Patient folder details will be updated.");
         }
       }
    }
    UpdateForm.reportno.value="8";
    UpdateForm.updatety.value="8";
    UpdateForm.submit();
  }
}
function AddProgram() {
  var p=document.UpdateForm;
  AddHealthFundProgram(p.urnumber,p.admissno);
}
function CheckPreAdm() {
  p = document.UpdateForm;

  if ((trim(p.astat.value)=="Pre-Admission") ||
      (trim(p.astat.value)=="Cancelled"))
  {
     DisableForm(p);
     p.churbutt.disabled=false;
     p.closbutt.disabled=false;
  }
}
function ShowHideLateDischargeReason() {
  f = document.UpdateForm;
  if (PromptLateDischargeReason()) {
    document.getElementById('LateDiscReason').style.display = "";
    document.getElementById('LateDiscReasonComm1').style.display = "";
    document.getElementById('LateDiscReasonComm2').style.display = "";
    AddClassName(f.ltdsresn,"Mandatory");
    LateDischargeReasonChanged();
  }
  else {
    document.getElementById('LateDiscReason').style.display = "none";
    document.getElementById('LateDiscReasonComm1').style.display = "none";
    document.getElementById('LateDiscReasonComm2').style.display = "none";
    RemoveClassName(f.ltdsresn,"Mandatory");
    RemoveClassName(f.ltdscom1,"Mandatory");
  }
}
function PromptLateDischargeReason() {
  f = document.UpdateForm;

  if (isWhitespace(f.ptcndptm.value)) {return false};
  if (SetDateYYYYMMDD(f.ptdsc001.value) == 
      SetDateYYYYMMDD(f.d_adate.value)) {return false};
  if (compareTimes(f.ptcndptm.value,f.ptdsc002.value))  {return false};
  if (f.BTInd11.value == 'E' || f.BTInd11.value == 'M') {return false};
  if (f.RTInd07.value == 'N') {return false};
  if (f.DDind01.value == 'D') {return false};

  return true;
}
function LateDischargeReasonChanged() {
  f = document.UpdateForm;
  var i = f.ltdsresn.selectedIndex;
  var ind04 = f.ltdsresn.options[i].value.substr(6,1)

  if (ind04 == 'O') {
    AddClassName(f.ltdscom1,"Mandatory");
  }
  else {
    RemoveClassName(f.ltdscom1,"Mandatory");
  }
}
function EnableCancelPreButton() {
  f = document.UpdateForm;
  f.btnCanPre.disabled = true; 
  if (trim(f.astat.value) == "Pre-Admission") {
    f.btnCanPre.disabled = false;
  }
}
function CancelPreadmission() {
  f = document.UpdateForm;
  linkURL="patweb89.pbl?reportno=01&template=010&urnumber=" + f.urnumber.value +
          "&admissno=" + f.admissno.value;
  DFrameLink(linkURL,100,100,550,100);
}
function CancelPreAdmissionButtonClicked() {
  DFrameExitRefresh();  
}
function updDisDelay() {
  var clirdydd = document.UpdateForm.mrfddate; 
  var rsndd = document.UpdateForm.vsxdc014;
  if (!isWhitespace(clirdydd.value)) {
    if (isWhitespace(rsndd.value)) {
      alert("'Reason for Discharge Delay' should have a reason if " +
            "'Clinically Ready for Discharge Date' has a date entered.");
      return;
    }
  }
}
function disDelay(cliDis) {
  if (!isWhitespace(cliDis.value)) {
    document.getElementById("rsndisde").style.display = "";
    document.getElementById("vsxdc014").className = "Mandatory";
    document.getElementById("vsxdc014").disabled = false;
  } else {
    document.getElementById("rsndisde").style.display = "none";
    document.getElementById("vsxdc014").className = "";
    document.getElementById("vsxdc014").disabled = true;
    document.getElementById("vsxdc014").value = "";
  }
}
function disMsgEMRLinkd(){

  if (document.getElementById("d_ptmis009").value.substr(5,1)== "4" &&
      !isWhitespace(document.getElementById("d_emvipadm").value)){
       document.getElementById("trncancp").disabled=true;
       document.getElementById("EMRLinkFieldDIV").innerHTML=
       document.getElementById("EMRLinkFieldSPAN").innerHTML;
  }
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);CheckPreAdm();ShowHideLateDischargeReason();
              EnableCancelPreButton();disMsgEMRLinkd();
              ShowInsertMovementButton();">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Supervisor Error Corrections
</span>
<div id=PageBodySection>

<form name=UpdateForm action="patweb96.pbl" method=get style="margin:0">
<input type=hidden name=reportno value=01>
<input type=hidden name=template value=42>
<input type=hidden name=nextpage value="0">
<input type=hidden name=updatety value="0" >
<input type=hidden name=atrexist value="%PATWEB98.01.399.011">
<input type=hidden name=remoteno value=" "> 
<input type=hidden name=redirect value="%PATWEB98.01.001.patweb98.01.002">
<input type=hidden name=urnumber value="%PATWEB98.01.003">
<input type=hidden name=admissno value="%PATWEB98.01.081">
<input type=hidden name=caretype value="%PATWEB98.01.113.1">
<input type=hidden name=pmifoldr value="%PATWEB98.01.086.079.3">
<input type=hidden name=chkclaim value="%PATWEB98.01.126.3">
<input type=hidden name="d_ptmis009" id="d_ptmis009" value="%PATWEB98.01.110.3">
<input type=hidden name=d_ptmis010 value="%PATWEB98.01.111.1">
<input type=hidden name=d_ptmis027 value="%PATWEB98.01.126.1">
<input type=hidden name=d_ptmis013 value="%PATWEB98.01.114.0">
<input type=hidden name=d_ptmis014 value="%PATWEB98.01.115.0">
<input type=hidden name="d_emvipadm" id="d_emvipadm" value="%PATWEB98.01.364">
<input type=hidden name=ptrgm001 value="%PATWEB98.01.838. 1">
<input type=hidden name=ptrgm002 value="%PATWEB98.01.838. 2">
<input type=hidden name=ptrgm003 value="%PATWEB98.01.838. 3">
<input type=hidden name=bdmnindc value="1">
<input type=hidden name=astat value="%PATWEB98.01.104">
<input type=hidden name=admfimex value="%PATWEB98.01.884.003" />
<input type=hidden name=dscfimex value="%PATWEB98.01.884.004" />
<input type=hidden name="ptcnhdps" value="%STANDARD.01.025.080.250.1.1" />
<input type=hidden name=ptmilsdn value="%PATWEB98.01.199.018">
<input type=hidden name=ptdslsdn value="%PATWEB98.01.230">
<input type=hidden name="ptcnwrun" id="ptcnwrun" 
 value="%STANDARD.01.025.123.207.0.1" />
<input type=hidden name="theadate" value="%PATWEB98.01.652">
<input type=hidden name=ptcnexdd id=ptcnexdd
       value="%STANDARD.01.025.125.236.0.1">
<input type=hidden name=pmwoedat id=pmwoedat value="%PATWEB98.01.825.4">
<input type=hidden name=d_adate id=d_adate value="%PATWEB98.01.102">
<input type=hidden name=atime id=atime value="%PATWEB98.01.103">
<input type=hidden name=ptcndptm id=ptcndptm value="%PATWEB98.01.399.022">
<input type=hidden name=BTInd11 id=BTInd11 value="%PATWEB98.01.399.023">
<input type=hidden name=RTInd07 id=RTind07 value="%PATWEB98.01.399.024">
<input type=hidden name=DDind01 id=DDind01 value="%PATWEB98.01.399.025">
<input type=hidden name=formatcn>
<table align=center cellspacing=0 cellpadding=3 border=0 width=95%>
<tr><td class=DataLabel>Admission Date</td>
    <td class=DataField>
    <input type=text size=12 name=ptmis001 class="Mandatory Date"
     value="%PATWEB98.01.102" title="Admission Date">
    <a href='javascript:SetCurrentDateTime(UpdateForm.ptmis001,null)'>
    <img src="../images/DateTimeStamp.gif" class=Icon></a>
    <a href='javascript:DateLookupFrame(UpdateForm.ptmis001)'>
    <img src="../images/DateLookup.gif" class=Icon></a>
    </td>
    <td class=DataLabel>%STANDARD.01.017.PC
    <select name=admnreas class=mandatory>
     <option></option>
      %STANDARD.01.007.PC
     </select>

    </td></tr>

<tr><td class=DataLabel>Admission Time</td>
    <td class=DataField>
    <input type=text size=12 name=ptmis002 class="Mandatory"
     value="%PATWEB98.01.103" title="Admission Time">
    <a href='javascript:SetCurrentDateTime(null,UpdateForm.ptmis002)'>
    <img src="../images/DateTimeStamp.gif" class=Icon></a>
    <a href='javascript:TimeLookupFrame(UpdateForm.ptmis002)'>
    <img src="../images/TimeLookup.gif" class=Icon></a>
    </td><td>
    <input type=button class="button" value="Update" 
     id="pat98sub1" onclick="tempDisable(this);UpdAdmit();"></td>
    </tr>
<tr><td colspan=5><hr width=100%></td></tr>

<tr><td class=DataLabel>Discharge Date</td>
    <td class=DataField>
    <input type=text size=12 name=ptdsc001 class="PastDate"
     value="%PATWEB98.01.201" title="Discharge Date"
     onchange="ShowHideLateDischargeReason();">
    <a href='javascript:SetCurrentDateTime(UpdateForm.ptdsc001,null)'>
    <img src="../images/DateTimeStamp.gif" class=Icon></a>
    <a href='javascript:DateLookupFrame(UpdateForm.ptdsc001)'>
    <img src="../images/DateLookup.gif" class=Icon></a>
    </td>
    <td class=DataLabel>%STANDARD.01.017.PC
    <select name=dschreas class=mandatory>
     <option></option>
      %STANDARD.01.007.PC
     </select>
    </td></tr>

<tr><td class=DataLabel>Discharge Time</td>
    <td class=DataField>
    <input type=text size=12 name=ptdsc002
     value="%PATWEB98.01.202" title="Discharge Time"
     onblur="checkTime(this);ShowHideLateDischargeReason();">
    <a href='javascript:SetCurrentDateTime(null,UpdateForm.ptdsc002)'>
    <img src="../images/DateTimeStamp.gif" class=Icon></a>
    <a href='javascript:TimeLookupFrame(UpdateForm.ptdsc002)'>
    <img src="../images/TimeLookup.gif" class=Icon></a>
    </td><td>
    <input type=button class="button" value="Update" 
     id="pat98sub2" onclick="tempDisable(this);UpdDisch();"></td>
    </tr>
<tr id=LateDiscReason>
    <td class=DataLabel>Reason for Late Discharge</td>
    <td>
      <select name=ltdsresn id=ltdsresn title="Reason for Late Discharge"
       class="SelectBig" onchange="LateDischargeReasonChanged();">
      <option></option>
       %PATWEB98.01.399.021.015.2
      </select>
    </td>
</tr>
<tr id=LateDiscReasonComm1>
    <td class=DataLabel>Reason for Late Discharge Comments</td>
    <td>
        <input type=text size=45 maxlength=40 name=ltdscom1 id=ltdscom1
         title="Reason for Late Discharge Comments 1"
         value="%PATWEB98.01.399.021.016">
    </td>
</tr>
<tr id=LateDiscReasonComm2>
    <td>&nbsp;</td>
    <td>
      <input type=text size=45 maxlength=40 name=ltdscom2 id=ltdscom2
        title="Reason for Late Discharge Comments 2"
        value="%PATWEB98.01.399.021.017">
    </td>
</tr>
<tr><td class=DataLabel>Clinically Ready for Discharge Date</td>
    <td><input type=text size=15 maxlength=12 name=mrfddate
         id=mrfddate title="Clinically Ready for Discharge Date"
         onblur="checkDate(this,'Date');disDelay(this);" class="Date"
         value="%PATWEB98.01.656" >
        <img notab src="../images/DateTimeStamp.gif" class=Icon
             alt="Current"
             onclick="SetCurrentDateTime(mrfddate,null);">
        <img notab src="../images/DateLookup.gif" class=Icon
             alt="Calendar" date="UpdateForm.mrfddate"></td></tr>
<tr id=rsndisde style="display: none;">
    <td class=DataLabel>Reason for Discharge Delay</td>
    <td><select name=vsxdc014 id=vsxdc014 title="Reason for Discharge Delay">
        <option></option>
        %STANDARD.01.007.z1
        </select></td></tr>
<tr><td colspan=5><hr width=100%></td></tr>

<!-- HPS BLR(SAC) Code Starts Here -->
<tr>
    <td class=DataLabel width="25%">%STANDARD.01.017.CC</TD>
    <tD>
    <select name=trnacare>
     <option></option>
      %PATWEB98.01.113.2
     </select>
</tr>
<tr><td class=DataLabel>Date/Time of Change </td>
     <td><select name=trandate class=Mandatory title="date of change">
      %PATWEB98.01.818
     </select>
     <input type=text size=8 name=trantime class=Mandatory 
      title="Time of Change">
     <img src="../images/DateTimeStamp.gif" class=Icon
      onclick="SetCurrentDateTime(null,UpdateForm.trantime);">
     <img src="../images/TimeLookup.gif" class=Icon
      onclick="TimeLookupFrame(UpdateForm.trantime);">
     </td><td>
     <input type=button class="button" value="Update" 
      id="pat98sub3" onclick="tempDisable(this);UpdCare();"></td>
     </tr>
<tr><td colspan=5><hr width=100%></td></tr>
<tr><td class=DataLabel>%STANDARD.01.017.PC</TD>
    <td>
    <select name=trnureas class=mandatory>
     <option></option>
      %STANDARD.01.007.PC
     </select>
  </td><td>
  <input type=button Value="Unadmit" class="button" 
   id="pat98sub5" onclick="tempDisable(this);Unadmit();">
</td></tr>

<tr><td>Cancel Pre-admission</td>
     <td><input type=checkbox value="1" id=trncancp name=trncancp>
     <td>
     <div id=EMRLinkFieldDIV></div> </td>
   </td>  
</tr>

<span id=AddProgram style="display: none;">
<input type=button Value="Add Program" class="button"
    onclick='AddProgram();'>
</span>

</tr>
<tr><td colspan=5><hr width=100%></td></tr>
<tr><td class=DataLabel>%STANDARD.01.017.PC</TD>
    <td>
    <select name=ddatreas class=mandatory>
     <option></option>
      %STANDARD.01.007.PC
     </select>
  </td><td>
  <input type=button Value="Undischarge" class="button" 
   id="pat98sub4" onclick="tempDisable(this);Undischarge();">
</td></tr>

<tr><td colspan=6><hr width=100%></td></tr>
<!--HPS Code Ends Here-->
<tr>
 <td colspan=5 align=center>
<!-- HPS BLR(SAC)Code Starts Here -->
  <input type=button Value="Cancel Movement" class=Bigbutton 
   onclick='CancelMV("%PATWEB98.01.003","%PATWEB98.01.081")'>
<!--HPS Code Ends Here-->

  <span id=InsertMovementField></span>
  <input type=button Value="Change U/R" class="button" name="churbutt"
   onclick='showChangeUR("%PATWEB98.01.001.patweb98.01.041");'>
  <input type=button Value="GST Accom." class="button" 
   onclick='ShowGST("%PATWEB98.01.001.patweb71.03.005")'>
  <input type=button Value="Close" class="button" name="closbutt"
   onclick="DFrameExit();">
 </td>
</tr>

<tr>
 <td colspan=5 align=center>
  <input type=button value="" name=changecb style="cursor:pointer"
   onclick='ShowClm("%PATWEB98.01.001.patweb78.04.001")'>
  <input type=button Value="Change Health Fund After Invoiced"
   style="cursor:pointer"
   onclick='ShowHF("%PATWEB98.01.001.patweb78.04.003")'>
  <input type=button Value="Cancel Pre-admission" style="cursor:pointer"
   name=btnCanPre id=btnCanPre
   onclick="CancelPreadmission();">
  <div id=ADDProgramField></div>
 </td>
</tr>

</table>
</form>
</div>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=035>
<input type=hidden name=urnumber value="%PATWEB98.01.003">
<input type=hidden name=admissno value="%PATWEB98.01.081">
</form>

<span id=EMRLinkFieldSPAN style="display:none">
This option is not available for EMR Linked visits
</span>

<span id=AddProgram style="display: none;">
<input type=button Value="Add Program" class="button"
    onclick='AddProgram();'>
</span>
<span id=InsertMovement style="display: none;">
<input type=button class=Bigbutton value="Insert Movement" name=InsMovButt
   id=InsMovButt
   onclick='InsertMovementClicked();'>
</span>
<span id=hideInsertMovement style="display: none;">
</span>

<script type="text/javascript">
  UpdateForm.changecb.value="Change " + trim('%STANDARD.01.017.CL') +
                            " After Invoiced"
 ptcnhdps="%STANDARD.01.025.080.250.1.1"
 if(ptcnhdps!="1"){
   ADDProgramField.innerHTML=document.getElementById('AddProgram').innerHTML;
 }
 disDelay(document.getElementById('mrfddate'));
 for (var j=0; j < document.getElementById('vsxdc014').length; j++) {
   if (document.getElementById('vsxdc014').options[j].value.substr(0,3)
       =="%PATWEB98.01.657") {
       document.getElementById('vsxdc014').selectedIndex=j;
   }
 }

function ShowInsertMovementButton() {
  ptcneibm="%STANDARD.01.025.130.068.1.1"
  if(ptcneibm=="1"){
    InsertMovementField.innerHTML=InsertMovement.innerHTML;
    p.InsMovButt.disabled=false;
  }
  else {
    InsertMovementField.innerHTML=hideInsertMovement.innerHTML;
  }
}

function InsertMovementClicked(){
  f = document.UpdateForm;
  var serverURL   = "../cgi-bin/comweb81.pbl?reportno=71" +
                    "&valdcode=" + f.admissno.value.replace(/ /g,"+")
  var returnValue = RSExecute(serverURL);
  if (returnValue.status != 0) { return false;}
  ReturnValue = returnValue.return_value.split("|");

  if (ReturnValue[0] == "1") {
    alert("Patient has been Invoiced. \n" +
          "Please credit invoice in order to proceed");
    return false;
  }

  parent.location.href="patweb98.pbl?reportno=10&template=004&urnumber=" + 
                       f.urnumber.value + "&admissno=" + f.admissno.value;
  DFrameExit();
}

</script>

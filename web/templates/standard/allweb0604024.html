Content-Type: text/html
Cache-Control: no-cache

<!DOCTYPE html>
%START.OF.PAGE
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="ServerID" content="%STANDARD.01.004">
<meta name="ServerName" content="%STANDARD.01.005">
<meta name="ServerVersion" content="%STANDARD.01.006">
<meta name="ServerOption" content="%STANDARD.01.002">
<meta name="ServerTemplate" content="%STANDARD.01.003">
<meta name="TemplateFile" content="allweb0604024.html">
<meta name="TemplateVersion" content="V12.00.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<link rel="stylesheet" href="../html/standard.css" type="text/css">
<link rel="stylesheet" href="../html/custom.css" type="text/css">
</head>

<body onload="RePlot();" style="position:absolute; top:-20px" onunload="window.opener.location.reload();">
<h4 style='text-align:center;width:100%'>Assessment Graphs</h4>

<form name=UpdateForm method=post action=allweb06.pbl>
<input type=hidden name=urnumber value="%ALLWEB06.04.003">
<input type=hidden name=admissno value="%ALLWEB06.04.081">
<input type=hidden name=mhhon001 value="%ALLWEB06.04.101">
<input type=hidden name=mhhon002 value="%ALLWEB06.04.102">
<input type=hidden name=reportno value=4>
<input type=hidden name=template value="008">
<input type=hidden name=updttype value=" ">

<table align=center border=0><tr align=center><td align=left>
<table border=0 width=700>
  <tr>
    <td width=50>&nbsp;</td>
    <td class=DataField>%ALLWEB06.04.002</td>
    <td class=DataField>NHI: %ALLWEB06.04.003</td>
    <td class=DataField colspan=2>Date of Birth: %ALLWEB06.04.020</td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td class=DataLabel>Responsible HCP</td>
    <td class=DataField colspan=3>%ALLWEB06.04.109.1</td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td class=DataLabel>Case Team</td>
    <td class=DataField colspan=3>%ALLWEB06.04.110.1 </td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td class=DataLabel>%STANDARD.01.017.ss</td>
    <td class=DataField>%ALLWEB06.04.107.0</td>
    <td class=DataLabel>%STANDARD.01.017.hf</td>
    <td class=DataField>%ALLWEB06.04.122.0</td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td class=DataLabel>Collection Date</td>
    <td class=DataField>%ALLWEB06.04.106 </td>
    <td class=DataLabel>&nbsp;</td>
    <td class=DataField>&nbsp;</td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td class=DataLabel>%STANDARD.01.017.hp</td>
    <td class=DataField>%ALLWEB06.04.108.0</td>
    <td class=DataLabel>&nbsp;</td>
    <td class=DataField>&nbsp;</td>
  </tr>
  <tr>
    <td colspan=5 align=center id="buttonrow">
      <input type=button value=Print class="button" onclick="HideAndPrint()">
      <input type=button value=Close class="button" onclick="window.close()">
    </td>
  </tr>  
</table>
</table>
</form>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value="004">
<input type=hidden name=urnumber value="%ALLWEB06.04.003">
<input type=hidden name=admissno value="%ALLWEB06.04.081">
<input type=hidden name=MenuType value="%ALLWEB06.04.088">
<input type=hidden name=webuseid value="%STANDARD.01.008">
</form>

<table align=center border=0><tr align=center><td align=left>

<div style='width:100%;text-align:left'>
<canvas id="wheelGraph" width=725px height=550px style="border:1px solid #000000;"></canvas>
<br><br>

<script type="text/javascript">
// om1-om5 (outcome measures' arrays)
    %ALLWEB06.04.195.32.1
var omArrays=[om1,om2,om3,om4,om5];
var alignmentArray = ["right","center","left"];
var labelArray= ["1 Alcohol days","2 Alcohol Amounts","3 Cannabis","4 Amphetamines","5 Opioids",
                 "6 Sedatives","7 Other 1","7 Other 2","7 Other 3","8 Tobacco",
                 "10 Injecting and Sharing","12 Physical Health","13 Mental Health","14 Relationships",
                 "15 Prob. Work/Other","16 Employment","17 Housing","18 Illegal Activity"];
// Hardcore trigonometry calculations, if you didnt pay
// attention at school, mess with these at your own peril
// Because of the canvas rotations, changing order of the
// drawing will potentially mess up the layout.
// ------------------------------------------------------------------------------
// CONSTANTS  
var canvas = document.getElementById('wheelGraph');
var ctx = canvas.getContext('2d');
var rowCount = 1; //Number of rows (1-5)
var lineStyle = [[4,4],[10,0],[10,2],[2,2],[2,2]];
var lineColour = ['#44aa44','#5555ff','#ff3333','#ffff00','#000000'];
var deg = Math.PI/180; // Radians -> Degrees constant
var centreX = (canvas.width)/2;
var centreY = (canvas.height-75)/2;  // -75 movesgraph up to fit legend underneath the graph
var scaling = 0.80;
var itemCount = 18;
var ratingIncrements = 6; // 0-5 (not at all - extremely)
var angleIncrement = 360/itemCount;
var inverseAngle = (180-angleIncrement)/2;
var tangentOffset = centreY*scaling*(Math.sin(inverseAngle*deg));
var tangentLength = 0.5*centreY*scaling*(Math.sin(angleIncrement*deg))/(Math.sin(inverseAngle*deg))/ratingIncrements;
ctx.translate(centreX,centreY); //Make canvas centre be point (0,0);

// Add the drug description to questions 7a,c,e if they were completed.
// For multiple graphing, assuming that the drugs will be consistent across records
for(j=0; j<3; j++){
  if(omArrays[0][j+18]!="") labelArray[j+6] = "7 "+omArrays[0][j+18];
}

function RePlot(){

  ctx.clearRect (-centreX, -centreY, centreX*2, centreY*2);
  ctx.beginPath();
  ctx.strokeStyle = '#aaaaaa';
  /*try{
      ctx.setLineDash([0]);
  }
  catch(Exception e){} //only available in IE11*/
  ctx.lineWidth=0.5;

  // Draw static radial lines
  for(i=0;i<itemCount; i++){
    ctx.moveTo(0,0);
    ctx.lineTo(0,-centreY*scaling);
    ctx.stroke();
    ctx.rotate(angleIncrement*deg);
  }

  // Draw text labels using the Sine Rule to work out positions: 
  // A/Sin A = B/Sin B = C/Sin C
  var aSinA = (10*tangentLength)/(Math.sin(90*deg));
  for(i=0; i<itemCount; i++){
    var x = aSinA*(Math.sin((180-(i*angleIncrement))*deg));
    var y = aSinA*(Math.sin((-90+(i*angleIncrement))*deg));
    // Next three lines work out & set the text alignment
    var sineSign = (i%(itemCount/2)) && Math.sin(angleIncrement*i*deg)/Math.abs(Math.sin(angleIncrement*i*deg));
    var align = Math.ceil(Math.abs(Math.sin(angleIncrement*i*deg)))*sineSign+1;
    ctx.textAlign = alignmentArray[align];
    ctx.fillText(labelArray[i], x*90*scaling/angleIncrement,y*90*scaling/angleIncrement);
  } 
 
  // Back to starting position
  ctx.rotate(0.5*angleIncrement*deg);

  // Draw static interconnecting lines
  for(i=0; i<itemCount; i++){
    for(j=1; j<=ratingIncrements; j++){
      ctx.moveTo(-(j*tangentLength),-tangentOffset*(j/ratingIncrements));
      ctx.lineTo((j*tangentLength),-tangentOffset*(j/ratingIncrements));
      ctx.stroke();	   
    }
    ctx.rotate(angleIncrement*deg);
  }

  // Back to starting position for plotting
  ctx.rotate(-0.5*angleIncrement*deg);
  ctx.closePath();

  // draw labels 0-5
  ctx.fillStyle='#000000';
  ctx.font = "10pt Arial";
  for(i=0; i<6; i++){
      ctx.fillText(i,-3,3-centreY*scaling*((i+1)/ratingIncrements));
      ctx.stroke();
  }
  ctx.fillStyle = '#aaaaaa';

  // Draw legend
  ctx.lineWidth=2;
  ctx.fillStyle='black';
  ctx.font="9pt Arial";
  for(i=0; i<omArrays.length; i++){
    if(omArrays[i][21]==undefined) break;
    ctx.strokeStyle = lineColour[i];
    //try to use line styles (IE11 only)
    try{
        ctx.setLineDash(lineStyle[i]);
    } //IE 10 and below throws exception
    catch(e){}

    ctx.textAlign = 'start';
    ctx.fillText(omArrays[i][21] + " - " + omArrays[i][28],70-centreX*0.95,(15+centreY*0.95)+(15*i));
    ctx.beginPath(); 
    ctx.moveTo(-centreX*0.95,(15+centreY*0.95)+(16*i)-4);
    ctx.lineTo(50-centreX*0.95,(15+centreY*0.95)+(16*i)-4);
    ctx.stroke();
  }
 
  // Start Plotting points/drawing lines
  for(j=0; j<omArrays.length; j++){

    if(omArrays[j].length==0) break;

    ctx.beginPath();
    ctx.lineWidth=2;

    //try to use line styles (IE11 only)
    try{
        ctx.setLineDash(lineStyle[j]);
    } //IE 10 and below throws exception
    catch(e){}

    ctx.fillStyle=ctx.strokeStyle = lineColour[j];
    var currentArray = omArrays[j];
    var val = -centreY*scaling*((currentArray[0]+1)/ratingIncrements);
    ctx.moveTo(0,val);
    ctx.fillRect(-4,val-4,8,8);  // Draw square point

    for(i=1; i<itemCount; i++){
      ctx.rotate(angleIncrement*deg);
      val = -centreY*scaling*((currentArray[i]+1)/ratingIncrements);
      ctx.lineTo(0,val);
      ctx.fillRect(-4,val-4,8,8);
      ctx.stroke();
    }
    ctx.closePath(); 
    ctx.stroke();
    ctx.rotate(angleIncrement*deg);
  }
}

function HideAndPrint(){
  row = document.getElementById("buttonrow");
  row.style.visibility = "hidden";
  window.print();
  row.style.visibility = "";
}
</script>

<table border=1 width=725px>
  <tr>
    <td colspan=2>&nbsp;</td>
    <script type="text/javascript">
   
    for(i=0; i<omArrays.length && omArrays[i].length!=0; i++){
        document.write("<td>"+omArrays[i][21]+"</td>");
    }
    </script>
  </tr>

  <tr>
    <td colspan=2>Q7 Other Drug (highest days of use)</td>
    <script>
    x7b = parseInt("%ALLWEB06.04.195.10.0");
    x7d = parseInt("%ALLWEB06.04.195.12.0");
    x7f = parseInt("%ALLWEB06.04.195.14.0");

    currentMax = "%ALLWEB06.04.195.10.0";
    currentMaxLabel = 18; 
 
    if(x7d>x7b && x7d>x7f){
       currentMaxLabel = 19;
    }    
    else if(x7f>x7b && x7f>x7d){
       currentMaxLabel = 20;
    }

    for(i=0; i<omArrays.length && omArrays[i].length!=0; i++){
        document.write("<td>"+omArrays[i][currentMaxLabel]+"</td>");
    }
    </script>
  </tr>

  <tr>
    <td colspan=1 rowspan=3>Q9 Main substances of concern</td><td>1</td>
    <script>
    for(i=0; i<omArrays.length && omArrays[i].length!=0; i++){
        document.write("<td>"+omArrays[i][22]+"</td>");
    }
    </script>
  </tr>

  <tr>
    <td>2</td>
    <script>
    for(i=0; i<omArrays.length && omArrays[i].length!=0; i++){
        document.write("<td>"+omArrays[i][23]+"</td>");
    }
    </script>
  </tr>

  <tr>
    <td>3</td>
    <script>
    for(i=0; i<omArrays.length && omArrays[i].length!=0; i++){
        document.write("<td>"+omArrays[i][24]+"</td>");
    }
    </script>
  </tr>

  <tr>
    <td colspan=2>Q19 Recovery (1-10)</td>
    <script>
    
    for(i=0; i<omArrays.length && omArrays[i].length!=0; i++){
        document.write("<td>"+omArrays[i][26]+"</td>");
    }
    </script>
  </tr>

  <tr>
    <td colspan=2>Q20 Satisfaction</td>
    <script>
    q20 = ["Not Answered / Missing","Not at all","Slightly","Moderately","Considerably","Extremely"];
    for(i=0; i<omArrays.length && omArrays[i].length!=0; i++){
        omArrays[i][27] = omArrays[i][27]%99; 
        document.write("<td>"+q20[omArrays[i][27]]+"</td>");
    }
    </script>
  </tr>
</table>
<br>

<table><tr><td align=left>Plan/Goals<td><tr></table>

<table border=1 width=725px height=100px><tr width=100%><td width=100%></td>
</tr></table>

</div>
</td>
</tr>
</table>
<br><br>
</body>


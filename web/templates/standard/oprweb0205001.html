<meta name="TemplateVersion" content="V12.00.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/TableSort.js"></script>
<script type="text/javascript">
//----------------------------------------------------------------------------
// Columns Available
//  0 - HTML Link
//  1 - Patient Folder (type)
//  2 - Patient Name
//  3 - Visit Number
//  4 - Receiver Deletion Date (ccyymmdd)
//  5 - Record Type
//  6 - Record Source
//  7 - Theatre (checkbox)
//  8 - Theatre Updated flag
//  9 - Coding (checkbox)
// 10 - Coding Updated flag
// 11 - Billing (checkbox)
// 12 - Billing Updated flag
// 13 - Delete Record fields (checkbox and deletion comments input field)
// 14 - Delete Record flag
// 15 - Record Status
// 16 - Record ID (3 char)
// 17 - Record Key (KEY14)
// 18 - Item Number
// 19 - Quantity
//---------------------------------------------------------------------------
function InitTable() {
  document.title="Cancelled CMBS and Miscellaneous Items";

  t = new Table(1,0,2,"100%","center",35,35);
  t.addColumn("Patient","ImageText",2,2,"left","PatientFolder","0",180,"1")
  t.addColumn("Visit","String",3,3,"left","","",50)
  t.addColumn("Record Type","String",5,5,"left","","",70)
  t.addColumn("Item Number","String",18,18,"left","","",60)
  t.addColumn("Quantity","String",19,19,"left","","",40)
  t.addColumn("Record Source","String",6,6,"left","","",150)
  t.addColumn("Theatre","String",7,8,"center","","",50)
  t.addColumn("Coding","String",9,10,"center","","",50)
  t.addColumn("Billing","String",11,12,"center","","",50)
  t.addColumn("Delete Record","String",13,14,"left","","",150)
  t.addColumn("Record Status","String",15,15,"left","","",60)
  AddTableRows();
  TableOutput(0,1);    // Order Column,Asc Dsc
}

function PatientLink(URNo,Visit) {
  LinkForm.urnumber.value = URNo;
  LinkForm.admissno.value = Visit;
  LinkForm.submit();
}

function InputChargeLink(Key) {
  linkurl="oprweb06.pbl?reportno=3&template=4&uniqueky=" + 
          Key.replace(/ /g,"+");
  location.href=linkurl;
}

function TheatreSelect(ChkBox) {
  CheckboxSelect(ChkBox);
  UpdateRecord(ChkBox, '1');
}

function CodingSelect(ChkBox) {
  CheckboxSelect(ChkBox);
  UpdateRecord(ChkBox, '2');
}

function BillingSelect(ChkBox) {
  CheckboxSelect(ChkBox);
  UpdateRecord(ChkBox, '3');
}

function CheckboxSelect(ChkBox) {
  if (ChkBox == undefined)
    return false;

  ValidateSelection(ChkBox);
}

function ValidateSelection(ChkBox) {
  var chkbox, id;
  var index = ChkBox.name.substr(5,3);

  id = 'chkT_' + index;
  chkbox = document.getElementById(id);
  if (chkbox.name != ChkBox.name) {
    if (chkbox.checked)
      return;
  }

  id = 'chkC_' + index;
  chkbox = document.getElementById(id);
  if (chkbox.name != ChkBox.name) {
    if (chkbox.checked)
      return;
  }
  
  id = 'chkB_' + index;
  chkbox = document.getElementById(id);
  if (chkbox.name != ChkBox.name) {
    if (chkbox.checked)
      return;
  }

  // Disable the 'Delete Record' fields if no other checkboxes have been ticked
  DisableDeleteFields(index, ChkBox.checked);
}

function DisableDeleteFields(Index,Disabled) {
  var chkbxFld = document.getElementById('chkD_' + Index);
  var inputFld = document.getElementById('inpt_' + Index);

  if (!Disabled) {
    chkbxFld.disabled = false;
    inputFld.disabled = true;
    return;
  }

  chkbxFld.disabled = Disabled;
  inputFld.disabled = Disabled;
}

function DeleteSelect(ChkBox) {
  var index = ChkBox.name.substr(5,3);
  var disable = ChkBox.checked;

  DisableField('chkT_' + index,disable);
  DisableField('chkC_' + index,disable);
  DisableField('chkB_' + index,disable);

  var inputFld = document.getElementById('inpt_' + index);
  var newClass="";
  if (ChkBox.checked) {
    newClass = "Mandatory";
    inputFld.disabled = false;
    inputFld.className = "Mandatory";
    inputFld.focus();
  }
  else {
    inputFld.value = "";
    inputFld.className = "";
    inputFld.disabled = true;

    // Remote script call to set Removal Status to '0' - New Entry
    UpdateRecord(ChkBox, '4');
  }
}

function DisableField(ElemID, Disabled) {
  document.getElementById(ElemID).disabled = Disabled;
}

function onBlurComment(InputFld) {
  if (InputFld == undefined)
    return false;

  // Replace any double-quotes with single-quotes (') to save into our file
  ValidateEscapeChars(InputFld);

  if ( (InputFld.className.indexOf("Mandatory") != -1) &&
       (isWhitespace(InputFld.value)) ) {
    alert("Deletion Comments is mandatory.");
    FocusDelay(InputFld);
    return false;
  }

  // Remote script call to set Removal Status to '1' if checkbox ticked
  var ChkBox = document.getElementById('chkD_' + InputFld.name.substr(5,3));
  if (ChkBox.checked) {
    UpdateRecord(ChkBox, '4', InputFld.value);
  }
  return true;
}

function UpdateRecord(ChkBox, UpdType, UpdText) {
  if (ChkBox == undefined || UpdType == undefined)
    return;

  var updtkey = GetUpdateKey(ChkBox);  // record key value
  if (isWhitespace(updtkey))
    return;

  var updtval = (ChkBox.checked)? "1" : "0";
  var serverURL = "../cgi-bin/oprweb02.pbl?reportno=6&remoteno=1" + 
                  "&updatkey=" + updtkey.replace(/ /g,"+") +
                  "&updattyp=" + UpdType +
                  "&updatval=" + updtval;

  if (UpdText != undefined) {
    // Append update text to remote script string
    serverURL += "&updattxt=" + UpdText;
  }

  // Remote script call to update corresponding record
  var returnValue = RSExecute(serverURL);
  if (returnValue.return_value == "1") {
    alert("Failed to update the record on the server!");
  }
}

function GetUpdateKey(ChkBox) {
  if (ChkBox == undefined)
    return "";

  var indexVal = ChkBox.name.substr(5,3);
  for (i=0; i < t.rows.length; i++) {
    if (t.rows[i][16] == indexVal) {
      return t.rows[i][17];
    }
  }

  return "";
}

function Refresh() {
  SelectPeriod.submit();
}

</script>

<style type="text/css">
button.ImgButton {
  font-size:8pt;
  width:80px;
  height:28px;
  cursor: pointer;
}
</style>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);InitTable();">
<div id=HeadingSection>
<form name=SelectPeriod action=oprweb02.pbl method=get style="margin:0">
<input type=hidden name=reportno value=05>
<input type=hidden name=template value=001>
<input type=hidden name=viewtype value="%OPRWEB02.05.002">
<input type=hidden name=redirect value="oprweb02.pbl?reportno=5&template=1">
<input type=hidden name=nextpage value="">

<table align=center cellpadding=3 cellspacing=0 bgcolor=#CCCCCC border=0 
 width=100%>
<tr>
  <td width=10%>&nbsp;</td>
  <td class=DataLabel>Record Source&nbsp;&nbsp;
    <select name=filtsrce title="Action type" onchange="Refresh();">
      <option value=" ">All</option>
      <option value="1">Invoice Raised, manual intervention required</option>
      <option value="2">No Invoice Raised, item removed by system</option>
    </select>
  </td>
  <td class=DataLabel>Record Status&nbsp;&nbsp;
    <select name=filtstat title="Action type" onchange="Refresh();">
      <option value="0">New Entry</option>
      <option value="1">Record Deleted</option>
      <option value="2">Record Removed</option>
    </select>
  </td>
  <td class=DataLabel>
    <button class=BigButton onclick="Refresh()">
      <a>Refresh&nbsp;
        <img src="../images/RefreshIcon.gif" alt="Refresh Icon" 
         class=Icon>
      </a>
    </button>
  </td>
  <td align=right>
    <input type=button value="<<" class=SmallButton
     onclick='location.href="%OPRWEB02.05.006"'>
    %OPRWEB02.05.005
    <input type=button value=">>" class=SmallButton
     onclick='location.href="%OPRWEB02.05.007"'>
    <a href='javascript:SelectDateFrame();'>
    <img src="../images/DateLookup.gif" 
     alt="Select Date" class=Icon></a>
    <a href='javascript:SelectView("0");'>
    <img src="../images/DayIcon.gif" 
     alt="View Today" class=Icon></a>
    <a href='javascript:SelectView("1");'>
    <img src="../images/WeekIcon.gif" 
     alt="View This Week" class=Icon></a>
    <a href='javascript:SelectView("2");'>
    <img src="../images/MonthIcon.gif" 
     alt="View This Month" class=Icon></a>
  </td>
</tr>
</table>
</form>
</div>

<div id=TableLocation></div>

<form name=LinkForm method=get action=patweb76.pbl>
<input type=hidden name=reportno value=01>
<input type=hidden name=template value=004>
<input type=hidden name=urnumber>
<input type=hidden name=admissno>
</form>

<script type="text/javascript">
function AddTableRows() {
  %OPRWEB02.05.001
}       

RecordStatus="%OPRWEB02.05.003"
for (var i =0 ; i < document.SelectPeriod.filtsrce.length; i++) {
  if (document.SelectPeriod.filtsrce.options[i].value==RecordStatus) {
       document.SelectPeriod.filtsrce.selectedIndex=i;
  }
};

RecordSource="%OPRWEB02.05.004"
for (var i =0 ; i < document.SelectPeriod.filtstat.length; i++) {
  if (document.SelectPeriod.filtstat.options[i].value==RecordSource) {
       document.SelectPeriod.filtstat.selectedIndex=i;
  }
};

</script>

<meta name="TemplateVersion" content="V12.00.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/emrweb0201101.js"></script>
<script type="text/javascript">
function init() {
  if (document.HiddenFields.DischargeComplete.value!=1) {
    PageLocation="?reportno=1&template=109" +
                 "&urnumber=" + PatientURN.replace(/ /g,"+") +
                 "&admissno=" + PatientVIS.replace(/ /g,"+")
    location.href="emrweb02.pbl" + PageLocation 
    return }
  PageLocation="?reportno=1&template=4" +
               "&urnumber=" + PatientURN.replace(/ /g,"+") +
               "&admissno=" + PatientVIS.replace(/ /g,"+")
  if (top.content.location.href!=this.location.href) {
    top.content.location.href="emrweb02.pbl" + PageLocation }

  if (trim(UpdateForm.waittime.value) <= 240) {
    document.UpdateForm.emvis147.selectedIndex=1 }
  else{
    document.UpdateForm.emvis147.selectedIndex=0 }

  if (isWhitespace(document.HiddenFields.HospitalAdmission.value)) {
    if (!isWhitespace(document.HiddenFields.ExpectedUnit.value)) {
       if(document.UpdateForm.ptcnhdps.value=="3"){ // Victoria
         alert('Warning : Patient must be admitted before being Discharged.')
       } else {
         alert('Patient must be admitted before Discharge.')
         DisableForm(document.UpdateForm) 
       }
    }
  }
  if (trim(document.UpdateForm.attdtype.value.substr(14,4))=='10') {
     for(var i=0; i<document.UpdateForm.emvis026.length; i++) {
       ind=trim(document.UpdateForm.emvis026.options[i].value.substr(14,4));
       if(ind=='8'){ document.UpdateForm.emvis026.selectedIndex=i; }
     }
     for(var i=0; i<document.UpdateForm.emvis051.length; i++) {
       ind=trim(document.UpdateForm.emvis051.options[i].value.substr(14,4));
       if(ind=='19'){ document.UpdateForm.emvis051.selectedIndex=i; }
     }
//   for(var i=0; i<document.UpdateForm.emvis049.length; i++) {
//     ind=trim(document.UpdateForm.emvis049.options[i].value.substr(14,4));
//     if(ind=='9'){ document.UpdateForm.emvis049.selectedIndex=i; }
//   }
  }
  else {
    if (isWhitespace(document.UpdateForm.chkdot.value)) {
      alert("WARNING : Attending Doctor Not Entered")
      for(var i=0; i<document.UpdateForm.emvis026.length; i++) {
         ind=trim(document.UpdateForm.emvis026.options[i].value.substr(14,4));
         if(ind==6){ document.UpdateForm.emvis026.selectedIndex=i; }
       }
//   document.UpdateForm.emvis026.disabled=true;
//    document.UpdateForm.emvis147.selectedIndex=1; 
//     document.UpdateForm.emvis147.disabled=true; 
    }
    else {
      setTimeout('defDepartureA()',100);}
//  defDepartureA(); }
  }
  document.UpdateForm.brcom001.value=document.UpdateForm.dummy1.value + 
                                     document.UpdateForm.dummy2.value
 if(document.HiddenFields.ShowOutstanding.value=="1") {
  var linkurl = "../cgi-bin/emrweb02.pbl?reportno=1&template=051" +
                    "&admissno=" + UpdateForm.admissno.value.replace(/ /g,"+")+
                    "&urnumber=" + UpdateForm.urnumber.value.replace(/ /g,"+")
  Left=(document.body.clientWidth-600)/2
  DFrameLink(linkurl,0,Left,600,300);
 }
// this checks to see if it is being used outside the MAPVIEW
  if(top.location.pathname.match(/EmergencyMap/g)) {
    document.UpdateForm.mapvflag.value=1
  }
}
function checkDateFunction() {
  if(isWhitespace(document.UpdateForm.emvis074.value)) {
    return;
  } else {
    checkDate(document.UpdateForm.emvis074,'Ward Allocated Date');
  }
}
function enableUnitReqDateTime() {
  if (document.UpdateForm.emvis134.value=="") {
    document.UpdateForm.emvis073.selectedIndex=0;
    document.UpdateForm.emvis073.className="ReadOnly";
    document.UpdateForm.emvis073.readOnly=true;
    document.UpdateForm.emvis073.disabled=true;
    document.UpdateForm.emvis083.value="";
    document.UpdateForm.emvis083.className="ReadOnly";
    document.UpdateForm.emvis083.readOnly=true;
  } else {
    document.UpdateForm.emvis073.readOnly=false;
    document.UpdateForm.emvis073.className="";
    document.UpdateForm.emvis073.disabled=false;
    document.UpdateForm.emvis083.readOnly=false;
    document.UpdateForm.emvis083.className="";
  }
}
function checkDept() {
  CheckDepartureA();
  deceasedIndicator = document.UpdateForm.emvis026.value.substr(3,1);
  checkDeceasedEMR(deceasedIndicator);

  if ((deceasedIndicator=="D") && (document.UpdateForm.genericu.value=="1")) {
    UserDesc.innerHTML="Username/Password"
    UserField.innerHTML=userpassw.innerHTML;
  } else {
    UserDesc.innerHTML=""
    UserField.innerHTML=userblank.innerHTML;
  }
}
function displayReferralFields() {
  if (document.UpdateForm.stfrefin.value != "1") {
    emvis174TitleDIV.innerHTML = "";
    emvis175TitleDIV.innerHTML = "";
    emvis176TitleDIV.innerHTML = "";
    emvis174FieldDIV.innerHTML = "";
    emvis175FieldDIV.innerHTML = "";
    emvis176FieldDIV.innerHTML = "";
    return;
  }
  displaycatRF();
}
function displaycatRF() {
    if (document.UpdateForm.emvis174.value.substr(3,1) == "N") {
      emvis175TitleDIV.innerHTML = emvis175TitleSPAN.innerHTML;
      emvis175FieldDIV.innerHTML = emvis175FieldSPAN.innerHTML;
    } else {
      emvis175TitleDIV.innerHTML = "";
      emvis175FieldDIV.innerHTML = "";
    }
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);displayReferralFields();">
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%EMRWEB02.01.003";
PatientVIS="%EMRWEB02.01.081";
PatientNAM="%EMRWEB02.01.002";
PatientSTA="%EMRWEB02.01.086.078";
PatientALT="%EMRWEB02.01.084";
PatientSEX="%EMRWEB02.01.019";
PatientDOB="%EMRWEB02.01.020";
PatientAGE="%EMRWEB02.01.021";
PatientLOC="%EMRWEB02.01.083";
PatientPRI="%EMRWEB02.01.086.066.1";
PatientUNT="%EMRWEB02.01.066.0";
PatientIND="%EMRWEB02.01.086.091";
GpCOD="%EMRWEB02.01.086.084.001";
GpNAM="%EMRWEB02.01.086.084.081";
GpPRAC="%EMRWEB02.01.086.085.001";
GpPRACCNT="%EMRWEB02.01.086.085.002";
GpPRACNAM="%EMRWEB02.01.086.085.005";
PatientARR="%EMRWEB02.01.101.0 %EMRWEB02.01.102";
PatientSEE="%EMRWEB02.01.199.008";
PatientTRI="%EMRWEB02.01.103.3";
PatientECLC="%EMRWEB02.01.484.1";
PatientCLH="%STANDARD.01.017.CL";
PatientEHFT="%EMRWEB02.01.485";
InsertEmergencyHeader()
</script>
<div id=PatientMenu></div>
<div id=PageBodySection>
<table width=100% border=0 cellspacing=0 cellpadding=1>
<tr><td class=HeadingCell align=center>
    Emergency Patient Discharge </td></tr>
</table>
<form name=UpdateForm action=emrweb02.pbl method=post style="margin:0">
 <input type=hidden name=reportno value="01">
 <input type=hidden name=template value="101">
 <input type=hidden name=formactn>
 <input type=hidden name=updttype>
 <input type=hidden name=emvis133>
 <input type=hidden name=admissno value="%EMRWEB02.01.081">
 <input type=hidden name=updateky value="%EMRWEB02.01.404">
 <input type=hidden name=urnumber value="%EMRWEB02.01.003">
 <input type=hidden name=emvis118 value="%EMRWEB02.01.003">
 <input type=hidden name=nextpage value="1">
 <input type=hidden name=redirect value="%EMRWEB02.01.001.emrweb01.01.001">
 <input type=hidden name=chkdot value="%EMRWEB02.01.107.001">
 <input type=hidden name=chknur value="%EMRWEB02.01.164.1">
 <input type=hidden name=dummy1
  value="%EMRWEB02.01.104%EMRWEB02.01.105%EMRWEB02.01.174">
 <input type=hidden name=dummy2
  value="%EMRWEB02.01.175%EMRWEB02.01.176%EMRWEB02.01.177">
 <input type=hidden name=waittime value="%EMRWEB02.01.701">
 <input type=hidden name=loadflag >
 <input type=hidden name=reloadfg value="%EMRWEB02.01.446">
 <input type=hidden name=efrbedty value="%EMRWEB02.01.506">
 <input type=hidden name=efrdisch value="%EMRWEB02.01.509">
 <input type=hidden name=efradmis value="%EMRWEB02.01.508">
 <input type=hidden name=attdtype value="%EMRWEB02.01.213.3">
 <input type=hidden name=depttime value="%EMRWEB02.01.125">
 <input type=hidden name=deptdate value="%EMRWEB02.01.124.0">
 <input type=hidden name=ptdocsee value="%EMRWEB02.01.130.0 %EMRWEB02.01.131">
 <input type=hidden name=ptnursee value="%EMRWEB02.01.128.0 %EMRWEB02.01.129">
 <input type=hidden name=pmpxi067 value="%EMRWEB02.01.667.0">
 <input type=hidden name=mapvflag value="0">
 <input type=hidden name=ptcnhdps value="%STANDARD.01.025.080.250.1.1">
 <input type=hidden name=currdate value="%STANDARD.01.013">
 <input type=hidden name=currtime value="">
 <input type=hidden name=currTime value="">
 <input type=hidden name=genericu value="%EMRWEB02.01.563">
<input type="hidden" name="stfrefin" id="stfrefin"
 value="%EMRWEB02.01.919">

<table width=95% align=center border=0 cellspacing=0 cellpadding=1>
<tr valign=top><td>
<table width=100% border=0 cellspacing=0 cellpadding=2>
<tr valign=top><td class=DataLabel width=15%>Presenting Complaint </td>
    <td><input type=text name=emvis060 max=3 size=3 value="%EMRWEB02.01.220.1"
       readonly class="Readonly">
        <input type=text name=v060name value="%EMRWEB02.01.220.0" readonly class="Readonly">
    </td>
    <td colspan=2><textarea name=brcom001 readonly cols=50 rows=4 class="Readonly"></textarea>
    </td></tr>

<tr><td class=DataLabel>Departure Date </td>
    <td width=30%><input type=text size=12 name=emvis024
         class="Mandatory PastDate" title="Departure Date" 
         value="%STANDARD.01.015"
         onblur="ValDate(UpdateForm.emvis024,UpdateForm.emvis025);">
         <img notab src=../images/DateLookup.gif class=Icon
         onclick="DateLookupFrame(UpdateForm.emvis024);">
        <input class=Mandatory type=text name=emvis025
         size=8 value="%STANDARD.01.016" title="Departure Time"
         onblur="ValTime(UpdateForm.emvis024,UpdateForm.emvis025);">
        <img notab src=../images/DateTimeStamp.gif class=Icon
         onclick="SetCurrentDateTime(UpdateForm.emvis024,UpdateForm.emvis025);">
        <img notab src=../images/TimeLookup.gif class=Icon
         onclick="TimeLookupFrame(UpdateForm.emvis025);">
    </td>

<tr><td class=DataLabel>Departure Status</td>
    <td><select name=emvis026 onchange="checkDept();"
         class=Mandatory title="Departure Status">
        <option></option>
        %EMRWEB02.01.126.2
        </select></td>

    <td class=DataLabel width=15%>Referred to on Departure</td>
    <td><select class=Mandatory name=emvis051
         title="Referred to on Departure" >
        <option></option>
        %EMRWEB02.01.211.2
        </select></td></tr>
</table>

<div id=Departure></div>

<table width=100% border=0 cellspacing=0 cellpadding=2>
<tr><td class=DataLabel width=15%>Unit Request Date</td>
    <td class=DataLabel width=30%><select name=emvis073 title="Unit Request Date">
         %EMRWEB02.01.233.1
        </select>
    Time
    <input type="text" name=emvis083 size="8" title="Unit Request Time"
       value="%EMRWEB02.01.243">
    <img src="../images/DateTimeStamp.gif" class=Icon
     date=UpdateForm.emvis073 time=UpdateForm.emvis083>
    <img src=../images/TimeLookup.gif class=Icon time=UpdateForm.emvis083>
    </td>
    <td class=DataLabel width=15%>Ward Allocated Date</td>
    <td class=DataLabel><select name=emvis074 title="Ward Allocated Date"
         onchange="checkDateFunction();">
         %EMRWEB02.01.234.1
    </select>
    Time
   <input type="text" name=emvis084 size="8" title="Bed Ready Time" 
      value="%EMRWEB02.01.244">
    <img src="../images/DateTimeStamp.gif" class=Icon
     date=UpdateForm.emvis074 time=UpdateForm.emvis084>
    <img src=../images/TimeLookup.gif class=Icon time=UpdateForm.emvis084>
    </td></tr>

<tr><td class=DataLabel>Expected Unit</td>
    <td><select name=emvis134 class=SelectBig title="Expected Unit"
         onchange="enableUnitReqDateTime();">
        <option></option>
        %EMRWEB02.01.173.2
        </select></td>
    <td class=DataLabel>Expected Ward</td>
    <td class=DataLabel>
    <select name=emvis116 class=SelectBig title="Expected Ward">
<option></option>
      %EMRWEB02.01.149.2
         </select>
    </td></tr>

<tr><td class=DataLabel>C Type or E Type Admission</td>
    <td><select name=emvis147 class=Mandatory title="C Type or E Type Admission">
        <option value="1">Yes</option>
        <option value="0">No</option>
        </select>
    </td>

    <td class=DataLabel><div id=UserDesc></div></td>
    <td><div id=UserField></div></td>
</tr>

<tr>
     <td class=DataLabel>
       <div id="emvis174TitleDIV">
         %STANDARD.01.017.RF
       </div>
     </td>
     <td>
       <div id="emvis174FieldDIV">
       <select name="emvis174" tabindex=38 class="SelectMed"
        title="%STANDARD.01.017.RF" onchange="displaycatRF();">
         <option></option>
         %EMRWEB02.01.293.2
         </select>
       </div>
     </td>
     <td class=DataLabel>
       <div id="emvis176TitleDIV">
         Referral Date
       </div>
     </td>
     <td>
       <div id="emvis176FieldDIV">
         <input type=text size=12 name=emvis176 title="Referral Date"
          value="%EMRWEB02.01.295" tabindex=41
          onblur="checkDateSV(this,'Valid to');" >
         <img notab src="../images/DateLookup.gif" class="Icon"
           alt="Show Calendar" date="UpdateForm.emvis176">
       </div>
     </td>
     </tr>

<tr>
     <td class=DataLabel>
       <div id="emvis175TitleDIV">
         Referral Period (Months)
       </div>
     </td>
     <td>
       <div id="emvis175FieldDIV">
         <input type=text name=emvis175 title="Referral Period (Months)"
          class=Number size=15 maxlength=2 min=1 max=98
          value="%EMRWEB02.01.294">
       </div>
     </td>
     <td class=DataLabel></td>
     <td>

     </td>
     </tr>

<tr><td colspan=4 align=center><br>
    <input type=button value="Discharge" class="button" onclick="PostDischarge();">
    <input type=button value="Cancel" class="button" 
     onclick='fnPatientLink("%EMRWEB02.01.003","%EMRWEB02.01.081");'>
</td></tr>
</table>
</table>
</form>

<span id=ShowDeparture style="display:none;">
<table width=100% border=0 cellspacing=0 cellpadding=2>
<tr><td class=DataLabel width=15%>Transfer Destination</td>
    <td width=30%><input type=text size=6 maxlength=6 name=emvis033
         title="Transfer Destination" value="%EMRWEB02.01.133.1"
         onchange="validateCode(9,UpdateForm.emvis033,
                   UpdateForm.name_emvis033n);">
        <input type=text size=30 name=name_emvis033n readonly
         value="%EMRWEB02.01.133.0">
        <img src=../images/SearchIcon.gif class=Icon
         onclick="TransferSourceFrame(UpdateForm.emvis033,
                  UpdateForm.name_emvis033n);">
        </td>
    <td class=DataLabel width=15%>Reason for Transfer</td>
    <td><select class=SelectBig name=emvis052>
        <option></option>
        %EMRWEB02.01.212.2
        </select></td></tr>

<tr><td class=DataLabel>Escort Source</td>
    <td><select class="SelectBig" name=emvis050 title="Escort Source">
        <option></option>
         %EMRWEB02.01.210.2
        </select></td>
    <td class=DataLabel>Transport Mode</td>
    <td><select class=SelectBig name=emvis049>
        <option></option>
        %EMRWEB02.01.209.2
        </select></td></tr>
</table>
</span>

<form name=HiddenFields method=get style="margin:0">
<input type=hidden name=DischargeComplete value="%EMRWEB02.01.147">
<input type=hidden name=HospitalAdmission value="%EMRWEB02.01.148">
<input type=hidden name=ExpectedUnit value="%EMRWEB02.01.173.1">
<input type=hidden name=ShowOutstanding value="%EMRWEB02.01.474">
</form>
<form name=PatientLinks method=get style="margin:0">
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=regexstm value=102>
<input type=hidden name=newstand value=1>
<input type=hidden name=urnumber value="%EMRWEB02.01.003">
<input type=hidden name=admissno value="%EMRWEB02.01.081">
<input type=hidden name=emrgflag value="Y">
<input type=hidden name=nextpage value="4">
<input type=hidden name=MenuType value="11">
</form>
<script type="text/javascript">
if ( document.UpdateForm.deptdate.value == "") {
  document.UpdateForm.deptdate.value="%EMRWEB02.01.233.0";
  document.UpdateForm.depttime.value="%EMRWEB02.01.243";
}
if ( document.UpdateForm.emvis134.value=="") {
  document.UpdateForm.emvis073.selectedIndex=0;
  document.UpdateForm.emvis073.className="ReadOnly";
  document.UpdateForm.emvis073.readOnly=true;
  document.UpdateForm.emvis073.disabled=true;
  document.UpdateForm.emvis083.value="";
  document.UpdateForm.emvis083.className="ReadOnly";
  document.UpdateForm.emvis083.readOnly=true;
}
</script>

<span id=userpassw style="display:none">
    <input type=text size=12 name=username class=Mandatory
         title="User ID">
    <input type=password size =12 name=password class=Mandatory
         title="Password" onblur=GenericPass();>
</span>

<span id=userblank style="display:none">
   <input type=hidden name=username>
   <input type=hidden name=password>
</span>
<span id="emvis175TitleSPAN" style="display:none">
         Referral Period (Months)
</span>
<span id="emvis175FieldSPAN" style="display:none">
         <input type=text name=emvis175 title="Referral Period (Months)"
          class=Number size=15 maxlength=2 min=1 max=98
          value="%EMRWEB02.01.294">
</span>
<span id="emvis020TitleSPAN" style="display:none">
Referring HCP
</span>

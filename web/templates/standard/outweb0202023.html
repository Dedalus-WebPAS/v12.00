<meta name="TemplateVersion" content="V12.00.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName"    content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/outweb02.js"></script>
<script type="text/javascript">
function postDeparture() {
  if(!validateMandatory(UpdateForm)) {
    return;
  }
  if(!checkFutureDepartureTime()){ return; }
  RemoveAppointments(UpdateForm);
  if(!GetAppointments(UpdateForm)) {
    return;
  }
  UpdateForm.redirect.value="outweb02.pbl?reportno=2&template=22" +
  "&sesskeys=" + UpdateForm.sesskeys.value.replace(/ /g,"+") +
  "&redirflg=" + UpdateForm.redirflg.value.replace(/ /g,"+") +
  "&wacpmich=" + UpdateForm.wacpmich.value.replace(/ /g,"+");
  document.UpdateForm.submit();
}
function checkFutureDepartureTime() {
  p=document.UpdateForm;
  if(isWhitespace(p.d_sessdate.value) || isWhitespace(p.outbb034.value)) {
     return true;
  }
  SetCurrentDateTimeNoFocus(p.currdate,p.currtime);// UNIX time
  if(SetDateYYYYMMDD(p.d_sessdate.value)>SetDateYYYYMMDD(p.currdate.value)) {
    alert("Departure date should not be in future");
    p.outbb034.focus();
    return false;
  }
  if (SetDateYYYYMMDD(p.d_sessdate.value)==SetDateYYYYMMDD(p.currdate.value)) {
    var newttime=trim(p.outbb034.value.replace(/:/g,"")) - 0
    var currentt=trim(p.currtime.value.replace(/:/g,"")) - 0
    if(newttime>currentt){
      alert("Departure time should not be in future");
      p.outbb034.focus();
      return false;
    }
  }
  return true;
}
function RemoveAppointments(theForm) {
  var appts = document.getElementsByTagName("input");
  for (i=0; i<appts.length; i++) {
    if(appts[i].type=="hidden" &&
       appts[i].id.substr(0,16)=="selectedslotkeys"){
       theForm.removeChild(appts[i]);
    }
  }
}
function GetAppointments(theForm) {
  var appts =parent.document.getElementsByTagName("input");
  var y=0;
  for (i=0; i<appts.length; i++) {
    if(appts[i].type=="checkbox" &&
       appts[i].checked==true &&
       appts[i].name=="slotkeys") {

      if (appts[i+1].type=="hidden" &&
          appts[i+1].name=="confpmiw") {

//        alert("Function not available\n" +
//              "Confirm PMI date less than clinic date for\n" +
//              "Outpatient Visit: " + appts[i+1].value);

      } else {

        y++;
        var newid="selectedslotkeys" + y;
        var the_field = document.createElement('INPUT');
        the_field.setAttribute('value',appts[i].value);
        the_field.setAttribute('name','slotkeys');
        the_field.setAttribute('id',newid);
        the_field.setAttribute('type','hidden');
        theForm.appendChild(the_field);

      }
    }
  }
  if(y==0) {
   alert("Please select at least one patient")
   return false;
  } else {
   return true;
  }
}
function ShowLetters(outcome) {
 ind=outcome.value.substr(3,1);
 if(ind == "3" || ind == "4") {        // Discharged or referred back to GP
   document.getElementById('Letter').innerHTML=
   document.getElementById('ShowLetter').innerHTML;
 } else {
   document.getElementById('Letter').innerHTML="";
 }
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Bulk Departure - %OUTWEB02.02.014
</span>
<div id=PageBodySection style="overflow: auto;">
<form name=UpdateForm action=outweb02.pbl method=post target=_parent>
<input type=hidden name=reportno value=8>
<input type=hidden name=template value=018>
<input type=hidden name=updatety value=17>
<input type=hidden name=redirect value="">
<input type=hidden name=sesskeys value='%OUTWEB02.02.004'>
<input type=hidden name=newsltyp value="">
<input type=hidden name=nextpage value=1>
<input type=hidden name=redirflg value="%OUTWEB02.02.136">
<input type=hidden name=wacpmich value="%OUTWEB02.02.195">
<input type=hidden name=d_sessdate value='%OUTWEB02.02.063'>
<input type=hidden name=currdate value=''>
<input type=hidden name=currtime value=''>
<table cellspacing=0 cellpadding=1 border=0 width=95% align=center>
<tr><td width=20% class=DataLabel>Departure Time</td>
    <td width=30%>
    <input type=text name=outbb034 value="" size=8 class="Mandatory Time"
     title="Departure Time" onblur="checkTime(this,this.title);">
    <img src=../images/DateTimeStamp.gif  border=0 hspace=4 align=absmiddle
    onclick="SetCurrentDateTimeMin(null,UpdateForm.outbb034);">
    <img src=../images/TimeLookup.gif border=0 hspace=4 align=absmiddle
    onclick="TimeLookupFrameMin(UpdateForm.outbb034);">
    </td>
    <td class=DataLabel width=20%></td>
    <td></td></tr>
<tr><td class=DataLabel>Outcome </td>
    <td><select name=outbb035 onchange="ShowLetters(this);"
         title="Outcome" class="Mandatory"> 
        <option></option>
        %STANDARD.01.007.OZ
        </select></td> 
    <td class=DataLabel>&nbsp;</td>
    <td>&nbsp;</td>
    </tr>
</table>

<div id="Letter"></div>

<table cellspacing=0 cellpadding=1 border=0 width=95% align=center>
<tr><td colspan=4 align=center><br>
    <input type=button class="button" value="Ok" id="out02sub"
     onclick="tempDisable(this);postDeparture();">
    <input type=button class="button" Value="Cancel" 
     onclick="DFrameCloseRefresh();"></td></tr>
</table>
</form>
</div>

<div id="ShowLetter" style="display:none">
<table cellspacing=0 cellpadding=1 border=0 width=95% align=center>
<tr><td class=DataLabel width=20%>Discharge Status </td>
    <td width=30%><select name=outbb050 title="Discharge Status"
                   class="Mandatory">
        <option></option>
         %STANDARD.01.007.DO
        </select></td>
    <td width=20%>&nbsp;</td>
    </tr>
<tr><td class=DataLabel width=20%>Patient Discharge Letter</td>
    <td width=30%><input type=checkbox checked value=1 name=letprt03></td>
    <td width=20%>Printer</td>
    <td><select class=SelectBig name=letpsl03>
        %STANDARD.01.001.OUTWEB03.02
        </select></td></tr>

<tr><td class=DataLabel>GP Discharge Letter</td>
    <td><input type=checkbox checked value=1 name=letprt02></td>
    <td>Printer</td>
    <td><select class=SelectBig name=letpsl02>
         %STANDARD.01.001.OUTWEB03.02
        </select></td></tr>
</table>
</div>

<meta name="TemplateVersion" content="V12.00.00">
<meta name="TemplateHome"    content="standard">
<meta name="HelpFileName"    content="NoContextSet.html">
<meta name="CrossBrowser"    content="true">
<script type="text/javascript" src="../js/TableSort.js"> </script>
<script type="text/javascript">
function displayHospitalID() {
  if (document.SelectPeriod.ibcnmhos.value=="1") {
    HospitalIDTitleDIV.innerHTML=HospitalIDTitleSPAN.innerHTML;
    HospitalIDFieldDIV.innerHTML=HospitalIDFieldSPAN.innerHTML;
  }
}
function ExportToExcel() {
  var tab_text = '', tab_data = '';

  for (i=0; i < TableLocation.childNodes.length; i++ ) {
    tab_data += TableLocation.childNodes[i].innerHTML;
  }
  tab_data = tab_data.replace(/<a[^>]*>|<\/a>/gi,"");  // removes links
  tab_data = tab_data.replace(/<img[^>]*>/gi,"");      // removes images

  tab_text += '<html xmlns:x="urn:schemas-microsoft-com:office:excel">';

  tab_text += '<head><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>';

  tab_text += '<x:Name>Disaster View</x:Name>';

  tab_text += '<x:WorksheetOptions><x:Panes></x:Panes></x:WorksheetOptions></x:ExcelWorksheet>';

  tab_text += '</x:ExcelWorksheets></x:ExcelWorkbook></xml></head><body>';

  tab_text += tab_data;

  tab_text += '</body></html>';

  var ua = window.navigator.userAgent;
  var msie = ua.indexOf("MSIE ");
  
  if (msie > 0) {  // Older IE browsers
    frmExport.document.open("txt/html","replace");
    frmExport.document.write(tab_text);
    frmExport.document.close();
    frmExport.focus();

    sa = frmExport.document.execCommand("SaveAs",true,"Disaster View.xls");
  } 
  else if (ua.match(/Trident.*rv\:11\./)) {  // IE11
    if (window.navigator.msSaveBlob) {
      var blob = new Blob([tab_text], {
                   type: "application/csv;charset=utf-8;"
                 });
      navigator.msSaveBlob(blob, 'Disaster View.xls');
    }
    return;
  }
  else {  // Other browsers
    sa = window.open("data:application/vnd.ms-excel," + encodeURIComponent(tab_text));
  }

  return (sa);
}
function SelectSubmit() {
  document.SelectPeriod.submit();
}

function SelectSubmitExcluded() {
  if (document.SelectPeriod.d_filtexcl.checked==true) {
    document.SelectPeriod.filtexcl.value="1";
  } else {
    document.SelectPeriod.filtexcl.value=" ";
  }
  document.SelectPeriod.submit();
}
function LinkPatient(linkurl) {
  location.href=linkurl;
}
function InitTable() {
 t = new Table(1,0,2,"100%","center",50,50);

 if (document.SelectPeriod.ibcnmhos.value=="1") {
   t.addColumn("Hospital","String",0,0,"left","","",50)
 }

 t.addColumn("Patient","ImageText",1,1,"left","PatientFolder","2",100,3)
 t.addColumn("Disaster","String",4,4,"left","","",90)
 t.addColumn("Disaster ID No.","String",5,5,"left","","",90)
 t.addColumn("Type","String",11,11,"left","","",50)
 t.addColumn("Location","String",7,7,"left","","",40)
 t.addColumn("Unit","String",12,12,"left","","",50)
 t.addColumn("Doctor","String",9,9,"left","","",80)
 t.addColumn("Diagnosis","String",10,10,"left","","",90)
 AddTableRows()
 TableOutput(1,2);    // Order Column,Asc Dsc
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);InitTable();displayHospitalID();">
<div id=HeadingSection>
<form name=SelectPeriod action=disweb01.pbl method=get style="margin:0">
<input type=hidden name=reportno value=4>
<input type=hidden name=template value=1>
<input type=hidden name=d_filttype value="%DISWEB01.04.006">
<input type=hidden name=ibcnmhos value="%STANDARD.01.025.000.043.1.1">
<input type=hidden name=ptcnudpd value="%DISWEB01.04.114">
<input type=hidden name=filtexcl value="%DISWEB01.04.007">

<table cellpadding=1 cellspacing=1 bgcolor=#CCCCCC border=0 width=100%>
 <tr>
  <td class=DataLabel align=left>Disaster</td>
  <td>
   <select name=disacode id=disacode class=SelectMed title="Disaster"
    onchange="SelectSubmit();">
   <option value="  ">   </option>
    %DISWEB01.04.004
   </select>
  </td>
  <td class=DataLabel align=left><div id=HospitalIDTitleDIV></div></td>
  <td>
    <div id=HospitalIDFieldDIV></div>
  </td>
  <td class=DataLabel align=left>Visit Type</td>
  <td>
   <select name=filttype id=filttype class=SelectMed title="Visit Type"
    onchange="SelectSubmit();">
     <option value="                         ">All</option>
     <option value="EMG                      ">Emergency</option> 
     <option value="OP                       ">Outpatient</option>
     <option value="RF                       ">Referral</option>
     <option value="Pre-adm                  ">Pre Admission</option>
     <option value="Current IP               ">Current Inpatient</option>
     <option value="Discharged               ">Discharged</option>
     <option value="Leave                    ">Leave</option>
     <option value="Cancel                   ">Cancel</option>
     <option value="WAT                      ">Waiting List</option>
   </select>
  </td>
  <td class=DataLabel align=left>
    <div id=ExcludedTitleDIV></div>
  </td>
  <td>
    <div id=ExcludedFieldDIV></div>
  </td>
  <td align=right>
    <input type=button value="Export To Excel" title="Export To Excel"
     onclick="ExportToExcel();">
  </td>
 </tr>
</table>
</form>
</div>

<div id=TableLocation></div>

<iframe name=frmExport id=frmExport style="display:none"></iframe>

<span id=HospitalIDTitleSPAN style="display:none">
  Hospital
</span>

<span id=HospitalIDFieldSPAN style="display:none">
<select name=filthosp id=filthosp class=SelectMed title="Hospital"
 onchange="SelectSubmit();">
  <option value="   "></option>
  %DISWEB01.04.005
</select>
</span>

<span id=ExcludedTitleSPAN style="display:none">
  Exclude Completed Patients
</span>

<span id=ExcludedFieldSPAN style="display:none">
<input type=checkbox name=d_filtexcl id=d_filtexcl value="1" 
 title="Exclude Completed Patients" onclick="SelectSubmitExcluded();">
</span>

<script type="text/javascript">
function AddTableRows() {
  %DISWEB01.04.003.disweb01.03.001
}

for (var i=0; i < document.SelectPeriod.filttype.length; i++) {
  if (document.SelectPeriod.filttype.options[i].value ==
      document.SelectPeriod.d_filttype.value) {
    document.SelectPeriod.filttype.selectedIndex=i;
  }
}

if (document.SelectPeriod.ptcnudpd.value=="1") {
  ExcludedTitleDIV.innerHTML = ExcludedTitleSPAN.innerHTML;
  ExcludedFieldDIV.innerHTML = ExcludedFieldSPAN.innerHTML;
  if (document.SelectPeriod.filtexcl.value=="1") {
    document.SelectPeriod.d_filtexcl.checked=true;
  }
}  
</script>

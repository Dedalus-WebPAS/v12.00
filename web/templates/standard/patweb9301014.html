<meta name="TemplateVersion" content="V12.00.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/PatientSortWidget.js"> </script>
<script type="text/javascript">
function PatientTableLink(Urnumber,Admissno,Server,Option,Template,Frame) {
  if (getTop().menu.defPatientLink.serverid==undefined) {
    serverid=Server
    reportno=Option
    template=Template; 
  }
  else {
    serverid=getTop().menu.defPatientLink.serverid.value;
    reportno=getTop().menu.defPatientLink.reportno.value;
    template=getTop().menu.defPatientLink.template.value;
  }
  url=serverid + ".pbl?reportno=" + reportno +
                 "&template=" + template +
                 "&urnumber="  + Urnumber.replace(/ /g,"+") +
                 "&admissno="  + Admissno.replace(/ /g,"+") 
  getTop().content.document.location.href=url
}
function GetOptions() {
  theURL = "patweb02.pbl?reportno=2&template=5";
  theURL = theURL + '&httprand='+Math.random();
  xmlHttp = createHttpObject();
  xmlHttp.open("GET", theURL, false);
  xmlHttp.send();
  var $str=xmlHttp.responseText.replace(/\n/,"")
  $str=$str.replace(/<\/option>/g,"|");
  $arr=$str.split("|");
  for (i=0;i<$arr.length;i++) {
    var y=document.createElement('option');
    y.text=$arr[i].replace(/<option.*>/,"");
    y.value=$arr[i].replace(/<option value="/,"").replace(/">.*/,"");
    if (y.value.match(/\w/)!=null) {
      DisplayForm.webpd002.add(y);
    }
  }
}
function InitTable(TableView) {
//------------------------------------------------------------
// Table - Current Admission by Doctor
// Columns
//  0 - UR
//  1 - Admission No
//  2 - Indicators
//  3 - Name
//  4 - Ward Bed
//  5 - Admission Date & Time
//  6 - Sex
//  7 - Age
//  8 - Diagnosis
//------------------------------------------------------------
switch (TableView) {
case 0: {
 t = new Table(1,0,1,"100%","center",24,24);
 t.addColumn("Patient","Checkbox",3,3,"left nowrap","","0","50%")
 t.addColumn("Bed","String",4,4,"left","","","10%")
 t.addColumn("Doctor","String",8,8,"left","","","20%")
 t.addColumn("Unit","String",7,7,"left","","","20%")
 t.addLink("patweb98.pbl","01","001","PatientFolder.gif")
 AddTableRows();
 TableOutput(0,1);
 GetOptions()
 break; }
 }
}
function AddTableRows() {
  elTable=document.getElementById("WardList");
  elRows=elTable.getElementsByTagName("TR");

  for (i=0; i < elRows.length; i++) {
    elCols=elRows[i].getElementsByTagName("TD")
    urnumber="";
    admissno="";
    indicators="";
    PatientName="";
    WardBed="";
    AdmDate="";
    DisDate="";
    Doctor="";
    Unit="";

    for (j=0; j < elCols.length; j++) {
      if (elCols[j].className != "HeadingCell") {
        switch (j) {
          case 0:  // Bed Location
            WardBed=elCols[j].innerHTML;
            break;

          case 1:  // Patient Name
            if (elCols[j].innerHTML.match(/Empty/)
                || !elCols[j].innerHTML.match(/.*urnumber=/i)) {
              urnumber="";
            } else {
              PatientName=elCols[j].innerHTML.replace(/(.*gif.+>)(<b.+)/i,"$2");
              urnumber=elCols[j].innerHTML.replace(/.*urnumber=(.*)\&amp;.*/i,"$1").replace(/\+/g," ");
              admissno=elCols[j].innerHTML.replace(/.*admissno=([0-9+]+).*/,"$1").replace(/\+/g," ");
            }
            break;

          case 7:  // Unit/Doctor
            Unit=elCols[j].innerHTML.replace(/<BR.*/i,"");
            Doctor=elCols[j].innerHTML.replace(/..A>/i,"").replace(/.*>/,"");
            break;

          case 8:  // Admission/Discharge Date
            AdmDate=elCols[j].innerHTML.replace(/<BR.*/i,"");
            DisDate=elCols[j].innerHTML.replace(/^.*<BR.*>([0-9]+.*)/i,"$1").replace(/<BR.*/i,"");
            break;
        }
      }
    }

    if (!isWhitespace(urnumber)) {
      t.addRow(urnumber,admissno,"",PatientName,WardBed,AdmDate,DisDate,Unit,Doctor);
    }
  }
}
function AddPatients() {
  xmlHttp = createHttpObject();
  var theURL   = "patweb02.pbl"
  paraStatic  ="reportno="+encodeURI(AddForm.reportno.value)
  paraStatic+="&template="+encodeURI(AddForm.template.value)
  paraStatic+="&updttype="+encodeURI(AddForm.updttype.value)
  paraStatic+="&webpt002="+encodeURI(DisplayForm.webpd002.options[DisplayForm.webpd002.selectedIndex].value)
  paraStatic+="&webpt005="
  paraStatic+="&webpt006="
  paraStatic+="&webpt007="
  paraStatic+="&webpt008="
  paraStatic+="&webpt009="
  paraStatic+="&webpt009="
  sl=document.getElementsByTagName("INPUT")
  for (i=0;i<sl.length;i++) {
    if (sl[i].type=="checkbox") {
      if (sl[i].checked) {
       parameters= paraStatic+
                  "&webpt003="+encodeURI(sl[i].urnumber)+
                  "&webpt004="+encodeURI(sl[i].admissno)
       xmlHttp.open("POST", theURL, false);
       xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
       xmlHttp.send(parameters);
      }
    }
  }
  DisplayForm.submit();
}
function SelectOption(el) {
  linkTo=el.options[el.selectedIndex].value
  if (linkTo.match(/\?/)) {
    location.href=el.options[el.selectedIndex].value
  }
  else {
   eval(linkTo); 
  }
}
function ManagePatientFavorites() {
  DisplayForm.submit();
}
function BedAllocation(urnumber,admissno) {
  linkurl="patweb96.pbl?reportno=3&template=005" +
          "&urnumber=" + urnumber + "&admissno=" + admissno
  DFrameLink(linkurl,50,250,300,120)
}
</script>
</head>
</script>
%START.OF.PAGE
<body onload="PageLoad(event);InitTable(0);">
<span class=TitleBar>
<img align="right" alt="Exit" class="MenuIcon"
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Ward Patient Lists
</span>

<form name=AddForm method= post action=patweb02.pbl style="margin:0">
<input type=hidden name=reportno value="2">
<input type=hidden name=template value="004">
<input type=hidden name=updttype value="A">
<input type=hidden name=webpt002 value="">
<input type=hidden name=webpt003 >
<input type=hidden name=webpt004 >
<input type=hidden name=webpt007 >
<input type=hidden name=webpt008 >
<input type=hidden name=webpt009 >
<input type=hidden name=webpt010 >
</form>

<form name=DisplayForm action=patweb02.pbl method=get style="margin:0">
<input type=hidden name=reportno value=2>
<input type=hidden name=template value=4>
<input type=hidden name=updttype value=" ">
<table border=0 cellpadding=1 cellspacing=0 width=100%>
<tr>
  <td style='border:0;font-weight:bold;width:20%;' nowrap>Add Patients to List </td>
  <td><select name=webpd002 class=SelectBig></select>
      <input type=button value=Add onclick='AddPatients();'>
  </td>
  <td style='border:0;' align=right>
    <select name=PatientLists onchange='SelectOption(this);' class=SelectBig>
      <option value='ManagePatientFavorites();'>My Patient Lists</option>
      <option value='patweb07.pbl?reportno=02&template=004'>My Recently Viewed</option>
      <option value='patweb97.pbl?reportno=01&template=011'>My Admitted Patients</option>
      <option value='patweb93.pbl?reportno=01&template=014' selected>Ward Patient List</option>
    </select>
  </td>
</tr>
</table>
</form>

<form name=SelectWard action=patweb93.pbl method=get style="margin:0">
<input type=hidden name=reportno value="1">
<input type=hidden name=template value="14">
<table width=100% cellspacing=0 border=0>
<tr>
  <td align=right>
    <select name=wardcode onchange="SelectWard.submit();"  class=SelectBig>
      %PATWEB93.01.001
    </select>
  </td>
</tr>
</table>
</form>

<div id=TableLocation style='overflow:auto;'></div>

<div style='display:none;'>
<table id=WardList cellspacing=0 cellpadding=2 border=1 width=100%>
%PATWEB93.01.009.patweb98.01.001.patweb99.01.001.0
</table>
</div>

<script type="text/javascript">
var height = document.body.clientHeight;
var TableLocation = document.getElementById('TableLocation');

TableLocation.style.height = height - TableLocation.offsetTop + "px";
</script>

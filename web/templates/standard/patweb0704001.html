<meta name="TemplateVersion" content="V12.00.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/patweb07.js"></script>
<script type="text/javascript">
function AddConcessCard() {
  document.UpdateForm.pmccd002.value=document.UpdateForm.d_pmccd002.value;

  if (document.getElementById('d_pmccd002').value.substr(3,1)==7){

     //Checks if NDIS number matches requirements
     if (!validateNDISNumber(document.UpdateForm.pmccd003,
                             document.UpdateForm.ptcnhdps.value)) {
        return;
     }
  }

  SubmitHiddenNew(UpdateForm);
}
function UpdateCCard(linkurl) {
  Left=(document.body.clientWidth-500)/2
  DFrameLink(linkurl,0,Left,500,260)
}
function DeleteConcessCard(urnumber,exdate,ctyp) {
  if(confirm("Are you sure you want to delete?")) {
     linkurl="patweb07.pbl?reportno=4&template=8" +
             "&urnumber="+urnumber+
             "&pmccd004="+exdate  +
             "&pmccd002="+ctyp;
     Left=(document.body.clientWidth-300)/2
     DFrameLink(linkurl,60,Left,450,100);
  }
}
function DefaultDate(ctyp,cdate) {
  if(ctyp.value.substr(3,1)=="2") {
    document.UpdateForm.pmccd004.value=("31 Dec " + cdate.value.substr(0,4));
  }
}

function ConcCardClose() {
  if(top.menu.EmergencyFrame!=undefined) {
    linkURL="patweb98.pbl?reportno=1&template=001" +
       "&urnumber=" + parent.UpdateForm.urnumber.value.replace(/ /g,"+") +
       "&admissno=" + parent.UpdateForm.admissno.value.replace(/ /g,"+")
       parent.location.href=linkURL;
  } else {
    linkURL=top.content.UpdateForm.action + "?" +
       top.content.location.search.substring(1,25) +
       "&urnumber=" + top.content.UpdateForm.urnumber.value.replace(/ /g,"+") +
       "&admissno=" + top.content.UpdateForm.admissno.value.replace(/ /g,"+")
       top.content.location.href=linkURL;
  }
}

function ChooseType() {
  if (document.UpdateForm.d_pmccd002.value == "") {
    document.UpdateForm.pmccd003.className = "Readonly";
    document.UpdateForm.pmccd004.className = "Readonly";
    document.UpdateForm.pmccd003.readOnly = true;
    document.UpdateForm.pmccd004.readOnly = true;
    document.UpdateForm.pmccd003.value = "";
    document.UpdateForm.pmccd004.value = "";
  } else {
    document.UpdateForm.pmccd003.className = "Mandatory";
    document.UpdateForm.pmccd003.readOnly = false;
    document.UpdateForm.pmccd004.readOnly = false;
    document.UpdateForm.pmccd003.value = "";
    document.UpdateForm.pmccd004.value = "";
  }
}

function isDVA() {
  var cTitlePanel = document.getElementById('DVAColorTitlePanel');
  var cTitle = document.getElementById('DVAColorTitle');
  var cSelectPanel = document.getElementById('DVAColorSelectPanel');
  var cSelect = document.getElementById('DVAColorSelect');

  var expireDate = document.getElementById("pmccd004");
  var colorDefault = document.getElementById("pmccd005");

  var cardType = document.getElementById('d_pmccd002');
  var index = cardType.selectedIndex;
  var expiryIndicator = cardType[index].value.substring(6,7); //expire not mandatory if = 1

  if(typeof cTitlePanel != 'undefined' &&
     typeof cTitle != 'undefined' &&
     typeof cSelect != 'undefined' &&
     typeof cSelectPanel != 'undefined') {

     if(cardType[index].value.substr(3,1) == "3") {

       cSelectPanel.innerHTML = cSelect.innerHTML;
       cTitlePanel.innerHTML = cTitle.innerHTML;
       isExpireDateMandatory(expiryIndicator,expireDate);
     }else {
       cSelectPanel.innerHTML = "";
       cTitlePanel.innerHTML = "";
       isExpireDateMandatory(expiryIndicator,expireDate);
       ChooseType();
     }
  }
}

function isExpireDateMandatory(value,obj) {
       if(value == 1){
           obj.className = "FutureDate"
       }else {
           obj.className = "Mandatory FutureDate";
       }
}

function ValidateCardType() {
  p=document.UpdateForm
  p.pmccd003.value=p.pmccd003.value.replace(/ /g,"");
  UpCase(p.pmccd003);
  p.ccardno.value=p.pmccd003.value.replace(/\+/g,"@");
  p.ccardno.value=p.ccardno.value.replace(/\%/g,"@");
  var serverURL = "../cgi-bin/comweb80.pbl?reportno=76" +
                  "&valdcode="+p.d_pmccd002.value.replace(/ /g,"+") +
                  "&valdcod2="+p.ccardno.value.replace(/&/g,"@")
  var returnValue = RSExecute(serverURL);
  if (returnValue.status!=0){
     p.pmccd003.select();
     p.pmccd003.focus();
     return false;
  }
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);self.focus();pmccd005.selectedIndex=0;ChooseType();">
<span class=DFrameTitleBar id=DFrameHeading>
<img align="right" alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="ConcCardClose();">
<img src="../images/PrinterIcon.gif" class=MenuIcon alt="Print"
onclick="PrintThisPage();" align ="right">
Concession Cards                  
</span>
<div id=PageBodySection>
<table width=100% border=0 cellpadding=0 cellspacing=0>
<tr><td class=HeadingCell> Card Type </td>
    <td class=HeadingCell> Card Number </td>       
    <td class=HeadingCell> Card Expiry Date </td>       
    <td class=HeadingCell> Card Colour </td>
    <td class=HeadingCell width=10%> &nbsp; </td></tr>
    %PATWEB07.04.107.patweb07.04.005
</table>
</div>
<div id=PageHeadingSection>
<form name=UpdateForm action="patweb07.pbl" method=post style="margin:0">
<input type=hidden name=reportno value="4">
<input type=hidden name=template value=1>
<input type=hidden name=updttype value="A">
<input type=hidden name=nextpage value="5">
<input type=hidden name=pmccd002>
<input type=hidden name=ccardno>
<input type=hidden name=urnumber value="%PATWEB07.04.003">
<input type=hidden name=admissno value="%PATWEB07.04.081">
<input type=hidden name=currdate value="%STANDARD.01.013">
<input type=hidden name=ptcnhdps value="%PATWEB07.04.243">

<table width=100% border=0 cellpadding=1 cellspacing=1 bgcolor=#cccccc>
<tr><td width=100% colspan=8 class=HeadingCell align=center>
        Add Concession Card</td></tr>
<tr><td class=DataLabel> Card Type </td>
    <td><select name=d_pmccd002 id=d_pmccd002 class=Mandatory title="Card Type"
        onchange="ChooseType();
                  DefaultDate(UpdateForm.d_pmccd002,UpdateForm.currdate);
                  isDVA();">
        <option></option>
          %STANDARD.01.007.ct
        </select></td>
    <td class=DataLabel> Card Number </td>
    <td><input type=text name=pmccd003 size=25 maxlength=20 
         class=Mandatory title="Card Number"
         onBlur='ValidateCardType();'></td>
    <td class=DataLabel> Card Expiry Date </td>
    <td><input type=text name=pmccd004 id=pmccd004 size=12 maxlength=11
         class="Mandatory FutureDate" title="Card Expiry Date">
         <img notab src="../images/DateLookup.gif" class=Icon
          onclick="DateLookupFrame(UpdateForm.pmccd004);"></td>
</tr>
<tr><td>&nbsp;</td><td>&nbsp;</td>
    <td><span id="DVAColorTitlePanel"></span></td>
    <td><span id="DVAColorSelectPanel"></span></td>
    <td>&nbsp;</td><td>&nbsp;</td>
</tr>

<tr><td colspan=8 align=center>
    <input type=button id="pat07add" class="button" value="Add" 
           onclick='tempDisable(this);AddConcessCard();'>
    <input type=button value="Close" class="button" 
           onclick='ConcCardClose();'>
</td></tr>

</table>
</form>
</div>

<span id="DVAColorTitle" style="display:none">DVA Card Colour</span>

<span id="DVAColorSelect" style="display:none">
  <select name=pmccd005 id=pmccd005 maxlength=20
           class="Mandatory" title="DVA Card Colour">
           <option></option>
           %PATWEB07.04.106.2
   </select>
</span>

<script type="text/javascript">
PageBodySection.style.height=PageBodySection.clientHeight -
                             (PageHeadingSection.clientHeight +
                              DFrameHeading.clientHeight)
PageHeadingSection.style.top=PageBodySection.clientHeight
</script>

<meta name="TemplateVersion" content="V12.00.00">
<meta name="TemplateHome"    content="standard">
<meta name="HelpFileName"    content="NoContextSet.html">
<meta name="CrossBrowser"    content="true">
<script type="text/javascript" src="../js/EmrMandatory.js"></script>
<script type="text/javascript" src="../js/emrweb0202003.js"></script>
<script type="text/javascript">
function CancelAction() {
  window.history.go(-1);
/*
  if (top.TogglePanel==null) 
    this.form.reset();
  else 
    top.TogglePanel();
*/
}
function TriageComplete() {
 site = document.UpdateForm.emvis132.value.substr(0,3);
 hosp = document.UpdateForm.emvis132.value.substr(3,3);
  if (ValidOG()) {  // validate Occupational Group
    if (!isWhitespace(hosp)) {
      if (!ChangeHospSite(hosp,site)) {
        alert("Failed to change user Hospital and Site");
        return;
      }
    }
    else {
      if (!ChangeSite(site)) {
        alert("Failed to change user Site");
        return;
      }
    }

    if (ChangeLogin()) {
      // reload top frame
      getTop().menu.location.href = getTop().menu.location.href;
    }
 }
 UpdateForm.AddButton.disabled=true;
 document.UpdateForm.redirect.value="emrweb02.pbl?reportno=1&template=13"
 if(!VEMDMandatory()) {
   UpdateForm.AddButton.disabled=false;
   return;
 }
 if (setFormactn()) { 
   UpdateForm.AddButton.disabled=false; 
 } else {
   setTimeout('UpdateForm.AddButton.disabled=false;',2000);
 }
}
function Validateprecom001() {
    onblurHandler();
    var formatedtext=formateText(UpdateForm.prcom001,'50');
    if((formatedtext.split(/[\r\n]/).length>6) || 
       (UpdateForm.prcom001.value.length > 300)) {
        alert("Presenting Complaint comments - Max 6 lines."
            + "\nPlease remove extra lines to continue.");
        document.UpdateForm.prcom001.focus();
        return; 
    }
    UpdateForm.prcom001.value=UpdateForm.prcom001.value.replace("\\","");
}
function expPatSurname() {
  onblurHandler();

  if (isWhitespace(UpdateForm.emvis118.value) &&
      !isWhitespace(UpdateForm.emvis111.value)) {
    var serverURL   = "../cgi-bin/emrweb08.pbl?reportno=35" +
                      "&valdcode=" + UpdateForm.emvis111.value.replace(/ /g,"+")
    var returnValue = RSExecute(serverURL);
    if (returnValue.status==0) {
      if (returnValue.return_value==1) {
       if(confirm("                WARNING\n"+
                   "  Expected Patient Match found\n"+
                   "\n"+
                   "       Do you want to use the\n"+
                   "       expected patient record?")) {
          location.href="emrweb01.pbl?reportno=01&template=009"
        }
      }
    }
  }
}
function RemoteEmrLocation(valdcode,valdrtyp,ReturnSelect) {
  ReturnFunction="" ;
  for (var i=1; i < RemoteEmrLocation.arguments.length; i++) {
  if (typeof(RemoteEmrLocation.arguments[i]) == 'function') {
     ReturnFunction=RemoteEmrLocation.arguments[i] } }
  var serverURL = "../cgi-bin/emrweb08.pbl?reportno=30" +
                  "&valdcode=" + valdcode.value.replace(/ /g,"+") +
                  "&valdrtyp=" + valdrtyp.value.replace(/ /g,"+")
  var returnValue = RSExecute(serverURL);
  ReturnValue=returnValue.return_value.split("|")
  if (returnValue.status==0) {
    ReturnSelect.options.length=0
    ReturnValue=returnValue.return_value.split("|");
    for (var j=0; j < ReturnValue.length; j++) {
       if (!isWhitespace(ReturnValue[j])) {
         SelectValue=ReturnValue[j].split(",");
         ReturnSelect.options[ReturnSelect.options.length]=
          new Option(SelectValue[1],SelectValue[0]);
       }
    }

    var p = document.UpdateForm;
    validateLocation(p.emvis006,p.name_emvis006);
  }
}
function DisplayPresentComplaintAddInfo() {
  f = document.UpdateForm;
  if (f.emcprcmp.value == "1") {
    document.getElementById('PresentComplaintAddInfo').style.display = "";
  }
  else {
    document.getElementById('PresentComplaintAddInfo').style.display = "none";
  }
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);refreshTop();
              VEMDFields();VEMDService();
              DisplayPresentComplaintAddInfo();
 setTimeout('document.UpdateForm.emvis127.focus()',500);">
<!--onBeforeUnload="chkFormSend(UpdateForm);">-->
<span class=DFrameTitleBar>
ETS Emergency Triage
</span>
<form name=UpdateForm action="emrweb02.pbl" method=post style="margin:0">
<input type=hidden name=reportno value="02">
<input type=hidden name=template value="001">
<input type=hidden name=formactn>
<input type=hidden name=updttype>
<input type=hidden name=updateky value="">
<input type=hidden name=nextpage value="3">
<input type=hidden name=returnfm value=1>
<input type=hidden name=redirect>
<input type=hidden name=deceased>
<input type=hidden name=selsex>
<input type=hidden name=gname>
<input type=hidden name=sname>
<input type=hidden name=dummyadm>
<input type=hidden name=dummy>
<input type=hidden name=dummsrch value="1">
<input type=hidden name=fpatname>
<input type=hidden name=urnumber>
<input type=hidden name=emvis004>
<input type=hidden name=emvis005>
<input type=hidden name=emvis128>
<input type=hidden name=emvis129>
<input type=hidden name=emvis135>
<input type=hidden name=emvis136>
<input type=hidden name=emvis137>
<input type=hidden name=emvis138>
<input type=hidden name=patsname>
<input type=hidden name=patgname>
<input type=hidden name=emexp001 value="">
<input type=hidden name="currdate" id="currdate" value="%STANDARD.01.013">
<input type=hidden name=ptcnhdps id="ptcnhdps"
 value="%STANDARD.01.025.080.250.1.1">
<input type=hidden name=emcnurse id=emcnurse
       value="%STANDARD.01.025.122.008.0.1">
<input type=hidden name=valdrtyp value="E">
<input type=hidden name=wbsecocg value="%STANDARD.01.012.3">
<input type=hidden name=emcprcmp id=emcprcmp
 value="%STANDARD.01.025.122.051.1.1">

<table align=center width=95% border=0 cellspacing=0 cellpadding=1>
<tr><td class=DataLabel>Site ID</td>
  <td><input type=hidden name=name_emvis132 title="Site ID">
    <select class="Mandatory" name="emvis132"
      title="Site ID"
      onchange="RemoteEmrLocation(this,UpdateForm.valdrtyp,
                UpdateForm.emvis006);">
      <option></option>
      %EMRWEB02.02.931.2
    </select>
  </td>
</tr>

<tr><td>Triaged By </td>
    <td><input type="text" name=emvis127 id=emvis127 tabindex=1 size=6 
         class=Mandatory  title="Triage Nurse"
         onblur="UpCase(this);validateNurse(UpdateForm.emvis127,
                 UpdateForm.dummy1);" >
        <input type=hidden name=gnm id=gnm>
        <input type="text" name=dummy1 id=dummy1 size=20 class=Readonly readonly>
        <img src=../images/SearchIcon.gif class=Icon
         onclick='SearchEDNurse(UpdateForm.emvis127,UpdateForm.dummy1);'></td>
    <td class=DataLabel>U/R
        <input type="text" size=10 maxlength=8 name=emvis118 tabindex=4
        onblur="justifyRight(this);PatientReturn();">
        <img src=../images/SearchIcon.gif class=Icon
         onclick="PatientSearch();">
    <td class=DataLabel>Surname</td>
    <td><input type=text size=25 max=25  name=emvis111 tabindex=4 
         onblur="UpCase(this);expPatSurname();"></td>
    <td class=DataLabel>Given Name</td>
    <td><input type=text size=25 max=25  name=emvis112 tabindex=5
         onblur="UpCase(this);onblurHandler();"></td></tr>

<tr><td></td>
    <td></td>
    <td></td>
    <td class=DataLabel>%STANDARD.01.017.G </td>
    <td><select name=emexp004 tabindex=6>
          %EMRWEB02.02.086.099.061.9.1.19.3.H
        </select></td>
    <td class=DataLabel>Date of Birth </td>
    <td><input type="text" size=12 max=11 name=emexp005  
         title="Date of Birth" class="Past Date" tabindex=7>
        <img src=../images/DateLookup.gif class=Icon
         date=document.UpdateForm.emexp005>
        </td></tr>
</table>

<table align=center width=95% border=0 cellspacing=0 cellpadding=1>
<tr valign=top><td class=DataLabel width=15%>Presenting Complaint </td>
  <td width=15%>
    <input type=hidden name=emrviscat value="el">
    <input type="text" size=10 tabindex=11 
      onKeyUp='UpCase(this);getPresentCom(this,UpdateForm.emvis060,
               UpdateForm.emrviscat);'
      onBlur='DisplayDiv()'>
    <select name=emvis060 class="SelectBig Mandatory" onchange="DisplayDiv();">
    </select>
  </td>
  <td colspan=4>
    <textarea type="text" name=prcom001 id=prcom001 wrap=hard tabindex=12
     cols=50 rows=6 style="overflow-y:hidden" class=AsciiOnly
     title="Presenting Complaint Comments"
     onkeydown="ValidateKeyInput(this);"
     onblur="TextareaBlurHandler(this);ValidateTextLimits(this);">
    </textarea> 
  </td>
</tr>
<tr valign=top id=PresentComplaintAddInfo>
  <td class=DataLabel width=15%></td>
  <td width=15%></td>
  <td colspan=4>
    <textarea type=text name=vicmt023 id=vicmt023 wrap=hard tabindex=12
     cols=50 rows=6 class=AsciiOnly
     title="Presenting Complaint - Additional Information"
     onkeydown="CheckPresentCompAddInfoTextLimit(this);"
     onblur="TextareaBlurHandler(this);">
    </textarea>
  </td>
</tr>
</table>

<div id=Triage></div>

<table width=95% align=center border=0 cellspacing=0 cellpadding=1>
<tr><td class=DataLabel width=15%>Location</td>
    <td><input type=hidden name=name_emvis006 title="Location">
        <select class="Mandatory" name="emvis006"
         title="Location" tabindex=11
         onchange="validateLocation(UpdateForm.emvis006,
                   UpdateForm.name_emvis006);">
        </select>
    </td>
    <td class=DataLabel>Number of Labels</td>
    <td><select name=nolabels width=50%>
         <option></option>
         %STANDARD.01.027.1.1
    </select></td>
    <td>Type
    <select name=labeltyp>
         %STANDARD.01.019.LABELEMR.1
         %STANDARD.01.019.LABELKNX.1
         %STANDARD.01.019.LABELHEC.1
 
    </select>
    </td>
    <td>Printer</td>
    <td><select name=lblprint colspan=2>
        %EMRWEB02.02.145.EMRTLBLS.01
        </select>
        </td></tr>

<tr><td width=15%>Triage Category</td>
   <td><table border=0 cellspacing=0>
   <tr>
   <td class=Triage1><i>1</i>
   <input type="radio" name=emvis003 value=1 tabindex=20 title="Triage Category"
   onclick="CheckMan();"></td>
   <td class=Triage2><i>2</i><input type=radio name=emvis003 value=2
   onclick="unCheck();"></td>
   <td class=Triage3><i>3</i><input type=radio name=emvis003 value=3
   onclick="unCheck();"></td>
   <td class=Triage4><i>4</i><input type=radio name=emvis003 value=4
   onclick="unCheck();"></td>
   <td class=Triage5><i>5</i><input type=radio name=emvis003 value=5
   onclick="unCheck();"></td>
   <td class=Triage6><i>6</i><input type=radio name=emvis003 value=6
   onclick="unCheck();"></td>
   </tr></table></td>
    <td>Number of Copies</td>
    <td><select name=nolabelf>
        <option></option>
        <option value="  1" selected>  1</option>
        <option value="  2">  2</option>
        <option value="  3">  3</option>
        <option value="  4">  4</option>
        <option value="  5">  5</option>
        <option value="  6">  6</option>
        <option value="  7">  7</option>
        <option value="  8">  8</option>
        <option value="  9">  9</option>
        <option value=" 10"> 10</option>
        </select></td>
        <td>Form
        <select name=statncod>
        <option></option>
        %STANDARD.01.020.  7
        </select></td>
    <td>Printer</td>
    <td><select name=frmprint>
      %EMRWEB02.02.145.EMRTFRMS.02
      </select></td></tr>

<tr><td class=DataLabel>%STANDARD.01.017.eu</td>
    <td>
    <input type=hidden name=name_emvis069>
    <select name=emvis069 tabindex=23 title="%STANDARD.01.017.eu" 
         class="SelectBig">
        <option></option>
        %EMRWEB02.02.229.2
        </select></td>
    <td></td>
    <td></td></tr>

<tr><td class="DataLabel">
    <div id="servicename" style="display: none">%STANDARD.01.035.YW</div></td>
    <td class="DataField">
       <div id="servicefield" style="display: none">
       <select name=emvis177 id="emvis177" tabindex=24
        title="%STANDARD.01.035.YW" class="SelectBig"
        onchange="VEMDPatientLoc();">
       <option></option>
        %EMRWEB02.02.296.4
        </select>
        </div></td>
    <td></td>
    <td></td></tr>

<tr><td class="DataLabel">
    <div id="locationname" style="display: none">%STANDARD.01.035.YX</div></td>
    <td class="DataField">
       <div id="locationfield" style="display: none">
       <select name=emvis178 id="emvis178" tabindex=25
        title="%STANDARD.01.035.YX" class="SelectBig"
        onchange="VEMDPatientSource();">
       <option></option>
        %EMRWEB02.02.297.4
        </select>
        </div></td>
    <td><div id="sourcename" style="display: none">Source</div></td>
    <td><div id="sourcefield" style="display: none">
        <input type=text size=6 maxlength=6 name=trnsfsrc id="trnsfsrc"
         title="Source" value="" tabindex=26 class=""
         onchange="validateCode(9,UpdateForm.trnsfsrc,
                   UpdateForm.name_trnsfsrc);">
        <input type=text size=30 name=name_trnsfsrc readonly tabindex=-1
         id="name_trnsfsrc" class="readonly" value="">
        <img src=../images/SearchIcon.gif class=Icon tabindex=27
         onclick="TransferSourceFrame(UpdateForm.trnsfsrc,
                  UpdateForm.name_trnsfsrc);">
        </div>
    </td></tr>

<tr><td colspan=7 align=center>
    <input type=button value="Add" class="button" tabindex=24 name="AddButton"
     onclick="TriageComplete();">
    <input type=button value="Cancel" class="button" tabindex=25
     onclick="CancelAction();">
    </td></tr>
</table>
</form>

<form name="ChangeSiteForm" action="websec01.pbl" method=post style="margin:0">
<input type=hidden name=reportno value="5">
<input type=hidden name=updttype value="U">
<input type=hidden name=username value="%STANDARD.01.008">
<input type=hidden name=wbsec011 value="1">
<input type=hidden name=wbsec010>
</form>

<form name="ChangeHospForm" action="websec01.pbl" method=post style="margin:0">
<input type=hidden name=reportno value="5">
<input type=hidden name=updttype value="U">
<input type=hidden name=chnghosp value="1">
<input type=hidden name=username value="%STANDARD.01.008">
<input type=hidden name=wbsec011 value="1">
<input type=hidden name=wbsec010>
<input type=hidden name=wbsec031>
</form>

<form name="ChangeLoginForm" action="websec01.pbl" method=post style="margin:0">
<input type=hidden name=reportno value="1">
<input type=hidden name=updttype value=" ">
</form>

<span id=EmergencyProc style="display:none;">
<table align=center cellspacing=1 cellpadding=0 border=0 width=95%>
<tr><td class=DataLabel width=15%>Place Where Injury Occurred</td>
    <td><select name="emvis021" class=SelectBig tabindex=15
         title="Place Where Injury Occurred">
    <option></option>
    %EMRWEB02.02.121.2
     </select></td>
    <td class=DataLabel>Activity When Injured</td>
    <td><select name="injur006" class=SelectBig title="Activity When Injured"
         tabindex=16>
    <option></option>
      %EMRWEB02.02.183.2
       </select></td>
    <td class=DataLabel> Injury Cause</td>
    <td><select name="injur004" class=SelectBig title="Injury Cause" 
         tabindex=17>
     <option></option>
     %EMRWEB02.02.181.2
     </select>
     </td></tr>

<tr valign=top><td class=DataLabel> Human Intent</td>
    <td><select name="injur005" class=SelectBig title="Human Intent"
         tabindex=18>
    <option></option>
     %EMRWEB02.02.182.2
      </select></td>
    <td class=DataLabel>
    Desc. of Injury Event</td>
    <td colspan=3><input type="text" name="injur002" maxlength="50" size="40"
         title="Description of Injury Event" value="" tabindex=19>
    <input type="text" name="injur003" maxlength="50" size="40" value=""
     tabindex=19></td></tr>
</table>
</span>

<script type="text/javascript">
//
   PatientSex="%EMRWEB02.02.086.082"
   for (var i =0 ; i < document.UpdateForm.emexp004.length; i++) {
     if (document.UpdateForm.emexp004.options[i].value.substr(0,1)==PatientSex.substr(0,1)) {
         document.UpdateForm.emexp004.selectedIndex=i } };
 LabelCop="%STANDARD.01.034.EMRTLBLS.01"
 for (var i=0;i<document.UpdateForm.nolabels.length;i++){
  if (document.UpdateForm.nolabels.options[i].value.replace(/ /g,"")==
      LabelCop.replace(/ /g,"")){
      document.UpdateForm.nolabels.selectedIndex=i}};

 LabelNam="%STANDARD.01.036.EMRTLBLS.01"
 for (var i=0;i<document.UpdateForm.labeltyp.length;i++){
  if (document.UpdateForm.labeltyp.options[i].value.replace(/ /g,"")==
      LabelNam.replace(/ /g,"")){
      document.UpdateForm.labeltyp.selectedIndex=i}};
//
 FormCop="%STANDARD.01.034.EMRTFRMS.02"
 for (var i=0;i<document.UpdateForm.nolabelf.length;i++){
  if (document.UpdateForm.nolabelf.options[i].value.replace(/ /g,"")==
      FormCop.replace(/ /g,"")){
      document.UpdateForm.nolabelf.selectedIndex=i}};

 FormNam="%STANDARD.01.033.EMRTFRMS.02"
 for (var i=0;i<document.UpdateForm.statncod.length;i++){
  if (document.UpdateForm.statncod.options[i].value.replace(/ /g,"")==
      FormNam.replace(/ /g,"")){
      document.UpdateForm.statncod.selectedIndex=i}};

function ValidOG() {
  // Check indicator 1 of user's OG (Occupational Group)
  // Valid if "E", otherwise invalid
  var p = document.UpdateForm;

  if (p.wbsecocg.value.substr(3,1) != "E") {
    alert("Invalid " + trim("%STANDARD.01.017.w0") + " !");
    return false;
  }

  return true;
}

function ChangeSite(SiteCode) {
  if (!SiteCode || isWhitespace(SiteCode))
    return false;

  var theURL = "websec01.pbl";
  var p = document.ChangeSiteForm;

  p.wbsec010.value = SiteCode;
  var postStr = AJAXPostString(p);

  xmlHttp = createHttpObject();
  xmlHttp.open("POST", theURL, false);
  xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded;");
  xmlHttp.send(postStr);

  if (xmlHttp.status=="200") {
    return true;
  }
  else {
    return false;
  }
}

function ChangeHospSite(HospCode, SiteCode) {
  if (!HospCode || !SiteCode ||
      isWhitespace(HospCode) || isWhitespace(SiteCode))
    return false;

  var theURL = "websec01.pbl";
  var p = document.ChangeHospForm;

  p.wbsec031.value = HospCode;
  p.wbsec010.value = SiteCode;
  var postStr = AJAXPostString(p);

  xmlHttp = createHttpObject();
  xmlHttp.open("POST", theURL, false);
  xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded;");
  xmlHttp.send(postStr);

  if (xmlHttp.status=="200") {
    return true;
  }
  else {
    return false;
  }
}

function ChangeLogin() {
  var theURL = "websec01.pbl";
  var p = document.ChangeLoginForm;

  var postStr = AJAXPostString(p);

  xmlHttp = createHttpObject();
  xmlHttp.open("POST", theURL, false);
  xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded;");
  xmlHttp.send(postStr);

  if (xmlHttp.status=="200") {
    return true;
  }
  else {
    return false;
  }
}
</script>

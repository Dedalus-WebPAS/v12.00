<meta name="TemplateVersion" content="V12.00.00">
<meta name="TemplateHome" content="stv">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/patweb7802.js"></script>
<script type="text/javascript">
function NewConsultation() {
  var urnumber = document.PatientLinks.urnumber.value.replace(/ /g,"+");
  var admissno = document.PatientLinks.admissno.value.replace(/ /g,"+");
  var ptcrc001 = document.UpdateForm.ptcrc001.value.replace(/ /g,"+");
  var ptcrc002 = document.UpdateForm.ptcrc002.value.replace(/ /g,"+");
  var showspec = document.UpdateForm.dispspec.value;
  var LinkUrl="patweb78.pbl?reportno=02&template=004&urnumber=" + urnumber +
              "&admissno=" + admissno + "&ptcrc001=" + ptcrc001 +
              "&ptcrc002=" + ptcrc002 + "&showspec=" + showspec;
  if (document.UpdateForm.ptcrc008 != undefined) {
    var ptcrc008 = document.UpdateForm.ptcrc008.value.replace(/ /g,"+");
    LinkUrl += "&ptcrc008=" + ptcrc008;
  }
  var Left=(document.body.clientWidth-500)/2;
  DFrameLink(LinkUrl,20,Left,500,350);
}

function UpdateConsultation(referringCons,referredCons,recNum,showspec,speclty)
{
  var urnumber = document.PatientLinks.urnumber.value.replace(/ /g,"+");
  var admissno = document.PatientLinks.admissno.value.replace(/ /g,"+");
  var ptcrc001 = referringCons.replace(/ /g,"+");
  var ptcrc002 = referredCons.replace(/ /g,"+");
  var ptcrc003 = recNum.replace(/ /g,"+");
  var LinkUrl="patweb78.pbl?reportno=02&template=005&urnumber=" + urnumber +
              "&admissno=" + admissno + "&ptcrc001=" + ptcrc001 +
              "&ptcrc002=" + ptcrc002 + "&ptcrc003=" + ptcrc003 + 
              "&showspec=" + showspec + "&ptcrc008=" + speclty;
  var Left=(document.body.clientWidth-500)/2;
  DFrameLink(LinkUrl,20,Left,500,350);
}

function UpdateCrossCons() {
  if (!validateMandatory(UpdateForm))
    return;

  var oldDoct = trim(document.UpdateForm.origdoct.value);
  var oldRefd = trim(document.UpdateForm.origrefd.value);
  var newDoct = trim(document.UpdateForm.ptcrc001.value);
  var newRefd = trim(document.UpdateForm.ptcrc002.value);

  // Check if still the same consultants combination
  if (oldDoct != newDoct || oldRefd != newRefd) {    // Different combination
    if (!chkCombination()) {                         // Invalid combination
      alert("Combination Already Exists");
      document.UpdateForm.ptcrc001.focus();
      return;
    }
  }
  document.UpdateForm.submit();
}

function SpecialitySelected(obj) {
  if (obj.selectedIndex == 0) {
    UpdateForm.ptcrc002.className = "Mandatory";  // Referred HCP
  }
  else {
    UpdateForm.ptcrc002.className = "";           // Referred HCP
  }
  UpdateForm.ptcrc008.className = "";             // Speciality
}

function valDoctorUnit() {
  ValidateHCP(18,0,UpdateForm.ptcrc002,UpdateForm.name_ptcrc002);
  if (UpdateForm.dispspec.value == "1") {
    if (UpdateForm.ptcrc002.value.length > 0) {
      // is a valid HCP; get their Specialities
      selectOptions2("45",UpdateForm.ptcrc002,UpdateForm.ptcrc008);
    }
    else {
      // no linked Specialities; pull complete list down from server
      selectOptions3("15",UpdateForm.CATEG_AC,UpdateForm.ptcrc008);
    }

    if (UpdateForm.ptcrc008.selectedIndex > 0){
      UpdateForm.ptcrc002.className = "";
    }
  }
}

function SelSpeciality() {
  // select the speciality for this Cross Consultation (if exists)
  if (UpdateForm.ptcrc008 == undefined) return;
  
  var specCode = UpdateForm.d_spclty.value;
  for (var i=0; i < UpdateForm.ptcrc008.length; i++) {
    if (UpdateForm.ptcrc008.options[i].value.substr(0,3) == specCode) {
      UpdateForm.ptcrc008.selectedIndex = i;

      // make Referred Consultant non-mandatory
      UpdateForm.ptcrc002.className = "";  
    }
  }
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);valDoctorUnit();SelSpeciality();">
<span class=DFrameTitleBar id=DFrameHeading>
<img align="right" alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="DFrameExitRefresh();">
 Cross Consultation Details                      
</span>
<div id=PageHeadingSection>
<form name=UpdateForm action=patweb78.pbl method=post style="margin:0">
<input type=hidden name=reportno value=2>
<input type=hidden name=template value=003>
<input type=hidden name=urnumber value="%PATWEB78.02.003">
<input type=hidden name=admissno value="%PATWEB78.02.081">
<input type=hidden name=updttype value="C">
<input type=hidden name=origdoct value="%PATWEB78.02.202.001">
<input type=hidden name=origrefd value="%PATWEB78.02.203.001">
<input type=hidden name=dispspec id=dispspec value="%PATWEB78.02.214">
<input type=hidden name=d_spclty value="%PATWEB78.02.216">
<input type=hidden name=savecntr value="%PATWEB78.02.217">
<input type=hidden name=CATEG_AC value="AC">

<table width=90% border=0 cellpadding=1 cellspacing=0 align=center>
  <tr><td class=DataLabel>Referring Consultant
      <td class=DataField>
        <input type=text name=ptcrc001 size=6 maxlength=6 class=Mandatory
         title='Referring Consultant' value="%PATWEB78.02.202.001"
         onblur="UpCase(this);
                 ValidateHCP(18,
                             0,
                             UpdateForm.ptcrc001,
                             UpdateForm.name_ptcrc001);">
        <input notab type=text name=name_ptcrc001 size=22 maxlength=30
         readonly class=Readonly value="%PATWEB78.02.202.081">
        <img notab src="../images/SearchIcon.gif" class=Icon 
         onclick="HCPSearchFrame(UpdateForm.ptcrc001,
                                 UpdateForm.name_ptcrc001,
                                 0)"></td></tr>
  <tr><td class=DataLabel>Referred Consultant
      <td class=DataField>
        <input type=text name=ptcrc002 size=6 maxlength=6 class=Mandatory
         title='Referred Consultant' value="%PATWEB78.02.203.001"
         onblur="UpCase(this);valDoctorUnit();">
        <input notab type=text name=name_ptcrc002 size=22 maxlength=30
         readonly class=Readonly value="%PATWEB78.02.203.081">
        <img notab src="../images/SearchIcon.gif" class=Icon
         onclick="HCPSearchFrame(UpdateForm.ptcrc002,
                                 UpdateForm.name_ptcrc002,
                                 0,
                                 valDoctorUnit);"></td></tr>

  <tr><td class=DataLabel><span id=SpecialityLbl></span></td>
      <td class=DataField><span id=SpecialityVal></span></td></tr>

  <tr><td class=DataLabel>Comments
      <td class=DataField>
        <input type=text name=ptcrc004 size=40 maxlength=40
         value="%PATWEB78.02.204"></td></tr>
  <tr><td class=DataLabel>Total Hours
      <td class=DataField>
        <input type=text name=totalhrs size=8 maxlength=10
         value="%PATWEB78.02.205" readonly class=Readonly></td></tr>

</table>
<br>
</div>
<div id=PageBodySection>
<table width=80% border=1 cellpadding=0 cellspacing=0 align=center>
<tr><td class=HeadingCell colspan=4 align=center>Consultations</td></tr>
<tr><td class=HeadingCell align=center width=10%>&nbsp;Update</td>
    <td class=HeadingCell align=center>&nbsp;Date</td>       
    <td class=HeadingCell align=center>&nbsp;Time Spent</td>       
    <td class=HeadingCell align=center>&nbsp;Service Code</td>       
%PATWEB78.02.206   
</table>
</div>
</form>

<div id=ButtonSection>
<table width=90% border=0 align=center>
<tr><td><hr></td></tr>
<tr><td align=center>
    <input type=button value="New Consultation" class=Bigbutton id=btnNew
     onclick='tempDisable(this);NewConsultation()'>
    <input type=button value="Update" class=button id=btnUpdate 
     onclick='tempDisable(this);UpdateCrossCons()'>
    <input type=button value="Cancel" class=button 
     onclick='DFrameCloseRefresh()'>
</td></tr>
</table>
</div>

<span id="spSpecLbl" style="display:none">Speciality</span>
<span id="spSpecVal" style="display:none">
  <select name=ptcrc008 id=ptcrc008 title="Speciality"
    onchange="SpecialitySelected(this)">
    <option> </option>
    %PATWEB78.02.215.2
  </select>
</span>


<script type="text/javascript">
  PageBodySection.style.height=document.body.clientHeight - 
                             PageHeadingSection.clientHeight;

  var hDispSpec = document.getElementById('dispspec');
  if (hDispSpec.value == '1') {
    var spLbl = document.getElementById('spSpecLbl');
    var spVal = document.getElementById('spSpecVal');
    var SpecLbl = document.getElementById('SpecialityLbl');
    var SpecVal = document.getElementById('SpecialityVal');

    if (spLbl && spVal && SpecLbl && SpecVal) {
      SpecLbl.innerHTML = spLbl.innerHTML;
      SpecVal.innerHTML = spVal.innerHTML;
      spVal.innerHTML = "";

      var ddlSpec = document.getElementById('ptcrc008');
      if (ddlSpec && (ddlSpec.selectedIndex == 0)) {
        document.UpdateForm.ptcrc002.className = "Mandatory";
      }
      else {
        document.UpdateForm.ptcrc002.className = "";
      }
    }
  }
  else {
    document.UpdateForm.ptcrc002.className = "Mandatory";  // Referred HCP
  }
</script>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=2>
<input type=hidden name=template value=003>
<input type=hidden name=urnumber value="%PATWEB78.02.003">
<input type=hidden name=admissno value="%PATWEB78.02.081">
<input type=hidden name=MenuType value="%PATWEB78.02.088">
</form>

<meta name="TemplateVersion" content="V12.00.01">
<meta name="TemplateHome" content="stv">
<meta name="CrossBrowser" content="true">
<meta name="HelpFileName" content="NoContextSet.html">
<script type="text/javascript" src="../js/TableSort.js"> </script>
<script type="text/javascript" src=../js/TableSort1.js></script>
<script type="text/javascript" src="../js/oprweb0122.js"> </script>
%START.OF.PAGE
<script type="text/javascript">

function TableSort(OrderColumn) {
 document.title="Unscheduled Theatre Requests"
 if ( lastOrderColumn == OrderColumn ) {
   if (AscDsc==1) {AscDsc=2;} else {AscDsc=1;} }
 else {
   AscDsc=1; }
 TableOutput(OrderColumn,AscDsc);
 GetPriorityandBreachTimeUnscheduled();
}

function TableSort1(OrderColumn) {
 document.title="Completed Cases"
 if ( lastOrderColumn == OrderColumn ) {
   if (AscDsc==1) {AscDsc=2;} else {AscDsc=1;} }
 else {
   AscDsc=1; }
 TableOutput1(OrderColumn,AscDsc);
 GetPriorityandBreachTimeCompleted();
}

function TableEnding()
{
  TableString[TableString.length] = "</table></div>";

  // these are defined in the html
  var TableLocation = document.getElementById('TableLocation');
  var HeadingSection = document.getElementById('HeadingSection');

  // unload the array into continuous html render
  if (TableString.join) // if join method is available;
  {
    TableLocation.innerHTML = TableString.join("");
  }
  else
  {
    var TableStringX="";
    for (i=0;i < TableString.length; i++)
    {
       TableStringX+=TableString[i];
    }
    TableLocation.innerHTML = TableStringX;
  }

  // these are defined in the code we just rendered
  var HeadingDivision = document.getElementById('HeadingDivision');
  var BodyDivision    = document.getElementById('BodyDivision');

  // calculate the available table height based on the view frame height
  var th = getClientHeight();  // view frame height

  if (HeadingSection)
  {
     th -= HeadingSection.clientHeight;
     TableLocation.style.top = HeadingSection.clientHeight + 'px';
  }
  else
     TableLocation.style.top = '0px';

  th -= HeadingDivision.clientHeight;
  //BodyDivision.style.height = th + 'px';

  //if (BodyDivision.scrollHeight >  BodyDivision.clientHeight)
  //  HeadingDivision.style.overflow = 'scroll';
  //else
  //  HeadingDivision.style.overflow = 'hidden';

  BodyDivision.style.height = "auto";

}


function InitTableSort(TableView) {

// UNSCHEDULED THEATRE CASES

  if (document.theatreForm.sesstype.value.substr(3,1)!="E") {return;}

  document.getElementById('ThetReqButton').style.display="";
  document.getElementById('ThetNewButton').style.display="none";

  document.title="Unscheduled Theatre Requests"

  document.theatreForm.sortview.value=TableView;

  switch (TableView) {
    case 0: {
      t = new Table(1,0,1,"100%","center",40);    // Create New Table Object
//
// Add Columns in Order Required
// Heading,Type,Display Column,Sort Column,Align
//
      t.addColumn("Priority","String",1,1,"left","","",25)
      t.addColumn("Patient","String",2,2,"left","","",100)
      t.addColumn("Alerts","String",3,3,"left","","",50)
      t.addColumn("Operation Description","String",4,4,"left","","",50)
      t.addColumn("Requesting Doctor","String",5,5,"left","","",50)
      t.addColumn("Unit","String",6,6,"left","","",50)
      t.addColumn("Equipment","String",25,25,"left","","",50)
      t.addColumn("Consent Obtained/Stat","String",28,28,"left","","",50)
      t.addColumn("Request Time/ <br>Clock Start Time","String",26,26,
                  "left","","",50)
      t.addColumn("Wait","String",10,10,"left","","",50)
      t.addColumn("&nbsp;","String",12,12,"center","","",50)
//
      AddTableRows()
      TableOutput(0,1)
      GetPriorityandBreachTimeUnscheduled();
      break;
    }
  }

// COMPLETED CASES

  if (document.theatreForm.opcnutra.value!="1") {return;}

  documentTitle2="Completed Cases"

  switch (TableView) {
    case 0: {
      t1 = new Table1(1,0,1,"100%","center",40);    // Create New Table Object
      t1.addColumn("Priority","String",1,1,"center","","",39)
      t1.addColumn("Time","String",2,2,"left","","",50)
      t1.addColumn("Duration","String",3,3,"left","","",50)
      t1.addColumn("Name","String",4,4,"left","","",200)
      t1.addColumn("Alerts","String",5,5,"left","","",100)
      t1.addColumn("Adm No","String",6,6,"left","","",50)
      t1.addColumn("Operation Description","String",7,7,"left","","",100)
      t1.addColumn("Usage","String",8,8,"left","","",50)
      t1.addColumn("Theatre","String",9,9,"left","","",75)
      t1.addColumn("Surgeon","String",15,15,"left","","",50)
      t1.addColumn("Case No","String",10,10,"left","","",50)
      t1.addColumn("Status","String",11,11,"left","","",75)
      t1.addColumn("Request Time/ <br>Clock Start Time","String",12,12,
                   "left","","",125)
      t1.addColumn("Wait","String",13,13,"left","","",75)

      AddTableRows1();
      TableOutput1(0,1);
      GetPriorityandBreachTimeCompleted();
      break;

    }
  }

}
function SummaryPage() {
  GoCookiePath("ReturnPath");
}
function fnPatientSearch() {
if("%OPRWEB01.03.176.2"!="        "){
   alert("ERROR - Session is finalised - No new bookings can be made.\n" +
         "Please reset to Provisional to make changes to this session.");
   return false;
}
if (ChkLock(0)) {
   if(LinkForm.cancsess.value==0) {
     alert("Cannot book Theatre, Session is Cancelled");
   }
   else {
   linkUrl="patweb90.pbl?reportno=1&template=201"
   DFrameLink(linkUrl,0,50,1100,700)
   }
 }
}
function ChkLock(flag) {
  numlock=parseInt(LinkForm.sesslock.value)
  daylock=parseInt(LinkForm.noofdays.value)
  if(numlock>daylock) {
    if (flag==0) alert("Session is locked. Cannot Book patients");
    else alert("Session is locked. Cannot Cancel Session");
    return false;
 }
  else return true;
}
function InputActuals(SessionKey) {
  if (document.LinkForm.cancsess.value==0) {
    alert('Cannot Perform Input Actuals. Session is Cancelled.');
    return;
  }
  opses074=SessionKey.substr(0,3).replace(/ /g,"+");
  opses001=SessionKey.substr(3,8).replace(/ /g,"+");
  opses002=SessionKey.substr(11,5).replace(/ /g,"+");
  opses003=SessionKey.substr(16,6).replace(/ /g,"+");

  LinkUrl="oprweb05.pbl?reportno=2&template=6&opses074="+opses074+
                                            "&opses001="+opses001+
                                            "&opses002="+opses002+
                                            "&opses003="+opses003
  Left=(document.body.clientWidth-425)/2
  DFrameLink(LinkUrl,0,Left,425,250)
}
function DefaultTeam(SessionKey) {
  if (document.LinkForm.cancsess.value==0) {
    alert('Cannot Perform Default Team. Session is Cancelled.');
    return;
  }
  opses074=SessionKey.substr(0,3).replace(/ /g,"+");
  opses001=SessionKey.substr(3,8).replace(/ /g,"+");
  opses002=SessionKey.substr(11,5).replace(/ /g,"+");
  opses003=SessionKey.substr(16,6).replace(/ /g,"+");

  LinkUrl="oprweb05.pbl?reportno=2&template=7&opses074="+opses074+
                                            "&opses001="+opses001+
                                            "&opses002="+opses002+
                                            "&opses003="+opses003
  Left=(document.body.clientWidth-800)/2
  DFrameLink(LinkUrl,0,Left,800,550)
}
function EditStartTime(CaseKey) {
  if(LinkForm.cancsess.value==0) {
     alert("Cannot Edit Time, Session is Cancelled");
     return;
  }
  LinkUrl="oprweb01.pbl?reportno=4&template=19&casekeys="
                        + CaseKey.replace(/ /g,"+");
  Left=(document.body.clientWidth-410)/2
  DFrameLink(LinkUrl,100,Left,410,220)
}
function AdjustStartTime(SessionKey) {
  if(LinkForm.cancsess.value==0) {
     alert("Cannot Adjust Time, Session is Cancelled");
     return;
  }
  LinkUrl="oprweb01.pbl?reportno=19&template=1&sesskeys="
                        + SessionKey.replace(/ /g,"+");
  Left=(document.body.clientWidth-410)/2
  DFrameLink(LinkUrl,100,Left,410,220)
}
function Finalisation(SessionKey) {
  if (document.LinkForm.cancsess.value==0) {
    alert('Cannot Perform Finalisation. Session is Cancelled.');
    return;
  }
  opses074=SessionKey.substr(0,3).replace(/ /g,"+");
  opses001=SessionKey.substr(3,8).replace(/ /g,"+");
  opses002=SessionKey.substr(11,5).replace(/ /g,"+");
  opses003=SessionKey.substr(16,6).replace(/ /g,"+");

  LinkUrl="oprweb05.pbl?reportno=2&template=9&opses074="+opses074+
                                            "&opses001="+opses001+
                                            "&opses002="+opses002+
                                            "&opses003="+opses003;
  Left=(document.body.clientWidth-390)/2
  DFrameLink(LinkUrl,100,Left,390,320)
}
function ChangeTheatre(SessionKey) {
  if(LinkForm.cancsess.value==0) {
     alert("Cannot Change Theatre, Session is Cancelled");
     return;
  }
  opses074=SessionKey.substr(0,3).replace(/ /g,"+");
  opses001=SessionKey.substr(3,8).replace(/ /g,"+");
  opses002=SessionKey.substr(11,5).replace(/ /g,"+");
  opses003=SessionKey.substr(16,6).replace(/ /g,"+");

  LinkUrl="oprweb05.pbl?reportno=2&template=4&opses074="+opses074+
                                            "&opses001="+opses001+
                                            "&opses002="+opses002+
                                            "&opses003="+opses003
  Left=(document.body.clientWidth-410)/2
  DFrameLink(LinkUrl,0,Left,410,380)
}
function CancelSession(SessionKey) {
   if (ChkLock(1)) {
  opses074=SessionKey.substr(0,3).replace(/ /g,"+");
  opses001=SessionKey.substr(3,8).replace(/ /g,"+");
  opses002=SessionKey.substr(11,5).replace(/ /g,"+");
  opses003=SessionKey.substr(16,6).replace(/ /g,"+");

  LinkUrl="oprweb05.pbl?reportno=2&template=5&opses074="+opses074+
                                            "&opses001="+opses001+
                                            "&opses002="+opses002+
                                            "&opses003="+opses003
  Left=(document.body.clientWidth-410)/2
  DFrameLink(LinkUrl,0,Left,410,320)
  }
}
function DisplayCommentsButton() {
  if(document.theatreForm.opcnscom.value==1) {
    if(document.theatreForm.comindic.value==1) {
      CommentsDiv.innerHTML=redcommentsdiv.innerHTML;
    } else {
      CommentsDiv.innerHTML=commentsdiv.innerHTML;
    }
  } else {
    CommentsDiv.innerHTML=blanklabel.innerHTML;
  }
}
function disComments() {
  Left=(document.body.clientWidth-510)/2
  DFrameSubmit(SelectCode,0,Left,630,500)
}
function PatientAlerts(urnumber,admissno) {
  linkurl="patweb98.pbl?reportno=1&template=003" +
          "&urnumber=" + urnumber + "&admissno=" + admissno
  location.href=linkurl
}
function TheatreReq() {

  SetCookie("TheatreSesReqCookie",location.href);

  location.href="oprweb01.pbl?reportno=22&template=2"
}
function CheckFin(form){
  if("%OPRWEB01.03.176.2"!="        "){
     alert("ERROR - Session is Finalized - No changes can be made.\n"+
           "Please reset to Provisional to make changes to this session.");
     return false;
  }
  form.submit();
}
</script>
</head>
<body onload="PageLoad(event);DisplayCommentsButton();
              SetCookiePath('CasePath',600);
              GetPriorityandBreachTime();
              InitTableSort(0);addScrollBarToCaseList();
              populateTimeDurationReq();">
<form name=theatreForm method=get style="margin:0">
<input type=hidden name=opcnscom value="%OPRWEB01.03.006">
<input type=hidden name=comindic value="%OPRWEB01.03.007">
<input type=hidden name=sesskeys value="%OPRWEB01.03.101">
<input type=hidden name=sesstype id=sesstype value="%OPRWEB01.03.169.3">
<input type=hidden name=sortview value="">
<input type=hidden name=opcnutra value="%OPRWEB01.03.021">
<input type=hidden name=lastsltt id=lastsltt value="%OPRWEB01.03.022">
<input type=hidden name=breksltt id=breksltt value="%OPRWEB01.03.110">
<input type=hidden name=prepsltt id=prepsltt value="%OPRWEB01.03.111">
</form>

<table width=100% cellspacing=0 border=0 bgcolor=#CCCCCC>
<tr><td class=HeadingCell align=left>
    <img src=../images/ListIcon.gif class=Icon onclick='SummaryPage();'></td>
    <td class=HeadingCell width=100% align=center>
    Theatre Session Case List %OPRWEB01.03.174 - %OPRWEB01.03.117.0</td>
    <td class=HeadingCell align=right>%OPRWEB01.03.176.1</td></tr>
</table>

<table width=100% cellspacing=0 border=0 bgcolor=#CCCCCC>
<tr><td width=15% class=DataLabel>Surgeon   </td>  
    <td ><a href='javascript:DoctorViewFrame("%OPRWEB01.03.104.003")'>
         <b>%OPRWEB01.03.104.002 &nbsp; </b></a></td>
    <td width=15%>Anaesthetist   </td>
    <td ><a href='javascript:DoctorViewFrame("%OPRWEB01.03.116.003")'>
         %OPRWEB01.03.116.002</a></td></tr>

<tr><td width=15% class=DataLabel>Theatre  </td>
    <td class=DataField>%OPRWEB01.03.114.0 </td>
    <td class=DataLabel>Session Type</td>
    <td class=DataField>%OPRWEB01.03.169.0  </td>
    <td><div id=CommentsDiv></div></td></tr>

<tr><td class=DataLabel>Date  </td>
    <td class=DataField>%OPRWEB01.03.106 %OPRWEB01.03.102</td>
    <td class=DataLabel>Time  </td>
    <td class=DataField> %OPRWEB01.03.103 to %OPRWEB01.03.108</td></tr>

<tr><td class=DataLabel>Special Instructions</td>
    <td class=DataField>%OPRWEB01.03.166</td>
    <td class=DataLabel>Unit</td>   
    <td class=DataField>%OPRWEB01.03.113.0  </td>
    <td class=DataField>%OPRWEB01.03.167</td></tr>
</table>

<table width=100% border=1 cellspacing=0 >
%OPRWEB01.03.032
%OPRWEB01.03.024.oprweb01.04.001.1.1
</table>

<table width=100% cellspacing=0 border=0 bgcolor=#CCCCCC>
<tr><td align=center>
    <input type=button class="button" value="New"
     onclick="tempDisable(this); fnPatientSearch();" id=ThetNewButton>
    <input type=button class="button" value="New Request" style="display:none" 
     onclick="tempDisable(this); TheatreReq();" id=ThetReqButton>
    <input type=button class="button" value="Change Theatre" id="changeTheatre"
     onclick='tempDisable(this); ChangeTheatre("%OPRWEB01.03.101");'>
    <input type=button class="button" value="Cancel Session" id="cancelSession"
     onclick='tempDisable(this); CancelSession("%OPRWEB01.03.101");'>
    <input type=button class="button" value="Input Actuals" id="inactbutt"
     onclick='tempDisable(this); InputActuals("%OPRWEB01.03.101");'>
    <input type=button class="button" value="Default Team" name=DefaultTeamButt
     id=DefaultTeamButt
     onclick='tempDisable(this); DefaultTeam("%OPRWEB01.03.101");'>
    <input type=button class="button" value="Adjust Times" id="adjstTimes"
     onclick='tempDisable(this); AdjustStartTime("%OPRWEB01.03.101");'>
    <input type=button class="button" value="Finalisation" id="FinBut"
     onclick='tempDisable(this); Finalisation("%OPRWEB01.03.101");'>
    <input type=button class="button" value="Exit" id="exit" 
           onclick="tempDisable(this); fnReturnPath()">
</td></tr>
</table>

<div id="TableLocation" >
</div>
<div id="TableLocation1" >
</div>

<form name=LinkForm method=post action=oprweb01.pbl style="margin:0">
<input type=hidden name=reportno value=9>
<input type=hidden name=template value=2>
<input type=hidden name=urnumber value="">
<input type=hidden name=sesskeys value="%OPRWEB01.03.101">
<input type=hidden name=cancsess value="%OPRWEB01.03.117.1">
<input type=hidden name=sesslock value="%OPRWEB01.03.168">
<input type=hidden name=noofdays value="%OPRWEB01.03.005">
</form>
<form name=Registration method=get action="patweb89.pbl" style="margin:0">
<input type=hidden name=reportno value=05>
<input type=hidden name=template value=001>
<input type=hidden name=srchsnam value="">
<input type=hidden name=srchgnam value="">
<input type=hidden name=srchpdob value="">
<input type=hidden name=srchpage value="">
<input type=hidden name=srchpsex value="">
<input type=hidden name=temporar value="0">
<input type=hidden name=sesskeys value="%OPRWEB01.03.101">
<input type=hidden name=cancsess value="%OPRWEB01.03.117.1">
<input type=hidden name=sesslock value="%OPRWEB01.03.168">
<input type=hidden name=noofdays value="%OPRWEB01.03.005">
<input type=hidden name=theaflag value="1">
</form>
<form name=NewRegistration method=get action=patweb89.pbl style="margin:0">
<input type=hidden name=reportno value=05>
<input type=hidden name=template value=004>
<input type=hidden name=srchsnam value="">
<input type=hidden name=srchgnam value="">
<input type=hidden name=srchpdob value="">
<input type=hidden name=srchpage value="">
<input type=hidden name=srchpsex value="">
<input type=hidden name=temporar value="1">
<input type=hidden name=sesskeys value="%OPRWEB01.03.101">
<input type=hidden name=cancsess value="%OPRWEB01.03.117.1">
<input type=hidden name=sesslock value="%OPRWEB01.03.168">
<input type=hidden name=noofdays value="%OPRWEB01.03.005">
<input type=hidden name=theaflag value="1">
</form>

<span id=commentsdiv style="display:none">
   <input type=button value="Comments" class="button" onclick="disComments();">
</span>

<span id=redcommentsdiv style="display:none">
   <input type=button value="Comments" class=RedButton onclick="disComments();">
</span>

<span id=blanklabel style="display:none">&nbsp;</span>

<form name=SelectCode method=get action=oprweb05.pbl style="margin:0">
<input type=hidden name=reportno value="2">
<input type=hidden name=template value="008">
<input type=hidden name=opses001 value="%OPRWEB01.03.102">
<input type=hidden name=opses002 value="%OPRWEB01.03.103">
<input type=hidden name=opses003 value="%OPRWEB01.03.104.003">
</form>

<script type="text/javascript">
function AddTableRows() {
%OPRWEB01.03.276
}

if ("%OPRWEB01.03.183" == "1") {
  document.getElementById('DefaultTeamButt').className = "RedButton";
}
if("%OPRWEB01.03.176.2"!="        "){
   document.getElementById("FinBut").className = "RedButton";
}

function AddTableRows1() {
%OPRWEB01.03.020
}

</script>

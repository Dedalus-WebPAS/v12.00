<meta name="TemplateVersion" content="V12.00.00">
<meta name="TemplateHome" content="stv">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript">
function ManUR() {
  if ( document.UpdateForm.cgenrur.value == "0" ) {
    URField.innerHTML=URFieldRow.innerHTML;
  }
}
function alternateID() {
  if ( document.UpdateForm.ptcnualt.value == "1" ) {
    AlternateID.innerHTML=AlternateIDRow.innerHTML;
    document.UpdateForm.typeurno[0].checked=true;
  }
}
function MergePatients() {
 if(!valTemp()){
  return;}
if(validateMandatory(UpdateForm)) {
 if (UpdateForm.cgenrur.value=="0") {
   if (UpdateForm.urnumbe1.value==UpdateForm.urnumbe2.value) {
     alert("Both U/R Number are the same.")
     return }
  
     AddForm.oldurnum.value=UpdateForm.urnumbe1.value
     AddForm.newurnum.value=UpdateForm.urnumbe2.value 
     document.AddForm.redirect.value="mrtweb02.pbl?reportno=5&template=001"
     + "&oldurnum=" + document.UpdateForm.urnumbe1.value.replace(/ /g,"+")
     + "&newurnum=" + document.UpdateForm.urnumbe2.value.replace(/ /g,"+")
  } else {
   AddForm.oldurnum.value=UpdateForm.urnumbe1.value
   document.AddForm.redirect.value="mrtweb02.pbl?reportno=5&template=001"
   + "&oldurnum=" + document.UpdateForm.urnumbe1.value.replace(/ /g,"+")}
//
   tempDisable(document.UpdateForm.pat83sub,10);
   AddForm.submit();
 }
}
//
function validateRecordID1() {
  if(isWhitespace(document.UpdateForm.urnumbe1.value)) {
    return;
  }
  if ( document.UpdateForm.ptcnualt.value == "1" ) {
  if(document.UpdateForm.typeurno[1].checked){
    if(!checkAlpha(document.UpdateForm.urnumbe1)){
      return;}
    }
  }
 if(!valTemp()){
  return;}
 p=document.UpdateForm
 if(p.urnumbe1.value!="") {
   LenUR=p.urnumbe1.value.length
   if (LenUR < 9) { 
      Count= 8 - LenUR ;
      Blanks="";
      for (i=0; i < Count;i++) { Blanks+=" ";}
      p.urnumbe1.value=Blanks + p.urnumbe1.value }
   validateCode(13,p.urnumbe1,p.fna1,UpdateUR1,p.sex1,p.dob1,p.pce1,p.dum1,p.admissn1,
         p.da1,p.typ1,p.age1,p.medi1,p.adda1,p.addb1,p.sub1,p.addc1,p.post1,
         p.dummy,p.dummy,p.dummy,p.ihos,p.uhos)}
 if(p.ihos.value!=p.uhos.value){
 ans=confirm("Warning : UR not created by this hospital")
 if (!ans) {
 p.urnumbe1.value="";
 p.urnumbe1.focus();
 return } }
}
//
function checkAlpha(theField) {
 startkey=theField.value.substr(0,1)
 checkid=startkey.search('[a-zA-Z]')
 if((startkey=="T")||(checkid < 0)) {
   alert("Must be a valid alternate ID");
   theField.value=""
   theField.focus()
   return false }
   return true; 
}
//
function valTemp(){
if ( document.UpdateForm.ptcnualt.value == "1" ) {
  if(document.UpdateForm.typeurno[1].checked){
  return true;}
 }
if(document.UpdateForm.urnumbe1.value.length < 8 ) {
   alert("Must be a valid temporary U/R number");
   document.UpdateForm.urnumbe1.value="";
    document.UpdateForm.urnumbe1.focus();
    return false;
  }
  ans=document.UpdateForm.urnumbe1.value.substr(1,1);
  if(ans != "-" ) {
    alert("Must be a valid temporary U/R number");
    document.UpdateForm.urnumbe1.value="";
    document.UpdateForm.urnumbe1.focus();
    return false; }
  return true;
}
function validateRecordID2() {
 p=document.UpdateForm
 if(p.urnumbe2.value!="") {
   LenUR=p.urnumbe2.value.length
   if (LenUR < 9) { 
      Count= 8 - LenUR ;
      Blanks="";
      for (i=0; i < Count;i++) { Blanks+=" ";}
      p.urnumbe2.value=Blanks + p.urnumbe2.value }

      var serverURL   = "../cgi-bin/patweb80.pbl?reportno=33" +
                    "&valdcode=" + p.urnumbe2.value.replace(/ /g,"+")

      var returnValue = RSExecute(serverURL);

      if (returnValue.status==0) {
        ReturnValue=returnValue.return_value.split("|")
        ExistFlag=ReturnValue[0];
        if (ExistFlag=="1") {
          alert("New U/R number already exists");
          document.UpdateForm.urnumbe2.value="";
          document.UpdateForm.urnumbe2.focus();
          return;
        }
      } else {
        document.UpdateForm.urnumbe2.value="";
        document.UpdateForm.urnumbe2.focus();
      }
    }
} 
//
function UpdateUR1() {
  if (document.UpdateForm.dum1.value != document.UpdateForm.urnumbe1.value) {
     alert("UR Number Merged with " + document.UpdateForm.dum1.value )
     document.UpdateForm.urnumbe1.value = "" ;
     document.UpdateForm.urnumbe1.focus()}
}

</script>
%START.OF.PAGE
</head>
<body onload="PageLoad(event);ManUR();alternateID();">
<form name=UpdateForm method=post action=patweb83.pbl style=margin:0>
   <input type=hidden name=reportno value="2">
   <input type=hidden name=template value="002">
   <input type=hidden name=admissn1 value="">
   <input type=hidden name=admissn2 value="">
   <input type=hidden name=da1 value="">
   <input type=hidden name=da2 value="">
   <input type=hidden name=pce1 value="">
   <input type=hidden name=pce2 value="">
   <input type=hidden name=dum1 value="">
   <input type=hidden name=dum2 value="">
   <input type=hidden name=typ1 value="1">
   <input type=hidden name=typ2 value="1">
   <input type=hidden name=cgenrur value="%PATWEB98.02.001">
   <input type=hidden name=ptcnualt value="%PATWEB98.02.002">
   <input type=hidden name=savealia value="1">
   <input type=hidden name=dummy>
   <input type=hidden name=ihos >
   <input type=hidden name=uhos >
<table width=100% align=center border=0 cellspacing=0>
<tr><td align=center class=HeadingCell>
    Temporary/Alternate ID Merge</td></tr>
</table>

<table width=95% align=center border=0 cellspacing=0>
<tr><td width=20%></td>
    <td width=40%>U/R(No longer required)</td></tr>
    <tr><td><div id=AlternateID></div></td></tr>

<tr><td class=DataLabel>U/R or Record ID</td>
    <td class=DataField>
    <input type=text  title="U/R No" name=urnumbe1 class=Mandatory size=10
     maxlength=8
     onblur='UpCase(this);validateRecordID1()'></td>
    <td><div id=URField></div></td></tr>

<tr><td class=DataLabel>Name</td>
    <td class=DataField>
    <input type=text name=fna1 size=50 readonly></td></tr>

<tr><td class=DataLabel>Date of Birth</td>
    <td class=DataLabel>
    <input type=text name=dob1 size=20 readonly>
    Age <input type=text name=age1 size=10 readonly></td></tr>

<tr><td class=DataLabel>Sex</td>
    <td class=DataField>
    <input type=text name=sex1 size=10 readonly></td></tr>

<tr><td class=DataLabel>Medicare Number</td>
    <td class=DataField>
    <input type=text name=medi1 size=10 readonly></td></tr>

<tr><td class=DataLabel>Address 1</td>
    <td class=DataField>
    <input type=text name=adda1 size=35 readonly></td></tr>

<tr><td class=DataLabel>Address 2</td>
    <td class=DataField>
    <input type=text name=addb1 size=35 readonly></td></tr>

<tr><td class=DataLabel>Address 3</td>
    <td class=DataField>
    <input type=text name=sub1 size=35 readonly></td></tr>

<tr><td class=DataLabel>Address 4</td>
    <td class=DataField>
    <input type=text name=addc1 size=35 readonly></td></tr>

<tr><td class=DataLabel>Postcode</td>
    <td class=DataField>
    <input type=text name=post1 size=8 readonly></td></tr>

<tr><td colspan=3 align=center>
    <input type=button id="pat83sub" value=Ok class="button" 
     onClick="MergePatients();">
    <input type=reset value=Clear class="button">
    </td></tr>
</table>
</form>
<div id=URFieldRow style="display:none">
    <td class=HeadingCell width=408>New U/R</td></tr>
    <td class=DataField>
    <input type=text  title="U/R No" name=urnumbe2 class=Mandatory size=10
     maxlength=8
     onblur='UpCase(this);validateRecordID2()'></td></tr>
    <td class=DataField>
</div>
<div id=AlternateIDRow style="display:none">
    <td>Temporary UR <input name=typeurno type=radio value=0
                onclick=document.UpdateForm.urnumbe1.focus();valTemp();></td>
    <td>Alternate ID <input name=typeurno type=radio value=1
                onclick=document.UpdateForm.urnumbe1.focus();
                 checkAlpha(document.UpdateForm.urnumbe1);></td>

</tr>
</div>

<form action=patweb83.pbl name=AddForm type=post>
<input type=hidden name=reportno value=2>
<input type=hidden name=template value=001>
<input type=hidden name=nextpage value="1">
<input type=hidden name=redirect value="">
<input type=hidden name=oldurnum>
<input type=hidden name=newurnum>
<input type=hidden name=savealia value="1">
<input type=hidden name=mrgurdat value="1">
</form>


<meta name="TemplateVersion" content="V12.00.00">
<meta name="TemplateHome" content="stv">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/patweb85.js"></script>
<script type="text/javascript" src="../js/MrtLocations.js"></script>
<script type="text/javascript" src="../js/MrtMultiLocations.js"></script>
<script type="text/javascript" src="../js/MrtHomeLocns.js"></script>
<script type="text/javascript" src="../js/MrtMultiHomeLocns.js"></script>
<script type="text/javascript">
function SetReq() {
  if (document.AddForm.requtype.value=="1") {
    RequestType.innerHTML=ReqFree.innerHTML;
  } else {
    RequestType.innerHTML=ReqSelect.innerHTML;
  }
  SetHospital(AddForm);
  SetDestination(AddForm);
  SetHomeHosp(AddForm);
  SetHomeLocn(AddForm);
}
function OutputTable(ReturnCode) {
  if (ItemCnt>=99) {
    alert("Page Limit Reached");
    return;
  }
  if (isWhitespace(ReturnCode.value)) return;;

  var MrKeyRecord="";
  var PatientName="";
  var CurrentHosp="";
  var CurrentHosp="";
  var CurrentLoct="";
  var LastMovDate="";
  var Description="";
  var Flag=0;
//
//  Check for a Merged U/R
//
  p=document.AddForm
  if (p.URNumber.value!="") {
    var patname=new Object();
    var Merged=new Object();
    var Mergedur=new Object();
    var mrrecord=new Object();

    validateCodeMerge(28,p.URNumber,patname,Merged,Mergedur,mrrecord)

    if (patname.value!="") {
      if (Merged.value=="1") {
        if (mrrecord.value!="1") {
          alert("Warning : This U/R Number is merged with " + Mergedur.value);
          if (p.wahealth == undefined ) {
            p.URNumber.value=Mergedur.value;
            OutputTable(p.URNumber) // Load U/R that this U/R is merged with!
          } else { p.URNumber.value = "" }
          return;
        } else {
          alert("Warning : This U/R Number is merged with " + Mergedur.value +
               "\nU/R - " + p.URNumber.value + " still has a medical record, " +
                "please merge all medical records for this UR!");
          p.URNumber.value="";
          return;
        }
      }
    }
  } else {
    var patname=new Object();
    var Merged=new Object();
    var Mergedur=new Object();
    var mrrecord=new Object();
    var mrtscanur=new Object();
    mrtscanur.value=ReturnCode.value.substring(0,8);
    validateCodeMerge(28,mrtscanur,patname,Merged,Mergedur,mrrecord);
    if (patname.value!="") {
      if (Merged.value=="1") {
        alert("Warning : This U/R Number is merged with " + Mergedur.value);
        ReturnCode.value="";
        return
      }
    }
  }
//
//  Validate Medical record
//
  var serverURL   = "../cgi-bin/mrtweb01.pbl?reportno=14" +
                    "&mrkeyarr=" + ReturnCode.value.replace(/ /g,"+") +
                    "&docmtype=" + AddForm.medrr001.value.replace(/ /g,"+") +
                    "&volumeno=" + AddForm.mrtme011.value.replace(/ /g,"+") +
                    "&homehosp=" + AddForm.medrr012.value.replace(/ /g,"+") +
                    "&location=" + AddForm.homelocn.value.replace(/ /g,"+") 
    if(document.AddForm.fullflag=="1"){
    var serverURL = "../cgi-bin/mrtweb01.pbl?reportno=14" +
                  "&mrkeyarr=" + ReturnCode.value.replace(/ /g,"+") +
                  "&volumeno=" + AddForm.mrtme011.value.replace(/ /g,"+") }

  var returnValue = RSExecute(serverURL);
  ReturnValue=returnValue.return_value.split("|");
  if (returnValue.status==0) {
//
//  Check for an already entered U/R
//
    for (var i=0; i < document.AddForm.length; i++) {
      if (document.AddForm.elements[i].name.match(/mrkeyarr/)) {
        enterur=ReturnValue[0].substring(0,8);
        checkey=document.AddForm.elements[i].value.substring(0,8);
        if (enterur == checkey) {
          alert("Warning: U/R already entered!");
          document.AddForm.URNumber.value="";
          document.AddForm.URNumber.focus();
          break; 
        } 
      } 
    }
//
    if(document.AddForm.wahealth!=undefined &&
       document.AddForm.superlev.value!="1") {
       vol_error=false;
       if(AddForm.medrr012.value.substr(0,3) !=
          ReturnValue[0].replace(/\+/g," ").substr(8,3)) {
          vol_error=true;
       }
       if(AddForm.medrr013.value.substr(0,4) !=
          ReturnValue[0].replace(/\+/g," ").substr(11,4)) {
          vol_error=true;
       }
       if(AddForm.medrr001.value.substr(0,3) !=
          ReturnValue[0].replace(/\+/g," ").substr(15,3)) {
          vol_error=true;
       }
       if(vol_error) {
         alert("Volume Not Found, UR - " +
                ReturnValue[0].replace(/\+/g," ").substring(0,8));
         return
       }
    }
//
    AddOutputArraySCol(ReturnValue[0],ReturnValue[1],ReturnValue[2],
                   ReturnValue[3],ReturnValue[4],ReturnValue[5],
                   ReturnValue[6],ReturnValue[7],ReturnValue[9],
                   ReturnValue[10],ReturnValue[32]);
    OutputDivision();
    ReturnCode.value="";
    ReturnCode.focus();
    if (!isWhitespace(document.AddForm.mrtme011.value)) {
      document.AddForm.mrtme011.value=""; 
    }
  } else {
    ReturnCode.focus();
    ReturnCode.value="";
    if (!isWhitespace(document.AddForm.mrtme011.value)) {
      document.AddForm.mrtme011.value=""; 
    }
    ReturnCode.select();  
  }
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);setTimeout('SetReq()',100);">
<form name=AddForm method=post action=patweb85.pbl style="margin:0">
<input type=hidden name=reportno value="4">
<input type=hidden name=template value="001">
<input type=hidden name=updatety value="A">
<input type=hidden name=redirect value="patweb85.pbl?reportno=5&template=2&requestn=">
<input type=hidden name=nextpage value="1">
<input type=hidden name=urnumber value="%MRTWEB01.09.011">
<input type=hidden name=medrr010 value="%STANDARD.01.032">
<input type=hidden name=requtype value="%PATWEB85.04.019">
<input type=hidden name=tmotfrst value="10">
<input type=hidden name=tmotnext value="10">
<input type=hidden name=mrcnibap value="%STANDARD.01.025.097.165.0.1">
<input type=hidden name=ibcnmhos value="%STANDARD.01.025.000.043.1.1">
<input type=hidden name=desthosp value="%PATWEB85.04.034.0">
<input type=hidden name=destlocn value="    ">
<input type=hidden name=homehosp value="%PATWEB85.04.034.0">
<input type=hidden name=homelocn value="%PATWEB85.04.034.1">
<input type=hidden name=superlev value="%PATWEB85.04.035">

<table border=0 align=center width=100% cellpadding=0 cellspacing=0> 
<tr><td class=HeadingCell align=center>
Record Bulk Request
</td></tr>
</table>

<table border=0 align=center width=90% cellpadding=1> 
<tr><td class=DataLabel>Date Required</td>
    <td><input type=text size=12 name=medrr004 id=medrr004
         class="Mandatory Date" title="Date Required" value="%STANDARD.01.015">
        <img notab src=../images/DateLookup.gif class=Icon
         onclick="DateLookupFrame(medrr004);"> 

        <input class=Mandatory type=text name=medrr005 id=medrr005
         size=8 value="%STANDARD.01.016" title="Time">
        <img notab src=../images/DateTimeStamp.gif class=Icon
         onclick="SetCurrentDateTime(medrr004,medrr005);">     
        <img notab src=../images/TimeLookup.gif class=Icon
         onclick="TimeLookupFrame(medrr005);">                 
    </td>                                                  

    <td>Requested By</td>
    <td><div id=RequestType></div></td>
</tr>

<tr><td>Destination</td>
    <td><select name=medrr006 id=medrr006 class="Mandatory"
     title="Destination">  
    <option></option>
    </select>
    </td>                                                  

    <td class=DataLabel><div id=HospitalTitle></div></td>
    <td><div id=Hospital></div></td>
</tr>
<tr><td>Reason</td>     
    <td><select name=medrr003 id=medrr003 title="Reason" class=Mandatory>
    <option></option>
    %PATWEB85.04.008.1
    </select>
    </td></tr>                                                  
<!--
    <td class=DataLabel>Urgency</td>
    <td><select name=medrr008 class=Mandatory title="Urgency">
    <option></option>
    PATWEB85.04.001.2
    </select></td></tr>

    <td>Hospital ID</td>
    <td><select name=medrr010 class=Mandatory title="Hospital ID">
    <option></option>
    PATWEB85.04.004
    </select>
    </td></tr>                                                  
-->
<tr><td>Document Type</td>     
    <td><select name=medrr001 id=medrr001 class=Mandatory
     title="Document Type">
    <option></option>
    %PATWEB85.04.006.2
    </select></td>
   </tr>

<tr><td class=DataLabel>Extension #</td>
    <td><input type=text name=medrr007 id=medrr007 size=15 maxlength=30
         title="Extension"></td>
    <td class=DataLabel>Pager #</td>
    <td><input type=text name=medrr011 id=medrr011 size=15 maxlength=30
         title="Pager Number"></td>

<tr><td class=DataLabel>Comments</td>
    <td><input type=text name=medrr009 id=medrr009 size=55 maxlength=35
         title="Comments"></td>
</tr>

<tr><td colspan=4 align=center><hr></td></tr>

<tr><td class=DataLabel><div id=HomeHospTitle></div></td>
    <td><div id=HomeHosp></div></td>

    <td>Home Location</td>
    <td><select name=medrr013 id=medrr013 class=Mandatory title="Home Location"
         onchange="ResetHomeLocn(AddForm);">
    <option></option>
    </select></td></tr>

<tr><td>U/R Number</td>
    <td><input type=text name=URNumber id=URNumber
         title="UR" onkeyDown="SetUrEvent();">
        <input type=hidden name=d1 id=d1>
        <input type=hidden name=d2 id=d2>
        <input type=hidden name=mrtme011 id=mrtme011>
        <img src=../images/SearchIcon.gif class=Icon notab
         onclick="SearchPatient();">
<!--
    Volume
    <input type=text name=mrtme011 size=2
         onblur=OutputTable(AddForm.URNumber); ></td>
-->
    <td>Medical Record Scan</td>
    <td><input type=text name=RecordKey id=RecordKey maxlength=17
         onfocus="CheckMaxLength(this);"
         onkeyDown="SetMedEvent();" title="Record Key">
    </td></tr>

</table>
<div id=Results></div>
<table border=0 align=center width=100% cellspacing=1>
<tr><td colspan=2 align=center><br>
    <input type=button value="Request" name=ReqButton id=ReqButton
     class="button" onclick="tempDisable(this);AddMovRecord();">
    <input type=button value="Clear All" class="button"
     onclick="location.reload()">
</td></tr>
</table>
</form>

<span id=ReqFree style="display:none">
  <input type=text name=medrr002 id=medrr002 title="Requested By" 
   value="%PATWEB85.04.007" class=Mandatory maxlength=35 
   onblur="RemoveQuote(this);">      
</span>
<span id=ReqSelect style="display:none">
  <select name=medrr002 id=medrr002 title="Requested By">
    <option></option>
    %PATWEB85.04.020
  </select>
</span>

<span id=ShowHospitalTitle style="display:none">
   Hospital
</span>

<span id=ShowHospital style="display:none">
  <select name=medrr010 id=medrr010 title="Hospital" class="Mandatory"
   onchange="SetDestination(AddForm);">
   %PATWEB85.04.004
  </select>
</span>

<span id=ShowNoHospital style="display:none">
   <input type=hidden name=medrr010 id=medrr010 value="    ">
</span>

<span id=ShowHomeHospTitle style="display:none">
  Home Hospital
</span>

<span id=ShowHomeHosp style="display:none">
  <select name=medrr012 id=medrr012 title="Home Hospital" class="Mandatory"
   onchange="SetHomeLocn(AddForm);">
   %PATWEB85.04.043
  </select>
</span>

<span id=ShowNoHomeHosp style="display:none">
   <input type=hidden name=medrr012 id=medrr012 value="    ">
</span>

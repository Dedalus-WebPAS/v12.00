<meta name="TemplateVersion" content="V12.00.00">
<meta name="TemplateHome" content="cab">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/preadmission.js"></script>
<script type="text/javascript" src="../js/ReportStandard.js"></script>
<script type="text/javascript">
function checkMultipleAdmission(theForm){
  theForm.contmult.value="0";
  var serverURL = "../cgi-bin/comweb80.pbl?reportno=42&remoteno=1" +
                  "&valdcode="+theForm.urnumber.value.replace(/ /g,"+");
  var returnValue = RSExecute(serverURL);
  if (returnValue.status!=0) {
    return true;
  }
  ReturnValues=returnValue.return_value.split("|")
  current=ReturnValues[0];
  count=ReturnValues[1];
  theForm.leavhosp.value=ReturnValues[2];
  theForm.leavadmn.value=ReturnValues[3];
  theForm.leavtype.value=ReturnValues[4];
  adm_this_hosp=ReturnValues[5];
  if(adm_this_hosp=="1"){
    alert("Error: Patient is already admitted to this hospital.");
    return true;
  }
  if(count>1){
    alert("Error: More than one current admission already exists.");
    return true;
  }
  if(current=="1"){
    if(confirm("Patient Currently admitted at "+
            trim(theForm.leavhosp.value) +
            " under Admission - " +
            theForm.leavadmn.value + "\n" )){
            theForm.contmult.value="1";
            return false;
    } else {
            theForm.contmult.value="0";
            return true;
    }
  }
  if(count==1){
    if(!confirm("Patient Currently on leave from "+
            trim(theForm.leavhosp.value) +
            " under Admission - " +
            theForm.leavadmn.value + "\n" +
            "Leave Type=" +
            theForm.leavtype.value )){
            return true;
     } else {
       theForm.contmult.value="1";
     }
  }
  return false;
}
function getPriorDateCookie() {
  if(GetCookieData('priordatecookie')=="1") {
    document.UpdateForm.ptmis001.className="Mandatory PriorDate";
  }
  SetCookie("priordatecookie","");
}
function SubmitAdm2() {
  document.UpdateForm.complete.value="1"
  SubmitAdm();
}
function URRefresh() {
   theURL = "patweb89.pbl?reportno=1&template=26&urnumber="+
            document.UpdateForm.urnumber.value+"&recurrfl=1"+
            "&batchnum="+document.UpdateForm.batchnum.value+
            "&discflag="+document.UpdateForm.discflag.value+
            "&ptmis068="+document.UpdateForm.ptmis068.value+
            "&ptmis024="+document.UpdateForm.ptmis024.value+
            "&admissno="+document.UpdateForm.admissno.value
   location.href=theURL;
}
function valdUR() { 
  p=UpdateForm;
  if (isWhitespace(p.urnumber.value)) {
    return;
  }
  if (p.urnumber.value=="       0") {
    p.urnumber.value="";
    return;
  }
  justifyRight(p.urnumber);
  UpCase(p.urnumber);
  if(!validateUR(97,p.urnumber,p.patname,p.dummy,p.dummy,p.dummy,p.dummy,p.admissno)) {
    p.urnumber.focus();
    return;
  }
}
function checkUR() { 
  p=UpdateForm;
  if (isWhitespace(p.urnumber.value)) {
    return;
  }
  if (p.urnumber.value=="      0") {
    return;
  }
  justifyRight(p.urnumber);
  UpCase(p.urnumber);
  if(!validateUR(97,p.urnumber,p.patname,p.dummy,p.dummy,p.dummy,p.dummy,p.admissno)) {
    p.urnumber.focus();
    return;
  }
  document.PatientLinks.admissno.value=p.admissno.value;
  URRefresh();
}
function validateUR(OptionNumber,ReturnCode,ReturnName) {
  ReturnFunction="" ;
  ReturnName.value="";
  p=document.UpdateForm
  UpCase(p.urnumber);
  for (var i=3; i < validateUR.arguments.length; i++) {
    if (typeof(validateUR.arguments[i]) == 'function') {
      ReturnFunction=validateUR.arguments[i] }
    else {
      validateUR.arguments[i].value=""; }  }
  if (isWhitespace(ReturnCode.value)) return;;
  var serverURL   = "../cgi-bin/patweb80.pbl?reportno=" + OptionNumber +
                    "&valdcode=" + ReturnCode.value.replace(/ /g,"+")+
                    "&valdward=" + p.ptmis068.value.replace(/ /g,"+")+
                    "&valdspec=" + p.ptmis024.value.replace(/ /g,"+")+
                    "&valdrdat=" + p.ptmis001.value.replace(/ /g,"+")+
                    "&valdrtim=" + p.ptmis002.value.replace(/ /g,"+") 
  var returnValue = RSExecute(serverURL);
  if (returnValue.status==0) {
    ReturnValue=returnValue.return_value.split("|")
    ReturnName.value=trim(ReturnValue[0])
    j=0
    for (var i=3; i < validateUR.arguments.length; i++) {
       if (typeof(validateUR.arguments[i]) != 'function') {
         j++
         validateUR.arguments[i].value=ReturnValue[j] } }
    if (typeof(ReturnFunction) == 'function') {
       ReturnFunction() }
      return true;
    } else {
      ReturnCode.value="";
      ReturnCode.select();
      ReturnCode.focus();
      return false;
    }
}
function clickCancel(){
  if(UpdateForm.discflag.value=="1"){
    document.UpdateForm.redirect.value="patweb09.pbl?reportno=01&template=001"+
       "&batchnum="+document.UpdateForm.batchnum.value.replace(/ /g,"+")+
       "&radmdate="+parent.document.SelectWard.ptmis001.value.replace(/ /g,"+")+
       "&radmtime="+parent.document.SelectWard.ptmis002.value.replace(/ /g,"+")+
       "&radmdtim="+parent.document.SelectWard.ptdsc002.value.replace(/ /g,"+")+
       "&radmward="+parent.document.SelectWard.wardcode.value.replace(/ /g,"+")+
       "&radmspec="+parent.document.SelectWard.specialt.value.replace(/ /g,"+");
  } else {
    document.UpdateForm.redirect.value="patweb09.pbl?reportno=01&template=002"+
       "&batchnum="+document.UpdateForm.batchnum.value.replace(/ /g,"+")+
       "&radmdate="+parent.document.SelectWard.ptmis001.value.replace(/ /g,"+")+
       "&radmtime="+parent.document.SelectWard.ptmis002.value.replace(/ /g,"+")+
       "&radmward="+parent.document.SelectWard.wardcode.value.replace(/ /g,"+")+
       "&radmspec="+parent.document.SelectWard.specialt.value.replace(/ /g,"+");
  }
 DFrameExit();
 parent.location=document.UpdateForm.redirect.value; 
}

function SubmitAdm() {
  if(document.UpdateForm.complete.value!="1"){
       document.UpdateForm.popupadd.value="1"
  }
  if(checkMultipleAdmission(UpdateForm)){
    return;
  }

  if(UpdateForm.discflag.value=="1"){
    document.UpdateForm.redirect.value="patweb09.pbl?reportno=01&template=001"+
       "&batchnum="+document.UpdateForm.batchnum.value.replace(/ /g,"+")+
       "&radmdate="+parent.document.SelectWard.ptmis001.value.replace(/ /g,"+")+
       "&radmtime="+parent.document.SelectWard.ptmis002.value.replace(/ /g,"+")+
       "&radmdtim="+parent.document.SelectWard.ptdsc002.value.replace(/ /g,"+")+
       "&radmward="+parent.document.SelectWard.wardcode.value.replace(/ /g,"+")+
       "&radmspec="+parent.document.SelectWard.specialt.value.replace(/ /g,"+")+
       "&popupadd="+document.UpdateForm.popupadd.value.replace(/ /g,"+");
  } else {
    document.UpdateForm.redirect.value="patweb09.pbl?reportno=01&template=002"+
       "&batchnum="+document.UpdateForm.batchnum.value.replace(/ /g,"+")+
       "&radmdate="+parent.document.SelectWard.ptmis001.value.replace(/ /g,"+")+
       "&radmtime="+parent.document.SelectWard.ptmis002.value.replace(/ /g,"+")+
       "&radmward="+parent.document.SelectWard.wardcode.value.replace(/ /g,"+")+
       "&radmspec="+parent.document.SelectWard.specialt.value.replace(/ /g,"+")+
       "&popupadd="+document.UpdateForm.popupadd.value.replace(/ /g,"+");
  }
  if(UpdateForm.prvadmis.value==""){
    alert("No valid Admission to copy can be found.  Please create a new "+
           "admission or enter another U/R Number.");
    return;
  }
  MandatoryOk=true;
  if  (!validateMandatory(UpdateForm)) {
      return;
  }
  UpdateForm.OKButton.disabled=true;
  UpdateForm.compButton.disabled=true;
  if (MandatoryOk) {
    UpdateForm.ptmis004.value=UpdateForm.ptmis068.value;
    if(document.UpdateForm.complete.value=="1"){
      SubmitHidden(UpdateForm);
    } else {
      document.UpdateForm.popupadd.value="1"
      SubmitHidden(UpdateForm);
    }
    setTimeout('UpdateForm.OKButton.disabled=false',6000);
    setTimeout('UpdateForm.compButton.disabled=false',6000);
   }else{
    UpdateForm.OKButton.disabled=false;
    UpdateForm.compButton.disabled=false;}
}
function valDoctorUnit() {
  validateCode(31,UpdateForm.ptmis007,UpdateForm.doctnam2);
    selectOptions("30",UpdateForm.ptmis007,UpdateForm.ptmis024);
   UpdateForm.ptmis024.selectedIndex=1
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);valdUR();getPriorDateCookie();">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon"
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
<script type="text/javascript">document.write('Input Recurring Care');</script>
</span>

<form name=linkForm action=patweb89.pbl method=post>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=1>
<input type=hidden name=urnumber value="%PATWEB89.01.003">
<input type=hidden name=admissno value="%PATWEB89.01.081">
</form>

<form name=UpdateForm method=post action=patweb89.pbl>
<input type=hidden name=reportno value="2">
<input type=hidden name="updatety" value="1">
<input type=hidden name="popupadd" value="0">
<input type=hidden name="complete" value="0">
<input type=hidden name="preaflag" value="0">
<input type=hidden name="contmult" value="0">
<input type=hidden name="redirect" value="%PATWEB89.01.001.patweb09.01.001">
<input type=hidden name="allocate" value="1">
<input type=hidden name="batchnum" value="%PATWEB89.01.992">
<input type=hidden name="chckname" value="0">
<input type=hidden name="emradmit" value="0">
<input type=hidden name="emradmis" value="0">
<input type=hidden name="admitnow" value="1">
<input type=hidden name="newbmand" value="0">
<input type=hidden name="agebmand" value="0">
<input type=hidden name="ptmis004" value="0">
<input type=hidden name="ptmas046" value="0">
<input type=hidden name="leavhosp">
<input type=hidden name="leavadmn">
<input type=hidden name="leavtype">
<input type=hidden name="dummy" id=dummy>
<input type=hidden name="nomessag" value="1">
<input type=hidden name="prevdeta" value="1">
<input type=hidden name="trantime" value="">
<input type=hidden name=cfinan value="%PATWEB89.01.932">
<input type=hidden name="exstward" value="%PATWEB89.01.449.1">
<input type=hidden name=ptcnwauc value="%STANDARD.01.025.103.245.0.1">
<input type=hidden name="mhadmflg">
<input type=hidden name="recurrfl" value="%PATWEB89.01.991">
<input type=hidden name="discflag" value="%PATWEB89.01.994">
<input type=hidden name="extcomin" id="extcomin" value="1">
<input type=hidden name=alrtsind value="%PATWEB89.01.084">

<table border=0 colspan=1 width=100% cellspacing=2 cellpadding=0 >
<tr><td class=DataLabel>U/R Number</td>
    <td><input type=text name=urnumber size=10 maxlength=8 id=urnumber
         title='U/R Number' class=Mandatory value="%PATWEB89.01.003"
         onchange='checkUR();'>
        <input type=text name=patname class=readonly readonly size=35
         title='Patient Name' tabindex=-1 id=patname>
        <img src="../images/SearchIcon.gif" class="Icon" alt="Search"
         onclick='PatientSearchFrame(patname,urnumber,dummy,checkUR);'>
</td></tr>
<tr><td class=DataLabel>Previous Admission Number</td>
    <input type=hidden name="prvadmis" value="%PATWEB89.01.081">
    <input type=hidden name="admissno" value="%PATWEB89.01.081">
    <td>%PATWEB89.01.081</td></tr>

    <input type=hidden name="admitbox" value="1">

<tr>
     <td class=DataLabel>Admission Date</td>
            <td class=DataLabel><input type="text" size="12" tabindex=1
             name=ptmis001 value="" class="Mandatory PastDate" id=ptmis001
             title="Admission Date" onblur="checkDate(this,'Admission Date')">
            <img src=../images/DateLookup.gif class=Icon
             align=absmiddle onclick="DateLookupFrame(ptmis001);"> 
             <input type=hidden name=ptmis002>
            </td>
<tr><td class=DataLabel>Ward</td>
       <td>
         <select name=ptmis068 tabindex=13 title="Ward" class=Mandatory 
          onchange=checkUR();>
         <option> </option>
            %PATWEB89.01.449.2
         </select>
         <input type=hidden name=ptmis005 value="">
       </td>
</tr>
<tr>
           <td class=DataLabel>%STANDARD.01.017.AC</td>
           <td><select name=ptmis024 tabindex=15 class=SelectBig
               title='%STANDARD.01.017.AC' onchange=checkUR();>
               <option> </option>
                %PATWEB89.01.124.2
               </select>
           </td></tr>

 <input type=hidden name="ptmis011" value="%PATWEB89.01.112.1">
 <input type=hidden name="ptmis007" value="%PATWEB89.01.108.003">
 <input type=hidden name="ptmis009" value="%PATWEB89.01.110.1">
<!-- Referring Doctor -->
 <input type=hidden name=ptvis028 value="%PATWEB89.01.231.1"> 
<!-- Practice -->
 <input type=hidden name=ptvis029 value="%PATWEB89.01.232.1">
 <input type=hidden name=ptvis030 value="%PATWEB89.01.233.1">
<!-- Intended Stay -->
 <input type=hidden name=ptvis043 value="%PATWEB89.01.246.1">
<!-- Category KN --> 
 <input type=hidden name=ptvis076 value="%PATWEB89.01.292.1">
<!-- Admission Diagnosis --> 
 <input type=hidden name="ptmis020" value="%PATWEB89.01.121">
<!-- Admission Diagnosis ICD --> 
 <input type=hidden name="ptvis075" value="%PATWEB89.01.291">
<!-- Category SG --> 
 <input type=hidden name=ptvis101 value="%PATWEB89.01.298.023.1">
<!-- Category KO --> 
 <input type=hidden name=ptvis078 value="%PATWEB89.01.294.1">
<!-- Category SI --> 
 <input type=hidden name=ptvis103 value="%PATWEB89.01.298.025.1">
<!-- Category LS --> 
 <input type=hidden name=ptvis074 value="%PATWEB89.01.289.1">
<!-- Category SH --> 
 <input type=hidden name=ptvis102 value="%PATWEB89.01.298.024.1">
<!-- Category KG --> 
 <input type=hidden name=ptvis077 value="%PATWEB89.01.293.1">
<!-- Category KD --> 
 <input type=hidden name=ptvis104 value="%PATWEB89.01.298.026.1">
<!-- Admitting Point --> 
 <input type=hidden name=ptvis046 value="%PATWEB89.01.290.1">
<!-- Planned Length of Stay --> 
 <input type=hidden name=ptmis030 value="%PATWEB89.01.129">
<!-- Program --> 
 <input type=hidden name=ptvis099 value="%PATWEB89.01.298.021.1">
<!-- Program Code --> 
 <input type=hidden name=prgmcode value="%PATWEB89.01.298.021.1">
<!-- Claim Code --> 
 <input type=hidden name=ptmis027 value="%PATWEB89.01.126.1">
<!-- Contract id --> 
 <input type=hidden name=ptasf003 value="%PATWEB89.01.199.003.1">
<!-- Health Fund --> 
 <input type=hidden name="ptmis013" value="%PATWEB89.01.114.0">
 <input type=hidden name="ptmis014" value="%PATWEB89.01.115.0">
 <input type=hidden name="ptmis015" value="%PATWEB89.01.116">
<!-- Category A --> 
 <input type=hidden name=ptmis010 value="%PATWEB89.01.111.1">
<!-- Category CC --> 
 <input type=hidden name=ptmis012 value="%PATWEB89.01.113.1">
<!-- Days of hospitalisation --> 
 <input type=hidden name=ptmis031 value="%PATWEB89.01.130">
<!-- Casepayment --> 
 <input type=hidden name=ptmis075 value="%PATWEB89.01.197.1">
<!-- GST --> 
 <input type=hidden name=ptmis074 value="%PATWEB89.01.189.1">
<!-- Casemix Code --> 
  <input type=hidden name=ptmis073 value="%PATWEB89.01.198.1">
<!-- Funding Source --> 
  <input type=hidden name=ptvis131 value="%PATWEB89.01.298.053.1">
<!-- Preferred Accommodation --> 
  <input type=hidden name=ptvis093 value="%PATWEB89.01.298.012.1">
<!-- No WA Hospital Contact --> 
  <input type=hidden name=ptvis125 value="%PATWEB89.01.298.047.1">
<!-- Transfer Source -->
  <input type=hidden name=trnsfsrc value="%PATWEB89.01.193.0">

    <tr align=left><td colspan=4 align=center><br>
         <input type=button value="Add" class="button" name=OKButton disabled 
          tabindex=70
        onclick="checkBedStatus(UpdateForm.ptmis068.value,
                 UpdateForm.ptmis005.value,UpdateForm.ptmis001.value,
                 UpdateForm.ptmis030.value,SubmitAdm)";>
         <input type=button value="Complete" class="button" 
          name=compButton disabled tabindex=70
        onclick="checkBedStatus(UpdateForm.ptmis068.value,
                 UpdateForm.ptmis005.value,UpdateForm.ptmis001.value,
                 UpdateForm.ptmis030.value,SubmitAdm2)";>
       <input tabindex=71 type=button value="Cancel" class="button"
             onclick="clickCancel();">
    </table></td></tr>
</table>
</form>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=urnumber value="%PATWEB89.01.003">
<input type=hidden name=admissno value="%PATWEB89.01.081">
<input type=hidden name=MenuType value="%PATWEB89.01.088">
</form>

<span id=WaitingList style="display:none">
<table width=100% height=100% border=0 cellspacing=0 cellpadding=0>
<tr><td class=DataLabel width=37%>Date of Referral</td>
    <td><input type=text size=12 name=ptmis058 tabindex=18 id=ptmis058
         onblur="checkDate(this,'ReferralDate')">
         <img notab src=../images/DateLookup.gif class=Icon
          onclick="DateLookupFrame(ptmis058);"></td></tr>
<tr><td class=DataLabel>Date of 1st Spec Consult</td>
  <td><input type=text size=12 name=ptmis059 tabindex=19 id=ptmis059
         onblur="checkDate(this,'SpecConDate')">
    <img notab src=../images/DateLookup.gif class=Icon
          align=absmiddle onclick="DateLookupFrame(ptmis059);"></td></tr>
</table>
</span>

<span id=BabyAge style="display:none">
<table width=100% height=100% border=0 cellspacing=0 cellpadding=0>
<tr>
  <td class=DataLabel width=37%>Admission Weight</td>
  <td>
   <input type=text name=ptmis051 size=8 maxlength=6 tabindex=20
    onchange=justifyRight(this);>grams</td></tr>
</table>
</span>

<span id=NewBorn style="display:none">
<table width=100% height=100% border=0 cellspacing=0 cellpadding=0>
<tr><td class=DataLabel width=37%>Gestation Period</td>
  <td><input type=text name=ptmis041 maxlength=3 size=4 tabindex=21> weeks
    </td></tr>
</table>
</span>

<span id=transferhd style="display:none">
<td class=DataLabel>Transfer Source</td>
</tr>
</span>
<span id=transfersrc style="display:none">
 <td><input type="text" size=7 maxlength=5 name=trnsfsrc class=Mandatory
      title="Transfer Source" tabindex=5 id=trnsfsrc
      value="%PATWEB89.01.193.0"
      onchange="validateCode(9,trnsfsrc,trandesc);">
     <input type=text size=27 name=trandesc notab id=trandesc
      class=Readonly readonly value="%PATWEB89.01.193.1">
     <img src="../images/SearchIcon.gif" class=Icon
      onclick="TransferSourceFrame(trnsfsrc,trandesc)"></td>

</tr>
</span>
<span id=blanklabel style="display:none">&nbsp;</span>
<span id=transferblank style="display:none">
   <input type=hidden name=trnsfsrc>
</span>
<span id=contracthd style="display:none">
Contract Type
</span>

<span id=contracrhd style="display:none">
Contract Role
</span>
  
<span id=contracihd style="display:none">
 Contract Id
</span>
    
<span id=contractid style="display:none">
<td><input type="text" size=7 maxlength=5 name=ptasf003 id=ptasf003
      value="%PATWEB89.01.199.003.1"
      tabindex=29 onblur="validateCode(9,ptasf003,d_ptasf003);">
     <input type=text size=27 name=d_ptasf003 notab id=d_ptasf003
       value="%PATWEB89.01.199.003.2"
      class=Readonly readonly>
     <img src="../images/SearchIcon.gif" class=Icon
      onclick="TransferSourceFrame(ptasf003,d_ptasf003)"></td>
</span>

<span id=contracttype style="display:none">
  <input type="text" name=ptasf001 size=2 maxlength=1
   value="%PATWEB89.01.199.001" tabindex=26
   title="Contract Type"
   onblur="ContType(this);">
   <img src="../images/SearchIcon.gif" class=Icon
   onclick="ContTypeAlert();">
</span>

<span id=contractrole style="display:none">
  <input type="text" name=ptasf002 size=2 maxlength=1
   value="%PATWEB89.01.199.002" tabindex=27
   title="Contract Role"
   onblur="ContRole(this);">
   <img src="../images/SearchIcon.gif"
   onclick="ContRoleAlert();">
</span>
<script type="text/javascript">
function init() {
 p=document.UpdateForm
 p.ptmis001.value=parent.SelectWard.ptmis001.value;
 p.ptmis002.value=parent.SelectWard.ptmis002.value;
 if(parent.SelectWard.ptdsc002!=undefined){
   p.trantime.value=parent.SelectWard.ptdsc002.value;
 }
 UpdateForm.OKButton.disabled=false;
 UpdateForm.compButton.disabled=false;

  wardcode="%PATWEB89.01.997"
  if(wardcode=="~~~"){
     for (var i =0 ; i < document.UpdateForm.ptmis068.length; i++) {
     if (document.UpdateForm.ptmis068.options[i].value.substr(0,3)==
        parent.SelectWard.wardcode.value.substr(0,3)) {
        document.UpdateForm.ptmis068.selectedIndex=i } };
   } else {
   for (var i =0 ; i < document.UpdateForm.ptmis068.length; i++) {
    if (document.UpdateForm.ptmis068.options[i].value.substr(0,3)==
        wardcode) {
       document.UpdateForm.ptmis068.selectedIndex=i } };
   }
  }
  speciality="%PATWEB89.01.998"
  if(speciality=="~~~"){
  for (var i =0 ; i < document.UpdateForm.ptmis024.length; i++) {
    if (document.UpdateForm.ptmis024.options[i].value.substr(0,3)==
        parent.SelectWard.specialt.value.substr(0,3)) {
       document.UpdateForm.ptmis024.selectedIndex=i } };
  } else {
   for (var i =0 ; i < document.UpdateForm.ptmis024.length; i++) {
    if (document.UpdateForm.ptmis024.options[i].value.substr(0,3)==
        speciality) {
       document.UpdateForm.ptmis024.selectedIndex=i } };
   }

 document.UpdateForm.ptmas046.value =
   document.UpdateForm.alrtsind.value.substr(10,1);

 currhosp=trim("%PATWEB89.01.999.017")
 curradmn="%PATWEB89.01.999.018"

</script>
